{"title":"利用 etcdhosts 插件快速搭建分布式 CoreDNS 集群","id":"posts/3252.html","date_published":"03/01/2021","summary":"etcdhosts 插件简介\netcdhosts 顾名思义，就是将 hosts 文件存储在 Etcd 中，然后多个 CoreDNS 共享一份 hosts 文件；得益于 Etcd 提供的 watch 功能，当 Etcd 中的 hosts 文件更新时，每台 CoreDNS 服务器都会接到推送，同时完成热重载；etcdhosts 基本架构如下:\n123456789101112131415161718192021222324+-----------------------------------------------------------------------------+|                                                                             ||   +-----------+                                                             ||   |           |                                                             ||   |  CoreDNS  +---------------------+                                       ||   |           |                     |                                       ||   +-----------+                     |                +------------------+   ||                                     |                |                  |   ||                            +--------v---------+      |                  |   ||   +-----------+            |                  |      |                  |   ||   |           |            |                  |      | dnsctl or        |   ||   |  CoreDNS  +------------&gt;   Etcd Cluster   &lt;------+ other etcd tool  |   ||   |           |            |                  |      |                  |   ||   +-----------+            |                  |      |                  |   ||                            +---------^--------+      |                  |   ||                                      |               |                  |   ||   +-----------+                      |               +------------------+   ||   |           |                      |                                      ||   |  CoreDNS  +----------------------+                                      ||   |           |                                                             ||   +-----------+                                                             ||                                                                             ||                                                                             |+-----------------------------------------------------------------------------+\n编译 CoreDNS\n\netcdhosts release 页已经提供部分版本的预编译文件，可以直接下载使用。\n\netcdhosts 作为一个 CoreDNS 扩展插件采用直接偶合的方式编写(未采用 gRPC 是因为考虑性能影响)，这意味着需要重新编译 CoreDNS 来集成插件，以下为 CoreDNS 编译过程(使用 docker):\n1234# clone source codegit clone https:&#x2F;&#x2F;github.com&#x2F;ytpay&#x2F;etcdhosts.git# buildcd etcdhosts &amp;&amp; .&#x2F;build v1.8.0\n编译完成后将在 build 目录下生成各个平台的二进制文件压缩包。","url":"https://www.hi-linux.com/posts/3252.html","tags":["技巧","Linux","CoreDNS"],"categories":["CoreDNS"]}