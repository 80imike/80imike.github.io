{"title":"Kubernetes 实用小妙招系列：巧用程序进程 PID、容器名称获取其对应的 Pod 名称或 PID","id":"posts/1620.html","date_published":"08/13/2020","summary":"在管理 Kubernetes 集群的过程中，我们经常会遇到这样一种情况：在某台节点上发现某个进程资源占用量很高，却又不知道是哪个容器里的进程。有没有办法可以根据 PID 快速找到 Pod 名称呢？\n假设现在有一个 Prometheus 进程的 PID 是 14338：\n\n为了进一步挖掘信息，有两种思路，一种是挖掘 PID 对应的容器的信息，另一种是挖掘 PID 对应的 Pod 的信息。\n1. Container ID\n要获取容器的 ID，可以查看 PID 对应的 cgroup 信息：\n12345678910111213$ cat &#x2F;proc&#x2F;14338&#x2F;cgroup11:blkio:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c10:cpuset:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c9:freezer:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c8:hugetlb:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c7:perf_event:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c6:cpuacct,cpu:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c5:pids:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c4:devices:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c3:net_prio,net_cls:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c2:memory:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c1:name&#x3D;systemd:&#x2F;kubepods&#x2F;burstable&#x2F;pod8e018a8e-4aaa-4ac6-986a-1a5133a4bcf1&#x2F;d6f24b62ea28e9e67f7bc06f98de083cc49454f353389cd396f5d3ac6448f19c\n可以看到该进程对应的容器 ID 为 d6f24b62…，可以再优化一下上面的命令，直接获取容器 ID：\n123$ CID&#x3D;$(cat &#x2F;proc&#x2F;14338&#x2F;cgroup | awk -F &#39;&#x2F;&#39; &#39;&#123;print $5&#125;&#39;)$ echo $&#123;CID:0:8&#125;d6f24b62","url":"https://www.hi-linux.com/posts/1620.html","tags":["技巧","Linux","Kubernetes"],"categories":["Kubernetes"]}