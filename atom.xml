<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¥‡å¦™çš„ Linux ä¸–ç•Œ</title>
  
  <subtitle>ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.hi-linux.com/"/>
  <updated>2021-09-01T01:27:23.428Z</updated>
  <id>https://www.hi-linux.com/</id>
  
  <author>
    <name>Mike</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸‡å­—é•¿æ–‡è¯¦è§£ PaaS toB åœºæ™¯ä¸‹ Kubernetes ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆ</title>
    <link href="https://www.hi-linux.com/posts/27427.html"/>
    <id>https://www.hi-linux.com/posts/27427.html</id>
    <published>2021-09-01T01:00:00.000Z</published>
    <updated>2021-09-01T01:27:23.428Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>åœ¨ä¼ä¸šç§æœ‰äº‘ç¯å¢ƒå½“ä¸­ï¼Œå‡ºäºå¯¹æ•°æ®å®‰å…¨çš„è€ƒè™‘ä»¥åŠæ»¡è¶³ <a href="http://www.djbh.net/" target="_blank" rel="noopener">ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤</a> çš„è¦æ±‚ï¼Œå¾€å¾€ä¼šå¯¹å†…éƒ¨ç¯å¢ƒä¸­çš„æœåŠ¡å™¨åšå‡ºä¸¥æ ¼çš„è®¿é—®é™åˆ¶ã€‚ä¸€èˆ¬æ¥è®²ç”Ÿäº§ç¯å¢ƒéƒ½ä¼šç¦æ­¢è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œå¼€å‘äººå‘˜è¦è®¿é—®ç”Ÿäº§ç¯å¢ƒä¹Ÿå¿…é¡»é€šè¿‡å ¡å’æœºæˆ–è€…å…¶ä»–æ–¹å¼è¿›è¡Œå®‰å…¨å®¡è®¡ç™»å½•ã€‚åœ¨è¿™ç§æ— ç½‘ï¼ˆæ— æ³•è®¿é—®å…¬ç½‘ï¼‰çš„ç¯å¢ƒä¸­ï¼Œæƒ³è¦éƒ¨ç½²å¥½ä¸€ä¸ª K8s é›†ç¾¤å¹¶ä¸æ˜¯ä¸€ä»¶è½»æ¾çš„äº‹å„¿ã€‚å¸‚é¢ä¸Š K8s éƒ¨ç½²å·¥å…·ä¹Ÿå¤šä¸èƒœæ•°ï¼Œå¯¹äºç¦»çº¿éƒ¨ç½²çš„æ”¯æŒæƒ…å†µä¹Ÿå„ä¸ç›¸åŒï¼š</p><table><thead><tr><th style="text-align:left">Item</th><th style="text-align:left">Language</th><th style="text-align:left">Star</th><th style="text-align:left">Fork</th><th style="text-align:left">ç¦»çº¿éƒ¨ç½²æ”¯æŒæƒ…å†µ</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://github.com/kubernetes/kops" target="_blank" rel="noopener">kops</a></td><td style="text-align:left">Golang</td><td style="text-align:left">13.2k</td><td style="text-align:left">4.1k</td><td style="text-align:left">ä¸æ”¯æŒ</td></tr><tr><td style="text-align:left"><a href="https://github.com/kubernetes-sigs/kubespray" target="_blank" rel="noopener">kubespray</a></td><td style="text-align:left">Ansible</td><td style="text-align:left">11.1k</td><td style="text-align:left">4.7k</td><td style="text-align:left">æ”¯æŒï¼Œéœ€è‡ªè¡Œæ„å»ºå®‰è£…åŒ…</td></tr><tr><td style="text-align:left"><a href="https://github.com/easzlab/kubeasz" target="_blank" rel="noopener">kubeasz</a></td><td style="text-align:left">Ansible</td><td style="text-align:left">7.2k</td><td style="text-align:left">2.7k</td><td style="text-align:left">æ”¯æŒï¼Œéœ€è‡ªè¡Œæ„å»ºå®‰è£…åŒ…</td></tr><tr><td style="text-align:left"><a href="https://github.com/fanux/sealos" target="_blank" rel="noopener">sealos</a></td><td style="text-align:left">Golang</td><td style="text-align:left">4.1k</td><td style="text-align:left">790</td><td style="text-align:left">æ”¯æŒï¼Œéœ€ä»˜è´¹å……å€¼ä¼šå‘˜</td></tr><tr><td style="text-align:left"><a href="https://github.com/rancher/rke" target="_blank" rel="noopener">RKE</a></td><td style="text-align:left">Golang</td><td style="text-align:left">2.5k</td><td style="text-align:left">480</td><td style="text-align:left">ä¸æ”¯æŒï¼Œéœ€è‡ªè¡Œå®‰è£… docker</td></tr><tr><td style="text-align:left"><a href="https://github.com/alibaba/sealer" target="_blank" rel="noopener">sealer</a></td><td style="text-align:left">Golang</td><td style="text-align:left">503</td><td style="text-align:left">112</td><td style="text-align:left">æ”¯æŒï¼Œæºè‡ª <a href="https://github.com/fanux/sealos" target="_blank" rel="noopener">sealos</a></td></tr><tr><td style="text-align:left"><a href="https://github.com/kubesphere/kubekey" target="_blank" rel="noopener">kubekey</a></td><td style="text-align:left">Golang</td><td style="text-align:left">471</td><td style="text-align:left">155</td><td style="text-align:left">éƒ¨åˆ†æ”¯æŒï¼Œä»…é•œåƒå¯ç¦»çº¿</td></tr></tbody></table><p>æ— ç½‘ç¯å¢ƒç¦»çº¿éƒ¨ç½² K8s å¾€å¾€æ˜¯ä½œä¸ºä¸€ä¸ªå•†ä¸šæœåŠ¡æˆ–è€…å•†ä¸šä»˜è´¹äº§å“æ¥å‡ºå”®ï¼ˆå¦‚ <a href="https://www.sealyun.com/" target="_blank" rel="noopener">sealos</a> ï¼‰ï¼Œå¾ˆå°‘æœ‰å¼€æºå…è´¹çš„è§£å†³æ–¹æ¡ˆï¼›æˆ–è€…è™½ç„¶æä¾›äº†ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆï¼Œä½†æƒ³è¦æ“ä½œèµ·æ¥ååˆ†ç¹çï¼Œå¾ˆéš¾é¡ºç•…åœ°åšåˆ°ä¸€é”®éƒ¨ç½²ï¼›åˆæˆ–è€…åªæ”¯æŒéƒ¨åˆ†ç¦»çº¿éƒ¨ç½²ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†èµ„æºéœ€è¦åœ¨éƒ¨ç½²çš„æ—¶å€™é€šè¿‡å…¬ç½‘è·å–ã€‚</p><p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæœ¬æ–‡è°ƒç ”ä¸»æµçš„ K8s éƒ¨ç½²å·¥å…·ï¼Œå¹¶åŸºäºè¿™äº›å·¥å…·è®¾è®¡å¹¶å®ç°ä¸€ç§ä»æ„å»ºç¦»çº¿å®‰è£…åŒ…åˆ°ä¸€é”®éƒ¨ç½² K8s é›†ç¾¤å…¨æµç¨‹çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥æ»¡è¶³åœ¨æ— ç½‘çš„ç¯å¢ƒä¸­ä¸€é”®éƒ¨ç½² K8s é›†ç¾¤çš„éœ€æ±‚ï¼Œæ¯”è¾ƒé€‚åˆåŸºäº K8s çš„ PaaS toB äº§å“ä½¿ç”¨ã€‚</p><a id="more"></a><h2><span id="ç¦»çº¿èµ„æº">ç¦»çº¿èµ„æº</span></h2><p>æ€»ä½“æ¥è®²éƒ¨ç½²ä¸€ä¸ª K8s é›†ç¾¤å¤§è‡´éœ€è¦ä¾èµ–å¦‚ä¸‹ä¸‰ç§èµ„æºï¼š</p><ul><li>ç³»ç»Ÿ OS çš„ rpm/deb åŒ…ï¼šå¦‚ docker-ceã€containerdã€ipvsadmã€conntrack ç­‰ï¼›</li><li>äºŒè¿›åˆ¶æ–‡ä»¶ï¼šå¦‚ kubeletã€kubectlã€kubeadmã€crictl ç­‰ï¼›</li><li>ç»„ä»¶å®¹å™¨é•œåƒï¼šå¦‚ kube-apiserverã€kube-proxyã€corednsã€calicoã€flannel ç­‰ï¼›</li></ul><h3><span id="os-packages">OS packages</span></h3><p>è¿™ç±»å±äº OS ç³»ç»Ÿå±‚é¢çš„ä¾èµ–ï¼Œæ ¹æ®ä¸åŒç³»ç»Ÿæˆ–è€…æ”¯æŒçš„åŠŸèƒ½éœ€è¦ä½¿ç”¨ç›¸åº”çš„åŒ…ç®¡ç†å™¨å®‰è£…ç›¸åº”çš„ä¾èµ–åŒ…ï¼Œå¤§è‡´åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>kubernetes ç»„ä»¶ä¾èµ–</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- conntrack           # kube-proxy ä¾èµ–</span><br><span class="line">- ipset               # kube-proxy ä½¿ç”¨ ipvs æ¨¡å¼éœ€è¦</span><br><span class="line">- ipvsadm             # kube-proxy ä½¿ç”¨ ipvs æ¨¡å¼éœ€è¦</span><br><span class="line">- socat               # ç”¨äº port forwarding</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/implementation-details/" target="_blank" rel="noopener">Implementation details</a>:</p><p>[Error] if conntrack, ip, iptables, mount, nsenter commands are not present in the command path<br>[warning] if ebtables, ethtool, socat, tc, touch, crictl commands are not present in the command path</p></blockquote><ul><li>éƒ¨ç½²ä¾èµ–</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- ebtables            # kubeadm ä¾èµ–å·¥å…·</span><br><span class="line">- ethtool             # kubeadm ä¾èµ–å·¥å…·</span><br><span class="line">- chrony              # æ—¶é’ŸåŒæ­¥å·¥å…·ï¼Œéƒ¨ç½²å‰èŠ‚ç‚¹çš„æ—¶å€™å¿…é¡»ä¸€è‡´ï¼Œä¸ç„¶è¯ä¹¦æˆ–è€… CNI æ’ä»¶ä¼šå‡ºç°é—®é¢˜</span><br></pre></td></tr></table></figure><ul><li>CRI å®¹å™¨è¿è¡Œè¿è¡Œæ—¶</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- containerd.io       # å¯å•ç‹¬å®‰è£…&#x2F;docker-ce ä¾èµ–</span><br><span class="line">- docker-ce           # docker-ce</span><br><span class="line">- libseccomp          # å®‰è£… containerd éœ€è¦</span><br><span class="line">- nvidia-container-runtime # æ”¯æŒ GPU æ—¶éœ€è¦ä¾èµ–</span><br></pre></td></tr></table></figure><ul><li>å­˜å‚¨å®¢æˆ·ç«¯ä¾èµ–</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- nfs-utils&#x2F;nfs-common # åˆ›å»ºåŸºäº nfs çš„ PV éœ€è¦</span><br><span class="line">- ceph-common          # ceph å®¢æˆ·ç«¯å®‰è£…åŒ…ï¼Œåˆ›å»ºåŸºäº ceph çš„ pv éœ€è¦</span><br><span class="line">- lvm2                 # åˆ›å»ºåŸºäº ceph çš„ pv éœ€è¦</span><br><span class="line">- glusterfs-client     # åˆ›å»ºåŸºäº glusterfs çš„ pv éœ€è¦</span><br><span class="line">- glusterfs-common     # åˆ›å»ºåŸºäº glusterfs çš„ pv éœ€è¦</span><br><span class="line">- cifs-utils           # åˆ›å»ºåŸºäº cifs çš„ pv éœ€è¦</span><br><span class="line">- fuse                 # ceph æˆ–è€…å…¶ä»–å­˜å‚¨å®¢æˆ·ç«¯ä¾èµ–</span><br></pre></td></tr></table></figure><p>æƒ³è¦è§£å†³ä¸Šé¢è¿™äº›ä¾èµ–é¡¹ååˆ†æ£˜æ‰‹ï¼Œä¹Ÿæ˜¯ç¦»çº¿éƒ¨ç½²åœºæ™¯ä¸‹æœ€éš¾çš„ä¸€éƒ¨åˆ†ï¼Œè‡³ä»Šå¹¶æ²¡æœ‰ä¸€ä¸ªæˆç†Ÿçš„æ–¹æ¡ˆå®ç°è¿™äº›ä¾èµ–çš„ç¦»çº¿éƒ¨ç½²ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„ k8s éƒ¨ç½²å·¥å…·éƒ½æ²¡æœ‰æä¾›è¿™äº›åŒ…çš„ç¦»çº¿å®‰è£…æ–¹å¼ã€‚å¯¹äºè¿™äº›åŒ…çš„ä¾èµ–ï¼Œç›®å‰ä¸»è¦æœ‰é¿å…å®‰è£…è¿™äº›ä¾èµ–å’Œåˆ¶ä½œç¦»çº¿æºè¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚</p><h4><span id="sealos">sealos</span></h4><p>åœ¨ <a href="https://github.com/fanux/sealos" target="_blank" rel="noopener">sealos</a> ä¸­å°±æåŠ›é¿å…ä½¿ç”¨åŒ…ç®¡ç†å™¨æ¥å®‰è£…ä¾èµ–ï¼Œæ¯”å¦‚å®‰è£… containerd æ—¶çš„ä¾èµ– libseccomp ä½¿ç”¨çš„æ˜¯ç¼–è¯‘å¥½çš„ .so æ–‡ä»¶çš„æ–¹å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tar -tf kube1.20.0.tar.gz</span><br><span class="line">kube&#x2F;</span><br><span class="line">kube&#x2F;lib64&#x2F;</span><br><span class="line">kube&#x2F;lib64&#x2F;README.md</span><br><span class="line">kube&#x2F;lib64&#x2F;libseccomp.so.2</span><br><span class="line">kube&#x2F;lib64&#x2F;libseccomp.so.2.3.1</span><br></pre></td></tr></table></figure><p>å®‰è£… docker ä½¿ç”¨çš„äºŒè¿›åˆ¶çš„æ–¹å¼ï¼Œä½† docker å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿæ˜ç¡®è¯´æ˜<strong>ä¸å»ºè®®ä½¿ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å®‰è£… docker</strong>ï¼Œåº”è¯¥ä½¿ç”¨å‘è¡Œç‰ˆè‡ªå¸¦çš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…ã€‚</p><blockquote><p>If you want to try Docker or use it in a testing environment, but youâ€™re not on a supported platform, you can try installing from static binaries. <strong>If possible, you should use packages built for your operating system</strong>, and use your operating systemâ€™s package management system to manage Docker installation and upgrades.</p><p><a href="https://docs.docker.com/engine/install/binaries/" target="_blank" rel="noopener">Install Docker Engine from binaries</a></p></blockquote><p>å®é™…ä¸Šä»»ä½•éƒ¨ç½²å·¥å…·éƒ½ä¼šå¯¹ç³»ç»Ÿ rpm/deb åŒ…éƒ½ä¼šæœ‰ä¸åŒç¨‹åº¦ä¸Šçš„ä¾èµ–ï¼Œæœ‰ä¸€éƒ¨åˆ†ä¾èµ–å¯ä»¥åƒ <a href="https://github.com/fanux/sealos" target="_blank" rel="noopener">sealos</a> è¿™æ ·é€šè¿‡æŸç§æ–¹å¼å»è§„é¿æ‰ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¾èµ–éƒ½èƒ½è§„é¿çš„ï¼Œæ¯”å¦‚æä¾›æŒ‚è½½ PV éœ€è¦ä¾èµ–çš„å­˜å‚¨å®¢æˆ·ç«¯ï¼ˆnfs-common/nfs-utilsï¼Œlvm2ï¼Œgluster-clientï¼‰è¿™äº›åŒ…ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰ä»»ä½•è§„é¿çš„é€”å¾„ï¼Œå¿…é¡»é€šè¿‡åŒ…ç®¡ç†å™¨æ¥å®‰è£…æ‰è¡Œã€‚</p><p>å½“ç„¶å¦‚æœè¿™äº›å‰ç½®çš„ä¾èµ–é¡¹åœ¨éƒ¨ç½²å·¥å…·ä¹‹å¤–æ‰‹åŠ¨è§£å†³æˆ–è€…è®©ç”¨æˆ·è‡ªè¡Œå»è§£å†³ï¼Œé‚£ä¹ˆä½¿ç”¨ <a href="https://github.com/fanux/sealos" target="_blank" rel="noopener">sealos</a> è¿™ç§è½»é‡çº§çš„å·¥å…·æ¥éƒ¨ç½² K8s æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚ä½†å¯¹äºä¸€äº› PaaS toB çš„äº§å“è€Œè¨€ï¼Œè®©ç”¨æˆ·è‡ªå·±å»æ‰‹åŠ¨è§£å†³è¿™äº›ä¾èµ–ææ€•ä¸å¤ªå¥½ã€‚ç«™åœ¨å®¢æˆ·çš„è§’åº¦æ¥è€ƒè™‘æ—¢ç„¶å¹³å°æä¾›äº†è¿™éƒ¨åˆ†åŠŸèƒ½ï¼Œå°±åº”è¯¥åœ¨éƒ¨ç½²çš„æ—¶å€™è§£å†³æ‰€æœ‰çš„ä¾èµ–é—®é¢˜ï¼Œè€Œä¸æ˜¯è®©æˆ‘è‡ªå·±æ‰‹åŠ¨ä¸´æ—¶æ¥è§£å†³ã€‚</p><h4><span id="kubekey">kubekey</span></h4><p>åœ¨ kubekey ä¸­ä¸€äº›ä¾èµ–é¡¹ç›®åˆ™æ˜¯è¦æ±‚ç”¨æˆ·è‡ªè¡Œå®‰è£…ï¼Œå¹¶æ²¡æœ‰æä¾›ç¦»çº¿å®‰è£…çš„æ–¹å¼ï¼š</p><blockquote><ul><li>å»ºè®®æ‚¨ä½¿ç”¨å¹²å‡€çš„æ“ä½œç³»ç»Ÿï¼ˆä¸å®‰è£…ä»»ä½•å…¶ä»–è½¯ä»¶ï¼‰ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰å†²çªã€‚</li><li>è¯·ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹çš„ç¡¬ç›˜è‡³å°‘æœ‰ <strong>100G</strong>ã€‚</li><li>æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»éƒ½èƒ½é€šè¿‡ <code>SSH</code> è®¿é—®ã€‚</li><li>æ‰€æœ‰èŠ‚ç‚¹æ—¶é—´åŒæ­¥ã€‚</li><li>æ‰€æœ‰èŠ‚ç‚¹éƒ½åº”ä½¿ç”¨ <code>sudo</code>/<code>curl</code>/<code>openssl</code>ã€‚</li></ul><p>KubeKey èƒ½å¤ŸåŒæ—¶å®‰è£… Kubernetes å’Œ KubeSphereã€‚æ ¹æ®è¦å®‰è£…çš„ Kubernetes ç‰ˆæœ¬ï¼Œéœ€è¦å®‰è£…çš„ä¾èµ–é¡¹å¯èƒ½ä¼šä¸åŒã€‚æ‚¨å¯ä»¥å‚è€ƒä¸‹æ–¹åˆ—è¡¨ï¼ŒæŸ¥çœ‹æ˜¯å¦éœ€è¦æå‰åœ¨æ‚¨çš„èŠ‚ç‚¹ä¸Šå®‰è£…ç›¸å…³ä¾èµ–é¡¹ã€‚</p><table><thead><tr><th style="text-align:left">ä¾èµ–é¡¹</th><th style="text-align:left">Kubernetes ç‰ˆæœ¬ â‰¥ 1.18</th><th style="text-align:left">Kubernetes ç‰ˆæœ¬ &lt; 1.18</th></tr></thead><tbody><tr><td style="text-align:left"><code>socat</code></td><td style="text-align:left">å¿…é¡»</td><td style="text-align:left">å¯é€‰ä½†å»ºè®®</td></tr><tr><td style="text-align:left"><code>conntrack</code></td><td style="text-align:left">å¿…é¡»</td><td style="text-align:left">å¯é€‰ä½†å»ºè®®</td></tr><tr><td style="text-align:left"><code>ebtables</code></td><td style="text-align:left">å¯é€‰ä½†å»ºè®®</td><td style="text-align:left">å¯é€‰ä½†å»ºè®®</td></tr><tr><td style="text-align:left"><code>ipset</code></td><td style="text-align:left">å¯é€‰ä½†å»ºè®®</td><td style="text-align:left">å¯é€‰ä½†å»ºè®®</td></tr></tbody></table><p>å¤‡æ³¨</p><ul><li>åœ¨ç¦»çº¿ç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç§æœ‰åŒ…ã€RPM åŒ…ï¼ˆé€‚ç”¨äº CentOSï¼‰æˆ–è€… Deb åŒ…ï¼ˆé€‚ç”¨äº Debianï¼‰æ¥å®‰è£…è¿™äº›ä¾èµ–é¡¹ã€‚</li><li>å»ºè®®æ‚¨äº‹å…ˆåˆ›å»ºä¸€ä¸ªæ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶ï¼Œå¹¶ä¸”å®‰è£…å¥½æ‰€æœ‰ç›¸å…³ä¾èµ–é¡¹ã€‚è¿™æ ·ï¼Œæ‚¨ä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥é•œåƒæ–‡ä»¶åœ¨æ¯å°æœºå™¨ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿï¼Œæé«˜éƒ¨ç½²æ•ˆç‡ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒä»»ä½•ä¾èµ–é¡¹é—®é¢˜ã€‚</li></ul><p>æ‚¨çš„é›†ç¾¤å¿…é¡»æœ‰ä¸€ä¸ªå¯ç”¨çš„å®¹å™¨è¿è¡Œæ—¶ã€‚åœ¨ç¦»çº¿ç¯å¢ƒä¸­åˆ›å»ºé›†ç¾¤ä¹‹å‰ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨å®‰è£… Docker æˆ–å…¶ä»–å®¹å™¨è¿è¡Œæ—¶ã€‚</p><p><a href="https://github.com/kubesphere/kubekey#requirements-and-recommendations" target="_blank" rel="noopener">Requirements and Recommendations</a></p></blockquote><h4><span id="æ„å»ºç¦»çº¿æº">æ„å»ºç¦»çº¿æº</span></h4><p>å¯¹äºç³»ç»Ÿ rpm/deb åŒ…çš„ä¾èµ–ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¸è¸å®å®åœ°ä½¿ç”¨åŒ…ç®¡ç†å™¨æ¥å®‰è£…è¿™äº›åŒ…è¾ƒä¸ºå¦¥å½“ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¿…è¦ä¸ºè¿™äº›ä¾èµ–çš„ rpm/deb åŒ…æ„å»ºæˆç¦»çº¿æºï¼Œéƒ¨ç½²çš„æ—¶å€™ä½¿ç”¨è¿™ä¸ªç¦»çº¿æºæ¥å®‰è£…è¿™äº›ä¾èµ–ã€‚åœ¨ ã€Š<a href="https://blog.k8s.li/make-offline-mirrors.html" target="_blank" rel="noopener">ä½¿ç”¨ docker build åˆ¶ä½œ yum/apt ç¦»çº¿æº</a>ã€‹ä¸€æ–‡ä¸­æ›¾åˆ†æè¿‡åˆ¶ä½œå’Œä½¿ç”¨ç¦»çº¿æºè¿™ä¹ˆéš¾çš„åŸå› ï¼š</p><blockquote><p>ä½œä¸ºå¹³å°éƒ¨ç½²å·¥å…·çš„å¼€å‘è€…ï¼Œå§‹ç»ˆè¢«ç¦»çº¿éƒ¨ç½²è¿™ä¸ªéš¾é¢˜å›°æ‰°ç€ã€‚åœ¨çº¿çš„å®¹å™¨é•œåƒå’ŒäºŒè¿›åˆ¶æ–‡ä»¶æ¯”è¾ƒå¥½è§£å†³ï¼Œå› ä¸ºè¿™äº›èµ„æºæ˜¯ä¸ OS æ— å…³çš„ï¼Œåªè¦ä¸‹è½½ä¸‹æ¥æ”¾åˆ°å®‰è£…åŒ…é‡Œï¼Œéƒ¨ç½²çš„æ—¶å€™å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨å’Œé•œåƒä»“åº“æœåŠ¡æä¾›è¿™äº›èµ„æºçš„ä¸‹è½½å³å¯ã€‚</p><p>ä½†æ˜¯å¯¹äº yum/apt ä¹‹ç±»çš„è½¯ä»¶æ¥è®²å¹¶ä¸é‚£ä¹ˆç®€å•ï¼š</p><ul><li>é¦–å…ˆç”±äºå„ä¸ªåŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸èƒ½å°†å®ƒä»¬ç›´æ¥ä¸‹è½½ä¸‹æ¥ï¼›</li><li>å…¶æ¬¡å³ä¾¿ä¸‹è½½ä¸‹æ¥ä¹‹åä¹Ÿæ— æ³•ç›´æ¥é€šè¿‡ yum/apt çš„æ–¹å¼å®‰è£…æŒ‡å®šçš„è½¯ä»¶åŒ…ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ scp çš„æ–¹å¼å°†è¿™äº›åŒ…å¤åˆ¶åˆ°éƒ¨ç½²èŠ‚ç‚¹ï¼Œé€šè¿‡ rpm æˆ– dpkg çš„æ–¹å¼æ¥å®‰è£…ä¸Šï¼Œä½†è¿™æ ·å¹¶ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œè€Œä¸”é€šç”¨æ€§èƒ½ä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼›</li><li>æœ€åéœ€è¦é€‚é…çš„ Linux å‘è¡Œç‰ˆå’ŒåŒ…ç®¡ç†å™¨ç§ç±»ä¹Ÿæœ‰å¤šç§ï¼Œè€Œä¸”æœ‰äº›åŒ…çš„åŒ…åæˆ–è€…ç‰ˆæœ¬å·åœ¨ä¸åŒçš„åŒ…ç®¡ç†ä¹‹é—´ä¹Ÿç›¸å·®ç”šå¤§ï¼Œæ— æ³•åšåˆ°ç»Ÿä¸€ç®¡ç†ã€‚</li><li>ç¦»çº¿æºåŒæ—¶é€‚é…é€‚é… ARM64 å’Œ AMD64 æœ‰ä¸€å®šçš„éš¾åº¦</li></ul></blockquote><p>å¥½åœ¨æ–‡ä¸­ä¹Ÿç»™å‡ºäº†ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå³é€šè¿‡ Dockerfile æ¥æ„å»ºç¦»çº¿æºï¼Œå…·ä½“çš„å®ç°ç»†èŠ‚å¯ä»¥ç¿»çœ‹ã€Š<a href="https://blog.k8s.li/make-offline-mirrors.html" target="_blank" rel="noopener">ä½¿ç”¨ docker build åˆ¶ä½œ yum/apt ç¦»çº¿æº</a>ã€‹ä¸€æ–‡ã€‚ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥è§£å†³ PaaS æˆ–è€… IaaS å±‚é¢çš„ç¦»çº¿æºåˆ¶ä½œçš„éš¾é¢˜ï¼ŒåŒæ ·ä¹Ÿé€‚ç”¨äºæˆ‘ä»¬éƒ¨ç½² K8s é›†ç¾¤çš„åœºæ™¯ï¼Œè€Œä¸”é‡‡ç”¨ Dockerfile çš„æ–¹å¼æ¥æ„å»ºç¦»çº¿æºå¯ä»¥å®Œç¾åœ°è§£å†³åŒæ—¶é€‚é… arm64 å’Œ amd64 çš„éš¾é¢˜ã€‚</p><h3><span id="files">files</span></h3><p>ä¸€äº›éƒ¨ç½²è¿‡ç¨‹ä¸­éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- kubelet</span><br><span class="line">- kubeadm</span><br><span class="line">- kubectl</span><br><span class="line">- etcd            # systemd æ–¹å¼éƒ¨ç½² etcd æ—¶éœ€è¦çš„å®‰è£…åŒ…</span><br><span class="line">- crictl          # k8s å®˜æ–¹çš„ CRI CLI å·¥å…·</span><br><span class="line">- calicoctl       # calico çš„ CLI å·¥å…·</span><br><span class="line">- helm            # å®‰è£… helm éœ€è¦çš„äºŒè¿›åˆ¶å®‰è£…åŒ…</span><br><span class="line">- nerdctl         # containerd çš„ CLI å·¥å…·</span><br><span class="line">- cni-plugins     # CNI æ’ä»¶</span><br><span class="line">- cuda            # GPU ä¾èµ–</span><br><span class="line">- nvidia_driver   # GPU é©±åŠ¨</span><br></pre></td></tr></table></figure><h4><span id="sealos">sealos</span></h4><p>sealos å¯¹äºŒè¿›åˆ¶æ–‡ä»¶çš„å¤„ç†æ¯”è¾ƒå¥½ï¼Œå…¨éƒ¨æ‰“åŒ…åœ¨ç¦»çº¿å®‰è£…åŒ…é‡Œï¼Œéƒ¨ç½²çš„æ—¶å€™ä¼šåˆ†å‘åˆ°é›†ç¾¤èŠ‚ç‚¹ä¸Šï¼Œæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹éƒ½æ— éœ€è®¿é—®å…¬ç½‘ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tar -tf kube1.20.0.tar.gz</span><br><span class="line">kube&#x2F;bin&#x2F;kubelet</span><br><span class="line">kube&#x2F;bin&#x2F;kubectl</span><br><span class="line">kube&#x2F;bin&#x2F;conntrack</span><br><span class="line">kube&#x2F;bin&#x2F;kubeadm</span><br></pre></td></tr></table></figure><h4><span id="kubekey">kubekey</span></h4><p>åœ¨ kubekey çš„æºç å½“ä¸­ï¼Œæ˜¯å°†æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶çš„ URL ç¡¬ç¼–ç åœ¨ä»£ç å½“ä¸­çš„ã€‚å¦‚æœåœ¨éƒ¨ç½²çš„æ—¶å€™éœ€è¦æ ¹æ®éƒ¨ç½²ç¯å¢ƒæ¥ä¿®æ”¹äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸‹è½½åœ°å€ï¼Œæ¯”å¦‚ä»å†…ç½‘ nginx æœåŠ¡å™¨ä¸Šä¸‹è½½ï¼Œå°±éœ€è¦ä¿®æ”¹è¿™éƒ¨åˆ†æºç æŠŠ <code>https://kubernetes-release.pek3b.qingstor.com</code> ä¿®æ”¹æˆå†…ç½‘åœ°å€ï¼Œæ¯”å¦‚ <code>http://172.20.0.25:8080/files</code> ï¼Œç„¶è€Œåœ¨éƒ¨ç½²çš„æ—¶å€™é‡æ–°ç¼–è¯‘ kubekey çš„ä»£ç åˆå¿…é¡»èƒ½è®¿é—®å…¬ç½‘æ‰è¡Œï¼Œè¿™å°±å¾ˆåƒµç¡¬ã€‚æ‰€ä»¥ä»¥ç›®å‰å¼€æºçš„ kubekey æ¥çœ‹ï¼Œæ˜¯æ²¡æœ‰åŠæ³•åšåˆ°æ— ç½‘ç¯å¢ƒä¸­æ„‰å¿«åœ°éƒ¨ç½² k8s çš„ï¼Œå¯èƒ½å•†ä¸šç‰ˆä¼šæ”¯æŒï¼ˆçŒœæµ‹ï¼‰ã€‚</p><ul><li><a href="https://github.com/kubesphere/kubekey/blob/master/pkg/kubernetes/preinstall/preinstall.go" target="_blank" rel="noopener">kubekey/blob/master/pkg/kubernetes/preinstall/preinstall.go</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; FilesDownloadHTTP defines the kubernetes&#39; binaries that need to be downloaded in advance and downloads them.</span><br><span class="line">func FilesDownloadHTTP(mgr *manager.Manager, filepath, version, arch string) error &#123;</span><br><span class="line">kkzone :&#x3D; os.Getenv(&quot;KKZONE&quot;)</span><br><span class="line">etcd :&#x3D; files.KubeBinary&#123;Name: &quot;etcd&quot;, Arch: arch, Version: kubekeyapiv1alpha1.DefaultEtcdVersion&#125;</span><br><span class="line">kubeadm :&#x3D; files.KubeBinary&#123;Name: &quot;kubeadm&quot;, Arch: arch, Version: version&#125;</span><br><span class="line">kubelet :&#x3D; files.KubeBinary&#123;Name: &quot;kubelet&quot;, Arch: arch, Version: version&#125;</span><br><span class="line">kubectl :&#x3D; files.KubeBinary&#123;Name: &quot;kubectl&quot;, Arch: arch, Version: version&#125;</span><br><span class="line">kubecni :&#x3D; files.KubeBinary&#123;Name: &quot;kubecni&quot;, Arch: arch, Version: kubekeyapiv1alpha1.DefaultCniVersion&#125;</span><br><span class="line">helm :&#x3D; files.KubeBinary&#123;Name: &quot;helm&quot;, Arch: arch, Version: kubekeyapiv1alpha1.DefaultHelmVersion&#125;</span><br><span class="line"></span><br><span class="line">etcd.Path &#x3D; fmt.Sprintf(&quot;%s&#x2F;etcd-%s-linux-%s.tar.gz&quot;, filepath, kubekeyapiv1alpha1.DefaultEtcdVersion, arch)</span><br><span class="line">kubeadm.Path &#x3D; fmt.Sprintf(&quot;%s&#x2F;kubeadm&quot;, filepath)</span><br><span class="line">kubelet.Path &#x3D; fmt.Sprintf(&quot;%s&#x2F;kubelet&quot;, filepath)</span><br><span class="line">kubectl.Path &#x3D; fmt.Sprintf(&quot;%s&#x2F;kubectl&quot;, filepath)</span><br><span class="line">kubecni.Path &#x3D; fmt.Sprintf(&quot;%s&#x2F;cni-plugins-linux-%s-%s.tgz&quot;, filepath, arch, kubekeyapiv1alpha1.DefaultCniVersion)</span><br><span class="line">helm.Path &#x3D; fmt.Sprintf(&quot;%s&#x2F;helm&quot;, filepath)</span><br><span class="line"></span><br><span class="line">if kkzone &#x3D;&#x3D; &quot;cn&quot; &#123;</span><br><span class="line">etcd.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;kubernetes-release.pek3b.qingstor.com&#x2F;etcd&#x2F;release&#x2F;download&#x2F;%s&#x2F;etcd-%s-linux-%s.tar.gz&quot;, etcd.Version, etcd.Version, etcd.Arch)</span><br><span class="line">kubeadm.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;kubernetes-release.pek3b.qingstor.com&#x2F;release&#x2F;%s&#x2F;bin&#x2F;linux&#x2F;%s&#x2F;kubeadm&quot;, kubeadm.Version, kubeadm.Arch)</span><br><span class="line">kubelet.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;kubernetes-release.pek3b.qingstor.com&#x2F;release&#x2F;%s&#x2F;bin&#x2F;linux&#x2F;%s&#x2F;kubelet&quot;, kubelet.Version, kubelet.Arch)</span><br><span class="line">kubectl.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;kubernetes-release.pek3b.qingstor.com&#x2F;release&#x2F;%s&#x2F;bin&#x2F;linux&#x2F;%s&#x2F;kubectl&quot;, kubectl.Version, kubectl.Arch)</span><br><span class="line">kubecni.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;containernetworking.pek3b.qingstor.com&#x2F;plugins&#x2F;releases&#x2F;download&#x2F;%s&#x2F;cni-plugins-linux-%s-%s.tgz&quot;, kubecni.Version, kubecni.Arch, kubecni.Version)</span><br><span class="line">helm.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;kubernetes-helm.pek3b.qingstor.com&#x2F;linux-%s&#x2F;%s&#x2F;helm&quot;, helm.Arch, helm.Version)</span><br><span class="line">helm.GetCmd &#x3D; mgr.DownloadCommand(helm.Path, helm.Url)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">etcd.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;github.com&#x2F;coreos&#x2F;etcd&#x2F;releases&#x2F;download&#x2F;%s&#x2F;etcd-%s-linux-%s.tar.gz&quot;, etcd.Version, etcd.Version, etcd.Arch)</span><br><span class="line">kubeadm.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;%s&#x2F;bin&#x2F;linux&#x2F;%s&#x2F;kubeadm&quot;, kubeadm.Version, kubeadm.Arch)</span><br><span class="line">kubelet.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;%s&#x2F;bin&#x2F;linux&#x2F;%s&#x2F;kubelet&quot;, kubelet.Version, kubelet.Arch)</span><br><span class="line">kubectl.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;%s&#x2F;bin&#x2F;linux&#x2F;%s&#x2F;kubectl&quot;, kubectl.Version, kubectl.Arch)</span><br><span class="line">kubecni.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;github.com&#x2F;containernetworking&#x2F;plugins&#x2F;releases&#x2F;download&#x2F;%s&#x2F;cni-plugins-linux-%s-%s.tgz&quot;, kubecni.Version, kubecni.Arch, kubecni.Version)</span><br><span class="line">helm.Url &#x3D; fmt.Sprintf(&quot;https:&#x2F;&#x2F;get.helm.sh&#x2F;helm-%s-linux-%s.tar.gz&quot;, helm.Version, helm.Arch)</span><br><span class="line">getCmd :&#x3D; mgr.DownloadCommand(fmt.Sprintf(&quot;%s&#x2F;helm-%s-linux-%s.tar.gz&quot;, filepath, helm.Version, helm.Arch), helm.Url)</span><br><span class="line">helm.GetCmd &#x3D; fmt.Sprintf(&quot;%s &amp;&amp; cd %s &amp;&amp; tar -zxf helm-%s-linux-%s.tar.gz &amp;&amp; mv linux-%s&#x2F;helm . &amp;&amp; rm -rf *linux-%s*&quot;, getCmd, filepath, helm.Version, helm.Arch, helm.Arch, helm.Arch)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤– kubekey åœ¨å®‰è£… docker æ—¶ï¼Œæ˜¯ç›´æ¥è°ƒç”¨çš„ <a href="https://get.docker.com/" target="_blank" rel="noopener">docker å®˜æ–¹çš„è„šæœ¬</a> æ¥å®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹ä¹Ÿå¿…é¡»è®¿é—®å…¬ç½‘æ‰è¡Œã€‚</p><ul><li><a href="https://github.com/kubesphere/kubekey/blob/master/pkg/container-engine/docker/docker.go" target="_blank" rel="noopener">kubekey/blob/master/pkg/container-engine/docker/docker.go</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func installDockerOnNode(mgr *manager.Manager, _ *kubekeyapiv1alpha1.HostCfg) error &#123;</span><br><span class="line">dockerConfig, err :&#x3D; GenerateDockerConfig(mgr)</span><br><span class="line">if err !&#x3D; nil &#123;</span><br><span class="line">return err</span><br><span class="line">&#125;</span><br><span class="line">dockerConfigBase64 :&#x3D; base64.StdEncoding.EncodeToString([]byte(dockerConfig))</span><br><span class="line">output, err1 :&#x3D; mgr.Runner.ExecuteCmd(fmt.Sprintf(&quot;sudo -E &#x2F;bin&#x2F;sh -c \&quot;if [ -z $(which docker) ] || [ ! -e &#x2F;var&#x2F;run&#x2F;docker.sock ]; then curl https:&#x2F;&#x2F;kubernetes.pek3b.qingstor.com&#x2F;tools&#x2F;kubekey&#x2F;docker-install.sh | sh &amp;&amp; systemctl enable docker; if [ ! -f &#x2F;etc&#x2F;docker&#x2F;daemon.json ]; then mkdir -p &#x2F;etc&#x2F;docker &amp;&amp; echo %s | base64 -d &gt; &#x2F;etc&#x2F;docker&#x2F;daemon.json; fi; systemctl daemon-reload &amp;&amp; systemctl restart docker; fi\&quot;&quot;, dockerConfigBase64), 0, false)</span><br><span class="line">if err1 !&#x3D; nil &#123;</span><br><span class="line">return errors.Wrap(errors.WithStack(err1), fmt.Sprintf(&quot;Failed to install docker:\n%s&quot;, output))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ docker å®˜æ–¹çš„å®‰è£…è„šæœ¬æ¥å®‰è£… docker æ˜¯æœ‰ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜å°±æ˜¯ï¼šæ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶ï¼Œä¸èƒ½æŒ‡å®š docker çš„ç‰ˆæœ¬ï¼Œæ¯æ¬¡å®‰è£…çš„ docker ç‰ˆæœ¬éƒ½æ˜¯æœ€æ–°çš„ stable ç‰ˆæœ¬ã€‚æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶å°±ä¼šå¯¼è‡´ä¸åŒæ—¶é—´éƒ¨ç½²çš„é›†ç¾¤æˆ–è€…åŠ å…¥çš„èŠ‚ç‚¹ï¼Œdocker ç‰ˆæœ¬å¯èƒ½å°±ä¸ä¸€æ ·ï¼Œåœ¨è¿™é‡Œå¯èƒ½ä¼šåŸ‹ä¸‹ä¸€äº›å‘ï¼Œå¯èƒ½ä¼šå¸¦æ¥ä¸€å®šçš„ç»´æŠ¤æˆæœ¬æˆ–è€…å°†æ¥å‡çº§æ—¶é‡åˆ°é—®é¢˜ã€‚</p><p>ç¼–è¯‘è¿‡ kubernetes ç»„ä»¶çš„å¯èƒ½éƒ½çŸ¥é“ k8s æºç å½“ä¸­å­˜åœ¨ä¸€ä¸ª <a href="https://github.com/kubernetes/kubernetes/blob/master/build/dependencies.yaml" target="_blank" rel="noopener">build/dependencies.yaml</a> çš„æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•çš„æ˜¯ k8s ç»„ä»¶ä¸å…¶ä»–ç»„ä»¶ (å¦‚ docker, etcd, coredns, cni, pause) æ‰€åŒ¹é…çš„æœ€ä½³ç‰ˆæœ¬ã€‚</p><blockquote><p>On each of your nodes, install the Docker for your Linux distribution as per <a href="https://docs.docker.com/engine/install/#server" target="_blank" rel="noopener">Install Docker Engine</a>. You can find the latest validated version of Docker in this <a href="https://git.k8s.io/kubernetes/build/dependencies.yaml" target="_blank" rel="noopener">dependencies</a> file.</p></blockquote><ul><li><a href="https://github.com/kubernetes/kubernetes/blob/release-1.20/build/dependencies.yaml" target="_blank" rel="noopener">kubernetes/blob/release-1.20/build/dependencies.yaml</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  # zeitgeist (https:&#x2F;&#x2F;github.com&#x2F;kubernetes-sigs&#x2F;zeitgeist) was inspired by</span><br><span class="line">  # (and now replaces) the cmd&#x2F;verifydependencies tool to verify external</span><br><span class="line">  # dependencies across the repo.</span><br><span class="line">  #</span><br><span class="line">  # The zeitgeist dependencies.yaml file format is intended to be</span><br><span class="line">  # backwards-compatible with the original tooling.</span><br><span class="line">  #</span><br><span class="line">  # In instances where the file format may change across versions, this meta</span><br><span class="line">  # dependency check exists to ensure we&#39;re pinned to a known good version.</span><br><span class="line">  #</span><br><span class="line">  # ref: https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;kubernetes&#x2F;pull&#x2F;98845</span><br><span class="line"></span><br><span class="line">  # Docker</span><br><span class="line">  - name: &quot;docker&quot;</span><br><span class="line">    version: 19.03</span><br><span class="line">    refPaths:</span><br><span class="line">    - path: vendor&#x2F;k8s.io&#x2F;system-validators&#x2F;validators&#x2F;docker_validator.go</span><br><span class="line">      match: latestValidatedDockerVersion</span><br></pre></td></tr></table></figure><p>ä»¥ 1.20.x ç‰ˆæœ¬çš„ k8s ä¸ºä¾‹ï¼Œå®ƒæ‰€ä¾èµ–çš„ docker ç‰ˆæœ¬ä¸º 19.03ï¼Œè€Œç°åœ¨æœ€æ–°çš„ docker ç‰ˆæœ¬å¦‚ 20.10.8ï¼Œå¹¶ä¸æ˜¯ K8s å®˜æ–¹æ‰€å»ºè®®çš„æœ€ä½³ç‰ˆæœ¬ã€‚æ€»ä¹‹ï¼Œæˆ‘ä»¬åœ¨éƒ¨ç½² K8s æ—¶ï¼Œå¯ä»¥å‚è€ƒ <a href="https://github.com/kubernetes/kubernetes/blob/master/build/dependencies.yaml" target="_blank" rel="noopener">build/dependencies.yaml</a> æ¥ç¡®å®šä¸ K8s ç›¸å…³çš„ç»„ä»¶åº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªæœ€ä½³çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯éšä¾¿è£…ä¸€ä¸ªæœ€æ–°çš„ç‰ˆæœ¬å°±å®Œäº‹å„¿äº†ã€‚</p><h4><span id="kubespray">kubespray</span></h4><p>åœ¨ kubespray ä¸­ï¼Œæ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶çš„ URL éƒ½æ˜¯é€šè¿‡å˜é‡çš„æ–¹å¼å®šä¹‰çš„ï¼Œæƒ³è¦åšåˆ°ç¦»çº¿éƒ¨ç½²ååˆ†ç®€å•ï¼Œåªéœ€è¦é€šè¿‡ ansible å˜é‡ä¼˜å…ˆçº§çš„ç‰¹æ€§ï¼Œå°†å®ƒä»¬åœ¨ group_vars é€šè¿‡ overrides çš„æ–¹å¼è¦†ç›–å³å¯ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Download URLs</span><br><span class="line">kubelet_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;bin&#x2F;linux&#x2F;&#123;&#123; image_arch &#125;&#125;&#x2F;kubelet&quot;</span><br><span class="line">kubectl_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;bin&#x2F;linux&#x2F;&#123;&#123; image_arch &#125;&#125;&#x2F;kubectl&quot;</span><br><span class="line">kubeadm_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;bin&#x2F;linux&#x2F;&#123;&#123; image_arch &#125;&#125;&#x2F;kubeadm&quot;</span><br></pre></td></tr></table></figure><h3><span id="images">images</span></h3><p>ä¸€äº›å¦‚ kube-proxyã€kube-apiserverã€corednsã€calico ç»„ä»¶é•œåƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">k8s.gcr.io&#x2F;kube-apiserver:v1.20.7</span><br><span class="line">k8s.gcr.io&#x2F;kube-controller-manager:v1.20.7</span><br><span class="line">k8s.gcr.io&#x2F;kube-proxy:v1.20.7</span><br><span class="line">k8s.gcr.io&#x2F;kube-registry-proxy:0.4</span><br><span class="line">k8s.gcr.io&#x2F;kube-scheduler:v1.20.7</span><br><span class="line">k8s.gcr.io&#x2F;pause:3.3</span><br><span class="line">k8s.gcr.io&#x2F;coredns:1.7.0</span><br><span class="line">k8s.gcr.io&#x2F;cpa&#x2F;cluster-proportional-autoscaler-amd64:1.8.3</span><br><span class="line">k8s.gcr.io&#x2F;dns&#x2F;k8s-dns-node-cache:1.17.1</span><br></pre></td></tr></table></figure><h4><span id="sealos">sealos</span></h4><p>sealos å°†è¿™äº›é•œåƒä½¿ç”¨ docker save çš„æ–¹å¼æ‰“åŒ…æˆä¸€ä¸ª tar åŒ…ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ä½¿ç”¨ docker/ctr load çš„æ–¹å¼å°†é•œåƒå¯¼å…¥åˆ°å®¹å™¨è¿è¡Œæ—¶çš„å­˜å‚¨ç›®å½•å½“ä¸­ï¼Œæºç å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/fanux/sealos/blob/develop/install/send.go" target="_blank" rel="noopener">fanux/sealos/blob/develop/install/send.go</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SendPackage is send new pkg to all nodes.</span><br><span class="line">func (u *SealosUpgrade) SendPackage() &#123;</span><br><span class="line">all :&#x3D; append(u.Masters, u.Nodes...)</span><br><span class="line">pkg :&#x3D; path.Base(u.NewPkgUrl)</span><br><span class="line">&#x2F;&#x2F; rm old sealos in package avoid old version problem. if sealos not exist in package then skip rm</span><br><span class="line">var kubeHook string</span><br><span class="line">if For120(Version) &#123;</span><br><span class="line">&#x2F;&#x2F; TODO update need load modprobe -- br_netfilter modprobe -- bridge.</span><br><span class="line">&#x2F;&#x2F; https:&#x2F;&#x2F;github.com&#x2F;fanux&#x2F;cloud-kernel&#x2F;issues&#x2F;23</span><br><span class="line">kubeHook &#x3D; fmt.Sprintf(&quot;cd &#x2F;root &amp;&amp; rm -rf kube &amp;&amp; tar zxvf %s  &amp;&amp; cd &#x2F;root&#x2F;kube&#x2F;shell &amp;&amp; rm -f ..&#x2F;bin&#x2F;sealos &amp;&amp; (ctr -n&#x3D;k8s.io image import ..&#x2F;images&#x2F;images.tar || true) &amp;&amp; cp -f ..&#x2F;bin&#x2F;* &#x2F;usr&#x2F;bin&#x2F; &quot;, pkg)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">kubeHook &#x3D; fmt.Sprintf(&quot;cd &#x2F;root &amp;&amp; rm -rf kube &amp;&amp; tar zxvf %s  &amp;&amp; cd &#x2F;root&#x2F;kube&#x2F;shell &amp;&amp; rm -f ..&#x2F;bin&#x2F;sealos &amp;&amp; (docker load -i ..&#x2F;images&#x2F;images.tar || true) &amp;&amp; cp -f ..&#x2F;bin&#x2F;* &#x2F;usr&#x2F;bin&#x2F; &quot;, pkg)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PkgUrl &#x3D; SendPackage(pkg, all, &quot;&#x2F;root&quot;, nil, &amp;kubeHook)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ç§æ–¹å¼åŠ è½½é•œåƒæœ‰ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„é™åˆ¶å°±æ˜¯ kube-apiserver çš„ admission å‡†å…¥æ§åˆ¶ä¸­ä¸èƒ½åŠ å…¥ <code>AlwaysPullImages</code> å‚æ•°ã€‚ä¸ç„¶ä¸è¿™äº›é•œåƒç›¸å…³çš„ pod é‡æ–°è°ƒåº¦æˆ–è€…é‡å¯ä¹‹åä¼šé‡æ–°ä»æºé•œåƒä»“åº“æ‹‰å–é•œåƒï¼Œåœ¨æ— ç½‘æˆ–è€…ç½‘ç»œé™åˆ¶çš„ç¯å¢ƒä¸­å¯èƒ½æ— æ³•æ‹‰å–é•œåƒå¯¼è‡´è¿™äº› Pod å¯åŠ¨å¤±è´¥ï¼Œä»è€Œå¯¼è‡´é›†ç¾¤å¼‚å¸¸ã€‚</p><p>è€Œåœ¨å¤šç§Ÿæˆ·åœºæ™¯ä¸‹ï¼Œå‡ºäºå®‰å…¨çš„è€ƒè™‘ <code>AlwaysPullImages</code> å‡†å…¥æ§åˆ¶å¾€å¾€æ˜¯è¦å¼€å¯çš„ã€‚å› æ­¤ sealos å¯èƒ½å¹¶ä¸é€‚ç”¨äºå¤šç§Ÿæˆ·æˆ–è€…å¯¹æ­¤æœ‰è¦æ±‚çš„ç¯å¢ƒä¸­ï¼ˆæœ€å¸¸è§çš„å°±æ˜¯ PaaS å¹³å°ï¼‰ã€‚</p><blockquote><p>è¯¥å‡†å…¥æ§åˆ¶å™¨ä¼šä¿®æ”¹æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ Pod çš„é•œåƒæ‹‰å–ç­–ç•¥ä¸º Always ã€‚ è¿™åœ¨å¤šç§Ÿæˆ·é›†ç¾¤ä¸­æ˜¯æœ‰ç”¨çš„ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥æ”¾å¿ƒï¼Œä»–ä»¬çš„ç§æœ‰é•œåƒåªèƒ½è¢«é‚£äº›æœ‰å‡­è¯çš„äººä½¿ç”¨ã€‚ å¦‚æœæ²¡æœ‰è¿™ä¸ªå‡†å…¥æ§åˆ¶å™¨ï¼Œä¸€æ—¦é•œåƒè¢«æ‹‰å–åˆ°èŠ‚ç‚¹ä¸Šï¼Œä»»ä½•ç”¨æˆ·çš„ Pod éƒ½å¯ä»¥é€šè¿‡å·²äº†è§£åˆ°çš„é•œåƒçš„åç§°ï¼ˆå‡è®¾ Pod è¢«è°ƒåº¦åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šï¼‰æ¥ä½¿ç”¨å®ƒï¼Œè€Œä¸éœ€è¦å¯¹é•œåƒè¿›è¡Œä»»ä½•æˆæƒæ£€æŸ¥ã€‚ å½“å¯ç”¨è¿™ä¸ªå‡†å…¥æ§åˆ¶å™¨æ—¶ï¼Œæ€»æ˜¯åœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ‹‰å–é•œåƒï¼Œè¿™æ„å‘³ç€éœ€è¦æœ‰æ•ˆçš„å‡­è¯ã€‚</p></blockquote><h4><span id="kubekey">kubekey</span></h4><p><a href="https://kubesphere.io/docs/installing-on-linux/introduction/air-gapped-installation/" target="_blank" rel="noopener">kubekey å®˜æ–¹çš„æ–‡æ¡£</a> ä¸­æœ‰æåˆ°ç»„ä»¶é•œåƒç¦»çº¿éƒ¨ç½²çš„æ–¹å¼ï¼Œä¸è¿‡ååˆ†ç¹ç(åŠé€€ğŸ˜‚)ï¼Œåœ¨ <a href="https://github.com/kubesphere/kubekey/issues/597" target="_blank" rel="noopener">Offline installation is too troublesome #597</a> ä¸­ä¹Ÿæœ‰äººåæ§½è¿™ä¸ªé—®é¢˜ã€‚ä¸è¿‡ç›®å‰ kubekey å¼€å‘å›¢é˜Ÿå·²ç»åœ¨é‡æ„è¿™éƒ¨åˆ†å†…å®¹äº†ï¼Œè‡³äºç»“æœå¦‚ä½•ï¼Œåªèƒ½ç­‰äº†ã€‚</p><h4><span id="é•œåƒä»“åº“">é•œåƒä»“åº“</span></h4><p>åœ¨ç§æœ‰äº‘ç¯å¢ƒä¸­ï¼Œä¼ä¸šä¸€èˆ¬éƒ½ä¼šæœ‰è‡ªå·±çš„é•œåƒä»“åº“ï¼ˆæ¯”å¦‚ harbor ï¼‰ç”¨äºå­˜æ”¾ä¸šåŠ¡ç»„ä»¶é•œåƒæˆ–è€…ä¸€äº›å…¶ä»–å¹³å°ä¾èµ–çš„é•œåƒã€‚å†åŠ ä¸Š Docker Hub è‡ªä»å»å¹´å¼€å§‹å°±åŠ å…¥äº† pull é•œåƒæ¬¡æ•°çš„é™åˆ¶ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ Docker Hub ä¸Šé¢çš„é•œåƒæ¥éƒ¨ç½²é›†ç¾¤ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå› ä¸º <a href="https://www.docker.com/increase-rate-limit" target="_blank" rel="noopener">429 toomanyrequests</a> æˆ–è€…ä¸€äº›ç½‘ç»œåŸå› å¯¼è‡´æ‹‰å–é•œåƒå¤±è´¥ã€‚å› æ­¤å¯¹äº k8s é›†ç¾¤éƒ¨ç½²è€Œè¨€ï¼Œå»ºè®®ä½¿ç”¨å†…éƒ¨è‡ªå·±çš„é•œåƒä»“åº“ï¼Œè€Œéå…¬ç½‘ä¸Šé•œåƒä»“åº“ã€‚å¦‚æœæ²¡æœ‰çš„è¯å¯ä»¥ä½¿ç”¨ harbor æˆ–è€… docker registry åœ¨æœ¬åœ°éƒ¨ç½²ä¸€ä¸ªé•œåƒä»“åº“ã€‚æˆ‘ä»¬å°†éƒ¨ç½²ä¾èµ–çš„é•œåƒå¯¼å…¥åˆ°å·²ç»å­˜åœ¨çš„é•œåƒä»“åº“ä¸­ï¼Œéƒ¨ç½²çš„æ—¶å€™ä»è¯¥é•œåƒä»“åº“æ‹‰å–å³å¯ã€‚</p><h2><span id="éƒ¨ç½²å·¥å…·é€‰æ‹©">éƒ¨ç½²å·¥å…·é€‰æ‹©</span></h2><p>ä¸Šé¢ç®€å•æ¢³ç†äº†ä¸€ä¸‹éƒ¨ç½² k8s é›†ç¾¤è¿‡ç¨‹ä¸­æ‰€ä¾èµ–çš„çš„åœ¨çº¿èµ„æºï¼Œä»¥åŠå¦‚ä½•å°†å®ƒä»¬åˆ¶ä½œæˆç¦»çº¿èµ„æºçš„ä¸€äº›åˆ†æã€‚ä¸Šé¢æåŠçš„éƒ¨ç½²å·¥å…·å„æœ‰å„çš„ä¼˜ç¼ºç‚¹ï¼Œé’ˆå¯¹ä»¥ä¸‹ä¸¤ç§ä¸åŒçš„åœºæ™¯å¯ä»¥é€‰æ‹©ä¸åŒçš„éƒ¨ç½²å·¥å…·ã€‚</p><h3><span id="sealos">sealos</span></h3><p>å¦‚æœä»…ä»…æ˜¯éƒ¨ç½²ä¸€ä¸ªç®€å•çš„ k8s é›†ç¾¤ï¼Œå¯¹é›†ç¾¤æ²¡æœ‰å¤ªå¤šå®šåˆ¶åŒ–çš„éœ€æ±‚ï¼Œé‚£ä¹ˆä½¿ç”¨ <a href="https://github.com/fanux/sealos" target="_blank" rel="noopener">sealos</a> å¯èƒ½æ˜¯æœ€ä½³çš„é€‰æ‹©ï¼Œåªä¸è¿‡å®ƒæ˜¯æ”¶è´¹çš„ï¼Œ<a href="https://www.sealyun.com/" target="_blank" rel="noopener">éœ€è¦å……å€¼ä¼šå‘˜</a> ğŸ˜‚ã€‚</p><blockquote><h3><span id="ç°åœ¨å¼€å§‹-99-69å¹´">ç°åœ¨å¼€å§‹ <s>ï¿¥99</s> ï¿¥69/å¹´</span></h3><p>æ¬¢è¿æˆä¸ºå¹´è´¹ä¼šå‘˜ï¼Œä»»æ„ä¸‹è½½æ‰€æœ‰ç‰ˆæœ¬è½¯ä»¶åŒ…!</p><blockquote><p>@F-liuhui ç¦»çº¿åŒ…å±…ç„¶è¦æ”¶è´¹ï¼Ÿé‚£è¿˜æ˜¯å¼€æºé¡¹ç›®å—ï¼Ÿ</p></blockquote><p>å¼€æºä¸ä»˜è´¹ä¸å†²çªï¼Œ100%å¼€æº 100%ä»˜è´¹</p><p><a href="https://www.sealyun.com/" target="_blank" rel="noopener">sealyun.com</a></p></blockquote><p>å¦‚æœåŠ¨æ‰‹èƒ½åŠ›å¼ºçš„è¯ï¼Œå¯ä»¥æ ¹æ® selaos ç¦»çº¿å®‰è£…åŒ…çš„ç›®å½•ç»“æ„ä½¿ç”¨ GitHub Actions æ¥æ„å»ºï¼Œå®ç°èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆéš¾ã€‚åªä¸è¿‡ç ¸åˆ«äººé¥­ç¢—çš„äº‹å„¿è¿˜æ˜¯ä¸åšä¸ºå¥½ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥é€‰æ‹©å¦ä¸€ç§æ–¹æ¡ˆæ¥å®ç°ï¼Œè¿™æ ·ä¹Ÿèƒ½é¿å…ä¸€äº›å•†ä¸šçº çº·é—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ tar -tf kube1.20.0.tar.gz</span><br><span class="line">kube&#x2F;</span><br><span class="line">kube&#x2F;lib64&#x2F;</span><br><span class="line">kube&#x2F;lib64&#x2F;README.md</span><br><span class="line">kube&#x2F;lib64&#x2F;libseccomp.so.2</span><br><span class="line">kube&#x2F;lib64&#x2F;libseccomp.so.2.3.1</span><br><span class="line">kube&#x2F;shell&#x2F;</span><br><span class="line">kube&#x2F;shell&#x2F;containerd.sh</span><br><span class="line">kube&#x2F;shell&#x2F;init.sh</span><br><span class="line">kube&#x2F;shell&#x2F;master.sh</span><br><span class="line">kube&#x2F;README.md</span><br><span class="line">kube&#x2F;bin&#x2F;</span><br><span class="line">kube&#x2F;bin&#x2F;kubelet</span><br><span class="line">kube&#x2F;bin&#x2F;kubectl</span><br><span class="line">kube&#x2F;bin&#x2F;conntrack</span><br><span class="line">kube&#x2F;bin&#x2F;kubeadm</span><br><span class="line">kube&#x2F;bin&#x2F;kubelet-pre-start.sh</span><br><span class="line">kube&#x2F;conf&#x2F;</span><br><span class="line">kube&#x2F;conf&#x2F;kubeadm.yaml</span><br><span class="line">kube&#x2F;conf&#x2F;kubelet.service</span><br><span class="line">kube&#x2F;conf&#x2F;calico.yaml</span><br><span class="line">kube&#x2F;conf&#x2F;10-kubeadm.conf</span><br><span class="line">kube&#x2F;conf&#x2F;net&#x2F;</span><br><span class="line">kube&#x2F;conf&#x2F;net&#x2F;calico.yaml</span><br><span class="line">kube&#x2F;containerd&#x2F;</span><br><span class="line">kube&#x2F;containerd&#x2F;README.md</span><br><span class="line">kube&#x2F;containerd&#x2F;cri-containerd-cni-linux-amd64.tar.gz</span><br><span class="line">kube&#x2F;images&#x2F;</span><br><span class="line">kube&#x2F;images&#x2F;images.tar</span><br><span class="line">kube&#x2F;images&#x2F;README.md</span><br></pre></td></tr></table></figure><h3><span id="kubekey">kubekey</span></h3><p>ç”±äº kubekey éƒ¨ç½²æ—¶äºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦å…¬ç½‘è·å–ï¼Œdocker æ— æ³•ç¦»çº¿éƒ¨ç½²ä»¥åŠéœ€è¦æ‰‹åŠ¨å®‰è£…ä¸€äº›å‰ç½®ä¾èµ–ï¼Œæ²¡æœ‰åŠæ³•åšåˆ°å®Œæ•´çš„ç¦»çº¿éƒ¨ç½²ï¼Œå› æ­¤ç¦»çº¿éƒ¨ç½²çš„æ–¹æ¡ˆä¹Ÿå°±ç›´æ¥æ”¾å¼ƒæ‰äº†ï¼ŒæŠ½ç©ºä»–ä»¬æä¸ª Issue æˆ– PR çœ‹çœ‹èƒ½å¦æ”¯æŒè¿™éƒ¨åˆ† ğŸ˜…ã€‚</p><h3><span id="kubespray">kubespray</span></h3><p>å¦‚æœæƒ³æ‰¾ä¸€ä¸ªå³å¼€æºåˆå…è´¹çš„ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆï¼Œæˆ–è€…å¯¹é›†ç¾¤éƒ¨ç½²æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œæ¯”å¦‚åŸºäº K8s çš„ PaaS toB äº§å“ï¼Œéœ€è¦åœ¨éƒ¨ç½²æ—¶å®‰è£…å¹³å°æœ¬èº«éœ€è¦çš„ä¸€äº›ä¾èµ–ï¼ˆå¦‚å­˜å‚¨å®¢æˆ·ç«¯ã€GPU é©±åŠ¨ç­‰ï¼‰ã€‚é‚£ä¹ˆä¸å¦¨å…ˆçœ‹ä¸€ä¸‹ kubernetes-sig ç¤¾åŒºçš„ <a href="https://github.com/kubernetes-sigs/kubespray" target="_blank" rel="noopener">kubespray</a> å¦‚ä½• ğŸ¤”ï¼Œä¸»è¦çš„ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ul><li>æ”¯æŒçš„ 10 ç§ CNI æ’ä»¶</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- cni-plugins v0.9.1</span><br><span class="line">- calico v3.17.4</span><br><span class="line">- canal (given calico&#x2F;flannel versions)</span><br><span class="line">- cilium v1.9.9</span><br><span class="line">- flanneld v0.14.0</span><br><span class="line">- kube-ovn v1.7.1</span><br><span class="line">- kube-router v1.3.0</span><br><span class="line">- multus v3.7.2</span><br><span class="line">- ovn4nfv v1.1.0</span><br><span class="line">- weave v2.8.1</span><br></pre></td></tr></table></figure><ul><li>æ”¯æŒ 3 ç§å®¹å™¨è¿è¡Œæ—¶ä»¥åŠ <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/kata-containers.md" target="_blank" rel="noopener">Kata Containers</a> è¿˜æœ‰ nvidia-gpu-device-plugin ç­‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- docker v20.10</span><br><span class="line">- containerd v1.4.6</span><br><span class="line">- cri-o v1.21</span><br></pre></td></tr></table></figure><ul><li>é€‚é…äº† 10 ç§ Linux å‘è¡Œç‰ˆï¼Œè¦†ç›–äº†ç»å¤§å¤šæ•°ç§æœ‰äº‘åœºæ™¯</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- Flatcar Container Linux by Kinvolk</span><br><span class="line">- Debian Buster, Jessie, Stretch, Wheezy</span><br><span class="line">- Ubuntu 16.04, 18.04, 20.04</span><br><span class="line">- CentOS&#x2F;RHEL 7, 8</span><br><span class="line">- Fedora 33, 34</span><br><span class="line">- Fedora CoreOS (see fcos Note)</span><br><span class="line">- openSUSE Leap 15.x&#x2F;Tumbleweed</span><br><span class="line">- Oracle Linux 7, 8</span><br><span class="line">- Alma Linux 8</span><br><span class="line">- Amazon Linux 2</span><br></pre></td></tr></table></figure><ul><li>ä¸°å¯Œçš„æ’ä»¶å’Œæ‰©å±•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">## å·¥å…·ç±»</span><br><span class="line">- helm</span><br><span class="line">- krew</span><br><span class="line">- nerdctl</span><br><span class="line"></span><br><span class="line">## ä¸€äº› controller å’Œ provisioner</span><br><span class="line">- ambassador: v1.5</span><br><span class="line">- cephfs-provisioner v2.1.0-k8s1.11</span><br><span class="line">- rbd-provisioner v2.1.1-k8s1.11</span><br><span class="line">- cert-manager v0.16.1</span><br><span class="line">- coredns v1.8.0</span><br><span class="line">- ingress-nginx v0.43.0</span><br></pre></td></tr></table></figure><ul><li>ä¾èµ–çš„æ–‡ä»¶å’Œé•œåƒæ”¯æŒç¦»çº¿éƒ¨ç½² <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/offline-environment.md" target="_blank" rel="noopener">Offline environment</a></li></ul><p>kubespray å¯¹æ‰€æœ‰çš„ä¾èµ–èµ„æºéƒ½åšåˆ°äº†ç¦»çº¿ä¸‹è½½çš„æ”¯æŒï¼šæ¯”å¦‚æ‰€æœ‰ä¾èµ–æ–‡ä»¶çš„ URL éƒ½é€šè¿‡å˜é‡çš„æ–¹å¼æ¥å®šä¹‰ï¼Œè€Œé kubekey é‚£æ ·ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼›æ‰€æœ‰é•œåƒçš„ repo å’Œ tag éƒ½æ˜¯é€šè¿‡å˜é‡çš„æ–¹å¼æ¥å®šä¹‰ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯åœ¨éƒ¨ç½²çš„æ—¶å€™å¯ä»¥æ ¹æ®å®¢æˆ·ç¯å¢ƒçš„çš„é•œåƒä»“åº“åœ°å€å’Œæ–‡ä»¶æœåŠ¡å™¨çš„ URL åœ°å€æ¥å¡«å†™ç›¸åº”çš„å‚æ•°ï¼Œæ— éœ€é€šè¿‡å…¬ç½‘æ¥è·å–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Registry overrides</span><br><span class="line">kube_image_repo: &quot;&#123;&#123; registry_host &#125;&#125;&quot;</span><br><span class="line">gcr_image_repo: &quot;&#123;&#123; registry_host &#125;&#125;&quot;</span><br><span class="line">docker_image_repo: &quot;&#123;&#123; registry_host &#125;&#125;&quot;</span><br><span class="line">quay_image_repo: &quot;&#123;&#123; registry_host &#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">kubeadm_download_url: &quot;&#123;&#123; files_repo &#125;&#125;&#x2F;kubernetes&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;kubeadm&quot;</span><br><span class="line">kubectl_download_url: &quot;&#123;&#123; files_repo &#125;&#125;&#x2F;kubernetes&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;kubectl&quot;</span><br><span class="line">kubelet_download_url: &quot;&#123;&#123; files_repo &#125;&#125;&#x2F;kubernetes&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;kubelet&quot;</span><br><span class="line"># etcd is optional if you **DON&#39;T** use etcd_deployment&#x3D;host</span><br><span class="line">etcd_download_url: &quot;&#123;&#123; files_repo &#125;&#125;&#x2F;kubernetes&#x2F;etcd&#x2F;etcd-&#123;&#123; etcd_version &#125;&#125;-linux-amd64.tar.gz&quot;</span><br><span class="line">cni_download_url: &quot;&#123;&#123; files_repo &#125;&#125;&#x2F;kubernetes&#x2F;cni&#x2F;cni-plugins-linux-&#123;&#123; image_arch &#125;&#125;-&#123;&#123; cni_version &#125;&#125;.tgz&quot;</span><br><span class="line">crictl_download_url: &quot;&#123;&#123; files_repo &#125;&#125;&#x2F;kubernetes&#x2F;cri-tools&#x2F;crictl-&#123;&#123; crictl_version &#125;&#125;-&#123;&#123; ansible_system | lower &#125;&#125;-&#123;&#123; image_arch &#125;&#125;.tar.gz&quot;</span><br><span class="line"># If using Calico</span><br><span class="line">calicoctl_download_url: &quot;&#123;&#123; files_repo &#125;&#125;&#x2F;kubernetes&#x2F;calico&#x2F;&#123;&#123; calico_ctl_version &#125;&#125;&#x2F;calicoctl-linux-&#123;&#123; image_arch &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šè¿°å‡ ç§éƒ¨ç½²å·¥å…·å¯¹æ¯”ä¸éš¾å‘ç°ï¼Œkubespray çµæ´»æ€§å’Œå¯æ‰©å±•æ€§è¦é¢†å…ˆå…¶ä»–å·¥å…·ï¼ˆæ”¯æŒ 10 ç§ CNIã€10ç§ Linux å‘è¡Œç‰ˆã€3 ç§ CRIã€ä»¥åŠå¤šç§æ’ä»¶å’Œæ‰©å±•ï¼‰å¹¶åœ¨å‚æ•°å±‚é¢ä¸Šåšåˆ°äº†ç¦»çº¿éƒ¨ç½²çš„æ”¯æŒã€‚å› æ­¤æˆ‘ä»¬é¦–å…ˆé€‰ç”¨ kubespray ä½œä¸ºé›†ç¾¤éƒ¨ç½²çš„åº•å±‚å·¥å…·ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ kubespray è™½ç„¶åœ¨å‚æ•°é…ç½®ä¸Šæ”¯æŒç¦»çº¿éƒ¨ç½²ï¼Œä½†æ˜¯ä»åˆ¶ä½œç¦»çº¿å®‰è£…åŒ…åˆ°ä¸€é”®éƒ¨ç½²ï¼Œç›®å‰ä¸ºæ­¢è¿˜æœªæœ‰ä¸€ä¸ªå®Œæ•´çš„å®ç°æ–¹æ¡ˆã€‚å› æ­¤éœ€è¦ä¸º kubespray è®¾è®¡ä¸€å¥—ä»ç¦»çº¿å®‰è£…åŒ…çš„æ„å»ºåˆ°é›†ç¾¤ä¸€é”®éƒ¨ç½²çš„æµç¨‹å’Œæ–¹æ¡ˆï¼Œä¸ºæ­¤æˆ‘ä»¬æ–°å»ºä¸€ä¸ªåä¸º <a href="https://github.com/k8sli/kubeplay" target="_blank" rel="noopener">kubeplay</a> çš„ repo æ¥å®Œæˆè¿™éƒ¨åˆ†å†…å®¹ã€‚</p><p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ kubesphere æ—©æœŸçš„ç‰ˆæœ¬ v2.x ä½¿ç”¨ä¹Ÿæ˜¯ kubespray éƒ¨ç½²çš„ k8sï¼Œè‡³ä»Š ks-installer ä»£ç ä¸­ä»æ®‹ç•™ç€ <a href="https://github.com/kubesphere/ks-installer/commits/master/roles/download/tasks" target="_blank" rel="noopener">éƒ¨åˆ† kubespray çš„ä»£ç </a> ï¼Œåˆ°äº† 3.0 çš„æ—¶å€™å¼€å§‹ä½¿ç”¨è‡ªç ”çš„ kubekey æ¥éƒ¨ç½² K8s äº†ã€‚</p><blockquote><p>åŸºäº Ansible çš„å®‰è£…ç¨‹åºå…·æœ‰å¤§é‡è½¯ä»¶ä¾èµ–æ€§ï¼Œä¾‹å¦‚ Pythonã€‚KubeKey æ˜¯ä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„ï¼Œå¯ä»¥æ¶ˆé™¤åœ¨å„ç§ç¯å¢ƒä¸­å‡ºç°çš„é—®é¢˜ï¼Œä»è€Œæé«˜å®‰è£…æˆåŠŸç‡ã€‚</p><p><a href="https://github.com/kubesphere/kubekey/blob/master/README_zh-CN.md" target="_blank" rel="noopener">README_zh-CN.md</a></p></blockquote><p>ä¸è¿‡ ansible çš„ä¾èµ–é—®é¢˜å½“æ—¶ä¸ºä»€ä¹ˆæ²¡æœ‰è€ƒè™‘é‡‡ç”¨å®¹å™¨åŒ–çš„æ–¹å¼è¿è¡Œ kubespray ğŸ¤”ï¼Œè‡³äº ansible çš„æ€§èƒ½é—®é¢˜ä¹Ÿä¸æ˜¯æ²¡æœ‰ä¼˜åŒ–çš„ä½™åœ°ã€‚</p><h2><span id="kubeplay"></span></h2><p>kubeplay è¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯å®ç° K8s ç¦»çº¿å®‰è£…åŒ…çš„æ„å»ºå’Œä¸€é”®éƒ¨ç½²åŠŸèƒ½ï¼Œç›®å‰åªé€‚é…äº† kubesprayï¼Œç­‰åˆ°åé¢ä¼šé€‚é…ä¸€äº›å…¶ä»–éƒ¨ç½²å·¥å…·å¦‚ kubekeyã€‚</p><h3><span id="æ‰“åŒ…æ–¹å¼">æ‰“åŒ…æ–¹å¼</span></h3><p>ç”±äºéƒ¨ç½²ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œç»„ä»¶é•œåƒå¤§éƒ½å­˜æ”¾åœ¨ GitHub ã€Docker Hubã€<a href="http://gcr.io" target="_blank" rel="noopener">gcr.io</a>ï¼ˆGoogle Container Registryï¼‰ã€<a href="http://quay.io" target="_blank" rel="noopener">quay.io</a> è¿™äº›å›½å¤–çš„å¹³å°ä¸Šï¼Œåœ¨å›½å†…ç¯å¢ƒè·å–è¿™äº›èµ„æºæ˜¯æœ‰ä¸€å®šçš„ç½‘ç»œé™åˆ¶ã€‚è€Œ GitHub æ‰˜ç®¡çš„ runner è¿è¡Œåœ¨å›½å¤–çš„æœºæˆ¿å½“ä¸­ï¼Œå¯ä»¥å¾ˆé¡ºç•…åœ°è·å–è¿™äº›èµ„æºã€‚å› æ­¤æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ GitHub Actions æ¥è¿›è¡Œç¦»çº¿å®‰è£…åŒ…çš„æ„å»ºã€‚</p><p>åƒ selos é‚£æ ·å°†å®‰è£…åŒ…å­˜æ”¾åœ¨é˜¿é‡Œäº‘ OSS ä¸Šï¼Œåœ¨å›½å†…èƒ½ååˆ†é¡ºç•…åœ°é«˜é€Ÿä¸‹è½½ï¼Œæ”¶è´¹ä¹Ÿæ˜¯ç†æ‰€å½“ç„¶ã€‚ä½†æˆ‘ä»¬çš„æ–¹æ¡ˆæ˜¯ 100% å¼€æº 100% å…è´¹ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥ fork ä»£ç åˆ°è‡ªå·±çš„ repoï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ„å»ºã€‚å› æ­¤é€‰æ‹© GitHub æ¥æ„å»ºå’Œå­˜æ”¾æˆ‘ä»¬çš„å®‰è£…åŒ…æ˜¯æœ€åˆé€‚çš„é€‰æ‹©ï¼Œè¿™æ ·ä¹Ÿä¸ç”¨å»é¢å¤–è€ƒè™‘å®‰è£…åŒ…ä¸‹è½½çš„é—®é¢˜ã€‚è‡³äºä» GitHub ä¸Šä¸‹è½½å®‰è£…åŒ…æ…¢çš„é—®é¢˜ï¼Œé‚£åº”è¯¥ç”±ä½¿ç”¨è€…è‡ªè¡Œå»è§£å†³ï¼Œè€Œéæœ¬æ–¹æ¡ˆæ‰€å…³å¿ƒçš„é—®é¢˜ã€‚</p><blockquote><p>Qï¼šå¦‚ä½•æ‘†è„±ç½‘ç»œçš„ä¾èµ–æ¥åˆ›å»ºä¸ª Docker çš„ image å‘¢ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ˜¯ Docker ç”¨æˆ·è‡ªå·±çš„åŸºæœ¬æƒåˆ©ï¼Ÿ</p><p>Aï¼šè¿™ä¸ªåŸºæœ¬æƒåˆ©æˆ‘è§‰å¾—è¿˜æ˜¯è¦é—® GFW ï¼Œå›½å¤–çš„å¼€å‘äººå‘˜æ˜¯éå¸¸éš¾ç†è§£æœ‰äº›ä»–ä»¬è®¤ä¸ºè·Ÿæ°´ç”µä¸€æ ·æ™®åŠçš„åŸºç¡€è®¾æ–½åœ¨æŸäº›åœ°æ–¹è¿˜æ˜¯å¾ˆå›°éš¾çš„ã€‚</p><p>æ­¤å¤„å¼•ç”¨ <a href="http://dockone.io/article/722" target="_blank" rel="noopener">DockOneæŠ€æœ¯åˆ†äº«ï¼ˆäºŒåå››ï¼‰ï¼šå®¹å™¨å’ŒIaaSï¼šè°åŠ¨äº†è°çš„å¥¶é…ª</a></p></blockquote><p>é€‰æ‹©å¥½çš„æ„å»ºåœºæ‰€ä¸º GitHub Actions ä¹‹åæˆ‘ä»¬å†å°†è¿™äº›ç¦»çº¿èµ„æºè¿›è¡Œæ‹†åˆ†ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°å„ä¸ªç¦»çº¿èµ„æºä¹‹é—´çš„è§£è€¦ï¼Œè¿™æ ·åšçµæ´»æ€§æ›´å¥½ä¸€äº›ï¼Œæ¯”å¦‚èƒ½å¤Ÿé€‚é…å¤šç§ OSã€æ”¯æŒå¤šä¸ª k8s ç‰ˆæœ¬ç­‰ã€‚ä¸»è¦æ‹†åˆ†æˆå¦‚ä¸‹å‡ ä¸ªæ¨¡å—ã€‚</p><table><thead><tr><th style="text-align:left">æ¨¡å—</th><th style="text-align:left">Repo</th><th style="text-align:left">ç”¨é€”</th><th style="text-align:left">è¿è¡Œ/ä½¿ç”¨æ–¹å¼</th></tr></thead><tbody><tr><td style="text-align:left">compose</td><td style="text-align:left"><a href="https://github.com/k8sli/kubeplay" target="_blank" rel="noopener">kubeplay</a></td><td style="text-align:left">ç”¨äºéƒ¨ç½² nginx å’Œ registry æœåŠ¡</td><td style="text-align:left">nerdctl compose</td></tr><tr><td style="text-align:left">os-tools</td><td style="text-align:left"><a href="https://github.com/k8sli/kubeplay" target="_blank" rel="noopener">kubeplay</a></td><td style="text-align:left">éƒ¨ç½² compose æ—¶çš„ä¸€äº›ä¾èµ–å·¥å…·</td><td style="text-align:left">äºŒè¿›åˆ¶å®‰è£…</td></tr><tr><td style="text-align:left">os-packages</td><td style="text-align:left"><a href="https://github.com/k8sli/os-packages" target="_blank" rel="noopener">os-packages</a></td><td style="text-align:left">æä¾› rpm/deb ç¦»çº¿æº</td><td style="text-align:left">nginx æä¾› http æ–¹å¼ä¸‹è½½</td></tr><tr><td style="text-align:left">kubespray</td><td style="text-align:left"><a href="https://github.com/k8sli/kubespray" target="_blank" rel="noopener">kubespray</a></td><td style="text-align:left">ç”¨äºéƒ¨ç½²/æ‰©ç¼©å®¹ k8s é›†ç¾¤</td><td style="text-align:left">å®¹å™¨æˆ–è€… pod</td></tr><tr><td style="text-align:left">kubespray-files</td><td style="text-align:left"><a href="https://github.com/k8sli/kubespray" target="_blank" rel="noopener">kubespray</a></td><td style="text-align:left">æä¾›äºŒè¿›åˆ¶æ–‡ä»¶ä¾èµ–</td><td style="text-align:left">nginx æä¾› http æ–¹å¼ä¸‹è½½</td></tr><tr><td style="text-align:left">kubespray-images</td><td style="text-align:left"><a href="https://github.com/k8sli/kubespray" target="_blank" rel="noopener">kubespray</a></td><td style="text-align:left">æä¾›ç»„ä»¶é•œåƒ</td><td style="text-align:left">registry æä¾›é•œåƒä¸‹è½½</td></tr></tbody></table><p>æ‹†åˆ†å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æœ€ç»ˆè¿˜æ˜¯éœ€è¦å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªå®Œæˆçš„ç¦»çº¿å®‰è£…åŒ…ã€‚ä¸ºäº†å‡å°‘ç»´æŠ¤æˆæœ¬ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªæ¨¡å—çš„æ„å»ºæ“ä½œéƒ½æ”¾åœ¨ Dockerfile ä¸­ï¼Œå³ <code>All in Dockerfile</code> ğŸ¤£ã€‚è¿™æ ·æ¯ä¸ªæ¨¡å—çš„ GitHub Actions æµæ°´çº¿æœ€ç»ˆäº¤ä»˜çš„éƒ½æ˜¯ä¸€ä¸ªé•œåƒï¼Œç„¶åé•œåƒéƒ½æ¨é€åˆ° <code>ghcr.io</code> ä¸Šï¼Œè¿™æ ·å°±è§£å†³äº†æ¨¡å—é—´äº§ç‰©ä¼ é€’ä»¥åŠé•œåƒç¼“å­˜çš„é—®é¢˜ã€‚æœ€ç»ˆé€šè¿‡ä¸€ä¸ªæœ€ç»ˆçš„ <a href="https://github.com/k8sli/kubeplay/blob/main/Dockerfile" target="_blank" rel="noopener">Dockerfile</a> å°†è¿™äº›æ¨¡å—çš„é•œåƒå…¨éƒ¨ COPY åˆ°ä¸€ä¸ªé•œåƒå½“ä¸­ï¼Œåªè¦æ‰“åŒ…è¿™ä¸ªæœ€ç»ˆçš„é•œåƒä¸ºç¦»çº¿å®‰è£…åŒ…å³å¯ï¼›å¦ä¸€ä¸ªå¥½å¤„å°±ä½¿ç”¨ buildx æ„å»ºè¿™äº›ç¦»çº¿èµ„æºå°±åŸç”Ÿæ”¯æŒå¤š CPU ä½“ç³»æ¶æ„ï¼Œèƒ½å¤ŸåŒæ—¶é€‚é… amd64 å’Œ arm64 ä½“ç³»æ¶æ„ï¼Œè¿™æ · arm64 ä¹Ÿèƒ½æ„‰å¿«åœ°ç©è€äº†ï¼ŒçœŸæ˜¯ä¸€ä¸¾ä¸¤å¾—ã€‚</p><p>ä¸‹é¢å°±è¯¦ç»†è®²è§£æ¯ä¸ªæ¨¡å—çš„åŠŸèƒ½ä»¥åŠæ˜¯å¦‚ä½•æ‰“åŒ…çš„ï¼š</p><h3><span id="compose">compose</span></h3><p>compose æ¨¡å—é‡Œé¢ä¸»è¦è¿ä¸¤ä¸ªæœåŠ¡ï¼š ç”¨äºæä¾›æ–‡ä»¶ä¸‹è½½çš„ nginx å’Œç»„ä»¶é•œåƒæ‹‰å–çš„ registryã€‚è¿™ä¸¤ä¸ªæˆ‘ä»¬ä¾æ—§æ˜¯å®¹å™¨åŒ–ä»¥ç±»ä¼¼ docker-compose çš„æ–¹å¼æ¥éƒ¨ç½²ï¼Œè€Œæ‰€ä¾èµ–çš„ä¹Ÿåªæœ‰ä¸¤ä¸ªé•œåƒå’Œä¸€äº›é…ç½®æ–‡ä»¶è€Œå·²ã€‚</p><ul><li><a href="https://github.com/k8sli/kubeplay/blob/main/compose.yaml" target="_blank" rel="noopener">kubeplay/blob/main/compose.yaml</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3.1&#39;</span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    container_name: nginx</span><br><span class="line">    image: nginx:1.20-alpine</span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;resources&#x2F;nginx:&#x2F;usr&#x2F;share&#x2F;nginx</span><br><span class="line">      - .&#x2F;config&#x2F;compose&#x2F;certs&#x2F;domain.crt:&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;domain.crt</span><br><span class="line">      - .&#x2F;config&#x2F;compose&#x2F;certs&#x2F;domain.key:&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;domain.key</span><br><span class="line">      - .&#x2F;config&#x2F;compose&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf</span><br><span class="line">    ports:</span><br><span class="line">      # 443 ç«¯å£åå‘ä»£ç† registr çš„ 5000 ç«¯å£ï¼Œä»…ç”¨äº pull é•œåƒ</span><br><span class="line">      - 443:443</span><br><span class="line">      - 8080:8080</span><br><span class="line"></span><br><span class="line">  registry:</span><br><span class="line">    image: registry:2.7.1</span><br><span class="line">    container_name: registry</span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;resources&#x2F;registry:&#x2F;var&#x2F;lib&#x2F;registry</span><br><span class="line">    ports:</span><br><span class="line">      # åªå…è®¸æœ¬åœ° 5000 ç«¯å£ push é•œåƒ</span><br><span class="line">      - 127.0.0.1:5000:5000</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªé•œåƒæˆ‘ä»¬ä½¿ç”¨ skopeo copy çš„æ–¹å¼ä¿å­˜ä¸º tar åŒ…ï¼Œéƒ¨ç½²çš„æ—¶å€™ load åˆ°å®¹å™¨è¿è¡Œæ—¶çš„å­˜å‚¨ä¸­ã€‚</p><blockquote><p>Qï¼šä¸ºä»€ä¹ˆè¦ç”¨ skopeo è€Œä¸æ˜¯ dockerï¼Ÿ</p><p>Aï¼šå› ä¸º Dockerfile æ„å»ºè¿‡ç¨‹ä¸­ä¸æ”¯æŒè¿è¡Œ docker å‘½ä»¤ save é•œåƒ</p></blockquote><ul><li>Dockerfile</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest as downloader</span><br><span class="line">ARG SKOPEO_VERSION&#x3D;v1.4.0</span><br><span class="line">ARG NGINX_VERSION&#x3D;1.20-alpine</span><br><span class="line">ARG RERGISRRY_VERSION&#x3D;2.7.1</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;tools</span><br><span class="line">RUN ARCH&#x3D;$(uname -m | sed &#39;s&#x2F;x86_64&#x2F;amd64&#x2F;;s&#x2F;aarch64&#x2F;arm64&#x2F;&#39;) \</span><br><span class="line">    &amp;&amp; apk --no-cache add wget ca-certificates \</span><br><span class="line">    &amp;&amp; wget -q -k https:&#x2F;&#x2F;github.com&#x2F;k8sli&#x2F;skopeo&#x2F;releases&#x2F;download&#x2F;v1.4.0&#x2F;skopeo-linux-$&#123;ARCH&#125; -O &#x2F;tools&#x2F;skopeo-linux-$&#123;ARCH&#125; \</span><br><span class="line">    &amp;&amp; chmod a+x &#x2F;tools&#x2F;* \</span><br><span class="line">    &amp;&amp; ln -s &#x2F;tools&#x2F;skopeo-linux-$&#123;ARCH&#125; &#x2F;usr&#x2F;bin&#x2F;skopeo</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;images</span><br><span class="line">RUN ARCH&#x3D;$(uname -m | sed &#39;s&#x2F;x86_64&#x2F;amd64&#x2F;;s&#x2F;aarch64&#x2F;arm64&#x2F;&#39;) \</span><br><span class="line">    &amp;&amp; skopeo copy --insecure-policy --src-tls-verify&#x3D;false --override-arch $&#123;ARCH&#125; --additional-tag nginx:$&#123;NGINX_VERSION&#125; \</span><br><span class="line">       docker:&#x2F;&#x2F;docker.io&#x2F;library&#x2F;nginx:$&#123;NGINX_VERSION&#125; docker-archive:nginx-$&#123;NGINX_VERSION&#125;.tar \</span><br><span class="line">    &amp;&amp; skopeo copy --insecure-policy --src-tls-verify&#x3D;false --override-arch $&#123;ARCH&#125; --additional-tag registry:$&#123;RERGISRRY_VERSION&#125; \</span><br><span class="line">       docker:&#x2F;&#x2F;docker.io&#x2F;library&#x2F;registry:$&#123;RERGISRRY_VERSION&#125; docker-archive:registry-$&#123;RERGISRRY_VERSION&#125;.tar</span><br></pre></td></tr></table></figure><p>åœ¨éƒ¨ç½²çš„æ—¶å€™æˆ‘ä»¬ä½¿ç”¨ nerdctl compose çš„æ–¹å¼å¯åŠ¨å³å¯ï¼Œä½¿ç”¨æ–¹å¼æœ‰ç‚¹ç±»ä¼¼äº docker-composeã€‚</p><blockquote><p>Q: ä¸ºä»€ä¹ˆä¸ç”¨ docker å’Œ docker-compose</p><p>Aï¼šK8s å» docker æ˜¯å¤§åŠ¿æ‰€è¶‹ï¼Œé€‰æ‹© containerd æ›´ç¬¦åˆä¸»æµå‘å±•æ–¹å‘</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å°†é•œåƒ load è¿› containerd å­˜å‚¨</span><br><span class="line">$ find $&#123;IMAGES_DIR&#125; -type f -name &#39;*.tar&#39; | xargs -L1 nerdctl load -i</span><br><span class="line"># nerdctl compose å¯åŠ¨ nginx å’Œ registry</span><br><span class="line">$ nerdctl compose -f compose.yaml up</span><br></pre></td></tr></table></figure><h3><span id="os-packages">os-packages</span></h3><p>è¿™éƒ¨åˆ†æ˜¯ rpm/deb ç¦»çº¿æºçš„æ„å»ºï¼Œå…¶è¯¦ç»†çš„è¿‡ç¨‹å’ŒåŸç†å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„åšå®¢ ã€Š<a href="https://blog.k8s.li/make-offline-mirrors.html" target="_blank" rel="noopener">ä½¿ç”¨ docker build åˆ¶ä½œ yum/apt ç¦»çº¿æº</a>ã€‹ï¼Œä¸‹é¢åªåˆ—ä¸¾ä¸€ä¸‹ CentOS7 ç¦»çº¿æºçš„æ„å»ºé…ç½®ï¼š</p><ul><li><a href="https://github.com/k8sli/os-packages/blob/main/build/Dockerfile.os.centos7" target="_blank" rel="noopener">Dockerfile</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7.9.2009 as os-centos7</span><br><span class="line">ARG OS_VERSION&#x3D;7</span><br><span class="line">ARG DOCKER_MIRROR_URL&#x3D;&quot;https:&#x2F;&#x2F;download.docker.com&quot;</span><br><span class="line">ARG BUILD_TOOLS&#x3D;&quot;yum-utils createrepo epel-release wget&quot;</span><br><span class="line"></span><br><span class="line"># å®‰è£…æ„å»ºå·¥å…·ï¼Œé…ç½® docker å®˜æ–¹ yum æº</span><br><span class="line">RUN yum install -q -y $&#123;BUILD_TOOLS&#125; \</span><br><span class="line">    &amp;&amp; yum-config-manager --add-repo $&#123;DOCKER_MIRROR_URL&#125;&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo \</span><br><span class="line">    &amp;&amp; yum makecache</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;centos&#x2F;$OS_VERSION&#x2F;os</span><br><span class="line">COPY packages.yaml .</span><br><span class="line">COPY --from&#x3D;mikefarah&#x2F;yq:4.11.1 &#x2F;usr&#x2F;bin&#x2F;yq &#x2F;usr&#x2F;bin&#x2F;yq</span><br><span class="line"></span><br><span class="line"># æ ¹æ®é…ç½®æ–‡ä»¶è§£æè¯¥ OS éœ€è¦æ„å»ºçš„åŒ…ï¼Œå¹¶è·å–è¿™äº›åŒ…çš„ä¸‹è½½ url</span><br><span class="line">RUN yq eval &#39;.common[],.yum[],.centos7[],.kubespray.common[],.kubespray.yum[]&#39; packages.yaml &gt; packages.list \</span><br><span class="line">    &amp;&amp; sort -u packages.list | xargs repotrack --urls | sort -u &gt; packages.urls</span><br><span class="line"></span><br><span class="line"># é€šè¿‡ wget çš„æ–¹å¼ä¸‹è½½ rpm åŒ…ï¼Œä½¿ç”¨ createrepo åˆ›å»º repo ç´¢å¼•æ–‡ä»¶</span><br><span class="line">RUN ARCH&#x3D;$(uname -m) \</span><br><span class="line">    &amp;&amp; wget -q -x -P $&#123;ARCH&#125; -i packages.urls \</span><br><span class="line">    &amp;&amp; createrepo -d $&#123;ARCH&#125;</span><br><span class="line"></span><br><span class="line"># å°†æ„å»ºçš„å†…å®¹ COPY æˆå•ç‹¬çš„ä¸€å±‚</span><br><span class="line">FROM scratch</span><br><span class="line">COPY --from&#x3D;os-centos7 &#x2F;centos &#x2F;centos</span><br></pre></td></tr></table></figure><ul><li><a href="https://github.com/k8sli/os-packages/blob/main/packages.yaml" target="_blank" rel="noopener">packages.yaml</a> é…ç½®æ–‡ä»¶</li></ul><p>è¿™ä¸ªæ˜¯éœ€è¦å®‰è£…åŒ…çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®å¹³å°æˆ–è€…å®¢æˆ·çš„ä¸€äº›è¦æ±‚é…ç½®ä¸Šä¸åŒçš„åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">kubespray:</span><br><span class="line">  common:</span><br><span class="line">    - curl</span><br><span class="line">    - rsync</span><br><span class="line">    - socat</span><br><span class="line">    - unzip</span><br><span class="line">    - e2fsprogs</span><br><span class="line">    - xfsprogs</span><br><span class="line">    - ebtables</span><br><span class="line">    - bash-completion</span><br><span class="line">    - ipvsadm</span><br><span class="line">    - ipset</span><br><span class="line">    - conntrack</span><br><span class="line"></span><br><span class="line">  yum:</span><br><span class="line">    - nss</span><br><span class="line">    - libselinux-python</span><br><span class="line">    - device-mapper-libs</span><br><span class="line">  apt:</span><br><span class="line">    - python-apt</span><br><span class="line">    - python3-apt</span><br><span class="line">    - aufs-tools</span><br><span class="line">    - apt-transport-https</span><br><span class="line">    - software-properties-common</span><br><span class="line"></span><br><span class="line">common:</span><br><span class="line">  - cifs-utils</span><br><span class="line">  - lsof</span><br><span class="line">  - lvm2</span><br><span class="line">  - openssl</span><br><span class="line">  - sshpass</span><br><span class="line">  - vim</span><br><span class="line">  - wget</span><br><span class="line">  - ethtool</span><br><span class="line">  - net-tools</span><br><span class="line">  - rsync</span><br><span class="line">  - chrony</span><br><span class="line"></span><br><span class="line">yum:</span><br><span class="line">  - nfs-utils</span><br><span class="line">  - yum-utils</span><br><span class="line">  - createrepo</span><br><span class="line">  - epel-release</span><br><span class="line">  - nc</span><br><span class="line">  - httpd-tools</span><br><span class="line"></span><br><span class="line">apt:</span><br><span class="line">  - nfs-common</span><br><span class="line">  - apt-transport-https</span><br><span class="line">  - ca-certificates</span><br><span class="line">  - gnupg</span><br><span class="line">  - lsb-release</span><br><span class="line">  - aptitude</span><br><span class="line">  - dpkg-dev</span><br><span class="line">  - gnupg2</span><br><span class="line">  - netcat</span><br><span class="line">  - apache2-utils</span><br><span class="line"></span><br><span class="line">centos7:</span><br><span class="line">  - containerd.io-1.4.6</span><br><span class="line"></span><br><span class="line">ubuntu:</span><br><span class="line">  - containerd.io&#x3D;1.4.6-1</span><br><span class="line"></span><br><span class="line">debian10:</span><br><span class="line">  - containerd.io&#x3D;1.4.6-1</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äº toB äº§å“ï¼Œå»ºè®®å°†ä¸‹é¢è¿™äº›å¸¸è§çš„è¿ç»´è°ƒè¯•å·¥å…·ï¼ˆå¦‚ tcpdump, strace, lsof, net-tools ç­‰ï¼‰ä¹Ÿæ„å»ºåœ¨ç¦»çº¿æºä¸­ã€‚è¿™æ ·ä¹Ÿä¸è‡³äºåœ¨å®¢æˆ·çš„ç¯å¢ƒä¸­æ’æŸ¥é—®é¢˜çš„æ—¶å€™æœºå™¨ä¸Šè¿ä¸ª tcpdump éƒ½æ²¡æœ‰ï¼Œå°¤å…¶æ˜¯åœ¨æ— ç½‘çš„ç¯å¢ƒä¸­ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›å¸¸ç”¨çš„è¿ç»´å·¥å…·ï¼Œæ’æŸ¥é—®é¢˜å°†ä¼šååˆ†æ£˜æ‰‹ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">tools:</span><br><span class="line">  - bash-completion</span><br><span class="line">  - chrony</span><br><span class="line">  - cifs-utils</span><br><span class="line">  - curl</span><br><span class="line">  - dstat</span><br><span class="line">  - e2fsprogs</span><br><span class="line">  - ebtables</span><br><span class="line">  - expect</span><br><span class="line">  - gdb</span><br><span class="line">  - htop</span><br><span class="line">  - iftop</span><br><span class="line">  - iotop</span><br><span class="line">  - ipset</span><br><span class="line">  - ipvsadm</span><br><span class="line">  - jq</span><br><span class="line">  - lsof</span><br><span class="line">  - lvm2</span><br><span class="line">  - ncdu</span><br><span class="line">  - net-tools</span><br><span class="line">  - nethogs</span><br><span class="line">  - nload</span><br><span class="line">  - ntpdate</span><br><span class="line">  - openssl</span><br><span class="line">  - pciutils</span><br><span class="line">  - psmisc</span><br><span class="line">  - rsync</span><br><span class="line">  - smartmontools</span><br><span class="line">  - socat</span><br><span class="line">  - sshpass</span><br><span class="line">  - strace</span><br><span class="line">  - sysstat</span><br><span class="line">  - tcpdump</span><br><span class="line">  - telnet</span><br><span class="line">  - tmux</span><br></pre></td></tr></table></figure><h3><span id="kubespray">kubespray</span></h3><p>kubespray æ˜¯éƒ¨ç½² K8s é›†ç¾¤ã€å¢åŠ èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€ç§»é™¤é›†ç¾¤ç­‰æ¶‰åŠå¯¹é›†ç¾¤æ“ä½œçš„ä¸»è¦å·¥å…·ã€‚æˆ‘ä»¬ä¾æ—§é‡‡ç”¨å®¹å™¨åŒ–çš„æ–¹å¼è¿è¡Œ kubesprayï¼Œä¸»è¦æœ‰ä»¥ä¸‹åœºæ™¯ä¼šç”¨åˆ° kubesprayï¼š</p><ul><li>åœ¨éƒ¨ç½²å·¥å…·è¿è¡ŒèŠ‚ç‚¹ï¼Œä½¿ç”¨ nerdctl æ¥è¿è¡Œ kubespray å®¹å™¨éƒ¨ç½² K8s é›†ç¾¤</li><li>K8s é›†ç¾¤éƒ¨ç½²å®Œæ¯•åï¼Œä»¥ Job pod çš„æ–¹å¼è¿è¡Œéƒ¨ç½²å¦ä¸€ä¸ª K8s é›†ç¾¤ï¼Œå®ç°å¤šé›†ç¾¤éƒ¨ç½²çš„åŸºæœ¬èƒ½åŠ›</li><li>K8s é›†ç¾¤éƒ¨ç½²å®Œæ¯•åï¼Œä»¥ Job pod çš„æ–¹å¼è¿è¡Œ kubespray å¯¹è¯¥é›†ç¾¤é›†ç¾¤èŠ‚ç‚¹è¿›è¡Œæ‰©ç¼©å®¹</li></ul><p>Job pod æ–¹å¼å¯¹é›†ç¾¤è¿›è¡Œæ‰©ç¼©å®¹çš„è®¾è®¡çš„æ˜¯ä¸ºäº†ä»ä¸€å®šç¨‹åº¦ä¸Šè§£å†³éƒ¨ç½²å¤§è§„æ¨¡é›†ç¾¤æ—¶ ansible æ€§èƒ½é—®é¢˜ã€‚å³æˆ‘ä»¬ä¸€å¼€å§‹ä¸å¿…å°±éƒ¨ç½²ä¸€ä¸ªä¸ŠåƒèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œè€Œæ˜¯å…ˆæŠŠä¸€ä¸ªè§„æ¨¡è¾ƒå°çš„é›†ç¾¤éƒ¨ç½²èµ·æ¥ï¼Œç„¶åé€šè¿‡åˆ›å»ºæ‰¹é‡çš„ Job çš„æ–¹å¼è¿è¡Œ kubespray å†å°†é›†ç¾¤æ…¢æ…¢æ‰©å®¹èµ·æ¥ï¼Œæ¯”å¦‚æ‰©å®¹åˆ°ä¸Šåƒå°èŠ‚ç‚¹ã€‚</p><p>kubespray å®˜æ–¹çš„ Dockerfile æ„å»ºå‡ºæ¥çš„é•œåƒæœ‰ 1.4GBï¼Œå®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¼˜åŒ–ä¸€ä¸‹ï¼Œå‡å°‘é•œåƒå¤§å°</p><ul><li>kubespray BASE é•œåƒ</li></ul><p>é¦–å…ˆæ„å»ºä¸€ä¸ª base é•œåƒï¼Œå¯¹äºä¸ç»å¸¸å˜åŠ¨çš„å†…å®¹æˆ‘ä»¬æŠŠå®ƒå°è£…åœ¨ä¸€ä¸ª base é•œåƒé‡Œï¼Œåªæœ‰å½“ç›¸å…³ä¾èµ–æ›´æ–°äº†æ‰éœ€è¦é‡æ–°æ„å»ºè¿™ä¸ª base é•œåƒï¼Œ<code>Dockerfile.base</code> å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">FROM python:3 as builder</span><br><span class="line">ARG KUBE_VERSION&#x3D;v1.21.3</span><br><span class="line">COPY requirements.txt requirements.txt</span><br><span class="line">COPY tests&#x2F;requirements.txt tests&#x2F;requirements.txt</span><br><span class="line">RUN echo &#39;shellcheck-py&#x3D;&#x3D;0.7.2.1&#39; &gt;&gt; requirements.txt \</span><br><span class="line">    &amp;&amp; grep -E &#39;^yamllint|^ansible-lint&#39; tests&#x2F;requirements.txt &gt;&gt; requirements.txt \</span><br><span class="line">    &amp;&amp; pip3 install --user -r requirements.txt</span><br><span class="line"></span><br><span class="line">RUN ARCH&#x3D;$(uname -m | sed &#39;s&#x2F;x86_64&#x2F;amd64&#x2F;;s&#x2F;aarch64&#x2F;arm64&#x2F;&#39;) \</span><br><span class="line">    &amp;&amp; wget -O &#x2F;root&#x2F;.local&#x2F;bin&#x2F;kubectl -q https:&#x2F;&#x2F;dl.k8s.io&#x2F;$&#123;KUBE_VERSION&#125;&#x2F;bin&#x2F;linux&#x2F;$&#123;ARCH&#125;&#x2F;kubectl \</span><br><span class="line">&amp;&amp; chmod a+x &#x2F;root&#x2F;.local&#x2F;bin&#x2F;kubectl</span><br><span class="line"></span><br><span class="line">FROM python:3-slim</span><br><span class="line">RUN DEBIAN_FRONTEND&#x3D;noninteractive apt-get update -y -qq \</span><br><span class="line">    &amp;&amp; apt-get install -y -qq --no-install-recommends \</span><br><span class="line">        ca-certificates libssl-dev openssh-client sshpass curl gnupg2 rsync \</span><br><span class="line">        jq moreutils vim iputils-ping wget tcpdump xz-utils \</span><br><span class="line">    &amp;&amp; rm -rf &#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;*</span><br><span class="line"></span><br><span class="line">COPY --from&#x3D;builder &#x2F;root&#x2F;.local &#x2F;usr&#x2F;local</span><br><span class="line">WORKDIR &#x2F;kubespray</span><br></pre></td></tr></table></figure><ul><li><a href="https://blog.k8s.li/pass-tob-k8s-offline-deploy.html?utm_source=pocket_mylist" target="_blank" rel="noopener">kubespray é•œåƒ</a></li></ul><p>FROM çš„ base é•œåƒå°±ä½¿ç”¨æˆ‘ä»¬åˆšåˆšæ„å»ºå¥½çš„é•œåƒï¼Œç›¸å…³ä¾èµ–å·²ç»åœ¨ base é•œåƒä¸­å®‰è£…å¥½äº†ï¼Œè¿™é‡Œæ„å»ºçš„æ—¶å€™åªéœ€è¦æŠŠ repo æºç å¤åˆ¶åˆ° /kubespray ç›®å½•ä¸‹å³å¯ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ARG BASE_IMAGE&#x3D;ghcr.io&#x2F;k8sli&#x2F;kubespray-base</span><br><span class="line">ARG BASE_IMAGE_VERSION&#x3D;latest</span><br><span class="line">FROM $BASE_IMAGE:$BASE_IMAGE_VERSION</span><br><span class="line">WORKDIR &#x2F;kubespray</span><br><span class="line">COPY . .</span><br></pre></td></tr></table></figure><ul><li>kubespray é›†ç¾¤éƒ¨ç½²å…¥å£ <code>run.sh</code></li></ul><p>å°†é›†ç¾¤éƒ¨ç½²ã€å¢åŠ èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€åˆ é™¤é›†ç¾¤ç­‰æ“ä½œå°è£…æˆä¸€ä¸ªå…¥å£çš„è„šæœ¬ï¼Œæä¾›å¤–éƒ¨å·¥å…·è°ƒç”¨è¯¥è„šæœ¬ï¼Œä¸ç„¶å¤–éƒ¨è°ƒç”¨çš„æ—¶å€™ç›´æ¥è¿è¡Œ <code>ansible-playbook</code> å‘½ä»¤å®åœ¨æ˜¯ä¸å¤ªæ–¹ä¾¿ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">TYPE&#x3D;$1</span><br><span class="line">NODES&#x3D;$2</span><br><span class="line"></span><br><span class="line">KUBE_ROOT&#x3D;&quot;$(cd &quot;$(dirname &quot;$0&quot;)&quot; &amp;&amp; pwd)&quot;</span><br><span class="line"></span><br><span class="line">: $&#123;TYPE:&#x3D;deploy-cluster&#125;</span><br><span class="line">: $&#123;ANSIBLE_FORKS:&#x3D;10&#125;</span><br><span class="line">: $&#123;BECOME_USER:&#x3D;root&#125;</span><br><span class="line">: $&#123;ANSIBLE_LOG_FORMAT:&#x3D;yaml&#125;</span><br><span class="line">: $&#123;INVENTORY:&#x3D;$&#123;KUBE_ROOT&#125;&#x2F;config&#x2F;inventory&#125;</span><br><span class="line">: $&#123;ENV_FILE:&#x3D;$&#123;KUBE_ROOT&#125;&#x2F;config&#x2F;env.yml&#125;</span><br><span class="line">: $&#123;INSTALL_STEPS_FILE:&#x3D;$&#123;KUBE_ROOT&#125;&#x2F;config&#x2F;.install_steps&#125;</span><br><span class="line"></span><br><span class="line">export ANSIBLE_STDOUT_CALLBACK&#x3D;$&#123;ANSIBLE_LOG_FORMAT&#125;</span><br><span class="line">export ANSIBLE_ARGS&#x3D;&quot;-f $&#123;ANSIBLE_FORKS&#125; --become --become-user&#x3D;$&#123;BECOME_USER&#125; -i $&#123;INVENTORY&#125; -e @$&#123;ENV_FILE&#125;&quot;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Set logging colors</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">NORMAL_COL&#x3D;$(tput sgr0)</span><br><span class="line">RED_COL&#x3D;$(tput setaf 1)</span><br><span class="line">WHITE_COL&#x3D;$(tput setaf 7)</span><br><span class="line">GREEN_COL&#x3D;$(tput setaf 76)</span><br><span class="line">YELLOW_COL&#x3D;$(tput setaf 202)</span><br><span class="line"></span><br><span class="line">debuglog()&#123; printf &quot;$&#123;WHITE_COL&#125;%s$&#123;NORMAL_COL&#125;\n&quot; &quot;$@&quot;; &#125;</span><br><span class="line">infolog()&#123; printf &quot;$&#123;GREEN_COL&#125;âœ” %s$&#123;NORMAL_COL&#125;\n&quot; &quot;$@&quot;; &#125;</span><br><span class="line">warnlog()&#123; printf &quot;$&#123;YELLOW_COL&#125;âœ %s$&#123;NORMAL_COL&#125;\n&quot; &quot;$@&quot;; &#125;</span><br><span class="line">errorlog()&#123; printf &quot;$&#123;RED_COL&#125;âœ– %s$&#123;NORMAL_COL&#125;\n&quot; &quot;$@&quot;; &#125;</span><br><span class="line"></span><br><span class="line">set -eo pipefail</span><br><span class="line"></span><br><span class="line">if [[ ! -f $&#123;INVENTORY&#125; ]]; then</span><br><span class="line">  errorlog &quot;$&#123;INVENTORY&#125; file is missing, please check the inventory file is exists&quot;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">deploy_cluster()&#123;</span><br><span class="line">:</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()&#123;</span><br><span class="line">  case $TYPE in</span><br><span class="line">    deploy-cluster)</span><br><span class="line">      infolog &quot;######  start deploy kubernetes cluster  ######&quot;</span><br><span class="line">      deploy_cluster</span><br><span class="line">      infolog &quot;######  kubernetes cluster successfully installed  ######&quot;</span><br><span class="line">      ;;</span><br><span class="line">    remove-cluster)</span><br><span class="line">      infolog &quot;######  start remove kubernetes cluster  ######&quot;</span><br><span class="line">      if ansible-playbook $&#123;ANSIBLE_ARGS&#125; $&#123;KUBE_ROOT&#125;&#x2F;reset.yml &gt;&#x2F;dev&#x2F;stdout 2&gt;&#x2F;dev&#x2F;stderr; then</span><br><span class="line">        rm -f $&#123;INSTALL_STEP_FILE&#125;</span><br><span class="line">        infolog &quot;######  kubernetes cluster successfully removed ######&quot;</span><br><span class="line">      fi</span><br><span class="line">      ;;</span><br><span class="line">    add-node)</span><br><span class="line">      check_nodename</span><br><span class="line">      infolog &quot;######  start add worker to kubernetes cluster  ######&quot;</span><br><span class="line">      ansible-playbook $&#123;ANSIBLE_ARGS&#125; --limit&#x3D;&quot;$&#123;NODES&#125;&quot; $&#123;KUBE_ROOT&#125;&#x2F;playbooks&#x2F;10-scale-nodes.yml &gt;&#x2F;dev&#x2F;stdout 2&gt;&#x2F;dev&#x2F;stderr</span><br><span class="line">      ;;</span><br><span class="line">    remove-node)</span><br><span class="line">      check_nodename</span><br><span class="line">      infolog &quot;######  start remove worker from kubernetes cluster  ######&quot;</span><br><span class="line">      ansible-playbook $&#123;ANSIBLE_ARGS&#125; -e node&#x3D;&quot;$&#123;NODES&#125;&quot; -e reset_nodes&#x3D;true $&#123;KUBE_ROOT&#125;&#x2F;remove-node.yml &gt;&#x2F;dev&#x2F;stdout 2&gt;&#x2F;dev&#x2F;stderr</span><br><span class="line">      ;;</span><br><span class="line">    *)</span><br><span class="line">      errorlog &quot;unknow [TYPE] parameter: $&#123;TYPE&#125;&quot;</span><br><span class="line">      ;;</span><br><span class="line">  esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main &quot;$@&quot;</span><br></pre></td></tr></table></figure><ul><li>åˆ†å±‚éƒ¨ç½² <a href="https://github.com/k8sli/kubespray/tree/main/playbooks" target="_blank" rel="noopener">playbooks</a></li></ul><p>ä¸åŒäº kubespray å®˜æ–¹ä½¿ç”¨ä¸€ä¸ªå®Œæ•´çš„ <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/cluster.yml" target="_blank" rel="noopener">cluster.yaml</a> æ¥å®Œæˆæ•´ä¸ª K8s é›†ç¾¤çš„éƒ¨ç½²ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¼•å…¥äº†åˆ†å±‚éƒ¨ç½²çš„ç‰¹æ€§ã€‚å³å°†é›†ç¾¤éƒ¨ç½²åˆ†æˆè‹¥å¹²ä¸ªç›¸äº’ç‹¬ç«‹çš„ playbookï¼Œç„¶ååœ¨å„ä¸ª playbook é‡Œå¼•å…¥æˆ‘ä»¬å¢åŠ çš„ roles ä»¥åŠäºŒå¼€å†…å®¹ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯èƒ½å’Œ kubespray ä¸Šæ¸¸çš„ä»£ç ä¿æŒç›¸äº’ç‹¬ç«‹ï¼Œåœ¨ rebase æˆ–è€… cherry-pick ä¸Šæ¸¸æœ€æ–°çš„ä»£ç èƒ½å¤Ÿé¿å…å‡ºç°å†²çªçš„ç°è±¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">playbooks</span><br><span class="line">â”œâ”€â”€ 00-default-ssh-config.yml    # é…ç½® ssh è¿æ¥</span><br><span class="line">â”œâ”€â”€ 01-cluster-bootstrap-os.yml  # åˆå§‹åŒ–é›†ç¾¤èŠ‚ç‚¹</span><br><span class="line">â”œâ”€â”€ 02-cluster-etcd.yml          # éƒ¨ç½² etcd é›†ç¾¤</span><br><span class="line">â”œâ”€â”€ 03-cluster-kubernetes.yml    # éƒ¨ç½² k8s master å’Œ node</span><br><span class="line">â”œâ”€â”€ 04-cluster-network.yml       # éƒ¨ç½² CNI æ’ä»¶</span><br><span class="line">â”œâ”€â”€ 05-cluster-apps.yml          # éƒ¨ç½²ä¸€äº› addon ç»„ä»¶å¦‚ coredns</span><br><span class="line">â””â”€â”€ 10-scale-nodes.yml           # å¢åˆ èŠ‚ç‚¹</span><br></pre></td></tr></table></figure><p>åˆ†å±‚éƒ¨ç½²çš„æ—¶å€™é€šè¿‡ä¸€ä¸ªæ–‡ä»¶æ¥è®°å½•å·²ç»éƒ¨ç½²æˆåŠŸçš„æ­¥éª¤ï¼Œè¿™æ ·å¦‚æœæœ¬æ¬¡å› ä¸ºä¸€äº›åŸå› å¯¼è‡´éƒ¨ç½²å¤±è´¥ï¼ˆå¦‚ç½‘ç»œä¸­æ–­ï¼‰ï¼Œé‚£ä¹ˆä¸‹æ¬¡é‡æ–°éƒ¨ç½²çš„æ—¶å€™ä¼šè·³è¿‡å·²ç»éƒ¨ç½²å¥½çš„æ­¥éª¤ï¼Œä»å¤±è´¥çš„åœ°æ–¹ç»§ç»­éƒ¨ç½²ï¼Œä»¥æå‡æ•´ä½“çš„éƒ¨ç½²æ•ˆç‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">deploy_cluster()&#123;</span><br><span class="line">  touch $&#123;INSTALL_STEPS_FILE&#125;</span><br><span class="line">  STEPS&#x3D;&quot;00-default-ssh-config 01-cluster-bootstrap-os 02-cluster-etcd 03-cluster-kubernetes 04-cluster-network 05-cluster-apps&quot;</span><br><span class="line">  for step in $&#123;STEPS&#125;; do</span><br><span class="line">    if ! grep -q &quot;$&#123;step&#125;&quot; $&#123;INSTALL_STEPS_FILE&#125;; then</span><br><span class="line">      infolog &quot;start deploy $&#123;step&#125;&quot;</span><br><span class="line">      if ansible-playbook $&#123;ANSIBLE_ARGS&#125; $&#123;KUBE_ROOT&#125;&#x2F;playbooks&#x2F;$&#123;step&#125;.yml; then</span><br><span class="line">        echo $&#123;step&#125; &gt;&gt; $&#123;INSTALL_STEPS_FILE&#125;</span><br><span class="line">        infolog &quot;$&#123;step&#125; successfully installed&quot;</span><br><span class="line">      else</span><br><span class="line">        errorlog &quot;$&#123;step&#125; installation failed&quot;</span><br><span class="line">        exit 1</span><br><span class="line">      fi</span><br><span class="line">    else</span><br><span class="line">      warnlog &quot;$&#123;step&#125; is already installed, so skipped...&quot;</span><br><span class="line">    fi</span><br><span class="line">  done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="æ–‡ä»¶å’Œé•œåƒ">æ–‡ä»¶å’Œé•œåƒ</span></h3><p>æˆ‘ä»¬éœ€è¦æå–å‡º kubespray éƒ¨ç½²çš„æ—¶å€™ä¾èµ–çš„æ–‡ä»¶å’Œé•œåƒï¼Œç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨å’Œé•œåƒåˆ—è¡¨ï¼Œç„¶åæ ¹æ®è¿™äº›åˆ—è¡¨ä¸‹è½½å¹¶æ„å»ºåˆ°ä¸€ä¸ªé•œåƒé‡Œã€‚</p><ul><li>æ–‡ä»¶</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Download URLs</span><br><span class="line">kubelet_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;bin&#x2F;linux&#x2F;&#123;&#123; image_arch &#125;&#125;&#x2F;kubelet&quot;</span><br><span class="line">kubectl_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;bin&#x2F;linux&#x2F;&#123;&#123; image_arch &#125;&#125;&#x2F;kubectl&quot;</span><br><span class="line">kubeadm_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;&#123;&#123; kube_version &#125;&#125;&#x2F;bin&#x2F;linux&#x2F;&#123;&#123; image_arch &#125;&#125;&#x2F;kubeadm&quot;</span><br><span class="line">etcd_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;github.com&#x2F;coreos&#x2F;etcd&#x2F;releases&#x2F;download&#x2F;&#123;&#123; etcd_version &#125;&#125;&#x2F;etcd-&#123;&#123; etcd_version &#125;&#125;-linux-&#123;&#123; image_arch &#125;&#125;.tar.gz&quot;</span><br><span class="line">cni_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;github.com&#x2F;containernetworking&#x2F;plugins&#x2F;releases&#x2F;download&#x2F;&#123;&#123; cni_version &#125;&#125;&#x2F;cni-plugins-linux-&#123;&#123; image_arch &#125;&#125;-&#123;&#123; cni_version &#125;&#125;.tgz&quot;</span><br><span class="line">calicoctl_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;github.com&#x2F;projectcalico&#x2F;calicoctl&#x2F;releases&#x2F;download&#x2F;&#123;&#123; calico_ctl_version &#125;&#125;&#x2F;calicoctl-linux-&#123;&#123; image_arch &#125;&#125;&quot;</span><br><span class="line">calico_crds_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;github.com&#x2F;projectcalico&#x2F;calico&#x2F;archive&#x2F;&#123;&#123; calico_version &#125;&#125;.tar.gz&quot;</span><br><span class="line">crictl_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;github.com&#x2F;kubernetes-sigs&#x2F;cri-tools&#x2F;releases&#x2F;download&#x2F;&#123;&#123; crictl_version &#125;&#125;&#x2F;crictl-&#123;&#123; crictl_version &#125;&#125;-&#123;&#123; ansible_system | lower &#125;&#125;-&#123;&#123; image_arch &#125;&#125;.tar.gz&quot;</span><br><span class="line">helm_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;get.helm.sh&#x2F;helm-&#123;&#123; helm_version &#125;&#125;-linux-&#123;&#123; image_arch &#125;&#125;.tar.gz&quot;</span><br><span class="line">nerdctl_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;github.com&#x2F;containerd&#x2F;nerdctl&#x2F;releases&#x2F;download&#x2F;v&#123;&#123; nerdctl_version &#125;&#125;&#x2F;nerdctl-&#123;&#123; nerdctl_version &#125;&#125;-&#123;&#123; ansible_system | lower &#125;&#125;-&#123;&#123; image_arch &#125;&#125;.tar.gz&quot;</span><br><span class="line">patched_kubeadm_download_url: &quot;&#123;&#123; download_url &#125;&#125;&#x2F;github.com&#x2F;k8sli&#x2F;kubernetes&#x2F;releases&#x2F;download&#x2F;&#123;&#123; kubeadm_patch_version &#125;&#125;&#x2F;kubeadm-linux-&#123;&#123; image_arch &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><p>åœ¨æ„å»ºå®‰è£…åŒ…çš„æ—¶å€™ï¼Œå°† download_url å˜é‡è®¾ç½®ä¸º <code>https://</code> ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™å°† <code>download_url</code> è®¾ç½®ä¸ºå†…ç½‘ æ–‡ä»¶æœåŠ¡å™¨æœåŠ¡å™¨çš„ URLï¼Œæ¯”å¦‚ <code>https://172.20.0.25:8080/files</code>ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ–‡ä»¶æ„å»ºå’Œéƒ¨ç½²ä½¿ç”¨çš„ç»Ÿä¸€ï¼ŒèŠ‚çœç»´æŠ¤æˆæœ¬ã€‚</p><ul><li>é•œåƒ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Define image repo and tag overwrite role&#x2F;download&#x2F;default&#x2F;main.yml</span><br><span class="line">pod_infra_image_tag: &quot;&#123;&#123; pod_infra_version &#125;&#125;&quot;</span><br><span class="line">pod_infra_image_repo: &quot;&#123;&#123; kube_image_repo &#125;&#125;&#x2F;pause&quot;</span><br><span class="line"></span><br><span class="line">kube_proxy_image_repo: &quot;&#123;&#123; kube_image_repo &#125;&#125;&#x2F;kube-proxy&quot;</span><br><span class="line">kube_apiserver_image_repo: &quot;&#123;&#123; kube_image_repo &#125;&#125;&#x2F;kube-apiserver&quot;</span><br><span class="line">kube_scheduler_image_repo: &quot;&#123;&#123; kube_image_repo &#125;&#125;&#x2F;kube-scheduler&quot;</span><br><span class="line">kube_controller_manager_image_repo: &quot;&#123;&#123; kube_image_repo &#125;&#125;&#x2F;kube-controller-manager&quot;</span><br><span class="line"></span><br><span class="line">coredns_image_tag: &quot;&#123;&#123; coredns_version &#125;&#125;&quot;</span><br><span class="line">dnsautoscaler_image_tag: &quot;&#123;&#123; dnsautoscaler_version &#125;&#125;&quot;</span><br><span class="line">coredns_image_repo: &quot;&#123;&#123; docker_image_repo &#125;&#125;&#x2F;coredns&quot;</span><br><span class="line">dnsautoscaler_image_repo: &quot;&#123;&#123; kube_image_repo &#125;&#125;&#x2F;cluster-proportional-autoscaler-&#123;&#123; image_arch &#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line"># Full image name for generate images list</span><br><span class="line">kube_proxy_image_name: &quot;&#123;&#123; kube_proxy_image_repo &#125;&#125;:&#123;&#123; kube_version &#125;&#125;&quot;</span><br><span class="line">kube_apiserver_image_name: &quot;&#123;&#123; kube_apiserver_image_repo &#125;&#125;:&#123;&#123; kube_version &#125;&#125;&quot;</span><br><span class="line">kube_scheduler_image_name: &quot;&#123;&#123; kube_scheduler_image_repo &#125;&#125;:&#123;&#123; kube_version &#125;&#125;&quot;</span><br><span class="line">kube_controller_manager_image_name: &quot;&#123;&#123; kube_controller_manager_image_repo &#125;&#125;:&#123;&#123; kube_version &#125;&#125;&quot;</span><br><span class="line">coredns_image_name: &quot;&#123;&#123; coredns_image_repo &#125;&#125;:&#123;&#123; coredns_image_tag &#125;&#125;&quot;</span><br><span class="line">dnsautoscaler_image_name: &quot;&#123;&#123; dnsautoscaler_image_repo &#125;&#125;:&#123;&#123; dnsautoscaler_image_tag &#125;&#125;&quot;</span><br><span class="line">nginx_image_name: &quot;&#123;&#123; nginx_image_repo &#125;&#125;:&#123;&#123; nginx_image_tag &#125;&#125;&quot;</span><br><span class="line">pod_infra_image_name: &quot;&#123;&#123; pod_infra_image_repo &#125;&#125;:&#123;&#123; pod_infra_image_tag &#125;&#125;&quot;</span><br><span class="line">calico_policy_image_name: &quot;&#123;&#123; calico_policy_image_repo &#125;&#125;:&#123;&#123; calico_policy_image_tag &#125;&#125;&quot;</span><br><span class="line">calico_cni_image_name: &quot;&#123;&#123; calico_cni_image_repo &#125;&#125;:&#123;&#123; calico_cni_image_tag &#125;&#125;&quot;</span><br><span class="line">calico_node_image_name: &quot;&#123;&#123; calico_node_image_repo &#125;&#125;:&#123;&#123; calico_node_image_tag &#125;&#125;&quot;</span><br><span class="line">flannel_image_name: &quot;&#123;&#123; flannel_image_repo &#125;&#125;:&#123;&#123; flannel_image_tag &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><ul><li><code>generate.sh</code> åˆ—è¡¨ç”Ÿæˆè„šæœ¬</li></ul><p>æˆ‘ä»¬æ ¹æ®ä¸Šé¢ group_vars ä¸­å®šä¹‰çš„ç‰ˆæœ¬å·å’Œä¸€äº›å‚æ•°ï¼Œä½¿ç”¨è„šæœ¬çš„æ–¹å¼è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨å’Œé•œåƒåˆ—è¡¨ï¼Œæ„å»ºçš„æ—¶å€™æ ¹æ®è¿™äº›åˆ—è¡¨æ¥ä¸‹è½½æ‰€éœ€è¦çš„æ–‡ä»¶å’Œé•œåƒã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">set -eo pipefail</span><br><span class="line"></span><br><span class="line">SCRIPT_PATH&#x3D;$(cd $(dirname $0); pwd)</span><br><span class="line">REPO_PATH&#x3D;&quot;$&#123;SCRIPT_PATH%&#x2F;build&#125;&quot;</span><br><span class="line"></span><br><span class="line">: $&#123;IMAGE_ARCH:&#x3D;&quot;amd64&quot;&#125;</span><br><span class="line">: $&#123;ANSIBLE_ARCHITECTURE:&#x3D;&quot;x86_64&quot;&#125;</span><br><span class="line">: $&#123;DOWNLOAD_YML:&#x3D;&quot;config&#x2F;group_vars&#x2F;all&#x2F;download.yml&quot;&#125;</span><br><span class="line"></span><br><span class="line"># ARCH used in convert &#123;%- if image_arch !&#x3D; &#39;amd64&#39; -%&#125;-&#123;&#123; image_arch &#125;&#125;&#123;%- endif -%&#125; to &#123;&#123;arch&#125;&#125;</span><br><span class="line">if [[ &quot;$&#123;IMAGE_ARCH&#125;&quot; !&#x3D; &quot;amd64&quot; ]]; then ARCH&#x3D;&quot;-$&#123;IMAGE_ARCH&#125;&quot;; fi</span><br><span class="line"></span><br><span class="line">cat &gt; &#x2F;tmp&#x2F;generate.sh &lt;&lt; EOF</span><br><span class="line">arch&#x3D;$&#123;ARCH&#125;</span><br><span class="line">download_url&#x3D;https:&#x2F;</span><br><span class="line">image_arch&#x3D;$&#123;IMAGE_ARCH&#125;</span><br><span class="line">ansible_system&#x3D;linux</span><br><span class="line">ansible_architecture&#x3D;$&#123;ANSIBLE_ARCHITECTURE&#125;</span><br><span class="line">registry_project&#x3D;library</span><br><span class="line">registry_domain&#x3D;localhost</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># generate all component version by $DOWNLOAD_YML</span><br><span class="line">grep &#39;_version:&#39; $&#123;REPO_PATH&#125;&#x2F;$&#123;DOWNLOAD_YML&#125; \</span><br><span class="line">| sed &#39;s&#x2F;: &#x2F;&#x3D;&#x2F;g;s&#x2F;&#123;&#123;&#x2F;$&#123;&#x2F;g;s&#x2F;&#125;&#125;&#x2F;&#125;&#x2F;g&#39; | tr -d &#39; &#39; &gt;&gt; &#x2F;tmp&#x2F;generate.sh</span><br><span class="line"></span><br><span class="line"># generate download files url list</span><br><span class="line">grep &#39;_download_url:&#39; $&#123;REPO_PATH&#125;&#x2F;$&#123;DOWNLOAD_YML&#125; \</span><br><span class="line">| sed &#39;s&#x2F;: &#x2F;&#x3D;&#x2F;g;s&#x2F; &#x2F;&#x2F;g;s&#x2F;&#123;&#123;&#x2F;$&#123;&#x2F;g;s&#x2F;&#125;&#125;&#x2F;&#125;&#x2F;g;s&#x2F;|lower&#x2F;&#x2F;g;s&#x2F;^.*_url&#x3D;&#x2F;echo &#x2F;g&#39; &gt;&gt; &#x2F;tmp&#x2F;generate.sh</span><br><span class="line"></span><br><span class="line"># generate download images list</span><br><span class="line">grep -E &#39;_image_tag:|_image_repo:|_image_name:&#39; $&#123;REPO_PATH&#125;&#x2F;$&#123;DOWNLOAD_YML&#125; \</span><br><span class="line">| sed &quot;s#&#123;%- if image_arch !&#x3D; &#39;amd64&#39; -%&#125;-&#123;&#123; image_arch &#125;&#125;&#123;%- endif -%&#125;#&#123;&#123;arch&#125;&#125;#g&quot; \</span><br><span class="line">| sed &#39;s&#x2F;: &#x2F;&#x3D;&#x2F;g;s&#x2F;&#123;&#123;&#x2F;$&#123;&#x2F;g;s&#x2F;&#125;&#125;&#x2F;&#125;&#x2F;g&#39; | tr -d &#39; &#39; &gt;&gt; &#x2F;tmp&#x2F;generate.sh</span><br><span class="line"></span><br><span class="line">grep &#39;_image_name:&#39; $&#123;REPO_PATH&#125;&#x2F;$&#123;DOWNLOAD_YML&#125; \</span><br><span class="line">| cut -d &#39;:&#39; -f1 | sed &#39;s&#x2F;^&#x2F;echo $&#x2F;g&#39; &gt;&gt; &#x2F;tmp&#x2F;generate.sh</span><br></pre></td></tr></table></figure><p>ä¸ºäº†åŒæ—¶æ”¯æŒ amd64 å’Œ arm64 çš„ CPU æ¶æ„ï¼Œéœ€è¦ä¸ºä¸¤ç§æ¶æ„å„è‡ªç”Ÿæˆåˆ—è¡¨ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ä¸€ä¸‹ã€‚åœ¨è¿™é‡Œè¸©çš„ä¸€ä¸ªå‘å°±æ˜¯ä¸åŒçš„ç»„ä»¶é•œåƒçš„å‘½åæ–¹æ³•åƒå·®ä¸‡åˆ«ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å››ç§æƒ…å†µï¼š</p><ul><li>åƒ kube-apiserver è¿™äº› k8s ç»„ä»¶çš„é•œåƒï¼Œé•œåƒåç§°å’Œé•œåƒ tag æ˜¯ä¸éœ€è¦åŠ ä¸Š CPU ä½“ç³»æ¶æ„çš„ï¼›</li><li>cluster-proportional-autoscaler çš„é•œåƒåˆ™æ˜¯åœ¨é•œåƒçš„åç§°åé¢åŠ ä¸Šäº† CPU ä½“ç³»æ¶æ„çš„åç§°å¦‚ cluster-proportional-autoscaler-amd64ï¼Œcluster-proportional-autoscaler-arm64ï¼›</li><li>flannel åˆ™æ˜¯å°† CPU ä½“ç³»æ¶æ„åç§°å®šä¹‰åœ¨é•œåƒ tag åé¢æ¯”å¦‚ <code>flannel:v0.14.0-amd64</code>ï¼›</li><li>è¿˜æœ‰ calico æ›´å¥‡è‘©ï¼Œamd64 æ¶æ„çš„é•œåƒä¸éœ€è¦åŠ ä½“ç³»æ¶æ„çš„åç§°å¦‚ <code>calico/cni:v3.18.4</code>ï¼Œè€Œ arm64 çš„åˆ™å¿…é¡»è¦åœ¨é•œåƒ tag åé¢å¸¦ä¸Š CPU ä½“ç³»æ¶æ„æ¯”å¦‚ <code>calico/cni:v3.18.4-arm64</code>ï¼›</li></ul><p>åœ¨è¿™é‡Œéœ€è¦å¼ºè°ƒä¸€ä¸‹ï¼Œæ–‡ä»¶åˆ—è¡¨å’Œé•œåƒåˆ—è¡¨ä¸€å®šè¦ä½¿ç”¨è‡ªåŠ¨åŒ–çš„æ–¹å¼æ¥ç®¡ç†ï¼Œåˆ‡å‹¿æ‰‹åŠ¨æ›´æ–°ï¼Œè¿™æ ·èƒ½èŠ‚çœå¤§é‡çš„ç»´æŠ¤æˆæœ¬ï¼Œä¸ç„¶çš„è¯æ¯æ¬¡éƒ½æ‰‹åŠ¨å»æ›´æ–°è¿™äº›åˆ—è¡¨æˆæœ¬å®åœ¨æ˜¯å¤ªé«˜äº†ï¼Œè€Œä¸”ç‰¹åˆ«å®¹æ˜“å‡ºå‡ºé”™æˆ–è€…é—æ¼æŸä¸ªç»„ä»¶ã€‚</p><h3><span id="kubespray-files">kubespray-files</span></h3><p>æˆ‘ä»¬å°† kubespray éƒ¨ç½²æ‰€ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶æ„å»ºåœ¨ä¸€ä¸ªåä¸º kubespray-files çš„é•œåƒå½“ä¸­ï¼š</p><ul><li>ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;get.helm.sh&#x2F;helm-v3.6.3-linux-amd64.tar.gz</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;containerd&#x2F;nerdctl&#x2F;releases&#x2F;download&#x2F;v0.8.1&#x2F;nerdctl-0.8.1-linux-amd64.tar.gz</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;containernetworking&#x2F;plugins&#x2F;releases&#x2F;download&#x2F;v0.9.1&#x2F;cni-plugins-linux-amd64-v0.9.1.tgz</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;coreos&#x2F;etcd&#x2F;releases&#x2F;download&#x2F;v3.4.13&#x2F;etcd-v3.4.13-linux-amd64.tar.gz</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;k8sli&#x2F;kubernetes&#x2F;releases&#x2F;download&#x2F;v1.21.3-patch-1.0&#x2F;kubeadm-linux-amd64</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;kubernetes-sigs&#x2F;cri-tools&#x2F;releases&#x2F;download&#x2F;v1.21.0&#x2F;crictl-v1.21.0-linux-amd64.tar.gz</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;projectcalico&#x2F;calico&#x2F;archive&#x2F;v3.18.4.tar.gz</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;projectcalico&#x2F;calicoctl&#x2F;releases&#x2F;download&#x2F;v3.18.4&#x2F;calicoctl-linux-amd64</span><br><span class="line">https:&#x2F;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;v1.21.3&#x2F;bin&#x2F;linux&#x2F;amd64&#x2F;kubeadm</span><br><span class="line">https:&#x2F;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;v1.21.3&#x2F;bin&#x2F;linux&#x2F;amd64&#x2F;kubectl</span><br><span class="line">https:&#x2F;&#x2F;storage.googleapis.com&#x2F;kubernetes-release&#x2F;release&#x2F;v1.21.3&#x2F;bin&#x2F;linux&#x2F;amd64&#x2F;kubelet</span><br></pre></td></tr></table></figure><ul><li>Dockerfile</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest as files</span><br><span class="line">RUN apk --no-cache add wget ca-certificates</span><br><span class="line">WORKDIR &#x2F;build</span><br><span class="line">COPY build&#x2F;kubespray-files&#x2F;files_*.list &#x2F;build&#x2F;</span><br><span class="line">RUN ARCH&#x3D;$(uname -m | sed &#39;s&#x2F;x86_64&#x2F;amd64&#x2F;;s&#x2F;aarch64&#x2F;arm64&#x2F;&#39;) \</span><br><span class="line">    &amp;&amp; sed &#39;&#x2F;#&#x2F;d&#39; *$&#123;ARCH&#125;.list &gt; all_files.list \</span><br><span class="line">    &amp;&amp; wget -q -x -P &#x2F;files -i all_files.list</span><br><span class="line"></span><br><span class="line">FROM scratch</span><br><span class="line">COPY --from&#x3D;files &#x2F;files &#x2F;files</span><br></pre></td></tr></table></figure><ul><li>æ„å»ºåçš„ç›®å½•ç»“æ„ï¼Œé€šè¿‡ç›®å½•å±‚çº§çš„æ–¹å¼ä¿ç•™åŸæœ‰çš„ URL åœ°å€ï¼Œç»´æŠ¤å’Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">files&#x2F;</span><br><span class="line">â”œâ”€â”€ get.helm.sh</span><br><span class="line">â”‚   â””â”€â”€ helm-v3.6.3-linux-amd64.tar.gz</span><br><span class="line">â”œâ”€â”€ github.com</span><br><span class="line">â”‚   â”œâ”€â”€ containerd</span><br><span class="line">â”‚   â”‚   â””â”€â”€ nerdctl</span><br><span class="line">â”‚   â”‚       â””â”€â”€ releases</span><br><span class="line">â”‚   â”‚           â””â”€â”€ download</span><br><span class="line">â”‚   â”‚               â””â”€â”€ v0.8.1</span><br><span class="line">â”‚   â”‚                   â””â”€â”€ nerdctl-0.8.1-linux-amd64.tar.gz</span><br><span class="line">â”‚   â”œâ”€â”€ containernetworking</span><br><span class="line">â”‚   â”‚   â””â”€â”€ plugins</span><br><span class="line">â”‚   â”‚       â””â”€â”€ releases</span><br><span class="line">â”‚   â”‚           â””â”€â”€ download</span><br><span class="line">â”‚   â”‚               â””â”€â”€ v0.9.1</span><br><span class="line">â”‚   â”‚                   â””â”€â”€ cni-plugins-linux-amd64-v0.9.1.tgz</span><br><span class="line">â”‚   â”œâ”€â”€ coreos</span><br><span class="line">â”‚   â”‚   â””â”€â”€ etcd</span><br><span class="line">â”‚   â”‚       â””â”€â”€ releases</span><br><span class="line">â”‚   â”‚           â””â”€â”€ download</span><br><span class="line">â”‚   â”‚               â””â”€â”€ v3.4.13</span><br><span class="line">â”‚   â”‚                   â””â”€â”€ etcd-v3.4.13-linux-amd64.tar.gz</span><br><span class="line">â”‚   â”œâ”€â”€ k8sli</span><br><span class="line">â”‚   â”‚   â””â”€â”€ kubernetes</span><br><span class="line">â”‚   â”‚       â””â”€â”€ releases</span><br><span class="line">â”‚   â”‚           â””â”€â”€ download</span><br><span class="line">â”‚   â”‚               â””â”€â”€ v1.21.3-patch-1.0</span><br><span class="line">â”‚   â”‚                   â””â”€â”€ kubeadm-linux-amd64</span><br><span class="line">â”‚   â”œâ”€â”€ kubernetes-sigs</span><br><span class="line">â”‚   â”‚   â””â”€â”€ cri-tools</span><br><span class="line">â”‚   â”‚       â””â”€â”€ releases</span><br><span class="line">â”‚   â”‚           â””â”€â”€ download</span><br><span class="line">â”‚   â”‚               â””â”€â”€ v1.21.0</span><br><span class="line">â”‚   â”‚                   â””â”€â”€ crictl-v1.21.0-linux-amd64.tar.gz</span><br><span class="line">â”‚   â””â”€â”€ projectcalico</span><br><span class="line">â”‚       â”œâ”€â”€ calico</span><br><span class="line">â”‚       â”‚   â””â”€â”€ archive</span><br><span class="line">â”‚       â”‚       â””â”€â”€ v3.18.4.tar.gz</span><br><span class="line">â”‚       â””â”€â”€ calicoctl</span><br><span class="line">â”‚           â””â”€â”€ releases</span><br><span class="line">â”‚               â””â”€â”€ download</span><br><span class="line">â”‚                   â””â”€â”€ v3.18.4</span><br><span class="line">â”‚                       â””â”€â”€ calicoctl-linux-amd64</span><br><span class="line">â””â”€â”€ storage.googleapis.com</span><br><span class="line">    â””â”€â”€ kubernetes-release</span><br><span class="line">        â””â”€â”€ release</span><br><span class="line">            â””â”€â”€ v1.21.3</span><br><span class="line">                â””â”€â”€ bin</span><br><span class="line">                    â””â”€â”€ linux</span><br><span class="line">                        â””â”€â”€ amd64</span><br><span class="line">                            â”œâ”€â”€ kubeadm</span><br><span class="line">                            â”œâ”€â”€ kubectl</span><br><span class="line">                            â””â”€â”€ kubelet</span><br></pre></td></tr></table></figure><h3><span id="kubespray-images">kubespray-images</span></h3><p>æˆ‘ä»¬åŒæ ·å°† kubespray éƒ¨ç½²æ‰€éœ€è¦çš„ç»„ä»¶é•œåƒæ„å»ºåœ¨ä¸€ä¸ªåä¸º kubespray-images çš„é•œåƒå½“ä¸­ï¼š</p><ul><li>é•œåƒåˆ—è¡¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">library&#x2F;calico-cni:v3.18.4</span><br><span class="line">library&#x2F;calico-kube-controllers:v3.18.4</span><br><span class="line">library&#x2F;calico-node:v3.18.4</span><br><span class="line">library&#x2F;calico-pod2daemon-flexvol:v3.18.4</span><br><span class="line">library&#x2F;cluster-proportional-autoscaler-amd64:1.8.3</span><br><span class="line">library&#x2F;coredns:v1.8.0</span><br><span class="line">library&#x2F;flannel:v0.14.0-amd64</span><br><span class="line">library&#x2F;kube-apiserver:v1.21.3</span><br><span class="line">library&#x2F;kube-controller-manager:v1.21.3</span><br><span class="line">library&#x2F;kube-proxy:v1.21.3</span><br><span class="line">library&#x2F;kube-scheduler:v1.21.3</span><br><span class="line">library&#x2F;nginx:1.19</span><br><span class="line">library&#x2F;pause:3.3</span><br></pre></td></tr></table></figure><ul><li>Dockerfile</li></ul><p>åœ¨ Dockerfile é‡Œå®Œæˆæ‰€æœ‰é•œåƒçš„ä¸‹è½½ï¼Œå¹¶ä½¿ç”¨ ã€Š<a href="https://blog.k8s.li/skopeo-to-registry.html" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§</a>ã€‹æ–‡ä¸­æåˆ°çš„éªšæ“ä½œï¼Œåˆ©ç”¨ registry å­˜å‚¨å¤ç”¨ç›¸åŒ layer çš„ç‰¹æ€§ï¼Œå°† skopeo sync ä¸‹è½½çš„é•œåƒè½¬æ¢æˆ registry å­˜å‚¨çš„ç»“æ„ã€‚è¿™æ ·åœ¨éƒ¨ç½²çš„æ—¶å€™ç›´æ¥æŠŠè¿™ä¸ª registry å­˜å‚¨ç›®å½•æŒ‚è½½è¿› registry å®¹å™¨çš„ <code>/var/lib/registry</code> å³å¯ã€‚ç‰¹ç‚¹æ˜¯æ€§èƒ½æ–¹é¢æ— è®ºæ˜¯æ„å»ºå’Œéƒ¨ç½²ï¼Œéƒ½æ¯”å¸¸è§„ä½¿ç”¨ docker save å’Œ docker load çš„æ–¹å¼è¦å¿«è‡³å°‘ 5 åˆ° 10 å€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:3.12 as images</span><br><span class="line">ARG SKOPEO_VERSION&#x3D;v1.4.0</span><br><span class="line">ARG YQ_VERSION&#x3D;v4.11.2</span><br><span class="line">RUN ARCH&#x3D;$(uname -m | sed &#39;s&#x2F;x86_64&#x2F;amd64&#x2F;;s&#x2F;aarch64&#x2F;arm64&#x2F;&#39;) \</span><br><span class="line">    &amp;&amp; apk --no-cache add bash wget ca-certificates \</span><br><span class="line">    &amp;&amp; wget -q -k https:&#x2F;&#x2F;github.com&#x2F;mikefarah&#x2F;yq&#x2F;releases&#x2F;download&#x2F;$&#123;YQ_VERSION&#125;&#x2F;yq_linux_$&#123;ARCH&#125; -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;yq \</span><br><span class="line">    &amp;&amp; wget -q -k https:&#x2F;&#x2F;github.com&#x2F;k8sli&#x2F;skopeo&#x2F;releases&#x2F;download&#x2F;$&#123;SKOPEO_VERSION&#125;&#x2F;skopeo-linux-$&#123;ARCH&#125; -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;skopeo \</span><br><span class="line">    &amp;&amp; chmod a+x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;*</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;build</span><br><span class="line">COPY build&#x2F;kubespray-images&#x2F;*  &#x2F;build&#x2F;</span><br><span class="line">RUN ARCH&#x3D;$(uname -m | sed &#39;s&#x2F;x86_64&#x2F;amd64&#x2F;;s&#x2F;aarch64&#x2F;arm64&#x2F;&#39;) \</span><br><span class="line">    &amp;&amp; IMAGE_ARCH&#x3D;$&#123;ARCH&#125; bash build.sh</span><br><span class="line"></span><br><span class="line">FROM scratch</span><br><span class="line">COPY --from&#x3D;images &#x2F;build&#x2F;docker &#x2F;docker</span><br></pre></td></tr></table></figure><ul><li>images_origin.yaml é•œåƒé…ç½®æ–‡ä»¶</li></ul><p>è€ƒè™‘åˆ°æœ‰å°†é•œåƒå¯¼å…¥åˆ°å·²ç»å­˜åœ¨çš„é•œåƒä»“åº“ä¸­çš„åœºæ™¯ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹é•œåƒä»“åº“çš„ repoã€‚å› ä¸º <code>library</code> è¿™ä¸ª repo åœ¨ harbor ä¸­æ˜¯é»˜è®¤è‡ªå¸¦çš„ï¼Œåœ¨å¯¼å…¥åˆ° harbor çš„è¿‡ç¨‹ä¸­ä¹Ÿä¸éœ€è¦åˆ›å»ºä¸€äº›é¢å¤–çš„ project ï¼Œæ‰€ä»¥å°†æ‰€æœ‰é•œåƒçš„ repo å…¨éƒ¨ç»Ÿä¸€ä¸º <code>library</code> æ›´é€šç”¨ä¸€äº›ã€‚</p><p>è¿™é‡Œç”¨ä¸€ä¸ª yaml é…ç½®æ–‡ä»¶æ¥è®°å½•åŸé•œåƒåœ°å€å’Œ library é•œåƒçš„åœ°å€çš„å¯¹åº”å…³ç³»ã€‚æ¯”å¦‚ä¸Šæ¸¸çš„ <code>k8s.gcr.io/kube-apiserver</code> æ˜ å°„ä¸º <code>library/kube-apiserver</code>ï¼Œ <code>quay.io/calico/node</code> æ˜ å°„ä¸º <code>library/calico-node</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"># kubeadm core images</span><br><span class="line">- src: k8s.gcr.io&#x2F;kube-apiserver</span><br><span class="line">  dest: library&#x2F;kube-apiserver</span><br><span class="line">- src: k8s.gcr.io&#x2F;kube-controller-manager</span><br><span class="line">  dest: library&#x2F;kube-controller-manager</span><br><span class="line">- src: k8s.gcr.io&#x2F;kube-proxy</span><br><span class="line">  dest: library&#x2F;kube-proxy</span><br><span class="line">- src: k8s.gcr.io&#x2F;kube-scheduler</span><br><span class="line">  dest: library&#x2F;kube-scheduler</span><br><span class="line">- src: k8s.gcr.io&#x2F;coredns&#x2F;coredns</span><br><span class="line">  dest: library&#x2F;coredns</span><br><span class="line">- src: k8s.gcr.io&#x2F;pause</span><br><span class="line">  dest: library&#x2F;pause</span><br><span class="line"></span><br><span class="line"># kubernetes addons</span><br><span class="line">- src: k8s.gcr.io&#x2F;dns&#x2F;k8s-dns-node-cache</span><br><span class="line">  dest: library&#x2F;k8s-dns-node-cache</span><br><span class="line">- src: k8s.gcr.io&#x2F;cpa&#x2F;cluster-proportional-autoscaler-amd64</span><br><span class="line">  dest: library&#x2F;cluster-proportional-autoscaler-amd64</span><br><span class="line">- src: k8s.gcr.io&#x2F;cpa&#x2F;cluster-proportional-autoscaler-arm64</span><br><span class="line">  dest: library&#x2F;cluster-proportional-autoscaler-arm64</span><br><span class="line"></span><br><span class="line"># network plugin</span><br><span class="line">- src: quay.io&#x2F;calico&#x2F;cni</span><br><span class="line">  dest: library&#x2F;calico-cni</span><br><span class="line">- src: quay.io&#x2F;calico&#x2F;node</span><br><span class="line">  dest: library&#x2F;calico-node</span><br><span class="line">- src: quay.io&#x2F;calico&#x2F;kube-controllers</span><br><span class="line">  dest: library&#x2F;calico-kube-controllers</span><br><span class="line">- src: quay.io&#x2F;calico&#x2F;pod2daemon-flexvol</span><br><span class="line">  dest: library&#x2F;calico-pod2daemon-flexvol</span><br><span class="line"></span><br><span class="line">- src: quay.io&#x2F;calico&#x2F;typha</span><br><span class="line">  dest: library&#x2F;calico-typha</span><br><span class="line">- src: quay.io&#x2F;coreos&#x2F;flannel</span><br><span class="line">  dest: library&#x2F;flannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># nginx for daemonset and offline</span><br><span class="line">- src: docker.io&#x2F;library&#x2F;nginx</span><br><span class="line">  dest: library&#x2F;nginx</span><br></pre></td></tr></table></figure><h3><span id="kubeplay">kubeplay</span></h3><p>kubeplay éƒ¨ç½²çš„ä»£ç ä¸»è¦æ˜¯ç”±ä¸€äº› shell è„šæœ¬å’Œé…ç½®æ–‡ä»¶æ„æˆï¼Œç”¨äºå®Œæˆ nginx æœåŠ¡å’Œ registry æœåŠ¡çš„éƒ¨ç½²ï¼Œä»¥åŠæœ€åè°ƒç”¨ kubespray æ¥å®Œæˆé›†ç¾¤éƒ¨ç½²ã€‚</p><blockquote><p>kubeplay é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/k8sli/kubeplay" target="_blank" rel="noopener">https://github.com/k8sli/kubeplay</a></p></blockquote><ul><li>ä»£ç ç»“æ„</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kubeplay&#x2F;</span><br><span class="line">â”œâ”€â”€ Dockerfile          # æ„å»ºå®Œæ•´å®‰è£…åŒ…çš„ Dockerfile</span><br><span class="line">â”œâ”€â”€ compose.yaml        # compose å¯åŠ¨é…ç½® yaml æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ config</span><br><span class="line">â”‚   â”œâ”€â”€ compose</span><br><span class="line">â”‚   â”‚   â””â”€â”€ nginx.conf  # nginx é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ rootCA.cnf      # ç”Ÿæˆé•œåƒä»“åº“è¯ä¹¦ç”¨åˆ°çš„ openssl é…ç½®æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ config-sample.yaml  # ä¸»é…ç½®æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ install.sh          # å®‰è£…æ“ä½œç„¶å</span><br><span class="line">â””â”€â”€ library             # ä¸€äº› shell å‡½æ•°åº“</span><br></pre></td></tr></table></figure><ul><li>Dockerfile</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest as downloader</span><br><span class="line">ARG SKOPEO_VERSION&#x3D;v1.4.0</span><br><span class="line">ARG YQ_VERSION&#x3D;v4.11.2</span><br><span class="line">ARG NERDCTL_VERSION&#x3D;0.11.0</span><br><span class="line">ARG NGINX_VERSION&#x3D;1.20-alpine</span><br><span class="line">ARG RERGISRRY_VERSION&#x3D;2.7.1</span><br><span class="line">ARG KUBESPRAY_VERSION&#x3D;latest</span><br><span class="line">ARG KUBESPRAY_IMAGE&#x3D;ghcr.io&#x2F;k8sli&#x2F;kubespray</span><br><span class="line"></span><br><span class="line"># ä¸‹è½½éƒ¨ç½²æ—¶éœ€è¦çš„å·¥å…·ï¼Œå¦‚ yqã€skopeoã€nerdctl-fullsss</span><br><span class="line">WORKDIR &#x2F;tools</span><br><span class="line">RUN ARCH&#x3D;$(uname -m | sed &#39;s&#x2F;x86_64&#x2F;amd64&#x2F;;s&#x2F;aarch64&#x2F;arm64&#x2F;&#39;) \</span><br><span class="line">    &amp;&amp; apk --no-cache add wget ca-certificates \</span><br><span class="line">    &amp;&amp; wget -q -k https:&#x2F;&#x2F;github.com&#x2F;mikefarah&#x2F;yq&#x2F;releases&#x2F;download&#x2F;$&#123;YQ_VERSION&#125;&#x2F;yq_linux_$&#123;ARCH&#125;  -O &#x2F;tools&#x2F;yq-linux-$&#123;ARCH&#125; \</span><br><span class="line">    &amp;&amp; wget -q -k https:&#x2F;&#x2F;github.com&#x2F;k8sli&#x2F;skopeo&#x2F;releases&#x2F;download&#x2F;v1.4.0&#x2F;skopeo-linux-$&#123;ARCH&#125; -O &#x2F;tools&#x2F;skopeo-linux-$&#123;ARCH&#125; \</span><br><span class="line">    &amp;&amp; wget -q -k https:&#x2F;&#x2F;github.com&#x2F;containerd&#x2F;nerdctl&#x2F;releases&#x2F;download&#x2F;v$&#123;NERDCTL_VERSION&#125;&#x2F;nerdctl-full-$&#123;NERDCTL_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz \</span><br><span class="line">    &amp;&amp; chmod a+x &#x2F;tools&#x2F;* \</span><br><span class="line">    &amp;&amp; ln -s &#x2F;tools&#x2F;skopeo-linux-$&#123;ARCH&#125; &#x2F;usr&#x2F;bin&#x2F;skopeo</span><br><span class="line"></span><br><span class="line"># ä¸‹è½½ä¸€äº›é•œåƒï¼Œå¦‚ nginxã€registryã€kubespray</span><br><span class="line">WORKDIR &#x2F;images</span><br><span class="line">RUN ARCH&#x3D;$(uname -m | sed &#39;s&#x2F;x86_64&#x2F;amd64&#x2F;;s&#x2F;aarch64&#x2F;arm64&#x2F;&#39;) \</span><br><span class="line">    &amp;&amp; skopeo copy --insecure-policy --src-tls-verify&#x3D;false --override-arch $&#123;ARCH&#125; --additional-tag nginx:$&#123;NGINX_VERSION&#125; \</span><br><span class="line">       docker:&#x2F;&#x2F;docker.io&#x2F;library&#x2F;nginx:$&#123;NGINX_VERSION&#125; docker-archive:nginx-$&#123;NGINX_VERSION&#125;.tar \</span><br><span class="line">    &amp;&amp; skopeo copy --insecure-policy --src-tls-verify&#x3D;false --override-arch $&#123;ARCH&#125; --additional-tag registry:$&#123;RERGISRRY_VERSION&#125; \</span><br><span class="line">       docker:&#x2F;&#x2F;docker.io&#x2F;library&#x2F;registry:$&#123;RERGISRRY_VERSION&#125; docker-archive:registry-$&#123;RERGISRRY_VERSION&#125;.tar \</span><br><span class="line">    &amp;&amp; skopeo copy --insecure-policy --src-tls-verify&#x3D;false --override-arch $&#123;ARCH&#125; --additional-tag kubespray:$&#123;KUBESPRAY_VERSION&#125; \</span><br><span class="line">       docker:&#x2F;&#x2F;$&#123;KUBESPRAY_IMAGE&#125;:$&#123;KUBESPRAY_VERSION&#125; docker-archive:kubespray-$&#123;KUBESPRAY_VERSION&#125;.tar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FROM scratch</span><br><span class="line">COPY . .</span><br><span class="line"> # å°†å…¶å®ƒæ¨¡å—ä¸­çš„å†…å®¹å¤åˆ¶åˆ° scratch é•œåƒä¸­ï¼Œæ„å»ºçš„æ—¶å€™å¯¼å‡ºä¸º local æ–¹å¼</span><br><span class="line">COPY --from&#x3D;downloader &#x2F;tools &#x2F;resources&#x2F;nginx&#x2F;tools</span><br><span class="line">COPY --from&#x3D;downloader &#x2F;images &#x2F;resources&#x2F;images</span><br><span class="line">COPY --from&#x3D;$&#123;OS_PACKAGES_IMAGE&#125;:$&#123;OS_PACKAGE_REPO_TAG&#125; &#x2F; &#x2F;resources&#x2F;nginx</span><br><span class="line">COPY --from&#x3D;$&#123;KUBESPRAY_FILES_IMAGE&#125;:$&#123;KUBESPRAY_REPO_TAG&#125; &#x2F; &#x2F;resources&#x2F;nginx</span><br><span class="line">COPY --from&#x3D;$&#123;KUBESPRAY_IMAGES_IMAGE&#125;:$&#123;KUBESPRAY_REPO_TAG&#125; &#x2F; &#x2F;resources&#x2F;registry</span><br></pre></td></tr></table></figure><h3><span id="æ„å»º">æ„å»º</span></h3><p>ç”±äºæœ€ç»ˆçš„æ„å»ºæ¶‰åŠå¤šä¸ªæ¨¡å—å’Œ repoï¼Œå…¶æµç¨‹æ¯”è¾ƒå¤æ‚ï¼Œè¯¦ç»†çš„ä»£ç å¯å‚è€ƒæºç  <a href="https://github.com/k8sli/kubeplay/blob/main/.github/workflows/build.yaml" target="_blank" rel="noopener">build.yaml</a> ï¼Œåœ¨è¿™é‡Œåªè®²å‡ ä¸ªå…³é”®çš„éƒ¨åˆ†</p><ul><li>checkout repoï¼Œå°† kubespray å’Œ os-packages repo clone åˆ°å·¥ä½œç›®å½•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-package:</span><br><span class="line">    # ä»¥ tag çš„äº‹ä»¶è§¦å‘æ„å»ºæµæ°´çº¿</span><br><span class="line">    if: startsWith(github.ref, &#39;refs&#x2F;tags&#x2F;&#39;)</span><br><span class="line">    runs-on: ubuntu-20.04</span><br><span class="line">    steps:</span><br><span class="line">      - name: Checkout</span><br><span class="line">        uses: actions&#x2F;checkout@v2</span><br><span class="line">        with:</span><br><span class="line">          # fetch all git repo tag for define image tag</span><br><span class="line">          fetch-depth: 0</span><br><span class="line"></span><br><span class="line">      - name: Checkout kubespray repo</span><br><span class="line">        uses: actions&#x2F;checkout@v2</span><br><span class="line">        with:</span><br><span class="line">          ref: main</span><br><span class="line">          fetch-depth: 0</span><br><span class="line">          path: kubespray</span><br><span class="line">          repository: $&#123;&#123; github.repository_owner &#125;&#125;&#x2F;kubespray</span><br><span class="line"></span><br><span class="line">      - name: Checkout os-packages repo</span><br><span class="line">        uses: actions&#x2F;checkout@v2</span><br><span class="line">        with:</span><br><span class="line">          ref: main</span><br><span class="line">          fetch-depth: 0</span><br><span class="line">          path: os-packages</span><br><span class="line">          repository: $&#123;&#123; github.repository_owner &#125;&#125;&#x2F;os-packages</span><br></pre></td></tr></table></figure><ul><li>è·å– kubespray å’Œ os-packages çš„ repo tagï¼Œæ ¹æ®å®ƒæ¥ç¡®å®š os-packages, kubespray-files, kubespray-images è¿™ä¸ªä¸‰ä¸ªé•œåƒçš„ tagï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª All in One çš„ Dockerfile ç”¨äºå®Œæˆåç»­å®‰è£…åŒ…çš„æ„å»ºã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># è·å–ä¸€äº›ç»„ä»¶çš„ç‰ˆæœ¬å’Œå˜é‡ä¼ é€’ç»™ Dockerfile</span><br><span class="line">- name: Prepare for build images</span><br><span class="line">  shell: bash</span><br><span class="line">  run: |</span><br><span class="line">    git describe --tags --always | sed &#39;s&#x2F;^&#x2F;IMAGE_TAG&#x3D;&#x2F;&#39; &gt;&gt; $GITHUB_ENV</span><br><span class="line"></span><br><span class="line">    cd kubespray &amp;&amp; git describe --tags --always | sed &#39;s&#x2F;^&#x2F;KUBESPRAY_VERSION&#x3D;&#x2F;&#39; &gt;&gt; $GITHUB_ENV &amp;&amp; cd ..</span><br><span class="line">    cd os-packages &amp;&amp; git describe --tags --always | sed &#39;s&#x2F;^&#x2F;OS_PACKAGE_REPO_TAG&#x3D;&#x2F;&#39; &gt;&gt; $GITHUB_ENV &amp;&amp; cd ..</span><br><span class="line">    cp -rf kubespray&#x2F;config config&#x2F;kubespray &amp;&amp; rm -rf kubespray os-packages</span><br><span class="line"></span><br><span class="line">    source $GITHUB_ENV</span><br><span class="line">    echo &quot;&quot; &gt;&gt; Dockerfile</span><br><span class="line">    echo &quot;COPY --from&#x3D;$&#123;OS_PACKAGES_IMAGE&#125;:$&#123;OS_PACKAGE_REPO_TAG&#125; &#x2F; &#x2F;resources&#x2F;nginx&quot; &gt;&gt; Dockerfile</span><br><span class="line">    echo &quot;COPY --from&#x3D;$&#123;KUBESPRAY_FILES_IMAGE&#125;:$&#123;KUBESPRAY_VERSION&#125; &#x2F; &#x2F;resources&#x2F;nginx&quot; &gt;&gt; Dockerfile</span><br><span class="line">    echo &quot;COPY --from&#x3D;$&#123;KUBESPRAY_IMAGES_IMAGE&#125;:$&#123;KUBESPRAY_VERSION&#125; &#x2F; &#x2F;resources&#x2F;registry&quot; &gt;&gt; Dockerfile</span><br><span class="line"></span><br><span class="line">    sed -n &#39;s|image: nginx:|NGINX_VERSION&#x3D;|p&#39; compose.yaml | tr -d &#39; &#39; &gt;&gt; $GITHUB_ENV</span><br><span class="line">    sed -n &#39;s|image: registry:|RERGISRRY_VERSION&#x3D;|p&#39; compose.yaml | tr -d &#39; &#39; &gt;&gt; $GITHUB_ENV</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>outputs: type=local,dest=./</code> æ„å»ºé•œåƒåˆ°æœ¬åœ°ç›®å½•è€Œé push åˆ° registry</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- name: Build kubeplay image to local</span><br><span class="line">  uses: docker&#x2F;build-push-action@v2</span><br><span class="line">  with:</span><br><span class="line">    context: .</span><br><span class="line">    file: Dockerfile</span><br><span class="line">    platforms: linux&#x2F;amd64,linux&#x2F;arm64</span><br><span class="line">    build-args: |</span><br><span class="line">      NGINX_VERSION&#x3D;$&#123;&#123; env.NGINX_VERSION &#125;&#125;</span><br><span class="line">      RERGISRRY_VERSION&#x3D;$&#123;&#123; env.RERGISRRY_VERSION &#125;&#125;</span><br><span class="line">      KUBESPRAY_IMAGE&#x3D;$&#123;&#123; env.KUBESPRAY_IMAGE &#125;&#125;</span><br><span class="line">      KUBESPRAY_VERSION&#x3D;$&#123;&#123; env.KUBESPRAY_VERSION &#125;&#125;</span><br><span class="line">    outputs: type&#x3D;local,dest&#x3D;.&#x2F;</span><br></pre></td></tr></table></figure><ul><li>æ‰“åŒ…å¹¶ä¸Šä¼ å®‰è£…åŒ…åˆ° GitHub release å­˜å‚¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- name: Prepare for upload package</span><br><span class="line">  shell: bash</span><br><span class="line">  run: |</span><br><span class="line">    rm -rf linux_&#123;amd64,arm64&#125;&#x2F;&#123;Dockerfile,LICENSE&#125;</span><br><span class="line">    mv linux_amd64 kubeplay</span><br><span class="line">    tar -I pigz -cf kubeplay-$&#123;IMAGE_TAG&#125;-linux-amd64.tar.gz kubeplay --remove-files</span><br><span class="line">    mv linux_arm64 kubeplay</span><br><span class="line">    tar -I pigz -cf kubeplay-$&#123;IMAGE_TAG&#125;-linux-arm64.tar.gz kubeplay --remove-files</span><br><span class="line">    sha256sum kubeplay-$&#123;IMAGE_TAG&#125;-linux-&#123;amd64,arm64&#125;.tar.gz &gt; sha256sum.txt</span><br><span class="line"></span><br><span class="line">- name: Release and upload packages</span><br><span class="line">  uses: softprops&#x2F;action-gh-release@v1</span><br><span class="line">  env:</span><br><span class="line">    GITHUB_TOKEN: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</span><br><span class="line">  with:</span><br><span class="line">    files: |</span><br><span class="line">      sha256sum.txt</span><br><span class="line">      kubeplay-$&#123;&#123; env.IMAGE_TAG &#125;&#125;-linux-amd64.tar.gz</span><br><span class="line">      kubeplay-$&#123;&#123; env.IMAGE_TAG &#125;&#125;-linux-arm64.tar.gz</span><br></pre></td></tr></table></figure><p>ç”±æ­¤ä¸€ä¸ªå®Œæ•´çš„ç¦»çº¿å®‰è£…åŒ…å°±æ„å»ºå®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å†è®²ä¸€ä¸‹å®‰è£…æµç¨‹</p><h2><span id="å®‰è£…æµç¨‹">å®‰è£…æµç¨‹</span></h2><p>åœ¨ <a href="https://github.com/k8sli/kubeplay/releases" target="_blank" rel="noopener">GitHub release é¡µé¢</a> å°†æˆ‘ä»¬çš„ç¦»çº¿å®‰è£…åŒ…ä¸‹è½½åˆ°æœ¬åœ°ï¼Œéœ€è¦æ ¹æ® CPU æ¶æ„çš„ç±»å‹é€‰æ‹©ç›¸åº”çš„å®‰è£…åŒ…ã€‚</p><p><img src="https://p.k8s.li/2021-08-24-offline-deploy-k8s-1.png" alt></p><p>ä¸‹è½½å®Œæˆä¹‹åå†å°†å®‰è£…åŒ…é€šè¿‡ scp æˆ–è€…å…¶ä»–æ–¹å¼ä¸Šä¼ åˆ°å†…ç½‘çš„éƒ¨ç½²èŠ‚ç‚¹ä¸Šï¼Œéƒ¨ç½²çš„æ–‡æ¡£å¯å‚è€ƒ <a href="https://github.com/k8sli/kubeplay" target="_blank" rel="noopener">README</a> ã€‚è¿‡ç¨‹ååˆ†ç®€å•ï¼šåªéœ€è¦å¡«å†™å¥½ <code>config.yaml</code> é…ç½®æ–‡ä»¶ç„¶åæ‰§è¡Œ <code>bash install.sh</code> å³å¯å®Œæˆ K8s é›†ç¾¤çš„ä¸€é”®éƒ¨ç½²ã€‚</p><p>ä¸‹é¢ä»æºç è€Œé README æ–‡æ¡£çš„è§’åº¦æ¥è®²ä¸€ä¸‹éƒ¨ç½²æµç¨‹çš„å®ç°ç»†èŠ‚</p><h3><span id="å®‰è£…åŒ…ç»“æ„">å®‰è£…åŒ…ç»“æ„</span></h3><ul><li>é…ç½®æ–‡ä»¶ <code>config.yaml</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"># nginx ç«¯å£å’Œ registry åŸŸåé…ç½®å‚æ•°</span><br><span class="line">compose:</span><br><span class="line">  # Compose bootstrap node ip, default is local internal ip</span><br><span class="line">  internal_ip: 172.20.0.25</span><br><span class="line">  # Nginx http server bind port for download files and packages</span><br><span class="line">  nginx_http_port: 8080</span><br><span class="line">  # Registry domain for CRI runtime download images</span><br><span class="line">  registry_domain: kube.registry.local</span><br><span class="line"></span><br><span class="line"># kubespray å‚æ•°</span><br><span class="line">kubespray:</span><br><span class="line">  # Kubernetes version by default, only support v1.20.6</span><br><span class="line">  kube_version: v1.21.3</span><br><span class="line">  # For deploy HA cluster you must configure a external apiserver access ip</span><br><span class="line">  external_apiserver_access_ip: 127.0.0.1</span><br><span class="line">  # Set network plugin to calico with vxlan mode by default</span><br><span class="line">  kube_network_plugin: calico</span><br><span class="line">  #Container runtime, only support containerd if offline deploy</span><br><span class="line">  container_manager: containerd</span><br><span class="line">  # Now only support host if use containerd as CRI runtime</span><br><span class="line">  etcd_deployment_type: host</span><br><span class="line">  # Settings for etcd event server</span><br><span class="line">  etcd_events_cluster_setup: true</span><br><span class="line">  etcd_events_cluster_enabled: true</span><br><span class="line"></span><br><span class="line"># é›†ç¾¤èŠ‚ç‚¹ ssh ç™»å½• inventory é…ç½®</span><br><span class="line"># Cluster nodes inventory info</span><br><span class="line">inventory:</span><br><span class="line">  all:</span><br><span class="line">    vars:</span><br><span class="line">      ansible_port: 22</span><br><span class="line">      ansible_user: root</span><br><span class="line">      ansible_ssh_pass: Password</span><br><span class="line">      # ansible_ssh_private_key_file: &#x2F;kubespray&#x2F;config&#x2F;id_rsa</span><br><span class="line">    hosts:</span><br><span class="line">      node1:</span><br><span class="line">        ansible_host: 172.20.0.21</span><br><span class="line">      node2:</span><br><span class="line">        ansible_host: 172.20.0.22</span><br><span class="line">      node3:</span><br><span class="line">        ansible_host: 172.20.0.23</span><br><span class="line">      node4:</span><br><span class="line">        ansible_host: 172.20.0.24</span><br><span class="line">    children:</span><br><span class="line">      kube_control_plane:</span><br><span class="line">        hosts:</span><br><span class="line">          node1:</span><br><span class="line">          node2:</span><br><span class="line">          node3:</span><br><span class="line">      kube_node:</span><br><span class="line">        hosts:</span><br><span class="line">          node1:</span><br><span class="line">          node2:</span><br><span class="line">          node3:</span><br><span class="line">          node4:</span><br><span class="line">      etcd:</span><br><span class="line">        hosts:</span><br><span class="line">          node1:</span><br><span class="line">          node2:</span><br><span class="line">          node3:</span><br><span class="line">      k8s_cluster:</span><br><span class="line">        children:</span><br><span class="line">          kube_control_plane:</span><br><span class="line">          kube_node:</span><br><span class="line">      gpu:</span><br><span class="line">        hosts: &#123;&#125;</span><br><span class="line">      calico_rr:</span><br><span class="line">        hosts: &#123;&#125;</span><br><span class="line"></span><br><span class="line"># ä¸€äº›é»˜è®¤çš„é…ç½®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ— éœ€ä¿®æ”¹</span><br><span class="line">### Default parameters ###</span><br><span class="line">## This filed not need config, will auto update,</span><br><span class="line">## if no special requirement, do not modify these parameters.</span><br><span class="line">default:</span><br><span class="line">  # NTP server ip address or domain, default is internal_ip</span><br><span class="line">  ntp_server:</span><br><span class="line">    - internal_ip</span><br><span class="line">  # Registry ip address, default is internal_ip</span><br><span class="line">  registry_ip: internal_ip</span><br><span class="line">  # Offline resource url for download files, default is internal_ip:nginx_http_port</span><br><span class="line">  offline_resources_url: internal_ip:nginx_http_port</span><br><span class="line">  # Use nginx and registry provide all offline resources</span><br><span class="line">  offline_resources_enabled: true</span><br><span class="line">  # Image repo in registry</span><br><span class="line">  image_repository: library</span><br><span class="line">  # Kubespray container image for deploy user cluster or scale</span><br><span class="line">  kubespray_image: &quot;kubespray&quot;</span><br><span class="line">  # Auto generate self-signed certificate for registry domain</span><br><span class="line">  generate_domain_crt: true</span><br><span class="line">  # For nodes pull image, use 443 as default</span><br><span class="line">  registry_https_port: 443</span><br><span class="line">  # For push image to this registry, use 5000 as default, and only bind at 127.0.0.1</span><br><span class="line">  registry_push_port: 5000</span><br><span class="line">  # Set false to disable download all container images on all nodes</span><br><span class="line">  download_container: false</span><br></pre></td></tr></table></figure><ul><li>å®‰è£…åŒ…ç›®å½•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">kubeplay&#x2F;</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ compose.yaml                 # compose é…ç½®æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ config</span><br><span class="line">â”‚   â”œâ”€â”€ compose</span><br><span class="line">â”‚   â”‚   â””â”€â”€ nginx.conf           # nginx é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ kubespray</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ env.yml</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ group_vars           # kubespray group_vars  é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚   â”‚   â””â”€â”€ inventory.ini</span><br><span class="line">â”‚   â””â”€â”€ rootCA.cnf               # openssl é…ç½®æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ config-sample.yaml           # ä¸»é…ç½®æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ install.sh                   # å®‰è£…åŒ…å…¥å£è„šæœ¬</span><br><span class="line">â”œâ”€â”€ library</span><br><span class="line">â””â”€â”€ resources                    # æ‰€æœ‰ç¦»çº¿èµ„æº</span><br><span class="line">    â”œâ”€â”€ images</span><br><span class="line">    â”‚   â”œâ”€â”€ kubespray-v2.16.tar  # kubespray é•œåƒ</span><br><span class="line">    â”‚   â”œâ”€â”€ nginx-1.20-alpine.tar# nginx é•œåƒ</span><br><span class="line">    â”‚   â””â”€â”€ registry-2.7.1.tar   # registry é•œåƒ</span><br><span class="line">    â”œâ”€â”€ nginx                    # rpm&#x2F;deb åŒ…ä»¥åŠä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">    â”‚   â”œâ”€â”€ centos               # centos rpm åŒ…</span><br><span class="line">    â”‚   â”œâ”€â”€ debian               # debian deb åŒ…</span><br><span class="line">    â”‚   â”œâ”€â”€ files                # ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">    â”‚   â”œâ”€â”€ repos                # yum&#x2F;apt é…ç½®æ–‡ä»¶</span><br><span class="line">    â”‚   â”œâ”€â”€ tools                # ä¸€äº›éƒ¨ç½²æ—¶ä¾èµ–çš„å·¥å…·</span><br><span class="line">    â”‚   â””â”€â”€ ubuntu               # ubuntu deb åŒ…</span><br><span class="line">    â””â”€â”€ registry</span><br><span class="line">        â””â”€â”€ docker               # ç»„ä»¶é•œåƒ registry å­˜å‚¨ç›®å½•</span><br></pre></td></tr></table></figure><h3><span id="compose-èŠ‚ç‚¹">compose èŠ‚ç‚¹</span></h3><p>éœ€è¦å•ç‹¬åˆ’åˆ†å‡ºä¸€ä¸ªèŠ‚ç‚¹ç”¨æˆ·éƒ¨ç½² nginx å’Œé•œåƒä»“åº“æœåŠ¡ï¼Œå¹¶åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œ kubespray æ¥éƒ¨ç½² K8s é›†ç¾¤ã€‚å¤§è‡´æµç¨‹çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">deploy_compose()&#123;</span><br><span class="line">  case $&#123;ID&#125; in</span><br><span class="line">    Debian|debian)</span><br><span class="line">      system::debian::config_repo</span><br><span class="line">      ;;</span><br><span class="line">    CentOS|centos)</span><br><span class="line">      system::centos::disable_selinux</span><br><span class="line">      system::centos::config_repo</span><br><span class="line">      ;;</span><br><span class="line">    Ubuntu|ubuntu)</span><br><span class="line">      system::ubuntu::config_repo</span><br><span class="line">      ;;</span><br><span class="line">    *)</span><br><span class="line">      errorlog &quot;Not support system: $&#123;ID&#125;&quot;</span><br><span class="line">      exit 1</span><br><span class="line">      ;;</span><br><span class="line">  esac</span><br><span class="line">  system::disable_firewalld</span><br><span class="line">  system::install_pkgs</span><br><span class="line">  common::install_tools</span><br><span class="line">  common::rudder_config</span><br><span class="line">  common::update_hosts</span><br><span class="line">  common::generate_domain_certs</span><br><span class="line">  common::load_images</span><br><span class="line">  common::compose_up</span><br><span class="line">  common::health_check</span><br><span class="line">  system::install_chrony</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()&#123;</span><br><span class="line">  case $&#123;INSTALL_TYPE&#125; in</span><br><span class="line">    all)</span><br><span class="line">      deploy_compose</span><br><span class="line">      common::push_kubespray_image</span><br><span class="line">      common::run_kubespray &quot;bash &#x2F;kubespray&#x2F;run.sh deploy-cluster&quot;</span><br><span class="line">      ;;</span><br><span class="line">    *)</span><br><span class="line">      echowarn &quot;unknow [TYPE] parameter: $&#123;INSTALL_TYPE&#125;&quot;</span><br><span class="line">      common::usage</span><br><span class="line">      ;;</span><br><span class="line">  esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main &quot;$@&quot;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆåˆå§‹åŒ–èŠ‚ç‚¹ï¼Œå…³é—­é˜²ç«å¢™å’Œ <code>SELinux</code></li><li>é…ç½®éƒ¨ç½²èŠ‚ç‚¹ yum/apt ç¦»çº¿æº</li><li>å®‰è£…ä¸€äº›éƒ¨ç½²ä¾èµ–åŒ…ï¼Œå¦‚ chronyã€ libseccomp ç­‰</li><li>å®‰è£…ä¸€äº›å·¥å…·å¦‚ yq, skopeo, kubectl ç­‰</li><li>å®‰è£… nerdctl-full (containerd)</li><li>ä½¿ç”¨ nerdctl load -i çš„æ–¹å¼å¯¼å…¥nginx, registry, kubespray é•œåƒ</li><li>ä½¿ç”¨ yq æ¸²æŸ“é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆ kubespray éœ€è¦çš„ env æ–‡ä»¶å’Œ inventory æ–‡ä»¶</li><li>ç”Ÿæˆé•œåƒä»“åº“åŸŸåè¯ä¹¦å¹¶å°†è‡ªç­¾è¯ä¹¦æ·»åŠ åˆ°ä¸»æœºçš„ CA trust ä¿¡ä»»å½“ä¸­</li><li>åœ¨ <code>/etc/hosts</code> ä¸­æ·»åŠ é•œåƒä»“åº“åŸŸå hosts æ˜ å°„</li><li>ä½¿ç”¨ nerdctl compose å¯åŠ¨ nginx å’Œ registry æœåŠ¡</li><li>éƒ¨ç½²æ—¶é’ŸåŒæ­¥æœåŠ¡ chrony</li><li>æ£€æŸ¥å„ä¸ªæœåŠ¡çš„çŠ¶æ€</li><li>æœ€åä½¿ç”¨ nerdctl run å¯åŠ¨ kubespray å®¹å™¨æ¥éƒ¨ç½² k8s é›†ç¾¤</li></ul><h3><span id="kubespray">kubespray</span></h3><p>éƒ¨ç½²çš„æµç¨‹ä¸ŠåŸºæœ¬ä¸Šå’Œ kubespray å®˜æ–¹å¤§ä½“ä¸€è‡´ï¼Œåªä¸è¿‡æˆ‘ä»¬å¼•å…¥é‡Œåˆ†å±‚éƒ¨ç½²çš„ç‰¹æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">deploy_cluster()&#123;</span><br><span class="line">  touch $&#123;INSTALL_STEPS_FILE&#125;</span><br><span class="line">  STEPS&#x3D;&quot;00-default-ssh-config 01-cluster-bootstrap-os 02-cluster-etcd 03-cluster-kubernetes 04-cluster-network 05-cluster-apps&quot;</span><br><span class="line">  for step in $&#123;STEPS&#125;; do</span><br><span class="line">    if ! grep -q &quot;$&#123;step&#125;&quot; $&#123;INSTALL_STEPS_FILE&#125;; then</span><br><span class="line">      infolog &quot;start deploy $&#123;step&#125;&quot;</span><br><span class="line">      if ansible-playbook $&#123;ANSIBLE_ARGS&#125; $&#123;KUBE_ROOT&#125;&#x2F;playbooks&#x2F;$&#123;step&#125;.yml; then</span><br><span class="line">        echo $&#123;step&#125; &gt;&gt; $&#123;INSTALL_STEPS_FILE&#125;</span><br><span class="line">        infolog &quot;$&#123;step&#125; successfully installed&quot;</span><br><span class="line">      else</span><br><span class="line">        errorlog &quot;$&#123;step&#125; installation failed&quot;</span><br><span class="line">        exit 1</span><br><span class="line">      fi</span><br><span class="line">    else</span><br><span class="line">      warnlog &quot;$&#123;step&#125; is already installed, so skipped...&quot;</span><br><span class="line">    fi</span><br><span class="line">  done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é…ç½®å ¡å’æœº ssh ç™»å½•ï¼ˆå¯é€‰ï¼‰</li><li>é…ç½®èŠ‚ç‚¹ yum/apt æºä¸º nginx æœåŠ¡æä¾›çš„æº</li><li>å°†è‡ªç­¾çš„åŸŸåè¯ä¹¦æ·»åŠ åˆ°ä¸»æœºçš„ CA trust ä¿¡ä»»å½“ä¸­</li><li>åœ¨ <code>/etc/hosts</code> ä¸­æ·»åŠ é•œåƒä»“åº“åŸŸå hosts æ˜ å°„</li><li>å…³é—­é˜²ç«å¢™ï¼Œå®‰è£…æ—¶é’ŸåŒæ­¥æœåŠ¡ï¼Œè¿›è¡ŒåŒæ­¥æ—¶é’Ÿ</li><li>åˆå§‹åŒ–é›†ç¾¤èŠ‚ç‚¹ï¼Œå®‰è£…éƒ¨ç½²ä¾èµ–</li><li>å®‰è£…å®¹å™¨è¿è¡Œæ—¶ï¼Œä¸‹è½½æ–‡ä»¶å’Œç»„ä»¶é•œåƒ</li><li>éƒ¨ç½² etcd é›†ç¾¤</li><li>éƒ¨ç½² K8s é›†ç¾¤</li><li>éƒ¨ç½² CNI æ’ä»¶</li><li>å®‰è£…ä¸€äº›é¢å¤–çš„ addon ç»„ä»¶å¦‚ (coredns)</li></ul><p>è‡³æ­¤æ•´ä¸ªæ‰“åŒ…å’Œéƒ¨ç½²æµç¨‹å°±å®Œæ¯•äº†ï¼Œä¸‹é¢å†è®²å‡ ä¸ªæ‰“åŒ…/éƒ¨ç½²å¸¸è§çš„é—®é¢˜</p><h2><span id="å…¶ä»–">å…¶ä»–</span></h2><h3><span id="kubeadm-è¯ä¹¦">kubeadm è¯ä¹¦</span></h3><p>é€šè¿‡ä¿®æ”¹ kubeadm æºç çš„æ–¹å¼å°†è¯ä¹¦ç»­å‘½åˆ° 10 å¹´ï¼Œå¼€å¯ <code>kubeadm_patch_enabled</code> å‚æ•°éƒ¨ç½²æ—¶å°±å°† kubeadm æ›¿æ¢ä¸ºä¿®æ”¹åçš„ kubeadmã€‚å…³äº kubeadm çš„ä¿®æ”¹å’Œæ„å»ºå’Œå‚è€ƒæˆ‘ä¹‹å‰å†™è¿‡çš„ã€Š<a href="https://blog.k8s.li/build-k8s-binary-by-github-actions.html" target="_blank" rel="noopener">ä½¿ç”¨ GitHub Actions ç¼–è¯‘ kubernetes ç»„ä»¶</a>ã€‹ã€‚</p><ul><li><a href="https://github.com/k8sli/kubespray/blob/main/roles/cluster/download/tasks/main.yml" target="_blank" rel="noopener">roles/cluster/download/tasks/main.yml</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- name: Relpace kubeadm binary file as patched version</span><br><span class="line">  get_url:</span><br><span class="line">    url: &quot;&#123;&#123; patched_kubeadm_download_url &#125;&#125;&quot;</span><br><span class="line">    dest: &quot;&#123;&#123; bin_dir &#125;&#125;&#x2F;kubeadm&quot;</span><br><span class="line">    mode: 0755</span><br><span class="line">    owner: root</span><br><span class="line">    group: root</span><br><span class="line">  tags:</span><br><span class="line">    - kubeadm</span><br><span class="line">  when: kubeadm_patch_enabled | default(true) | bool</span><br></pre></td></tr></table></figure><h3><span id="é•œåƒç¼“å­˜">é•œåƒç¼“å­˜</span></h3><p>os-packages, kubespray-base, kubespray-files, kubespray-images è¿™å››ä¸ªé•œåƒåœ¨æ„å»ºçš„æ—¶å€™éƒ½ä¼šé‡‡ç”¨ md5 å€¼çš„æ–¹å¼æ ¡éªŒæ˜¯å¦éœ€è¦é‡æ–°æ„å»ºé•œåƒï¼Œè¿™æ ·èƒ½å¤Ÿå¤§å¤§æå‡ CI çš„æ‰§è¡Œæ•ˆç‡ï¼Œä¸‹é¢ä»¥ kubespray-base è¿™ä¸ªé•œåƒä¸ºä¾‹ä»‹ç»å…¶åŸç†å’Œå®ç°ï¼š</p><ul><li>åœ¨æ„å»ºé•œåƒå‰ä¼šæœ‰ä¸€ä¸ª md5 è®¡ç®—å’Œæ ¡éªŒçš„æ­¥éª¤ï¼Œå°†ä¸è¯¥é•œåƒç´§å¯†ç›¸å…³çš„æ–‡ä»¶å†…å®¹è¿›è¡Œæ±‡æ€»å¹¶ç”Ÿæˆ md5 å€¼ï¼Œå¹¶å°†è¿™ä¸ªå€¼å¾—ä»¥ label çš„æ–¹å¼ä¿å­˜åœ¨é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯å½“ä¸­ã€‚å¦‚æœè¯¥å€¼ä¸ä¸Šä¸ªæœ€æ–°çš„é•œåƒä¸­çš„ md5 å€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦é‡æ–°æ„å»ºè¯¥é•œåƒï¼Œåªéœ€è¦è¿›è¡Œ retag å³å¯ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- name: Prepare for build images</span><br><span class="line">  shell: bash</span><br><span class="line">  run: |</span><br><span class="line">    git describe --tags --always | sed &#39;s&#x2F;^&#x2F;IMAGE_TAG&#x3D;&#x2F;&#39; &gt;&gt; $GITHUB_ENV</span><br><span class="line">    git branch --show-current | sed &#39;s&#x2F;^&#x2F;BRANCH_NAME&#x3D;&#x2F;&#39; &gt;&gt; $GITHUB_ENV</span><br><span class="line">    git branch --show-current | sed &#39;s&#x2F;master&#x2F;latest&#x2F;;s&#x2F;main&#x2F;latest&#x2F;;s&#x2F;^&#x2F;IMAGE_TAG_BY_BRANCH&#x3D;&#x2F;&#39; &gt;&gt; $GITHUB_ENV</span><br><span class="line">    sed -n &#39;s&#x2F;^kube_version: &#x2F;KUBE_VERSION&#x3D;&#x2F;p&#39; roles&#x2F;kubespray-defaults&#x2F;defaults&#x2F;main.yaml &gt;&gt; $GITHUB_ENV</span><br><span class="line">    cat build&#x2F;kubespray-base&#x2F;Dockerfile requirements.txt tests&#x2F;requirements.txt .github&#x2F;workflows&#x2F;build.yaml \</span><br><span class="line">    | md5sum | tr -d &#39;\ -&#39; | sed &#39;s&#x2F;^&#x2F;BASE_MD5&#x3D;md5-&#x2F;&#39; &gt;&gt; $GITHUB_ENV</span><br><span class="line"></span><br><span class="line">    source $GITHUB_ENV</span><br><span class="line">    if skopeo inspect docker:&#x2F;&#x2F;$&#123;BASE_IMAGE_REPO&#125;:$&#123;BRANCH_NAME&#125; &gt; mainfest.json; then</span><br><span class="line">      jq -r &#39;.Labels.BASE_MD5&#39; mainfest.json | sed &#39;s&#x2F;^&#x2F;LATEST_BASE_MD5&#x3D;&#x2F;&#39; &gt;&gt; $GITHUB_ENV</span><br><span class="line">    else</span><br><span class="line">      echo &#39;LATEST_BASE_MD5&#x3D;null&#39; &gt;&gt; $GITHUB_ENV</span><br><span class="line">    fi</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœå½“å‰md5 çš„å€¼ä¸æœ€æ–°çš„ md5 å€¼ç›¸ç­‰ï¼Œå°±é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ Dockerfile æ¥è¿›è¡Œé•œåƒ retag çš„æ“ä½œã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- name: Replace Dockerfile if MD5 not update</span><br><span class="line">  if: $&#123;&#123; env.BASE_MD5 &#x3D;&#x3D; env.LATEST_BASE_MD5 &#125;&#125;</span><br><span class="line">  run: |</span><br><span class="line">    echo &quot;FROM $&#123;&#123; env.BASE_IMAGE_REPO &#125;&#125;:$&#123;&#123; env.BASE_MD5 &#125;&#125;&quot; &gt; build&#x2F;kubespray-base&#x2F;Dockerfile</span><br></pre></td></tr></table></figure><ul><li>æ„å»ºé•œåƒå¹¶å°† md5 å€¼ä½œä¸º labels å¡«å……åˆ°é•œåƒçš„å…ƒæ•°æ®ä¿¡æ¯å½“ä¸­ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- name: Build and push kubespray-base images</span><br><span class="line">  uses: docker&#x2F;build-push-action@v2</span><br><span class="line">  with:</span><br><span class="line">    context: .</span><br><span class="line">    push: $&#123;&#123; github.event_name !&#x3D; &#39;pull_request&#39; &#125;&#125;</span><br><span class="line">    file: build&#x2F;kubespray-base&#x2F;Dockerfile</span><br><span class="line">    platforms: linux&#x2F;amd64,linux&#x2F;arm64</span><br><span class="line">    cache-from: type&#x3D;local,src&#x3D;&#x2F;tmp&#x2F;.buildx-cache</span><br><span class="line">    cache-to: type&#x3D;local,dest&#x3D;&#x2F;tmp&#x2F;.buildx-cache-new</span><br><span class="line">    build-args: KUBE_VERSION&#x3D;$&#123;&#123; env.KUBE_VERSION &#125;&#125;</span><br><span class="line">    labels: BASE_MD5&#x3D;$&#123;&#123; env.BASE_MD5 &#125;&#125;</span><br><span class="line">    tags: |</span><br><span class="line">      $&#123;&#123; env.BASE_IMAGE_REPO &#125;&#125;:$&#123;&#123; env.IMAGE_TAG &#125;&#125;</span><br><span class="line">      $&#123;&#123; env.BASE_IMAGE_REPO &#125;&#125;:$&#123;&#123; env.BASE_MD5 &#125;&#125;</span><br><span class="line">      $&#123;&#123; env.BASE_IMAGE_REPO &#125;&#125;:$&#123;&#123; env.BRANCH_NAME &#125;&#125;</span><br><span class="line">      $&#123;&#123; env.BASE_IMAGE_REPO &#125;&#125;:$&#123;&#123; env.IMAGE_TAG_BY_BRANCH &#125;&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ç§æ–¹å¼çš„å¥½å¤„å°±åœ¨äºåœ¨ä¸éœ€è¦æ„å»ºé•œåƒçš„æ—¶å€™èƒ½å¤§å¹…åº¦æå‡ CI çš„è¿è¡Œæ•ˆç‡ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ æœ¨å­çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y9bekf67" target="_blank" rel="noopener">https://tinyurl.com/y9bekf67</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ä¼ä¸šç§æœ‰äº‘ç¯å¢ƒå½“ä¸­ï¼Œå‡ºäºå¯¹æ•°æ®å®‰å…¨çš„è€ƒè™‘ä»¥åŠæ»¡è¶³ &lt;a href=&quot;http://www.djbh.net/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤&lt;/a&gt; çš„è¦æ±‚ï¼Œå¾€å¾€ä¼šå¯¹å†…éƒ¨ç¯å¢ƒä¸­çš„æœåŠ¡å™¨åšå‡ºä¸¥æ ¼çš„è®¿é—®é™åˆ¶ã€‚ä¸€èˆ¬æ¥è®²ç”Ÿäº§ç¯å¢ƒéƒ½ä¼šç¦æ­¢è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œå¼€å‘äººå‘˜è¦è®¿é—®ç”Ÿäº§ç¯å¢ƒä¹Ÿå¿…é¡»é€šè¿‡å ¡å’æœºæˆ–è€…å…¶ä»–æ–¹å¼è¿›è¡Œå®‰å…¨å®¡è®¡ç™»å½•ã€‚åœ¨è¿™ç§æ— ç½‘ï¼ˆæ— æ³•è®¿é—®å…¬ç½‘ï¼‰çš„ç¯å¢ƒä¸­ï¼Œæƒ³è¦éƒ¨ç½²å¥½ä¸€ä¸ª K8s é›†ç¾¤å¹¶ä¸æ˜¯ä¸€ä»¶è½»æ¾çš„äº‹å„¿ã€‚å¸‚é¢ä¸Š K8s éƒ¨ç½²å·¥å…·ä¹Ÿå¤šä¸èƒœæ•°ï¼Œå¯¹äºç¦»çº¿éƒ¨ç½²çš„æ”¯æŒæƒ…å†µä¹Ÿå„ä¸ç›¸åŒï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Item&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Language&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Star&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Fork&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;ç¦»çº¿éƒ¨ç½²æ”¯æŒæƒ…å†µ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://github.com/kubernetes/kops&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;kops&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Golang&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;13.2k&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;4.1k&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://github.com/kubernetes-sigs/kubespray&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;kubespray&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Ansible&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;11.1k&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;4.7k&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;æ”¯æŒï¼Œéœ€è‡ªè¡Œæ„å»ºå®‰è£…åŒ…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://github.com/easzlab/kubeasz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;kubeasz&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Ansible&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;7.2k&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;2.7k&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;æ”¯æŒï¼Œéœ€è‡ªè¡Œæ„å»ºå®‰è£…åŒ…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://github.com/fanux/sealos&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;sealos&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Golang&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;4.1k&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;790&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;æ”¯æŒï¼Œéœ€ä»˜è´¹å……å€¼ä¼šå‘˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://github.com/rancher/rke&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;RKE&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Golang&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;2.5k&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;480&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;ä¸æ”¯æŒï¼Œéœ€è‡ªè¡Œå®‰è£… docker&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://github.com/alibaba/sealer&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;sealer&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Golang&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;503&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;112&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;æ”¯æŒï¼Œæºè‡ª &lt;a href=&quot;https://github.com/fanux/sealos&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;sealos&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;a href=&quot;https://github.com/kubesphere/kubekey&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;kubekey&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Golang&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;471&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;155&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;éƒ¨åˆ†æ”¯æŒï¼Œä»…é•œåƒå¯ç¦»çº¿&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ— ç½‘ç¯å¢ƒç¦»çº¿éƒ¨ç½² K8s å¾€å¾€æ˜¯ä½œä¸ºä¸€ä¸ªå•†ä¸šæœåŠ¡æˆ–è€…å•†ä¸šä»˜è´¹äº§å“æ¥å‡ºå”®ï¼ˆå¦‚ &lt;a href=&quot;https://www.sealyun.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;sealos&lt;/a&gt; ï¼‰ï¼Œå¾ˆå°‘æœ‰å¼€æºå…è´¹çš„è§£å†³æ–¹æ¡ˆï¼›æˆ–è€…è™½ç„¶æä¾›äº†ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆï¼Œä½†æƒ³è¦æ“ä½œèµ·æ¥ååˆ†ç¹çï¼Œå¾ˆéš¾é¡ºç•…åœ°åšåˆ°ä¸€é”®éƒ¨ç½²ï¼›åˆæˆ–è€…åªæ”¯æŒéƒ¨åˆ†ç¦»çº¿éƒ¨ç½²ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†èµ„æºéœ€è¦åœ¨éƒ¨ç½²çš„æ—¶å€™é€šè¿‡å…¬ç½‘è·å–ã€‚&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæœ¬æ–‡è°ƒç ”ä¸»æµçš„ K8s éƒ¨ç½²å·¥å…·ï¼Œå¹¶åŸºäºè¿™äº›å·¥å…·è®¾è®¡å¹¶å®ç°ä¸€ç§ä»æ„å»ºç¦»çº¿å®‰è£…åŒ…åˆ°ä¸€é”®éƒ¨ç½² K8s é›†ç¾¤å…¨æµç¨‹çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥æ»¡è¶³åœ¨æ— ç½‘çš„ç¯å¢ƒä¸­ä¸€é”®éƒ¨ç½² K8s é›†ç¾¤çš„éœ€æ±‚ï¼Œæ¯”è¾ƒé€‚åˆåŸºäº K8s çš„ PaaS toB äº§å“ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>ä¸¤ä¸ª 99% çš„äººéƒ½é‡åˆ°è¿‡çš„ Kubernetes æ•…éšœå¤„ç†æŠ€å·§</title>
    <link href="https://www.hi-linux.com/posts/19507.html"/>
    <id>https://www.hi-linux.com/posts/19507.html</id>
    <published>2021-08-30T01:00:00.000Z</published>
    <updated>2021-08-31T01:58:11.448Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>éšç€å¾®æœåŠ¡çš„ä¸æ–­æ¨è¿›ï¼Œä½¿ç”¨ k8s é›†ç¾¤è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šæ·±å…¥ï¼Œéšä¹‹è€Œæ¥ä¼šé‡åˆ°ä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œæœ¬æ–‡å‘å¤§å®¶ä»‹ç»å®é™…ä½¿ç”¨ k8s é‡åˆ°çš„ä¸€äº›é—®é¢˜ä»¥åŠè§£å†³æ–¹æ³•ã€‚</p><h2><span id="é—®é¢˜ä¸€ä¿®å¤-k8s-å†…å­˜æ³„éœ²é—®é¢˜">é—®é¢˜ä¸€ï¼šä¿®å¤ K8S å†…å­˜æ³„éœ²é—®é¢˜</span></h2><h3><span id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</span></h3><ol><li>å½“ k8s é›†ç¾¤è¿è¡Œæ—¥ä¹…ä»¥åï¼Œæœ‰çš„ node æ— æ³•å†æ–°å»º podï¼Œå¹¶ä¸”å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œå½“é‡å¯æœåŠ¡å™¨ä¹‹åï¼Œæ‰å¯ä»¥æ¢å¤æ­£å¸¸ä½¿ç”¨ã€‚æŸ¥çœ‹ pod çŠ¶æ€çš„æ—¶å€™ä¼šå‡ºç°ä»¥ä¸‹æŠ¥é”™ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">applying cgroup â€¦ caused: mkdir â€¦no space left on device</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ describe pod çš„æ—¶å€™å‡ºç° cannot allocate memoryã€‚</p><p>è¿™æ—¶å€™ä½ çš„ k8s é›†ç¾¤å¯èƒ½å°±å­˜åœ¨å†…å­˜æ³„éœ²çš„é—®é¢˜äº†ï¼Œå½“åˆ›å»ºçš„ pod è¶Šå¤šçš„æ—¶å€™å†…å­˜ä¼šæ³„éœ²çš„è¶Šå¤šï¼Œè¶Šå¿«ã€‚</p><ol start="2"><li>å…·ä½“æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;memory&#x2F;kubepods&#x2F;memory.kmem.slabinfo</span><br></pre></td></tr></table></figure><p>å½“å‡ºç° cat: /sys/fs/cgroup/memory/kubepods/memory.kmem.slabinfo: Input/output error åˆ™è¯´æ˜ä¸å­˜åœ¨å†…å­˜æ³„éœ²çš„æƒ…å†µ å¦‚æœå­˜åœ¨å†…å­˜æ³„éœ²ä¼šå‡ºç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slabinfo - version: 2.1</span><br><span class="line"># name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables &lt;limit&gt; &lt;batchcount&gt; &lt;sharedfactor&gt; : slabdata &lt;active_slabs&gt; &lt;num_slabs&gt; &lt;sharedavail&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h3><span id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</span></h3><ol><li><p>è§£å†³æ–¹æ³•æ€è·¯ï¼šå…³é—­ runc å’Œ kubelet çš„ kmemï¼Œå› ä¸ºå‡çº§å†…æ ¸çš„æ–¹æ¡ˆæ”¹åŠ¨è¾ƒå¤§ï¼Œæ­¤å¤„ä¸é‡‡ç”¨ã€‚</p></li><li><p>kmem å¯¼è‡´å†…å­˜æ³„éœ²çš„åŸå› ï¼š</p></li></ol><p>å†…æ ¸å¯¹äºæ¯ä¸ª cgroup å­ç³»ç»Ÿçš„çš„æ¡ç›®æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œé™åˆ¶çš„å¤§å°å®šä¹‰åœ¨ kernel/cgroup.c #L139ï¼Œå½“æ­£å¸¸åœ¨ cgroup åˆ›å»ºä¸€ä¸ª group çš„ç›®å½•æ—¶ï¼Œæ¡ç›®æ•°å°±åŠ  1ã€‚æˆ‘ä»¬é‡åˆ°çš„æƒ…å†µå°±æ˜¯å› ä¸ºå¼€å¯äº† kmem accounting åŠŸèƒ½ï¼Œè™½ç„¶ cgroup çš„ç›®å½•åˆ é™¤äº†ï¼Œä½†æ˜¯æ¡ç›®æ²¡æœ‰å›æ”¶ã€‚è¿™æ ·åé¢å°±æ— æ³•åˆ›å»º 65535 ä¸ª cgroup äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å½“å‰å†…æ ¸ç‰ˆæœ¬ä¸‹ï¼Œå¼€å¯äº† kmem accounting åŠŸèƒ½ï¼Œä¼šå¯¼è‡´ memory cgroup çš„æ¡ç›®æ³„æ¼æ— æ³•å›æ”¶ã€‚</p><h4><span id="21-ç¼–è¯‘-runc">2.1 ç¼–è¯‘ runc</span></h4><ul><li>é…ç½® go è¯­è¨€ç¯å¢ƒ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ wget https:&#x2F;&#x2F;dl.google.com&#x2F;go&#x2F;go1.12.9.linux-amd64.tar.gz</span><br><span class="line">$ tar xf go1.12.9.linux-amd64.tar.gz -C &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line"></span><br><span class="line"># å†™å…¥bashrc</span><br><span class="line">$ vim ~&#x2F;.bashrc</span><br><span class="line">$ export GOPATH&#x3D;&quot;&#x2F;data&#x2F;Documents&quot;</span><br><span class="line">$ export GOROOT&#x3D;&quot;&#x2F;usr&#x2F;local&#x2F;go&quot;</span><br><span class="line">$ export PATH&#x3D;&quot;$GOROOT&#x2F;bin:$GOPATH&#x2F;bin:$PATH&quot;</span><br><span class="line">$ export GO111MODULE&#x3D;off</span><br><span class="line"></span><br><span class="line"># éªŒè¯</span><br><span class="line">$ source ~&#x2F;.bashrc</span><br><span class="line">$ go env</span><br></pre></td></tr></table></figure><ul><li>ä¸‹è½½ runc æºç </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p &#x2F;data&#x2F;Documents&#x2F;src&#x2F;github.com&#x2F;opencontainers&#x2F;</span><br><span class="line">$ cd &#x2F;data&#x2F;Documents&#x2F;src&#x2F;github.com&#x2F;opencontainers&#x2F;</span><br><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;opencontainers&#x2F;runc</span><br><span class="line">$ cd runc&#x2F;</span><br><span class="line">$ git checkout v1.0.0-rc9  # åˆ‡åˆ°v1.0.0-rc9 tag</span><br></pre></td></tr></table></figure><ul><li>ç¼–è¯‘</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…ç¼–è¯‘ç»„ä»¶</span><br><span class="line">$ sudo yum install libseccomp-devel</span><br><span class="line">$ make BUILDTAGS&#x3D;&#39;seccomp nokmem&#39;</span><br><span class="line"># ç¼–è¯‘å®Œæˆä¹‹åä¼šåœ¨å½“å‰ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ªruncçš„å¯æ‰§è¡Œæ–‡ä»¶,ç­‰kubeletç¼–è¯‘å®Œæˆä¹‹åä¼šå°†å…¶æ›¿æ¢</span><br></pre></td></tr></table></figure><h4><span id="22-ç¼–è¯‘-kubelet">2.2 ç¼–è¯‘ kubelet</span></h4><ul><li>ä¸‹è½½ kubernetes æºç </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p &#x2F;root&#x2F;k8s&#x2F;</span><br><span class="line">$ cd &#x2F;root&#x2F;k8s&#x2F;</span><br><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;kubernetes</span><br><span class="line">$ cd kubernetes&#x2F;</span><br><span class="line">$ git checkout v1.15.3</span><br></pre></td></tr></table></figure><ul><li>åˆ¶ä½œç¼–è¯‘ç¯å¢ƒçš„é•œåƒ(Dockerfile å¦‚ä¸‹)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:centos7.3.1611</span><br><span class="line"></span><br><span class="line">ENV GOROOT &#x2F;usr&#x2F;local&#x2F;go</span><br><span class="line">ENV GOPATH &#x2F;usr&#x2F;local&#x2F;gopath</span><br><span class="line">ENV PATH &#x2F;usr&#x2F;local&#x2F;go&#x2F;bin:$PATH</span><br><span class="line"></span><br><span class="line">RUN yum install rpm-build which where rsync gcc gcc-c++ automake autoconf libtool make -y \</span><br><span class="line">    &amp;&amp; curl -L https:&#x2F;&#x2F;studygolang.com&#x2F;dl&#x2F;golang&#x2F;go1.12.9.linux-amd64.tar.gz | tar zxvf - -C &#x2F;usr&#x2F;local</span><br></pre></td></tr></table></figure><ul><li>åœ¨åˆ¶ä½œå¥½çš„ go ç¯å¢ƒé•œåƒä¸­æ¥è¿›è¡Œç¼–è¯‘ kubelet</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run  -it --rm   -v &#x2F;root&#x2F;k8s&#x2F;kubernetes:&#x2F;usr&#x2F;local&#x2F;gopath&#x2F;src&#x2F;k8s.io&#x2F;kubernetes   build-k8s:centos-7.3-go-1.12.9-k8s-1.15.3   bash</span><br><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;gopath&#x2F;src&#x2F;k8s.io&#x2F;kubernetes</span><br><span class="line">#ç¼–è¯‘</span><br><span class="line">$ GO111MODULE&#x3D;off KUBE_GIT_TREE_STATE&#x3D;clean KUBE_GIT_VERSION&#x3D;v1.15.3 make kubelet GOFLAGS&#x3D;&quot;-tags&#x3D;nokmem&quot;</span><br></pre></td></tr></table></figure><ol start="3"><li>æ›¿æ¢åŸæœ‰çš„ runc å’Œ kubelet</li></ol><ul><li>å°†åŸæœ‰ runc å’Œ kubelet å¤‡ä»½</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mv &#x2F;usr&#x2F;bin&#x2F;kubelet &#x2F;home&#x2F;kubelet</span><br><span class="line">$ mv &#x2F;usr&#x2F;bin&#x2F;docker-runc &#x2F;home&#x2F;docker-runc</span><br></pre></td></tr></table></figure><ul><li>åœæ­¢ docker å’Œ kubelet</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop docker</span><br><span class="line">$ systemctl stop kubelet</span><br></pre></td></tr></table></figure><ul><li>å°†ç¼–è¯‘å¥½çš„ runc å’Œ kubelet è¿›è¡Œæ›¿æ¢</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cp kubelet &#x2F;usr&#x2F;bin&#x2F;kubelet</span><br><span class="line">$ cp kubelet &#x2F;usr&#x2F;local&#x2F;bin&#x2F;kubelet</span><br><span class="line">$ cp runc &#x2F;usr&#x2F;bin&#x2F;docker-runc</span><br></pre></td></tr></table></figure><ul><li>æ£€æŸ¥ kmem æ˜¯å¦å…³é—­å‰éœ€è¦å°†æ­¤èŠ‚ç‚¹çš„ pod æ€æ‰é‡å¯æˆ–è€…é‡å¯æœåŠ¡å™¨,å½“ç»“æœä¸º 0 æ—¶æˆåŠŸ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;memory&#x2F;kubepods&#x2F;burstable&#x2F;memory.kmem.usage_in_bytes</span><br></pre></td></tr></table></figure><ul><li>æ£€æŸ¥æ˜¯å¦è¿˜å­˜åœ¨å†…å­˜æ³„éœ²çš„æƒ…å†µ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;memory&#x2F;kubepods&#x2F;memory.kmem.slabinfo</span><br></pre></td></tr></table></figure><h2><span id="é—®é¢˜äºŒk8s-è¯ä¹¦è¿‡æœŸé—®é¢˜çš„ä¸¤ç§å¤„ç†æ–¹æ³•">é—®é¢˜äºŒï¼šk8s è¯ä¹¦è¿‡æœŸé—®é¢˜çš„ä¸¤ç§å¤„ç†æ–¹æ³•</span></h2><h3><span id="å‰æƒ…æè¦">å‰æƒ…æè¦</span></h3><p>å…¬å¸æµ‹è¯•ç¯å¢ƒçš„ k8s é›†ç¾¤ä½¿ç”¨å·²ç»å¾ˆé•¿æ—¶é—´äº†,çªç„¶æœ‰ä¸€å¤©å¼€å‘è”ç³»æˆ‘è¯´ k8s é›†ç¾¤æ— æ³•è®¿é—®ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯æµ‹è¯•ç¯å¢ƒçš„æœºå™¨ç£ç›˜ç©ºé—´ä¸å¤Ÿäº†ï¼Œå¯¼è‡´ç»„ä»¶å¼‚å¸¸æˆ–è€…æŠŠå¼€å‘ä½¿ç”¨çš„é•œåƒè‡ªåŠ¨æ¸…ç†æ‰äº†ï¼Œä½†æ˜¯å½“ç™»ä¸Šæœºå™¨å»æŸ¥éªŒçš„æ—¶å€™å‘ç°ä¸æ˜¯è¿™ä¸ªåŸå› ã€‚å½“æ—¶è§‰å¾—ä¹Ÿå¾ˆç–‘æƒ‘ã€‚å› ä¸ºå¼€å‘ç¯å¢ƒä½¿ç”¨äººæ•°è¾ƒå°‘ï¼Œä¸åº”è¯¥ä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥å°±å»æŸ¥éªŒ log çš„ç›¸å…³æŠ¥é”™ä¿¡æ¯ã€‚</p><h3><span id="é—®é¢˜ç°è±¡">é—®é¢˜ç°è±¡</span></h3><p>å‡ºç° k8s api æ— æ³•è°ƒå–çš„ç°è±¡ï¼Œä½¿ç”¨ kubectl å‘½ä»¤è·å–èµ„æºå‡è¿”å›å¦‚ä¸‹æŠ¥é”™:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ Unable to connect to the server: x509: certificate has expired or is not yet valid</span><br></pre></td></tr></table></figure><p>ç»ç½‘ä¸Šæœç´¢ä¹‹åå‘ç°åº”è¯¥æ˜¯ k8s é›†ç¾¤çš„è¯ä¹¦è¿‡æœŸäº†ï¼Œä½¿ç”¨å‘½ä»¤æ’æŸ¥è¯ä¹¦çš„è¿‡æœŸæ—¶é—´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm alpha certs check-expiration</span><br></pre></td></tr></table></figure><p>å‘ç°ç¡®å®æ˜¯è¯ä¹¦è¿‡æœŸäº†</p><h3><span id="ç›¸å…³ä»‹ç»ä»¥åŠé—®é¢˜è§£å†³">ç›¸å…³ä»‹ç»ä»¥åŠé—®é¢˜è§£å†³</span></h3><p>å› ä¸ºæˆ‘ä»¬æ˜¯ä½¿ç”¨ kubeadm éƒ¨ç½²çš„ k8s é›†ç¾¤ï¼Œæ‰€ä»¥æ›´æ–°èµ·è¯ä¹¦ä¹Ÿæ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œé»˜è®¤çš„è¯ä¹¦æ—¶é—´æœ‰æ•ˆæœŸæ˜¯ä¸€å¹´ï¼Œæˆ‘ä»¬é›†ç¾¤çš„ k8s ç‰ˆæœ¬æ˜¯ 1.15.3 ç‰ˆæœ¬æ˜¯å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–°è¯ä¹¦çš„ï¼Œä½†æ˜¯ä¸€å¹´ä¹‹åè¿˜æ˜¯ä¼šåˆ°æœŸï¼Œè¿™æ ·å°±å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ k8s çš„è¯ä¹¦ï¼Œç„¶åæˆ‘ä»¬æ¥ç”Ÿæˆä¸€ä¸ªæ—¶é—´å¾ˆé•¿çš„è¯ä¹¦ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸ç”¨å»æ€»æ›´æ–°è¯ä¹¦äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm alpha certs renew all --config&#x3D;kubeadm.yaml</span><br><span class="line">$ systemctl restart kubelet</span><br><span class="line">$ kubeadm init phase kubeconfig all --config kubeadm.yaml</span><br><span class="line"># ç„¶åå°†ç”Ÿæˆçš„é…ç½®æ–‡ä»¶æ›¿æ¢,é‡å¯ kube-apiserverã€kube-controllerã€kube-schedulerã€etcd è¿™4ä¸ªå®¹å™¨å³å¯</span><br></pre></td></tr></table></figure><p>å¦å¤– kubeadm ä¼šåœ¨æ§åˆ¶é¢æ¿å‡çº§çš„æ—¶å€™è‡ªåŠ¨æ›´æ–°æ‰€æœ‰è¯ä¹¦ï¼Œæ‰€ä»¥ä½¿ç”¨ kubeadm æ­å»ºçš„é›†ç¾¤æœ€ä½³çš„åšæ³•æ˜¯ç»å¸¸å‡çº§é›†ç¾¤ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„é›†ç¾¤ä¿æŒæœ€æ–°çŠ¶æ€å¹¶ä¿æŒåˆç†çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯å¯¹äºå®é™…çš„ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬å¯èƒ½å¹¶ä¸ä¼šå»é¢‘ç¹çš„å‡çº§é›†ç¾¤ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å»æ‰‹åŠ¨æ›´æ–°è¯ä¹¦ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡è°ƒç”¨ k8s çš„ api æ¥å®ç°æ›´æ–°ä¸€ä¸ª 10 å¹´çš„è¯ä¹¦</p><p>é¦–å…ˆåœ¨ <code>/etc/kubernetes/manifests/kube-controller-manager.yaml</code> æ–‡ä»¶åŠ å…¥é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">    - kube-controller-manager</span><br><span class="line">    # è®¾ç½®è¯ä¹¦æœ‰æ•ˆæœŸä¸º 10å¹´</span><br><span class="line">    - --experimental-cluster-signing-duration&#x3D;87600h</span><br><span class="line">    - --client-ca-file&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆå kube-controller-manager ä¼šè‡ªåŠ¨é‡å¯ç”Ÿæ•ˆã€‚ç„¶åæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¸º Kubernetes è¯ä¹¦ API åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾åè¯·æ±‚ã€‚å¦‚æœæ‚¨è®¾ç½®ä¾‹å¦‚ cert-manager ç­‰å¤–éƒ¨ç­¾åè€…ï¼Œåˆ™ä¼šè‡ªåŠ¨æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRsï¼‰ã€‚å¦è€…ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ kubectl certificate å‘½ä»¤æ‰‹åŠ¨æ‰¹å‡†è¯ä¹¦ã€‚ä»¥ä¸‹ kubeadm å‘½ä»¤è¾“å‡ºè¦æ‰¹å‡†çš„è¯ä¹¦åç§°ï¼Œç„¶åç­‰å¾…æ‰¹å‡†å‘ç”Ÿï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># éœ€è¦å°†å…¨éƒ¨ pending çš„è¯ä¹¦å…¨éƒ¨æ‰¹å‡†</span><br><span class="line">$ kubeadm alpha certs renew all --use-api --config kubeadm.yaml &amp;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜ä¸èƒ½ç›´æ¥é‡å¯æ§åˆ¶é¢æ¿çš„å‡ ä¸ªç»„ä»¶ï¼Œè¿™æ˜¯å› ä¸ºä½¿ç”¨ kubeadm å®‰è£…çš„é›†ç¾¤å¯¹åº”çš„ etcd é»˜è®¤æ˜¯ä½¿ç”¨çš„ /etc/kubernetes/pki/etcd/ca.crt è¿™ä¸ªè¯ä¹¦è¿›è¡Œå‰é¢çš„ï¼Œè€Œä¸Šé¢æˆ‘ä»¬ç”¨å‘½ä»¤ kubectl certificate approve æ‰¹å‡†è¿‡åçš„è¯ä¹¦æ˜¯ä½¿ç”¨çš„é»˜è®¤çš„ /etc/kubernetes/pki/ca.crt è¯ä¹¦è¿›è¡Œç­¾å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›¿æ¢ etcd ä¸­çš„ ca æœºæ„è¯ä¹¦:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># å…ˆæ‹·è´é™æ€ Pod èµ„æºæ¸…å•</span><br><span class="line">$ cp -r &#x2F;etc&#x2F;kubernetes&#x2F;manifests&#x2F; &#x2F;etc&#x2F;kubernetes&#x2F;manifests.bak</span><br><span class="line">$ vi &#x2F;etc&#x2F;kubernetes&#x2F;manifests&#x2F;etcd.yaml</span><br><span class="line">......</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">    - etcd</span><br><span class="line">    # ä¿®æ”¹ä¸º CA æ–‡ä»¶</span><br><span class="line">    - --peer-trusted-ca-file&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt</span><br><span class="line">    - --trusted-ca-file&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt</span><br><span class="line">......</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: &#x2F;var&#x2F;lib&#x2F;etcd</span><br><span class="line">      name: etcd-data</span><br><span class="line">    - mountPath: &#x2F;etc&#x2F;kubernetes&#x2F;pki  # æ›´æ”¹è¯ä¹¦ç›®å½•</span><br><span class="line">      name: etcd-certs</span><br><span class="line">  volumes:</span><br><span class="line">  - hostPath:</span><br><span class="line">      path: &#x2F;etc&#x2F;kubernetes&#x2F;pki  # å°† pki ç›®å½•æŒ‚è½½åˆ° etcd ä¸­å»</span><br><span class="line">      type: DirectoryOrCreate</span><br><span class="line">    name: etcd-certs</span><br><span class="line">  - hostPath:</span><br><span class="line">      path: &#x2F;var&#x2F;lib&#x2F;etcd</span><br><span class="line">      type: DirectoryOrCreate</span><br><span class="line">    name: etcd-data</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>ç”±äº kube-apiserver è¦è¿æ¥ etcd é›†ç¾¤ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦é‡æ–°ä¿®æ”¹å¯¹åº”çš„ etcd ca æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ vi &#x2F;etc&#x2F;kubernetes&#x2F;manifests&#x2F;kube-apiserver.yaml</span><br><span class="line">......</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">    - kube-apiserver</span><br><span class="line">    # å°†etcd caæ–‡ä»¶ä¿®æ”¹ä¸ºé»˜è®¤çš„ca.crtæ–‡ä»¶</span><br><span class="line">    - --etcd-cafile&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–è¿˜éœ€è¦æ›¿æ¢ requestheader-client-ca-file æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ /etc/kubernetes/pki/front-proxy-ca.crt æ–‡ä»¶ï¼Œç°åœ¨ä¹Ÿéœ€è¦æ›¿æ¢æˆé»˜è®¤çš„ CA æ–‡ä»¶ï¼Œå¦åˆ™ä½¿ç”¨èšåˆ APIï¼Œæ¯”å¦‚å®‰è£…äº† metrics-server åæ‰§è¡Œ kubectl top å‘½ä»¤å°±ä¼šæŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cp &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;front-proxy-ca.crt</span><br><span class="line">$ cp &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.key &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;front-proxy-ca.key</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ª 10 å¹´è¯ä¹¦çš„ k8s é›†ç¾¤ï¼Œè¿˜å¯ä»¥é€šè¿‡é‡æ–°ç¼–è¯‘ kubeadm æ¥å®ç°ä¸€ä¸ª 10 å¹´è¯ä¹¦çš„ï¼Œè¿™ä¸ªæˆ‘æ²¡æœ‰å°è¯•ï¼Œä¸è¿‡åœ¨åˆå§‹åŒ–é›†ç¾¤çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ çŸ¥ä¹ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/h9yet6sd" target="_blank" rel="noopener">https://tinyurl.com/h9yet6sd</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;éšç€å¾®æœåŠ¡çš„ä¸æ–­æ¨è¿›ï¼Œä½¿ç”¨ k8s é›†ç¾¤è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šæ·±å…¥ï¼Œéšä¹‹è€Œæ¥ä¼šé‡åˆ°ä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œæœ¬æ–‡å‘å¤§å®¶ä»‹ç»å®é™…ä½¿ç”¨ k8s é‡åˆ°çš„ä¸€äº›é—®é¢˜ä»¥åŠè§£å†³æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é—®é¢˜ä¸€ï¼šä¿®å¤-K8S-å†…å­˜æ³„éœ²é—®é¢˜&quot;&gt;é—®é¢˜ä¸€ï¼šä¿®å¤ K8S å†…å­˜æ³„éœ²é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&quot;é—®é¢˜æè¿°&quot;&gt;é—®é¢˜æè¿°&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å½“ k8s é›†ç¾¤è¿è¡Œæ—¥ä¹…ä»¥åï¼Œæœ‰çš„ node æ— æ³•å†æ–°å»º podï¼Œå¹¶ä¸”å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œå½“é‡å¯æœåŠ¡å™¨ä¹‹åï¼Œæ‰å¯ä»¥æ¢å¤æ­£å¸¸ä½¿ç”¨ã€‚æŸ¥çœ‹ pod çŠ¶æ€çš„æ—¶å€™ä¼šå‡ºç°ä»¥ä¸‹æŠ¥é”™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;applying cgroup â€¦ caused: mkdir â€¦no space left on device&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ–è€…åœ¨ describe pod çš„æ—¶å€™å‡ºç° cannot allocate memoryã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ—¶å€™ä½ çš„ k8s é›†ç¾¤å¯èƒ½å°±å­˜åœ¨å†…å­˜æ³„éœ²çš„é—®é¢˜äº†ï¼Œå½“åˆ›å»ºçš„ pod è¶Šå¤šçš„æ—¶å€™å†…å­˜ä¼šæ³„éœ²çš„è¶Šå¤šï¼Œè¶Šå¿«ã€‚&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;å…·ä½“æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat &amp;#x2F;sys&amp;#x2F;fs&amp;#x2F;cgroup&amp;#x2F;memory&amp;#x2F;kubepods&amp;#x2F;memory.kmem.slabinfo&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“å‡ºç° cat: /sys/fs/cgroup/memory/kubepods/memory.kmem.slabinfo: Input/output error åˆ™è¯´æ˜ä¸å­˜åœ¨å†…å­˜æ³„éœ²çš„æƒ…å†µ å¦‚æœå­˜åœ¨å†…å­˜æ³„éœ²ä¼šå‡ºç°&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;slabinfo - version: 2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# name            &amp;lt;active_objs&amp;gt; &amp;lt;num_objs&amp;gt; &amp;lt;objsize&amp;gt; &amp;lt;objperslab&amp;gt; &amp;lt;pagesperslab&amp;gt; : tunables &amp;lt;limit&amp;gt; &amp;lt;batchcount&amp;gt; &amp;lt;sharedfactor&amp;gt; : slabdata &amp;lt;active_slabs&amp;gt; &amp;lt;num_slabs&amp;gt; &amp;lt;sharedavail&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>æœåŠ¡ç½‘æ ¼é™¤äº† Istioï¼Œå…¶å®ä½ è¿˜å¯ä»¥æœ‰å…¶å®ƒ 8 ç§é€‰æ‹©</title>
    <link href="https://www.hi-linux.com/posts/1629.html"/>
    <id>https://www.hi-linux.com/posts/1629.html</id>
    <published>2021-08-26T01:00:00.000Z</published>
    <updated>2021-08-26T01:32:52.275Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>å“ªç§æœåŠ¡ç½‘æ ¼æœ€é€‚åˆä½ çš„ä¼ä¸šï¼Ÿè¿‘å¹´æ¥ï¼ŒKubernetes æœåŠ¡ç½‘æ ¼æ¡†æ¶æ•°é‡å¢åŠ è¿…é€Ÿï¼Œä½¿å¾—è¿™æˆä¸ºä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ã€‚</p><p>ä¸‹é¢å°†ä»‹ç» 9 ç§è¾ƒå—æ¬¢è¿çš„ç”¨ä»¥æ”¯æ’‘å¾®æœåŠ¡å¼€å‘çš„æœåŠ¡ç½‘æ ¼æ¡†æ¶ï¼Œæ¯ç§æ–¹æ¡ˆéƒ½ç»™å‡ºäº†å…¶é€‚ç”¨åœºæ™¯ã€‚</p><h2><span id="ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼">ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼</span></h2><p>æœåŠ¡ç½‘æ ¼è¿‘å¹´æ¥æœ‰å¾ˆé«˜çš„è¯é¢˜åº¦ï¼ŒèƒŒåçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å¾®æœåŠ¡å·²ç»æˆä¸ºä¸€ç§çµæ´»å¿«é€Ÿçš„å¼€å‘æ–¹å¼ã€‚ç„¶è€Œï¼Œéšç€å¾®æœåŠ¡æ•°é‡æˆå€æ•°åœ°å¢é•¿ï¼Œå¼€å‘å›¢é˜Ÿå¼€å§‹é‡åˆ°äº†éƒ¨ç½²å’Œæ‰©å±•æ€§ä¸Šçš„é—®é¢˜ã€‚</p><p>å®¹å™¨å’Œ Kubernetes è¿™æ ·çš„å®¹å™¨ç¼–æ’ç³»ç»Ÿ ï¼Œå°†è¿è¡Œæ—¶å’ŒæœåŠ¡ä¸€èµ·æ‰“åŒ…è¿›é•œåƒï¼Œè°ƒåº¦å®¹å™¨åˆ°åˆé€‚çš„èŠ‚ç‚¹ï¼Œè¿è¡Œå®¹å™¨ã€‚è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥è§£å†³å¼€å‘å›¢é˜Ÿé‡åˆ°çš„ä¸å°‘é—®é¢˜[1]ã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¸ªæ“ä½œæµç¨‹ä¸­ä»å­˜åœ¨çŸ­æ¿ï¼šå¦‚ä½•ç®¡ç†æœåŠ¡é—´çš„é€šä¿¡ã€‚</p><p>åœ¨é‡‡ç”¨æœåŠ¡ç½‘æ ¼çš„åœºæ™¯ä¸‹ï¼Œä»¥ä¸€ç§å’Œåº”ç”¨ä»£ç è§£è€¦çš„æ–¹å¼ï¼Œå¢å¼ºäº†åº”ç”¨é—´ç»Ÿä¸€çš„ç½‘ç»œé€šä¿¡èƒ½åŠ›ã€‚æœåŠ¡ç½‘æ ¼æ‰©å±•äº†é›†ç¾¤çš„ç®¡ç†èƒ½åŠ›ï¼Œå¢å¼ºå¯è§‚æµ‹æ€§ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€IT è¿ç»´ç›‘æ§åŠåº”ç”¨æ•…éšœæ¢å¤ç­‰åŠŸèƒ½ã€‚</p><a id="more"></a><h2><span id="æœåŠ¡ç½‘æ ¼æ¦‚è§ˆ">æœåŠ¡ç½‘æ ¼æ¦‚è§ˆ</span></h2><p>æœåŠ¡ç½‘æ ¼ä¸€ç›´æœ‰å¾ˆé«˜çš„çƒ­åº¦ã€‚æ­£å¦‚ Linkerd çš„ä½œè€… William Morgan æ‰€æåˆ°[2]çš„ï¼šâ€œæœåŠ¡ç½‘æ ¼æœ¬è´¨ä¸Šæ— éå°±æ˜¯å’Œåº”ç”¨æ†ç»‘åœ¨ä¸€èµ·çš„ç”¨æˆ·ç©ºé—´ä»£ç†ã€‚â€ æ­¤è¯´æ³•ç›¸å½“ç®€æ´ï¼Œä»–è¿˜è¡¥å……é“ï¼Œâ€œå¦‚æœä½ èƒ½é€è¿‡å™ªéŸ³çœ‹æ¸…æœ¬è´¨ï¼ŒæœåŠ¡ç½‘æ ¼èƒ½ç»™ä½ å¸¦æ¥å®å®åœ¨åœ¨çš„é‡è¦ä»·å€¼ã€‚â€</p><p>Envoy æ˜¯è®¸å¤šæœåŠ¡ç½‘æ ¼æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ˜¯ä¸€ä¸ªé€šç”¨çš„å¼€æºä»£ç†ï¼Œå¸¸è¢«ç”¨äº Pod å†…çš„ sidecar ä»¥æ‹¦æˆªæµé‡ã€‚ä¹Ÿæœ‰æœåŠ¡ç½‘æ ¼ä½¿ç”¨å¦å¤–çš„ä»£ç†æ–¹æ¡ˆã€‚</p><p>è‹¥è®ºå…·ä½“æœåŠ¡ç½‘æ ¼æ–¹æ¡ˆçš„æ™®åŠç¨‹åº¦ï¼ŒIstio å’Œ Linkerd è·å¾—äº†æ›´å¤šçš„è®¤å¯ã€‚ä¹Ÿæœ‰å…¶å®ƒå¯é€‰é¡¹ï¼ŒåŒ…æ‹¬ Consul Connectï¼ŒKumaï¼ŒAWS App Meshå’ŒOpenShiftã€‚ä¸‹æ–‡ä¼šé˜è¿°9ç§æœåŠ¡ç½‘æ ¼æä¾›çš„å…³é”®ç‰¹æ€§ã€‚</p><p><strong>Istio</strong></p><p>Istio æ˜¯åŸºäº Envoy æ„å»ºçš„ä¸€ä¸ªå¯æ‰©å±•çš„å¼€æºæœåŠ¡ç½‘æ ¼ã€‚å¼€å‘å›¢é˜Ÿå¯ä»¥é€šè¿‡å®ƒè¿æ¥ã€åŠ å¯†ã€ç®¡æ§å’Œè§‚å¯Ÿåº”ç”¨æœåŠ¡ã€‚Istio äº 2017 å¹´å¼€æºï¼Œç›®å‰ IBMã€Googleã€Lyft ä»åœ¨å¯¹å…¶è¿›è¡ŒæŒç»­ç»´æŠ¤å‡çº§ã€‚Lyft åœ¨ 2017 å¹´æŠŠ Envoy æèµ ç»™äº† CNCFã€‚</p><p>Istio èŠ±äº†ä¸å°‘æ—¶é—´å»å®Œå–„å¢å¼ºå®ƒçš„åŠŸèƒ½ç‰¹æ€§ã€‚Istio çš„å…³é”®ç‰¹æ€§åŒ…æ‹¬è´Ÿè½½å‡è¡¡ã€æµé‡è·¯ç”±ã€ç­–ç•¥åˆ›å»ºã€å¯åº¦é‡æ€§åŠæœåŠ¡é—´è®¤è¯ã€‚</p><p>Istio æœ‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šæ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ã€‚æ•°æ®å¹³é¢è´Ÿè´£å¤„ç†æµé‡ç®¡ç†ï¼Œé€šè¿‡ Envoy çš„ sidecar ä»£ç†æ¥å®ç°æµé‡è·¯ç”±å’ŒæœåŠ¡é—´è°ƒç”¨ã€‚æ§åˆ¶å¹³é¢æ˜¯ä¸»è¦ç”±å¼€å‘è€…ç”¨æ¥é…ç½®è·¯ç”±è§„åˆ™å’Œè§‚æµ‹æŒ‡æ ‡ã€‚</p><p>Istio è§‚æµ‹æŒ‡æ ‡æ˜¯ç»†ç²’åº¦çš„å±æ€§ï¼Œå…¶ä¸­åŒ…å«å’ŒæœåŠ¡è¡Œä¸ºç›¸å…³çš„ç‰¹å®šæ•°æ®å€¼ã€‚ä¸‹é¢æ˜¯ä¸ªæ ·ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">request.path: xyz&#x2F;abc </span><br><span class="line">request.size: 234 </span><br><span class="line">request.time: 12:34:56.789 04&#x2F;17&#x2F;2017 </span><br><span class="line">source.ip: [192 168 0 1] </span><br><span class="line">destination.service.name: example</span><br></pre></td></tr></table></figure><p>ä¸å…¶ä»–æœåŠ¡ç½‘æ ¼ç›¸æ¯”ï¼ŒIstio èƒœåœ¨å…¶å¹³å°æˆç†Ÿåº¦ä»¥åŠé€šè¿‡å…¶ Dashbaord</p><p>ç€é‡çªå‡ºçš„æœåŠ¡è¡Œä¸ºè§‚æµ‹å’Œä¸šåŠ¡ç®¡ç†åŠŸèƒ½ï¼Œç„¶è€Œä¹Ÿå› ä¸ºè¿™äº›é«˜çº§ç‰¹æ€§å’Œå¤æ‚çš„é…ç½®æµç¨‹ï¼ŒIstio å¯èƒ½å¹¶ä¸å¦‚å…¶å®ƒä¸€äº›æ›¿ä»£æ–¹æ¡ˆé‚£æ ·å®¹æ˜“ä¸Šæ‰‹ã€‚</p><p><strong>Linkerd</strong></p><p>æŒ‰ç…§å®˜ç½‘çš„è¯´æ³•ï¼ŒLinkerd æ˜¯ä¸€ä¸ªè½»é‡çº§ã€å®‰å…¨ä¼˜å…ˆçš„ Kubernetes æœåŠ¡ç½‘æ ¼ã€‚å®ƒçš„åˆ›å»ºæµç¨‹å¿«åˆ°è®©äººéš¾ä»¥ç½®ä¿¡ï¼ˆæ®ç§°åœ¨ Kubernetes å®‰è£…åªéœ€è¦ 60 ç§’ï¼‰ï¼Œè¿™æ˜¯å¤§å¤šæ•°å¼€å‘è€…å–œé—»ä¹è§çš„ã€‚Linkerd å¹¶æ²¡æœ‰é‡‡ç”¨åŸºäº Envoy çš„æ„å»ºæ–¹æ¡ˆã€‚è€Œæ˜¯ä½¿ç”¨äº†ä¸€ä¸ªåŸºäº Rust çš„é«˜æ€§èƒ½ä»£ç† linkerd2-proxyï¼Œè¿™ä¸ªä»£ç†æ˜¯ä¸“é—¨ä¸º Linkerd æœåŠ¡ç½‘æ ¼ç¼–å†™çš„ã€‚</p><p>Linkerd ç”±ç¤¾åŒºé©±åŠ¨ï¼Œæ˜¯ 100% çš„ Apache è®¸å¯å¼€æºé¡¹ç›®ã€‚å®ƒè¿˜æ˜¯ CNCF å­µåŒ–é¡¹ç›®ã€‚Linkerd å§‹äº 2016 å¹´ï¼Œç»´æŠ¤è€…ä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´å»è§£å†³å…¶ä¸­çš„ç¼ºé™·ã€‚</p><p>ä½¿ç”¨ Linkerd æœåŠ¡ç½‘æ ¼ï¼Œåº”ç”¨æœåŠ¡å¯ä»¥å¢å¼ºå…¶å¯é æ€§ã€å¯è§‚æµ‹æ€§åŠå…¶åœ¨ Kubernetes ä¸Šéƒ¨ç½²çš„å®‰å…¨æ€§ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯è§‚æµ‹æ€§çš„å¢å¼ºå¯ä»¥å¸®åŠ©ç”¨æˆ·è§£å†³æœåŠ¡é—´çš„å»¶è¿Ÿé—®é¢˜ã€‚ä½¿ç”¨ Linkerd ä¸è¦æ±‚ç”¨æˆ·åšå¾ˆå¤šä»£ç è°ƒæ•´æˆ–æ˜¯èŠ±è´¹å¤§é‡æ—¶é—´å†™ YAML é…ç½®æ–‡ä»¶ã€‚å¯é çš„äº§å“ç‰¹æ€§å’Œæ­£å‘çš„å¼€å‘è€…ä½¿ç”¨å›é¦ˆï¼Œä½¿å¾— Linkerd æˆä¸ºæœåŠ¡ç½‘æ ¼ä¸­ä¸€ä¸ªå¼ºæœ‰åŠ›çš„ç«äº‰è€…ã€‚</p><p><strong>Consul Connect</strong></p><p>Consul Connect æ˜¯æ¥è‡ª HashiCorp çš„æœåŠ¡ç½‘æ ¼ï¼Œä¸“æ³¨äºè·¯ç”±å’Œåˆ†æ®µï¼Œé€šè¿‡åº”ç”¨çº§çš„ sidecar ä»£ç†æ¥æä¾›æœåŠ¡é—´çš„ç½‘ç»œç‰¹æ€§ã€‚Consult Connect ä¾§é‡äºåº”ç”¨å®‰å…¨ï¼Œæä¾›åº”ç”¨é—´çš„åŒå‘ TLS è¿æ¥ä»¥å®ç°æˆæƒå’ŒåŠ å¯†ã€‚</p><p>Consult Connect ç‹¬ç‰¹çš„ä¸€ç‚¹æ˜¯æä¾›äº†ä¸¤ç§ä»£ç†æ¨¡å¼ã€‚ä¸€ç§æ˜¯å®ƒå†…å»ºçš„ä»£ç†ï¼ŒåŒæ—¶å®ƒè¿˜æ”¯æŒ Envoy æ–¹æ¡ˆã€‚Connect å¼ºè°ƒå¯è§‚æµ‹æ€§ï¼Œé›†æˆäº†ä¾‹å¦‚ Prometheus è¿™æ ·çš„å·¥å…·æ¥ç›‘æ§æ¥è‡ª sidecar ä»£ç†çš„æ•°æ®ã€‚Consul Connect å¯ä»¥çµæ´»åœ°æ»¡è¶³å¼€å‘è€…ä½¿ç”¨éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œå®ƒæä¾›äº†å¤šç§æ–¹å¼æ³¨å†ŒæœåŠ¡ï¼šå¯ä»¥ä»ç¼–æ’ç³»ç»Ÿæ³¨å†Œï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ API è°ƒç”¨ï¼Œæˆ–æ˜¯å‘½ä»¤è¡Œå·¥å…·ã€‚</p><p><strong>Kuma</strong></p><p>Kuma æ¥æºäº Kongï¼Œè‡ªç§°æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æœåŠ¡ç½‘æ ¼æ›¿ä»£æ–¹æ¡ˆã€‚Kuma æ˜¯ä¸€ä¸ªåŸºäº Envoy çš„å¹³å°æ— å…³çš„æ§åˆ¶å¹³é¢ã€‚Kuma æä¾›äº†å®‰å…¨ã€è§‚æµ‹ã€è·¯ç”±ç­‰ç½‘ç»œç‰¹æ€§ï¼ŒåŒæ—¶å¢å¼ºäº†æœåŠ¡é—´çš„è¿é€šæ€§ã€‚Kuma åŒæ—¶æ”¯æŒ Kubernetes å’Œè™šæ‹Ÿæœºã€‚</p><p>Kuma è®©äººæ„Ÿå…´è¶£çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒçš„ä¼ä¸šç‰ˆå¯ä»¥é€šè¿‡ä¸€ä¸ªç»Ÿä¸€æ§åˆ¶é¢æ¿æ¥è¿ç»´ç®¡ç†å¤šä¸ªäº’ç›¸éš”ç¦»ç‹¬ç«‹çš„æœåŠ¡ç½‘æ ¼ã€‚è¿™é¡¹èƒ½åŠ›å¯ä»¥æ»¡è¶³å®‰å…¨è¦æ±‚é«˜çš„ä½¿ç”¨åœºæ™¯ã€‚æ—¢ç¬¦åˆéš”ç¦»çš„è¦æ±‚ï¼Œåˆå®ç°é›†ä¸­æ§åˆ¶ã€‚</p><p>Kuma ä¹Ÿæ˜¯ç›¸å¯¹å®¹æ˜“å®‰è£…çš„ä¸€ä¸ªæ–¹æ¡ˆã€‚å› ä¸ºå®ƒé¢„å…ˆå†…ç½®äº†ä¸å°‘ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥è¦†ç›–äº†å¸¸è§éœ€æ±‚ï¼Œä¾‹å¦‚è·¯ç”±ï¼ŒåŒå‘ TLSï¼Œæ•…éšœæ³¨å…¥ï¼Œæµé‡æ§åˆ¶ï¼ŒåŠ å¯†ç­‰åœºæ™¯ã€‚</p><p>Kuma åŸç”Ÿå…¼å®¹ Kongï¼Œå¯¹äºé‚£äº›å·²ç»é‡‡ç”¨ Kong API ç®¡ç†çš„ä¼ä¸šç»„ç»‡ï¼ŒKuma æ˜¯ä¸ªéå¸¸è‡ªç„¶è€Œç„¶çš„å€™é€‰æ–¹æ¡ˆã€‚</p><p><strong>Maesh</strong></p><p>Maesh æ˜¯æ¥è‡ª Containous çš„å®¹å™¨åŸç”Ÿçš„æœåŠ¡ç½‘æ ¼ï¼Œæ ‡æ¦œè‡ªå·±æ˜¯æ¯”å¸‚åœºå…¶å®ƒæœåŠ¡ç½‘æ ¼æ›´è½»é‡çº§æ›´æ˜“ç”¨çš„æ–¹æ¡ˆã€‚å’Œå¾ˆå¤šåŸºäº Envoy æ„å»ºçš„æœåŠ¡ç½‘æ ¼ä¸åŒï¼ŒMaesh é‡‡ç”¨äº† Traefikï¼Œ ä¸€ä¸ªå¼€æºçš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ã€‚</p><p>Maesh å¹¶æ²¡æœ‰é‡‡ç”¨ sidecar çš„æ–¹å¼è¿›è¡Œä»£ç†ï¼Œè€Œæ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ¨ç½²ä¸€ä¸ªä»£ç†ç»ˆç«¯ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸éœ€è¦å»ç¼–è¾‘ Kubernetes å¯¹è±¡ï¼ŒåŒæ—¶å¯ä»¥è®©ç”¨æˆ·æœ‰é€‰æ‹©æ€§åœ°ä¿®æ”¹æµé‡ï¼ŒMaesh ç›¸æ¯”å…¶ä»–æœåŠ¡ç½‘æ ¼ä¾µå…¥æ€§æ›´ä½ã€‚Maesh æ”¯æŒçš„é…ç½®æ–¹å¼ï¼šåœ¨ç”¨æˆ·æœåŠ¡å¯¹è±¡ä¸Šæ·»åŠ æ³¨è§£æˆ–æ˜¯åœ¨æœåŠ¡ç½‘æ ¼å¯¹è±¡ä¸Šæ·»åŠ æ³¨è§£æ¥å®ç°é…ç½®ã€‚</p><p>å®é™…ä¸Šï¼ŒSMI æ˜¯ä¸€ç§æ–°çš„æœåŠ¡ç½‘æ ¼è§„èŒƒæ ¼å¼ï¼Œå¯¹ SMI çš„æ”¯æŒ Maesh ç‹¬æœ‰çš„ä¸€å¤§äº®ç‚¹ã€‚éšç€ SMI åœ¨ä¸šç•Œé€æ¸è¢«é‡‡ç”¨ï¼Œå¯ä»¥æé«˜å¯æ‰©å±•æ€§å’Œå‡ç¼“ä¾›åº”å•†ç»‘å®šçš„æ‹…å¿§ã€‚</p><p>Maesh è¦æ±‚ Kubernetes 1.11 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼ŒåŒæ—¶é›†ç¾¤é‡Œå®‰è£…äº† CoreDNS/KubeDNSã€‚è¿™ç¯‡å®‰è£…æŒ‡å—[3]æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡ Helm v3 å¿«é€Ÿå®‰è£… Maeshã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add maesh https:&#x2F;&#x2F;containous.github.io&#x2F;maesh&#x2F;charts </span><br><span class="line">$ helm repo update </span><br><span class="line">$ helm install maesh maesh&#x2F;maesh</span><br></pre></td></tr></table></figure><p><strong>ServiceComb-mesher</strong></p><p>Apache è½¯ä»¶åŸºé‡‘ä¼šå½¢å®¹æ——ä¸‹çš„ ServiceComb-mesher â€œæ˜¯ä¸€æ¬¾ç”¨ Go è¯­è¨€å®ç°çš„é«˜æ€§èƒ½æœåŠ¡ç½‘æ ¼â€ã€‚Mesher åŸºäºä¸€ä¸ªéå¸¸å—æ¬¢è¿çš„ Go è¯­è¨€å¾®æœåŠ¡å¼€å‘æ¡†æ¶ Go Chassis[4] æ¥è®¾è®¡å®ç°ã€‚å› æ­¤ï¼Œå®ƒæ²¿è¢­äº† Go Chassis çš„ä¸€äº›ç‰¹æ€§å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€é”™è¯¯å®¹å¿ã€è·¯ç”±ç®¡ç†å’Œåˆ†å¸ƒå¼è¿½è¸ªç­‰ç‰¹æ€§ã€‚</p><p>Mesher é‡‡ç”¨äº† sidecar æ–¹å¼ï¼›æ¯ä¸ªæœåŠ¡æœ‰ä¸€ä¸ª Mesher sidecar ä»£ç†ã€‚å¼€å‘äººå‘˜é€šè¿‡ Admin API å’Œ Mesher äº¤äº’ï¼ŒæŸ¥çœ‹è¿è¡Œæ—¶ä¿¡æ¯ã€‚Mesher åŒæ—¶æ”¯æŒ HTTP å’Œ gRPCï¼Œå¯å¿«é€Ÿç§»æ¤åˆ°ä¸åŒçš„åŸºç¡€è®¾æ–½ç¯å¢ƒï¼ŒåŒ…æ‹¬ Dockerã€Kubernetesã€è™šæ‹Ÿæœºå’Œè£¸é‡‘å±æœºç¯å¢ƒã€‚</p><p><strong>Network Service Meshï¼ˆNSMï¼‰</strong></p><p>Network Service Meshï¼ˆNSMï¼‰æ˜¯ä¸€æ¬¾ä¸“é—¨ä¸º telcos å’Œ ISPs è®¾è®¡çš„æœåŠ¡ç½‘æ ¼ã€‚å®ƒæä¾›äº†ä¸€å±‚çº§ç”¨ä»¥å¢å¼ºæœåŠ¡åœ¨ Kubernetes çš„ä½å±‚çº§ç½‘ç»œèƒ½åŠ›ã€‚NSM ç›®å‰æ˜¯ CNCF çš„æ²™ç®±é¡¹ç›®ã€‚</p><p>æ ¹æ® NSM çš„æ–‡æ¡£è¯´æ˜ï¼Œâ€œç»å¸¸æ¥è§¦ L2/L3 å±‚çš„ç½‘ç»œè¿ç»´äººå‘˜æŠ±æ€¨è¯´ï¼Œé€‚åˆä»–ä»¬çš„ä¸‹ä¸€ä»£æ¶æ„çš„å®¹å™¨ç½‘ç»œè§£å†³æ–¹æ¡ˆå‡ ä¹æ²¡æœ‰â€ã€‚</p><p>å› æ­¤ï¼ŒNSM åœ¨è®¾è®¡æ—¶å°±è€ƒè™‘åˆ°ä¸€äº›ä¸åŒä½¿ç”¨åœºæ™¯ï¼Œå°¤å…¶æ˜¯ç½‘ç»œåè®®ä¸åŒå’Œç½‘ç»œé…ç½®æ··æ‚çš„åœºæ™¯ã€‚è¿™ä½¿å¾— NSM å¯¹æŸäº›ç‰¹æ®Šåœºæ™¯å…·å¤‡ç›¸å½“å¸å¼•åŠ›ï¼Œä¾‹å¦‚è¾¹ç¼˜è®¡ç®—ã€5G ç½‘ç»œå’Œ IOT è®¾å¤‡ç­‰åœºæ™¯ã€‚NSM ä½¿ç”¨ç®€å•ç›´æ¥çš„ API æ¥å£å»å®ç°å®¹å™¨å’Œå¤–éƒ¨ç«¯ç‚¹çš„ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>å’Œå…¶ä»–æœåŠ¡ç½‘æ ¼ç›¸æ¯”ï¼ŒNSM å·¥ä½œåœ¨å¦ä¸€ä¸ªä¸åŒçš„ç½‘ç»œå±‚ã€‚VMware å½¢å®¹ NSMâ€œä¸“æ³¨äºè¿æ¥â€ã€‚GitHub çš„æ–‡æ¡£[5]æ¼”ç¤ºäº† NSM æ˜¯å¦‚ä½•ä¸ EnvoyååŒå·¥ä½œçš„ã€‚</p><p><strong>AWS App Mesh</strong></p><p>AWS APP Mesh ä¸ºå¼€å‘è€…æä¾›äº†â€œé€‚ç”¨äºä¸åŒæœåŠ¡çš„åº”ç”¨å±‚çš„ç½‘ç»œâ€ã€‚å®ƒæ¥ç®¡äº†æœåŠ¡çš„æ‰€æœ‰ç½‘ç»œæµé‡ï¼Œä½¿ç”¨å¼€æºçš„ Envoy ä»£ç†å»æ§åˆ¶å®¹å™¨çš„æµé‡å‡ºå…¥ã€‚AWS App Mesh æ”¯æŒ HTTP/2 gRPCã€‚</p><p>AWS App Mesh å¯¹äºé‚£äº›å·²ç»å°†å®¹å™¨å¹³å°æ·±åº¦ç»‘å®š AWS çš„å…¬å¸è€Œè¨€ï¼Œä¼šæ˜¯ç›¸å½“ä¸é”™çš„æœåŠ¡ç½‘æ ¼æ–¹æ¡ˆã€‚AWS å¹³å°åŒ…æ‹¬ AWS Fargateï¼ŒAmazon Elastic Container Serviceï¼ŒAmazon Elastic Kubernetes Serviceï¼ˆEKSï¼‰ï¼ŒAmazon Elastic Compute Cloudï¼ˆEC2ï¼‰ï¼ŒKubernetes on EC2ï¼ŒåŒ…æ‹¬ AWS App Mesh ä¸éœ€è¦ä»˜é¢å¤–è´¹ç”¨ã€‚</p><p>AWS App Mesh å’Œ AWS ç”Ÿæ€å†…çš„ç›‘æ§å·¥å…·æ— ç¼å…¼å®¹ã€‚è¿™äº›å·¥å…·åŒ…æ‹¬ CloudWatch å’Œ AWS X-Rayï¼Œä»¥åŠä¸€äº›æ¥è‡ªç¬¬ä¸‰æ–¹ä¾›åº”å•†çš„å·¥å…·ã€‚å› ä¸º AWS è®¡ç®—æœåŠ¡æ”¯æŒ AWS Outpostsï¼ŒAWS App Mesh å¯ä»¥å’Œæ··åˆäº‘å’Œå·²ç»éƒ¨ç½²çš„åº”ç”¨è‰¯å¥½å…¼å®¹ã€‚</p><p>AWS App Mesh çš„ç¼ºç‚¹å¯èƒ½æ˜¯ä½¿å¾—å¼€å‘è€…æ·±åº¦ç»‘å®šäº†å•ä¸€ä¾›åº”å•†æ–¹æ¡ˆï¼Œç›¸å¯¹é—­æºï¼Œå¯æ‰©å±•æ€§ç¼ºå¤±ã€‚</p><p><strong>OpenShift Service Mesh by Red Hat</strong></p><p>OpenShift æ˜¯æ¥è‡ªçº¢å¸½çš„ä¸€æ¬¾å¸®åŠ©ç”¨æˆ·â€œè¿æ¥ã€ç®¡ç†ã€è§‚æµ‹å¾®æœåŠ¡åº”ç”¨â€çš„å®¹å™¨ç®¡ç†å¹³å°ã€‚OpenShift é¢„è£…äº†ä¸å°‘æå‡ä¼ä¸šèƒ½åŠ›çš„ç»„ä»¶ï¼Œä¹Ÿè¢«å½¢å®¹ä¸ºä¼ä¸šçº§çš„æ··åˆäº‘ Kubernetes å¹³å°ã€‚</p><p>OpenShift Service Mesh åŸºäºå¼€æºçš„ Istio æ„å»ºï¼Œå…·å¤‡ Isito çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢ç­‰ç‰¹æ€§ã€‚OpenShift åˆ©ç”¨ä¸¤æ¬¾å¼€æºå·¥å…·æ¥å¢å¼º Isito çš„è¿½è¸ªèƒ½åŠ›å’Œå¯è§‚æµ‹æ€§ã€‚OpenShift ä½¿ç”¨ Jaeger å®ç°åˆ†å¸ƒå¼è¿½è¸ªï¼Œæ›´å¥½åœ°è·Ÿè¸ªè¯·æ±‚æ˜¯å¦‚ä½•åœ¨æœåŠ¡é—´è°ƒç”¨å¤„ç†çš„ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼ŒOpenShift ä½¿ç”¨äº† Kiali æ¥å¢å¼ºå¾®æœåŠ¡é…ç½®ã€æµé‡ç›‘æ§ã€è·Ÿè¸ªåˆ†æç­‰æ–¹é¢çš„å¯è§‚æµ‹æ€§ã€‚</p><h2><span id="å¦‚ä½•é€‰æ‹©">å¦‚ä½•é€‰æ‹©</span></h2><p>æ­£å¦‚æ–‡ä¸­æ‰€æåˆ°çš„ï¼Œå¯ä¾›é€‰æ‹©çš„æœåŠ¡ç½‘æ ¼æ–¹æ¡ˆ[6]æœ‰å¾ˆå¤šï¼ŒåŒæ—¶è¿˜æœ‰æ–°çš„æ–¹æ¡ˆåœ¨æ¶Œç°ã€‚å½“ç„¶ï¼Œæ¯ä¸€ç§æ–¹æ¡ˆåœ¨æŠ€æœ¯å®ç°ä¸Šéƒ½ç•¥æœ‰ä¸åŒã€‚é€‰æ‹©ä¸€æ¬¾åˆé€‚çš„æœåŠ¡ç½‘æ ¼ï¼Œä¸»è¦è€ƒè™‘çš„å› ç´ åŒ…æ‹¬ï¼Œä½ èƒ½æ¥å—å®ƒå¸¦æ¥å¤šå¤§çš„ä¾µå…¥æ€§ï¼Œå®ƒçš„å®‰å…¨æ€§å¦‚ä½•ï¼Œä»¥åŠå¹³å°æˆç†Ÿåº¦ç­‰ã€‚</p><p>ä»¥ä¸‹å‡ ç‚¹å¯ä»¥å¸®åŠ© DevOps å›¢é˜Ÿé€‰æ‹©ä¸€æ¬¾é€‚åˆä»–ä»¬åœºæ™¯çš„æœåŠ¡ç½‘æ ¼ï¼š</p><ul><li>æ˜¯å¦ä¾èµ–Envoyã€‚Envoy æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºç”Ÿæ€ã€‚å¼€æºï¼ŒåŒæ—¶æ˜¯è®¸å¤šæœåŠ¡ç½‘æ ¼çš„åº•åº§ã€‚Envoy å…·å¤‡çš„ä¸°å¯Œç‰¹æ€§ä½¿å¾—å…¶æˆä¸ºä¸€ä¸ªå¾ˆéš¾ç»•è¿‡çš„å› ç´ ã€‚</li><li>å…·ä½“ä½¿ç”¨åœºæ™¯ã€‚æœåŠ¡ç½‘æ ¼ä¸ºå¾®æœåŠ¡è€Œç”Ÿã€‚å¦‚æœä½ çš„åº”ç”¨æ˜¯ä¸€ä¸ªå•ä½“çš„åºç„¶å¤§ç‰©ï¼Œé‚£ä½ åœ¨æœåŠ¡ç½‘æ ¼ä¸Šçš„æŠ•å…¥å¯èƒ½è¾¾ä¸åˆ°é¢„æœŸçš„æ”¶ç›Šã€‚å¦‚æœä¸æ˜¯æ‰€æœ‰åº”ç”¨éƒ½éƒ¨ç½²åœ¨ Kubernetesï¼Œåˆ™åº”è¯¥ä¼˜å…ˆè€ƒè™‘å¹³å°æ— å…³çš„æ–¹æ¡ˆã€‚</li><li>ç°æœ‰å®¹å™¨ç®¡ç†å¹³å°ã€‚æœ‰äº›ä¼ä¸šå·²ç»ä½¿ç”¨äº†ç‰¹å®šä¾›åº”å•†çš„ç”Ÿæ€æ¥è§£å†³å®¹å™¨ç¼–æ’é—®é¢˜ï¼Œä¾‹å¦‚ AWS çš„ EKSï¼Œçº¢å¸½çš„ OpenShiftï¼ŒConsulã€‚æ²¿è¢­åŸæœ‰çš„ç”Ÿæ€ï¼Œå¯ä»¥ç»§æ‰¿å¹¶æ‹“å±•åŸæœ‰çš„ç‰¹æ€§ã€‚è€Œè¿™äº›å¯èƒ½æ˜¯å¼€æºæ–¹æ¡ˆæ‰€ä¸èƒ½æä¾›çš„ã€‚</li><li>æ‰€åœ¨è¡Œä¸šã€‚è®¸å¤šæœåŠ¡ç½‘æ ¼ä¸æ˜¯ä¸ºç‰¹å®šè¡Œä¸šä¸“é—¨è®¾è®¡çš„ã€‚Kuma ç»Ÿä¸€ç®¡ç†å¤šä¸ªéš”ç¦»æœåŠ¡ç½‘æ ¼çš„èƒ½åŠ›å¯èƒ½æ›´é€‚ç”¨äºæ”¶åˆ°é«˜åº¦ç®¡åˆ¶çš„é‡‘èè¡Œä¸šã€‚åº•å±‚ç½‘ç»œ telcos å’Œ ISPs åˆ™æ›´åº”è¯¥è€ƒè™‘ Network Service Meshã€‚</li><li>å¯¹å¯è§†åŒ–çš„è¦æ±‚ã€‚å¯è§‚æµ‹æ€§æ˜¯æœåŠ¡ç½‘æ ¼çš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€ã€‚è€ƒè™‘è¿›ä¸€æ­¥å®šåˆ¶å’Œæ›´æ·±åº¦èƒ½åŠ›çš„å›¢é˜Ÿåº”è¯¥ä¼˜å…ˆè€ƒè™‘ Istio æˆ– Consulã€‚</li><li>æ˜¯å¦éµå¾ªå¼€å‘æ ‡å‡†ã€‚éµå¾ªå¼€å‘æ ‡å‡†ä½¿å¾—ä½ çš„å¹³å°æ›´å…·å¤‡å‰ç»æ€§å’Œå¯æ‰©å±•æ€§ã€‚è¿™ä½¿å¾—ä¼ä¸šä¼šå€¾å‘äºé‡‡ç”¨æ”¯æŒ SMI çš„æ–¹æ¡ˆï¼ŒMaesh æˆ–å…¶ä»–åŸºé‡‘ä¼šå­µåŒ–çš„é¡¹ç›®å¦‚ Linkerdã€‚</li><li>æ˜¯å¦é‡è§†ç”¨æˆ·ä½“éªŒã€‚è€ƒè™‘è¿ç»´äººå‘˜çš„æ˜“ç”¨æ€§æ˜¯è¯„åˆ¤æ–°å·¥å…·çš„å…³é”®æŒ‡æ ‡ã€‚è¿™æ–¹ Linkerd ä¼¼ä¹åœ¨å¼€å‘è€…ä¸­é—´å£ç¢‘ä¸é”™ã€‚</li><li>å›¢é˜Ÿå‡†å¤‡ã€‚è¯„ä¼°ä½ çš„å›¢é˜Ÿæ‰€å…·å¤‡çš„èµ„æºå’ŒæŠ€æœ¯å‚¨å¤‡ï¼Œåœ¨æŠ€æœ¯é€‰å‹æ—¶å†³å®šä½ ä»¬é€‚åˆç”¨åŸºäº Envoy çš„ Istioï¼Œæˆ–æ˜¯ä¾›åº”å•†æŠ½è±¡å°è£…çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ OpenShiftã€‚</li></ul><p>è¿™äº›è€ƒè™‘å› ç´ æ²¡æœ‰è¦†ç›–åˆ°å…¨éƒ¨åœºæ™¯ã€‚æ­¤å¤„ä»…æ˜¯æŠ›ç –å¼•ç‰ï¼Œå¼•èµ·è¯»è€…çš„æ€è€ƒã€‚å¸Œæœ›è¯»å®Œä¸Šé¢æ‰€åˆ—çš„æœåŠ¡ç½‘æ ¼æ¸…å•ï¼Œå’Œç›¸å…³çš„å†³ç­–å› ç´ ä¹‹åï¼Œä½ ä»¬çš„å›¢é˜Ÿèƒ½æ‰¾åˆ°æ–°çš„æ–¹æ³•å»æ”¹å–„å¾®æœåŠ¡åº”ç”¨çš„ç½‘ç»œç‰¹æ€§ã€‚</p><p>ç›¸å…³é“¾æ¥ï¼š</p><ol><li><a href="https://techbeacon.com/app-dev-testing/3-reasons-why-you-should-always-run-microservices-apps-containers" target="_blank" rel="noopener">https://techbeacon.com/app-dev-testing/3-reasons-why-you-should-always-run-microservices-apps-containers</a></li><li><a href="https://buoyant.io/service-mesh-manifesto/" target="_blank" rel="noopener">https://buoyant.io/service-mesh-manifesto/</a></li><li><a href="https://docs.mae.sh/quickstart/" target="_blank" rel="noopener">https://docs.mae.sh/quickstart/</a></li><li><a href="https://github.com/go-chassis/go-chassis" target="_blank" rel="noopener">https://github.com/go-chassis/go-chassis</a></li><li><a href="https://github.com/networkservicemesh/examples/tree/master/examples/envoy_interceptor" target="_blank" rel="noopener">https://github.com/networkservicemesh/examples/tree/master/examples/envoy_interceptor</a></li><li><a href="https://techbeacon.com/app-dev-testing/make-your-app-architecture-cloud-native-service-mesh" target="_blank" rel="noopener">https://techbeacon.com/app-dev-testing/make-your-app-architecture-cloud-native-service-mesh</a></li></ol><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://techbeacon.com/app-dev-testing/9-open-source-service-meshes-compared" target="_blank" rel="noopener">https://techbeacon.com/app-dev-testing/9-open-source-service-meshes-compared</a></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ  åˆ†å¸ƒå¼å®éªŒå®¤ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/4xsy53bd" target="_blank" rel="noopener">https://tinyurl.com/4xsy53bd</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å“ªç§æœåŠ¡ç½‘æ ¼æœ€é€‚åˆä½ çš„ä¼ä¸šï¼Ÿè¿‘å¹´æ¥ï¼ŒKubernetes æœåŠ¡ç½‘æ ¼æ¡†æ¶æ•°é‡å¢åŠ è¿…é€Ÿï¼Œä½¿å¾—è¿™æˆä¸ºä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å°†ä»‹ç» 9 ç§è¾ƒå—æ¬¢è¿çš„ç”¨ä»¥æ”¯æ’‘å¾®æœåŠ¡å¼€å‘çš„æœåŠ¡ç½‘æ ¼æ¡†æ¶ï¼Œæ¯ç§æ–¹æ¡ˆéƒ½ç»™å‡ºäº†å…¶é€‚ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼&quot;&gt;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼è¿‘å¹´æ¥æœ‰å¾ˆé«˜çš„è¯é¢˜åº¦ï¼ŒèƒŒåçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¾®æœåŠ¡å·²ç»æˆä¸ºä¸€ç§çµæ´»å¿«é€Ÿçš„å¼€å‘æ–¹å¼ã€‚ç„¶è€Œï¼Œéšç€å¾®æœåŠ¡æ•°é‡æˆå€æ•°åœ°å¢é•¿ï¼Œå¼€å‘å›¢é˜Ÿå¼€å§‹é‡åˆ°äº†éƒ¨ç½²å’Œæ‰©å±•æ€§ä¸Šçš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨å’Œ Kubernetes è¿™æ ·çš„å®¹å™¨ç¼–æ’ç³»ç»Ÿ ï¼Œå°†è¿è¡Œæ—¶å’ŒæœåŠ¡ä¸€èµ·æ‰“åŒ…è¿›é•œåƒï¼Œè°ƒåº¦å®¹å™¨åˆ°åˆé€‚çš„èŠ‚ç‚¹ï¼Œè¿è¡Œå®¹å™¨ã€‚è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥è§£å†³å¼€å‘å›¢é˜Ÿé‡åˆ°çš„ä¸å°‘é—®é¢˜[1]ã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¸ªæ“ä½œæµç¨‹ä¸­ä»å­˜åœ¨çŸ­æ¿ï¼šå¦‚ä½•ç®¡ç†æœåŠ¡é—´çš„é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é‡‡ç”¨æœåŠ¡ç½‘æ ¼çš„åœºæ™¯ä¸‹ï¼Œä»¥ä¸€ç§å’Œåº”ç”¨ä»£ç è§£è€¦çš„æ–¹å¼ï¼Œå¢å¼ºäº†åº”ç”¨é—´ç»Ÿä¸€çš„ç½‘ç»œé€šä¿¡èƒ½åŠ›ã€‚æœåŠ¡ç½‘æ ¼æ‰©å±•äº†é›†ç¾¤çš„ç®¡ç†èƒ½åŠ›ï¼Œå¢å¼ºå¯è§‚æµ‹æ€§ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€IT è¿ç»´ç›‘æ§åŠåº”ç”¨æ•…éšœæ¢å¤ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.hi-linux.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="å¾®æœåŠ¡" scheme="https://www.hi-linux.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Istio" scheme="https://www.hi-linux.com/tags/Istio/"/>
    
  </entry>
  
  <entry>
    <title>è¶…ç»™åŠ›ï¼Œä¸€æ¬¾ç®€å•åˆå®ç”¨çš„å…è´¹ GitHub åŠ é€Ÿç¥å™¨</title>
    <link href="https://www.hi-linux.com/posts/8698.html"/>
    <id>https://www.hi-linux.com/posts/8698.html</id>
    <published>2021-08-25T01:00:00.000Z</published>
    <updated>2021-08-25T02:41:30.820Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>ä»Šå¤©ç»™å¤§å®¶æ¨èä¸€ä¸ªå ªç§° GitHub åŠ é€Ÿç¥å™¨çš„å¼€æºé¡¹ç›®ã€‚</p><p>è¿™ä¸ªå¼€æºé¡¹ç›®å°±æ˜¯ï¼š<strong>FastGitHub</strong>ï¼Œå®ƒä¸»è¦è§£å†³ GitHub æ‰“ä¸å¼€ã€ç”¨æˆ·å¤´åƒæ— æ³•åŠ è½½ã€releases æ— æ³•ä¸Šä¼ ä¸‹è½½ã€git-cloneã€git-pullã€git-push å¤±è´¥ç­‰é—®é¢˜ã€‚</p><p>è¯¥é¡¹ç›®çš„å¥½å¤„å°±æ˜¯ä¸“é—¨é’ˆå¯¹ GitHub è®¿é—®é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œå…·æœ‰åˆæ³•æ€§ï¼Œå¯é æ€§ï¼Œç¨³å®šæ€§ã€‚æœ€é‡è¦çš„æ˜¯å®ƒæ˜¯å…è´¹çš„ï¼Œè€Œä¸”ä¸éœ€è¦å¤–ç½‘æœåŠ¡å™¨èµ„æºã€‚</p><h2><span id="fastgithub-åŠ é€ŸåŸç†">FastGitHub åŠ é€ŸåŸç†</span></h2><ul><li>ä¿®æ”¹æœ¬æœºçš„ <code>DNS</code> æœåŠ¡æŒ‡å‘ FastGithub è‡ªèº«</li><li>è§£æåŒ¹é…çš„åŸŸåä¸º <code>FastGithub</code> è‡ªèº«çš„ IP</li><li>è¯·æ±‚å®‰å…¨ <code>DNS</code> æœåŠ¡ (<code>dnscrypt-proxy</code>) è·å–ç›¸åº”åŸŸåçš„ <code>IP</code></li><li>é€‰æ‹©æœ€ä¼˜çš„ <code>IP</code> è¿›è¡Œ <code>SSH</code> æˆ– <code>HTTPS</code> åå‘ä»£ç†</li></ul><blockquote><ul><li><p>å¼€æºé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/dotnetcore/FastGithub" target="_blank" rel="noopener">https://github.com/dotnetcore/FastGithub</a></p></li><li><p>å¼€æºé¡¹ç›®ä½œè€…ï¼š.NET Core Community</p></li></ul></blockquote><h2><span id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</span></h2><h3><span id="1-å®‰è£…-fastgithub">1. å®‰è£… FastGithub</span></h3><h4><span id="æœ¬åœ°ç¯å¢ƒå®‰è£…">æœ¬åœ°ç¯å¢ƒå®‰è£…</span></h4><p>è¿è¡Œ <code>FastGithub</code> ç¨‹åºï¼Œæœ¬æœºçš„ç½‘ç»œé€‚é…å™¨çš„ <code>DNS</code> ä¼šè‡ªåŠ¨å˜æˆ 127.0.0.1ã€‚</p><p>å¦‚æœç½‘ç»œé€‚é…å™¨çš„ <code>DNS</code> æ²¡æœ‰å˜æˆ <code>127.0.0.1</code>ï¼Œè¯·æ‰‹å·¥ä¿®æ”¹ç½‘ç»œé€‚é…å™¨çš„ <code>DNS</code>ã€‚</p><blockquote><p>æ³¨ï¼š Linux å’Œ macOS ç³»ç»Ÿéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ã€‚</p></blockquote><h4><span id="å±€åŸŸç½‘æœåŠ¡å™¨å®‰è£…æ¨è">å±€åŸŸç½‘æœåŠ¡å™¨å®‰è£…(æ¨è)</span></h4><ul><li>åœ¨ Linux æœåŠ¡å™¨ä¸Šè¿è¡Œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ yum install libicu # å®‰è£…ä¾èµ–åŒ…</span><br><span class="line">$ wget https:&#x2F;&#x2F;github.com&#x2F;dotnetcore&#x2F;FastGithub&#x2F;releases&#x2F;download&#x2F;1.1.8&#x2F;FastGithub_linux-x64.zip</span><br><span class="line">$ unzip FastGithub_linux-x64.zip</span><br><span class="line">$ cd  FastGithub_linux-x64</span><br><span class="line">$ .&#x2F;FastGithub</span><br></pre></td></tr></table></figure><ul><li>åœ¨ Windows æœåŠ¡å™¨ä¸Šè¿è¡Œ</li></ul><p>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ <code>cmd</code>ï¼Œé”®å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå…¶ä¸­ <code>D:\Softs</code> ä¸ºè½¯ä»¶å®é™…ç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\Softs\FastGithub.exe start &#x2F;&#x2F; ä»¥ Windows æœåŠ¡å®‰è£…å¹¶å¯åŠ¨</span><br><span class="line">D:\Softs\FastGithub.exe stop &#x2F;&#x2F; å¸è½½å¹¶åˆ é™¤ Windows æœåŠ¡</span><br></pre></td></tr></table></figure><h3><span id="2-ä½¿ç”¨-fastgithub">2. ä½¿ç”¨ FastGithub</span></h3><p>FastGithub å®‰è£…å®Œæˆåï¼Œ é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://127.0.0.1</code> æˆ– <code>https://127.0.0.1</code> ä»¥åŠæ‰€åœ¨æœºå™¨çš„å…¶å®ƒ IP è¿›å…¥ FastGithub çš„ Dashboardã€‚</p><p><img src="https://img.hi-linux.com/staticfile/image-20210824134508736-2021-08-24-HDI4u9.png" alt></p><p>æ¥ä¸‹æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µæŒ‰ <code>Dashboard</code> é¡µé¢çš„æç¤ºè¿›è¡Œç®€å•è®¾ç½®åï¼Œä¾¿å¯é«˜é€Ÿè®¿é—® Githubã€‚</p><ol><li>æ‰‹å·¥ä¿®æ”¹ä½ ç”µè„‘çš„ <code>DNS</code> æœåŠ¡å™¨çš„ IP ä¸º <code>127.0.0.1</code> æˆ–å±€åŸŸç½‘æœåŠ¡å™¨çš„ <code>IP</code>ã€‚</li><li>æ‰‹å·¥ä¸‹è½½å’Œå®‰è£… <code>FastGithub.cer</code> åˆ°å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„</li></ol><p><img src="https://img.hi-linux.com/staticfile/image-20210824135233117-2021-08-24-0EnZhv.png" alt></p></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;div id=&quot;vip-container&quot;&gt;&lt;p&gt;ä»Šå¤©ç»™å¤§å®¶æ¨èä¸€ä¸ªå ªç§° GitHub åŠ é€Ÿç¥å™¨çš„å¼€æºé¡¹ç›®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå¼€æºé¡¹ç›®å°±æ˜¯ï¼š&lt;strong&gt;FastGitHub&lt;/strong&gt;ï¼Œå®ƒä¸»è¦è§£å†³ GitHub æ‰“ä¸å¼€ã€ç”¨æˆ·å¤´åƒæ— æ³•åŠ è½½ã€releases
        
      
    
    </summary>
    
    
      <category term="GitHub" scheme="https://www.hi-linux.com/categories/GitHub/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="GitHub" scheme="https://www.hi-linux.com/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>6 å¼ å›¾å¸¦ä½ ææ‡‚ CI/CD æµæ°´çº¿</title>
    <link href="https://www.hi-linux.com/posts/22785.html"/>
    <id>https://www.hi-linux.com/posts/22785.html</id>
    <published>2021-08-20T01:00:00.000Z</published>
    <updated>2021-08-20T08:11:43.614Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p>åœ¨CI/CDå’ŒDevOpsé¢†åŸŸä¸­ï¼ŒæŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ã€‚æŒç»­é›†æˆè¿™ä¸ªæœ¯è¯­æœ€æ—©æ˜¯åœ¨1994å¹´ç”±Grady Boochæå‡ºã€‚å¾®æœåŠ¡æå‡ºè€…Martin Floweråœ¨2014å¹´å‘è¡¨çš„è®ºæ–‡ã€ŠMicroserviceã€‹ä¸­ä¹Ÿå¯¹è½¯ä»¶å¼€å‘æŒç»­é›†æˆæä¾›äº†å¯å‚è€ƒåŸåˆ™ã€‚æŒç»­é›†æˆæ˜¯å€ŸåŠ©å·¥å…·å¯¹è½¯ä»¶é¡¹ç›®è¿›è¡ŒæŒç»­çš„è‡ªåŠ¨åŒ–çš„ç¼–è¯‘æ‰“åŒ…æ„å»ºæµ‹è¯•å‘å¸ƒï¼Œæ¥æ£€æŸ¥è½¯ä»¶äº¤ä»˜è´¨é‡çš„ä¸€ç§è¡Œä¸ºã€‚è€ŒæŒç»­éƒ¨ç½²æ˜¯åŸºäºæŒç»­äº¤ä»˜çš„ä¼˜åŠ¿è‡ªåŠ¨å°†ç»è¿‡æµ‹è¯•çš„ä»£ç æ¨å…¥ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹ã€‚ä¸‹æ–‡ä»ç»†èŠ‚æè¿°äº†æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²å„é˜¶æ®µçš„å…³é”®æ­¥éª¤ï¼Œä»¥ä¸‹æ˜¯åŸæ–‡ã€‚</p></blockquote><p>æœ¬æ–‡å°†æ¢è®¨CIï¼ˆæŒç»­é›†æˆï¼‰/CDï¼ˆæŒç»­éƒ¨ç½²ï¼‰æµç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µï¼›ä»¥åŠä»å¿«é€Ÿã€è§„æ¨¡äº¤ä»˜çš„è§†è§’æ¢è®¨ä¸ºä»€ä¹ˆCI/CDæµæ°´çº¿å¯¹äºæˆ‘ä»¬çš„ç»„ç»‡æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><p>CI/CDæµæ°´çº¿å·¥ä½œæµåŒ…æ‹¬CI/CDæµç¨‹å¼€å§‹æ—¶æ‰€æœ‰é˜¶æ®µç­‰ä¸€ç³»åˆ—æ­¥éª¤ï¼Œè´Ÿè´£åˆ›å»ºè‡ªåŠ¨ã€è¿è´¯çš„è½¯ä»¶äº¤ä»˜æ¨¡å‹ã€‚</p><p>é€šè¿‡CI/CDæµæ°´çº¿ï¼Œè½¯ä»¶ç ”å‘å¯ä»¥å®ç°ä»ä»£ç ç­¾å…¥ã€æµ‹è¯•ã€æ„å»ºå’Œéƒ¨ç½²ç›´è‡³ç”Ÿäº§é˜¶æ®µéƒ½åœ¨æµæ°´çº¿ä¸­å‘å‰æ¨è¿›ã€‚æ­¤æ¦‚å¿µä¹‹æ‰€ä»¥é«˜å¤§ä¸Šï¼Œæ˜¯å› ä¸ºä¸€æ—¦å®æ–½äº†æµæ°´çº¿ï¼Œå°±å¯ä»¥å°†å…¶éƒ¨åˆ†æˆ–å…¨éƒ¨è‡ªåŠ¨åŒ–ï¼Œä»è€ŒåŠ å¿«å¼€å‘æµç¨‹å¹¶å‡å°‘é”™è¯¯ã€‚æ¢å¥è¯è¯´ï¼ŒCI/CDæµæ°´çº¿ä½¿ä¼ä¸šå¯ä»¥æ›´è½»æ¾åœ°åº”å¯¹è½¯ä»¶çš„è‡ªåŠ¨ã€å¿«é€Ÿã€æŒç»­äº¤ä»˜ã€‚</p><p>DevOpså·¥ç¨‹å¸ˆç»å¸¸ä¼šå°†CI/CDå„é˜¶æ®µçš„å’Œå…¶CI/CDæµæ°´çº¿æ··æ·†ã€‚å°½ç®¡ä¸åŒçš„å·¥å…·å¯ä»¥å°†æ¯ä¸ªå¤æ‚é˜¶æ®µè‡ªåŠ¨åŒ–å®Œæˆåˆ†é˜¶æ®µçš„CI/CDï¼Œä½†æ˜¯æ•´ä½“CI/CDè½¯ä»¶é“¾ä»ç„¶å¯èƒ½ç”±äºä¸å¯é¿å…çš„äººå·¥å¹²é¢„è€Œä¸­æ–­ã€‚å› æ­¤æˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£CI/CDæµç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µï¼Œä»¥åŠä»å¿«é€Ÿã€è§„æ¨¡äº¤ä»˜çš„è§†è§’æ¢è®¨ä¸ºä»€ä¹ˆCI/CDæµæ°´çº¿å¯¹äºæˆ‘ä»¬çš„ç»„ç»‡æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><a id="more"></a><h2><span id="cicd-é˜¶æ®µç†è§£å‚ä¸è€…-æµç¨‹-æŠ€æœ¯">CI/CD é˜¶æ®µï¼šç†è§£å‚ä¸è€…ã€æµç¨‹ã€æŠ€æœ¯</span></h2><p>ä¼ä¸šåº”ç”¨ç¨‹åºå¼€å‘å‚ä¸è€…é€šå¸¸ç”±å¼€å‘äººå‘˜ï¼Œæµ‹è¯•äººå‘˜/QAå·¥ç¨‹å¸ˆï¼Œè¿ç»´å·¥ç¨‹å¸ˆä»¥åŠSREï¼ˆç«™ç‚¹å¯é æ€§å·¥ç¨‹å¸ˆï¼‰æˆ–ITè¿è¥å›¢é˜Ÿç»„æˆã€‚ä»–ä»¬ç´§å¯†åˆä½œï¼Œç›®æ ‡æ˜¯é«˜è´¨é‡è½¯ä»¶äº¤ä»˜ã€‚CI/CDæ˜¯ä¸¤ä¸ªç‹¬ç«‹è¿‡ç¨‹çš„ç»„åˆï¼šæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ã€‚ä¸‹é¢åˆ—å‡ºäº†æ¯ä¸ªæ­¥éª¤ä¸­çš„ä¸»è¦æ­¥éª¤ï¼š</p><p><img src="https://img.hi-linux.com/staticfile/640-20210616154923127-2021-06-16-Fyhe7J.png" alt></p><h2><span id="æŒç»­é›†æˆ">æŒç»­é›†æˆ</span></h2><p>æŒç»­é›†æˆï¼ˆCIï¼‰æ˜¯æ„å»ºè½¯ä»¶å’Œå®Œæˆåˆå§‹æµ‹è¯•çš„è¿‡ç¨‹ã€‚æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰æ˜¯å°†ä»£ç ä¸åŸºç¡€è®¾æ–½ç›¸ç»“åˆçš„è¿‡ç¨‹ï¼Œç¡®ä¿å®Œæˆæ‰€æœ‰æµ‹è¯•å¹¶éµå¾ªç­–ç•¥ï¼Œç„¶åå°†ä»£ç éƒ¨ç½²åˆ°é¢„æœŸç¯å¢ƒä¸­ã€‚å½“ç„¶ï¼Œè®¸å¤šå…¬å¸ä¹Ÿæœ‰è‡ªå·±ç‰¹æœ‰æµç¨‹ï¼Œä½†ä¸»è¦æ­¥éª¤å¦‚ä¸‹ã€‚</p><p><strong>CIï¼šä»£ç æäº¤é˜¶æ®µ</strong></p><p><img src="https://img.hi-linux.com/staticfile/640-20210616154929212-2021-06-16-5XICGL.png" alt></p><ul><li><p>å‚ä¸è€…ï¼šå¼€å‘å·¥ç¨‹å¸ˆï¼Œæ•°æ®åº“ç®¡ç†å‘˜ï¼ˆDBAï¼‰ï¼ŒåŸºç¡€æ¶æ„å›¢é˜Ÿ</p></li><li><p>æŠ€æœ¯ï¼šGitHubï¼ŒGitLabï¼ŒSVMï¼ŒBitBucket</p></li><li><p>æµç¨‹ï¼šä»£ç æäº¤é˜¶æ®µä¹Ÿç§°ä¸ºç‰ˆæœ¬æ§åˆ¶ã€‚æäº¤æ˜¯å°†å¼€å‘äººå‘˜ç¼–å†™çš„æœ€æ–°ä»£ç å˜æ›´å‘é€åˆ°ä»£ç å­˜å‚¨åº“çš„æ“ä½œã€‚å¼€å‘äººå‘˜ç¼–å†™çš„ä»£ç çš„æ¯ä¸ªç‰ˆæœ¬éƒ½è¢«æ— é™æœŸåœ°å­˜å‚¨ã€‚åœ¨ä¸åˆä½œè€…è®¨è®ºå’Œå®¡æŸ¥å˜æ›´ä¹‹åï¼Œå¼€å‘äººå‘˜å°†ç¼–å†™ä»£ç ï¼Œå¹¶åœ¨è½¯ä»¶éœ€æ±‚ã€ç‰¹æ€§å¢å¼ºã€bugä¿®å¤æˆ–å˜æ›´è¯·æ±‚å®Œæˆåæäº¤ã€‚ç®¡ç†ç¼–è¾‘å’Œæäº¤å˜æ›´çš„å­˜å‚¨åº“ç§°ä¸ºæºä»£ç ç®¡ç†å·¥å…·ï¼ˆé…ç½®ç®¡ç†å·¥å…·ï¼‰ã€‚åœ¨å¼€å‘äººå‘˜æäº¤ä»£ç ï¼ˆä»£ç æ¨é€è¯·æ±‚ï¼‰åï¼Œä»£ç æ›´æ”¹è¢«åˆå¹¶åˆ°ä¸»çº¿ä»£ç åˆ†æ”¯ä¸­ï¼Œè¿™äº›ä¸»çº¿ä»£ç åˆ†æ”¯å­˜å‚¨åœ¨GitHubè¿™æ ·çš„ä¸­å¤®å­˜å‚¨åº“ä¸­ã€‚</p></li></ul><p><strong>CIï¼šé™æ€ä»£ç æ£€æŸ¥é˜¶æ®µ</strong></p><ul><li><p>å‚ä¸è€…ï¼šå¼€å‘å·¥ç¨‹å¸ˆï¼Œæ•°æ®åº“ç®¡ç†å‘˜ï¼ˆDBAï¼‰ï¼ŒåŸºç¡€æ¶æ„å›¢é˜Ÿ</p></li><li><p>æŠ€æœ¯ï¼šGitHubï¼ŒGitLabï¼ŒSVMï¼ŒBitBucket</p></li><li><p>æµç¨‹ï¼šå¼€å‘äººå‘˜ç¼–å†™ä»£ç å¹¶å°†å…¶æ¨é€åˆ°å­˜å‚¨åº“åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§¦å‘ä»¥å¯åŠ¨ä¸‹ä¸€ä¸ªä»£ç åˆ†æè¿‡ç¨‹ã€‚å¼€å‘è¿‡ç¨‹ä¸­å­˜åœ¨è¿™ç§æƒ…å†µï¼šæäº¤çš„ä»£ç å¯ä»¥æ„å»ºæˆåŠŸï¼Œä½†åœ¨éƒ¨ç½²æœŸé—´æ„å»ºå¤±è´¥ã€‚æ— è®ºä»æœºå™¨è¿˜æ˜¯äººåŠ›èµ„æºçš„åˆ©ç”¨ç‡è€Œè¨€ï¼Œè¿™éƒ½æ˜¯ä¸€ä¸ªç¼“æ…¢è€Œæ˜‚è´µçš„è¿‡ç¨‹ã€‚å› æ­¤å¿…é¡»æ£€æŸ¥ä»£ç ä¸­çš„é™æ€ç­–ç•¥ã€‚SASTï¼ˆé™æ€åº”ç”¨ç¨‹åºå®‰å…¨æ€§æµ‹è¯•ï¼‰ï¼šSASTæ˜¯ä¸€ç§ç™½ç›’æµ‹è¯•æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨SonarQubeï¼ŒVeracodeï¼ŒAppscanç­‰SASTå·¥å…·ä»å†…éƒ¨æ£€æŸ¥ä»£ç ï¼Œä»¥å‘ç°è½¯ä»¶ç¼ºé™·ï¼Œæ¼æ´å’Œå¼±ç‚¹ï¼ˆä¾‹å¦‚SQLæ³¨å…¥ç­‰ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿæ£€æŸ¥è¿‡ç¨‹ï¼Œå…¶ä¸­æ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚å°½ç®¡æ­¤é˜¶æ®µç¼ºå°‘æ£€æŸ¥è¿è¡Œæ—¶é”™è¯¯çš„åŠŸèƒ½ï¼Œä½†è¯¥åŠŸèƒ½å°†åœ¨ä»¥åçš„é˜¶æ®µä¸­æ‰§è¡Œã€‚</p></li></ul><p>å°†é¢å¤–çš„ç­–ç•¥æ£€æŸ¥åŠ å…¥è‡ªåŠ¨åŒ–æµæ°´çº¿ä¸­å¯ä»¥æ˜¾è‘—å‡å°‘æµç¨‹ä¸­ç¨åå‘ç°çš„é”™è¯¯æ•°é‡ã€‚</p><p><strong>CIï¼šæ„å»º</strong></p><p><img src="https://img.hi-linux.com/staticfile/640-20210616152412585-2021-06-16-Ji7Bgv.png" alt></p><ul><li><p>å‚ä¸è€…ï¼šå¼€å‘å·¥ç¨‹å¸ˆ</p></li><li><p>æŠ€æœ¯ï¼šJenkinsï¼ŒBamboo CIï¼ŒCircle CIï¼ŒTravis CIï¼ŒMavenï¼ŒAzure DevOps</p></li><li><p>æµç¨‹ï¼šæŒç»­é›†æˆè¿‡ç¨‹çš„ç›®æ ‡æ˜¯æäº¤çš„ä»£ç æŒç»­æ„å»ºä¸ºäºŒè¿›åˆ¶æ–‡ä»¶æˆ–æ„å»ºäº§ç‰©ã€‚é€šè¿‡æŒç»­é›†æˆæ¥æ£€æŸ¥æ·»åŠ çš„æ–°æ¨¡å—æ˜¯å¦ä¸ç°æœ‰æ¨¡å—å…¼å®¹ï¼Œä¸ä»…æœ‰åŠ©äºæ›´å¿«åœ°å‘ç°bugï¼Œè¿˜æœ‰åŠ©äºå‡å°‘éªŒè¯æ–°ä»£ç æ›´æ”¹çš„æ—¶é—´ã€‚æ„å»ºå·¥å…·å¯ä»¥æ ¹æ®å‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„æºä»£ç åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–åŒ…ï¼ˆ.exeï¼Œ.dllï¼Œ.jarç­‰ï¼‰ã€‚åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œè¿˜å¯ä»¥ç”ŸæˆSQLè„šæœ¬ï¼Œé…åˆåŸºç¡€è®¾æ–½é…ç½®æ–‡ä»¶ä¸€èµ·è¿›è¡Œæµ‹è¯•ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ„å»ºé˜¶æ®µå°±æ˜¯ç¼–è¯‘åº”ç”¨ç¨‹åºçš„é˜¶æ®µã€‚Artifactoryå­˜å‚¨ã€æ„å»ºéªŒè¯æµ‹è¯•å’Œå•å…ƒæµ‹è¯•ä¹Ÿå¯ä»¥ä½œä¸ºæ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p></li></ul><p>æ„å»ºéªŒè¯æµ‹è¯•ï¼ˆBVTï¼‰/å†’çƒŸæµ‹è¯•/å•å…ƒæµ‹è¯•ï¼š</p><p>åˆ›å»ºæ„å»ºåç«‹å³æ‰§è¡Œå†’çƒŸæµ‹è¯•ã€‚BVTå°†æ£€æŸ¥æ‰€æœ‰æ¨¡å—æ˜¯å¦æ­£ç¡®é›†æˆï¼Œä»¥åŠç¨‹åºçš„å…³é”®åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯æ‹’ç»ä¸¥é‡æŸåçš„åº”ç”¨ç¨‹åºï¼Œä»¥ä½¿QAå›¢é˜Ÿä¸ä¼šåœ¨å®‰è£…å’Œæµ‹è¯•è½¯ä»¶åº”ç”¨ç¨‹åºæ­¥éª¤æµªè´¹æ—¶é—´ã€‚</p><p>åœ¨å®Œæˆè¿™äº›æ£€æŸ¥åï¼Œå°†å‘æµæ°´çº¿ä¸­æ‰§è¡ŒUTï¼ˆå•å…ƒæµ‹è¯•ï¼‰ï¼Œä»¥è¿›ä¸€æ­¥å‡å°‘ç”Ÿäº§ä¸­çš„æ•…éšœã€‚å•å…ƒæµ‹è¯•å¯éªŒè¯å¼€å‘äººå‘˜ç¼–å†™çš„å•ä¸ªå•å…ƒæˆ–ç»„ä»¶æ˜¯å¦æŒ‰é¢„æœŸæ‰§è¡Œã€‚</p><p>æ„å»ºäº§ç‰©å­˜å‚¨ï¼š</p><p>ä¸€æ—¦æ„å»ºå°±ç»ªï¼Œç¨‹åºåŒ…å°±ä¼šå­˜å‚¨åœ¨ç§°ä¸ºArtifactoryæˆ–Repositoryå·¥å…·çš„ä¸­å¤®æ•°æ®åº“ã€‚éšç€æ¯å¤©æ„å»ºé‡çš„å¢åŠ ï¼Œè·Ÿè¸ªæ‰€æœ‰æ„å»ºäº§ç‰©ä¹Ÿä¼šå˜å¾—æ„ˆåŠ å›°éš¾ã€‚å› æ­¤ï¼Œä¸€æ—¦ç”Ÿæˆå¹¶éªŒè¯äº†æ„å»ºäº§ç‰©ï¼Œå°±å°†å…¶å‘é€åˆ°å­˜å‚¨åº“è¿›è¡Œå­˜å‚¨ç®¡ç†ã€‚è¯¸å¦‚Jfrog Artifactoryä¹‹ç±»çš„å­˜å‚¨åº“å·¥å…·å¯ç”¨äºå­˜å‚¨è¯¸å¦‚.rarï¼Œ.warï¼Œ.exeï¼ŒMsiç­‰ä¹‹ç±»çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æµ‹è¯•äººå‘˜å¯ä»¥ä»æ­¤å¤„æ‰‹åŠ¨è¿›è¡Œé€‰æ‹©ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­éƒ¨ç½²æ„å»ºäº§ç‰©ä»¥è¿›è¡Œæµ‹è¯•ã€‚</p><p><strong>CIï¼šæµ‹è¯•é˜¶æ®µ</strong></p><p><img src="https://img.hi-linux.com/staticfile/640-20210616152412605-2021-06-16-52oF9C.png" alt></p><ul><li><p>å‚ä¸è€…ï¼šæµ‹è¯•äººå‘˜ã€QA</p></li><li><p>æŠ€æœ¯ï¼šSeleniumï¼ŒAppiumï¼ŒJmeterï¼ŒSOAP UIï¼ŒTarantula</p></li><li><p>è¿‡ç¨‹ï¼šå‘å¸ƒæ„å»ºè¿‡ç¨‹åçš„ä¸€ç³»åˆ—è‡ªåŠ¨æµ‹è¯•å°†éªŒè¯ä»£ç çš„å‡†ç¡®æ€§ã€‚æ­¤é˜¶æ®µå¯å¸®åŠ©é¿å…ç”Ÿäº§ä¸­çš„é”™è¯¯ã€‚æ ¹æ®æ„å»ºçš„å¤§å°ï¼Œæ­¤æ£€æŸ¥å¯èƒ½æŒç»­æ•°ç§’è‡³æ•°å°æ—¶ã€‚å¯¹äºç”±å¤šä¸ªå›¢é˜Ÿæäº¤å’Œæ„å»ºä»£ç çš„å¤§å‹ç»„ç»‡ï¼Œè¿™äº›æ£€æŸ¥åœ¨å¹¶è¡Œç¯å¢ƒä¸­è¿è¡Œï¼Œä»¥èŠ‚çœå®è´µçš„æ—¶é—´å¹¶å°½æ—©å°†é”™è¯¯é€šçŸ¥å¼€å‘äººå‘˜ã€‚</p></li></ul><p>æµ‹è¯•äººå‘˜ï¼ˆæˆ–ç§°ä¸ºQAå·¥ç¨‹å¸ˆï¼‰åŸºäºç”¨æˆ·æè¿°çš„æµ‹è¯•ç”¨ä¾‹å’Œåœºæ™¯è®¾ç½®è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ã€‚ä»–ä»¬æ‰§è¡Œå›å½’åˆ†æã€å‹åŠ›æµ‹è¯•æ¥æ£€æŸ¥ä¸é¢„æœŸè¾“å‡ºçš„åå·®ã€‚æµ‹è¯•ä¸­æ¶‰åŠçš„æ´»åŠ¨æœ‰å®Œæ•´æ€§æµ‹è¯•ã€é›†æˆæµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜å±‚æ¬¡æµ‹è¯•æ–¹æ³•ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¯ä»¥å‘ç°å¼€å‘äººå‘˜å¿½è§†çš„æŸäº›ä»£ç é—®é¢˜ã€‚</p><p>é›†æˆæµ‹è¯•ï¼š</p><p>é›†æˆæµ‹è¯•æ˜¯ä½¿ç”¨Cucumberã€Seleniumç­‰å·¥å…·æ‰§è¡Œçš„ï¼Œåœ¨è¿™äº›å·¥å…·ä¸­ï¼Œå•ä¸ªåº”ç”¨ç¨‹åºæ¨¡å—è¢«ç»„åˆèµ·æ¥å¹¶ä½œä¸ºä¸€ç»„è¿›è¡Œæµ‹è¯•ï¼ŒåŒæ—¶è¯„ä¼°å…¶æ˜¯å¦ç¬¦åˆæŒ‡å®šçš„åŠŸèƒ½éœ€æ±‚ã€‚åœ¨é›†æˆæµ‹è¯•ä¹‹åï¼Œéœ€è¦æœ‰äººæ‰¹å‡†è¯¥ç»„ä¸­çš„æ›´æ–°é›†åº”è¯¥ç§»åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œè¿™é€šå¸¸æ˜¯æ€§èƒ½æµ‹è¯•ã€‚è¿™ä¸ªéªŒè¯è¿‡ç¨‹å¯èƒ½å¾ˆéº»çƒ¦ï¼Œä½†å®ƒæ˜¯æ•´ä¸ªè¿‡ç¨‹çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚éªŒè¯è¿™ä¸ªè¿‡ç¨‹ä¸šç•Œæœ‰å¾ˆå¤šä¼˜ç§€çš„æ–¹æ¡ˆã€‚</p><p>æ€§èƒ½å’Œå‹åŠ›æµ‹è¯•ï¼š</p><p>Seleniumã€JMeterç­‰è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ä¹Ÿå¯æ‰§è¡Œæ€§èƒ½å’Œå‹åŠ›æµ‹è¯•ï¼Œä»¥æ£€æŸ¥åº”ç”¨ç¨‹åºåœ¨é¢å¯¹é«˜è´Ÿè½½æ—¶æ˜¯å¦ç¨³å®šå’Œæ€§èƒ½è‰¯å¥½ã€‚è¯¥æµ‹è¯•æµç¨‹é€šå¸¸ä¸ä¼šåœ¨æ¯ä¸ªæ›´æ–°æäº¤ä¸Šè¿è¡Œï¼Œå› ä¸ºå®Œæ•´çš„å‹åŠ›æµ‹è¯•æ˜¯é•¿æœŸè¿è¡Œçš„ã€‚å½“å‘å¸ƒä¸»è¦çš„æ–°åŠŸèƒ½æ—¶ï¼Œå°†å¯¹å¤šä¸ªæ›´æ–°è¿›è¡Œåˆ†ç»„ï¼Œå¹¶å®Œæˆå®Œæ•´çš„æ€§èƒ½æµ‹è¯•ã€‚åœ¨å•ä¸ªæ›´æ–°è¢«è½¬ç§»åˆ°ä¸‹ä¸€é˜¶æ®µçš„æƒ…å†µä¸‹ï¼Œæµæ°´çº¿å¯èƒ½å°†é‡‘ä¸é›€æµ‹è¯•åŠ å…¥ä½œä¸ºå¯é€‰ã€‚</p><h2><span id="æŒç»­éƒ¨ç½²bakeå’Œéƒ¨ç½²">æŒç»­éƒ¨ç½²ï¼šBakeå’Œéƒ¨ç½²</span></h2><p><img src="https://img.hi-linux.com/staticfile/640-20210616152412635-2021-06-16-lr0ZjG.png" alt></p><ul><li><p>å‚ä¸è€…ï¼šåŸºç¡€æ¶æ„å·¥ç¨‹å¸ˆï¼ŒSREï¼Œè¿ç»´å·¥ç¨‹å¸ˆ</p></li><li><p>æŠ€æœ¯ï¼šSpinnakerï¼ŒArgo CDï¼ŒTekton CD</p></li><li><p>è¿‡ç¨‹ï¼šåœ¨æµ‹è¯•é˜¶æ®µå®Œæˆä¹‹åï¼Œå¯ä»¥éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„æ ‡å‡†ä»£ç å‡†å¤‡å°±ç»ªã€‚åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­ä¹‹å‰ï¼Œå®ƒä»¬å°†è¢«éƒ¨ç½²åˆ°äº§å“å›¢é˜Ÿå†…éƒ¨ä½¿ç”¨çš„æµ‹è¯•ç¯å¢ƒæˆ–betaç¯å¢ƒã€‚åœ¨å°†æ„å»ºç§»è‡³è¿™äº›ç¯å¢ƒä¹‹å‰ï¼Œæ„å»ºå¿…é¡»ç»è¿‡Bakeå’ŒDeployçš„å­é˜¶æ®µã€‚è¿™ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯Spinnakeræ‰€æ”¯æŒå­˜åœ¨çš„ã€‚</p></li></ul><p><strong>CDï¼šBake</strong></p><p>Bakingæ˜¯æŒ‡åœ¨ç”Ÿäº§æ—¶ä½¿ç”¨å½“å‰é…ç½®ä»æºä»£ç åˆ›å»ºä¸å¯å˜çš„é•œåƒå®ä¾‹ã€‚è¿™äº›é…ç½®å¯èƒ½æ˜¯æ•°æ®åº“æ›´æ”¹å’Œå…¶ä»–åŸºç¡€ç»“æ„æ›´æ–°ä¹‹ç±»çš„äº‹æƒ…ã€‚Spinnakerå¯ä»¥è§¦å‘Jenkinsæ‰§è¡Œæ­¤ä»»åŠ¡ï¼Œå¹¶ä¸”æŸäº›ç»„ç»‡æ›´å–œæ¬¢ä½¿ç”¨Packerã€‚</p><p><strong>CDï¼šéƒ¨ç½²</strong></p><p>Spinnakerè‡ªåŠ¨å°†å·²bakeçš„é•œåƒå‘é€åˆ°éƒ¨ç½²é˜¶æ®µã€‚è¿™æ˜¯å°†æœåŠ¡å™¨ç»„è®¾ç½®ä¸ºéƒ¨ç½²åˆ°é›†ç¾¤çš„ä½ç½®ã€‚ä¸ä¸Šè¿°æµ‹è¯•è¿‡ç¨‹ç±»ä¼¼ï¼Œåœ¨éƒ¨ç½²é˜¶æ®µå°†æ‰§è¡ŒåŠŸèƒ½ç›¸åŒçš„è¿‡ç¨‹ã€‚é¦–å…ˆå°†éƒ¨ç½²ç§»è‡³æµ‹è¯•é˜¶æ®µï¼Œç„¶åæœ€ç»ˆç§»è‡³ç”Ÿäº§ç¯å¢ƒï¼Œä»¥è¿›è¡Œæ‰¹å‡†å’Œæ£€æŸ¥ã€‚è¿™ä¸ªå¤„ç†è¿‡ç¨‹å¯ä»¥ç”±Spinnakerç­‰å·¥å…·æ”¯æŒã€‚</p><p><strong>CDï¼šéªŒè¯</strong></p><p>è¿™ä¹Ÿæ˜¯å›¢é˜Ÿä¼˜åŒ–æ•´ä¸ªCI/CDæµç¨‹çš„å…³é”®ä½ç½®ã€‚å› ä¸ºç°åœ¨å·²ç»è¿›è¡Œäº†å¦‚æ­¤å¤šçš„æµ‹è¯•ï¼Œæ‰€ä»¥å¤±è´¥å¾ˆå°‘è§ã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶å¿…é¡»å°½å¿«è§£å†³æ‰€æœ‰æ•…éšœï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘å¯¹æœ€ç»ˆå®¢æˆ·çš„å½±å“ã€‚å›¢é˜Ÿä¹Ÿåº”è¯¥è€ƒè™‘ä½¿æµç¨‹çš„è¿™ä¸€éƒ¨åˆ†è‡ªåŠ¨åŒ–ã€‚</p><p>ä½¿ç”¨è“ç»¿éƒ¨ç½²ã€é‡‘ä¸é›€åˆ†æã€æ»šåŠ¨æ›´æ–°ç­‰ç­–ç•¥éƒ¨ç½²åˆ°äº§å“ã€‚åœ¨éƒ¨ç½²é˜¶æ®µï¼Œå°†ç›‘è§†æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä»¥éªŒè¯å½“å‰éƒ¨ç½²æ˜¯å¦æ­£ç¡®æˆ–æ˜¯å¦éœ€è¦å›æ»šã€‚</p><p><strong>CDï¼šç›‘æ§</strong></p><ul><li><p>å‚ä¸è€…ï¼šç«™ç‚¹å¯é æ€§å·¥ç¨‹å¸ˆï¼ˆSREï¼‰ã€è¿è¥å›¢é˜Ÿ</p></li><li><p>æŠ€æœ¯ï¼šZabbixã€Nagiosã€Prometheusã€Elastic Searchã€Splunkã€Appdynamicsã€Tivoli</p></li><li><p>è¿‡ç¨‹ï¼šä¸ºäº†ä½¿è½¯ä»¶å‘è¡Œç‰ˆå…·æœ‰æ•…éšœå®‰å…¨æ€§å’Œå¥å£®æ€§ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è·Ÿè¸ªå‘è¡Œç‰ˆçš„è¿è¡ŒçŠ¶å†µè‡³å…³é‡è¦ã€‚åº”ç”¨ç¨‹åºç›‘è§†å·¥å…·å°†è·Ÿè¸ªæ€§èƒ½æŒ‡æ ‡ï¼Œä¾‹å¦‚CPUåˆ©ç”¨ç‡å’Œå‘è¡Œç‰ˆå»¶è¿Ÿã€‚æ—¥å¿—åˆ†æå™¨å°†æ‰«æç”±åº•å±‚ä¸­é—´ä»¶å’Œæ“ä½œç³»ç»Ÿäº§ç”Ÿçš„å¤§é‡æ—¥å¿—ï¼Œä»¥è¯†åˆ«è¡Œä¸ºå¹¶è·Ÿè¸ªé—®é¢˜çš„æ ¹æºã€‚å¦‚æœç”Ÿäº§ä¸­å‡ºç°ä»»ä½•é—®é¢˜ï¼Œå°†é€šçŸ¥åˆ©ç›Šç›¸å…³è€…ä»¥ç¡®ä¿ç”Ÿäº§ç¯å¢ƒçš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚æ­¤å¤–ï¼Œç›‘è§†é˜¶æ®µå¯å¸®åŠ©ç»„ç»‡æ”¶é›†æœ‰å…³å…¶æ–°è½¯ä»¶æ›´æ”¹å¦‚ä½•ä¸ºæ”¶å…¥è´¡çŒ®çš„æƒ…æŠ¥ï¼Œå¸®åŠ©åŸºç¡€è®¾æ–½å›¢é˜Ÿè·Ÿè¸ªç³»ç»Ÿè¡Œä¸ºè¶‹åŠ¿å¹¶è¿›è¡Œå®¹é‡è§„åˆ’ã€‚</p></li></ul><h2><span id="æŒç»­äº¤ä»˜cdåé¦ˆå’Œåä½œå·¥å…·">æŒç»­äº¤ä»˜ï¼ˆCDï¼‰ï¼šåé¦ˆå’Œåä½œå·¥å…·</span></h2><p><img src="https://img.hi-linux.com/staticfile/640-20210616154942237-2021-06-16-o4hfIX.png" alt></p><ul><li><p>å‚ä¸è€…ï¼šç«™ç‚¹å¯é æ€§å·¥ç¨‹å¸ˆï¼ˆSREï¼‰ã€è¿è¥å’Œç»´æŠ¤å›¢é˜Ÿã€‚</p></li><li><p>æŠ€æœ¯ï¼šJIRAã€ServiceNowã€Slackã€ç”µå­é‚®ä»¶ã€Hipchatã€‚</p></li><li><p>è¿‡ç¨‹ï¼šDevOpså›¢é˜Ÿçš„ç›®æ ‡æ˜¯æ›´å¿«åœ°æŒç»­å‘å¸ƒï¼Œç„¶åä¸æ–­å‡å°‘é”™è¯¯å’Œæ€§èƒ½é—®é¢˜ã€‚è¿™æ˜¯é€šè¿‡ä¸æ—¶åœ°é€šè¿‡å‘é€ç”µå­é‚®ä»¶å‘å¼€å‘äººå‘˜ã€é¡¹ç›®ç»ç†æä¾›æœ‰å…³æ–°ç‰ˆæœ¬çš„è´¨é‡å’Œæ€§èƒ½çš„åé¦ˆã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåé¦ˆç³»ç»Ÿæ˜¯æ•´ä¸ªè½¯ä»¶äº¤ä»˜è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œäº¤ä»˜ä¸­çš„ä»»ä½•æ›´æ”¹éƒ½ä¼šé¢‘ç¹åœ°å½•å…¥ç³»ç»Ÿï¼Œä»¥ä¾¿äº¤ä»˜å›¢é˜Ÿå¯ä»¥å¯¹å®ƒé‡‡å–è¡ŒåŠ¨ã€‚</p></li></ul><h2><span id="æ€»ç»“">æ€»ç»“</span></h2><p>ä¼ä¸šå¿…é¡»è¯„ä¼°ä¸€ä¸ªæ•´ä½“çš„æŒç»­äº¤ä»˜è§£å†³æ–¹æ¡ˆï¼Œè¯¥è§£å†³æ–¹æ¡ˆå¯ä»¥è‡ªåŠ¨åŒ–æˆ–ä¿ƒè¿›ä¸Šè¿°è¿™äº›é˜¶æ®µçš„è‡ªåŠ¨åŒ–ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.opsmx.com/blog/what-is-a-ci-cd-pipeline/" target="_blank" rel="noopener">https://www.opsmx.com/blog/what-is-a-ci-cd-pipeline/</a></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ åˆ†å¸ƒå¼å®éªŒå®¤ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/5dtbbk3x" target="_blank" rel="noopener">https://tinyurl.com/5dtbbk3x</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åœ¨CI/CDå’ŒDevOpsé¢†åŸŸä¸­ï¼ŒæŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ã€‚æŒç»­é›†æˆè¿™ä¸ªæœ¯è¯­æœ€æ—©æ˜¯åœ¨1994å¹´ç”±Grady Boochæå‡ºã€‚å¾®æœåŠ¡æå‡ºè€…Martin Floweråœ¨2014å¹´å‘è¡¨çš„è®ºæ–‡ã€ŠMicroserviceã€‹ä¸­ä¹Ÿå¯¹è½¯ä»¶å¼€å‘æŒç»­é›†æˆæä¾›äº†å¯å‚è€ƒåŸåˆ™ã€‚æŒç»­é›†æˆæ˜¯å€ŸåŠ©å·¥å…·å¯¹è½¯ä»¶é¡¹ç›®è¿›è¡ŒæŒç»­çš„è‡ªåŠ¨åŒ–çš„ç¼–è¯‘æ‰“åŒ…æ„å»ºæµ‹è¯•å‘å¸ƒï¼Œæ¥æ£€æŸ¥è½¯ä»¶äº¤ä»˜è´¨é‡çš„ä¸€ç§è¡Œä¸ºã€‚è€ŒæŒç»­éƒ¨ç½²æ˜¯åŸºäºæŒç»­äº¤ä»˜çš„ä¼˜åŠ¿è‡ªåŠ¨å°†ç»è¿‡æµ‹è¯•çš„ä»£ç æ¨å…¥ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹ã€‚ä¸‹æ–‡ä»ç»†èŠ‚æè¿°äº†æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²å„é˜¶æ®µçš„å…³é”®æ­¥éª¤ï¼Œä»¥ä¸‹æ˜¯åŸæ–‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬æ–‡å°†æ¢è®¨CIï¼ˆæŒç»­é›†æˆï¼‰/CDï¼ˆæŒç»­éƒ¨ç½²ï¼‰æµç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µï¼›ä»¥åŠä»å¿«é€Ÿã€è§„æ¨¡äº¤ä»˜çš„è§†è§’æ¢è®¨ä¸ºä»€ä¹ˆCI/CDæµæ°´çº¿å¯¹äºæˆ‘ä»¬çš„ç»„ç»‡æ˜¯å¿…ä¸å¯å°‘çš„ã€‚&lt;/p&gt;
&lt;p&gt;CI/CDæµæ°´çº¿å·¥ä½œæµåŒ…æ‹¬CI/CDæµç¨‹å¼€å§‹æ—¶æ‰€æœ‰é˜¶æ®µç­‰ä¸€ç³»åˆ—æ­¥éª¤ï¼Œè´Ÿè´£åˆ›å»ºè‡ªåŠ¨ã€è¿è´¯çš„è½¯ä»¶äº¤ä»˜æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡CI/CDæµæ°´çº¿ï¼Œè½¯ä»¶ç ”å‘å¯ä»¥å®ç°ä»ä»£ç ç­¾å…¥ã€æµ‹è¯•ã€æ„å»ºå’Œéƒ¨ç½²ç›´è‡³ç”Ÿäº§é˜¶æ®µéƒ½åœ¨æµæ°´çº¿ä¸­å‘å‰æ¨è¿›ã€‚æ­¤æ¦‚å¿µä¹‹æ‰€ä»¥é«˜å¤§ä¸Šï¼Œæ˜¯å› ä¸ºä¸€æ—¦å®æ–½äº†æµæ°´çº¿ï¼Œå°±å¯ä»¥å°†å…¶éƒ¨åˆ†æˆ–å…¨éƒ¨è‡ªåŠ¨åŒ–ï¼Œä»è€ŒåŠ å¿«å¼€å‘æµç¨‹å¹¶å‡å°‘é”™è¯¯ã€‚æ¢å¥è¯è¯´ï¼ŒCI/CDæµæ°´çº¿ä½¿ä¼ä¸šå¯ä»¥æ›´è½»æ¾åœ°åº”å¯¹è½¯ä»¶çš„è‡ªåŠ¨ã€å¿«é€Ÿã€æŒç»­äº¤ä»˜ã€‚&lt;/p&gt;
&lt;p&gt;DevOpså·¥ç¨‹å¸ˆç»å¸¸ä¼šå°†CI/CDå„é˜¶æ®µçš„å’Œå…¶CI/CDæµæ°´çº¿æ··æ·†ã€‚å°½ç®¡ä¸åŒçš„å·¥å…·å¯ä»¥å°†æ¯ä¸ªå¤æ‚é˜¶æ®µè‡ªåŠ¨åŒ–å®Œæˆåˆ†é˜¶æ®µçš„CI/CDï¼Œä½†æ˜¯æ•´ä½“CI/CDè½¯ä»¶é“¾ä»ç„¶å¯èƒ½ç”±äºä¸å¯é¿å…çš„äººå·¥å¹²é¢„è€Œä¸­æ–­ã€‚å› æ­¤æˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£CI/CDæµç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µï¼Œä»¥åŠä»å¿«é€Ÿã€è§„æ¨¡äº¤ä»˜çš„è§†è§’æ¢è®¨ä¸ºä»€ä¹ˆCI/CDæµæ°´çº¿å¯¹äºæˆ‘ä»¬çš„ç»„ç»‡æ˜¯å¿…ä¸å¯å°‘çš„ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="DevOps" scheme="https://www.hi-linux.com/categories/DevOps/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="DevOps" scheme="https://www.hi-linux.com/tags/DevOps/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•æœ‰æ•ˆçš„åœ¨ 60 ç§’å†…è¿›è¡Œ Linux æœåŠ¡å™¨æ€§èƒ½æ•…éšœåˆ†æ</title>
    <link href="https://www.hi-linux.com/posts/21098.html"/>
    <id>https://www.hi-linux.com/posts/21098.html</id>
    <published>2021-08-18T01:00:00.000Z</published>
    <updated>2021-08-18T02:23:32.294Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p>æ„Ÿè°¢å‰è¾ˆï¼Œå…‰è£å±äºå‰è¾ˆã€‚</p></blockquote><p>æŒæ¡ä¸€äº›æ€§èƒ½ä¼˜åŒ–å·¥å…·å’Œæ–¹æ³•ï¼Œè¿™å°±éœ€è¦åœ¨å·¥ä½œä¸­ä¸æ–­åœ°ç§¯ç´¯ï¼›è®¡ç®—æœºåŸºç¡€çŸ¥è¯†å¾ˆé‡è¦ï¼Œæ¯”å¦‚è¯´ç½‘ç»œçŸ¥è¯†ã€æ“ä½œç³»ç»ŸçŸ¥è¯†ç­‰ç­‰ï¼ŒæŒæ¡äº†åŸºç¡€çŸ¥è¯†æ‰èƒ½è®©ä½ åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­æŠ“ä½æ€§èƒ½é—®é¢˜çš„å…³é”®ï¼Œä¹Ÿèƒ½åœ¨æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹ä¸­æ¸¸åˆƒæœ‰ä½™ã€‚</p><p>è™½ç„¶ç›‘æ§å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³å¤§å¤šæ•°é—®é¢˜ï¼Œä½†æˆ‘ä»¬æœ‰æ—¶éœ€è¦ç™»å½•å®ä¾‹å¹¶è¿è¡Œä¸€äº›æ ‡å‡†çš„ Linux æ€§èƒ½å·¥å…·ã€‚</p><blockquote><p>æ¥çœ‹ Netflix æ€§èƒ½å·¥ç¨‹å›¢é˜Ÿçš„è¿™ç¯‡åšæ–‡ï¼š<a href="https://netflixtechblog.com/linux-performance-analysis-in-60-000-milliseconds-accc10403c55" target="_blank" rel="noopener">https://netflixtechblog.com/linux-performance-analysis-in-60-000-milliseconds-accc10403c55</a></p></blockquote><p>çœ‹ä»–ä»¬é€šè¿‡åæ¡å‘½ä»¤åœ¨ä¸€åˆ†é’Ÿå†…å¯¹æœºå™¨æ€§èƒ½é—®é¢˜è¿›è¡Œè¯Šæ–­ã€‚åœ¨ 60 ç§’å†…ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹åä¸ªå‘½ä»¤ï¼Œå¯¹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µå’Œæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æœ‰ä¸€ä¸ªé«˜å±‚æ¬¡çš„äº†è§£ã€‚å¯»æ‰¾é”™è¯¯å’Œé¥±å’Œåº¦æŒ‡æ ‡ï¼Œå› ä¸ºå®ƒä»¬éƒ½å¾ˆå®¹æ˜“è§£é‡Šï¼Œç„¶åæ˜¯èµ„æºåˆ©ç”¨ç‡ã€‚é¥±å’Œæ˜¯æŒ‡èµ„æºçš„è´Ÿè½½è¶…å‡ºå…¶å¤„ç†èƒ½åŠ›çš„æƒ…å†µï¼Œå¯ä»¥ä½œä¸ºè¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦æˆ–ç­‰å¾…æ—¶é—´æ¥å…¬å¼€ã€‚</p><a id="more"></a><p>å½“æˆ‘ä»¬æŠŠ Linux æ“ä½œç³»ç»Ÿæ‰€æœ‰çš„å…³é”®ä¸€çº§è®¡æ•°å™¨æ‰¾å®Œä¹‹åï¼Œå°±ä¼šå¾—åˆ°è¿™æ ·ä¸€å¼ å›¾ï¼š</p><p><img src="https://img.hi-linux.com/staticfile/640-20210722112925483-2021-07-22-hI8hui.jpg" alt></p><p>è¿™äº›å‘½ä»¤çš„è¾“å‡ºï¼Œæœ‰åŠ©äºå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆã€‚ä¸»è¦æ£€æŸ¥å‡ºå›¾ä¸­æ ‡çº¢çš„è®¡æ•°å™¨ï¼Œæ‰€æœ‰èµ„æºï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ IO ç­‰ï¼‰çš„åˆ©ç”¨ç‡ï¼ˆutilizationï¼‰ã€é¥±å’Œåº¦ï¼ˆsaturationï¼‰å’Œé”™è¯¯ï¼ˆerrorï¼‰åº¦é‡ï¼Œä¹Ÿå°±æ˜¯ Brendan Gregg æå‡ºçš„ USE æ–¹æ³•ã€‚</p><blockquote><p>The USE Method: <a href="https://www.brendangregg.com/usemethod.html" target="_blank" rel="noopener">https://www.brendangregg.com/usemethod.html</a></p></blockquote><p><img src="https://img.hi-linux.com/staticfile/640-20210722112925497-2021-07-22-I7bgnm.jpg" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">uptime</span><br><span class="line">dmesg | tail</span><br><span class="line">vmstat 1</span><br><span class="line">mpstat -P ALL 1</span><br><span class="line">pidstat 1</span><br><span class="line">iostat -xz 1</span><br><span class="line">free -m</span><br><span class="line">sar -n DEV 1</span><br><span class="line">sar -n TCP,ETCP 1</span><br><span class="line">top</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬æ¥é€ä¸€ä»‹ç»ä¸‹è¿™äº›å‘½ä»¤ï¼Œæœ‰å…³è¿™äº›å‘½ä»¤æ›´å¤šçš„å‚æ•°å’Œè¯´æ˜ï¼Œè¯·å‚ç…§å‘½ä»¤çš„æ‰‹å†Œã€‚</p><h2><span id="uptime">uptime</span></h2><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥å¿«é€ŸæŸ¥çœ‹æœºå™¨çš„è´Ÿè½½æƒ…å†µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uptime</span><br><span class="line">23:51:26 up 21:31,  1 user,  load average: 30.02, 26.43, 19.02</span><br></pre></td></tr></table></figure><ul><li><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¹³å‡è´Ÿè½½æ˜¯æŒ‡å•ä½æ—¶é—´å†…ï¼Œç³»ç»Ÿå¤„äºå¯è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€çš„å¹³å‡è¿›ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯å¹³å‡æ´»è·ƒè¿›ç¨‹æ•°ã€‚å¯è¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹ï¼Œæ˜¯æŒ‡æ­£åœ¨ä½¿ç”¨ CPU æˆ–è€…æ­£åœ¨ç­‰å¾… CPU çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨ ps å‘½ä»¤çœ‹åˆ°çš„ï¼Œå¤„äº R çŠ¶æ€ï¼ˆRunning æˆ– Runnableï¼‰çš„è¿›ç¨‹ã€‚ä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹åˆ™æ˜¯æ­£å¤„äºå†…æ ¸æ€å…³é”®æµç¨‹ä¸­çš„è¿›ç¨‹ï¼Œå¹¶ä¸”è¿™äº›æµç¨‹æ˜¯ä¸å¯æ‰“æ–­çš„ã€‚è¿™äº›æ•°æ®å¯ä»¥è®©æˆ‘ä»¬å¯¹ç³»ç»Ÿèµ„æºä½¿ç”¨æœ‰ä¸€ä¸ªå®è§‚çš„äº†è§£ã€‚</p></li><li><p>å‘½ä»¤çš„è¾“å‡ºåˆ†åˆ«è¡¨ç¤º 1 åˆ†é’Ÿã€5 åˆ†é’Ÿã€15 åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½æƒ…å†µã€‚é€šè¿‡è¿™ä¸‰ä¸ªæ•°æ®ï¼Œå¯ä»¥äº†è§£æœåŠ¡å™¨è´Ÿè½½æ˜¯åœ¨è¶‹äºç´§å¼ è¿˜æ˜¯åŒºåŸŸç¼“è§£ã€‚å¦‚æœ 1 åˆ†é’Ÿå¹³å‡è´Ÿè½½å¾ˆé«˜ï¼Œè€Œ 15 åˆ†é’Ÿå¹³å‡è´Ÿè½½å¾ˆä½ï¼Œè¯´æ˜æœåŠ¡å™¨æ­£åœ¨å‘½ä»¤é«˜è´Ÿè½½æƒ…å†µï¼Œéœ€è¦è¿›ä¸€æ­¥æ’æŸ¥ CPU èµ„æºéƒ½æ¶ˆè€—åœ¨äº†å“ªé‡Œã€‚åä¹‹ï¼Œå¦‚æœ 15 åˆ†é’Ÿå¹³å‡è´Ÿè½½å¾ˆé«˜ï¼Œ1 åˆ†é’Ÿå¹³å‡è´Ÿè½½è¾ƒä½ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯ CPU èµ„æºç´§å¼ æ—¶åˆ»å·²ç»è¿‡å»ã€‚</p></li><li><p>ä¸Šé¢ä¾‹å­ä¸­çš„è¾“å‡ºï¼Œå¯ä»¥çœ‹è§æœ€è¿‘ 1 åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½éå¸¸é«˜ï¼Œä¸”è¿œé«˜äºæœ€è¿‘ 15 åˆ†é’Ÿè´Ÿè½½ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»§ç»­æ’æŸ¥å½“å‰ç³»ç»Ÿä¸­æœ‰ä»€ä¹ˆè¿›ç¨‹æ¶ˆè€—äº†å¤§é‡çš„èµ„æºã€‚å¯ä»¥é€šè¿‡ä¸‹æ–‡å°†ä¼šä»‹ç»çš„ vmstatã€mpstat ç­‰å‘½ä»¤è¿›ä¸€æ­¥æ’æŸ¥ã€‚</p></li></ul><h2><span id="dmesg-tail">dmesg | tail</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg | tail</span><br><span class="line">[1880957.563150] perl invoked oom-killer: gfp_mask&#x3D;0x280da, order&#x3D;0, oom_score_adj&#x3D;0</span><br><span class="line">[...]</span><br><span class="line">[1880957.563400] Out of memory: Kill process 18694 (perl) score 246 or sacrifice child</span><br><span class="line">[1880957.563408] Killed process 18694 (perl) total-vm:1972392kB, anon-rss:1953348kB, file-rss:0kB</span><br><span class="line">[2320864.954447] TCP: Possible SYN flooding on port 7001. Dropping request.  Check SNMP counters.</span><br></pre></td></tr></table></figure><p>è¿™å°†æŸ¥çœ‹æœ€è¿‘ 10 æ¡ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚æŸ¥æ‰¾å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜çš„é”™è¯¯ã€‚ä¸Šé¢çš„ç¤ºä¾‹åŒ…æ‹¬ oom-killer å’Œ TCP ä¸¢å¼ƒè¯·æ±‚ã€‚ä¸è¦é”™è¿‡è¿™ä¸€æ­¥ï¼dmesg æ€»æ˜¯å€¼å¾—æ£€æŸ¥ã€‚è¿™äº›æ—¥å¿—å¯ä»¥å¸®åŠ©æ’æŸ¥æ€§èƒ½é—®é¢˜ã€‚</p><h2><span id="vmstat">vmstat</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ vmstat 1</span><br><span class="line">procs ---------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line">r  b swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line">34  0    0 200889792  73708 591828    0    0     0     5    6   10 96  1  3  0  0</span><br><span class="line">32  0    0 200889920  73708 591860    0    0     0   592 13284 4282 98  1  1  0  0</span><br><span class="line">32  0    0 200890112  73708 591860    0    0     0     0 9501 2154 99  1  0  0  0</span><br><span class="line">32  0    0 200889568  73712 591856    0    0     0    48 11900 2459 99  0  0  0  0</span><br><span class="line">32  0    0 200890208  73712 591860    0    0     0     0 15898 4840 98  1  1  0  0</span><br><span class="line">^C</span><br></pre></td></tr></table></figure><p>æ¯è¡Œä¼šè¾“å‡ºä¸€äº›ç³»ç»Ÿæ ¸å¿ƒæŒ‡æ ‡ï¼Œè¿™äº›æŒ‡æ ‡å¯ä»¥è®©æˆ‘ä»¬æ›´è¯¦ç»†çš„äº†è§£ç³»ç»ŸçŠ¶æ€ã€‚åé¢è·Ÿçš„å‚æ•° 1ï¼Œè¡¨ç¤ºæ¯ç§’è¾“å‡ºä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯ï¼Œè¡¨å¤´æç¤ºäº†æ¯ä¸€åˆ—çš„å«ä¹‰ï¼Œè¿™é‡Œä»‹ç»ä¸€äº›å’Œæ€§èƒ½è°ƒä¼˜ç›¸å…³çš„åˆ—ï¼š</p><ul><li>rï¼šç­‰å¾…åœ¨ CPU èµ„æºçš„è¿›ç¨‹æ•°é‡ã€‚è¿™ä¸ªæ•°æ®æ¯”å¹³å‡è´Ÿè½½æ›´åŠ èƒ½å¤Ÿä½“ç° CPU è´Ÿè½½æƒ…å†µï¼Œæ•°æ®ä¸­ä¸åŒ…å«ç­‰å¾… IO çš„è¿›ç¨‹ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼å¤§äºæœºå™¨ CPU æ ¸æ•°ï¼Œé‚£ä¹ˆæœºå™¨çš„ CPU èµ„æºå·²ç»é¥±å’Œã€‚</li><li>freeï¼šç³»ç»Ÿå¯ç”¨å†…å­˜æ•°ï¼ˆä»¥åƒå­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œå¦‚æœå‰©ä½™å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿæ€§èƒ½é—®é¢˜ã€‚ä¸‹æ–‡ä»‹ç»åˆ°çš„ free å‘½ä»¤ï¼Œå¯ä»¥æ›´è¯¦ç»†çš„äº†è§£ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚</li><li>si, soï¼šäº¤æ¢åŒºå†™å…¥å’Œè¯»å–çš„æ•°é‡ã€‚å¦‚æœè¿™ä¸ªæ•°æ®ä¸ä¸º 0ï¼Œè¯´æ˜ç³»ç»Ÿå·²ç»åœ¨ä½¿ç”¨äº¤æ¢åŒºï¼ˆswapï¼‰ï¼Œæœºå™¨ç‰©ç†å†…å­˜å·²ç»ä¸è¶³ã€‚</li><li>us, sy, id, wa, stï¼šè¿™äº›éƒ½ä»£è¡¨äº† CPU æ—¶é—´çš„æ¶ˆè€—ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºç”¨æˆ·æ—¶é—´ï¼ˆuserï¼‰ã€ç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰æ—¶é—´ï¼ˆsysï¼‰ã€ç©ºé—²æ—¶é—´ï¼ˆidleï¼‰ã€IO ç­‰å¾…æ—¶é—´ï¼ˆwaitï¼‰å’Œè¢«å·èµ°çš„æ—¶é—´ï¼ˆstolenï¼Œä¸€èˆ¬è¢«å…¶ä»–è™šæ‹Ÿæœºæ¶ˆè€—ï¼‰ã€‚</li></ul><p>ä¸Šè¿°è¿™äº› CPU æ—¶é—´ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¾ˆå¿«äº†è§£ CPU æ˜¯å¦å¤„äºç¹å¿™çŠ¶æ€ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœç”¨æˆ·æ—¶é—´å’Œç³»ç»Ÿæ—¶é—´ç›¸åŠ éå¸¸å¤§ï¼ŒCPU å¤„äºå¿™äºæ‰§è¡ŒæŒ‡ä»¤ã€‚å¦‚æœ IO ç­‰å¾…æ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„ç“¶é¢ˆå¯èƒ½åœ¨ç£ç›˜ IOã€‚ç¤ºä¾‹å‘½ä»¤çš„è¾“å‡ºå¯ä»¥çœ‹è§ï¼Œå¤§é‡ CPU æ—¶é—´æ¶ˆè€—åœ¨ç”¨æˆ·æ€ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·åº”ç”¨ç¨‹åºæ¶ˆè€—äº† CPU æ—¶é—´ã€‚è¿™ä¸ä¸€å®šæ˜¯æ€§èƒ½é—®é¢˜ï¼Œéœ€è¦ç»“åˆ r é˜Ÿåˆ—ï¼Œä¸€èµ·åˆ†æã€‚</p><h2><span id="mpstat-p-all-1">mpstat -P ALL 1</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ mpstat -P ALL 1</span><br><span class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07&#x2F;14&#x2F;2015  _x86_64_ (32 CPU)</span><br><span class="line">07:38:49 PM  CPU   %usr  %nice   %sys %iowait   %irq  %soft  %steal  %guest  %gnice  %idle</span><br><span class="line">07:38:50 PM  all  98.47   0.00   0.75    0.00   0.00   0.00    0.00    0.00    0.00   0.78</span><br><span class="line">07:38:50 PM    0  96.04   0.00   2.97    0.00   0.00   0.00    0.00    0.00    0.00   0.99</span><br><span class="line">07:38:50 PM    1  97.00   0.00   1.00    0.00   0.00   0.00    0.00    0.00    0.00   2.00</span><br><span class="line">07:38:50 PM    2  98.00   0.00   1.00    0.00   0.00   0.00    0.00    0.00    0.00   1.00</span><br><span class="line">07:38:50 PM    3  96.97   0.00   0.00    0.00   0.00   0.00    0.00    0.00    0.00   3.03</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ¯ä¸ª CPU çš„å ç”¨æƒ…å†µï¼Œå¦‚æœæœ‰ä¸€ä¸ª CPU å ç”¨ç‡ç‰¹åˆ«é«˜ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå•çº¿ç¨‹åº”ç”¨ç¨‹åºå¼•èµ·çš„ã€‚</p><h2><span id="pidstat-1">pidstat 1</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat 1</span><br><span class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07&#x2F;14&#x2F;2015    _x86_64_    (32 CPU)</span><br><span class="line"></span><br><span class="line">07:41:02 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">07:41:03 PM     0         9    0.00    0.94    0.00    0.94     1  rcuos&#x2F;0</span><br><span class="line">07:41:03 PM     0      4214    5.66    5.66    0.00   11.32    15  mesos-slave</span><br><span class="line">07:41:03 PM     0      4354    0.94    0.94    0.00    1.89     8  java</span><br><span class="line">07:41:03 PM     0      6521 1596.23    1.89    0.00 1598.11    27  java</span><br><span class="line">07:41:03 PM     0      6564 1571.70    7.55    0.00 1579.25    28  java</span><br><span class="line">07:41:03 PM 60004     60154    0.94    4.72    0.00    5.66     9  pidstat</span><br><span class="line"></span><br><span class="line">07:41:03 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">07:41:04 PM     0      4214    6.00    2.00    0.00    8.00    15  mesos-slave</span><br><span class="line">07:41:04 PM     0      6521 1590.00    1.00    0.00 1591.00    27  java</span><br><span class="line">07:41:04 PM     0      6564 1573.00   10.00    0.00 1583.00    28  java</span><br><span class="line">07:41:04 PM   108      6718    1.00    0.00    0.00    1.00     0  snmp-pass</span><br><span class="line">07:41:04 PM 60004     60154    1.00    4.00    0.00    5.00     9  pidstat</span><br><span class="line">^C</span><br></pre></td></tr></table></figure><p>pidstat å‘½ä»¤è¾“å‡ºè¿›ç¨‹çš„ CPU å ç”¨ç‡ï¼Œè¯¥å‘½ä»¤ä¼šæŒç»­è¾“å‡ºï¼Œå¹¶ä¸”ä¸ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ï¼Œå¯ä»¥æ–¹ä¾¿è§‚å¯Ÿç³»ç»ŸåŠ¨æ€ã€‚å¦‚ä¸Šçš„è¾“å‡ºï¼Œå¯ä»¥çœ‹è§ä¸¤ä¸ª JAVA è¿›ç¨‹å ç”¨äº†å°†è¿‘ 1600% çš„ CPU æ—¶é—´ï¼Œæ—¢æ¶ˆè€—äº†å¤§çº¦ 16 ä¸ª CPU æ ¸å¿ƒçš„è¿ç®—èµ„æºã€‚</p><h2><span id="iostat-xz-1">iostat -xz 1</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ iostat -xz 1</span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.13    0.00    0.10    0.01    0.00   99.76</span><br><span class="line"></span><br><span class="line">Device:         rrqm&#x2F;s   wrqm&#x2F;s     r&#x2F;s     w&#x2F;s    rkB&#x2F;s    wkB&#x2F;s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">vda               0.00     0.62    0.03    0.89     0.57     7.97    18.52     0.00    0.68    1.96    0.64   0.60   0.06</span><br><span class="line">vdb               0.00     0.02    0.00    0.38     0.05     2.64    14.12     0.00    0.84    0.46    0.84   0.54   0.02</span><br><span class="line">dm-0              0.00     0.00    0.00    0.40     0.01     2.75    13.62     0.00    0.98    0.37    0.98   0.35   0.01</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.25    0.00    0.00    0.00    0.00   99.75</span><br><span class="line"></span><br><span class="line">Device:         rrqm&#x2F;s   wrqm&#x2F;s     r&#x2F;s     w&#x2F;s    rkB&#x2F;s    wkB&#x2F;s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">vda               0.00     0.00    0.00    1.00     0.00     4.00     8.00     0.00    0.00    0.00    0.00   1.00   0.10</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.00    0.00    0.00    0.00    0.00  100.00</span><br></pre></td></tr></table></figure><p>iostat å‘½ä»¤ä¸»è¦ç”¨äºæŸ¥çœ‹æœºå™¨ç£ç›˜ IO æƒ…å†µã€‚è¯¥å‘½ä»¤è¾“å‡ºçš„åˆ—ï¼Œä¸»è¦å«ä¹‰æ˜¯ï¼š</p><ul><li>r/s, w/s, rkB/s, wkB/sï¼šåˆ†åˆ«è¡¨ç¤ºæ¯ç§’è¯»å†™æ¬¡æ•°å’Œæ¯ç§’è¯»å†™æ•°æ®é‡ï¼ˆåƒå­—èŠ‚ï¼‰ã€‚è¯»å†™é‡è¿‡å¤§ï¼Œå¯èƒ½ä¼šå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚</li><li>awaitï¼šIO æ“ä½œçš„å¹³å‡ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚è¿™æ˜¯åº”ç”¨ç¨‹åºåœ¨å’Œç£ç›˜äº¤äº’æ—¶ï¼Œéœ€è¦æ¶ˆè€—çš„æ—¶é—´ï¼ŒåŒ…æ‹¬ IO ç­‰å¾…å’Œå®é™…æ“ä½œçš„è€—æ—¶ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼è¿‡å¤§ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶è®¾å¤‡é‡åˆ°äº†ç“¶é¢ˆæˆ–è€…å‡ºç°æ•…éšœã€‚</li><li>avgqu-szï¼šå‘è®¾å¤‡å‘å‡ºçš„è¯·æ±‚å¹³å‡æ•°é‡ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼å¤§äº 1ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶è®¾å¤‡å·²ç»é¥±å’Œï¼ˆéƒ¨åˆ†å‰ç«¯ç¡¬ä»¶è®¾å¤‡æ”¯æŒå¹¶è¡Œå†™å…¥ï¼‰ã€‚</li><li>%utilï¼šè®¾å¤‡åˆ©ç”¨ç‡ã€‚è¿™ä¸ªæ•°å€¼è¡¨ç¤ºè®¾å¤‡çš„ç¹å¿™ç¨‹åº¦ï¼Œç»éªŒå€¼æ˜¯å¦‚æœè¶…è¿‡ 60ï¼Œå¯èƒ½ä¼šå½±å“ IO æ€§èƒ½ï¼ˆå¯ä»¥å‚ç…§ IO æ“ä½œå¹³å‡ç­‰å¾…æ—¶é—´ï¼‰ã€‚å¦‚æœåˆ°è¾¾ 100%ï¼Œè¯´æ˜ç¡¬ä»¶è®¾å¤‡å·²ç»é¥±å’Œã€‚</li></ul><p>å¦‚æœæ˜¾ç¤ºçš„æ˜¯é€»è¾‘è®¾å¤‡çš„æ•°æ®ï¼Œé‚£ä¹ˆè®¾å¤‡åˆ©ç”¨ç‡ä¸ä»£è¡¨åç«¯å®é™…çš„ç¡¬ä»¶è®¾å¤‡å·²ç»é¥±å’Œã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿ IO æ€§èƒ½ä¸ç†æƒ³ï¼Œä¹Ÿä¸ä¸€å®šæ„å‘³åº”ç”¨ç¨‹åºä¼šå‡ºç°æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥åˆ©ç”¨è¯¸å¦‚é¢„è¯»å–ã€å†™ç¼“å­˜ç­‰ç­–ç•¥æå‡åº”ç”¨æ€§èƒ½ã€‚</p><h2><span id="free-m">free â€“m</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ free -m</span><br><span class="line">            total       used       free     shared    buffers     cached</span><br><span class="line">Mem:        245998      24545     221453         83         59        541</span><br><span class="line">-&#x2F;+ buffers&#x2F;cache:      23944     222053</span><br><span class="line">Swap:            0          0          0</span><br></pre></td></tr></table></figure><p>free å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œ-m å‚æ•°è¡¨ç¤ºæŒ‰ç…§å…†å­—èŠ‚å±•ç¤ºã€‚æœ€åä¸¤åˆ—åˆ†åˆ«è¡¨ç¤ºç”¨äº IO ç¼“å­˜çš„å†…å­˜æ•°ï¼Œå’Œç”¨äºæ–‡ä»¶ç³»ç»Ÿé¡µç¼“å­˜çš„å†…å­˜æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬äºŒè¡Œ -/+ buffers/cacheï¼Œçœ‹ä¸Šå»ç¼“å­˜å ç”¨äº†å¤§é‡å†…å­˜ç©ºé—´ã€‚è¿™æ˜¯ Linux ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨ç­–ç•¥ï¼Œå°½å¯èƒ½çš„åˆ©ç”¨å†…å­˜ï¼Œå¦‚æœåº”ç”¨ç¨‹åºéœ€è¦å†…å­˜ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¼šç«‹å³è¢«å›æ”¶å¹¶åˆ†é…ç»™åº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¸€èˆ¬ä¹Ÿè¢«å½“æˆæ˜¯å¯ç”¨å†…å­˜ã€‚å¦‚æœå¯ç”¨å†…å­˜éå¸¸å°‘ï¼Œç³»ç»Ÿå¯èƒ½ä¼šåŠ¨ç”¨äº¤æ¢åŒºï¼ˆå¦‚æœé…ç½®äº†çš„è¯ï¼‰ï¼Œè¿™æ ·ä¼šå¢åŠ  IO å¼€é”€ï¼ˆå¯ä»¥åœ¨ iostat å‘½ä»¤ä¸­ä½“ç°ï¼‰ï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚</p><h2><span id="sar-n-dev-1">sar -n DEV 1</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sar -n DEV 1</span><br><span class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07&#x2F;14&#x2F;2015     _x86_64_    (32 CPU)</span><br><span class="line">12:16:48 AM     IFACE   rxpck&#x2F;s   txpck&#x2F;s    rxkB&#x2F;s    txkB&#x2F;s   rxcmp&#x2F;s   txcmp&#x2F;s  rxmcst&#x2F;s   %ifutil</span><br><span class="line">12:16:49 AM      eth0  18763.00   5032.00  20686.42    478.30      0.00      0.00      0.00      0.00</span><br><span class="line">12:16:49 AM        lo     14.00     14.00      1.36      1.36      0.00      0.00      0.00      0.00</span><br><span class="line">12:16:49 AM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">12:16:49 AM     IFACE   rxpck&#x2F;s   txpck&#x2F;s    rxkB&#x2F;s    txkB&#x2F;s   rxcmp&#x2F;s   txcmp&#x2F;s  rxmcst&#x2F;s   %ifutil</span><br><span class="line">12:16:50 AM      eth0  19763.00   5101.00  21999.10    482.56      0.00      0.00      0.00      0.00</span><br><span class="line">12:16:50 AM        lo     20.00     20.00      3.25      3.25      0.00      0.00      0.00      0.00</span><br><span class="line">12:16:50 AM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">^C</span><br></pre></td></tr></table></figure><p>sar å‘½ä»¤åœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹ç½‘ç»œè®¾å¤‡çš„ååç‡ã€‚åœ¨æ’æŸ¥æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œè®¾å¤‡çš„ååé‡ï¼Œåˆ¤æ–­ç½‘ç»œè®¾å¤‡æ˜¯å¦å·²ç»é¥±å’Œã€‚å¦‚ç¤ºä¾‹è¾“å‡ºä¸­ï¼Œeth0 ç½‘å¡è®¾å¤‡ï¼Œååç‡å¤§æ¦‚åœ¨ 22 Mbytes/sï¼Œæ—¢ 176 Mbits/secï¼Œæ²¡æœ‰è¾¾åˆ° 1Gbit/sec çš„ç¡¬ä»¶ä¸Šé™ã€‚</p><h2><span id="sar-n-tcpetcp-1">sar -n TCP,ETCP 1</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sar -n TCP,ETCP 1</span><br><span class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07&#x2F;14&#x2F;2015    _x86_64_    (32 CPU)</span><br><span class="line">12:17:19 AM  active&#x2F;s passive&#x2F;s    iseg&#x2F;s    oseg&#x2F;s</span><br><span class="line">12:17:20 AM      1.00      0.00  10233.00  18846.00</span><br><span class="line">12:17:19 AM  atmptf&#x2F;s  estres&#x2F;s retrans&#x2F;s isegerr&#x2F;s   orsts&#x2F;s</span><br><span class="line">12:17:20 AM      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">12:17:20 AM  active&#x2F;s passive&#x2F;s    iseg&#x2F;s    oseg&#x2F;s</span><br><span class="line">12:17:21 AM      1.00      0.00   8359.00   6039.00</span><br><span class="line">12:17:20 AM  atmptf&#x2F;s  estres&#x2F;s retrans&#x2F;s isegerr&#x2F;s   orsts&#x2F;s</span><br><span class="line">12:17:21 AM      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">^C</span><br></pre></td></tr></table></figure><p>sar å‘½ä»¤åœ¨è¿™é‡Œç”¨äºæŸ¥çœ‹ TCP è¿æ¥çŠ¶æ€ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p><ul><li>active/sï¼šæ¯ç§’æœ¬åœ°å‘èµ·çš„ TCP è¿æ¥æ•°ï¼Œæ—¢é€šè¿‡ connect è°ƒç”¨åˆ›å»ºçš„ TCP è¿æ¥ï¼›</li><li>passive/sï¼šæ¯ç§’è¿œç¨‹å‘èµ·çš„ TCP è¿æ¥æ•°ï¼Œå³é€šè¿‡ accept è°ƒç”¨åˆ›å»ºçš„ TCP è¿æ¥ï¼›</li><li>retrans/sï¼šæ¯ç§’ TCP é‡ä¼ æ•°é‡ï¼›</li></ul><p>TCP è¿æ¥æ•°å¯ä»¥ç”¨æ¥åˆ¤æ–­æ€§èƒ½é—®é¢˜æ˜¯å¦ç”±äºå»ºç«‹äº†è¿‡å¤šçš„è¿æ¥ï¼Œè¿›ä¸€æ­¥å¯ä»¥åˆ¤æ–­æ˜¯ä¸»åŠ¨å‘èµ·çš„è¿æ¥ï¼Œè¿˜æ˜¯è¢«åŠ¨æ¥å—çš„è¿æ¥ã€‚TCP é‡ä¼ å¯èƒ½æ˜¯å› ä¸ºç½‘ç»œç¯å¢ƒæ¶åŠ£ï¼Œæˆ–è€…æœåŠ¡å™¨å‹åŠ›è¿‡å¤§å¯¼è‡´ä¸¢åŒ…ã€‚é‡ä¼ ä¼šä¸¥é‡å½±å“tcpçš„æ•ˆç‡ï¼Œå¯ä»¥ä½¿ç”¨Brendan Greggå¼€å‘çš„ä¸€ä¸ªè½»é‡çº§tcpé‡ä¼ æŠ“å–å·¥å…·: tcpretransã€‚</p><h2><span id="top">top</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ top</span><br><span class="line">top - 00:15:40 up 21:56,  1 user,  load average: 31.09, 29.87, 29.92</span><br><span class="line">Tasks: 871 total,   1 running, 868 sleeping,   0 stopped,   2 zombie</span><br><span class="line">%Cpu(s): 96.8 us,  0.4 sy,  0.0 ni,  2.7 id,  0.1 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem:  25190241+total, 24921688 used, 22698073+free,    60448 buffers</span><br><span class="line">KiB Swap:        0 total,        0 used,        0 free.   554208 cached Mem</span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line">20248 root      20   0  0.227t 0.012t  18748 S  3090  5.2  29812:58 java</span><br><span class="line"> 4213 root      20   0 2722544  64640  44232 S  23.5  0.0 233:35.37 mesos-slave</span><br><span class="line">66128 titancl+  20   0   24344   2332   1172 R   1.0  0.0   0:00.07 top</span><br><span class="line"> 5235 root      20   0 38.227g 547004  49996 S   0.7  0.2   2:02.74 java</span><br><span class="line"> 4299 root      20   0 20.015g 2.682g  16836 S   0.3  1.1  33:14.42 java</span><br><span class="line">    1 root      20   0   33620   2920   1496 S   0.0  0.0   0:03.82 init</span><br><span class="line">    2 root      20   0       0      0      0 S   0.0  0.0   0:00.02 kthreadd</span><br><span class="line">    3 root      20   0       0      0      0 S   0.0  0.0   0:05.35 ksoftirqd&#x2F;0</span><br><span class="line">    5 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker&#x2F;0:0H</span><br><span class="line">    6 root      20   0       0      0      0 S   0.0  0.0   0:06.94 kworker&#x2F;u256:0</span><br><span class="line">    8 root      20   0       0      0      0 S   0.0  0.0   2:38.05 rcu_sched</span><br></pre></td></tr></table></figure><p>top å‘½ä»¤åŒ…å«äº†å‰é¢å¥½å‡ ä¸ªå‘½ä»¤çš„æ£€æŸ¥çš„å†…å®¹ã€‚æ¯”å¦‚ç³»ç»Ÿè´Ÿè½½æƒ…å†µï¼ˆuptimeï¼‰ã€ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆfreeï¼‰ã€ç³»ç»Ÿ CPU ä½¿ç”¨æƒ…å†µï¼ˆvmstatï¼‰ç­‰ã€‚å› æ­¤é€šè¿‡è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥ç›¸å¯¹å…¨é¢çš„æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½çš„æ¥æºã€‚åŒæ—¶ï¼Œtop å‘½ä»¤æ”¯æŒæ’åºï¼Œå¯ä»¥æŒ‰ç…§ä¸åŒçš„åˆ—æ’åºï¼Œæ–¹ä¾¿æŸ¥æ‰¾å‡ºè¯¸å¦‚å†…å­˜å ç”¨æœ€å¤šçš„è¿›ç¨‹ã€CPU å ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹ç­‰ã€‚ä½†æ˜¯ï¼Œtop å‘½ä»¤ç›¸å¯¹äºå‰é¢ä¸€äº›å‘½ä»¤ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªç¬é—´å€¼ï¼Œå¦‚æœä¸æŒç»­ç›¯ç€ï¼Œå¯èƒ½ä¼šé”™è¿‡ä¸€äº›çº¿ç´¢ã€‚è¿™æ—¶å¯èƒ½éœ€è¦æš‚åœ top å‘½ä»¤åˆ·æ–°ï¼Œæ¥è®°å½•å’Œæ¯”å¯¹æ•°æ®ã€‚</p><h2><span id="æ€»ç»“">æ€»ç»“</span></h2><p>æ’æŸ¥ Linux æœåŠ¡å™¨æ€§èƒ½é—®é¢˜è¿˜æœ‰å¾ˆå¤šå·¥å…·ï¼Œä¸Šé¢ä»‹ç»çš„ä¸€äº›å‘½ä»¤ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„å®šä½é—®é¢˜ã€‚ä¾‹å¦‚å‰é¢çš„ç¤ºä¾‹è¾“å‡ºï¼Œå¤šä¸ªè¯æ®è¯æ˜æœ‰ JAVA è¿›ç¨‹å ç”¨äº†å¤§é‡ CPU èµ„æºï¼Œä¹‹åçš„æ€§èƒ½è°ƒä¼˜å°±å¯ä»¥é’ˆå¯¹åº”ç”¨ç¨‹åºè¿›è¡Œã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ è¿ç»´å¼€å‘æ•…äº‹ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/rsyjhzhw" target="_blank" rel="noopener">https://tinyurl.com/rsyjhzhw</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æ„Ÿè°¢å‰è¾ˆï¼Œå…‰è£å±äºå‰è¾ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æŒæ¡ä¸€äº›æ€§èƒ½ä¼˜åŒ–å·¥å…·å’Œæ–¹æ³•ï¼Œè¿™å°±éœ€è¦åœ¨å·¥ä½œä¸­ä¸æ–­åœ°ç§¯ç´¯ï¼›è®¡ç®—æœºåŸºç¡€çŸ¥è¯†å¾ˆé‡è¦ï¼Œæ¯”å¦‚è¯´ç½‘ç»œçŸ¥è¯†ã€æ“ä½œç³»ç»ŸçŸ¥è¯†ç­‰ç­‰ï¼ŒæŒæ¡äº†åŸºç¡€çŸ¥è¯†æ‰èƒ½è®©ä½ åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­æŠ“ä½æ€§èƒ½é—®é¢˜çš„å…³é”®ï¼Œä¹Ÿèƒ½åœ¨æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹ä¸­æ¸¸åˆƒæœ‰ä½™ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ç›‘æ§å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³å¤§å¤šæ•°é—®é¢˜ï¼Œä½†æˆ‘ä»¬æœ‰æ—¶éœ€è¦ç™»å½•å®ä¾‹å¹¶è¿è¡Œä¸€äº›æ ‡å‡†çš„ Linux æ€§èƒ½å·¥å…·ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¥çœ‹ Netflix æ€§èƒ½å·¥ç¨‹å›¢é˜Ÿçš„è¿™ç¯‡åšæ–‡ï¼š&lt;a href=&quot;https://netflixtechblog.com/linux-performance-analysis-in-60-000-milliseconds-accc10403c55&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://netflixtechblog.com/linux-performance-analysis-in-60-000-milliseconds-accc10403c55&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;çœ‹ä»–ä»¬é€šè¿‡åæ¡å‘½ä»¤åœ¨ä¸€åˆ†é’Ÿå†…å¯¹æœºå™¨æ€§èƒ½é—®é¢˜è¿›è¡Œè¯Šæ–­ã€‚åœ¨ 60 ç§’å†…ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹åä¸ªå‘½ä»¤ï¼Œå¯¹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µå’Œæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æœ‰ä¸€ä¸ªé«˜å±‚æ¬¡çš„äº†è§£ã€‚å¯»æ‰¾é”™è¯¯å’Œé¥±å’Œåº¦æŒ‡æ ‡ï¼Œå› ä¸ºå®ƒä»¬éƒ½å¾ˆå®¹æ˜“è§£é‡Šï¼Œç„¶åæ˜¯èµ„æºåˆ©ç”¨ç‡ã€‚é¥±å’Œæ˜¯æŒ‡èµ„æºçš„è´Ÿè½½è¶…å‡ºå…¶å¤„ç†èƒ½åŠ›çš„æƒ…å†µï¼Œå¯ä»¥ä½œä¸ºè¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦æˆ–ç­‰å¾…æ—¶é—´æ¥å…¬å¼€ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="æ•™ç¨‹" scheme="https://www.hi-linux.com/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="æ€§èƒ½åˆ†æ" scheme="https://www.hi-linux.com/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ç»™ Docker å¼€å¯ IPv6 ç½‘ç»œæ”¯æŒ</title>
    <link href="https://www.hi-linux.com/posts/47610.html"/>
    <id>https://www.hi-linux.com/posts/47610.html</id>
    <published>2021-08-09T01:00:00.000Z</published>
    <updated>2021-08-09T01:29:41.122Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>Docker é»˜è®¤æ˜¯ä¸å¼€å¯ IPv6 æ”¯æŒçš„ï¼Œä½†æ˜¯æˆ‘ä»¬æŸäº›ä¸šåŠ¡å¾€å¾€åˆéœ€è¦ IPv6 çš„æ”¯æŒï¼Œç‰¹åˆ«æ˜¯ IPv6 æ™®åŠå¤§åŠ¿æ‰€è¶‹ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»çš„æ˜¯å¦‚ä½•å¼€å¯ Docker æ¡¥æ¥ç½‘ç»œ IPv6 æ”¯æŒï¼Œè¿™ç¯‡æ–‡ç« å…·ä½“æ“ä½œä»…ä¾›å‚è€ƒï¼Œå»ºè®®ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†ã€‚</p><p>æœ¬æ–‡æœ€é‡è¦çš„å…ˆå†³æ¡ä»¶æ˜¯ä¸»æœºå•†å·²ç»åˆ†é…ç»™ä½ ä¸€ä¸ªå…¬ç½‘ IPv6 åœ°å€æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ä¸»æœºæ§åˆ¶é¢æ¿ä¸­ä¿¡æ¯ã€è¯¢é—®ä¸»æœºä¾›åº”å•†æˆ–è€…ç›´æ¥SSHç™»å½•ä¸»æœºä½¿ç”¨å‘½ä»¤<code>ip -f inet6 addr show eth0</code>è·å–ã€‚å‘½ä»¤æ–¹å¼è·å–çš„ ipv6 åœ°å€è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">6: eth0:  mtu 9000 </span><br><span class="line">    inet6 2607:f0d0:1002:51::4&#x2F;64 scope global </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::230:48ff:fe33:bc33&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>inet6 2607:f0d0:1002:51::4/64 scope global</code>è¿™è¡ŒæŒ‡ç¤ºçš„IPv6åœ°å€æ˜¯æˆ‘ä»¬éœ€è¦çš„ç›®æ ‡åœ°å€ï¼Œæ³¨æ„æˆ‘ä»¬è¿™é‡Œé€‰å–çš„æ˜¯å…¬ç½‘IPï¼Œä¹Ÿå°±æ˜¯åé¢<code>scope global</code>æŒ‡ç¤ºçš„ï¼Œå¤§å®¶æ³¨æ„åˆ°åç»­è¿˜æœ‰ä¸€ä¸ªfe80 å¼€å¤´çš„ IPv6 åœ°å€ï¼Œè¿™ä¸ªåé¢æ²¡æœ‰ globalï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ„ä¹‰å†…ç½‘ IPv6ï¼Œæœ¬æ–‡ä¸ä½¿ç”¨ï¼Œå½“ç„¶è¯»è€…å¯ä»¥æ ¹æ®å®é™…éœ€è¦é€‰æ‹©å†…ç½‘ IPv6 ç»§ç»­å‚ç…§ä¸‹é¢ä»‹ç»çš„æ­¥éª¤å®Œæˆæ“ä½œã€‚</p><a id="more"></a><h2><span id="1-ipv6-åœ°å€æ®µåˆ’åˆ†">1ã€IPv6 åœ°å€æ®µåˆ’åˆ†</span></h2><p>Docker å¯ä»¥é…ç½®å¤šä¸ªè™šæ‹Ÿç½‘ç»œï¼Œå¯¹äº IPv4 æ¥è¯´é€šè¿‡å½¢å¦‚ <code>172.17.0.1/16</code>ã€<code>172.18.0.1/16</code>ã€<code>172.19.0.1/16</code> è¿™æ ·å†…ç½‘ç§æœ‰IPåœ°å€æ®µé…ç½®å¤šä¸ª IPv4 è™šæ‹Ÿç½‘æ®µï¼Œé‚£ä¹ˆåŒæ ·çš„é“ç† IPv6 ä¹Ÿå»ºè®®åˆ’åˆ†å¤šä¸ªæ®µï¼Œå¦‚æœæ‰‹åŠ¨åˆ’åˆ†ä¸ä¾¿ï¼Œå¯ä»¥é€šè¿‡<a href="https://subnettingpractice.com/ipv6_subnetting.html" target="_blank" rel="noopener">IPv6 Subnetting Calculator</a>è‡ªåŠ¨åˆ’åˆ†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.hi-linux.com/staticfile/img-5ymjj9clsstvpr9p16zumuy8g-2021-06-22-onzc0g.png" alt></p><p>æ¯”å¦‚åˆšæ‰çš„ IPv6 åœ°å€åˆ’åˆ†ä¸º 4 ä¸ªç½‘æ®µå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2607:f0d0:1002:51::&#x2F;66</span><br><span class="line">2607:f0d0:1002:51:4000::&#x2F;66</span><br><span class="line">2607:f0d0:1002:51:8000::&#x2F;66</span><br><span class="line">2607:f0d0:1002:51:c000::&#x2F;66</span><br></pre></td></tr></table></figure><h2><span id="2-é…ç½®é»˜è®¤-docker-ipv6">2ã€é…ç½®é»˜è®¤ Docker IPv6</span></h2><p>ç¼–è¾‘ Docker é…ç½®æ–‡ä»¶<code>/etc/docker/daemon.json</code>ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·æ‰‹åŠ¨å»ºç«‹ã€‚é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œå¦‚æœä½ å·²æœ‰çš„é…ç½®æ–‡ä»¶ç¼ºå°‘ç›¸åº”çš„é…ç½®é¡¹ï¼Œæ·»åŠ ä¸Šå³å¯ï¼Œæ²¡æœ‰å¿…è¦å®Œå…¨è¦†ç›–å†…å®¹ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"experimental"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"ipv6"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"ip6tables"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"fixed-cidr-v6"</span>: <span class="string">"2607:f0d0:1002:51::/66"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>ip6tables</code>æ˜¯æŒ‡ç”± Docker è‡ªåŠ¨é…ç½® IPv6 çš„é˜²ç«å¢™è§„åˆ™ï¼Œå¦‚æœä½ å¸Œæœ›è‡ªå·±æ‰‹åŠ¨é…ç½®ï¼Œè¯·æ”¹ä¸º false æˆ–è€…ç§»é™¤æ­¤é¡¹ï¼Œå¦åˆ™å®¹å™¨å°†æ— æ³•è¿æ¥ IPv6 ç½‘ç»œï¼›<code>fixed-cidr-v6</code> åˆ™æ˜¯æˆ‘ä»¬åˆ’åˆ†çš„å­ç½‘æ®µçš„ç¬¬ä¸€ä¸ªï¼Œè¿™é‡Œä»…ä½œç¤ºä¾‹è¯·è¯»è€…æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ã€‚</p><p>å®Œæˆé…ç½®åè¯·ä½¿ç”¨<code>systemctl restart docker</code>é‡å¯dockeræœåŠ¡ç”Ÿæ•ˆã€‚å®Œæˆæ­¤æ­¥å Docker ç®—æ˜¯å®Œæˆå¯¹äº IPv6 çš„æ”¯æŒäº†ã€‚</p><h2><span id="3-é…ç½®-docker-compose-çš„-ipv6-æ”¯æŒå¯é€‰">3ã€é…ç½® Docker Compose çš„ IPv6 æ”¯æŒï¼ˆå¯é€‰ï¼‰</span></h2><p>è¿™ä¸ªä¸»è¦æ˜¯æˆ‘ç¼–æ’å®¹å™¨æ—¶ç”¨çš„æ¯”è¾ƒå¤šï¼Œè¿™é‡Œä¹Ÿè®°å½•ä¸€ä¸‹ä½œä¸ºä¸€ä¸ªå¤‡å¿˜å§ã€‚</p><p>Docker Compose çš„é…ç½®æ–‡ä»¶å†…å®¹å…³äº IPv6 éƒ¨åˆ†é‡ç‚¹æ˜¯ç½‘ç»œèŠ‚é…ç½®ï¼Œå¦‚æœå¦å¤–é…ç½®ç½‘ç»œçš„è¯ï¼Œå¿…é¡»é€‰æ‹©ä¸é»˜è®¤<code>daemon.json</code>ä¸åŒçš„ IPv6 å­ç½‘æ®µï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">networks:</span><br><span class="line">  example:</span><br><span class="line">    enable_ipv6: true</span><br><span class="line">    driver: bridge</span><br><span class="line">    driver_opts:</span><br><span class="line">      com.docker.network.enable_ipv6: &quot;true&quot;</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">       - subnet: 172.23.0.0&#x2F;16</span><br><span class="line">       - subnet: &quot;2607:f0d0:1002:51:4000::&#x2F;66&quot;</span><br><span class="line">         gateway:2607:f0d0:1002:51:4000::1</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>example</code>ç½‘ç»œæˆ‘ä»¬é€šè¿‡é…ç½®å¼€å¯IPv6æ”¯æŒï¼Œå…¶ä¸­ç½‘ç»œæ®µé…ç½®IPv4æ˜¯<code>172.23.0.0/16</code>ï¼ŒIPv6é€‰ç”¨ä½™ä¸‹çš„ç¬¬äºŒä¸ªç½‘æ®µ<code>2607:f0d0:1002:51:4000::/66</code>æ³¨æ„è¿™é‡Œ<strong>ä¸èƒ½</strong>å’Œ<code>daemon.json</code>é…ç½®çš„ IPv6 ç½‘æ®µä¸€æ ·ã€‚è¿™é‡Œçš„ IP é…ç½®åŒæ ·æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯»è€…è¯·æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚</p><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><ul><li><a href="https://docs.docker.com/config/daemon/ipv6/" target="_blank" rel="noopener">Enable IPv6 support</a></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ ç‹æ™”çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/4y22pxx6" target="_blank" rel="noopener">https://tinyurl.com/4y22pxx6</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Docker é»˜è®¤æ˜¯ä¸å¼€å¯ IPv6 æ”¯æŒçš„ï¼Œä½†æ˜¯æˆ‘ä»¬æŸäº›ä¸šåŠ¡å¾€å¾€åˆéœ€è¦ IPv6 çš„æ”¯æŒï¼Œç‰¹åˆ«æ˜¯ IPv6 æ™®åŠå¤§åŠ¿æ‰€è¶‹ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»çš„æ˜¯å¦‚ä½•å¼€å¯ Docker æ¡¥æ¥ç½‘ç»œ IPv6 æ”¯æŒï¼Œè¿™ç¯‡æ–‡ç« å…·ä½“æ“ä½œä»…ä¾›å‚è€ƒï¼Œå»ºè®®ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æœ€é‡è¦çš„å…ˆå†³æ¡ä»¶æ˜¯ä¸»æœºå•†å·²ç»åˆ†é…ç»™ä½ ä¸€ä¸ªå…¬ç½‘ IPv6 åœ°å€æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ä¸»æœºæ§åˆ¶é¢æ¿ä¸­ä¿¡æ¯ã€è¯¢é—®ä¸»æœºä¾›åº”å•†æˆ–è€…ç›´æ¥SSHç™»å½•ä¸»æœºä½¿ç”¨å‘½ä»¤&lt;code&gt;ip -f inet6 addr show eth0&lt;/code&gt;è·å–ã€‚å‘½ä»¤æ–¹å¼è·å–çš„ ipv6 åœ°å€è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;6: eth0:  mtu 9000 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    inet6 2607:f0d0:1002:51::4&amp;#x2F;64 scope global &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       valid_lft forever preferred_lft forever&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    inet6 fe80::230:48ff:fe33:bc33&amp;#x2F;64 scope link &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       valid_lft forever preferred_lft forever&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­&lt;code&gt;inet6 2607:f0d0:1002:51::4/64 scope global&lt;/code&gt;è¿™è¡ŒæŒ‡ç¤ºçš„IPv6åœ°å€æ˜¯æˆ‘ä»¬éœ€è¦çš„ç›®æ ‡åœ°å€ï¼Œæ³¨æ„æˆ‘ä»¬è¿™é‡Œé€‰å–çš„æ˜¯å…¬ç½‘IPï¼Œä¹Ÿå°±æ˜¯åé¢&lt;code&gt;scope global&lt;/code&gt;æŒ‡ç¤ºçš„ï¼Œå¤§å®¶æ³¨æ„åˆ°åç»­è¿˜æœ‰ä¸€ä¸ªfe80 å¼€å¤´çš„ IPv6 åœ°å€ï¼Œè¿™ä¸ªåé¢æ²¡æœ‰ globalï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ„ä¹‰å†…ç½‘ IPv6ï¼Œæœ¬æ–‡ä¸ä½¿ç”¨ï¼Œå½“ç„¶è¯»è€…å¯ä»¥æ ¹æ®å®é™…éœ€è¦é€‰æ‹©å†…ç½‘ IPv6 ç»§ç»­å‚ç…§ä¸‹é¢ä»‹ç»çš„æ­¥éª¤å®Œæˆæ“ä½œã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://www.hi-linux.com/categories/docker/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes v1.22.0 æ­£å¼å‘å¸ƒï¼Œä¼—å¤š API å’ŒåŠŸèƒ½è¢«ç§»é™¤</title>
    <link href="https://www.hi-linux.com/posts/43527.html"/>
    <id>https://www.hi-linux.com/posts/43527.html</id>
    <published>2021-08-05T01:00:00.000Z</published>
    <updated>2021-08-05T04:21:06.065Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>æˆ‘ä»¬å…´å¥‹åœ°å‘å¤§å®¶å®£å¸ƒï¼ŒKubernetes åœ¨ 2021 å¹´å†…çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ã€å³ 1.22 ç‰ˆæœ¬å·²ç»æ­£å¼æ¥ä¸´ï¼</p><p>æ–°ç‰ˆæœ¬åŒ…å« 53 é¡¹å¢å¼ºåŠŸèƒ½ï¼šå…¶ä¸­13é¡¹åŠŸèƒ½å·²å‡çº§è‡³ç¨³å®šç‰ˆï¼Œ24 é¡¹åŠŸèƒ½é¡ºåˆ©æ­¥å…¥ beta é˜¶æ®µï¼Œ16 é¡¹åŠŸèƒ½åˆšåˆšå¼€å§‹ alpha é˜¶æ®µã€‚å¦æœ‰ 3 é¡¹åŠŸèƒ½è¢«å½»åº•å¼ƒç”¨ã€‚</p><p>ä»Šå¹´ 4 æœˆï¼ŒKubernetes çš„å‘å¸ƒå‘¨æœŸå·²ç»æ­£å¼ç”±æ¯å¹´4æ¬¡è°ƒæ•´ä¸ºæ¯å¹´3æ¬¡ã€‚è€Œ1.22ç‰ˆæœ¬æ­£æ˜¯è°ƒæ•´ä¹‹åçš„é¦–ä¸ªé•¿å‘¨æœŸå‘å¸ƒç‰ˆæœ¬ã€‚éšç€Kubernetesçš„é€æ¸æˆç†Ÿï¼Œæ¯ä¸ªå‘å¸ƒå‘¨æœŸä¸­åŒ…å«çš„å¢å¼ºåŠŸèƒ½æ•°é‡ä¸€ç›´åœ¨æŒç»­å¢åŠ ã€‚è¿™æ„å‘³ç€è´¡çŒ®è€…ç¤¾åŒºåŠå‘å¸ƒå·¥ç¨‹å›¢é˜Ÿéœ€è¦åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´å®Œæˆæ›´å¤šå¼€å‘å·¥ä½œï¼Œè€Œæ–°ç‰ˆæœ¬ä¸­çš„å¤§é‡å…¨æ–°åŠŸèƒ½ä¹Ÿä¼šç»™æœ€ç»ˆç”¨æˆ·ç¤¾åŒºå¸¦æ¥ä¸€å®šçš„å­¦ä¹ å‹åŠ›ã€‚</p><p>æœ‰é‰´äºæ­¤ï¼ŒKubernetes çš„å‘å¸ƒèŠ‚å¥ç”±ä¸€å¹´å››æ¬¡è°ƒæ•´ä¸ºä¸€å¹´ä¸‰æ¬¡èƒ½å¤Ÿå¸¦æ¥æ›´å¥½çš„å‡è¡¡æ•ˆæœï¼ŒåŒ…æ‹¬è´¡çŒ®ä¸ç‰ˆæœ¬ç®¡ç†ã€ç¤¾åŒºè§„åˆ’å‡çº§å¹¶ä¸ºç”¨æˆ·æä¾›æ›´èˆ’é€‚çš„æ›´æ–°ä¸Šæ‰‹ä½“éªŒã€‚</p><a id="more"></a><h2><span id="ç‰ˆæœ¬è¦ç‚¹">ç‰ˆæœ¬è¦ç‚¹</span></h2><p><strong>Server-side Apply è¿æ¥ GA é€šç”¨ç‰ˆæœ¬</strong></p><p>Server-side Apply[1]æ˜¯ä¸€ç§é¢å‘ Kubernetes API æœåŠ¡å™¨çš„å…¨æ–°å­—æ®µæ‰€æœ‰æƒåŠå¯¹è±¡åˆå¹¶ç®—æ³•ã€‚Server-side Apply é€šè¿‡å£°æ˜å¼é…ç½®å¸®åŠ©ç”¨æˆ·åŠæ§åˆ¶å™¨ç®¡ç†å…¶èµ„æºï¼ŒåŒ…æ‹¬ä»¥å£°æ˜æ–¹å¼åˆ›å»ºåŠ/æˆ–ä¿®æ”¹å¯¹è±¡ã€å‘é€æ˜ç¡®æŒ‡å®šçš„æ„å›¾ç­‰ç­‰ã€‚ç»è¿‡æ•°ä¸ªç‰ˆæœ¬çš„æµ‹è¯•ä¹‹åï¼ŒServer-side Apply ç°å·²æ­£å¼è¿›å…¥ GA é€šç”¨ç‰ˆé˜¶æ®µã€‚</p><p><strong>å¤–éƒ¨å‡­è¯æä¾›ç¨‹åºè¿æ¥ç¨³å®šç‰ˆ</strong></p><p>è‡ª 1.11 ç‰ˆæœ¬ä»¥æ¥ï¼Œå¯¹ Kubernetes å®¢æˆ·ç«¯å‡­è¯æ’ä»¶çš„æ”¯æŒå°±ä¸€ç›´å¤„äºæµ‹è¯•é˜¶æ®µã€‚è€Œéšç€ Kubernetes 1.22 çš„æ¨å‡ºï¼Œè¿™é¡¹åŠŸèƒ½é€æ­¥è¶‹äºç¨³å®šã€‚å…¶ä¸­çš„ GA åŠŸèƒ½é›†ç°åœ¨åŒ…æ‹¬å¯¹äº¤äº’å¼ç™»å½•æµç¨‹æ’ä»¶æä¾›æ›´å¥½çš„æ”¯æŒï¼ŒåŒæ—¶ä¿®å¤äº†å¤šé¡¹ bugã€‚æ„Ÿå…´è¶£çš„æ’ä»¶ä½œè€…å¯ä»¥å‚è€ƒ sample-exec-plugin[2] ä»¥äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p><p><strong>etcd æ›´æ–°è‡³ 3.5.0</strong></p><p>Kubernetesçš„é»˜è®¤åç«¯å­˜å‚¨etcdè·å¾—äº†3.5.0æ–°ç‰ˆæœ¬ã€‚æ–°ç‰ˆæœ¬æ”¹è¿›äº†å®‰å…¨æ€§ã€æ€§èƒ½ã€ç›‘æ§ä»¥åŠå¼€å‘è€…ä½“éªŒï¼Œä¿®å¤äº†å¤šé¡¹bugï¼ŒåŒæ—¶å¸¦æ¥äº†è¿ç§»ä¸ºç»“æ„åŒ–æ—¥å¿—è®°å½•ä¸å†…ç½®æ—¥å¿—è½®æ›¿ç­‰é‡è¦æ–°åŠŸèƒ½ã€‚3.5.0ç‰ˆæœ¬è¿˜æå‡ºè¯¦å°½çš„åç»­å‘å±•è·¯çº¿å›¾ï¼Œæ¢ç´¢å¦‚ä½•æ›´å¥½åœ°è§£å†³æµé‡è¿‡è½½é—®é¢˜ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ<a href="http://mp.weixin.qq.com/s?__biz=MzA5OTAyNzQ2OA==&amp;mid=2649730822&amp;idx=1&amp;sn=cbe9049035712f58e465f4108703168d&amp;chksm=88939065bfe419739df224da1c33bf8f9b9ef49ebe136cfdb2cf36e0470b8fa1c46e2d184eaa&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">3.5.0å‘å¸ƒå…¬å‘Š</a>ä¸­çš„å®Œæ•´å˜æ›´æ¸…å•ã€‚</p><p><strong>ç”¨äºå†…å­˜èµ„æºçš„ Quality of Serviceï¼ˆQoSï¼‰</strong></p><p>æœ€åˆï¼ŒKubernetesä½¿ç”¨çš„æ˜¯ v1 cgroups APIã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼ŒPodçš„QoSç±»å°†ä»…å¯ç”¨äºCPUèµ„æºï¼ˆä¾‹å¦‚cpu_sharesï¼‰ã€‚å¦‚ä»Šï¼ŒKubernetes 1.22ç‰ˆä»¥alphaæµ‹è¯•çš„å½¢å¼ä½¿ç”¨cgroups v2 APIæ§åˆ¶å†…å­˜åˆ†é…ä¸éš”ç¦»ï¼Œå¸Œæœ›åœ¨å†…å­˜èµ„æºå‘ç”Ÿäº‰ç”¨æ—¶æé«˜å·¥ä½œè´Ÿè½½ä¸èŠ‚ç‚¹çš„å¯ç”¨æ€§ã€æ”¹å–„å®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„å¯é¢„æµ‹æ€§ã€‚</p><p><strong>èŠ‚ç‚¹ç³»ç»Ÿäº¤æ¢æ”¯æŒ</strong></p><p>æ¯ä¸€ä½ç³»ç»Ÿç®¡ç†å‘˜æˆ–Kubernetesç”¨æˆ·åœ¨è®¾ç½®å’Œä½¿ç”¨ Kubernetes æ—¶ï¼Œéƒ½ä¼šä¸çº¦è€ŒåŒåœ°ç¦ç”¨æ‰äº¤æ¢ç©ºé—´ã€‚éšç€ Kubernetes 1.22 ç‰ˆæœ¬çš„å‘å¸ƒï¼Œæ–°çš„ alpha åŠŸèƒ½å·²å¯æ”¯æŒè¿è¡Œå…·æœ‰äº¤æ¢å†…å­˜çš„èŠ‚ç‚¹ã€‚è¿™é¡¹å˜æ›´ä½¿å¾—ç®¡ç†å‘˜èƒ½å¤Ÿé€‰æ‹©åœ¨LinuxèŠ‚ç‚¹ä¸Šé…ç½®äº¤æ¢ï¼Œå¹¶å°†ä¸€éƒ¨åˆ†å—å­˜å‚¨è§†ä¸ºé¢å¤–çš„è™šæ‹Ÿå†…å­˜ã€‚</p><p><strong>Windows å¢å¼ºä¸åŠŸèƒ½</strong></p><p>SIG Windowsç»§ç»­ä¸ºä¸æ–­å‘å±•å£®å¤§çš„å¼€å‘è€…ç¤¾åŒºæä¾›æ”¯æŒï¼Œå¹¶åœ¨1.22æ–°ç‰ˆæœ¬ä¸­å‘å¸ƒäº†è‡ªå·±çš„å¼€å‘ç¯å¢ƒã€‚è¿™äº›æ–°å·¥å…·æ”¯æŒå¤šç§CNIæä¾›ç¨‹åºå¹¶èƒ½å¤Ÿåœ¨å¤šä¸ªå¹³å°ä¸Šé¡ºç•…è¿è¡Œã€‚é€šè¿‡ç¼–è¯‘Windows kubeletä¸kube-proxyï¼Œå†é…åˆæ—¥å¸¸æ„å»ºçš„å…¶ä»–Kubernetesç»„ä»¶ï¼Œæ–°ç‰ˆæœ¬ä¸ºç”¨æˆ·å¸¦æ¥ä¸€ç§ä»é›¶å¼€å§‹ä½¿ç”¨å…¨æ–°WindowsåŠŸèƒ½çš„æ–°æ–¹æ³•ã€‚</p><p>CSIå¯¹WindowsèŠ‚ç‚¹çš„æ”¯æŒä¹Ÿåœ¨1.22ç‰ˆæœ¬ä¸­è¾¾åˆ°GAé€šç”¨é˜¶æ®µã€‚å¦å¤–ï¼ŒKubernetes 1.22è¿æ¥äº†æ–°çš„alphaåŠŸèƒ½â€”â€”Windowsç‰¹æƒå®¹å™¨ã€‚ä¸ºäº†åœ¨WindowsèŠ‚ç‚¹ä¸Šä½¿ç”¨CSIå­˜å‚¨ï¼ŒCSIProxyå…è®¸æˆ‘ä»¬å°†CSIèŠ‚ç‚¹æ’ä»¶éƒ¨ç½²ä¸ºéç‰¹æƒPodï¼Œå¹¶ä½¿ç”¨ä»£ç†åœ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œç‰¹æƒå­˜å‚¨æ“ä½œã€‚</p><p><strong>seccomp é»˜è®¤é…ç½®</strong></p><p>Kubeletä»¥alphaåŠŸèƒ½çš„å½¢å¼æä¾›é»˜è®¤seccompé…ç½®åŠŸèƒ½ï¼ŒåŒæ—¶é™„å¸¦æ–°çš„å‘½ä»¤è¡Œæ ‡å¿—ä¸é…ç½®ã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œè¿™é¡¹æ–°åŠŸèƒ½å¯æä¾›é›†ç¾¤èŒƒå›´å†…çš„seccompé»˜è®¤å€¼ï¼Œå¹¶ä½¿ç”¨RuntimeDefault seccompté…ç½®å–ä»£é»˜è®¤æƒ…å†µä¸‹çš„Unconfinedï¼Œä»è€Œå¤§å¤§å¢å¼ºäº†Kuberneteséƒ¨ç½²çš„é»˜è®¤å®‰å…¨æ€§ã€‚å‡­å€Ÿæ›´å‡ºè‰²çš„é»˜è®¤å·¥ä½œè´Ÿè½½å®‰å…¨æ•ˆæœï¼Œç®¡ç†å‘˜ä»¬ç»ˆäºå¯ä»¥ç¡ä¸ªå¥½è§‰äº†ã€‚è‹¥éœ€äº†è§£è¿™é¡¹åŠŸèƒ½çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å®˜æ–¹seccompæ•™ç¨‹[3]ã€‚</p><p><strong>ä½¿ç”¨ kubeadm æå‡æ§åˆ¶å¹³é¢å®‰å…¨</strong></p><p>è¿™é¡¹æ–°çš„alphaåŠŸèƒ½å…è®¸æˆ‘ä»¬ä»¥érootç”¨æˆ·èº«ä»½è¿è¡Œkubeadmæ§åˆ¶å¹³é¢ç»„ä»¶ã€‚é•¿ä¹…ä»¥æ¥ï¼Œkubeadmä¸€ç›´è¦æ±‚é‡‡å–è¿™æ ·ä¸€ç§å®‰å…¨æªæ–½ã€‚è¦å®é™…ä½“éªŒï¼Œä½ éœ€è¦åœ¨kubeadmä¸­å¯ç”¨ç‰¹å®šçš„RootlessControlPlane feature gateã€‚åœ¨ä½¿ç”¨è¿™é¡¹alphaåŠŸèƒ½éƒ¨ç½²é›†ç¾¤æ—¶ï¼Œä½ çš„æ§åˆ¶å¹³é¢å°†ä»¥è¾ƒä½æƒé™è¿è¡Œã€‚</p><p>å¯¹äºkubeadmï¼ŒKubernetes 1.22è¿˜å¸¦æ¥äº†æ–°çš„v1beta3é…ç½®APIã€‚æ­¤æ¬¡è¿­ä»£å¸¦æ¥äº†å¤šé¡¹ç¤¾åŒºæœŸå¾…å·²ä¹…çš„åŠŸèƒ½ï¼ŒåŒæ—¶å¼ƒç”¨äº†éƒ¨åˆ†ç°æœ‰åŠŸèƒ½ã€‚v1beta3å°†æˆä¸ºç›®å‰çš„é¦–é€‰APIç‰ˆæœ¬ï¼›ä½†v1beta2 APIä»ç„¶æ­£å¸¸å¯ç”¨ï¼Œå¹¶æœªåœ¨1.22ç‰ˆä¸­è¢«æ·˜æ±°ã€‚</p><h2><span id="ä¸»è¦å˜åŒ–">ä¸»è¦å˜åŒ–</span></h2><p><strong>åˆ é™¤äº†å‡ ä¸ªå·²å¼ƒç”¨çš„ beta API</strong></p><p>1.22ç‰ˆæœ¬ä¸­åˆ é™¤äº†è®¸å¤šå·²ç»å¼ƒç”¨çš„beta APIï¼Œå¹¶å‘å¸ƒè¿™äº›APIçš„GAé€šç”¨ç‰ˆæœ¬ã€‚å…¨éƒ¨ç°æœ‰å¯¹è±¡å‡å¯é€šè¿‡ç¨³å®šçš„APIè¿›è¡Œäº¤äº’ã€‚æ­¤æ¬¡åˆ é™¤æ¶‰åŠ Ingressï¼ŒIngressClassï¼ŒLeaseï¼ŒAPIServiceï¼ŒValidatingWebhookConfigurationï¼ŒMutatingWebhookConfigurationï¼ŒCustomResourceDefinitionï¼ŒTokenReviewï¼ŒSubjectAccessReviewä»¥åŠ CertificateSigningRequest APIçš„betaç‰ˆæœ¬ã€‚</p><p>å…³äºå®Œæ•´æ¸…å•ï¼Œè¯·å‚é˜…å·²å¼ƒç”¨APIè¿ç§»æŒ‡å—[4]ä»¥åŠåšæ–‡ã€Š1.22ç‰ˆæœ¬ä¸­çš„Kubernetes APIä¸åŠŸèƒ½åˆ é™¤ï¼šä½ éœ€è¦äº†è§£çš„ä¸€åˆ‡[5]ã€‹ã€‚</p><p><strong>ä¸´æ—¶å®¹å™¨çš„ API å˜æ›´ä¸æ”¹è¿›</strong></p><p>ç”¨äºåˆ›å»ºä¸´æ—¶å®¹å™¨çš„ API åœ¨ 1.22 ç‰ˆæœ¬ä¸­ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚ä¸´æ—¶å®¹å™¨åŠŸèƒ½ç°ä¸ºalphaç‰ˆä¸”é»˜è®¤ç¦ç”¨ï¼Œæ–°çš„APIä¹Ÿä¸å†å“åº”å®¢æˆ·ç«¯å¯¹æ—§æœ‰APIçš„ä½¿ç”¨è¯·æ±‚ã€‚</p><p>åœ¨ç¨³å®šåŠŸèƒ½æ–¹é¢ï¼Œkubectl å·¥å…·éµå¾ª Kubernetes ç‰ˆæœ¬å€¾æ–œç­–ç•¥ï¼Œä½†kubectl v1.21åŠæ›´æ—©ç‰ˆæœ¬æ— æ³•æ”¯æŒä¸´æ—¶å®¹å™¨çš„æ–°APIã€‚å¦‚æœä½ æ‰“ç®—ä½¿ç”¨kubectl debugåˆ›å»ºä¸´æ—¶å®¹å™¨ï¼Œä¸”ä½ çš„é›†ç¾¤è¿è¡Œæœ‰Kubernetes 1.22ï¼Œåˆ™æ— æ³•ä½¿ç”¨kubectl v1.21æˆ–æ›´æ—©ç‰ˆæœ¬å®Œæˆè¿™é¡¹æ“ä½œã€‚å¦‚æœä½ å¸Œæœ›å°† kubectl debug ä¸å¤šä¸ªé›†ç¾¤ç‰ˆæœ¬æ··åˆä½¿ç”¨ï¼Œè¯·åŠ¡å¿…å°† kubectl æ›´æ–°è‡³1.22ã€‚</p><h2><span id="å…¶ä»–æ›´æ–°">å…¶ä»–æ›´æ–°</span></h2><p><strong>æ›´æ–°è‡³ç¨³å®šç‰ˆ</strong></p><ul><li>é™å®šæœåŠ¡è´¦æˆ·ä»¤ç‰Œæ•°é‡</li><li>CSIæœåŠ¡è´¦æˆ·ä»¤ç‰Œ</li><li>Windowså¯¹CSIæ’ä»¶çš„æ”¯æŒ</li><li>å¯¹äºåœ¨æ“ä½œä¸­ä½¿ç”¨å·²å¼ƒç”¨APIçš„è­¦å‘Šæœºåˆ¶</li><li>æ¸…é€€PodDisruptionBudget</li></ul><p><strong>é‡è¦åŠŸèƒ½æ›´æ–°</strong></p><ul><li>å¼•å…¥æ–°çš„ PodSecurity å‡†å…¥ alpha åŠŸèƒ½ï¼Œç”¨ä»¥æ›¿ä»£åŸæœ‰ PodSecurityPolicy</li><li>The Momory Manager è¿›å…¥ beta é˜¶æ®µ</li><li>æ¨å‡ºæ–°çš„alphaåŠŸèƒ½ï¼Œç”¨äºå®ç° API Server Tracing</li><li>kubeadmé…ç½®æ ¼å¼è¿æ¥æ–°çš„ v1beta3 ç‰ˆæœ¬</li><li>ç”¨äº PersistentVolumes çš„é€šç”¨æ•°æ®å¡«å……å™¨å·²æä¾› alpha ç‰ˆ</li><li>Kubernetes æ§åˆ¶å¹³é¢ç°å¯å§‹ç»ˆä½¿ç”¨ CronJobs v2 æ§åˆ¶å™¨</li><li>ä½œä¸º alpha åŠŸèƒ½ï¼Œæ‰€æœ‰ Kubernetes èŠ‚ç‚¹ç»„ä»¶ï¼ˆåŒ…æ‹¬ kubeletã€kube-proxy ä¸å®¹å™¨è¿è¡Œæ—¶ï¼‰éƒ½èƒ½å¤Ÿä»¥é root ç”¨æˆ·èº«ä»½è¿è¡Œ</li></ul><h2><span id="å‘å¸ƒè¯´æ˜">å‘å¸ƒè¯´æ˜</span></h2><p>è¯·ç‚¹å‡»æ­¤å¤„[6]æŸ¥çœ‹ 1.22 ç‰ˆæœ¬çš„å®Œæ•´å‘å¸ƒè¯´æ˜ä¿¡æ¯ã€‚</p><h2><span id="å‘å¸ƒæ—¶é—´">å‘å¸ƒæ—¶é—´</span></h2><p>Kubernetes 1.22 ç°å·²å¼€æ”¾ä¸‹è½½[7]å¹¶æ­£å¼ç™»é™†GitHub[8]ã€‚</p><h2><span id="ç‰ˆæœ¬å¾½æ ‡">ç‰ˆæœ¬å¾½æ ‡</span></h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/A1HKVXsfHNmJEu8ECBEibyEwsP7eqc3IicbGd65ga9tP2X1g6RGkB4zIsJuw0qdwRc4UCuiaLwkl4XDOWltlzq7mQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt></p><p>é¢å¯¹æ–°å† ç–«æƒ…ã€è‡ªç„¶ç¾å®³ä¸å€¦æ€ æƒ…ç»ªçš„é‡é‡æŒ‘æˆ˜ï¼ŒKubernetes 1.22 ä»ç„¶æ‹¿å‡ºäº† 53 é¡¹å¢å¼ºåŠŸèƒ½ï¼Œè¿™ä¹Ÿä½¿å…¶æˆä¸ºè¿„ä»Šä¸ºæ­¢æ›´æ–°é‡æœ€å¤§çš„ Kubernetes ç‰ˆæœ¬ã€‚è¿™æ ·è¾‰ç…Œçš„æˆå°±ï¼Œç¦»ä¸å¼€å‘å¸ƒå›¢é˜Ÿæˆå‘˜ä»¬çš„è¾›å‹¤åŠªåŠ›ã€çƒ­æƒ…å¥‰çŒ®ä»¥åŠKubernetesç”Ÿæ€ç³»ç»Ÿä¸­æ°å‡ºè´¡çŒ®è€…ä»¬çš„ä¸æ‡ˆæ”¯æŒã€‚1.22 ç‰ˆæœ¬å‘å¸ƒå¾½æ ‡æé†’æˆ‘ä»¬è¦ä¸æ–­çªç ´æ–°çš„æé™ã€åˆ›é€ æ–°çš„çºªå½•ã€‚è°¨ä»¥æ­¤æ ‡ï¼ŒçŒ®ç»™æ¯ä¸€ä½å‘å¸ƒå›¢é˜Ÿæˆå‘˜ã€æ”€ç™»è€…ä¸å‰ç»è€…ï¼</p><p>å¾½æ ‡ç”± Boris Zotkin è®¾è®¡ã€‚ä½œä¸º MathWorksçš„Mac/Linux ç®¡ç†å‘˜ï¼ŒBoris çƒ­çˆ±ç”Ÿæ´»ä¸­å¹³æ·¡ç®€å•çš„ä¸€åˆ‡ï¼Œå–œæ¬¢ä¸å®¶äººå…±åº¦æ—¶å…‰ã€‚è¿™é‡Œå†æ¬¡æ„Ÿè°¢è¿™ä½ä¹è§‚æŠ€æœ¯äººè´¡çŒ®çš„ç²¾ç¾ä½œå“ï¼</p><p>ç›¸å…³é“¾æ¥ï¼š</p><ol><li><a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/using-api/server-side-apply/</a></li><li><a href="https://github.com/ankeesler/sample-exec-plugin" target="_blank" rel="noopener">https://github.com/ankeesler/sample-exec-plugin</a></li><li><a href="https://kubernetes.io/docs/tutorials/clusters/seccomp/#enable-the-use-of-runtimedefault-as-the-default-seccomp-profile-for-all-workloads" target="_blank" rel="noopener">https://kubernetes.io/docs/tutorials/clusters/seccomp/#enable-the-use-of-runtimedefault-as-the-default-seccomp-profile-for-all-workloads</a></li><li><a href="https://kubernetes.io/docs/reference/using-api/deprecation-guide/#v1-22" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/using-api/deprecation-guide/#v1-22</a></li><li><a href="https://blog.k8s.io/2021/07/14/upcoming-changes-in-kubernetes-1-22/" target="_blank" rel="noopener">https://blog.k8s.io/2021/07/14/upcoming-changes-in-kubernetes-1-22/</a></li><li><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md" target="_blank" rel="noopener">https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md</a></li><li><a href="https://kubernetes.io/releases/download/" target="_blank" rel="noopener">https://kubernetes.io/releases/download/</a></li><li><a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.22.0" target="_blank" rel="noopener">https://github.com/kubernetes/kubernetes/releases/tag/v1.22.0</a></li></ol><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://kubernetes.io/blog/2021/08/04/kubernetes-1-22-release-announcement/" target="_blank" rel="noopener">https://kubernetes.io/blog/2021/08/04/kubernetes-1-22-release-announcement/</a></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ åˆ†å¸ƒå¼å®éªŒå®¤ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/4dpzmp5c" target="_blank" rel="noopener">https://tinyurl.com/4dpzmp5c</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æˆ‘ä»¬å…´å¥‹åœ°å‘å¤§å®¶å®£å¸ƒï¼ŒKubernetes åœ¨ 2021 å¹´å†…çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ã€å³ 1.22 ç‰ˆæœ¬å·²ç»æ­£å¼æ¥ä¸´ï¼&lt;/p&gt;
&lt;p&gt;æ–°ç‰ˆæœ¬åŒ…å« 53 é¡¹å¢å¼ºåŠŸèƒ½ï¼šå…¶ä¸­13é¡¹åŠŸèƒ½å·²å‡çº§è‡³ç¨³å®šç‰ˆï¼Œ24 é¡¹åŠŸèƒ½é¡ºåˆ©æ­¥å…¥ beta é˜¶æ®µï¼Œ16 é¡¹åŠŸèƒ½åˆšåˆšå¼€å§‹ alpha é˜¶æ®µã€‚å¦æœ‰ 3 é¡¹åŠŸèƒ½è¢«å½»åº•å¼ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¹´ 4 æœˆï¼ŒKubernetes çš„å‘å¸ƒå‘¨æœŸå·²ç»æ­£å¼ç”±æ¯å¹´4æ¬¡è°ƒæ•´ä¸ºæ¯å¹´3æ¬¡ã€‚è€Œ1.22ç‰ˆæœ¬æ­£æ˜¯è°ƒæ•´ä¹‹åçš„é¦–ä¸ªé•¿å‘¨æœŸå‘å¸ƒç‰ˆæœ¬ã€‚éšç€Kubernetesçš„é€æ¸æˆç†Ÿï¼Œæ¯ä¸ªå‘å¸ƒå‘¨æœŸä¸­åŒ…å«çš„å¢å¼ºåŠŸèƒ½æ•°é‡ä¸€ç›´åœ¨æŒç»­å¢åŠ ã€‚è¿™æ„å‘³ç€è´¡çŒ®è€…ç¤¾åŒºåŠå‘å¸ƒå·¥ç¨‹å›¢é˜Ÿéœ€è¦åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´å®Œæˆæ›´å¤šå¼€å‘å·¥ä½œï¼Œè€Œæ–°ç‰ˆæœ¬ä¸­çš„å¤§é‡å…¨æ–°åŠŸèƒ½ä¹Ÿä¼šç»™æœ€ç»ˆç”¨æˆ·ç¤¾åŒºå¸¦æ¥ä¸€å®šçš„å­¦ä¹ å‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰é‰´äºæ­¤ï¼ŒKubernetes çš„å‘å¸ƒèŠ‚å¥ç”±ä¸€å¹´å››æ¬¡è°ƒæ•´ä¸ºä¸€å¹´ä¸‰æ¬¡èƒ½å¤Ÿå¸¦æ¥æ›´å¥½çš„å‡è¡¡æ•ˆæœï¼ŒåŒ…æ‹¬è´¡çŒ®ä¸ç‰ˆæœ¬ç®¡ç†ã€ç¤¾åŒºè§„åˆ’å‡çº§å¹¶ä¸ºç”¨æˆ·æä¾›æ›´èˆ’é€‚çš„æ›´æ–°ä¸Šæ‰‹ä½“éªŒã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="å¼€æº" scheme="https://www.hi-linux.com/tags/%E5%BC%80%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>ç¾å›½å®‰å…¨å±€ NSAã€CISA å‘å¸ƒ Kubernetes å®‰å…¨åŠ å›ºæŒ‡å—(å†…é™„å…è´¹ä¸‹è½½åœ°å€)</title>
    <link href="https://www.hi-linux.com/posts/51218.html"/>
    <id>https://www.hi-linux.com/posts/51218.html</id>
    <published>2021-08-05T01:00:00.000Z</published>
    <updated>2021-08-05T04:21:06.067Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>Kubernetes æœ€åˆç”±è°·æ­Œå…¬å¸çš„å·¥ç¨‹å¸ˆå¼€å‘ï¼Œéšåç”±äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šå¼€æºï¼Œå®ƒæ˜¯å½“å‰æœ€æµè¡Œçš„å®¹å™¨åä½œè½¯ä»¶ã€‚Kubernetes ä¸»è¦ç”¨äºåŸºäºäº‘çš„åŸºç¡€è®¾æ–½å†…éƒ¨ï¼Œä¾¿äºç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨è½¯ä»¶å®¹å™¨éƒ¨ç½²æ–°çš„ IT èµ„æºã€‚</p><p>Kubernetes çš„æ”»å‡»ç›®æ ‡é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼š<strong>æ•°æ®çªƒå–ã€è®¡ç®—èƒ½åŠ›çªƒå–æˆ–æ‹’ç»æœåŠ¡</strong>ã€‚ä¼ ç»Ÿä¸Šï¼Œæ•°æ®ç›—çªƒæ˜¯ä¸»è¦åŠ¨æœºï¼›ç„¶è€Œï¼Œç”±äº Kubernetes å’Œ Docker æ¨¡å‹å’Œä¼ ç»Ÿçš„å•ç‰‡è½¯ä»¶å¹³å°ä¹‹é—´å­˜åœ¨å·¨å¤§ä¸åŒï¼Œå› æ­¤å¾ˆå¤šç³»ç»Ÿç®¡ç†å‘˜åœ¨å®‰å…¨é…ç½® Kubernetes æ–¹é¢é—®é¢˜é¢‡å¤šã€‚å¤šå¹´æ¥ï¼Œå¤šæ¬¾å¯†å¸æŒ–æ˜åƒµå°¸ç½‘ç»œéƒ½åœ¨æ”»å‡»è¿™ç±»é…ç½®é”™è¯¯é—®é¢˜ã€‚å¨èƒè¡ŒåŠ¨è€…æ‰«æäº’è”ç½‘ä¸Šè¢«æš´éœ²çš„æœªè®¤è¯çš„ Kubernetes ç®¡ç†åŠŸèƒ½æˆ–è€…æ‰«æåœ¨å¤§å‹ Kubernetes é›†ç¾¤ï¼ˆå¦‚ Argo Workflow æˆ– Kubeflowï¼‰ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè·å¾—å¯¹ Kubernetes åç«¯çš„è®¿é—®æƒé™ï¼Œä¹‹ååˆ©ç”¨è¿™ç§æƒé™åœ¨å—å®³è€…äº‘åŸºç¡€è®¾æ–½ä¸Šéƒ¨ç½²å¯†å¸æŒ–æ˜åº”ç”¨ã€‚è¿™äº›æ”»å‡»æ—©åœ¨ 2017 å¹´åˆå°±å·²å‘ç”Ÿï¼Œè€Œç°åœ¨å·²å‘å±•ä¸ºå¤šä¸ªå›¢ä¼™ä¸ºäº†åˆ©ç”¨åŒä¸€ä¸ªé…ç½®é”™è¯¯çš„é›†ç¾¤è€Œå¤§æ‰“å‡ºæ‰‹ã€‚</p><a id="more"></a><p>ç¾å›½å›½å®¶å®‰å…¨å±€ (NSA) å’Œç½‘ç»œå®‰å…¨ä¸åŸºç¡€è®¾æ–½å®‰å…¨å±€ (CISA) è¿‘æ—¥å‘å¸ƒäº†ä¸€ä»½ 59 é¡µçš„ç½‘ç»œå®‰å…¨æŠ€æœ¯æŠ¥å‘Šã€Kubernetes å®‰å…¨åŠ å›ºæŒ‡å—ã€ã€‚è¯¥æŠ¥å‘Šè¯¦ç»†ä»‹ç»äº†å¯¹ Kubernetes ç¯å¢ƒçš„å¨èƒï¼Œå¹¶æä¾›äº†é…ç½®æŒ‡å—ä»¥æœ€å¤§é™åº¦åœ°é™ä½é£é™©ã€‚</p><p>CISA å’Œ NSA å‘å¸ƒçš„è¿™ä»½æŒ‡å—æ—¨åœ¨ä¸ºç³»ç»Ÿç®¡ç†å‘˜æä¾›å…³äºæœªæ¥ Kubernetes é…ç½®çš„å®‰å…¨åŸºçº¿ï¼Œä»¥é¿å…é­å—æ­¤ç±»æ”»å‡»ã€‚å¦å¤–é™¤äº†åŸºæœ¬çš„é…ç½®æŒ‡å—å¤–ï¼Œè¿™ä»½æŠ¥å‘Šè¿˜è¯¦è¿°äº†ä¼ä¸šå’Œæ”¿åºœæœºæ„å¯é‡‡å–çš„åŸºæœ¬ç¼“è§£æªæ–½ï¼Œé˜»æ­¢æˆ–é™åˆ¶ Kubernetes å®‰å…¨äº‹ä»¶çš„ä¸¥é‡æ€§ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><p>æ‰«æå®¹å™¨å’Œ Podsï¼ŒæŸ¥æ‰¾æ¼æ´æˆ–é…ç½®é”™è¯¯é—®é¢˜ã€‚</p></li><li><p>å°½å¯èƒ½ä»¥æœ€å°æƒé™è¿è¡Œå®¹å™¨å’Œ Podsã€‚</p></li><li><p>ä½¿ç”¨ç½‘ç»œåˆ†å‰²æ¥æ§åˆ¶æ”»é™·äº‹ä»¶é€ æˆçš„æŸå®³ã€‚</p></li><li><p>ä½¿ç”¨é˜²ç«å¢™æ¥é™åˆ¶ä¸å¿…è¦çš„ç½‘ç»œè¿æ¥å’ŒåŠ å¯†ä»¥ä¿æŠ¤æœºå¯†æ€§ã€‚</p></li><li><p>ä½¿ç”¨å¼ºè®¤è¯å’Œæˆæƒé™åˆ¶ç”¨æˆ·å’Œç®¡ç†å‘˜è®¿é—®æƒé™ä»¥åŠé™åˆ¶æ”»å‡»é¢ã€‚</p></li><li><p>ä½¿ç”¨æ—¥å¿—å®¡è®¡ï¼Œä»¥ä¾¿ç®¡ç†å‘˜èƒ½å¤Ÿç›‘æ§æ´»åŠ¨å¹¶æ”¶åˆ°å…³äºæ½œåœ¨æ¶æ„æ´»åŠ¨çš„è­¦æŠ¥ã€‚</p></li><li><p>å®šæœŸå®¡è®¡æ‰€æœ‰çš„ Kubernetes è®¾ç½®å¹¶ä½¿ç”¨æ¼æ´æ‰«æç¡®ä¿å®‰å…¨é£é™©å¾—åˆ°æ§åˆ¶ï¼Œè¡¥ä¸å·²åº”ç”¨ã€‚</p></li></ul><p>NSA å’Œ CISA çš„è¿™ä»½æŒ‡å—ä¾§é‡äºå®‰å…¨æŒ‘æˆ˜ï¼Œå¹¶å»ºè®®ç³»ç»Ÿç®¡ç†å‘˜å°½å¯èƒ½å¼ºåŒ–ä»–ä»¬çš„ç¯å¢ƒã€‚NSA å‘å¸ƒæ­¤æŒ‡å—æ˜¯æ”¯æŒç¾å›½å›½é˜²éƒ¨ã€å›½é˜²å·¥ä¸šåŸºåœ°å’Œå›½å®¶å®‰å…¨ç³»ç»Ÿçš„ä½¿å‘½çš„ä¸€éƒ¨åˆ†ã€‚</p><p><strong>å¦‚éœ€ã€ ç¾å›½å®‰å…¨å±€ Kubernetes å®‰å…¨åŠ å›ºæŒ‡å— ã€ PDF ç‰ˆï¼Œå¯åœ¨å…¬ä¼—å·å¯¹è¯æ¡†å›å¤å…³é”®å­—ï¼šã€Œ<code>K8s-Hardening-Guidance</code>ã€å…è´¹è·å–ã€‚</strong></p></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Kubernetes æœ€åˆç”±è°·æ­Œå…¬å¸çš„å·¥ç¨‹å¸ˆå¼€å‘ï¼Œéšåç”±äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šå¼€æºï¼Œå®ƒæ˜¯å½“å‰æœ€æµè¡Œçš„å®¹å™¨åä½œè½¯ä»¶ã€‚Kubernetes ä¸»è¦ç”¨äºåŸºäºäº‘çš„åŸºç¡€è®¾æ–½å†…éƒ¨ï¼Œä¾¿äºç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨è½¯ä»¶å®¹å™¨éƒ¨ç½²æ–°çš„ IT èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes çš„æ”»å‡»ç›®æ ‡é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼š&lt;strong&gt;æ•°æ®çªƒå–ã€è®¡ç®—èƒ½åŠ›çªƒå–æˆ–æ‹’ç»æœåŠ¡&lt;/strong&gt;ã€‚ä¼ ç»Ÿä¸Šï¼Œæ•°æ®ç›—çªƒæ˜¯ä¸»è¦åŠ¨æœºï¼›ç„¶è€Œï¼Œç”±äº Kubernetes å’Œ Docker æ¨¡å‹å’Œä¼ ç»Ÿçš„å•ç‰‡è½¯ä»¶å¹³å°ä¹‹é—´å­˜åœ¨å·¨å¤§ä¸åŒï¼Œå› æ­¤å¾ˆå¤šç³»ç»Ÿç®¡ç†å‘˜åœ¨å®‰å…¨é…ç½® Kubernetes æ–¹é¢é—®é¢˜é¢‡å¤šã€‚å¤šå¹´æ¥ï¼Œå¤šæ¬¾å¯†å¸æŒ–æ˜åƒµå°¸ç½‘ç»œéƒ½åœ¨æ”»å‡»è¿™ç±»é…ç½®é”™è¯¯é—®é¢˜ã€‚å¨èƒè¡ŒåŠ¨è€…æ‰«æäº’è”ç½‘ä¸Šè¢«æš´éœ²çš„æœªè®¤è¯çš„ Kubernetes ç®¡ç†åŠŸèƒ½æˆ–è€…æ‰«æåœ¨å¤§å‹ Kubernetes é›†ç¾¤ï¼ˆå¦‚ Argo Workflow æˆ– Kubeflowï¼‰ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè·å¾—å¯¹ Kubernetes åç«¯çš„è®¿é—®æƒé™ï¼Œä¹‹ååˆ©ç”¨è¿™ç§æƒé™åœ¨å—å®³è€…äº‘åŸºç¡€è®¾æ–½ä¸Šéƒ¨ç½²å¯†å¸æŒ–æ˜åº”ç”¨ã€‚è¿™äº›æ”»å‡»æ—©åœ¨ 2017 å¹´åˆå°±å·²å‘ç”Ÿï¼Œè€Œç°åœ¨å·²å‘å±•ä¸ºå¤šä¸ªå›¢ä¼™ä¸ºäº†åˆ©ç”¨åŒä¸€ä¸ªé…ç½®é”™è¯¯çš„é›†ç¾¤è€Œå¤§æ‰“å‡ºæ‰‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="å¼€æº" scheme="https://www.hi-linux.com/tags/%E5%BC%80%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>å·§ç”¨ Xpanes å®ç°å¤šæœåŠ¡å™¨æ‰¹é‡ç®¡ç†</title>
    <link href="https://www.hi-linux.com/posts/36685.html"/>
    <id>https://www.hi-linux.com/posts/36685.html</id>
    <published>2021-08-04T01:00:00.000Z</published>
    <updated>2021-08-04T02:29:35.927Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p><strong>ç”± Tmux æä¾›æ”¯æŒçš„ç»ˆæç»ˆç«¯åˆ†å±å™¨ï¼</strong></p></blockquote><p>è™½ç„¶æˆ‘ä»¬å·²ç»å¯ä»¥ä½¿ç”¨ <code>tmux</code> è¿›è¡Œå±å¹•çš„åˆ†å‰²å’Œåˆ‡æ¢ï¼Œä½†æ˜¯å¦‚æœéœ€è¦å¯¹ä¸€æ‰¹æœåŠ¡å™¨è¿›è¡Œæ“ä½œçš„è¯ï¼Œå°±åªèƒ½ä¸€ä¸ªä¸€ä¸ªçš„ç™»å½•å’Œæ‰§è¡Œäº†ã€‚å¦‚æœä½¿ç”¨è¿‡ <code>Xshell</code> æˆ–è€…å…¶ä»–è¿œç¨‹å·¥å…·çš„è¯ï¼Œè‚¯å®šæ˜¯ä½¿ç”¨è¿‡è¿™ä¸ªåŠŸèƒ½ç‰¹æ€§çš„ï¼Œä¸€æ¬¡å‘½ä»¤è¾“å‡ºå¯ä»¥åœ¨ç™»å½•çš„å¤šä¸ªè¿œç¨‹ç»ˆç«¯ä¸Šé¢æ‰§è¡Œã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>tmux-xpanes</code> æ¥å®ŒæˆåŒæ ·çš„äº‹æƒ…äº†ï¼Œæ’’èŠ±ï¼</p><a id="more"></a><h2><span id="ç‰¹ç‚¹ä»‹ç»">ç‰¹ç‚¹ä»‹ç»</span></h2><blockquote><p>the features about xpanes</p></blockquote><ul><li>Split tmux window into multiple panes</li><li>å°† tmux çª—å£æ‹†åˆ†ä¸ºå¤šä¸ªçª—æ ¼<ul><li>Construct command lines &amp; execute them on the panes</li><li>æ„é€ å‘½ä»¤è¡Œå¹¶åœ¨çª—æ ¼ä¸Šæ‰§è¡Œå®ƒä»¬</li></ul></li><li>Runnable from outside of tmux session</li><li>Runnable from inside of tmux session</li><li>Record operation log</li><li>è®°å½•æ“ä½œæ—¥å¿—</li><li>Flexible layout arrangement for panes</li><li>çª—æ ¼çš„çµæ´»å¸ƒå±€å®‰æ’<ul><li>Select layout presets</li><li>é€‰æ‹©å¸ƒå±€é¢„è®¾</li><li>Set columns or rows as you like</li><li>æ ¹æ®éœ€è¦è®¾ç½®åˆ—æˆ–è¡Œ</li></ul></li><li>Display pane title on each pane</li><li>åœ¨æ¯ä¸ªçª—æ ¼ä¸Šæ˜¾ç¤ºçª—æ ¼æ ‡é¢˜</li><li>Generate command lines from standard input (Pipe mode)</li><li>æ ‡å‡†è¾“å…¥(ç®¡é“æ¨¡å¼)ç”Ÿæˆå‘½ä»¤è¡Œ</li></ul><h2><span id="å·¥å…·å®‰è£…">å·¥å…·å®‰è£…</span></h2><blockquote><p>requirements: bash3.2+ and tmux1.8+</p></blockquote><ul><li>macOS</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install tmux-xpanes</span><br></pre></td></tr></table></figure><ul><li>CentOS</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-$(rpm --<span class="built_in">eval</span> %rhel).noarch.rpm</span><br><span class="line">$ sudo yum install xpanes</span><br></pre></td></tr></table></figure><ul><li>Ubuntu</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install software-properties-common</span><br><span class="line">$ sudo add-apt-repository ppa:greymd/tmux-xpanes</span><br><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install tmux-xpanes</span><br></pre></td></tr></table></figure><ul><li>Manual</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Download with wget</span></span><br><span class="line">$ wget https://raw.githubusercontent.com/greymd/tmux-xpanes/v4.1.3/bin/xpanes -O ./xpanes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Put it under PATH and make it executable.</span></span><br><span class="line">$ sudo install -m 0755 xpanes /usr/<span class="built_in">local</span>/bin/xpanes</span><br></pre></td></tr></table></figure><ul><li>Zsh Completion</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Clone the repository</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/greymd/tmux-xpanes.git /path/to/tmux-xpanes</span><br><span class="line"></span><br><span class="line"><span class="comment"># ~/.zshrc.</span></span><br><span class="line">$ <span class="built_in">source</span> /path/to/tmux-xpanes/completion.zsh</span><br></pre></td></tr></table></figure><h2><span id="å·¥å…·å¸®åŠ©">å·¥å…·å¸®åŠ©</span></h2><blockquote><p>tmux-xpanes is alias of xpanes</p></blockquote><ul><li>[Normal mode1] Outside of tmux session<ul><li>å½“ <code>tmux</code> æ²¡æœ‰æ‰“å¼€ä¸” <code>xpanes</code> åœ¨ç»ˆç«¯ä¸Šæ‰§è¡Œæ—¶ï¼Œ<code>xpanes</code> çš„è¡Œä¸ºå¦‚ä¸‹:</li><li>å®ƒæ–°å»ºä¸€ä¸ª tmux ä¼šè¯ï¼Œå¹¶åœ¨ä¼šè¯ä¸Šæ–°å»ºçª—å£</li><li>æ­¤å¤–ï¼Œå®ƒå°†çª—å£åˆ†éš”ä¸ºå¤šä¸ªçª—æ ¼</li><li>æœ€åï¼Œå°†ä¼šè¯é™„åŠ ä¸Šå»</li></ul></li><li>[Normal mode2] Inside of tmux session<ul><li>å½“ <code>tmux</code> å·²ç»æ‰“å¼€å¹¶åœ¨ç°æœ‰çš„ <code>tmux</code> ä¼šè¯ä¸Šæ‰§è¡Œ <code>xpanes</code> æ—¶ï¼Œè¯¥å‘½ä»¤çš„è¡Œä¸ºå¦‚ä¸‹:</li><li>å®ƒä¼šåœ¨ç°æœ‰æ´»åŠ¨ä¼šè¯ä¸Šæ–°å»ºä¸€ä¸ªçª—å£</li><li>æ­¤å¤–ï¼Œå®ƒå°†çª—å£åˆ†éš”ä¸ºå¤šä¸ªçª—æ ¼</li><li>æœ€åï¼Œçª—å£å°†å¤„äºæ´»åŠ¨çŠ¶æ€</li></ul></li><li>[Pipe mode] Inside of tmux session &amp; Accepting standard input<ul><li>å½“ <code>xpanes</code> åœ¨æ­£å¸¸æ¨¡å¼ <code>2</code> ä¸‹æ¥å—æ ‡å‡†è¾“å…¥æ—¶ï¼Œ<code>xpanes</code> çš„è¡Œä¸ºå°†æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç§°ä¸ºâ€œç®¡é“æ¨¡å¼â€çš„è¡Œä¸ºã€‚</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">  xpanes [OPTIONS] [argument ...]</span><br><span class="line"></span><br><span class="line">Usage(Pipe mode):</span><br><span class="line">  <span class="built_in">command</span> ... | xpanes [OPTIONS] [&lt;<span class="built_in">command</span>&gt; ...]</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">  -h,--<span class="built_in">help</span>                    Display this <span class="built_in">help</span> and <span class="built_in">exit</span>.</span><br><span class="line">  -V,--version                 Output version information and <span class="built_in">exit</span>.</span><br><span class="line">  -B &lt;begin-command&gt;           Run &lt;begin-command&gt; before processing &lt;<span class="built_in">command</span>&gt; <span class="keyword">in</span> each pane. Multiple options are allowed.</span><br><span class="line">  -c &lt;<span class="built_in">command</span>&gt;                 Set &lt;<span class="built_in">command</span>&gt; to be executed <span class="keyword">in</span> each pane. Default is `<span class="built_in">echo</span> &#123;&#125;`.</span><br><span class="line">  -d,--desync                  Make synchronize-panes option off <span class="keyword">in</span> new window.</span><br><span class="line">  -e                           Execute given arguments as is. Same as -c <span class="string">'&#123;&#125;'</span></span><br><span class="line">  -I &lt;repstr&gt;                  Replacing one or more occurrences of &lt;repstr&gt; <span class="keyword">in</span> <span class="built_in">command</span> provided by -c or -B. Default is `&#123;&#125;`.</span><br><span class="line">  -C NUM,--cols=NUM            Number of columns of window layout.</span><br><span class="line">  -R NUM,--rows=NUM            Number of rows of window layout.</span><br><span class="line">  -l &lt;layout&gt;                  Set the preset of window layout. Recognized layout arguments are:</span><br><span class="line">                               t    tiled</span><br><span class="line">                               eh   even-horizontal</span><br><span class="line">                               ev   even-vertical</span><br><span class="line">                               mh   main-horizontal</span><br><span class="line">                               mv   main-vertical</span><br><span class="line">  -n &lt;number&gt;                  Set the maximum number of &lt;argument&gt; taken <span class="keyword">for</span> each pane.</span><br><span class="line">  -s                           Speedy mode: Run <span class="built_in">command</span> without opening an interactive shell.</span><br><span class="line">  -ss                          Speedy mode AND close a pane automatically at the same time as process exiting.</span><br><span class="line">  -S &lt;socket-path&gt;             Set a full alternative path to the server socket.</span><br><span class="line">  -t                           Display each argument on the each pane is border as their title.</span><br><span class="line">  -x                           Create extra panes <span class="keyword">in</span> the current active window.</span><br><span class="line">  --<span class="built_in">log</span>[=&lt;directory&gt;]          Enable logging and store <span class="built_in">log</span> files to ~/.cache/xpanes/logs or &lt;directory&gt;.</span><br><span class="line">  --<span class="built_in">log</span>-format=&lt;FORMAT&gt;        Make name of <span class="built_in">log</span> files follow &lt;FORMAT&gt;. Default is `[:ARG:].<span class="built_in">log</span>.%Y-%m-%d_%H-%M-%S`.</span><br><span class="line">  --ssh                        Same as `-t -s -c <span class="string">'ssh -o StrictHostKeyChecking=no &#123;&#125;'</span>`.</span><br><span class="line">  --stay                       Do not switch to new window.</span><br><span class="line">  --bulk-cols=NUM1[,NUM2 ...]  Set number of columns on multiple rows (i.e, <span class="string">"2,2,2"</span> represents 2 cols x 3 rows).</span><br><span class="line">  --debug                      Print debug message.</span><br></pre></td></tr></table></figure><h2><span id="ä½¿ç”¨ä»‹ç»">ä½¿ç”¨ä»‹ç»</span></h2><blockquote><p>ä»‹ç» xpanes å·¥å…·çš„ä½¿ç”¨æ–¹å¼å’Œç®€å•å·¥ä½œæ¨¡å¼ï¼</p></blockquote><p><img src="https://img.hi-linux.com/staticfile/learn-tmux-xpanes-tools-01-20210709162820791-2021-07-09-mNvwzx.gif" alt="ä½¿ç”¨xpanesæ¥å¹¶å‘æ‰§è¡Œå‘½ä»¤"></p><table><thead><tr><th style="text-align:left">ç¼–å·</th><th style="text-align:left">å‚æ•°</th><th style="text-align:left">å«ä¹‰è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><strong><code>-d</code></strong></td><td style="text-align:left">æ‰“å¼€çš„çª—å£ä¸åŒæ­¥è¾“å‡ºå‘½ä»¤</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><strong><code>-c</code></strong></td><td style="text-align:left">åŒ…å«éœ€è¦æ‰§è¡Œçš„å‘½ä»¤</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><strong><code>-I</code></strong></td><td style="text-align:left">ç”¨æ¥æŒ‡å®šå ä½ç¬¦</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><strong><code>-t</code></strong></td><td style="text-align:left">å¯ä»¥åœ¨æ¯ä¸ªçª—æ ¼è¾¹æ¡†ä¸Šæ˜¾ç¤ºæ¯ä¸ªå‚æ•°</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><strong><code>--ssh</code></strong></td><td style="text-align:left">åŠ©äºå¿½ç•¥ openssh çš„è­¦æŠ¥æ¶ˆæ¯</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><strong><code>--log</code></strong></td><td style="text-align:left">è®°å½• SSH è¿æ¥å¤šä¸ªä¸»æœºå¹¶è¿›è¡Œæ—¥å¿—æ“ä½œ</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><strong><code>-s</code></strong></td><td style="text-align:left">å°†ä¸ä¼šåˆ›å»ºæ–°çš„äº¤äº’å¼ shell å‘½ä»¤</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><strong><code>-ss</code></strong></td><td style="text-align:left">å±è”½ä¿¡æ¯</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><strong><code>-x</code></strong></td><td style="text-align:left">å¯ä»¥åœ¨ç°æœ‰çª—å£ä¸Šåˆ›å»ºæ–°çª—æ ¼</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left"><strong><code>-e</code></strong></td><td style="text-align:left">å¯ä»¥åœ¨ä¸åŒçš„çª—æ ¼ä¸Šæ‰§è¡Œä¸åŒçš„å‘½ä»¤</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left"><strong><code>-B</code></strong></td><td style="text-align:left">å¯ä»¥å¯¹æ¯ä¸ªçª—æ ¼è¿›è¡Œé¢„å¤„ç†</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><strong><code>-C</code></strong></td><td style="text-align:left">æ¥æ§åˆ¶çª—å£çš„åˆ—</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left"><strong><code>-R</code></strong></td><td style="text-align:left">æ¥æ§åˆ¶çª—å£çš„è¡Œ</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left"><strong><code>--bulk-cols</code></strong></td><td style="text-align:left">æŒ‡å®šå¯¹åº”æ¯ä¸€è¡Œçš„åˆ—æ•°</td></tr></tbody></table><ul><li>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†ä½¿ç”¨ <code>tmux</code> å·¥å…·æ‰“å¼€å››ä¸ªçª—å£ï¼Œåˆ†åˆ«æ‰§è¡Œ <code>echo n</code> çš„å‘½ä»¤ã€‚æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ªçª—å£æ‰§è¡Œå‘½ä»¤ï¼Œå…¶ä»–çª—å£å‡ä¼šåŒæ­¥æ‰§è¡Œè¯¥å‘½ä»¤ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ <code>xpanes</code> å‘½ä»¤ä¹‹åï¼Œä»é”®ç›˜è¾“å…¥åœ¨å¤šä¸ªçª—æ ¼ä¸­æ˜¯åŒæ­¥çš„ã€‚å½“æˆ‘ä»¬ä½¿ç”¨å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ <code>exit</code> å‘½ä»¤æ¥é€€å‡ºæ‰€æœ‰æ‰“å¼€çš„çª—å£ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢ä¸¤ä¸ªæ•ˆæœç­‰åŒ</span></span><br><span class="line">$ xpanes &#123;1..4&#125;</span><br><span class="line">$ xpanes 1 2 3 4</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> 1                       â”‚$ <span class="built_in">echo</span> 2                       â”‚</span><br><span class="line">â”‚1                              â”‚2                              â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> 3                       â”‚$ <span class="built_in">echo</span> 4                       â”‚</span><br><span class="line">â”‚3                              â”‚4                              â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœå¸Œæœ›ï¼Œæ‰“å¼€çš„çª—å£ä¸åŒæ­¥è¾“å‡ºå‘½ä»¤çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>-d/--desync</code> å‚æ•°ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -d</span></span><br><span class="line">$ xpanes -d 1 2 3 4</span><br></pre></td></tr></table></figure><ul><li><code>xpanes</code> çš„åŸºæœ¬é€‰é¡¹ä¹‹ä¸€ <code>-c</code> å‚æ•°ï¼Œç”¨äºè¡¨ç¤ºéœ€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>-c</code> å‚æ•°å°† <code>seq</code> å‘½ä»¤åŒ…è£¹åœ¨å†…ï¼Œå…¶ä¸­ <code>{}</code> è¡¨ç¤ºéœ€è¦è¢«æ›¿æ¢çš„å‚æ•°ã€‚è¿™ä¸ªå ä½ç¬¦å¯ä»¥ä½¿ç”¨ <code>-I</code> å‚æ•°æ¥æŒ‡å®šã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -c</span></span><br><span class="line">$ xpanes -c <span class="string">'seq &#123;&#125;'</span> 1 2 3 4</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$ seq 1                        â”‚$ seq 2                        â”‚</span><br><span class="line">â”‚1                              â”‚1                              â”‚</span><br><span class="line">â”‚                               â”‚2                              â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$ seq 3                        â”‚$ seq 4                        â”‚</span><br><span class="line">â”‚1                              â”‚1                              â”‚</span><br><span class="line">â”‚2                              â”‚2                              â”‚</span><br><span class="line">â”‚3                              â”‚3                              â”‚</span><br><span class="line">â”‚                               â”‚4                              â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># -I</span></span><br><span class="line">$ xpanes -I@ -c <span class="string">'seq @'</span> 1 2 3 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># -c</span></span><br><span class="line">$ xpanes -c <span class="string">"ssh myuser@&#123;&#125;"</span> host1 host2</span><br><span class="line">$ xpanes -c <span class="string">"ssh -t &#123;&#125; bash -ci 'll'"</span> host-&#123;1,2,3&#125;</span><br><span class="line">$ xpanes -c <span class="string">"tail -f &#123;&#125;"</span> /var/<span class="built_in">log</span>/apache/&#123;error,access&#125;.<span class="built_in">log</span> /var/<span class="built_in">log</span>/application/&#123;error,access&#125;.<span class="built_in">log</span></span><br><span class="line">$ xpanes -c <span class="string">"ssh user@host tail -f &#123;&#125;"</span> /var/<span class="built_in">log</span>/apache/&#123;error,access&#125;.<span class="built_in">log</span> /var/<span class="built_in">log</span>/application/&#123;error,access&#125;.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>--ssh</code> é€‰é¡¹æœ‰åŠ©äºå¿½ç•¥ <code>openssh</code> çš„è­¦æŠ¥æ¶ˆæ¯ï¼Œå³ä¸éœ€è¦å›ç­”æ˜¯/å¦çš„é—®é¢˜ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢ä¸¤ä¸ªæ•ˆæœç­‰åŒ</span></span><br><span class="line">$ xpanes --ssh myuser1@host1 myuser2@host2</span><br><span class="line">$ xpanes -t -s -c <span class="string">"ssh -o StrictHostKeyChecking=no &#123;&#125;"</span> myuser1@host1 myuser2@host2</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>--log</code> é€‰é¡¹å¯ä»¥è®°å½• <code>SSH</code> è¿æ¥å¤šä¸ªä¸»æœºå¹¶è¿›è¡Œæ—¥å¿—æ“ä½œã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ xpanes --<span class="built_in">log</span>=~/operation_log -c <span class="string">"ssh &#123;&#125;"</span> user1@host1 user2@host2</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$ ssh user1@host1              â”‚ $ ssh user2@host2             â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line"></span><br><span class="line">$ ls ~/operation_log/</span><br><span class="line">user1@host1-1.log.2017-03-15_21-30-07</span><br><span class="line">user2@host2-1.log.2017-03-15_21-30-07</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>-s</code> é€‰é¡¹ï¼Œ<code>xpanes</code> å°†ä¸ä¼šåˆ›å»ºæ–°çš„äº¤äº’å¼ <code>shell</code> å‘½ä»¤ã€‚è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œæ‰“å¼€å¤šä¸ªæ–°çª—æ ¼éœ€è¦å¾ˆé•¿æ—¶é—´(é»˜è®¤ç™»å½• <code>shell</code> ä¼šåŠ è½½ <code>.zshrc</code> é…ç½®ç­‰äº‹æƒ…)ï¼Œä¸æƒ³åœ¨ <code>shell</code> å†å²è®°å½•ä¸­ç•™ä¸‹å‘½ä»¤ã€‚</li><li>å½“æ¯ä¸ªè¿›ç¨‹ç»“æŸæ—¶ï¼Œå°†æ˜¾ç¤º <strong>â€œçª—æ ¼å·²æ­»â€¦â€</strong> ä¹‹ç±»çš„ç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æœéœ€è¦ç¦ç”¨è¯¥æ¶ˆæ¯çš„è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ <code>-ss</code> ä»£æ›¿ <code>-s</code> æ¥è¿›è¡Œå±è”½ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ xpanes -s -c <span class="string">"seq &#123;&#125;"</span> 2 3 4 5</span><br><span class="line">+------------------------------------------+------------------------------------------+</span><br><span class="line">â”‚1                                         â”‚1                                         â”‚</span><br><span class="line">â”‚2                                         â”‚2                                         â”‚</span><br><span class="line">â”‚Pane is dead: Press [Enter] to <span class="built_in">exit</span>...    â”‚3                                         â”‚</span><br><span class="line">â”‚                                          â”‚Pane is dead: Press [Enter] to <span class="built_in">exit</span>...    â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">+------------------------------------------+------------------------------------------+</span><br><span class="line">â”‚1                                         â”‚1                                         â”‚</span><br><span class="line">â”‚2                                         â”‚2                                         â”‚</span><br><span class="line">â”‚3                                         â”‚3                                         â”‚</span><br><span class="line">â”‚4                                         â”‚4                                         â”‚</span><br><span class="line">â”‚Pane is dead: Press [Enter] to <span class="built_in">exit</span>...    â”‚5                                         â”‚</span><br><span class="line">â”‚                                          â”‚Pane is dead: Press [Enter] to <span class="built_in">exit</span>...    â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">+------------------------------------------+------------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># å±è”½ä¿¡æ¯</span></span><br><span class="line">$ xpanes -ss -c <span class="string">"seq &#123;&#125;"</span> 2 3 4 5</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>-t</code> å‚æ•°ï¼Œå¯ä»¥åœ¨æ¯ä¸ªçª—æ ¼è¾¹æ¡†ä¸Šæ˜¾ç¤ºæ¯ä¸ªå‚æ•°ã€‚å®ƒå«åšâ€œçª—æ ¼æ ‡é¢˜â€ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ‡é¢˜</span></span><br><span class="line">$ xpanes -t -c <span class="string">"ping &#123;&#125;"</span> 192.168.1.&#123;5..8&#125;</span><br><span class="line">+------------------------------------------+------------------------------------------+</span><br><span class="line">â”‚ping 192.168.1.5                          â”‚ping 192.168.1.6                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">+---192.168.1.5----------------------------+---192.168.1.6----------------------------+</span><br><span class="line">â”‚ping 192.168.1.7                          â”‚ping 192.168.1.8                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">â”‚                                          â”‚                                          â”‚</span><br><span class="line">+---192.168.1.7----------------------------+---192.168.1.8----------------------------+</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>-x</code> å‚æ•°ï¼Œå¯ä»¥åœ¨ç°æœ‰çª—å£ä¸Šåˆ›å»ºæ–°çª—æ ¼ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># before</span></span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$                              â”‚$                              â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚ $ xpanes -x 4 5 6                                             â”‚</span><br><span class="line">â”‚                                                               â”‚</span><br><span class="line">â”‚                                                               â”‚</span><br><span class="line">â”‚                                                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># after</span></span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$                              â”‚$                              â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$ xpanes -x 4 5 6              â”‚$ <span class="built_in">echo</span> 4                       â”‚</span><br><span class="line">â”‚$                              â”‚4                              â”‚</span><br><span class="line">â”‚                               â”‚$                              â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> 5                       â”‚$ <span class="built_in">echo</span> 6                       â”‚</span><br><span class="line">â”‚5                              â”‚6                              â”‚</span><br><span class="line">â”‚$                              â”‚$                              â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">+-------------------------------+-------------------------------+</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>-e</code> å‚æ•°ï¼Œå¯ä»¥åœ¨ä¸åŒçš„çª—æ ¼ä¸Šæ‰§è¡Œä¸åŒçš„å‘½ä»¤ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢ä¸¤ä¸ªæ•ˆæœç­‰åŒ</span></span><br><span class="line">$ xpanes -e <span class="string">"top"</span> <span class="string">"vmstat 1"</span> <span class="string">"watch -n 1 free"</span></span><br><span class="line">$ xpanes -I@ -c <span class="string">"@"</span> <span class="string">"top"</span> <span class="string">"vmstat 1"</span> <span class="string">"watch -n 1 free"</span></span><br><span class="line">+-------------------------------+------------------------------+</span><br><span class="line">â”‚$ top                          â”‚$ vmstat 1                    â”‚</span><br><span class="line">â”‚                               â”‚                              â”‚</span><br><span class="line">â”‚                               â”‚                              â”‚</span><br><span class="line">+-------------------------------+------------------------------+</span><br><span class="line">â”‚$ watch -n 1 free                                             â”‚</span><br><span class="line">â”‚                                                              â”‚</span><br><span class="line">â”‚                                                              â”‚</span><br><span class="line">+--------------------------------------------------------------+</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>-B</code> å‚æ•°ï¼Œå¯ä»¥å¯¹æ¯ä¸ªçª—æ ¼è¿›è¡Œé¢„å¤„ç†ï¼Œ<code>-B</code> é€‰é¡¹å…è®¸åœ¨å¤„ç† <code>-c</code> é€‰é¡¹ä¹‹å‰æ‰§è¡Œå¦ä¸€æ¡å‘½ä»¤ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ xpanes -B <span class="string">'echo Preprocessing'</span> -c <span class="string">'echo Test'</span> _</span><br><span class="line">+-------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> Preprocessing           â”‚</span><br><span class="line">â”‚Preprocessing                  â”‚</span><br><span class="line">â”‚$ <span class="built_in">echo</span> Test                    â”‚</span><br><span class="line">â”‚Test                           â”‚</span><br><span class="line">â”‚                               â”‚</span><br><span class="line">+-------------------------------+</span><br><span class="line"></span><br><span class="line">$ xpanes -B <span class="string">'echo Pre1'</span> -B <span class="string">'echo Pre2'</span> -B <span class="string">'echo Pre3'</span> -c <span class="string">'echo &#123;&#125;'</span> A B C D</span><br><span class="line">+-------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> Pre1                    â”‚$ <span class="built_in">echo</span> Pre1                   â”‚</span><br><span class="line">â”‚Pre1                           â”‚Pre1                          â”‚</span><br><span class="line">â”‚$ <span class="built_in">echo</span> Pre2                    â”‚$ <span class="built_in">echo</span> Pre2                   â”‚</span><br><span class="line">â”‚Pre2                           â”‚Pre2                          â”‚</span><br><span class="line">â”‚$ <span class="built_in">echo</span> Pre3                    â”‚$ <span class="built_in">echo</span> Pre3                   â”‚</span><br><span class="line">â”‚Pre3                           â”‚Pre3                          â”‚</span><br><span class="line">â”‚$ <span class="built_in">echo</span> A                       â”‚$ <span class="built_in">echo</span> B                      â”‚</span><br><span class="line">+-------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> Pre1                    â”‚$ <span class="built_in">echo</span> Pre1                   â”‚</span><br><span class="line">â”‚Pre1                           â”‚Pre1                          â”‚</span><br><span class="line">â”‚$ <span class="built_in">echo</span> Pre2                    â”‚$ <span class="built_in">echo</span> Pre2                   â”‚</span><br><span class="line">â”‚Pre2                           â”‚Pre2                          â”‚</span><br><span class="line">â”‚$ <span class="built_in">echo</span> Pre3                    â”‚$ <span class="built_in">echo</span> Pre3                   â”‚</span><br><span class="line">â”‚Pre3                           â”‚Pre3                          â”‚</span><br><span class="line">â”‚$ <span class="built_in">echo</span> C                       â”‚$ <span class="built_in">echo</span> D                      â”‚</span><br><span class="line">+-------------------------------+------------------------------+</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>-C</code> å’Œ <code>-R</code> å‚æ•°ï¼Œæ¥æ§åˆ¶çª—å£çš„åˆ—å’Œè¡Œã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ xpanes -C 2 AAA BBB CCC DDD</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> AAA                    â”‚$ <span class="built_in">echo</span> BBB                    â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> CCC                    â”‚$ <span class="built_in">echo</span> DDD                    â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line"></span><br><span class="line">$ xpanes -R 5 AAA BBB CCC DDD EEE FFF GGG HHH</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> AAA                    â”‚$ <span class="built_in">echo</span> BBB                    â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> CCC                    â”‚$ <span class="built_in">echo</span> DDD                    â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> EEE                    â”‚$ <span class="built_in">echo</span> FFF                    â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> GGG                                                   â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> HHH                                                   â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">+-------------------------------------------------------------+</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>--bulk-cols</code> å‚æ•°å¯ä»¥æ¥å—é€—å·åˆ†éš”çš„æ•°å­—ï¼Œæ¯ä¸ªæ•°å­—å¯¹åº”æ¯ä¸€è¡Œçš„åˆ—æ•°ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ xpanes --bulk-cols=1,3,1,2,5 &#123;A..L&#125;</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> A                                                     â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> B            â”‚$ <span class="built_in">echo</span> C            â”‚$ <span class="built_in">echo</span> D           â”‚</span><br><span class="line">â”‚                    â”‚                    â”‚                   â”‚</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> E                                                     â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> F                      â”‚$ <span class="built_in">echo</span> G                      â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> H     â”‚$ <span class="built_in">echo</span> I    â”‚$ <span class="built_in">echo</span> J    â”‚$ <span class="built_in">echo</span> K   â”‚$ <span class="built_in">echo</span> L â”‚</span><br><span class="line">â”‚             â”‚            â”‚            â”‚           â”‚         â”‚</span><br><span class="line">+-------------------------------------------------------------+</span><br></pre></td></tr></table></figure><ul><li>å½“ <code>xpanes</code> å‘½ä»¤æ¥å—æ ‡å‡†è¾“å…¥æ—¶ï¼Œå°†æ¿€æ´»ç®¡é“æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œ<code>xpanes</code> çš„è¡Œä¸ºç±»ä¼¼äº <code>UNIX</code> ç³»ç»Ÿçš„ <code>xargs</code> å‘½ä»¤ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ seq 3 | xpanes</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> 1                      â”‚$ <span class="built_in">echo</span> 2                      â”‚</span><br><span class="line">â”‚1                             â”‚2                             â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">â”‚                              â”‚                              â”‚</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line">â”‚$ <span class="built_in">echo</span> 3                                                     â”‚</span><br><span class="line">â”‚3                                                            â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">+------------------------------+------------------------------+</span><br><span class="line"></span><br><span class="line">$ seq 4 | xpanes seq</span><br><span class="line">$ seq 4 | xpanes -c <span class="string">'seq &#123;&#125;'</span></span><br><span class="line">$ cat ~/.ssh/config | awk <span class="string">'$1=="Host"&#123;print $2&#125;'</span> | xpanes ssh</span><br></pre></td></tr></table></figure><ul><li>æ¢å¤æ–­å¼€è¿æ¥çš„ä¼šè¯ï¼Œå³å‡ºç°å¼‚å¸¸æƒ…å†µçš„è¯ï¼Œç»ˆç«¯æ–­å¼€è¿æ¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>xpanes</code> æ¥æ¢å¤ <code>Tmux</code> ä¼šè¯ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æƒ…å†µä¼šåˆ›å»ºï¼š~/.cache/xpanes/socket.&lt;PID&gt;</span></span><br><span class="line">$ ls ~/.cache/xpanes/socket.*</span><br><span class="line">/home/user/.cache/xpanes/socket.1234</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼šè¯æ¢å¤</span></span><br><span class="line">$ tmux -S /home/user/.cache/xpanes/socket.1234 attach</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>-S</code> å‚æ•°ï¼Œä¸ä»–äººå…±äº«ç»ˆç«¯ä¼šè¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ä»–äººå…±äº«ç»ˆç«¯ä¼šè¯ - user1</span></span><br><span class="line">[user1@host] $ xpanes -S /home/user1/mysocket a b c d ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ä»–äººå…±äº«ç»ˆç«¯ä¼šè¯ - user2</span></span><br><span class="line">[user2@host] $ tmux -S /home/user1/mysocket attach</span><br></pre></td></tr></table></figure><h2><span id="ä¸€ä¸ªå½©è›‹">ä¸€ä¸ªå½©è›‹</span></h2><blockquote><p>Letâ€™s play!</p></blockquote><ul><li>terminal-parrot</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yes terminal-parrot | head -n 25 | xpanes -e</span><br></pre></td></tr></table></figure><p><img src="https://img.hi-linux.com/staticfile/learn-tmux-xpanes-tools-03-2021-07-09-O0WfZo.gif" alt="ä½¿ç”¨xpanesæ¥å¹¶å‘æ‰§è¡Œå‘½ä»¤ - terminal-parrot"></p><ul><li>sl</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yes <span class="string">'sl -l'</span> | head | xpanes -elev</span><br></pre></td></tr></table></figure><p><img src="https://img.hi-linux.com/staticfile/learn-tmux-xpanes-tools-02-2021-07-09-umfszo.gif" alt="ä½¿ç”¨xpanesæ¥å¹¶å‘æ‰§è¡Œå‘½ä»¤ - sl"></p><h2><span id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</span></h2><ul><li><a href="https://github.com/greymd/tmux-xpanes" target="_blank" rel="noopener">github tmux-xpanes</a></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Escape çš„åšå®¢]ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y6jrmejf" target="_blank" rel="noopener">https://tinyurl.com/y6jrmejf</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç”± Tmux æä¾›æ”¯æŒçš„ç»ˆæç»ˆç«¯åˆ†å±å™¨ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è™½ç„¶æˆ‘ä»¬å·²ç»å¯ä»¥ä½¿ç”¨ &lt;code&gt;tmux&lt;/code&gt; è¿›è¡Œå±å¹•çš„åˆ†å‰²å’Œåˆ‡æ¢ï¼Œä½†æ˜¯å¦‚æœéœ€è¦å¯¹ä¸€æ‰¹æœåŠ¡å™¨è¿›è¡Œæ“ä½œçš„è¯ï¼Œå°±åªèƒ½ä¸€ä¸ªä¸€ä¸ªçš„ç™»å½•å’Œæ‰§è¡Œäº†ã€‚å¦‚æœä½¿ç”¨è¿‡ &lt;code&gt;Xshell&lt;/code&gt; æˆ–è€…å…¶ä»–è¿œç¨‹å·¥å…·çš„è¯ï¼Œè‚¯å®šæ˜¯ä½¿ç”¨è¿‡è¿™ä¸ªåŠŸèƒ½ç‰¹æ€§çš„ï¼Œä¸€æ¬¡å‘½ä»¤è¾“å‡ºå¯ä»¥åœ¨ç™»å½•çš„å¤šä¸ªè¿œç¨‹ç»ˆç«¯ä¸Šé¢æ‰§è¡Œã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;tmux-xpanes&lt;/code&gt; æ¥å®ŒæˆåŒæ ·çš„äº‹æƒ…äº†ï¼Œæ’’èŠ±ï¼&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="æ•™ç¨‹" scheme="https://www.hi-linux.com/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="Xpanes" scheme="https://www.hi-linux.com/tags/Xpanes/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ¬¡ç”± Kubernetes HostPort å¼•å‘çš„æœåŠ¡æ•…éšœæ’é”™è®°å®</title>
    <link href="https://www.hi-linux.com/posts/43908.html"/>
    <id>https://www.hi-linux.com/posts/43908.html</id>
    <published>2021-08-03T01:00:00.000Z</published>
    <updated>2021-08-03T04:43:39.254Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>æœ€è¿‘æ’æŸ¥äº†ä¸€ä¸ª Kubernetes ä¸­ä½¿ç”¨äº† hostport åé‡åˆ°æ¯”è¾ƒå‘çš„é—®é¢˜ï¼Œå¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†ã€‚</p><h2><span id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</span></h2><p>é›†ç¾¤ç¯å¢ƒä¸º K8s v1.15.9ï¼Œcni æŒ‡å®šäº† flannel-vxlan è·Ÿ portmap, kube-proxy ä½¿ç”¨ mode ä¸º ipvsï¼Œé›†ç¾¤ 3 å° master,åŒæ—¶ä¹Ÿæ˜¯ nodeï¼Œè¿™é‡Œä»¥ node-1,node-2,node-3 æ¥è¡¨ç¤ºã€‚</p><p>é›†ç¾¤ä¸­æœ‰ 2 ä¸ª mysql, éƒ¨ç½²åœ¨ä¸¤ä¸ª ns ä¸‹ï¼Œmysql æœ¬èº«ä¸æ˜¯é—®é¢˜é‡ç‚¹ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´ï¼Œè¿™é‡Œä»¥ mysql-A,mysql-B æ¥è¡¨ç¤ºã€‚</p><p>mysql-A è½åœ¨ node-1 ä¸Šï¼Œmysql-B  è½åœ¨ node-2 ä¸Šï¼Œ <strong>ä¸¤ä¸ªæ•°æ®åº“svcåè·Ÿç”¨æˆ·ã€å¯†ç å®Œå…¨ä¸ç›¸åŒ</strong></p><a id="more"></a><p>å‡ºç°è¯¡å¼‚çš„ç°è±¡è¿™é‡Œä»¥ä¸€å¼ å›¾æ¥è¯´æ˜ä¼šæ¯”è¾ƒæ¸…æ¥šä¸€äº›:</p><p><img src="https://img.hi-linux.com/staticfile/20210729220711-2021-08-02-7dLd8i.png" alt></p><p>å…¶ä¸­ç»¿çº¿çš„è¡¨ç¤ºè®¿é—®æ²¡æœ‰é—®é¢˜ï¼Œçº¢çº¿è¡¨ç¤ºè¿æ¥Mysql-Aæç¤ºç”¨æˆ·åå¯†ç é”™è¯¯</p><p>ç‰¹åˆ«è¯¡å¼‚çš„æ˜¯ï¼Œå½“åœ¨ Node-2 ä¸Šé€šè¿‡ svc è®¿é—® Mysql-A æ—¶ï¼Œè¾“å…¥ Mysql-A çš„ç”¨æˆ·åè·Ÿå¯†ç æç¤ºå¯†ç é”™è¯¯ï¼Œå¯†ç ç¡®è®¤æ— ç–‘ï¼Œä½†å½“è¾“å…¥ Mysql-B çš„ç”¨æˆ·åè·Ÿå¯†ç ï¼Œå±…ç„¶èƒ½å¤Ÿè¿æ¥ä¸Šï¼Œçœ‹äº†ä¸‹æ•°æ®ï¼Œè¿ä¸Šçš„æ˜¯ Mysql-B çš„æ•°æ®åº“ï¼Œç»™äººçš„æ„Ÿè§‰å°±æ˜¯è¯·æ±‚è½¬åˆ°äº† Mysql-A, æœ€ååˆè½¬åˆ°äº† Mysql-Bï¼Œå½“æ—¶è®©äººå¤§è·Œçœ¼é•œã€‚</p><p>ç¢°åˆ°è¯¡å¼‚çš„é—®é¢˜é‚£å°±æ’æŸ¥å§ï¼Œæ’æŸ¥çš„è¿‡ç¨‹å€’æ˜¯ä¸è´¹ä»€ä¹ˆäº‹ï¼Œæœ€ä¸»è¦çš„æ˜¯è¦é€šè¿‡è¿™æ¬¡è¸©å‘æœºä¼šæŒ–æ˜ä¸€äº›å¥‡æ€ªçš„çŸ¥è¯†å‡ºæ¥ã€‚</p><h2><span id="æ’æŸ¥è¿‡ç¨‹">æ’æŸ¥è¿‡ç¨‹</span></h2><p>æ—¢ç„¶åœ¨ Node-1 ä¸Šè¿æ¥ Mysql-A/Mysql-B éƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‚£åŸºæœ¬å¯ä»¥æ’æŸ¥æ˜¯ Mysql-A çš„é—®é¢˜</p><p>ç»å®éªŒï¼Œåœ¨ Node-2 ä¸Šæ‰€æœ‰çš„æœåŠ¡æƒ³è¦è¿ Mysql-A æ—¶ï¼Œéƒ½æœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è®¿é—®å…¶å®ƒçš„æœåŠ¡åˆéƒ½æ²¡æœ‰é—®é¢˜ï¼Œè¯´æ˜è¦ä¹ˆæ˜¯ mysql-A çš„ 3306 è¿™ä¸ªç«¯å£æœ‰é—®é¢˜ï¼Œé€šè¿‡ä¸Šä¸€æ­¥åº”è¯¥æ’æŸ¥äº† mysql-A çš„é—®é¢˜ï¼Œé‚£é—®é¢˜åªèƒ½å‡ºåœ¨ Node-2 ä¸Š</p><p>åœ¨ k8s ä¸­åƒè¿™æ ·çš„è¯·æ±‚è½¬å‘å‡ºç°è¯¡å¼‚ç°è±¡ï¼Œå½“æ’é™¤äº†ä¸€äº›å¸¸è§çš„åŸå› ä¹‹å¤–ï¼Œæœ€å¤§çš„å«Œç–‘å°±æ˜¯ iptables äº†ï¼Œä½œè€…é‡åˆ°è¿‡å¤šæ¬¡</p><p>è¿™æ¬¡ä¹Ÿä¸ä¾‹å¤–ï¼Œè™½ç„¶å½“å‰é›†ç¾¤ä½¿ç”¨çš„ ipvsï¼Œ ä½†è¿˜æ˜¯ç…§ä¾‹çœ‹ä¸‹ iptables è§„åˆ™ï¼ŒæŸ¥çœ‹ Node-2 ä¸Šçš„ iptables ä¸ Node-1 çš„ iptables æ¯”å¯¹ï¼Œç»“æœæœ‰è¹Šè··, åœ¨ Node-2 ä¸Šå‘ç°æœ‰ä»¥ä¸‹çš„è§„åˆ™åœ¨å…¶å®ƒèŠ‚ç‚¹ä¸Šæ²¡æœ‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-A CNI-DN-xxxx -p tcp -m tcp --dport 3306 -j DNAT --to-destination 10.224.0.222:3306</span><br><span class="line">-A CNI-HOSTPORT-DNAT -m comment --comment &quot;dnat name&quot;: \&quot;cni0\&quot; id: \&quot;xxxxxxxxxxxxx\&quot;&quot; -j CNI-DN-xxx</span><br><span class="line">-A CNI-HOSTPORT-SNAT -m comment --comment &quot;snat name&quot;: \&quot;cni0\&quot; id: \&quot;xxxxxxxxxxxxx\&quot;&quot; -j CNI-SN-xxx</span><br><span class="line">-A CNI-SN-xxx -s 127.0.0.1&#x2F;32 -d 10.224.0.222&#x2F;32 -p tcp -m tcp --dport 80 -j MASQUERADE</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ 10.224.0.222 ä¸º Mysql-B çš„ pod ip, xxxxxxxxxxxxx ç»æŸ¥å®ä¸º Mysql-B å¯¹åº”çš„ pause å®¹å™¨çš„id</p><p>ä»ä¸Šé¢çš„è§„åˆ™æ€»ç»“ä¸€ä¸‹å°±æ˜¯ç›®çš„ä¸º 3306 ç«¯å£çš„è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ° 10.224.0.222 è¿™ä¸ªåœ°å€ï¼Œå³ Mysql-B</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½œè€…æ˜ç™½äº†ä¸ºä»€ä¹ˆåœ¨ Node-2 ä¸Šå»è®¿é—® Node-1 ä¸Š Mysql-A çš„ 3306 ä¼šæç¤ºå¯†ç é”™è¯¯è€Œè¾“å…¥ Mysql-B çš„å¯†ç å´å¯ä»¥æ­£å¸¸è®¿é—®</p><p>è™½ç„¶ä¸¤ä¸ª mysql çš„ svc åä¸ä¸€æ ·ï¼Œä½†ä¸Šé¢çš„ iptables åªè¦ç›®çš„ç«¯å£æ˜¯ 3306 å°±è½¬å‘åˆ° Mysql-B äº†ï¼Œå½“è¯·æ±‚åˆ°è¾¾ mysql åï¼Œä½¿ç”¨æ­£ç¡®çš„ç”¨æˆ·åå¯†ç è‡ªç„¶å¯ä»¥ç™»å½•æˆåŠŸ</p><p>åŸå› æ˜¯æ‰¾åˆ°äº†ï¼Œä½†æ˜¯åˆå¼•å‡ºæ¥äº†æ›´å¤šçš„é—®é¢˜?</p><ol><li>è¿™å‡ æ¡è§„åˆ™æ˜¯è°å…¥åˆ° iptables ä¸­çš„ï¼Ÿ</li><li>æ€ä¹ˆè§£å†³å‘¢ï¼Œæ˜¯ä¸æ˜¯åˆ æ‰å°±å¯ä»¥?</li></ol><h2><span id="é—®é¢˜å¤ç°">é—®é¢˜å¤ç°</span></h2><p>åŒæ ·æ˜¯ Mysqlï¼Œä¸ºä½• Mysql-A æ²¡æœ‰å‘¢? é‚£ä¹ˆæ¯”å¯¹ä¸€ä¸‹è¿™ä¸¤ä¸ª Mysql çš„éƒ¨ç½²å·®å¼‚</p><p>æ¯”å¯¹å‘ç°, é™¤äº†ç”¨æˆ·åå¯†ç ï¼Œns ä¸ä¸€æ ·å¤–ï¼ŒMysql-B éƒ¨ç½²æ—¶ä½¿ç”¨äº† hostPort=3306, å…¶å®ƒçš„å¹¶æ— å¼‚å¸¸</p><p>éš¾é“æ˜¯å› ä¸º hostPort ï¼Ÿ</p><p>ä½œè€…æ—¥å¸¸ä¼šä½¿ç”¨ NodePortï¼Œå€’å´æ˜¯æ²¡æ€ä¹ˆåœ¨æ„ hostPort,ä¹Ÿå°±åœç•™åœ¨ hostPort è·Ÿ NodePort çš„å·®åˆ«åœ¨äº NodePort æ˜¯æ‰€æœ‰ Node ä¸Šéƒ½ä¼šå¼€å¯ç«¯å£ï¼Œè€Œ hostPort åªä¼šåœ¨è¿è¡Œæœºå™¨ä¸Šå¼€å¯ç«¯å£ï¼Œç”±äº hostPort ä½¿ç”¨çš„ä¹Ÿå°‘ï¼Œä¹Ÿå°±æ²¡å¤ªå¤šå…³æ³¨ï¼Œç½‘ä¸ŠçŸ­æš‚æœäº†ä¸€ç•ªï¼Œæè¿°çš„ä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œçœ‹èµ·æ¥å¤§å®¶ä¹Ÿç”¨çš„ä¸å¤š</p><p>é‚£åˆ°åº•æ˜¯ä¸æ˜¯å› ä¸º hostPort å‘¢?</p><p><strong>Talk is cheap, show me the code</strong></p><p>é€šè¿‡å®éªŒæ¥éªŒè¯ï¼Œè¿™é‡Œç®€å•ä½¿ç”¨äº†ä¸‰ä¸ªnginxæ¥è¯´æ˜é—®é¢˜, å…¶ä¸­ä¸¤ä¸ªä½¿ç”¨äº† hostPortï¼Œè¿™é‡Œç‰¹æ„æŒ‡å®šäº†ä¸åŒçš„ç«¯å£ï¼Œå…¶å®ƒçš„éƒ½å®Œå…¨ä¸€æ ·ï¼Œå‘å¸ƒåˆ°é›†ç¾¤ä¸­ï¼Œyaml æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-hostport2</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: nginx-hostport2</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: nginx-hostport2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: nginx-hostport2</span><br><span class="line">    spec:</span><br><span class="line">      nodeName: spring-38</span><br><span class="line">      containers:</span><br><span class="line">        - name: nginx</span><br><span class="line">          image: nginx:latest</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">              hostPort: 31123</span><br></pre></td></tr></table></figure><p>Finally,é—®é¢˜å¤ç°:</p><p><img src="https://img.hi-linux.com/staticfile/20210728133243-2021-08-02-FIx5Us.png" alt></p><p>å¯ä»¥è‚¯å®šï¼Œè¿™äº›è§„åˆ™å°±æ˜¯å› ä¸ºä½¿ç”¨äº† hostPort è€Œå†™å…¥çš„,ä½†æ˜¯ <strong>ç”±è°å†™å…¥çš„è¿™ä¸ªé—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³?</strong></p><h2><span id="ç½ªé­ç¥¸é¦–">ç½ªé­ç¥¸é¦–</span></h2><p>ä½œè€…å¼€å§‹ä»¥ä¸ºè¿™äº› iptables è§„åˆ™æ˜¯ç”± kube-proxy å†™å…¥çš„, ä½†æ˜¯æŸ¥çœ‹ kubelet çš„æºç å¹¶æœªå‘ç°ä¸Šè¿°è§„åˆ™çš„å…³é”®å­—</p><p>å†æ¬¡å®éªŒåŠç»“åˆç½‘ä¸Šçš„æ¢ç´¢ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹ç»“è®º:</p><p>é¦–å…ˆä» kubernetes çš„å®˜æ–¹å‘ç°ä»¥ä¸‹æè¿°:</p><blockquote><p>The CNI networking plugin supports <code>hostPort</code>. You can use the official <a href="https://github.com/containernetworking/plugins/tree/master/plugins/meta/portmap" target="_blank" rel="noopener">portmap</a> plugin offered by the CNI plugin team or use your own plugin with portMapping functionality.</p></blockquote><blockquote><p>If you want to enable <code>hostPort</code> support, you must specify <code>portMappings capability</code> in your <code>cni-conf-dir</code>. For example:<br>{<br>â€œnameâ€: â€œk8s-pod-networkâ€,<br>â€œcniVersionâ€: â€œ0.3.0â€,<br>â€œpluginsâ€: [<br>{<br># â€¦å…¶å®ƒçš„plugin<br>}<br>{<br>â€œtypeâ€: â€œportmapâ€,<br>â€œcapabilitiesâ€: {â€œportMappingsâ€: true}<br>}<br>]<br>}</p><p>å‚è€ƒ: <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/</a></p></blockquote><p><strong>ä¹Ÿå°±æ˜¯å¦‚æœä½¿ç”¨äº† hostPortï¼Œ æ˜¯ç”± portmap è¿™ä¸ª cni æä¾› portMapping èƒ½åŠ›ï¼ŒåŒæ—¶ï¼Œå¦‚æœæƒ³ä½¿ç”¨è¿™ä¸ªèƒ½åŠ›ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ä¸€å®šéœ€è¦å¼€å¯ portmapï¼Œè¿™ä¸ªåœ¨ä½œè€…çš„é›†ç¾¤ä¸­ä¹Ÿå¼€å¯äº†ï¼Œè¿™ç‚¹å¯¹åº”ä¸Šäº†</strong></p><p>å¦å¤–ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç»“è®ºæ˜¯:</p><blockquote><p>The CNI â€˜portmapâ€™ plugin, used to setup HostPorts for CNI, inserts rules at the front of the iptables nat chains; which take precedence over the KUBE- SERVICES chain. Because of this, the HostPort/portmap rule could match incoming traffic even if there were better fitting, more specific service definition rules like NodePorts later in the chain</p><p>å‚è€ƒ: <a href="https://ubuntu.com/security/CVE-2019-9946" target="_blank" rel="noopener">https://ubuntu.com/security/CVE-2019-9946</a></p></blockquote><p><strong>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ä½¿ç”¨ hostPort åï¼Œä¼šåœ¨ iptables çš„ nat é“¾ä¸­æ’å…¥ç›¸åº”çš„è§„åˆ™ï¼Œè€Œä¸”è¿™äº›è§„åˆ™æ˜¯åœ¨ KUBE- SERVICES è§„åˆ™ä¹‹å‰æ’å…¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä¼˜å…ˆåŒ¹é… hostPort çš„è§„åˆ™ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ NodePort è§„åˆ™å…¶å®æ˜¯åœ¨ KUBE- SERVICES ä¹‹ä¸­ï¼Œä¹Ÿæ’åœ¨å…¶å</strong></p><p>ä» portmap çš„æºç ä¸­æœç„¶æ˜¯å¯ä»¥çœ‹åˆ°ç›¸åº”çš„ä»£ç </p><p><img src="https://img.hi-linux.com/staticfile/20210729225847-2021-08-02-aHFg9f.png" alt></p><p>æ„Ÿå…´è¶£çš„å¯ä»¥çš„<a href="https://github.com/containernetworking/plugins.git" target="_blank" rel="noopener"> plugins </a>é¡¹ç›®çš„ meta/portmap/portmap.go ä¸­æŸ¥çœ‹å®Œæ•´çš„æºç </p><p>æ‰€ä»¥ï¼Œ<strong>æœ€ç»ˆæ˜¯è°ƒç”¨portmapå†™å…¥çš„è¿™äº›è§„åˆ™.</strong></p><h2><span id="ç«¯å£å ç”¨">ç«¯å£å ç”¨</span></h2><p>è¿›ä¸€æ­¥å®éªŒå‘ç°ï¼Œhostport å¯ä»¥é€šè¿‡ iptables å‘½ä»¤æŸ¥çœ‹åˆ°ï¼Œ ä½†æ˜¯æ— æ³•åœ¨ ipvsadm ä¸­æŸ¥çœ‹åˆ°</p><p><strong>ä½¿ç”¨ lsof/netstat ä¹ŸæŸ¥çœ‹ä¸åˆ°è¿™ä¸ªç«¯å£,è¿™æ˜¯å› ä¸º hostport æ˜¯é€šè¿‡ iptables å¯¹è¯·æ±‚ä¸­çš„ç›®çš„ç«¯å£è¿›è¡Œè½¬å‘çš„ï¼Œå¹¶ä¸æ˜¯åœ¨ä¸»æœºä¸Šé€šè¿‡ç«¯å£ç›‘å¬</strong></p><p><img src="https://img.hi-linux.com/staticfile/20210728133203-2021-08-02-TYPI7H.png" alt></p><p>æ—¢ç„¶ lsof è·Ÿ netstat éƒ½æŸ¥ä¸åˆ°ç«¯å£ä¿¡æ¯ï¼Œé‚£è¿™ä¸ªç«¯å£ç›¸å½“äºæ²¡æœ‰å¤„äº listen çŠ¶æ€?</p><p>å¦‚æœè¿™æ—¶å†éƒ¨ç½²ä¸€ä¸ª hostport æŒ‡å®šç›¸åŒç«¯å£çš„åº”ç”¨ä¼šæ€ä¹ˆæ ·å‘¢?</p><p>ç»“è®ºæ˜¯: <strong>ä½¿ç”¨ hostPort çš„åº”ç”¨åœ¨è°ƒåº¦æ—¶æ— æ³•è°ƒåº¦åœ¨å·²ç»ä½¿ç”¨è¿‡ç›¸åŒ hostPort çš„ä¸»æœºä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è°ƒåº¦æ—¶ä¼šè€ƒè™‘ hostport</strong></p><p>å¦‚æœå¼ºè¡Œè®©å…¶è°ƒåº¦åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼Œå¦‚æœä¸åˆ é™¤çš„è¯ï¼Œè¿™æ ·çš„é”™è¯¯ä¼šè¶Šæ¥è¶Šå¤šï¼Œå“çš„ä½œè€…èµ¶ç´§åˆ äº†.</p><p><img src="https://img.hi-linux.com/staticfile/20210728132630-2021-08-02-B7YGwm.png" alt></p><p>å¦‚æœè¿™ä¸ªæ—¶å€™åˆ›å»ºä¸€ä¸ª nodePort ç±»å‹çš„ svcï¼Œ ç«¯å£ä¹Ÿä¸º 31123,ç»“æœä¼šæ€ä¹ˆæ ·å‘¢?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-nodeport2</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: nginx-nodeport2</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: nginx-nodeport2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: nginx-nodeport2</span><br><span class="line">    spec:</span><br><span class="line">      nodeName: spring-38</span><br><span class="line">      containers:</span><br><span class="line">        - name: nginx</span><br><span class="line">          image: nginx:latest</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-nodeport2</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 31123</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: nginx-nodeport2</span><br></pre></td></tr></table></figure><p><img src="https://img.hi-linux.com/staticfile/20210728133425-2021-08-02-Tsej5S.png" alt></p><p>å¯ä»¥å‘ç°ï¼ŒNodePort æ˜¯å¯ä»¥æˆåŠŸåˆ›å»ºçš„ï¼ŒåŒæ—¶ç›‘å¬çš„ç«¯å£ä¹Ÿå‡ºç°äº†.</p><p><strong>ä»è¿™ä¹Ÿå¯ä»¥è¯´æ˜ä½¿ç”¨ hostposrt æŒ‡å®šçš„ç«¯å£å¹¶æ²¡æœ‰ listen ä¸»æœºçš„ç«¯å£ï¼Œè¦ä¸ç„¶è¿™é‡Œå°±ä¼šæç¤ºç«¯å£é‡å¤ä¹‹ç±»</strong></p><p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼ŒåŒä¸€å°æœºå™¨ä¸ŠåŒæ—¶å­˜åœ¨æœ‰ hostPort è·Ÿ nodePort çš„ç«¯å£ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœ curl 31123 æ—¶ï¼Œ è®¿é—®çš„æ˜¯å“ªä¸€ä¸ªå‘¢?</p><p>ç»å¤šæ¬¡ä½¿ç”¨ curl è¯·æ±‚åï¼Œå‡æ˜¯ä½¿ç”¨äº† hostport é‚£ä¸ª nginx pod æ”¶åˆ°è¯·æ±‚</p><p><strong>åŸå› è¿˜æ˜¯å› ä¸º KUBE-NODE-PORT è§„åˆ™åœ¨ KUBE-SERVICE çš„é“¾ä¸­æ˜¯å¤„äºæœ€åä½ç½®ï¼Œè€Œ hostPort é€šè¿‡ portmap å†™å…¥çš„è§„åˆ™æ’åœ¨å…¶ä¹‹å‰</strong></p><p><img src="https://img.hi-linux.com/staticfile/20210728142725-2021-08-02-JE3uRL.png" alt></p><p>å› æ­¤ä¼šå…ˆåŒ¹é…åˆ° hostport çš„è§„åˆ™ï¼Œè‡ªç„¶è¯·æ±‚å°±è¢«è½¬åˆ° hostport æ‰€åœ¨çš„ pod ä¸­ï¼Œè¿™ä¸¤è€…çš„é¡ºåºæ˜¯æ²¡åŠæ³•æ”¹å˜çš„ï¼Œå› æ­¤æ— è®ºæ˜¯ hostport çš„åº”ç”¨å‘å¸ƒåœ¨å‰è¿˜æ˜¯åœ¨åéƒ½æ— æ³•å½±å“è¯·æ±‚è½¬å‘</p><p>å¦å¤–å†æä¸€ä¸‹ï¼Œ<strong>hostport çš„è§„åˆ™åœ¨ ipvsadm ä¸­æ˜¯æŸ¥è¯¢ä¸åˆ°çš„ï¼Œè€Œ nodePort çš„è§„åˆ™åˆ™æ˜¯å¯ä»¥ä½¿ç”¨ ipvsadm æŸ¥è¯¢å¾—åˆ°</strong></p><h2><span id="é—®é¢˜è§£å†³">é—®é¢˜è§£å†³</span></h2><p>è¦æƒ³æŠŠè¿™äº›è§„åˆ™åˆ é™¤ï¼Œå¯ä»¥ç›´æ¥å°† hostport å»æ‰ï¼Œé‚£ä¹ˆè§„åˆ™å°±ä¼šéšç€åˆ é™¤,æ¯”å¦‚ä¸‹å›¾ä¸­å»æ‰äº†ä¸€ä¸ª nginx çš„ hostport</p><p><img src="https://img.hi-linux.com/staticfile/20210727230931-2021-08-02-DHTY1f.png" alt></p><p>å¦å¤–ä½¿ç”¨è¾ƒå¤šçš„ port-forward ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œç«¯å£è½¬å‘çš„ï¼Œå®ƒåˆæ˜¯ä¸ªä»€ä¹ˆæƒ…å†µå‘¢? å®ƒå…¶å®ä½¿ç”¨çš„æ˜¯ socat åŠ netenter å·¥å…·ï¼Œç½‘ä¸Šçœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸç†å†™çš„æŒºå¥½çš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸€çœ‹</p><blockquote><p>å‚è€ƒ: <a href="https://vflong.github.io/sre/k8s/2020/03/15/how-the-kubectl-port-forward-command-works.html" target="_blank" rel="noopener">https://vflong.github.io/sre/k8s/2020/03/15/how-the-kubectl-port-forward-command-works.html</a></p></blockquote><h2><span id="ç”Ÿäº§å»ºè®®">ç”Ÿäº§å»ºè®®</span></h2><p>ä¸€å¥è¯ï¼Œç”Ÿäº§ç¯å¢ƒé™¤éæ˜¯ <strong>å¿…è¦ä¸”æ— ä»–æ³•</strong>ï¼Œä¸ç„¶<strong>ä¸€å®šä¸è¦ä½¿ç”¨hostport</strong>ï¼Œé™¤äº†ä¼šå½±å“è°ƒåº¦ç»“æœä¹‹å¤–ï¼Œè¿˜ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜ï¼Œå¯èƒ½é€ æˆçš„åæœæ˜¯éå¸¸ä¸¥é‡çš„ã€‚</p><h2><span id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </span></h2><ul><li><a href="https://www.qikqiak.com/post/how-to-use-ipvs-in-kubernetes/" target="_blank" rel="noopener">https://www.qikqiak.com/post/how-to-use-ipvs-in-kubernetes/</a></li><li><a href="https://serenafeng.github.io/2020/03/26/kube-proxy-in-iptables-mode/" target="_blank" rel="noopener">https://serenafeng.github.io/2020/03/26/kube-proxy-in-iptables-mode/</a></li><li><a href="https://zhuanlan.zhihu.com/p/94418251" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/94418251</a></li><li><a href="https://ronaknathani.com/blog/2020/07/kubernetes-nodeport-and-iptables-rules/" target="_blank" rel="noopener">https://ronaknathani.com/blog/2020/07/kubernetes-nodeport-and-iptables-rules/</a></li><li><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/</a></li><li><a href="https://vflong.github.io/sre/k8s/2020/03/15/how-the-kubectl-port-forward-command-works.html" target="_blank" rel="noopener">https://vflong.github.io/sre/k8s/2020/03/15/how-the-kubectl-port-forward-command-works.html</a></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Z.S.K.'s Records ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/35dczb5d" target="_blank" rel="noopener">https://tinyurl.com/35dczb5d</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æ’æŸ¥äº†ä¸€ä¸ª Kubernetes ä¸­ä½¿ç”¨äº† hostport åé‡åˆ°æ¯”è¾ƒå‘çš„é—®é¢˜ï¼Œå¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é—®é¢˜èƒŒæ™¯&quot;&gt;é—®é¢˜èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;é›†ç¾¤ç¯å¢ƒä¸º K8s v1.15.9ï¼Œcni æŒ‡å®šäº† flannel-vxlan è·Ÿ portmap, kube-proxy ä½¿ç”¨ mode ä¸º ipvsï¼Œé›†ç¾¤ 3 å° master,åŒæ—¶ä¹Ÿæ˜¯ nodeï¼Œè¿™é‡Œä»¥ node-1,node-2,node-3 æ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤ä¸­æœ‰ 2 ä¸ª mysql, éƒ¨ç½²åœ¨ä¸¤ä¸ª ns ä¸‹ï¼Œmysql æœ¬èº«ä¸æ˜¯é—®é¢˜é‡ç‚¹ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´ï¼Œè¿™é‡Œä»¥ mysql-A,mysql-B æ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;mysql-A è½åœ¨ node-1 ä¸Šï¼Œmysql-B  è½åœ¨ node-2 ä¸Šï¼Œ &lt;strong&gt;ä¸¤ä¸ªæ•°æ®åº“svcåè·Ÿç”¨æˆ·ã€å¯†ç å®Œå…¨ä¸ç›¸åŒ&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="æ•™ç¨‹" scheme="https://www.hi-linux.com/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>å†è§ Kubernetesï¼Œæ˜¯æ—¶å€™æ‹¥æŠ±ä¸‹ä¸€ä»£è½»é‡çº§å®¹å™¨ç¼–æ’å¹³å° K0s äº†ï¼</title>
    <link href="https://www.hi-linux.com/posts/9354.html"/>
    <id>https://www.hi-linux.com/posts/9354.html</id>
    <published>2021-08-02T01:00:00.000Z</published>
    <updated>2021-08-02T01:39:16.131Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p>æœ€è¿‘ä¸¤å¹´ä¸€ç›´åœ¨ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes é›†ç¾¤ï¼Œæ€»ä½“æ¥è¯´é…åˆä¸€äº›è‡ªå·±å°è„šæœ¬è¿˜æœ‰ä¸€äº›è‡ªåŠ¨åŒ–å·¥å…·è¿˜ç®—æ˜¯æ–¹ä¾¿ï¼›ä½†æ˜¯å…¨å®¹å™¨åŒ–ç¨³å®šæ€§ç¡®å®æ‹…å¿§ï¼Œä¹Ÿé‡åˆ°è¿‡è«åå…¶å¦™çš„è¯ä¹¦è¿‡æœŸé”™è¯¯ï¼Œæœ€åé‡å¯å¤§æ³•è§£å†³è¿™ç§é—®é¢˜ï¼›æ‰€ä»¥ä¹Ÿåœ¨æ¢ç´¢æ¯”è¾ƒæ–¹ä¾¿çš„äºŒè¿›åˆ¶éƒ¨ç½²æ–¹å¼ï¼Œæ¯”å¦‚è¿™ä¸ª k0sã€‚</p></blockquote><h2><span id="k0s-ä»‹ç»">k0s ä»‹ç»</span></h2><blockquote><p>The Simple, Solid &amp; Certified Kubernetes Distribution.</p></blockquote><p>k0s å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªä¸‹æ¸¸çš„ Kubernetes å‘è¡Œç‰ˆï¼Œä¸åŸç”Ÿ Kubernetes ç›¸æ¯”ï¼Œk0s å¹¶æœªé˜‰å‰²å¤§é‡ Kubernetes åŠŸèƒ½ï¼›k0s ä¸»è¦é˜‰å‰²éƒ¨åˆ†åŸºæœ¬ä¸Šåªæœ‰ <strong>æ ‘å†… Cloud provider</strong>ï¼Œå…¶ä»–çš„éƒ½ä¸åŸç”Ÿ Kubernetes ç›¸åŒã€‚</p><p><strong>k0s è‡ªè¡Œç¼–è¯‘ Kubernetes æºç ç”Ÿæˆ Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶ååœ¨å®‰è£…åå°†äºŒè¿›åˆ¶æ–‡ä»¶é‡Šæ”¾åˆ°å®¿ä¸»æœºå†å¯åŠ¨ï¼›è¿™ç§æƒ…å†µä¸‹æ‰€æœ‰åŠŸèƒ½å‡ ä¹ä¸åŸç”Ÿ Kubernetes æ²¡æœ‰å·®å¼‚ã€‚</strong></p><h2><span id="k0sctl-ä½¿ç”¨">k0sctl ä½¿ç”¨</span></h2><p>k0sctl æ˜¯ k0s ä¸ºäº†æ–¹ä¾¿å¿«é€Ÿéƒ¨ç½²é›†ç¾¤æ‰€æä¾›çš„å·¥å…·ï¼Œæœ‰ç‚¹ç±»ä¼¼äº kubeadmï¼Œä½†æ˜¯å…¶æ‰©å±•æ€§è¦æ¯” kubeadm å¥½å¾—å¤šã€‚åœ¨å¤šèŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œk0sctl é€šè¿‡ ssh è¿æ¥ç›®æ ‡ä¸»æœºç„¶åæŒ‰ç…§æ­¥éª¤é‡Šæ”¾æ–‡ä»¶å¹¶å¯åŠ¨ Kubernetes ç›¸å…³æœåŠ¡ï¼Œä»è€Œå®Œæˆé›†ç¾¤åˆå§‹åŒ–ã€‚</p><a id="more"></a><h3><span id="21-ä½¿ç”¨-k0sctl-å®‰è£…é›†ç¾¤">2.1 ä½¿ç”¨ k0sctl å®‰è£…é›†ç¾¤</span></h3><p>å®‰è£…è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ä¸‹è½½ç›¸å…³é•œåƒï¼Œéœ€è¦ä¿è¯æ‰€æœ‰èŠ‚ç‚¹å¯ä»¥ç§‘å­¦ä¸Šç½‘ï¼Œå¦‚ä½•ç¦»çº¿å®‰è£…æˆ‘ä»¬åé¢è®²è§£ã€‚<strong>å®‰è£…å‰ï¼Œä½ éœ€è¦ä¿è¯ç›®æ ‡æœºå™¨çš„ hostname ä¸ºéåŸŸåå½¢å¼ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚</strong> ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å¯åŠ¨é›†ç¾¤ç¤ºä¾‹:</p><ul><li>é¦–å…ˆå®‰è£… k0sctl</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£… k0sctl</span><br><span class="line">$ wget https:&#x2F;&#x2F;github.com&#x2F;k0sproject&#x2F;k0sctl&#x2F;releases&#x2F;download&#x2F;v0.9.0&#x2F;k0sctl-linux-x64</span><br><span class="line">$ chmod +x k0sctl-linux-x64</span><br><span class="line">$ mv k0sctl-linux-x64 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k0sctl</span><br></pre></td></tr></table></figure><ul><li>ç„¶åç¼–å†™ k0sctl.yaml é…ç½®æ–‡ä»¶</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">$ vi k0sctl.yaml</span><br><span class="line"></span><br><span class="line">apiVersion: k0sctl.k0sproject.io&#x2F;v1beta1</span><br><span class="line">kind: Cluster</span><br><span class="line">metadata:</span><br><span class="line">  name: k0s-cluster</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.11</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.12</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.13</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.14</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: worker</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.15</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: worker</span><br><span class="line">  k0s:</span><br><span class="line">    version: 1.21.2+k0s.1</span><br><span class="line">    config:</span><br><span class="line">      apiVersion: k0s.k0sproject.io&#x2F;v1beta1</span><br><span class="line">      kind: Cluster</span><br><span class="line">      metadata:</span><br><span class="line">        name: k0s</span><br><span class="line">      spec:</span><br><span class="line">        api:</span><br><span class="line">          address: 10.0.0.11</span><br><span class="line">          port: 6443</span><br><span class="line">          k0sApiPort: 9443</span><br><span class="line">          sans:</span><br><span class="line">          - 10.0.0.11</span><br><span class="line">          - 10.0.0.12</span><br><span class="line">          - 10.0.0.13</span><br><span class="line">        storage:</span><br><span class="line">          type: etcd</span><br><span class="line">          etcd:</span><br><span class="line">            peerAddress: 10.0.0.11</span><br><span class="line">        network:</span><br><span class="line">          kubeProxy:</span><br><span class="line">            disabled: false</span><br><span class="line">            mode: ipvs</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>k0sctl init --k0s  &gt; k0sctl.yaml</code> å‘½ä»¤ç›´æ¥ç”Ÿæˆã€‚</p><ul><li>æœ€åæ‰§è¡Œ <code>k0sctl apply</code> å‘½ä»¤å®‰è£…å³å¯</li></ul><blockquote><p>å®‰è£…å‰ç¡®ä¿ä½ çš„æ“ä½œæœºå™¨å¯ä»¥ SSH å…å¯†ç™»é™†æ‰€æœ‰ç›®æ ‡æœºå™¨ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ k0sctl apply -c k0sctl.yaml</span><br><span class="line"></span><br><span class="line">â €â£¿â£¿â¡‡â €â €â¢€â£´â£¾â£¿â Ÿâ â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ›â â €â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â €â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ</span><br><span class="line">â €â£¿â£¿â¡‡â£ â£¶â£¿â¡¿â ‹â €â €â €â¢¸â£¿â¡‡â €â €â €â£ â €â €â¢€â£ â¡†â¢¸â£¿â£¿â €â €â €â €â €â €â €â €â €â €â–ˆâ–ˆâ–ˆ          â–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆ</span><br><span class="line">â €â£¿â£¿â£¿â£¿â£Ÿâ ‹â €â €â €â €â €â¢¸â£¿â¡‡â €â¢°â£¾â£¿â €â €â£¿â£¿â¡‡â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â €â–ˆâ–ˆâ–ˆ          â–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆ</span><br><span class="line">â €â£¿â£¿â¡â »â£¿â£·â£¤â¡€â €â €â €â ¸â ›â â €â ¸â ‹â â €â €â£¿â£¿â¡‡â ˆâ ‰â ‰â ‰â ‰â ‰â ‰â ‰â ‰â¢¹â£¿â£¿â €â–ˆâ–ˆâ–ˆ          â–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆ</span><br><span class="line">â €â£¿â£¿â¡‡â €â €â ™â¢¿â£¿â£¦â£€â €â €â €â£ â£¶â£¶â£¶â£¶â£¶â£¶â£¿â£¿â¡‡â¢°â£¶â£¶â£¶â£¶â£¶â£¶â£¶â£¶â£¾â£¿â£¿â €â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><br><span class="line"></span><br><span class="line">k0sctl 0.0.0 Copyright 2021, k0sctl authors.</span><br><span class="line">Anonymized telemetry of usage will be sent to the authors.</span><br><span class="line">By continuing to use k0sctl you agree to these terms:</span><br><span class="line">https:&#x2F;&#x2F;k0sproject.io&#x2F;licenses&#x2F;eula</span><br><span class="line">INFO &#x3D;&#x3D;&gt; Running phase: Connect to hosts</span><br><span class="line">INFO [ssh] 10.0.0.15:22: connected</span><br><span class="line">INFO [ssh] 10.0.0.11:22: connected</span><br><span class="line">INFO [ssh] 10.0.0.12:22: connected</span><br><span class="line">INFO [ssh] 10.0.0.14:22: connected</span><br><span class="line">INFO [ssh] 10.0.0.13:22: connected</span><br><span class="line">INFO &#x3D;&#x3D;&gt; Running phase: Detect host operating systems</span><br><span class="line">INFO [ssh] 10.0.0.11:22: is running Ubuntu 20.04.2 LTS</span><br><span class="line">INFO [ssh] 10.0.0.12:22: is running Ubuntu 20.04.2 LTS</span><br><span class="line">INFO [ssh] 10.0.0.14:22: is running Ubuntu 20.04.2 LTS</span><br><span class="line">INFO [ssh] 10.0.0.13:22: is running Ubuntu 20.04.2 LTS</span><br><span class="line">INFO [ssh] 10.0.0.15:22: is running Ubuntu 20.04.2 LTS</span><br><span class="line">INFO &#x3D;&#x3D;&gt; Running phase: Prepare hosts</span><br><span class="line">INFO &#x3D;&#x3D;&gt; Running phase: Gather host facts</span><br><span class="line">INFO [ssh] 10.0.0.11:22: discovered ens33 as private interface</span><br><span class="line">INFO [ssh] 10.0.0.13:22: discovered ens33 as private interface</span><br><span class="line">INFO [ssh] 10.0.0.12:22: discovered ens33 as private interface</span><br><span class="line">INFO &#x3D;&#x3D;&gt; Running phase: Download k0s on hosts</span><br><span class="line">INFO [ssh] 10.0.0.11:22: downloading k0s 1.21.2+k0s.1</span><br><span class="line">INFO [ssh] 10.0.0.13:22: downloading k0s 1.21.2+k0s.1</span><br><span class="line">INFO [ssh] 10.0.0.12:22: downloading k0s 1.21.2+k0s.1</span><br><span class="line">INFO [ssh] 10.0.0.15:22: downloading k0s 1.21.2+k0s.1</span><br><span class="line">INFO [ssh] 10.0.0.14:22: downloading k0s 1.21.2+k0s.1</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>ç¨ç­‰ç‰‡åˆ»åå¸¦æœ‰ä¸‰ä¸ª Master å’Œä¸¤ä¸ª Node çš„é›†ç¾¤å°†å®‰è£…å®Œæˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ k1.node âœ ~ k0s kubectl get node -o wide</span><br><span class="line">NAME      STATUS   ROLES    AGE   VERSION       INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME</span><br><span class="line">k1.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.11     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd:&#x2F;&#x2F;1.4.6</span><br><span class="line">k2.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.12     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd:&#x2F;&#x2F;1.4.6</span><br><span class="line">k3.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.13     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd:&#x2F;&#x2F;1.4.6</span><br><span class="line">k4.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.14     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd:&#x2F;&#x2F;1.4.6</span><br><span class="line">k5.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.15     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd:&#x2F;&#x2F;1.4.6</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„: ç›®æ ‡æœºå™¨ hostname ä¸åº”å½“ä¸ºåŸŸåå½¢å¼ï¼Œè¿™é‡Œçš„æ ·ä¾‹æ˜¯å·²ç»ä¿®å¤äº†è¿™ä¸ªé—®é¢˜</p></blockquote><h3><span id="22-k0sctl-çš„æ‰©å±•æ–¹å¼">2.2 k0sctl çš„æ‰©å±•æ–¹å¼</span></h3><p>ä¸ kubeadm ä¸åŒï¼Œk0sctl å‡ ä¹æä¾›äº†æ‰€æœ‰å®‰è£…ç»†èŠ‚çš„å¯å®šåˆ¶åŒ–é€‰é¡¹ï¼Œå…¶é€šè¿‡ä¸‰ç§è¡Œä¸ºæ¥å®Œæˆæ‰©å±•:</p><ul><li><strong>æ–‡ä»¶ä¸Šä¼ :</strong> k0sctl å…è®¸å®šä¹‰åœ¨å®‰è£…å‰çš„æ–‡ä»¶ä¸Šä¼ ï¼Œåœ¨å®‰è£…ä¹‹å‰ k0sctl ä¼šæŠŠå·²ç»å®šä¹‰çš„ç›¸å…³æ–‡ä»¶å…¨éƒ¨ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºï¼ŒåŒ…æ‹¬ä¸é™äº k0s æœ¬èº«äºŒè¿›åˆ¶æ–‡ä»¶ã€ç¦»çº¿é•œåƒåŒ…ã€å…¶ä»–å®‰è£…æ–‡ä»¶ã€å…¶ä»–è¾…åŠ©è„šæœ¬ç­‰ã€‚</li><li><strong>Manifests ä¸ Helm:</strong> å½“å°†ç‰¹å®šçš„æ–‡ä»¶ä¸Šä¼ åˆ° master èŠ‚ç‚¹çš„ <code>/var/lib/k0s/manifests</code> ç›®å½•æ—¶ï¼Œk0s åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨åº”ç”¨è¿™äº›é…ç½®ï¼Œç±»ä¼¼ kubelet çš„ static pod ä¸€æ ·ï¼Œåªä¸è¿‡ k0s å…è®¸å…¨éƒ¨èµ„æº(åŒ…æ‹¬ä¸é™äº deploymentã€daemonsetã€namespace ç­‰)ï¼›åŒæ ·ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ <code>k0sctl.yaml</code> æ·»åŠ  Helm é…ç½®ï¼Œk0s ä¹Ÿä¼šä»¥åŒæ ·çš„æ–¹å¼å¸®ä½ ç®¡ç†ã€‚</li><li><strong>è¾…åŠ©è„šæœ¬:</strong> å¯ä»¥åœ¨æ¯ä¸ªä¸»æœºä¸‹é…ç½® <code>hooks</code> é€‰é¡¹æ¥å®ç°æ‰§è¡Œä¸€äº›ç‰¹å®šçš„è„šæœ¬(æ–‡æ¡£é‡Œæ²¡æœ‰ï¼Œéœ€è¦çœ‹æºç )ï¼Œä»¥ä¾¿åœ¨ç‰¹å®šæƒ…å†µä¸‹åšç‚¹éªšæ“ä½œã€‚</li></ul><h3><span id="23-k0sctl-ä½¿ç”¨ç¦»çº¿é•œåƒåŒ…">2.3 k0sctl ä½¿ç”¨ç¦»çº¿é•œåƒåŒ…</span></h3><p>åŸºäºä¸Šé¢çš„æ‰©å±•ï¼Œk0s è¿˜æ–¹ä¾¿çš„å¸®æˆ‘ä»¬é›†æˆäº†ç¦»çº¿é•œåƒåŒ…çš„è‡ªåŠ¨å¯¼å…¥ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œå°†é•œåƒåŒ…ä¸Šä¼ åˆ° <code>/var/lib/k0s/images/</code> ç›®å½•åï¼Œk0s ä¼šè‡ªå®šå°†å…¶å€’å…¥åˆ° containerd ä¸­è€Œæ— éœ€æˆ‘ä»¬æ‰‹åŠ¨å¹²é¢„:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: k0sctl.k0sproject.io&#x2F;v1beta1</span><br><span class="line">kind: Cluster</span><br><span class="line">metadata:</span><br><span class="line">  name: k0s-cluster</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.11</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">    # files é…ç½®å°†ä¼šåœ¨å®‰è£…å‰å°†ç›¸å…³æ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœº</span><br><span class="line">    files:</span><br><span class="line">    - name: image-bundle</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;bundle_file</span><br><span class="line">      # åœ¨è¯¥ç›®å½•ä¸‹çš„ image å‹ç¼©åŒ…å°†ä¼šè¢«è‡ªåŠ¨å¯¼å…¥åˆ° containerd ä¸­</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;images&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p><strong>å…³äº image å‹ç¼©åŒ…(bundle_file)å¦‚ä½•ä¸‹è½½ä»¥åŠè‡ªå·±è‡ªå®šä¹‰é—®é¢˜è¯·å‚è€ƒå®˜æ–¹ <a href="https://docs.k0sproject.io/v1.21.2+k0s.1/airgap-install/" target="_blank" rel="noopener">Airgap install</a> æ–‡æ¡£ã€‚</strong></p><p><img src="https://img.hi-linux.com/staticfile/LJIS7j-2021-07-30-GcLOTb.png" alt></p><h3><span id="24-åˆ‡æ¢-cni-æ’ä»¶">2.4 åˆ‡æ¢ CNI æ’ä»¶</span></h3><p>é»˜è®¤æƒ…å†µä¸‹ k0s å†…éƒ¨é›†æˆäº†ä¸¤ä¸ª CNI æ’ä»¶: Calico å’Œ kube-routerã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ç”¨å…¶ä»–çš„ CNI æ’ä»¶ï¼Œä¾‹å¦‚ Flannelï¼Œæˆ‘ä»¬åªéœ€è¦å°†é»˜è®¤çš„ CNI æ’ä»¶è®¾ç½®ä¸º <code>custom</code>ï¼Œç„¶åå°† Flannel çš„éƒ¨ç½² YAML ä¸Šä¼ åˆ°ä¸€å° master çš„ <code>/var/lib/k0s/manifests</code> ç›®å½•å³å¯ï¼Œk0s ä¼šè‡ªåŠ¨å¸®æˆ‘é—¨æ‰§è¡Œ <code>apply -f xxxx.yaml</code> è¿™ç§æ“ä½œã€‚</p><p>ä¸‹é¢æ˜¯åˆ‡æ¢åˆ° Flannel çš„æ ·ä¾‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ Flannel å®˜æ–¹é•œåƒä¸ä¼šå¸®ä½ å®‰è£… CNI çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©æ–‡ä»¶ä¸Šä¼ è‡ªå·±å®‰è£…(<a href="https://github.com/containernetworking/plugins/releases" target="_blank" rel="noopener">CNI GitHub æ’ä»¶ä¸‹è½½åœ°å€</a>):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: k0sctl.k0sproject.io&#x2F;v1beta1</span><br><span class="line">kind: Cluster</span><br><span class="line">metadata:</span><br><span class="line">  name: k0s-cluster</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.11</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">    files:</span><br><span class="line">    # å°† flannel çš„ yaml æ”¾åˆ° manifests é‡Œ(éœ€è¦å•ç‹¬åˆ›å»ºä¸€ä¸ªç›®å½•)</span><br><span class="line">    - name: flannel</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;kube-flannel.yaml</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;manifests&#x2F;flannel</span><br><span class="line">      perm: 0644</span><br><span class="line">    # è‡ªå·±å®‰è£…ä¸€ä¸‹ CNI æ’ä»¶</span><br><span class="line">    - name: cni-plugins</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;cni-plugins&#x2F;*</span><br><span class="line">      dstDir: &#x2F;opt&#x2F;cni&#x2F;bin&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">  k0s:</span><br><span class="line">    version: v1.21.2+k0s.1</span><br><span class="line">    config:</span><br><span class="line">      apiVersion: k0s.k0sproject.io&#x2F;v1beta1</span><br><span class="line">      kind: Cluster</span><br><span class="line">      metadata:</span><br><span class="line">        name: k0s</span><br><span class="line">      spec:</span><br><span class="line">        api:</span><br><span class="line">          address: 10.0.0.11</span><br><span class="line">          port: 6443</span><br><span class="line">          k0sApiPort: 9443</span><br><span class="line">          sans:</span><br><span class="line">          - 10.0.0.11</span><br><span class="line">          - 10.0.0.12</span><br><span class="line">          - 10.0.0.13</span><br><span class="line">        storage:</span><br><span class="line">          type: etcd</span><br><span class="line">        network:</span><br><span class="line">          podCIDR: 10.244.0.0&#x2F;16</span><br><span class="line">          serviceCIDR: 10.96.0.0&#x2F;12</span><br><span class="line">          # è¿™é‡ŒæŒ‡å®š CNI ä¸º custom è‡ªå®šä¹‰ç±»å‹ï¼Œè¿™æ ·</span><br><span class="line">          # k0s å°±ä¸ä¼šå®‰è£… calico&#x2F;kube-router äº†</span><br><span class="line">          provider: custom</span><br></pre></td></tr></table></figure><h3><span id="25-ä¸Šä¼ -k0s-äºŒè¿›åˆ¶æ–‡ä»¶">2.5 ä¸Šä¼  k0s äºŒè¿›åˆ¶æ–‡ä»¶</span></h3><p>é™¤äº†æ™®é€šæ–‡ä»¶ã€é•œåƒå‹ç¼©åŒ…ç­‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ k0sctl åœ¨å®‰è£…é›†ç¾¤æ—¶è¿˜ä¼šåœ¨ç›®æ ‡æœºå™¨ä¸Šä¸‹è½½ k0s äºŒè¿›åˆ¶æ–‡ä»¶ï¼›å½“ç„¶åœ¨ç¦»çº¿ç¯å¢ƒä¸‹è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„é…ç½®æ¥å®ç°ç¦»çº¿ä¸Šä¼ :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: k0sctl.k0sproject.io&#x2F;v1beta1</span><br><span class="line">kind: Cluster</span><br><span class="line">metadata:</span><br><span class="line">  name: k0s-cluster</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.11</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">    # å£°æ˜éœ€è¦ä¸Šä¼ äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">    uploadBinary: true</span><br><span class="line">    # æŒ‡å®šäºŒè¿›åˆ¶æ–‡ä»¶ä½ç½®</span><br><span class="line">    k0sBinaryPath: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;k0s</span><br><span class="line">    files:</span><br><span class="line">    - name: flannel</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;kube-flannel.yaml</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;manifests&#x2F;flannel</span><br><span class="line">      perm: 0644</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h3><span id="26-æ›´æ¢é•œåƒç‰ˆæœ¬">2.6 æ›´æ¢é•œåƒç‰ˆæœ¬</span></h3><p>é»˜è®¤æƒ…å†µä¸‹ k0s ç‰ˆæœ¬å·ä¸ Kubernetes ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯å¦‚æœæœŸæœ›æŸä¸ªç»„ä»¶ä½¿ç”¨ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥ç›´æ¥é…ç½®è¿™äº›å†…ç½®ç»„ä»¶çš„é•œåƒåç§°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: k0sctl.k0sproject.io&#x2F;v1beta1</span><br><span class="line">kind: Cluster</span><br><span class="line">metadata:</span><br><span class="line">  name: k0s-cluster</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.11</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">    uploadBinary: true</span><br><span class="line">    k0sBinaryPath: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;k0s</span><br><span class="line">    files:</span><br><span class="line">    - name: flannel</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;kube-flannel.yaml</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;manifests&#x2F;flannel</span><br><span class="line">      perm: 0644</span><br><span class="line">......</span><br><span class="line">  k0s:</span><br><span class="line">    version: v1.21.2+k0s.1</span><br><span class="line">    config:</span><br><span class="line">      apiVersion: k0s.k0sproject.io&#x2F;v1beta1</span><br><span class="line">      kind: Cluster</span><br><span class="line">      metadata:</span><br><span class="line">        name: k0s</span><br><span class="line">      spec:</span><br><span class="line">        api:</span><br><span class="line">          address: 10.0.0.11</span><br><span class="line">          port: 6443</span><br><span class="line">          k0sApiPort: 9443</span><br><span class="line">          sans:</span><br><span class="line">          - 10.0.0.11</span><br><span class="line">          - 10.0.0.12</span><br><span class="line">          - 10.0.0.13</span><br><span class="line">        # æŒ‡å®šå†…éƒ¨ç»„ä»¶çš„é•œåƒä½¿ç”¨çš„ç‰ˆæœ¬</span><br><span class="line">        images:</span><br><span class="line">          #konnectivity:</span><br><span class="line">          #  image: us.gcr.io&#x2F;k8s-artifacts-prod&#x2F;kas-network-proxy&#x2F;proxy-agent</span><br><span class="line">          #  version: v0.0.21</span><br><span class="line">          #metricsserver:</span><br><span class="line">          #  image: gcr.io&#x2F;k8s-staging-metrics-server&#x2F;metrics-server</span><br><span class="line">          #  version: v0.3.7</span><br><span class="line">          kubeproxy:</span><br><span class="line">            image: k8s.gcr.io&#x2F;kube-proxy</span><br><span class="line">            version: v1.21.3</span><br><span class="line">          #coredns:</span><br><span class="line">          #  image: docker.io&#x2F;coredns&#x2F;coredns</span><br><span class="line">          #  version: 1.7.0</span><br><span class="line">          #calico:</span><br><span class="line">          #  cni:</span><br><span class="line">          #    image: docker.io&#x2F;calico&#x2F;cni</span><br><span class="line">          #    version: v3.18.1</span><br><span class="line">          #  node:</span><br><span class="line">          #    image: docker.io&#x2F;calico&#x2F;node</span><br><span class="line">          #    version: v3.18.1</span><br><span class="line">          #  kubecontrollers:</span><br><span class="line">          #    image: docker.io&#x2F;calico&#x2F;kube-controllers</span><br><span class="line">          #    version: v3.18.1</span><br><span class="line">          #kuberouter:</span><br><span class="line">          #  cni:</span><br><span class="line">          #    image: docker.io&#x2F;cloudnativelabs&#x2F;kube-router</span><br><span class="line">          #    version: v1.2.1</span><br><span class="line">          #  cniInstaller:</span><br><span class="line">          #    image: quay.io&#x2F;k0sproject&#x2F;cni-node</span><br><span class="line">          #    version: 0.1.0</span><br><span class="line">          default_pull_policy: IfNotPresent</span><br><span class="line">          #default_pull_policy: Never</span><br></pre></td></tr></table></figure><h3><span id="27-è°ƒæ•´-master-ç»„ä»¶å‚æ•°">2.7 è°ƒæ•´ master ç»„ä»¶å‚æ•°</span></h3><p>ç†Ÿæ‚‰ Kubernetes çš„åº”è¯¥æ¸…æ¥šï¼Œmaster ä¸Šä¸‰å¤§ç»„ä»¶: apiserverã€controllerã€scheduler ç®¡æ§æ•´ä¸ªé›†ç¾¤ï¼›åœ¨ k0sctl å®‰è£…é›†ç¾¤çš„è¿‡ç¨‹ä¸­ä¹Ÿå…è®¸è‡ªå®šä¹‰è¿™äº›ç»„ä»¶çš„å‚æ•°ï¼Œè¿™äº›è°ƒæ•´é€šè¿‡ä¿®æ”¹ä½¿ç”¨çš„ <code>k0sctl.yaml</code> é…ç½®æ–‡ä»¶å®Œæˆã€‚</p><ul><li><code>spec.api.extraArgs</code>: ç”¨äºè‡ªå®šä¹‰ kube-apiserver çš„è‡ªå®šä¹‰å‚æ•°(kv map)</li><li><code>spec.scheduler.extraArgs</code>: ç”¨äºè‡ªå®šä¹‰ kube-scheduler çš„è‡ªå®šä¹‰å‚æ•°(kv map)</li><li><code>spec.controllerManager.extraArgs</code>: ç”¨äºè‡ªå®šä¹‰ kube-controller-manager è‡ªå®šä¹‰å‚æ•°(kv map)</li><li><code>spec.workerProfiles</code>: ç”¨äºè¦†ç›– kubelet-config.yaml ä¸­çš„é…ç½®ï¼Œè¯¥é…ç½®æœ€ç»ˆå°†äºé»˜è®¤çš„ kubelet-config.yaml åˆå¹¶</li></ul><p>é™¤æ­¤ä¹‹å¤–åœ¨ <code>Host</code> é…ç½®ä¸­è¿˜æœ‰ä¸€ä¸ª <code>InstallFlags</code> é…ç½®ç”¨äºä¼ é€’ k0s å®‰è£…æ—¶çš„å…¶ä»–é…ç½®é€‰é¡¹ã€‚</p><h2><span id="k0s-ha-æ­å»º">K0s HA æ­å»º</span></h2><blockquote><p>ä¸Šé¢çš„ç¬¬äºŒéƒ¨åˆ†ä¸»è¦éƒ½æ˜¯ä»‹ç» k0sctl ä¸€äº›åŸºç¡€åŠŸèƒ½ï¼Œä¸ºçš„å°±æ˜¯ç»™ä¸‹é¢è¿™éƒ¨åˆ† HA ç”Ÿäº§çº§éƒ¨ç½²åšé“ºå«ã€‚</p></blockquote><p>å°±ç›®å‰æ¥è¯´ï¼Œk0s HA ä»…æ”¯æŒç‹¬ç«‹è´Ÿè½½å‡è¡¡å™¨çš„ HA æ¶æ„ã€‚ <strong>å³å¤–éƒ¨éœ€è¦æœ‰ä¸€ä¸ªé«˜å¯ç”¨çš„ 4 å±‚è´Ÿè½½å‡è¡¡å™¨ï¼Œå…¶ä»–æ‰€æœ‰ Node èŠ‚ç‚¹é“¾æ¥è¿™ä¸ªè´Ÿè½½å‡è¡¡å™¨å®ç° master çš„é«˜å¯ç”¨ã€‚</strong> åœ¨ä½¿ç”¨ k0sctl å‘½ä»¤æ­å»º HA é›†ç¾¤æ—¶å¾ˆç®€å•ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨åœ°å€å³å¯ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ï¼Œå…¨ç¦»çº¿çŠ¶æ€ä¸‹çš„ HA é›†ç¾¤æ­å»ºé…ç½®ã€‚</p><h3><span id="31-å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨">3.1 å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨</span></h3><p><strong>åœ¨æ­å»ºä¹‹å‰æˆ‘ä»¬å‡è®¾å·²ç»æœ‰ä¸€ä¸ªå¤–éƒ¨çš„é«˜å¯ç”¨çš„ 4 å±‚è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸”è´Ÿè½½å‡è¡¡å™¨å·²ç»è´Ÿè½½äº†ä»¥ä¸‹ç«¯å£:</strong></p><ul><li><code>6443(for Kubernetes API)</code>: è´Ÿè½½å‡è¡¡å™¨ 6443 è´Ÿè½½æ‰€æœ‰ master èŠ‚ç‚¹çš„ 6443</li><li><code>9443 (for controller join API)</code>: è´Ÿè½½å‡è¡¡å™¨ 9443 è´Ÿè½½æ‰€æœ‰ master èŠ‚ç‚¹çš„ 9443</li><li><code>8132 (for Konnectivity agent)</code>: è´Ÿè½½å‡è¡¡å™¨ 8132 è´Ÿè½½æ‰€æœ‰ master èŠ‚ç‚¹çš„ 8132</li><li><code>8133 (for Konnectivity server)</code>: è´Ÿè½½å‡è¡¡å™¨ 8133 è´Ÿè½½æ‰€æœ‰ master èŠ‚ç‚¹çš„ 8133</li></ul><p>ä»¥ä¸‹ä¸ºä¸€ä¸ª Nginx 4 å±‚ä»£ç†çš„æ ·ä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">error_log syslog:server&#x3D;unix:&#x2F;dev&#x2F;log notice;</span><br><span class="line"></span><br><span class="line">worker_processes auto;</span><br><span class="line">events &#123;</span><br><span class="line">multi_accept on;</span><br><span class="line">use epoll;</span><br><span class="line">worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    upstream kube_apiserver &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server 10.0.0.11:6443;</span><br><span class="line">        server 10.0.0.12:6443;</span><br><span class="line">        server 10.0.0.13:6443;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream konnectivity_agent &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server 10.0.0.11:8132;</span><br><span class="line">        server 10.0.0.12:8132;</span><br><span class="line">        server 10.0.0.13:8132;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream konnectivity_server &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server 10.0.0.11:8133;</span><br><span class="line">        server 10.0.0.12:8133;</span><br><span class="line">        server 10.0.0.13:8133;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream controller_join_api &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server 10.0.0.11:9443;</span><br><span class="line">        server 10.0.0.12:9443;</span><br><span class="line">        server 10.0.0.13:9443;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">        listen        0.0.0.0:6443;</span><br><span class="line">        proxy_pass    kube_apiserver;</span><br><span class="line">        proxy_timeout 10m;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen        0.0.0.0:8132;</span><br><span class="line">        proxy_pass    konnectivity_agent;</span><br><span class="line">        proxy_timeout 10m;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen        0.0.0.0:8133;</span><br><span class="line">        proxy_pass    konnectivity_server;</span><br><span class="line">        proxy_timeout 10m;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen        0.0.0.0:9443;</span><br><span class="line">        proxy_pass    controller_join_api;</span><br><span class="line">        proxy_timeout 10m;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="32-æ­å»º-k0s-ha-é›†ç¾¤">3.2 æ­å»º K0s HA é›†ç¾¤</span></h3><p>ä»¥ä¸‹ä¸º k0sctl çš„ HA + ç¦»çº¿éƒ¨ç½²æ ·ä¾‹é…ç½®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: k0sctl.k0sproject.io&#x2F;v1beta1</span><br><span class="line">kind: Cluster</span><br><span class="line">metadata:</span><br><span class="line">  name: k0s-cluster</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.11</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    # role æ”¯æŒçš„å€¼</span><br><span class="line">    # &#39;controller&#39; å• master</span><br><span class="line">    # &#39;worker&#39; å• worker</span><br><span class="line">    # &#39;controller+worker&#39; master å’Œ worker éƒ½è¿è¡Œ </span><br><span class="line">    role: controller+worker</span><br><span class="line">    </span><br><span class="line">    # ä»æœ¬åœ° ä¸Šä¼  k0s bin æ–‡ä»¶ï¼Œä¸è¦åœ¨ç›®æ ‡æœºå™¨ä¸‹è½½</span><br><span class="line">    uploadBinary: true</span><br><span class="line">    k0sBinaryPath: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;k0s</span><br><span class="line">    </span><br><span class="line">    # ä¸Šä¼ å…¶ä»–æ–‡ä»¶</span><br><span class="line">    files:</span><br><span class="line">    # ä¸Šä¼  flannel é…ç½®ï¼Œä½¿ç”¨è‡ªå®šçš„ flannel æ›¿æ¢å†…ç½®çš„ calico</span><br><span class="line">    - name: flannel</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;kube-flannel.yaml</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;manifests&#x2F;flannel</span><br><span class="line">      perm: 0644</span><br><span class="line">    </span><br><span class="line">    # ä¸Šä¼ æ‰“åŒ…å¥½çš„ image é•œåƒåŒ…ï¼Œk0s ä¼šè‡ªåŠ¨å¯¼å…¥åˆ° containerd</span><br><span class="line">    - name: image-bundle</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;bundle_file</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;images&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">    </span><br><span class="line">    # ä½¿ç”¨ flannel åæ¯ä¸ªæœºå™¨è¦ä¸Šä¼ å¯¹åº”çš„ CNI æ’ä»¶</span><br><span class="line">    - name: cni-plugins</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;cni-plugins&#x2F;*</span><br><span class="line">      dstDir: &#x2F;opt&#x2F;cni&#x2F;bin&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.12</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">    uploadBinary: true</span><br><span class="line">    k0sBinaryPath: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;k0s</span><br><span class="line">    files:</span><br><span class="line">    - name: image-bundle</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;bundle_file</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;images&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">    - name: cni-plugins</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;cni-plugins&#x2F;*</span><br><span class="line">      dstDir: &#x2F;opt&#x2F;cni&#x2F;bin&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.13</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: controller+worker</span><br><span class="line">    uploadBinary: true</span><br><span class="line">    k0sBinaryPath: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;k0s</span><br><span class="line">    files:</span><br><span class="line">    - name: image-bundle</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;bundle_file</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;images&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">    - name: cni-plugins</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;cni-plugins&#x2F;*</span><br><span class="line">      dstDir: &#x2F;opt&#x2F;cni&#x2F;bin&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.14</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: worker</span><br><span class="line">    uploadBinary: true</span><br><span class="line">    k0sBinaryPath: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;k0s</span><br><span class="line">    files:</span><br><span class="line">    - name: image-bundle</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;bundle_file</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;images&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">    - name: cni-plugins</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;cni-plugins&#x2F;*</span><br><span class="line">      dstDir: &#x2F;opt&#x2F;cni&#x2F;bin&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">  - ssh:</span><br><span class="line">      address: 10.0.0.15</span><br><span class="line">      user: root</span><br><span class="line">      port: 22</span><br><span class="line">      keyPath: &#x2F;Users&#x2F;bleem&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">    role: worker</span><br><span class="line">    uploadBinary: true</span><br><span class="line">    k0sBinaryPath: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;k0s</span><br><span class="line">    files:</span><br><span class="line">    - name: image-bundle</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;bundle_file</span><br><span class="line">      dstDir: &#x2F;var&#x2F;lib&#x2F;k0s&#x2F;images&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">    - name: cni-plugins</span><br><span class="line">      src: &#x2F;Users&#x2F;bleem&#x2F;tmp&#x2F;cni-plugins&#x2F;*</span><br><span class="line">      dstDir: &#x2F;opt&#x2F;cni&#x2F;bin&#x2F;</span><br><span class="line">      perm: 0755</span><br><span class="line">  k0s:</span><br><span class="line">    version: v1.21.2+k0s.1</span><br><span class="line">    config:</span><br><span class="line">      apiVersion: k0s.k0sproject.io&#x2F;v1beta1</span><br><span class="line">      kind: Cluster</span><br><span class="line">      metadata:</span><br><span class="line">        name: k0s</span><br><span class="line">      spec:</span><br><span class="line">        api:</span><br><span class="line">          # æ­¤å¤„å¡«å†™å¤–éƒ¨çš„è´Ÿè½½å‡è¡¡å™¨åœ°å€ï¼Œæ‰€æœ‰ kubelet ä¼šé“¾æ¥è¿™ä¸ªåœ°å€</span><br><span class="line">          externalAddress: 10.0.0.20</span><br><span class="line">          # ä¸è¦å¿˜äº†ä¸ºå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨æ·»åŠ  api è¯ä¹¦çš„ SAN</span><br><span class="line">          sans:</span><br><span class="line">          - 10.0.0.11</span><br><span class="line">          - 10.0.0.12</span><br><span class="line">          - 10.0.0.13</span><br><span class="line">          - 10.0.0.20</span><br><span class="line">        # å­˜å‚¨ç±»å‹ä½¿ç”¨ etcdï¼Œetcd é›†ç¾¤ç”± k0s è‡ªåŠ¨ç®¡ç†</span><br><span class="line">        storage:</span><br><span class="line">          type: etcd</span><br><span class="line">        network:</span><br><span class="line">          podCIDR: 10.244.0.0&#x2F;16</span><br><span class="line">          serviceCIDR: 10.96.0.0&#x2F;12</span><br><span class="line">          # ç½‘ç»œæ’ä»¶ä½¿ç”¨ customï¼Œç„¶åè®© flannel æ¥ç®¡</span><br><span class="line">          provider: custom</span><br><span class="line">          kubeProxy:</span><br><span class="line">            disabled: false</span><br><span class="line">            # å¼€å¯ kubelet çš„ ipvs æ¨¡å¼</span><br><span class="line">            mode: ipvs</span><br><span class="line">        # ä¸å‘é€ä»»ä½•åŒ¿åç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">        telemetry:</span><br><span class="line">          enabled: false</span><br><span class="line">        images:</span><br><span class="line">          default_pull_policy: IfNotPresent</span><br></pre></td></tr></table></figure><p>æœ€ååªéœ€è¦æ‰§è¡Œ <code>k0sctl apply -c k0sctl.yaml</code> ç¨ç­‰å‡ åˆ†é’Ÿé›†ç¾¤å°±æ­å»ºå¥½äº†ï¼Œå®‰è£…è¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ç›¸å…³æ–‡ä»¶çš„ä¸Šä¼ æµç¨‹:</p><p><img src="https://img.hi-linux.com/staticfile/4rQzJU-2021-07-30-x6oYQu.png" alt></p><h3><span id="33-è¯ä¹¦ç»­ç­¾å’Œç®¡ç†">3.3 è¯ä¹¦ç»­ç­¾å’Œç®¡ç†</span></h3><p>kubeadm é›†ç¾¤é»˜è®¤è¯ä¹¦æœ‰æ•ˆæœŸæ˜¯ä¸€å¹´ï¼Œåˆ°æœŸè¦é€šè¿‡ kubeadm é‡æ–°ç­¾ç½²ã€‚k0s é›†ç¾¤ä¹Ÿå·®ä¸å¤šä¸€æ ·ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ k0s é›†ç¾¤æ›´åŠ æš´åŠ›ã€‚<strong>åªè¦ CA(é»˜è®¤ 10å¹´) ä¸ä¸¢ï¼Œk0s æ¯æ¬¡é‡å¯éƒ½å¼ºè¡Œé‡æ–°ç”Ÿæˆä¸€å¹´æœ‰æ•ˆæœŸçš„è¯ä¹¦ï¼Œæ‰€ä»¥åœ¨ HA çš„ç¯å¢ƒä¸‹ï¼Œå¿«åˆ°æœŸæ—¶é‡å¯ä¸€ä¸‹ k0s æœåŠ¡å°±è¡Œã€‚</strong></p><p><strong>k0sctl å®‰è£…å®Œçš„é›†ç¾¤é»˜è®¤åªæœ‰ä¸€ä¸ª <code>k0scontroller.service</code> æœåŠ¡ï¼Œmasterã€node ä¸Šæ‰€æœ‰æœåŠ¡éƒ½ç”±è¿™ä¸ªæœåŠ¡å¯åŠ¨ï¼Œæ‰€ä»¥åˆ°æœŸä¹‹å‰ <code>systemctl restart k0scontroller.service</code> ä¸€ä¸‹å°±è¡Œã€‚</strong></p><h2><span id="é›†ç¾¤å¤‡ä»½å’Œæ¢å¤">é›†ç¾¤å¤‡ä»½å’Œæ¢å¤</span></h2><p>k0sctl æä¾›äº†é›†ç¾¤å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹åªéœ€è¦æ‰§è¡Œ <code>k0sctl backup</code> å³å¯å®Œæˆé›†ç¾¤å¤‡ä»½ï¼Œè¯¥å‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <code>k0s_backup_TIMESTAMP.tar.gz</code> å¤‡ä»½æ–‡ä»¶ã€‚</p><p>éœ€è¦æ¢å¤é›†ç¾¤æ—¶ä½¿ç”¨ <code>k0sctl apply --restore-from k0s_backup_TIMESTAMP.tar.gz</code> å‘½ä»¤è¿›è¡Œæ¢å¤å³å¯ï¼›éœ€è¦æ³¨æ„çš„æ˜¯æ¢å¤å‘½ä»¤ç­‰åŒäºåœ¨æ–°æœºå™¨é‡æ–°å®‰è£…é›†ç¾¤ï¼Œæ‰€ä»¥æœ‰ä¸€å®šé£é™©ã€‚</p><p><strong>æ³¨ï¼šç»è¿‡è¿ç»­ä¸¤å¤©çš„æµ‹è¯•ï¼Œæ„Ÿè§‰è¿™ä¸ªå¤‡ä»½æ¢å¤åŠŸèƒ½å¹¶ä¸ç®—é è°±ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨ Velero å¤‡ä»½é›†ç¾¤ã€‚</strong></p><h2><span id="å…¶ä»–é«˜çº§åŠŸèƒ½">å…¶ä»–é«˜çº§åŠŸèƒ½</span></h2><h3><span id="51-etcd-æ›¿æ¢">5.1 Etcd æ›¿æ¢</span></h3><p>åœ¨å°è§„æ¨¡é›†ç¾¤åœºæ™¯ä¸‹å¯èƒ½å¹¶ä¸éœ€è¦ç‰¹åˆ«å®Œå–„çš„ Etcd ä½œä¸ºå­˜å‚¨ï¼Œk0s å€ŸåŠ©äº kine åº“å¯ä»¥å®ç°ä½¿ç”¨ SQLite æˆ– MySQL ç­‰ä¼ ç»Ÿæ•°æ®åº“ä½œä¸ºé›†ç¾¤å­˜å‚¨ï¼›å¦‚æœæƒ³è¦åˆ‡æ¢å­˜å‚¨åªéœ€è¦è°ƒæ•´ <code>k0sctl.yaml</code> é…ç½®å³å¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: k0s.k0sproject.io&#x2F;v1beta1</span><br><span class="line">kind: Cluster</span><br><span class="line">metadata:</span><br><span class="line">  name: k0s</span><br><span class="line">spec:</span><br><span class="line">  storage:</span><br><span class="line">    type: kine</span><br><span class="line">    kine:</span><br><span class="line">      dataSource: &quot;sqlite:&#x2F;&#x2F;&#x2F;var&#x2F;lib&#x2F;k0s&#x2F;db&#x2F;state.db?more&#x3D;rwc&amp;_journal&#x3D;WAL&amp;cache&#x3D;shared&quot;</span><br></pre></td></tr></table></figure><h3><span id="52-é›†ç¾¤ç”¨æˆ·ç®¡ç†">5.2 é›†ç¾¤ç”¨æˆ·ç®¡ç†</span></h3><p>ä½¿ç”¨ k0sctl æ­å»ºçš„é›†ç¾¤é€šè¿‡ <code>k0s</code> å‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºé›†ç¾¤æ·»åŠ ç”¨æˆ·ï¼Œä»¥ä¸‹æ˜¯æ·»åŠ æ ·ä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ k0s kubeconfig create --groups &quot;system:masters&quot; testUser &gt; k0s.config</span><br></pre></td></tr></table></figure><h3><span id="53-containerd-é…ç½®">5.3 Containerd é…ç½®</span></h3><p>åœ¨ä¸åšé…ç½®çš„æƒ…å†µä¸‹ k0s é›†ç¾¤ä½¿ç”¨é»˜è®¤çš„ Containerd é…ç½®ï¼Œå¦‚æœéœ€è¦è‡ªå·±å®šä¹‰ç‰¹æ®Šé…ç½®ï¼Œå¯ä»¥åœ¨å®‰è£…æ—¶é€šè¿‡æ–‡ä»¶ä¸Šä¼ æ–¹å¼å°† Containerd é…ç½®æ–‡ä»¶ä¸Šä¼ åˆ° <code>/etc/k0s/containerd.toml</code> ä½ç½®ï¼Œè¯¥é…ç½®å°†ä¼šè¢« k0s å¯åŠ¨çš„ Containerd è¯»å–å¹¶ä½¿ç”¨ã€‚</p><h2><span id="æ€»ç»“">æ€»ç»“</span></h2><p>k0s æ˜¯ä¸ªä¸é”™çš„é¡¹ç›®ï¼Œå¯¹äºäºŒè¿›åˆ¶å®¿ä¸»æœºéƒ¨ç½² Kubernetes é›†ç¾¤å¾ˆæ–¹ä¾¿ï¼Œç”±äºå…¶ç›´æ¥é‡‡ç”¨ Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶å¯åŠ¨ï¼Œæ‰€ä»¥åŸºæœ¬æ²¡æœ‰åŠŸèƒ½é˜‰å‰²ï¼Œè€Œ k0sctl åˆä¸ºè‡ªåŠ¨åŒ–å®‰è£…æä¾›äº†è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œæ‰€ä»¥å€¼å¾—ä¸€è¯•ã€‚ä¸è¿‡ç›®å‰æ¥è¯´ k0s åœ¨ç»†èŠ‚éƒ¨åˆ†è¿˜æœ‰ä¸€å®šç‘•ç–µï¼Œæ¯”å¦‚ <code>konnectivity</code> æœåŠ¡åœ¨å®‰è£…æ—¶æ— æ³•é€‰æ‹©æ€§å…³é—­ç­‰ã€‚k0s ç»¼åˆæ¥è¯´æ˜¯ä¸ªä¸é”™çš„å·¥å…·ï¼Œä¹Ÿæ¨èçœ‹çœ‹æºç ï¼Œé‡Œé¢å¾ˆå¤šè®¾è®¡å¾ˆæ–°é¢–ä¹Ÿæ¯”è¾ƒåˆ©äºäº†è§£é›†ç¾¤å¼•å¯¼è¿‡ç¨‹ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ bleem ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/puyt7f7d" target="_blank" rel="noopener">https://tinyurl.com/puyt7f7d</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘ä¸¤å¹´ä¸€ç›´åœ¨ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes é›†ç¾¤ï¼Œæ€»ä½“æ¥è¯´é…åˆä¸€äº›è‡ªå·±å°è„šæœ¬è¿˜æœ‰ä¸€äº›è‡ªåŠ¨åŒ–å·¥å…·è¿˜ç®—æ˜¯æ–¹ä¾¿ï¼›ä½†æ˜¯å…¨å®¹å™¨åŒ–ç¨³å®šæ€§ç¡®å®æ‹…å¿§ï¼Œä¹Ÿé‡åˆ°è¿‡è«åå…¶å¦™çš„è¯ä¹¦è¿‡æœŸé”™è¯¯ï¼Œæœ€åé‡å¯å¤§æ³•è§£å†³è¿™ç§é—®é¢˜ï¼›æ‰€ä»¥ä¹Ÿåœ¨æ¢ç´¢æ¯”è¾ƒæ–¹ä¾¿çš„äºŒè¿›åˆ¶éƒ¨ç½²æ–¹å¼ï¼Œæ¯”å¦‚è¿™ä¸ª k0sã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;k0s-ä»‹ç»&quot;&gt;k0s ä»‹ç»&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;The Simple, Solid &amp;amp; Certified Kubernetes Distribution.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;k0s å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªä¸‹æ¸¸çš„ Kubernetes å‘è¡Œç‰ˆï¼Œä¸åŸç”Ÿ Kubernetes ç›¸æ¯”ï¼Œk0s å¹¶æœªé˜‰å‰²å¤§é‡ Kubernetes åŠŸèƒ½ï¼›k0s ä¸»è¦é˜‰å‰²éƒ¨åˆ†åŸºæœ¬ä¸Šåªæœ‰ &lt;strong&gt;æ ‘å†… Cloud provider&lt;/strong&gt;ï¼Œå…¶ä»–çš„éƒ½ä¸åŸç”Ÿ Kubernetes ç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;k0s è‡ªè¡Œç¼–è¯‘ Kubernetes æºç ç”Ÿæˆ Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶ååœ¨å®‰è£…åå°†äºŒè¿›åˆ¶æ–‡ä»¶é‡Šæ”¾åˆ°å®¿ä¸»æœºå†å¯åŠ¨ï¼›è¿™ç§æƒ…å†µä¸‹æ‰€æœ‰åŠŸèƒ½å‡ ä¹ä¸åŸç”Ÿ Kubernetes æ²¡æœ‰å·®å¼‚ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;k0sctl-ä½¿ç”¨&quot;&gt;k0sctl ä½¿ç”¨&lt;/h2&gt;
&lt;p&gt;k0sctl æ˜¯ k0s ä¸ºäº†æ–¹ä¾¿å¿«é€Ÿéƒ¨ç½²é›†ç¾¤æ‰€æä¾›çš„å·¥å…·ï¼Œæœ‰ç‚¹ç±»ä¼¼äº kubeadmï¼Œä½†æ˜¯å…¶æ‰©å±•æ€§è¦æ¯” kubeadm å¥½å¾—å¤šã€‚åœ¨å¤šèŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œk0sctl é€šè¿‡ ssh è¿æ¥ç›®æ ‡ä¸»æœºç„¶åæŒ‰ç…§æ­¥éª¤é‡Šæ”¾æ–‡ä»¶å¹¶å¯åŠ¨ Kubernetes ç›¸å…³æœåŠ¡ï¼Œä»è€Œå®Œæˆé›†ç¾¤åˆå§‹åŒ–ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="æ•™ç¨‹" scheme="https://www.hi-linux.com/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ–‡ææ‡‚ 4 ç§å¸¸ç”¨çš„ Kubernetes å®¹å™¨</title>
    <link href="https://www.hi-linux.com/posts/16821.html"/>
    <id>https://www.hi-linux.com/posts/16821.html</id>
    <published>2021-07-30T01:00:00.000Z</published>
    <updated>2021-07-30T08:34:23.759Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>æˆªæ­¢ç›®å‰ Kubernetes 1.18ï¼ŒKubernetes å·²ç»æ”¯æŒæ ‡å‡†å®¹å™¨ï¼ŒSidecar å®¹å™¨ï¼ŒInit å®¹å™¨ï¼ŒEphemeral å®¹å™¨ 4 ç§ç±»å‹çš„ Containersã€‚æœ¬æ–‡æˆ‘ä»¬è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™ 4 ç§å®¹å™¨çš„ç‰¹æ€§ä»¥åŠä½¿ç”¨åœºæ™¯ã€‚</p><p><img src="https://pic2.zhimg.com/80/v2-fac0971dbc8d39235d81ffb07eb9c7cd_720w.jpg" alt></p><h2><span id="æ ‡å‡†å®¹å™¨å’Œ-sidecar-å®¹å™¨">æ ‡å‡†å®¹å™¨å’Œ Sidecar å®¹å™¨</span></h2><p>åœ¨  Kubernetes 1.18 ä¹‹å‰ï¼Œè¿™ä¸¤ç§å®¹å™¨ä» Kubernetes ç®¡ç†çš„è§’åº¦æ¥çœ‹ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚åªä¸è¿‡äººä¸ºä»åŠŸèƒ½ä¸Šåšäº†åŒºåˆ†ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/v2-7240d284cc8376172e49e8105953d726_720w-2021-06-25-Spz7c6.jpg" alt></p><h3><span id="ä½¿ç”¨-sidecar-å®¹å™¨æ¨¡å—åŒ–å…·æœ‰çš„ä¼˜ç‚¹">ä½¿ç”¨ Sidecar å®¹å™¨ï¼ˆæ¨¡å—åŒ–ï¼‰å…·æœ‰çš„ä¼˜ç‚¹</span></h3><ul><li>åŠ é€Ÿåº”ç”¨ç¨‹åºå¼€å‘ï¼Œå› ä¸ºå®¹å™¨å¯ä»¥åœ¨å›¢é˜Ÿç”šè‡³æ›´å¤§çš„ç¤¾åŒºä¹‹é—´é‡å¤ä½¿ç”¨</li><li>æ•´ç†ä¸“å®¶çŸ¥è¯†ï¼Œå› ä¸ºæ¯ä¸ªäººéƒ½åœ¨ä¸€ä¸ªå®¹å™¨åŒ–çš„å®ç°ä¸Šè¿›è¡Œåä½œï¼Œè¯¥å®ç°åæ˜ äº†æœ€ä½³å®è·µï¼Œè€Œä¸æ˜¯æ— æ•°ç§åŠŸèƒ½å¤§è‡´ç›¸åŒçš„è‡ªå®¶ç”Ÿäº§çš„ä¸åŒå®¹å™¨</li><li>å¯ç”¨æ•æ·å›¢é˜Ÿï¼Œå› ä¸ºå®¹å™¨è¾¹ç•Œæ˜¯è‡ªç„¶è¾¹ç•Œï¼Œæ˜¯å›¢é˜ŸèŒè´£çš„å¥‘çº¦</li><li>æä¾›å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œå¹¶ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½ï¼Œä»¥å‡å°‘æ„å¤§åˆ©é¢æ¡çš„ä¾èµ–æ€§å’Œä¸å¯æµ‹çš„ç»„ä»¶</li></ul><h3><span id="å¯¹äº-sidecar-å®¹å™¨ä¸€èˆ¬æ¥è¯´ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹-4-ç§è§’è‰²">å¯¹äº Sidecar å®¹å™¨ä¸€èˆ¬æ¥è¯´ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ 4 ç§è§’è‰²ï¼š</span></h3><ul><li>ä»£ç†</li></ul><p>ä¾‹å¦‚ç°åœ¨ Istio ä¸­ çš„ Envoyã€‚</p><p><img src="https://img.hi-linux.com/staticfile/v2-b134721a06da744cea35d5a399a3d857_720w-2021-06-25-ihOQPI.jpg" alt></p><p>é€šè¿‡è¿™ç§ Sidercar æ¨¡å¼ï¼Œä»£ç†å¯ä»¥æ‹¦æˆªè¿›å‡ºä¸»å®¹å™¨çš„æµé‡ä»è€Œ Istio å¯ä»¥æå–æœ‰å…³æµé‡è¡Œä¸ºçš„å¤§é‡ä¿¡å·ä½œä¸ºå±æ€§ã€‚ Istio å¯ä»¥ä½¿ç”¨è¿™äº›å±æ€§æ¥æ‰§è¡Œç­–ç•¥å†³ç­–ï¼Œå¹¶å°†å…¶å‘é€åˆ°ç›‘è§†ç³»ç»Ÿä»¥æä¾›æœ‰å…³æ•´ä¸ªç½‘æ ¼è¡Œä¸ºçš„ä¿¡æ¯ã€‚</p><p>Sidecar ä»£ç†æ¨¡å‹è¿˜å…è®¸æ‚¨å°† Istio åŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰éƒ¨ç½²ä¸­ï¼Œè€Œæ— éœ€é‡æ–°æ„é€ æˆ–é‡å†™ä»£ç ã€‚</p><ul><li>é€‚é…å™¨</li></ul><p>é€‚é…å™¨å®¹å™¨å¯¹è¾“å‡ºè¿›è¡Œæ ‡å‡†åŒ–ã€‚è€ƒè™‘ç›‘è§† N ä¸ªä¸åŒåº”ç”¨ç¨‹åºçš„ä»»åŠ¡ã€‚å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¯¼å‡ºç›‘è§†æ•°æ®çš„æ–¹å¼æ¥æ„å»ºæ¯ä¸ªåº”ç”¨ç¨‹åºã€‚ï¼ˆä¾‹å¦‚ JMXï¼ŒStatsDï¼Œç‰¹å®šäºåº”ç”¨ç¨‹åºçš„ç»Ÿè®¡ä¿¡æ¯ï¼‰ï¼Œä½†æ¯ä¸ªç›‘æ§ç³»ç»Ÿéƒ½å¸Œæœ›å…¶æ”¶é›†çš„ç›‘æ§æ•°æ®å…·æœ‰ä¸€è‡´ä¸”ç»Ÿä¸€çš„æ•°æ®æ¨¡å‹ã€‚</p><p>é€šè¿‡ä½¿ç”¨å¤åˆå®¹å™¨çš„é€‚é…å™¨æ¨¡å¼ï¼Œæ‚¨å¯ä»¥é€šè¿‡åˆ›å»º Pod æ¥å°†æ¥è‡ªä¸åŒç³»ç»Ÿçš„å¼‚æ„ç›‘è§†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªç»Ÿä¸€çš„è¡¨ç¤ºå½¢å¼ï¼Œè¯¥ Pod å°†åº”ç”¨ç¨‹åºå®¹å™¨ä¸çŸ¥é“å¦‚ä½•è¿›è¡Œè½¬æ¢çš„é€‚é…å™¨åˆ†ç»„åœ¨ä¸€èµ·ã€‚åŒæ ·ï¼Œç”±äºè¿™äº› Pod å…±äº«åç§°ç©ºé—´å’Œæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤è¿™ä¸¤ä¸ªå®¹å™¨çš„åè°ƒéå¸¸ç®€å•æ˜äº†ã€‚</p><p><img src="https://pic1.zhimg.com/80/v2-eab449fd16b6fb03512cbb7c6153fd60_720w.jpg" alt></p><ul><li>å¢å¼ºä¸»å®¹å™¨åŠŸèƒ½</li></ul><p>Sidecar å®¹å™¨æ‰©å±•å¹¶å¢å¼ºäº† â€œä¸»â€ å®¹å™¨ï¼Œå®ƒä»¬å¯ä»¥ä½¿ç”¨ç°æœ‰çš„å®¹å™¨å¹¶ä½¿å®ƒä»¬å˜å¾—æ›´å¥½ã€‚</p><p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªè¿è¡Œ Nginx Web æœåŠ¡å™¨çš„å®¹å™¨ã€‚æ·»åŠ å¦ä¸€ä¸ªå°†æ–‡ä»¶ç³»ç»Ÿä¸ Git å­˜å‚¨åº“åŒæ­¥çš„å®¹å™¨ï¼Œåœ¨è¿™äº›å®¹å™¨ä¹‹é—´å…±äº«æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”æ‚¨å·²ç»æ„å»ºäº† Git Push-to-deployã€‚ä½†æ˜¯æ‚¨å·²ç»ä»¥æ¨¡å—åŒ–çš„æ–¹å¼å®Œæˆäº†æ­¤å·¥ä½œï¼Œå…¶ä¸­ Git åŒæ­¥å™¨å¯ä»¥ç”±ä¸åŒçš„å›¢é˜Ÿæ„å»ºï¼Œå¹¶ä¸”å¯ä»¥åœ¨è®¸å¤šä¸åŒçš„WebæœåŠ¡å™¨ï¼ˆApacheï¼ŒPythonï¼ŒTomcatç­‰ï¼‰ä¸Šé‡å¤ä½¿ç”¨ã€‚</p><p>ç”±äºè¿™ç§æ¨¡å—åŒ–ï¼Œæ‚¨åªéœ€ç¼–å†™å’Œæµ‹è¯• Git åŒæ­¥å™¨ä¸€æ¬¡ï¼Œå³å¯åœ¨ä¼—å¤šåº”ç”¨ç¨‹åºä¸­é‡å¤ä½¿ç”¨å®ƒã€‚è€Œä¸”ï¼Œå¦‚æœæœ‰äººç¼–å†™å®ƒï¼Œæ‚¨ç”šè‡³ä¸éœ€è¦è¿™æ ·åšã€‚</p><ul><li>å®ç°è¾…åŠ©åŠŸèƒ½</li></ul><p>è¿™ç§åœºæ™¯ä¸€èˆ¬å‡ºç°åœ¨ DevOps ä¸­ã€‚æ¯”å¦‚å°†æ”¶é›†æ—¥å¿—çš„ç»„ä»¶ä»¥ Sidecar çš„æ–¹å¼éƒ¨ç½²ï¼Œå®ç°æ”¶é›†æ—¥å¿—çš„ç”¨é€”ï¼Œæˆ–æ˜¯éƒ¨ç½²ä¸€ä¸ª Sidecar ç»„ä»¶ä»é…ç½®ä¸­å¿ƒç›‘å¬é…ç½®å˜åŒ–ï¼Œå®æ—¶æ›´æ–°æœ¬åœ°é…ç½®ã€‚</p><h3><span id="ç”Ÿå‘½å‘¨æœŸ">ç”Ÿå‘½å‘¨æœŸ</span></h3><p>Sidecar å®¹å™¨çš„æ‰€æœ‰é—®é¢˜éƒ½ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸç›¸å…³æ€§æœ‰å…³ã€‚ç”±äºå’Œ Pod ä¸­çš„å¸¸è§„å®¹å™¨ä¹‹é—´æ²¡æœ‰åŒºåˆ«ï¼Œå› æ­¤æ— æ³•æ§åˆ¶å“ªä¸ªå®¹å™¨é¦–å…ˆå¯åŠ¨æˆ–æœ€åç»ˆæ­¢ï¼Œä½†æ˜¯å…ˆæ­£ç¡®è¿è¡Œ Sidecar å®¹å™¨é€šå¸¸æ˜¯åº”ç”¨ç¨‹åºå®¹å™¨æ­£ç¡®è¿è¡Œçš„è¦æ±‚ã€‚</p><p>ä» 1.18 ç‰ˆæœ¬å¼€å§‹ï¼ŒK8S å†…ç½®çš„ Sidecar åŠŸèƒ½å°†ç¡®ä¿ Sidecar å®¹å™¨åœ¨æ­£å¸¸ä¸šåŠ¡æµç¨‹å¼€å§‹ä¹‹å‰å°±å¯åŠ¨å¹¶è¿è¡Œï¼Œå³é€šè¿‡æ›´æ”¹ Pod çš„å¯åŠ¨ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨ Init å®¹å™¨å®Œæˆåå¯åŠ¨ Sidecar å®¹å™¨ï¼Œåœ¨ Sidecar å®¹å™¨å°±ç»ªåå¯åŠ¨ä¸šåŠ¡å®¹å™¨ï¼Œä»å¯åŠ¨æµç¨‹ä¸Šä¿è¯é¡ºåºæ€§ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/v2-1389722cbb68cad9a4673ca4f3d918d7_b-2021-06-25-1nAhaU.jpg" alt></p><p>é€šè¿‡æ›´æ”¹ Pod è§„èŒƒä¸­çš„ <code>container.lifecycle.type</code> å°†å®¹å™¨æ ‡è®°ä¸º Sidecar ç±»å‹ï¼š<code>Sidecar</code>ï¼Œé»˜è®¤ä¸º <code>Standard</code>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: bookings-v1-b54bc7c9c-v42f6</span><br><span class="line">  labels:</span><br><span class="line">    app: demoapp</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: bookings</span><br><span class="line">    image: banzaicloud&#x2F;allspark:0.1.1</span><br><span class="line">    ...</span><br><span class="line">  - name: istio-proxy</span><br><span class="line">    image: docker.io&#x2F;istio&#x2F;proxyv2:1.4.3</span><br><span class="line">    lifecycle:</span><br><span class="line">      type: Sidecar</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><h2><span id="init-å®¹å™¨">Init å®¹å™¨</span></h2><p>åœ¨ Kubernetes ä¸­ï¼ŒInit å®¹å™¨æ˜¯åœ¨åŒä¸€ Pod ä¸­çš„å…¶ä»–å®¹å™¨ä¹‹å‰å¼€å§‹å¹¶æ‰§è¡Œçš„å®¹å™¨ã€‚å®ƒæ—¨åœ¨ä¸º Pod ä¸Šæ‰˜ç®¡çš„ä¸»åº”ç”¨ç¨‹åºæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºå¿…è¦çš„ç”¨æˆ·å¸æˆ·ï¼Œæ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼Œåˆ›å»ºæ•°æ®åº“ç»“æ„ç­‰ã€‚</p><p>Init å®¹å™¨ä¸æ™®é€šçš„å®¹å™¨éå¸¸åƒï¼Œé™¤äº†å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>å®ƒä»¬æ€»æ˜¯è¿è¡Œåˆ°å®Œæˆã€‚</li><li>æ¯ä¸ªéƒ½å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå¯åŠ¨ä¹‹å‰æˆåŠŸå®Œæˆã€‚</li></ul><h3><span id="ä¸æ™®é€šå®¹å™¨çš„ä¸åŒä¹‹å¤„">ä¸æ™®é€šå®¹å™¨çš„ä¸åŒä¹‹å¤„</span></h3><p></p><ul><li>Init å®¹å™¨æ”¯æŒåº”ç”¨å®¹å™¨çš„å…¨éƒ¨å­—æ®µå’Œç‰¹æ€§ï¼ŒåŒ…æ‹¬èµ„æºé™åˆ¶ã€æ•°æ®å·å’Œå®‰å…¨è®¾ç½®ã€‚ ç„¶è€Œï¼ŒInit å®¹å™¨å¯¹èµ„æºè¯·æ±‚å’Œé™åˆ¶çš„å¤„ç†ç¨æœ‰ä¸åŒã€‚</li><li>åŒæ—¶ Init å®¹å™¨ä¸æ”¯æŒ Readiness Probeï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»åœ¨ Pod å°±ç»ªä¹‹å‰è¿è¡Œå®Œæˆã€‚</li><li>å¦‚æœä¸ºä¸€ä¸ª Pod æŒ‡å®šäº†å¤šä¸ª Init å®¹å™¨ï¼Œè¿™äº›å®¹å™¨ä¼šæŒ‰é¡ºåºé€ä¸ªè¿è¡Œã€‚æ¯ä¸ª Init å®¹å™¨å¿…é¡»è¿è¡ŒæˆåŠŸï¼Œä¸‹ä¸€ä¸ªæ‰èƒ½å¤Ÿè¿è¡Œã€‚å½“æ‰€æœ‰çš„ Init å®¹å™¨è¿è¡Œå®Œæˆæ—¶ï¼ŒKubernetes æ‰ä¼šä¸º Pod åˆå§‹åŒ–åº”ç”¨å®¹å™¨å¹¶åƒå¹³å¸¸ä¸€æ ·è¿è¡Œã€‚</li></ul><h3><span id="init-å®¹å™¨ä½œç”¨">Init å®¹å™¨ä½œç”¨</span></h3><p>å› ä¸º Init å®¹å™¨å…·æœ‰ä¸åº”ç”¨å®¹å™¨åˆ†ç¦»çš„å•ç‹¬é•œåƒï¼Œå…¶å¯åŠ¨ç›¸å…³ä»£ç å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p><ul><li>Init å®¹å™¨å¯ä»¥åŒ…å«ä¸€äº›å®‰è£…è¿‡ç¨‹ä¸­åº”ç”¨å®¹å™¨ä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·æˆ–ä¸ªæ€§åŒ–ä»£ç ã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰å¿…è¦ä»…ä¸ºäº†åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ç±»ä¼¼ sedã€ awkã€ python æˆ– dig è¿™æ ·çš„å·¥å…·è€Œå»FROM ä¸€ä¸ªé•œåƒæ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒã€‚</li><li>Init å®¹å™¨å¯ä»¥å®‰å…¨åœ°è¿è¡Œè¿™äº›å·¥å…·ï¼Œé¿å…è¿™äº›å·¥å…·å¯¼è‡´åº”ç”¨é•œåƒçš„å®‰å…¨æ€§é™ä½ã€‚</li><li>åº”ç”¨é•œåƒçš„åˆ›å»ºè€…å’Œéƒ¨ç½²è€…å¯ä»¥å„è‡ªç‹¬ç«‹å·¥ä½œï¼Œè€Œæ²¡æœ‰å¿…è¦è”åˆæ„å»ºä¸€ä¸ªå•ç‹¬çš„åº”ç”¨é•œåƒã€‚</li><li>Init å®¹å™¨èƒ½ä»¥ä¸åŒäºPodå†…åº”ç”¨å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾è¿è¡Œã€‚å› æ­¤ï¼ŒInitå®¹å™¨å¯å…·æœ‰è®¿é—® Secrets çš„æƒé™ï¼Œè€Œåº”ç”¨å®¹å™¨ä¸èƒ½å¤Ÿè®¿é—®ã€‚</li><li>ç”±äº Init å®¹å™¨å¿…é¡»åœ¨åº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œå®Œæˆï¼Œå› æ­¤ Init å®¹å™¨æä¾›äº†ä¸€ç§æœºåˆ¶æ¥é˜»å¡æˆ–å»¶è¿Ÿåº”ç”¨å®¹å™¨çš„å¯åŠ¨ï¼Œç›´åˆ°æ»¡è¶³äº†ä¸€ç»„å…ˆå†³æ¡ä»¶ã€‚ä¸€æ—¦å‰ç½®æ¡ä»¶æ»¡è¶³ï¼ŒPodå†…çš„æ‰€æœ‰çš„åº”ç”¨å®¹å™¨ä¼šå¹¶è¡Œå¯åŠ¨ã€‚</li></ul><h3><span id="åˆ›å»º-initcontainer-æ—¶åº”è€ƒè™‘ä¸€äº›æ³¨æ„äº‹é¡¹">åˆ›å»º InitContainer æ—¶åº”è€ƒè™‘ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š</span></h3><ul><li>å®ƒä»¬æ€»æ˜¯åœ¨ Pod ä¸­çš„å…¶ä»–å®¹å™¨ä¹‹å‰æ‰§è¡Œã€‚å› æ­¤ï¼Œå®ƒä»¬ä¸åº”åŒ…å«éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆçš„å¤æ‚é€»è¾‘ã€‚å¯åŠ¨è„šæœ¬é€šå¸¸å¾ˆå°è€Œç®€æ´ã€‚å¦‚æœå‘ç°è¦å‘åˆå§‹åŒ–å®¹å™¨æ·»åŠ å¤ªå¤šé€»è¾‘ï¼Œåˆ™åº”è€ƒè™‘å°†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ç§»è‡³åº”ç”¨ç¨‹åºå®¹å™¨æœ¬èº«ã€‚</li><li>åˆå§‹åŒ–å®¹å™¨æŒ‰é¡ºåºå¯åŠ¨å’Œæ‰§è¡Œã€‚é™¤éä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨è¢«æˆåŠŸæ‰§è¡Œï¼Œå¦åˆ™ä¸‹ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨ä¸ä¼šè¢«å¼€å§‹æ‰§è¡Œã€‚å› æ­¤ï¼Œå¦‚æœå¯åŠ¨ä»»åŠ¡å¾ˆé•¿ï¼Œåˆ™å¯ä»¥è€ƒè™‘å°†å…¶åˆ†ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½ç”±ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨å¤„ç†ï¼Œä»¥ä¾¿æ‚¨çŸ¥é“å“ªäº›æ­¥éª¤å¤±è´¥ã€‚</li><li>å¦‚æœä»»ä½•åˆå§‹åŒ–å®¹å™¨å¤±è´¥ï¼Œåˆ™å°†é‡æ–°å¯åŠ¨æ•´ä¸ª Podï¼ˆé™¤éæ‚¨å°† restartPolicy è®¾ç½®ä¸º Neverï¼‰ã€‚é‡æ–°å¯åŠ¨ Pod æ„å‘³ç€å†æ¬¡é‡æ–°æ‰§è¡Œæ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬ä»»ä½•åˆå§‹åŒ–å®¹å™¨ã€‚å› æ­¤ï¼Œæ‚¨å¯èƒ½éœ€è¦ç¡®ä¿å¯åŠ¨é€»è¾‘å…è®¸å¤šæ¬¡æ‰§è¡Œè€Œä¸ä¼šå¯¼è‡´é‡å¤ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ•°æ®åº“è¿ç§»å·²ç»å®Œæˆï¼Œåˆ™åº”ä»…å¿½ç•¥å†æ¬¡æ‰§è¡Œè¿ç§»å‘½ä»¤ã€‚</li><li>åˆå§‹åŒ–å®¹å™¨æ˜¯å»¶è¿Ÿåº”ç”¨ç¨‹åºåˆå§‹åŒ–ç›´åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¾èµ–é¡¹å¯ç”¨çš„å¾ˆå¥½çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä¾èµ–äºæ–½åŠ APIè¯·æ±‚é€Ÿç‡é™åˆ¶çš„ APIï¼Œåˆ™æ‚¨å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½æ¥æ”¶æ¥è‡ªè¯¥ API çš„å“åº”ã€‚åœ¨åº”ç”¨ç¨‹åºå®¹å™¨ä¸­å®ç°æ­¤é€»è¾‘å¯èƒ½å¾ˆå¤æ‚ï¼›å› ä¸ºå®ƒéœ€è¦ä¸å¥åº·å’Œå°±ç»ªçŠ¶æ€æ¢æµ‹å™¨ç»“åˆä½¿ç”¨ã€‚ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨ï¼Œè¯¥å®¹å™¨è¦ç­‰åˆ°APIå‡†å¤‡å¥½åæ‰èƒ½æˆåŠŸé€€å‡ºã€‚åªæœ‰åœ¨åˆå§‹åŒ–å®¹å™¨æˆåŠŸå®Œæˆå…¶å·¥ä½œä¹‹åï¼Œåº”ç”¨ç¨‹åºå®¹å™¨æ‰ä¼šå¯åŠ¨ã€‚</li><li>åˆå§‹åŒ–å®¹å™¨ä¸èƒ½åƒåº”ç”¨ç¨‹åºå®¹å™¨é‚£æ ·ä½¿ç”¨è¿è¡ŒçŠ¶å†µå’Œå°±ç»ªæ¢é’ˆã€‚åŸå› æ˜¯å®ƒä»¬è¦æˆåŠŸå¯åŠ¨å’Œé€€å‡ºï¼Œå°±åƒ Jobs å’Œ CronJobs çš„è¡Œä¸ºä¸€æ ·ã€‚</li><li>åŒä¸€Pod ä¸Šçš„æ‰€æœ‰å®¹å™¨å…±äº«ç›¸åŒçš„å·å’Œç½‘ç»œã€‚æ‚¨å¯ä»¥åˆ©ç”¨æ­¤åŠŸèƒ½åœ¨åº”ç”¨ç¨‹åºåŠå…¶åˆå§‹åŒ–å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®ã€‚</li></ul><blockquote><p>æ­£å¦‚æˆ‘ä»¬åˆšåˆšè®¨è®ºçš„é‚£æ ·ï¼ŒInit å®¹å™¨æ€»æ˜¯æ¯”åŒä¸€ä¸ª Pod ä¸Šçš„å…¶ä»–åº”ç”¨ç¨‹åºå®¹å™¨å…ˆå¯åŠ¨ã€‚ç»“æœï¼Œè°ƒåº¦ç¨‹åºå¯¹ Init å®¹å™¨çš„èµ„æºå’Œé™åˆ¶èµ‹äºˆäº†æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚å¿…é¡»ä»”ç»†è€ƒè™‘è¿™ç§è¡Œä¸ºï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸è‰¯åæœã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨å’Œä¸€ä¸ªåº”ç”¨ç¨‹åºå®¹å™¨ï¼Œå¹¶ä¸”å°†åˆå§‹åŒ–å®¹å™¨çš„èµ„æºå’Œé™åˆ¶è®¾ç½®ä¸ºé«˜äºåº”ç”¨ç¨‹åºå®¹å™¨çš„èµ„æºå’Œé™åˆ¶ï¼Œé‚£ä¹ˆåªæœ‰åœ¨æœ‰ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹æ»¡è¶³åˆå§‹åŒ–çš„æƒ…å†µä¸‹ï¼Œæ‰è°ƒåº¦æ•´ä¸ª Pod å®¹å™¨è¦æ±‚ã€‚æ¢å¥è¯è¯´ï¼Œå³ä½¿æœ‰ä¸€ä¸ªæœªä½¿ç”¨çš„èŠ‚ç‚¹å¯ä»¥åœ¨å…¶ä¸­è¿è¡Œåº”ç”¨ç¨‹åºå®¹å™¨ï¼Œä½†å¦‚æœåˆå§‹åŒ–å®¹å™¨å…·æœ‰è¯¥èŠ‚ç‚¹å¯ä»¥å¤„ç†çš„æ›´é«˜èµ„æºå…ˆå†³æ¡ä»¶ï¼Œåˆ™ Pod ä¹Ÿä¸ä¼šéƒ¨ç½²åˆ°è¯¥èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œåœ¨å®šä¹‰åˆå§‹åŒ–å®¹å™¨çš„è¯·æ±‚å’Œé™åˆ¶æ—¶ï¼Œæ‚¨åº”å°½å¯èƒ½ä¸¥æ ¼ã€‚æœ€ä½³åšæ³•æ˜¯ï¼Œé™¤éç»å¯¹å¿…è¦ï¼Œå¦åˆ™è¯·å‹¿å°†è¿™äº›å‚æ•°è®¾ç½®ä¸ºé«˜äºåº”ç”¨ç¨‹åºå®¹å™¨çš„å€¼ã€‚</p></blockquote><h3><span id="ä½¿ç”¨-init-å®¹å™¨">ä½¿ç”¨ Init å®¹å™¨</span></h3><p>ä¸‹é¢çš„ä¾‹å­å®šä¹‰äº†ä¸€ä¸ªå…·æœ‰ 2 ä¸ª Init å®¹å™¨çš„ç®€å• Podã€‚ ç¬¬ä¸€ä¸ªç­‰å¾… myservice å¯åŠ¨ï¼Œç¬¬äºŒä¸ªç­‰å¾… mydb å¯åŠ¨ã€‚ ä¸€æ—¦è¿™ä¸¤ä¸ª Initå®¹å™¨ éƒ½å¯åŠ¨å®Œæˆï¼ŒPod å°†å¯åŠ¨ spec åŒºåŸŸä¸­çš„åº”ç”¨å®¹å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: myapp-pod</span><br><span class="line">  labels:</span><br><span class="line">    app: myapp</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: myapp-container</span><br><span class="line">    image: busybox:1.28</span><br><span class="line">    command: [&#39;sh&#39;, &#39;-c&#39;, &#39;echo The app is running! &amp;&amp; sleep 3600&#39;]</span><br><span class="line">  initContainers:</span><br><span class="line">  - name: init-myservice</span><br><span class="line">    image: busybox:1.28</span><br><span class="line">    command: [&#39;sh&#39;, &#39;-c&#39;, &quot;until nslookup myservice.$(cat &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;namespace).svc.cluster.local; do echo waiting for myservice; sleep 2; done&quot;]</span><br><span class="line">  - name: init-mydb</span><br><span class="line">    image: busybox:1.28</span><br><span class="line">    command: [&#39;sh&#39;, &#39;-c&#39;, &quot;until nslookup mydb.$(cat &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;namespace).svc.cluster.local; do echo waiting for mydb; sleep 2; done&quot;]</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ Kubernetes 1.6 ç‰ˆæœ¬çš„æ–°è¯­æ³•ï¼Œå°½ç®¡è€çš„ annotation è¯­æ³•ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚æˆ‘ä»¬å·²ç»æŠŠ Init å®¹å™¨çš„å£°æ˜ç§»åˆ° spec ä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: myapp-pod</span><br><span class="line">  labels:</span><br><span class="line">    app: myapp</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: myapp-container</span><br><span class="line">    image: busybox</span><br><span class="line">    command: [&#39;sh&#39;, &#39;-c&#39;, &#39;echo The app is running! &amp;&amp; sleep 3600&#39;]</span><br><span class="line">  initContainers:</span><br><span class="line">  - name: init-myservice</span><br><span class="line">    image: busybox</span><br><span class="line">    command: [&#39;sh&#39;, &#39;-c&#39;, &#39;until nslookup myservice; do echo waiting for myservice; sleep 2; done;&#39;]</span><br><span class="line">  - name: init-mydb</span><br><span class="line">    image: busybox</span><br><span class="line">    command: [&#39;sh&#39;, &#39;-c&#39;, &#39;until nslookup mydb; do echo waiting for mydb; sleep 2; done;&#39;]</span><br></pre></td></tr></table></figure><p>1.5 ç‰ˆæœ¬çš„è¯­æ³•åœ¨ 1.6 ç‰ˆæœ¬ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬æ¨èä½¿ç”¨ 1.6 ç‰ˆæœ¬çš„æ–°è¯­æ³•ã€‚ åœ¨ Kubernetes 1.6 ç‰ˆæœ¬ä¸­ï¼ŒInit å®¹å™¨åœ¨ API ä¸­æ–°å»ºäº†ä¸€ä¸ªå­—æ®µã€‚ è™½ç„¶æœŸæœ›ä½¿ç”¨ beta ç‰ˆæœ¬çš„ annotationï¼Œä½†åœ¨æœªæ¥å‘è¡Œç‰ˆå°†ä¼šè¢«åºŸå¼ƒæ‰ã€‚</p><p>åœ¨æ‰€æœ‰çš„ Init å®¹å™¨æ²¡æœ‰æˆåŠŸä¹‹å‰ï¼ŒPod å°†ä¸ä¼šå˜æˆ Ready çŠ¶æ€ã€‚ Init å®¹å™¨çš„ç«¯å£å°†ä¸ä¼šåœ¨ Service ä¸­è¿›è¡Œèšé›†ã€‚ æ­£åœ¨åˆå§‹åŒ–ä¸­çš„ Pod å¤„äº Pending çŠ¶æ€ï¼Œä½†åº”è¯¥ä¼šå°†æ¡ä»¶ Initializing è®¾ç½®ä¸º trueã€‚</p><p>å¦‚æœ Pod é‡å¯ï¼Œæ‰€æœ‰ Init å®¹å™¨å¿…é¡»é‡æ–°æ‰§è¡Œã€‚</p><p>å¯¹ Init å®¹å™¨ spec çš„ä¿®æ”¹ï¼Œè¢«é™åˆ¶åœ¨å®¹å™¨ image å­—æ®µä¸­ã€‚ æ›´æ”¹ Init å®¹å™¨çš„ image å­—æ®µï¼Œç­‰ä»·äºé‡å¯è¯¥ Podã€‚</p><h3><span id="ephemeral-å®¹å™¨">Ephemeral å®¹å™¨</span></h3><p>ä¸´æ—¶å®¹å™¨ä¸å…¶ä»–å®¹å™¨çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä»¬ç¼ºå°‘å¯¹èµ„æºæˆ–æ‰§è¡Œçš„ä¿è¯ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šè‡ªåŠ¨é‡å¯ï¼Œå› æ­¤ä¸é€‚ç”¨äºæ„å»ºåº”ç”¨ç¨‹åºã€‚ä¸´æ—¶å®¹å™¨ä½¿ç”¨ä¸å¸¸è§„å®¹å™¨ç›¸åŒçš„ <code>ContainerSpec</code> æ®µè¿›è¡Œæè¿°ï¼Œä½†è®¸å¤šå­—æ®µæ˜¯ä¸ç›¸å®¹ä¸”ä¸å…è®¸çš„ã€‚</p><ul><li>ä¸´æ—¶å®¹å™¨æ²¡æœ‰ç«¯å£é…ç½®ï¼Œå› æ­¤åƒ <code>ports</code>ï¼Œ<code>livenessProbe</code>ï¼Œ<code>readinessProbe</code> è¿™æ ·çš„å­—æ®µæ˜¯ä¸å…è®¸çš„ã€‚</li><li>Pod èµ„æºåˆ†é…æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ <code>resources</code> é…ç½®æ˜¯ä¸å…è®¸çš„ã€‚</li><li>æœ‰å…³å…è®¸å­—æ®µçš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚è§<a href="https://link.zhihu.com/?target=https%3A//kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/%23ephemeralcontainer-v1-core">ä¸´æ—¶å®¹å™¨å‚è€ƒæ–‡æ¡£</a>ã€‚</li></ul><p>ä¸´æ—¶å®¹å™¨æ˜¯ä½¿ç”¨ API ä¸­çš„ä¸€ç§ç‰¹æ®Šçš„ <code>ephemeralcontainers</code> å¤„ç†å™¨è¿›è¡Œåˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯ç›´æ¥æ·»åŠ åˆ° <code>pod.spec</code> æ®µï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ <code>kubectl edit</code> æ¥æ·»åŠ ä¸€ä¸ªä¸´æ—¶å®¹å™¨ã€‚</p><p>ä¸å¸¸è§„å®¹å™¨ä¸€æ ·ï¼Œå°†ä¸´æ—¶å®¹å™¨æ·»åŠ åˆ° Pod åï¼Œå°†ä¸èƒ½æ›´æ”¹æˆ–åˆ é™¤ä¸´æ—¶å®¹å™¨ã€‚</p><h3><span id="ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦-ephemeral-å®¹å™¨">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ Ephemeral å®¹å™¨ï¼Ÿ</span></h3><p>æˆ‘ä»¬çŸ¥é“å®¹å™¨çš„ä¼˜ç‚¹æ˜¯å®ƒä»¬é€šè¿‡ä½¿ç”¨ä¸å˜æ–¹æ³•æä¾›æ‰€æœ‰å¿…éœ€çš„ä¾èµ–é¡¹æ¥è¿è¡Œéš”ç¦»çš„è¿›ç¨‹ã€‚é€šè¿‡ä»…å°†æ‰€éœ€çš„ä¾èµ–é¡¹æ·»åŠ åˆ°é•œåƒä¸­ï¼Œå®¹å™¨å¯ä»¥é™ä½æ”»å‡»é¢å¹¶æä¾›æ›´å¿«çš„å¯åŠ¨å’Œéƒ¨ç½²ã€‚ä½¿ç”¨ â€œdistrolessâ€ æ–¹æ³•æ„å»ºå®¹å™¨é•œåƒï¼ˆåŸºäº Scratch ï¼‰ï¼Œé€šè¿‡ä»…åŒ…å«å·²ç¼–è¯‘çš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°†å®¹å™¨é•œåƒæå‡åˆ°äº†ä¸€ä¸ªæ–°çš„æ°´å¹³ã€‚ä¸æ™®é€šçš„å®¹å™¨é•œåƒä¸åŒï¼Œå®ƒä»¬ä¸åŸºäºä»»ä½•ç§ç±»çš„ Linux å‘è¡Œç‰ˆï¼Œå› æ­¤ä¸åŒ…å«ä»»ä½•å…¶ä»–å¯é€šè¿‡ <code>kubectl exec</code>  æ‰§è¡Œä»¥è¿›è¡Œæ•…éšœæ’é™¤çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œå·¥å…·ã€‚è¿™å°±å†³å®šäº†è¯¥å®¹å™¨æœ‰åŠ©äºæä¾›å®‰å…¨å¯é çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œä½†ä¹Ÿå¾ˆéš¾åœ¨é—®é¢˜å‘ç”Ÿæ—¶è¿›è¡Œè°ƒè¯•ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸´æ—¶å®¹å™¨å‘æŒ¥ä½œç”¨ã€‚å®ƒä»¬å®ç°äº†è°ƒè¯•å®¹å™¨é™„åŠ åˆ°ä¸»è¿›ç¨‹çš„åŠŸèƒ½ï¼Œç„¶åä½ å¯ä»¥ç”¨äºè°ƒè¯•ä»»ä½•ç±»å‹çš„é—®é¢˜ã€‚è°ƒè¯•å®¹å™¨å¯ä»¥åŸºäºä»»ä½•é•œåƒï¼Œå› æ­¤å¯ä»¥æ ¹æ®æ‚¨çš„éœ€æ±‚è¿›è¡Œå®šåˆ¶ã€‚æ‚¨å¯ä»¥æ„å»ºè‡ªå·±çš„è°ƒè¯•é•œåƒï¼Œå…¶ä¸­åŒ…å«ç‰¹æ®Šçš„è°ƒè¯•äºŒè¿›åˆ¶æ–‡ä»¶æˆ–ä»…åŒ…å« curlï¼ŒOpenSSL å’Œ MongoDBå®¢æˆ·ç«¯ä¹‹ç±»çš„å·¥å…·ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©Linuxå‘è¡Œç‰ˆï¼ˆå¦‚Ubuntuï¼‰æˆ–ä»…è¿è¡ŒBusyboxé•œåƒï¼Œè¿™ä¸¤ä¸ªé•œåƒéƒ½å·²ç»åŒ…å«äº†è®¸å¤šæœ‰ç”¨çš„å·¥å…·ã€‚</p><h3><span id="å¦‚ä½•ä½¿ç”¨ä¸´æ—¶å®¹å™¨">å¦‚ä½•ä½¿ç”¨ä¸´æ—¶å®¹å™¨ï¼Ÿ</span></h3><p>ä¸´æ—¶å®¹å™¨æ˜¯alphaåŠŸèƒ½ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹å¤„äºç¦ç”¨çŠ¶æ€ã€‚æ‚¨å°†éœ€è¦æ¿€æ´»ä»¥ä¸‹åŠŸèƒ½é—¨æ‰èƒ½ä½¿ç”¨å®ƒä»¬ï¼š</p><ul><li>ä¸´æ—¶å®¹å™¨</li><li>PodShareProcessNamespaceï¼ˆv1.16ä¸­çš„betaç‰ˆï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹å·²å¯ç”¨ï¼‰</li></ul><p>æœ¬èŠ‚ä¸­çš„ç¤ºä¾‹æ¼”ç¤ºäº†ä¸´æ—¶å®¹å™¨å¦‚ä½•å‡ºç°åœ¨ API ä¸­ã€‚ é€šå¸¸ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>kubectl</code> æ’ä»¶è¿›è¡Œæ•…éšœæ’æŸ¥ï¼Œä»è€Œè‡ªåŠ¨åŒ–æ‰§è¡Œè¿™äº›æ­¥éª¤ã€‚</p><p>ä¸´æ—¶å®¹å™¨æ˜¯ä½¿ç”¨ Pod çš„ <code>ephemeralcontainers</code> å­èµ„æºåˆ›å»ºçš„ï¼Œå¯ä»¥ä½¿ç”¨ <code>kubectl --raw</code> å‘½ä»¤è¿›è¡Œæ˜¾ç¤ºã€‚é¦–å…ˆæè¿°ä¸´æ—¶å®¹å™¨è¢«æ·»åŠ ä¸ºä¸€ä¸ª <code>EphemeralContainers</code> åˆ—è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;apiVersion&quot;: &quot;v1&quot;,</span><br><span class="line">    &quot;kind&quot;: &quot;EphemeralContainers&quot;,</span><br><span class="line">    &quot;metadata&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;example-pod&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;ephemeralContainers&quot;: [&#123;</span><br><span class="line">        &quot;command&quot;: [</span><br><span class="line">            &quot;sh&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;image&quot;: &quot;busybox&quot;,</span><br><span class="line">        &quot;imagePullPolicy&quot;: &quot;IfNotPresent&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;debugger&quot;,</span><br><span class="line">        &quot;stdin&quot;: true,</span><br><span class="line">        &quot;tty&quot;: true,</span><br><span class="line">        &quot;terminationMessagePolicy&quot;: &quot;File&quot;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ›´æ–°å·²è¿è¡Œçš„ä¸´æ—¶å®¹å™¨ <code>example-pod</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl replace --raw &#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;default&#x2F;pods&#x2F;example-pod&#x2F;ephemeralcontainers  -f ec.json</span><br></pre></td></tr></table></figure><p>è¿™å°†è¿”å›ä¸´æ—¶å®¹å™¨çš„æ–°åˆ—è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;kind&quot;:&quot;EphemeralContainers&quot;,</span><br><span class="line">   &quot;apiVersion&quot;:&quot;v1&quot;,</span><br><span class="line">   &quot;metadata&quot;:&#123;</span><br><span class="line">      &quot;name&quot;:&quot;example-pod&quot;,</span><br><span class="line">      &quot;namespace&quot;:&quot;default&quot;,</span><br><span class="line">      &quot;selfLink&quot;:&quot;&#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;default&#x2F;pods&#x2F;example-pod&#x2F;ephemeralcontainers&quot;,</span><br><span class="line">      &quot;uid&quot;:&quot;a14a6d9b-62f2-4119-9d8e-e2ed6bc3a47c&quot;,</span><br><span class="line">      &quot;resourceVersion&quot;:&quot;15886&quot;,</span><br><span class="line">      &quot;creationTimestamp&quot;:&quot;2019-08-29T06:41:42Z&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;ephemeralContainers&quot;:[</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;name&quot;:&quot;debugger&quot;,</span><br><span class="line">         &quot;image&quot;:&quot;busybox&quot;,</span><br><span class="line">         &quot;command&quot;:[</span><br><span class="line">            &quot;sh&quot;</span><br><span class="line">         ],</span><br><span class="line">         &quot;resources&quot;:&#123;</span><br><span class="line"></span><br><span class="line">         &#125;,</span><br><span class="line">         &quot;terminationMessagePolicy&quot;:&quot;File&quot;,</span><br><span class="line">         &quot;imagePullPolicy&quot;:&quot;IfNotPresent&quot;,</span><br><span class="line">         &quot;stdin&quot;:true,</span><br><span class="line">         &quot;tty&quot;:true</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ–°åˆ›å»ºçš„ä¸´æ—¶å®¹å™¨çš„çŠ¶æ€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe pod example-pod</span><br><span class="line">...</span><br><span class="line">Ephemeral Containers:</span><br><span class="line">  debugger:</span><br><span class="line">    Container ID:  docker:&#x2F;&#x2F;cf81908f149e7e9213d3c3644eda55c72efaff67652a2685c1146f0ce151e80f</span><br><span class="line">    Image:         busybox</span><br><span class="line">    Image ID:      docker-pullable:&#x2F;&#x2F;busybox@sha256:9f1003c480699be56815db0f8146ad2e22efea85129b5b5983d0e0fb52d9ab70</span><br><span class="line">    Port:          &lt;none&gt;</span><br><span class="line">    Host Port:     &lt;none&gt;</span><br><span class="line">    Command:</span><br><span class="line">      sh</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Thu, 29 Aug 2019 06:42:21 +0000</span><br><span class="line">    Ready:          False</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:    &lt;none&gt;</span><br><span class="line">    Mounts:         &lt;none&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿æ¥åˆ°æ–°çš„ä¸´æ—¶å®¹å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl attach -it example-pod -c debugger</span><br></pre></td></tr></table></figure><p>å¦‚æœå¯ç”¨äº†è¿›ç¨‹å‘½åç©ºé—´å…±äº«ï¼Œåˆ™å¯ä»¥æŸ¥çœ‹è¯¥ Pod æ‰€æœ‰å®¹å™¨ä¸­çš„è¿›ç¨‹ã€‚ ä¾‹å¦‚ï¼Œè¿è¡Œä¸Šè¿° <code>attach</code> æ“ä½œåï¼Œåœ¨è°ƒè¯•å™¨å®¹å™¨ä¸­è¿è¡Œ <code>ps</code> æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨ &quot;debugger&quot; ä¸´æ—¶å®¹å™¨å†…ä¸­è¿è¡Œæ­¤ shell å‘½ä»¤</span><br><span class="line">$ ps auxww</span><br></pre></td></tr></table></figure><p>è¿è¡Œå‘½ä»¤åï¼Œè¾“å‡ºç±»ä¼¼äºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PID   USER     TIME  COMMAND</span><br><span class="line">    1 root      0:00 &#x2F;pause</span><br><span class="line">    6 root      0:00 nginx: master process nginx -g daemon off;</span><br><span class="line">   11 101       0:00 nginx: worker process</span><br><span class="line">   12 101       0:00 nginx: worker process</span><br><span class="line">   13 101       0:00 nginx: worker process</span><br><span class="line">   14 101       0:00 nginx: worker process</span><br><span class="line">   15 101       0:00 nginx: worker process</span><br><span class="line">   16 101       0:00 nginx: worker process</span><br><span class="line">   17 101       0:00 nginx: worker process</span><br><span class="line">   18 101       0:00 nginx: worker process</span><br><span class="line">   19 root      0:00 &#x2F;pause</span><br><span class="line">   24 root      0:00 sh</span><br><span class="line">   29 root      0:00 ps auxww</span><br></pre></td></tr></table></figure><h3><span id="æ€»ç»“">æ€»ç»“</span></h3><p>æœ¬æ–‡ç®€å•ä»‹ç»äº†æ ‡å‡†å®¹å™¨ï¼ŒSidecar å®¹å™¨ï¼ŒInit å®¹å™¨ï¼ŒEphemeral å®¹å™¨ 4 ç§ç±»å‹çš„ Containersã€‚éšç€ Kubernetes æ—¥ç›Šæ™®åŠï¼Œæˆ‘ä»¬éœ€è¦å……åˆ†æŒæ¡è¿™å‡ ç§ç±»å‹å®¹å™¨åŸç†å’Œä½¿ç”¨æ–¹æ³•ï¼Œæ‰èƒ½æ›´å¥½åœ°æœåŠ¡ä¸šåŠ¡ã€‚</p><p>æ­¤å¤– Sidecar å®¹å™¨å°†ä¼šæˆä¸ºæœªæ¥è½¯ä»¶äº¤ä»˜çš„ä¸€ç§æ–°çš„æ–¹å¼ï¼Œå‚ç…§ Dapr ç­‰ï¼Œä¸åŒçš„å›¢é˜Ÿæä¾›è‡ªå·±çš„åŠŸèƒ½å®¹å™¨ï¼Œç„¶åé€‰æ‹©æ€§æ³¨å…¥ Sidecar åˆ°ä¸»ä¸šåŠ¡å®¹å™¨ï¼Œå®ç°è§£è€¦ã€‚</p><h2><span id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</span></h2><ol><li><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></li><li><a href="https://zhuanlan.zhihu.com/p/145233597" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/145233597</a></li><li><a href="https://cloud.tencent.com/developer/article/1645954" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1645954</a></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;div id=&quot;vip-container&quot;&gt;&lt;p&gt;æˆªæ­¢ç›®å‰ Kubernetes 1.18ï¼ŒKubernetes å·²ç»æ”¯æŒæ ‡å‡†å®¹å™¨ï¼ŒSidecar å®¹å™¨ï¼ŒInit å®¹å™¨ï¼ŒEphemeral å®¹å™¨ 4 ç§ç±»å‹çš„ Containersã€‚æœ¬æ–‡æˆ‘ä»¬è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™ 4
        
      
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>è¶…èµï¼Œè…¾è®¯å¼€æºè¿ç»´å¿…å¤‡æµ·é‡æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿï¼</title>
    <link href="https://www.hi-linux.com/posts/4224.html"/>
    <id>https://www.hi-linux.com/posts/4224.html</id>
    <published>2021-07-27T01:00:00.000Z</published>
    <updated>2021-07-28T01:17:17.351Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>ä»Šå¤©æ¨èçš„è¿™ä¸ªé¡¹ç›®æ˜¯ã€Œbk-jobã€â€”â€” è“é²¸ä½œä¸šå¹³å° (Job)ï¼Œä¸€å¥—è…¾è®¯å¼€æºçš„è¿ç»´è„šæœ¬ç®¡ç†ç³»ç»Ÿï¼Œå…·å¤‡æµ·é‡ä»»åŠ¡å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p><p>é™¤äº†æ”¯æŒè„šæœ¬æ‰§è¡Œã€æ–‡ä»¶åˆ†å‘ã€å®šæ—¶ä»»åŠ¡ç­‰ä¸€ç³»åˆ—åŸºç¡€è¿ç»´åœºæ™¯ä»¥å¤–ï¼Œè¿˜æ”¯æŒé€šè¿‡æµç¨‹è°ƒåº¦èƒ½åŠ›å°†é›¶ç¢çš„å•ä¸ªä»»åŠ¡ç»„è£…æˆä¸€ä¸ªè‡ªåŠ¨åŒ–ä½œä¸šæµç¨‹ï¼›</p><p>è€Œæ¯ä¸ªä½œä¸šéƒ½å¯åšä¸ºä¸€ä¸ªåŸå­èŠ‚ç‚¹ï¼Œæä¾›ç»™ä¸Šå±‚æˆ–å‘¨è¾¹ç³»ç»Ÿ/å¹³å°ä½¿ç”¨ï¼Œå®ç°è·¨ç³»ç»Ÿè°ƒåº¦è‡ªåŠ¨åŒ–ã€‚</p><a id="more"></a><h2><span id="ä¼˜åŠ¿">ä¼˜åŠ¿</span></h2><ul><li><p>å®‰å…¨å¯é çš„é«˜å±å‘½ä»¤æ£€æµ‹èƒ½åŠ›</p></li><li><p>å®Œå–„çš„è„šæœ¬ç‰ˆæœ¬ç®¡ç†</p></li><li><p>ä½œä¸šç¼–æ’ï¼Œä¸€åˆ‡çš†åœºæ™¯</p></li><li><p>åŸæ±åŸå‘³çš„ Cron å®šæ—¶ä»»åŠ¡</p></li><li><p>é«˜æ‰©å±•æ€§çš„æ–‡ä»¶æºç®¡ç†èƒ½åŠ›</p></li></ul><p><code>bk-job</code> æä¾›äº†å¿«é€Ÿæ‰§è¡Œã€ä»»åŠ¡ç¼–æ’ã€å®šæ—¶æ‰§è¡Œç­‰æ ¸å¿ƒæœåŠ¡ï¼Œå¤šé‡ç»„åˆï¼Œæ»¡è¶³ä¼ä¸šä¸åŒåœºæ™¯çš„éœ€æ±‚ï¼š</p><ul><li><p>å¿«é€Ÿæ‰§è¡Œï¼šæä¾›ä¸´æ—¶æ€§ä¸”å¤šå˜çš„å¿«é€Ÿä¸€æ¬¡æ€§æ“ä½œå…¥å£ï¼Œç”¨å®Œå³èµ°</p></li><li><p>ä»»åŠ¡ç¼–æ’ï¼šå¯¹äºé‡å¤æ€§çš„æ“ä½œç»„åˆï¼Œå¯ä»¥é€šè¿‡ç¼–æ’åŠŸèƒ½å°†å…¶æ²‰æ·€ä¸º â€œä½œä¸šâ€ï¼Œæ–¹ä¾¿ç®¡ç†å’Œä½¿ç”¨</p></li><li><p>å®šæ—¶æ‰§è¡Œï¼šæ”¯æŒç”¨æˆ·æŒ‰ä¸šåŠ¡é€»è¾‘è¯‰æ±‚è®¾ç½®å‘¨æœŸæ€§æˆ–ä¸€æ¬¡æ€§çš„å®šæœŸæ‰§è¡Œè®¡åˆ’</p></li><li><p>è„šæœ¬ç®¡ç†ï¼šå°†è„šæœ¬ä»¥äº‘åŒ–æ¨¡å¼ç»Ÿä¸€ç®¡ç†ï¼Œæ›´å¥½çš„æ”¯æŒä½œä¸šç¼–æ’å’Œå‘¨è¾¹ç³»ç»Ÿè°ƒåº¦çš„çµæ´»åº¦</p></li><li><p>è´¦å·ç®¡ç†ï¼šç®¡ç†æœåŠ¡å™¨ OS çš„æ‰§è¡Œè´¦æˆ·ï¼Œå¦‚ Linux çš„ rootï¼ŒWindows çš„ administrator ç­‰ç­‰</p></li><li><p>æ¶ˆæ¯é€šçŸ¥ï¼šæ»¡è¶³ä¸šåŠ¡æŒ‰ç®¡ç†éœ€æ±‚è®¾ç½®ä»»åŠ¡ä¸åŒçŠ¶æ€çš„æ‰§è¡Œç»“æœæ¶ˆæ¯é€šçŸ¥</p></li><li><p>æ–‡ä»¶æºç®¡ç†ï¼šå¼€æ”¾æ–‡ä»¶æºå¯¹æ¥æ’ä»¶èƒ½åŠ›ï¼Œæ»¡è¶³ä»ä¸åŒæ–‡ä»¶ç³»ç»Ÿç±»å‹æ‹‰å–æ–‡ä»¶å¹¶ä¼ è¾“çš„è¯‰æ±‚</p></li><li><p>è¿è¥åˆ†æï¼šæä¾›å¹³å°çš„è¿è¥ç»Ÿè®¡æ•°æ®å±•ç¤ºï¼ŒåŠ©åŠ›ç®¡ç†å‘˜æ›´å…¨æ–¹ä½çš„äº†è§£å¹³å°çš„è¿è¡Œæƒ…å†µ</p></li><li><p>å¹³å°ç®¡ç†ï¼šä¸°å¯Œçš„å¹³å°ç®¡ç†å‘˜å·¥å…·ï¼ŒåŒ…æ‹¬ä½†ä¸ä»…é™äºä¿¡æ¯æ›´æ”¹ã€æ¶ˆæ¯æ¸ é“è®¾ç½®ã€é«˜å±è¯­å¥æ£€æµ‹è§„åˆ™ã€åŠŸèƒ½é™åˆ¶è®¾ç½®ã€å…¬å…±è„šæœ¬ç®¡ç†ã€åå°æœåŠ¡çŠ¶æ€å±•ç¤ºç­‰ç­‰</p></li></ul><h2><span id="æ¶æ„è®¾è®¡">æ¶æ„è®¾è®¡</span></h2><p><img src="https://img.hi-linux.com/staticfile/architecture-2021-07-15-b41cpq.png" alt></p><p>æ›´å¤šé¡¹ç›®è¯¦æƒ…è¯·æŸ¥çœ‹é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/Tencent/bk-job" target="_blank" rel="noopener">https://github.com/Tencent/bk-job</a></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ GitHub ç²¾é€‰ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/6cudv978%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/6cudv978ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ¨èçš„è¿™ä¸ªé¡¹ç›®æ˜¯ã€Œbk-jobã€â€”â€” è“é²¸ä½œä¸šå¹³å° (Job)ï¼Œä¸€å¥—è…¾è®¯å¼€æºçš„è¿ç»´è„šæœ¬ç®¡ç†ç³»ç»Ÿï¼Œå…·å¤‡æµ·é‡ä»»åŠ¡å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†æ”¯æŒè„šæœ¬æ‰§è¡Œã€æ–‡ä»¶åˆ†å‘ã€å®šæ—¶ä»»åŠ¡ç­‰ä¸€ç³»åˆ—åŸºç¡€è¿ç»´åœºæ™¯ä»¥å¤–ï¼Œè¿˜æ”¯æŒé€šè¿‡æµç¨‹è°ƒåº¦èƒ½åŠ›å°†é›¶ç¢çš„å•ä¸ªä»»åŠ¡ç»„è£…æˆä¸€ä¸ªè‡ªåŠ¨åŒ–ä½œä¸šæµç¨‹ï¼›&lt;/p&gt;
&lt;p&gt;è€Œæ¯ä¸ªä½œä¸šéƒ½å¯åšä¸ºä¸€ä¸ªåŸå­èŠ‚ç‚¹ï¼Œæä¾›ç»™ä¸Šå±‚æˆ–å‘¨è¾¹ç³»ç»Ÿ/å¹³å°ä½¿ç”¨ï¼Œå®ç°è·¨ç³»ç»Ÿè°ƒåº¦è‡ªåŠ¨åŒ–ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¼€æº" scheme="https://www.hi-linux.com/categories/%E5%BC%80%E6%BA%90/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="è…¾è¿…" scheme="https://www.hi-linux.com/tags/%E8%85%BE%E8%BF%85/"/>
    
      <category term="å¼€æº" scheme="https://www.hi-linux.com/tags/%E5%BC%80%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>å¾®è½¯å¼€æºè‡ªæœ‰äº‘æœåŠ¡å™¨ä¸“å± Linux å‘è¡Œç‰ˆ CBL-Marinerï¼Œå¯åœ¨ GitHub å…è´¹ä¸‹è½½ï¼</title>
    <link href="https://www.hi-linux.com/posts/9114.html"/>
    <id>https://www.hi-linux.com/posts/9114.html</id>
    <published>2021-07-23T01:00:00.000Z</published>
    <updated>2021-07-23T07:43:18.687Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p>è¿‘å¹´æ¥ï¼Œå¾®è½¯å¯¹ Linux çš„çˆ±è¶Šæ¥è¶Šå¤šï¼Œè¿™å·²ç»ä¸æ˜¯ä»€ä¹ˆç§˜å¯†äº†â€“çœ‹çœ‹ Windows Subsystem for Linux å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨å¾—çŸ¥å¾®è½¯è¿˜æœ‰è‡ªå·±çš„ Linux å‘è¡Œç‰ˆæ—¶ï¼Œä½ è¿˜æ˜¯å¯èƒ½ä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚</p></blockquote><p>å¾®è½¯è¿‘æ—¥å¼€æºäº†ä¸€æ¬¾å†…éƒ¨ä½¿ç”¨çš„ Linux å‘è¡Œç‰ˆâ€”â€”CBL-Marinerï¼ˆCBL å³ Common Base Linuxï¼‰ã€‚CBL-Mariner ä¸æ˜¯æ¡Œé¢ Linux è€Œæ˜¯æœåŠ¡å™¨ç«¯ Linuxï¼Œå®ƒè¢«ç”¨äºå¾®è½¯çš„äº‘åŸºç¡€è®¾æ–½ä»¥åŠè¾¹ç¼˜äº§å“å’ŒæœåŠ¡ã€‚CBL-Mariner æ—¨åœ¨ä¸ºè¿™äº›è®¾å¤‡å’ŒæœåŠ¡æä¾›ä¸€ä¸ªä¸€è‡´çš„å¹³å°ï¼Œå¹¶å¢å¼ºå¾®è½¯åœ¨ Linux æ›´æ–°æ–¹é¢ä¸æ—¶ä¿±è¿›çš„èƒ½åŠ›ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/maxresdefault-2021-07-22-yRdZjc.jpg" alt></p><p>CBL-Mariner çš„è®¾è®¡ç†å¿µæ˜¯é€šè¿‡æä¾›ä¸€ç»„å°çš„é€šç”¨æ ¸å¿ƒè½¯ä»¶åŒ…æ¥æ»¡è¶³äº‘å’Œè¾¹ç¼˜æœåŠ¡çš„æ™®ééœ€æ±‚ï¼ŒåŒæ—¶å…è®¸å„å›¢é˜Ÿåœ¨é€šç”¨æ ¸å¿ƒä¹‹ä¸Šæ ¹æ®éœ€è¦å¼•å…¥é¢å¤–çš„è½¯ä»¶åŒ…ã€‚å®ƒæ˜¯è½»é‡çº§çš„å‘è¡Œç‰ˆï¼Œåªæ¶ˆè€—éå¸¸å°çš„ç£ç›˜å’Œå†…å­˜èµ„æºï¼Œå¯ä½œä¸ºå®¹å™¨æˆ–å®¹å™¨ä¸»æœºä½¿ç”¨ã€‚</p><p>CBL-Mariner éµå¾ª â€œé»˜è®¤å®‰å…¨(secure-by-default)â€ åŸåˆ™ï¼Œæ“ä½œç³»ç»Ÿçš„å¤§å¤šæ•°æ–¹é¢éƒ½ä»¥å®‰å…¨ä¸ºé‡ç‚¹ã€‚å®ƒåŒ…å«åŠ å›ºå†…æ ¸ã€ç­¾åæ›´æ–°ã€ASLRã€åŸºäºç¼–è¯‘å™¨çš„åŠ å›ºå’Œé˜²ç¯¡æ”¹æ—¥å¿—ç­‰ä¼—å¤šåŠŸèƒ½ã€‚æ‰€æœ‰ CBL-Mariner å®‰å…¨åŠŸèƒ½éƒ½å·²ç½—åˆ—åœ¨ GitHub Repo ä¸­ã€‚</p><p><strong>CBL-Mariner è½¯ä»¶åŒ…ç³»ç»Ÿæ˜¯åŸºäº RPM çš„ï¼Œè½¯ä»¶åŒ…æ›´æ–°ç³»ç»ŸåŒæ—¶ä½¿ç”¨ dnf å’Œ tdnfï¼Œåè€…å…¨ç§° Tiny DNFï¼Œæ˜¯ä¸€ä¸ªåŸºäº dnf çš„è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼Œæ¥è‡ª VMware çš„ Photon OSã€‚</strong></p><p>CBL-Mariner è¿˜æ”¯æŒåŸºäºé•œåƒçš„æ›´æ–°æœºåˆ¶ï¼Œå…¶ä½¿ç”¨ RPM-OSTree æ¥å®ç°ï¼Œrpm-ostree æ˜¯ä¸€ä¸ªåŸºäºOSTree çš„å¼€æºå·¥å…·ï¼Œç”¨äºç®¡ç†å¯å¯åŠ¨çš„ã€ä¸å¯å˜çš„ã€ç‰ˆæœ¬åŒ–çš„æ–‡ä»¶ç³»ç»Ÿæ ‘ã€‚rpm-ostree èƒŒåçš„æƒ³æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªå®¢æˆ·-æœåŠ¡å™¨æ¶æ„ï¼Œä»¥å¯é çš„æ–¹å¼ä¿æŒ Linux ä¸»æœºçš„æ›´æ–°å’Œä¸æœ€æ–°çš„è½¯ä»¶åŒ…åŒæ­¥ã€‚</p><p>å¾®è½¯è¡¨ç¤ºï¼Œå¼€æº CBL-Mariner Linux å‘è¡Œç‰ˆæ˜¯ä»–ä»¬å¯¹å¹¿æ³›çš„ Linux æŠ€æœ¯ä¸æ–­å¢åŠ æŠ•èµ„çš„ä¸€éƒ¨åˆ†ï¼Œå°±å¦‚åŒæ­¤å‰çš„ SONiC, Azure Sphere OS å’Œ Windows Subsystem for Linux (WSL) ç­‰é¡¹ç›®ã€‚æ­¤å¤–è¿™ä¹Ÿæ˜¯å¾®è½¯å¯¹å¼€æºæ‰¿è¯ºçš„å…‘ç°ï¼Œä»¥åŠå¯¹ Linux ç¤¾åŒºçš„å›é¦ˆã€‚å¾®è½¯è¿˜è¡¨ç¤ºï¼ŒCBL-Mariner ä¸ä¼šæ”¹å˜ä»–ä»¬å¯¹ä»»ä½•ç°æœ‰ç¬¬ä¸‰æ–¹ Linux å‘è¡Œç‰ˆçš„æ€åº¦æˆ–æ‰¿è¯ºã€‚</p><blockquote><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/microsoft/CBL-Mariner" target="_blank" rel="noopener">https://github.com/microsoft/CBL-Mariner</a></p></blockquote><p>æ ¹æ®å¾®è½¯ Azure å›¢é˜Ÿæˆå‘˜ Juan Manuel Rey çš„ä»‹ç»ï¼ŒCBL-Mariner ç”± WSL2 å›¢é˜Ÿåˆ›é€ ï¼Œä½†ç›®å‰æ²¡æœ‰æä¾› ISO é•œåƒï¼Œéœ€è¦è‡ªå·±è¿›è¡Œæ„å»ºã€‚</p><p><img src="https://img.hi-linux.com/staticfile/8f06c7d5-3d30-40d4-b611-270fd3cc8cd0-2021-07-22-S9ksIe.png" alt></p><p><img src="https://img.hi-linux.com/staticfile/22f55ae0-d3ae-4488-b4ab-89536a8623f2-2021-07-22-9D2rI6.png" alt></p><p>è¯¦ç»†æ•™ç¨‹å¯å‚è€ƒï¼š</p><blockquote><ol><li><a href="https://linuxiac.com/microsoft-cbl-mariner-linux-1/" target="_blank" rel="noopener">https://linuxiac.com/microsoft-cbl-mariner-linux-1/</a></li><li><a href="https://blog.jreypo.io/2021/07/09/a-look-into-cbl-mariner-microsoft-internal-linux-distribution/" target="_blank" rel="noopener">https://blog.jreypo.io/2021/07/09/a-look-into-cbl-mariner-microsoft-internal-linux-distribution/</a></li></ol></blockquote><p>å¦‚æœä½ è§‰å¾—ä¸Šé¢çš„è‹±æ–‡æ–‡æ¡£çœ‹èµ·æ¥æ¯”è¾ƒè´¹åŠ²ï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ç¯‡ä¸­æ–‡æ–‡æ¡£ï¼š</p><blockquote><ol><li><a href="https://blog.csdn.net/aw77520/article/details/118958510" target="_blank" rel="noopener">https://blog.csdn.net/aw77520/article/details/118958510</a></li></ol></blockquote><p><strong>å‚è€ƒæ–‡æ¡£</strong></p><ol><li><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></li><li><a href="https://mp.weixin.qq.com/s/1d7tP_kKfXHrmqKYeyxyKA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/1d7tP_kKfXHrmqKYeyxyKA</a></li><li><a href="https://www.cnbeta.com/articles/tech/1152045.htm" target="_blank" rel="noopener">https://www.cnbeta.com/articles/tech/1152045.htm</a></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;div id=&quot;vip-container&quot;&gt;&lt;blockquote&gt;
&lt;p&gt;è¿‘å¹´æ¥ï¼Œå¾®è½¯å¯¹ Linux çš„çˆ±è¶Šæ¥è¶Šå¤šï¼Œè¿™å·²ç»ä¸æ˜¯ä»€ä¹ˆç§˜å¯†äº†â€“çœ‹çœ‹ Windows Subsystem for Linux å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨å¾—çŸ¥å¾®è½¯è¿˜æœ‰è‡ªå·±çš„ Linux
        
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="å¾®è½¯" scheme="https://www.hi-linux.com/tags/%E5%BE%AE%E8%BD%AF/"/>
    
      <category term="CBL-Mariner" scheme="https://www.hi-linux.com/tags/CBL-Mariner/"/>
    
  </entry>
  
  <entry>
    <title>ä¸¤ä¸ª Docker ä½¿ç”¨ç¥æŠ€ï¼Œ99% çš„äººéƒ½ä¸çŸ¥é“ï¼</title>
    <link href="https://www.hi-linux.com/posts/47156.html"/>
    <id>https://www.hi-linux.com/posts/47156.html</id>
    <published>2021-07-22T01:00:00.000Z</published>
    <updated>2021-07-22T01:38:22.462Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>æœ€è¿‘å‘ç°ä¸¤ä¸ªéå¸¸å¥½ç”¨çš„å·¥å…·ï¼Œä¸€ä¸ªæ˜¯ <code>runlike</code>ï¼Œä¸€ä¸ªæ˜¯ <code>whaler</code></p><ul><li><p><code>runlike</code>ï¼šé€šè¿‡å®¹å™¨æ‰“å°å‡ºå®¹å™¨çš„å¯åŠ¨å‘½ä»¤</p></li><li><p><code>whaler</code>ï¼šé€šè¿‡é•œåƒå¯¼å‡º<code>dockerfile</code></p></li></ul><p>å¬èµ·æ¥æ˜¯ä¸æ˜¯æƒ³è¯´ <code>N...B...</code> å“ˆå“ˆï¼Œé‚£å°±èµ°èµ·ï¼Ÿ</p><a id="more"></a><h2><span id="æ‰¾å›-docker-å®¹å™¨è¿è¡Œçš„å‘½ä»¤">æ‰¾å› Docker å®¹å™¨è¿è¡Œçš„å‘½ä»¤</span></h2><p>å¹³æ—¶å¯èƒ½å› ä¸ºæµ‹è¯•æˆ–è€…ä¸€äº›è§„èŒƒçš„æ“ä½œæ–¹å¼å¯¼è‡´å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå¿˜è®°äº†è¿™ä¸ªå®¹å™¨çš„å¯åŠ¨å‘½ä»¤æ˜¯ä»€ä¹ˆäº†ï¼Œåˆéœ€è¦æ‰¾å›æ¥åœ¨åˆ«çš„æœºå™¨ä¸Šåˆ›å»ºçš„æ—¶å€™ï¼Œå°±å¾ˆéº»çƒ¦ï¼Œå¯èƒ½å¾ˆå¤šäººä¼šæƒ³åˆ°é€šè¿‡ <code>docker inspect</code> åˆ†æè¾“å‡ºçš„ json æ–‡ä»¶ä¸­çš„<code>volume</code>ã€<code>ports</code>ã€<code>Env</code>ç­‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect $container_name</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤åº”è¯¥æ˜¯å¾ˆç†Ÿæ‚‰çš„ï¼ŒæŸ¥çœ‹å®¹å™¨çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/640-20210712102727538-2021-07-12-TYza77.jpg" alt></p><p>è™½ç„¶è¿™æ ·ä¹Ÿèƒ½æ‰¾åˆ°è¿è¡Œå®¹å™¨çš„å‘½ä»¤ï¼Œä½†æ˜¯ä¾æ—§è¿˜éœ€è¦æ—¶é—´å»æ•´ç†ï¼Œå› æ­¤è¿™é‡Œåˆ†äº«ä¸€ä¸ªå¯ä»¥ç›´æ¥æ‰“å°è¿è¡Œå‘½ä»¤çš„å·¥å…·<strong>runlike</strong>[1]ï¼Œåœ¨runlikeä¼ é€’ä¸€ä¸ªå®¹å™¨åç§°ï¼Œå°±ä¼šç›´æ¥æ‰“å°å‡ºè¯¥å®¹å™¨çš„è¿è¡Œå‘½ä»¤ã€‚<code>runlike</code>ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>pip</code>å®‰è£…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®¹å™¨æ–¹å¼å…å®‰è£…ä½¿ç”¨:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># pip</span><br><span class="line">$ pip install runlike</span><br><span class="line"># by docker</span><br><span class="line">$ alias runlike&#x3D;&quot;docker run --rm -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock assaflavie&#x2F;runlike&quot;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿˜æ˜¯é€šè¿‡ä¸Šé¢é‚£ä¸ªå®¹å™¨æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯ä»¥:</p><p><img src="https://img.hi-linux.com/staticfile/640-20210712101519855-2021-07-12-8zSm4J.jpg" alt></p><p>è¿™æ ·ä½¿ç”¨èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚å…³äº <code>runlike</code> ä¸€äº›å…¶ä»–çš„é€‰é¡¹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>--help</code>å­¦ä¹ ã€‚</p><h2><span id="ä»é•œåƒå¯¼å‡ºdockerfile">ä»é•œåƒå¯¼å‡ºDockerfile</span></h2><p>å¹³æ—¶å¯èƒ½ä¼šæ„å»ºå¾ˆå¤šä¸åŒçš„é•œåƒï¼Œæ¯”å¦‚ç»´æŠ¤ä¸€äº›åŸºç¡€Dockeré•œåƒã€æƒ³æŸ¥çœ‹ä¸€äº›å…¬å¼€ä»“åº“çš„Dockeré•œåƒæ˜¯æ€ä¹ˆæ„å»ºçš„ï¼Œæˆ–å› ä¸ºé•¿æ—¶é—´ä¸ç»´æŠ¤æ‰¾ä¸åˆ°å½“æ—¶æ„å»ºé•œåƒçš„ Dockerfileï¼Œæˆ–è€…å› ä¸ºç½‘ç»œæ— æ³•æŸ¥çœ‹æ—¶ï¼Œèƒ½ä»é•œåƒå¯¼å‡ºDockerfileå°±æ˜¾å¾—å¾ˆé‡è¦ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡ <strong>whaler</strong>[2] æ¥å¿«é€Ÿçš„å¯¼å‡º. è¿™é‡Œæˆ‘ä»¬ä¾æ—§ä¸å®‰è£…ï¼Œé€šè¿‡å®¹å™¨åŒ–çš„æ–¹å¼ä½¿ç”¨dfimageå‘½ä»¤ï¼Œä¾¿äºä½¿ç”¨ï¼Œæˆ‘ä»¬å°†è¯¥å‘½ä»¤å†™æˆå‘½ä»¤åˆ«åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># alias export docker image to dockerfile</span><br><span class="line">$ alias whaler&#x3D;&quot;docker run -t --rm -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock:ro pegleg&#x2F;whaler&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡<code>whaler</code>å‘½ä»¤è¾“å‡º <code>pegleg/whaler</code> é•œåƒçš„dockerfileæ–‡ä»¶:</p><p><img src="https://img.hi-linux.com/staticfile/640-20210712102326684-2021-07-12-58iXFO.jpg" alt></p><p>è¿™æ ·å°±è¾“å‡º<code>pegleg/whaler</code>è¿™ä¸ªé•œåƒçš„ Dockerfile å¤§è‡´çš„å†…å®¹äº†ï¼Œè¿˜æ˜¯å½©è‰²çš„è¾“å‡ºå‘¢ï¼Ÿå“ˆå“ˆï¼Œæœ‰å¿ƒäº†ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°è¾“å‡ºçš„ Dockerfile ä¹Ÿä¸<code>å¹³å¸¸å†™çš„ä¸å¤ªä¸€æ ·</code>ï¼Œå¯ä»¥åœ¨ Github ä¸Šçœ‹ä¸‹ä»“åº“å†…çš„ Dockerfile æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM golang:1.14.4 AS builder</span><br><span class="line">WORKDIR $GOPATH</span><br><span class="line">RUN go get -u github.com&#x2F;P3GLEG&#x2F;Whaler</span><br><span class="line">WORKDIR $GOPATH&#x2F;src&#x2F;github.com&#x2F;P3GLEG&#x2F;Whaler</span><br><span class="line">RUN export CGO_ENABLED&#x3D;0 &amp;&amp; go build .</span><br><span class="line">RUN cp Whaler &#x2F;root&#x2F;Whaler</span><br><span class="line"></span><br><span class="line">FROM alpine:3.12.0</span><br><span class="line">WORKDIR &#x2F;root&#x2F;</span><br><span class="line">COPY --from&#x3D;builder &#x2F;root&#x2F;Whaler .</span><br><span class="line">ENTRYPOINT [&quot;.&#x2F;Whaler&quot;]</span><br></pre></td></tr></table></figure><p>ç”± Dockerfile æ¥çœ‹ï¼Œè¿™ä¸ª <code>whaler</code> é‡‡ç”¨çš„å¤šé˜¶æ®µæ„å»ºï¼Œæ‰€ä»¥æ— æ³•è¾“å‡º <code>--from=builder</code> çš„æ„å»ºå†…å®¹ï¼Œè¿™ä¸ªé”… <code>whaler</code> ä¸èƒŒï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸€ä¸ªé•œåƒçœ‹çœ‹ï¼š</p><p><img src="https://img.hi-linux.com/staticfile/640-20210712102331953-2021-07-12-0wmUwI.jpg" alt></p><p>è¿™ä¸ªå°±æ˜¾ç¤ºçš„å¾ˆè‡ªç„¶ï¼Œå¾ˆæœ‰ç†Ÿæ‚‰çš„å‘³é“äº†ã€‚<code>whaler</code> æ”¯æŒåŒæ—¶åˆ†æå¤šä¸ªé•œåƒç­‰ç­‰åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸åœ¨è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±çœ‹ä¸€ä¸‹ã€‚è‡³äº <code>whaler</code> æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå…¶å®çœ‹ä¸€ä¸‹æºç å°±æ˜ç™½äº†ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ äº‘åŸç”Ÿç”Ÿæ€åœˆ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/wbm4x5aw" target="_blank" rel="noopener">https://tinyurl.com/wbm4x5aw</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘å‘ç°ä¸¤ä¸ªéå¸¸å¥½ç”¨çš„å·¥å…·ï¼Œä¸€ä¸ªæ˜¯ &lt;code&gt;runlike&lt;/code&gt;ï¼Œä¸€ä¸ªæ˜¯ &lt;code&gt;whaler&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;runlike&lt;/code&gt;ï¼šé€šè¿‡å®¹å™¨æ‰“å°å‡ºå®¹å™¨çš„å¯åŠ¨å‘½ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;whaler&lt;/code&gt;ï¼šé€šè¿‡é•œåƒå¯¼å‡º&lt;code&gt;dockerfile&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¬èµ·æ¥æ˜¯ä¸æ˜¯æƒ³è¯´ &lt;code&gt;N...B...&lt;/code&gt; å“ˆå“ˆï¼Œé‚£å°±èµ°èµ·ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://www.hi-linux.com/categories/docker/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
      <category term="æ•™ç¨‹" scheme="https://www.hi-linux.com/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä¼˜é›…çš„åœ¨ Linux ä¸‹å¼€æœºè‡ªåŠ¨é‡å¯è„šæœ¬</title>
    <link href="https://www.hi-linux.com/posts/36782.html"/>
    <id>https://www.hi-linux.com/posts/36782.html</id>
    <published>2021-07-21T01:00:00.000Z</published>
    <updated>2021-07-21T02:10:39.790Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2><span id="ç®€ä»‹">ç®€ä»‹</span></h2><p>ç»å¸¸ç¢°åˆ°æœºå™¨æ–­ç”µä¹‹åéœ€è¦é‡å¯ä¸€å¤§å †æœåŠ¡ï¼Œä¸ºäº†é˜²æ­¢è¿™ç§äº‹æƒ…å‘ç”Ÿï¼Œè®¾ç½®å¼€æœºè‡ªå¯çš„è„šæœ¬ååˆ†çš„é‡è¦ï¼Œæˆ‘ä»¬ä¹ æƒ¯æ€§çš„åšæ³•å°±æ˜¯ç¼–å†™ä¸€ä¸ªé‡å¯è„šæœ¬ï¼Œç„¶ååœ¨ <code>/etc/rc.local</code> ä¸­å»å®Œæˆå¼€æœºæ‰§è¡Œã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;etc&#x2F;rc.local</span><br><span class="line">bash &#x2F;root&#x2F;script&#x2F;restart.sh</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„æ–¹æ³•è™½ç„¶å¯è¡Œï¼Œä½†å¹¶ä¸ä¼˜é›…ã€‚ä»Šå¤©æˆ‘ä»¬å°±ç»™å¤§å®¶ä»‹ç»ä¸¤ç§æ›´å¥½çš„å®ç°æ–¹å¼ï¼š</p><h2><span id="é€šè¿‡-crontab-å®ç°">é€šè¿‡ Crontab å®ç°</span></h2><p>Crontab å¯ä»¥ä½¿ç”¨ <code>@reboot</code> æ¥æ‰§è¡Œä¸»æœºå¯åŠ¨ä¹‹åçš„å‘½ä»¤ã€‚é¦–å…ˆåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ crontab -e</span><br></pre></td></tr></table></figure><p>ç„¶åæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot &#x2F;root&#x2F;script&#x2F;restart.sh</span><br></pre></td></tr></table></figure><p>å®Œæˆåï¼Œè¿™ä¸ªè„šæœ¬å°±å¯ä»¥åœ¨é‡å¯çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œäº†ã€‚å…¶å®ƒçš„ä¸€äº›è¿›é˜¶ç©æ³•ï¼š</p><ul><li>åœ¨å¯åŠ¨å®Œæˆåçš„æŒ‡å®šæ—¶é—´å†…è¿è¡Œè„šæœ¬</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨å¯åŠ¨ 5 åˆ†é’Ÿåè¿è¡ŒæŒ‡å®šè„šæœ¬</span><br><span class="line">@reboot sleep 300 &amp;&amp; &#x2F;home&#x2F;wwwjobs&#x2F;clean-static-cache.sh</span><br></pre></td></tr></table></figure><h2><span id="é€šè¿‡-systemd-å®ç°">é€šè¿‡ Systemd å®ç°</span></h2><p>é¦–å…ˆç¼–å†™ä¸€ä¸ªåä¸º restart çš„ Systemd æœåŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;restart.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;restart</span><br><span class="line">After&#x3D;default.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;root&#x2F;script&#x2F;restart.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;default.target</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ç”¨è¿™ä¸ª Systemd æœåŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl enable restart.service</span><br></pre></td></tr></table></figure><p>å®Œæˆåï¼Œè¿™ä¸ªæœåŠ¡å¯¹åº”çš„è„šæœ¬å°±å¯ä»¥è‡ªåŠ¨å¼€æœºè‡ªå¯äº†ã€‚</p><h2><span id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</span></h2><ul><li><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></li><li><a href="https://tinyurl.com/6ryafefw" target="_blank" rel="noopener">https://tinyurl.com/6ryafefw</a></li><li><a href="https://www.cyberciti.biz/faq/linux-execute-cron-job-after-system-reboot/" target="_blank" rel="noopener">https://www.cyberciti.biz/faq/linux-execute-cron-job-after-system-reboot/</a></li></ul></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;div id=&quot;vip-container&quot;&gt;&lt;h2&gt;&lt;span id=&quot;ç®€ä»‹&quot;&gt;ç®€ä»‹&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;ç»å¸¸ç¢°åˆ°æœºå™¨æ–­ç”µä¹‹åéœ€è¦é‡å¯ä¸€å¤§å †æœåŠ¡ï¼Œä¸ºäº†é˜²æ­¢è¿™ç§äº‹æƒ…å‘ç”Ÿï¼Œè®¾ç½®å¼€æœºè‡ªå¯çš„è„šæœ¬ååˆ†çš„é‡è¦ï¼Œæˆ‘ä»¬ä¹ æƒ¯æ€§çš„åšæ³•å°±æ˜¯ç¼–å†™ä¸€ä¸ªé‡å¯è„šæœ¬ï¼Œç„¶ååœ¨
        
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="æ•™ç¨‹" scheme="https://www.hi-linux.com/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="Shell" scheme="https://www.hi-linux.com/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>æ¨èä¸€æ¬¾é¢å‘å¼€å‘è€…å‹å¥½çš„ Kubernetes æŒç»­äº¤ä»˜å·¥ä½œæµç®¡ç†è½¯ä»¶ Devtron</title>
    <link href="https://www.hi-linux.com/posts/45793.html"/>
    <id>https://www.hi-linux.com/posts/45793.html</id>
    <published>2021-07-15T01:00:00.000Z</published>
    <updated>2021-07-15T08:28:23.181Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>Devtron(<a href="https://devtron.ai" target="_blank" rel="noopener">https://devtron.ai</a>) æ˜¯ç”¨ go ç¼–å†™çš„ç”¨äº Kubernetes äº¤ä»˜å·¥ä½œæµç®¡ç†çš„å¼€æºè½¯ä»¶ã€‚å®ƒè¢«è®¾è®¡ä¸ºä¸€ä¸ªè‡ªæˆ‘æœåŠ¡å¹³å°ï¼Œä»¥å¼€å‘è€…å‹å¥½çš„æ–¹å¼åœ¨ Kubernetes ä¸Šè¿ç»´å’Œç»´æŠ¤åº”ç”¨ç¨‹åºï¼ˆAppOpsï¼‰ã€‚</p><blockquote><p>ä»“åº“åœ°å€ï¼š<a href="https://github.com/devtron-labs/devtron" target="_blank" rel="noopener">https://github.com/devtron-labs/devtron</a></p></blockquote><a id="more"></a><h2><span id="ç‰¹æ€§">ğŸ‰ ç‰¹æ€§</span></h2><ul><li><p>é›¶ä»£ç è½¯ä»¶äº¤ä»˜å·¥ä½œæµ</p><ul><li>äº†è§£ kubernetesã€æµ‹è¯•ã€CDã€SecOps ç­‰é¢†åŸŸçš„å·¥ä½œæµï¼Œè¿™æ ·ä½ å°±ä¸å¿…å†™è„šæœ¬ã€‚</li><li>å¯é‡å¤ä½¿ç”¨å’Œå¯ç»„åˆçš„ç»„ä»¶ï¼Œä½¿å·¥ä½œæµæ˜“äºæ„å»ºä½¿ç”¨ã€‚</li></ul></li><li><p>å¤šäº‘éƒ¨ç½²</p><ul><li>å¤©ç„¶æ”¯æŒéƒ¨ç½²åˆ°å¤šä¸ª kubernetes é›†ç¾¤ä¸Š</li></ul></li><li><p>è½»æ¾å®ç°å¼€å‘-å®‰å…¨-è¿ç»´ä¸€ä½“åŒ–</p><ul><li>å…¨å±€ã€é›†ç¾¤ã€ç¯å¢ƒå’Œåº”ç”¨çš„å¤šå±‚æ¬¡å®‰å…¨ç­–ç•¥ï¼Œå®ç°é«˜æ•ˆçš„åˆ†å±‚ç­–ç•¥ç®¡ç†</li><li>è¡Œä¸ºé©±åŠ¨çš„å®‰å…¨ç­–ç•¥</li><li>kubernetes èµ„æºå®šä¹‰ç­–ç•¥å’Œå¼‚å¸¸æƒ…å†µ</li><li>å®šä¹‰äº‹ä»¶çš„ç­–ç•¥ï¼Œä»¥ä¾¿æ›´å¿«åœ°è§£å†³é—®é¢˜</li></ul></li><li><p>åº”ç”¨ç¨‹åºè°ƒè¯•é¢æ¿</p><ul><li>æ‰€æœ‰å†å²çš„ kubernetes äº‹ä»¶éƒ½é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹</li><li>å®‰å…¨åœ°è®¿é—®æ‰€æœ‰æ¸…å•ï¼Œå¦‚ secretã€configmap</li><li>cpuã€ramã€http çŠ¶æ€ç å’Œå»¶è¿Ÿç­‰åº”ç”¨æŒ‡æ ‡ï¼Œå¹¶è¿›è¡Œæ–°æ—§å¯¹æ¯”</li><li>ä½¿ç”¨ grep å’Œ json æœç´¢æ—¥å¿—</li><li>äº‹ä»¶å’Œæ—¥å¿—ä¹‹é—´çš„æ™ºèƒ½å…³è”æ€§</li></ul></li><li><p>ä¼ä¸šçº§çš„å®‰å…¨æ€§å’Œåˆè§„æ€§</p><ul><li>ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼›æ§åˆ¶è°å¯ä»¥ç¼–è¾‘é…ç½®ï¼Œè°å¯ä»¥éƒ¨ç½²</li><li>å®¡è®¡æ—¥å¿—ï¼Œäº†è§£è°åšäº†ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™åšçš„</li><li>æ‰€æœ‰ CI å’Œ CD äº‹ä»¶çš„å†å²è®°å½•</li><li>å½±å“åº”ç”¨ç¨‹åºçš„ Kubernetes äº‹ä»¶</li><li>ç›¸å…³çš„äº‘äº‹ä»¶åŠå…¶å¯¹åº”ç”¨ç¨‹åºçš„å½±å“</li><li>å…ˆè¿›çš„å·¥ä½œæµç¨‹ç­–ç•¥ï¼Œå¦‚åˆ†æ”¯ç¯å¢ƒï¼Œç¡®ä¿æ„å»ºå’Œéƒ¨ç½²ç®¡é“çš„å®‰å…¨</li></ul></li><li><p>äº†è§£ Gitops</p><ul><li>é€šè¿‡ API å’Œ UI æš´éœ²çš„ Gitopsï¼Œä½¿ä½ ä¸å¿…ä¸ Git å®¢æˆ·ç«¯äº¤äº’</li><li>ç”± postgres æ”¯æŒçš„ Gitops æ›´å®¹æ˜“åˆ†æ</li><li>å®æ–½æ¯” git æ›´ç²¾ç»†çš„è®¿é—®æ§åˆ¶</li></ul></li><li><p>ä¸šåŠ¡æ´å¯Ÿ</p><ul><li>éƒ¨ç½²æŒ‡æ ‡æ¥è¡¡é‡æ•æ·è¿‡ç¨‹çš„æˆåŠŸï¼Œå®ƒå¯ä»¥æ•æ‰åˆ° mttrã€å˜æ›´å¤±è´¥ç‡ã€éƒ¨ç½²é¢‘ç‡ã€éƒ¨ç½²è§„æ¨¡ç­‰ã€‚</li><li>å®¡è®¡æ—¥å¿—ä»¥äº†è§£å¤±è´¥çš„åŸå› </li><li>ç›‘æµ‹è·¨éƒ¨ç½²çš„å˜åŒ–ï¼Œå¹¶è½»æ¾æ¢å¤</li></ul></li></ul><h2><span id="å®‰è£…">ğŸš€ å®‰è£…</span></h2><p>é»˜è®¤çš„å®‰è£…é…ç½®ä¼šä½¿ç”¨ MinIO æ¥å­˜å‚¨æ„å»ºæ—¥å¿—å’Œç¼“å­˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add devtron https:&#x2F;&#x2F;helm.devtron.ai</span><br><span class="line">$ helm install devtron devtron&#x2F;devtron-operator --create-namespace --namespace devtroncd \</span><br><span class="line">--set secrets.POSTGRESQL_PASSWORD&#x3D;change-me</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å®˜æ–¹çš„å®‰è£…æ–¹å¼ä¼šä» GitHub ä¸Šé¢å»ä¸‹è½½å¾ˆå¤šè„šæœ¬è¿›è¡Œåˆå§‹åŒ–ï¼Œç”±äºæŸäº›åŸå› ï¼Œå¯èƒ½æˆ‘ä»¬æ²¡åŠæ³•æ­£å¸¸è®¿é—®ï¼Œè¿™é‡Œæˆ‘å·²ç»å°†æ‰€æœ‰çš„å®‰è£…è„šæœ¬å’Œä»£ç åŒæ­¥åˆ°äº† <code>gitee</code> ä¸Šé¢ï¼Œä¸ç”¨æ‹…å¿ƒå®‰è£…ä¸ä¸Šäº†ã€‚</p><p>é¦–å…ˆ clone å®‰è£…è„šæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https:&#x2F;&#x2F;gitee.com&#x2F;cnych&#x2F;devtron-installation-script.git</span><br><span class="line">$ cd devtron-installation-script</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Helm3 æ¥è¿›è¡Œå®‰è£…ï¼Œæˆ‘ä»¬åªéœ€è¦å®‰è£… <code>devtron-operator</code> å³å¯å¸®æˆ‘ä»¬è‡ªåŠ¨å®‰è£… devtron äº†ï¼Œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ helm upgrade --install devtron .&#x2F;charts&#x2F;devtron --create-namespace --namespace devtroncd</span><br><span class="line">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: &#x2F;Users&#x2F;ych&#x2F;.kube&#x2F;config</span><br><span class="line">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: &#x2F;Users&#x2F;ych&#x2F;.kube&#x2F;config</span><br><span class="line">W0624 11:00:57.798698 56125 warnings.go:67] apiextensions.k8s.io&#x2F;v1beta1 CustomResourceDefinition is deprecated in v1.16+, unavailable in v1.22+; use apiextensions.k8s.io&#x2F;v1 CustomResourceDefinition</span><br><span class="line">W0624 11:00:59.829583 56125 warnings.go:67] apiextensions.k8s.io&#x2F;v1beta1 CustomResourceDefinition is deprecated in v1.16+, unavailable in v1.22+; use apiextensions.k8s.io&#x2F;v1 CustomResourceDefinition</span><br><span class="line">NAME: devtron</span><br><span class="line">LAST DEPLOYED: Thu Jun 24 11:01:00 2021</span><br><span class="line">NAMESPACE: devtroncd</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line"></span><br><span class="line">1. Run the following command to get the default admin password. Default username is admin</span><br><span class="line"></span><br><span class="line">   kubectl -n devtroncd get secret devtron-secret -o jsonpath&#x3D;&#39;&#123;.data.ACD_PASSWORD&#125;&#39; | base64 -d</span><br><span class="line"></span><br><span class="line">2. You can watch the progress of Devtron microservices installation by the following command</span><br><span class="line"></span><br><span class="line">   kubectl -n devtroncd get installers installer-devtron -o jsonpath&#x3D;&#39;&#123;.status.sync.status&#125;&#39;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šå¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨äºå®‰è£… devtron çš„ Podï¼Œè¯¥ Pod ä¼šå»è¯»å–æˆ‘ä»¬çš„ <code>installaction-script</code> è„šæœ¬è¿›è¡Œåˆå§‹åŒ–å®‰è£…ï¼Œè¿™ä¸ªå®‰è£…è¿‡ç¨‹éœ€è¦èŠ±ä¸€ç‚¹æ—¶é—´ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦æä¾›ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦åˆ™ MinIO å¯¹åº”çš„ PVC æ²¡åŠæ³•ç»‘å®šï¼Œä¹Ÿå°±å®‰è£…ä¸æˆåŠŸäº†ï¼Œæˆ‘è¿™é‡Œæ˜¯åœ¨ä»£ç ä»“åº“ä¸­æ˜ç¡®æŒ‡å®šçš„ä¸€ä¸ªåä¸º <code>nfs-storage</code> çš„ StorageClassï¼Œæ­£å¸¸å®‰è£…åä¼šäº§ç”Ÿå¾ˆå¤š Podï¼š</p><p><img src="https://img.hi-linux.com/staticfile/640-20210630113548589-2021-06-30-Zl4ugu.jpg" alt="devtron pods"></p><p>ä¸ºäº†è®¿é—®æ–¹ä¾¿æˆ‘è¿™é‡Œè¿˜åˆ›å»ºäº†ä¸€ä¸ª IngressRoute å¯¹è±¡ç”¨æ¥ç»‘å®š Dashboardï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># devtron-ingressroute.yaml</span><br><span class="line">apiVersion: traefik.containo.us&#x2F;v1alpha1</span><br><span class="line">kind: IngressRoute</span><br><span class="line">metadata:</span><br><span class="line">  name: devtron</span><br><span class="line">  namespace: devtroncd</span><br><span class="line">spec:</span><br><span class="line">  entryPoints:</span><br><span class="line">    - web</span><br><span class="line">  routes:</span><br><span class="line">    - kind: Rule</span><br><span class="line">      match: Host(&#96;devtron.k8s.local&#96;)</span><br><span class="line">      services:</span><br><span class="line">        - name: devtron-service</span><br><span class="line">          port: 80</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®Œæˆåæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åŸŸåï¼ˆæå‰åšå¥½è§£æï¼‰å°±å¯ä»¥è®¿é—® devtron äº†ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/640-20210630130148000-2021-06-30-tQSDbk.jpg" alt="login devtron"></p><p>ç™»å½•çš„æ—¶å€™ä½¿ç”¨çš„é»˜è®¤ç”¨æˆ·åä¸º <code>admin</code>ï¼Œå¯†ç åˆ™å¯ä»¥ä½¿ç”¨ä¸Šé¢å®‰è£… Helm Charts çš„æ—¶å€™çš„æç¤ºå‘½ä»¤è·å–:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n devtroncd get secret devtron-secret -o jsonpath&#x3D;&#39;&#123;.data.ACD_PASSWORD&#125;&#39; | base64 -d</span><br></pre></td></tr></table></figure><p>ç™»å½•åå°±å¯ä»¥è¿›å…¥åˆ° Dashboard çš„ä¸»é¡µäº†ï¼š</p><p><img src="https://img.hi-linux.com/staticfile/640-20210630113548607-2021-06-30-W9dUld.jpg" alt></p><p>è¿›å…¥ Dashboard åæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›é…ç½®æ‰èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚æ·»åŠ  Docker é•œåƒä»“åº“ã€é…ç½® gitops ç­‰ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£è¯´æ˜ <a href="https://docs.devtron.ai" target="_blank" rel="noopener">https://docs.devtron.ai</a>ï¼Œåç»­æˆ‘ä»¬å†æä¾›ä¸€ä¸ªè¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Githubçˆ±å¥½è€… ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/4y93htj9" target="_blank" rel="noopener">https://tinyurl.com/4y93htj9</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Devtron(&lt;a href=&quot;https://devtron.ai&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://devtron.ai&lt;/a&gt;) æ˜¯ç”¨ go ç¼–å†™çš„ç”¨äº Kubernetes äº¤ä»˜å·¥ä½œæµç®¡ç†çš„å¼€æºè½¯ä»¶ã€‚å®ƒè¢«è®¾è®¡ä¸ºä¸€ä¸ªè‡ªæˆ‘æœåŠ¡å¹³å°ï¼Œä»¥å¼€å‘è€…å‹å¥½çš„æ–¹å¼åœ¨ Kubernetes ä¸Šè¿ç»´å’Œç»´æŠ¤åº”ç”¨ç¨‹åºï¼ˆAppOpsï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»“åº“åœ°å€ï¼š&lt;a href=&quot;https://github.com/devtron-labs/devtron&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/devtron-labs/devtron&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="Devtron" scheme="https://www.hi-linux.com/tags/Devtron/"/>
    
  </entry>
  
  <entry>
    <title>GitHub è®¿é—®æ…¢ï¼Ÿæ‰‹æŠŠæ‰‹æ•™ä½ å‡ æ‹›è§£å†³å®ƒï¼</title>
    <link href="https://www.hi-linux.com/posts/50785.html"/>
    <id>https://www.hi-linux.com/posts/50785.html</id>
    <published>2021-07-12T01:00:00.000Z</published>
    <updated>2021-07-13T03:08:10.355Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p>ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œåœ¨å›½å†…çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œè®¿é—® Github æ—¶ï¼Œç½‘ç»œä¼šé˜»æ–­æˆ–è€…å¾ˆæ…¢ã€‚æœ¬æ–‡æä¾›äº†è‹¥å¹²è®¿é—®æ–¹æ³•ã€‚</p></blockquote><h2><span id="1-ä½¿ç”¨-github-mirror-ä¸‹è½½">1. ä½¿ç”¨ Github Mirror ä¸‹è½½</span></h2><p>ç›´æ¥åœ¨ GitHub ä»“åº“å‰é¢æ‹¼æ¥ Proxy åœ°å€ï¼Œä¸åŒçš„ Mirror æ‹¼æ¥æ–¹å¼å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä¸‹é¢ä»¥æ‹‰å– <a href="https://github.com/shaowenchen/scripts" target="_blank" rel="noopener">https://github.com/shaowenchen/scripts</a> ä»“åº“ä¸ºä¾‹ã€‚</p><ul><li><a href="https://mirror.ghproxy.com/" target="_blank" rel="noopener">https://mirror.ghproxy.com</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https:&#x2F;&#x2F;mirror.ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;shaowenchen&#x2F;scripts</span><br></pre></td></tr></table></figure><ul><li><a href="https://github.com.cnpmjs.org/" target="_blank" rel="noopener">https://github.com.cnpmjs.org</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https:&#x2F;&#x2F;github.com.cnpmjs.org&#x2F;shaowenchen&#x2F;scripts</span><br></pre></td></tr></table></figure><a id="more"></a><h2><span id="2-é€šè¿‡-gitee-å¯¼å…¥-github-é¡¹ç›®">2. é€šè¿‡ Gitee å¯¼å…¥ GitHub é¡¹ç›®</span></h2><p>å¯ä»¥å‚è€ƒæ–‡æ¡£: <a href="https://gitee.com/help/articles/4284" target="_blank" rel="noopener">GitHubä»“åº“å¿«é€Ÿå¯¼å…¥GiteeåŠåŒæ­¥æ›´æ–°</a>, å°† GitHub ä»“åº“å¯¼å…¥ Giteeã€‚ç„¶åä½¿ç”¨ Gitee çš„åœ°å€æ‹‰å–ä»£ç ã€‚</p><blockquote><p>æ–‡æ¡£é“¾æ¥ï¼š<a href="https://gitee.com/help/articles/4284" target="_blank" rel="noopener">https://gitee.com/help/articles/4284</a></p></blockquote><h2><span id="3-é…ç½®-github-host-åœ°å€">3. é…ç½® Github Host åœ°å€</span></h2><p>æ‰“å¼€ <a href="https://www.ipaddress.com/" target="_blank" rel="noopener">https://www.ipaddress.com/</a> æŸ¥è¯¢ <a href="https://github.com.ipaddress.com/" target="_blank" rel="noopener">github.com</a> çš„ IP åœ°å€</p><p>ç¼–è¾‘æœ¬åœ° /etc/hosts æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">140.82.112.4 github.com</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥ä½¿ç”¨å¼€æºé¡¹ç›® GitHub520 è·å–æœ€æ–°çš„ IP åœ°å€ã€‚</p><blockquote><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/521xueweihan/GitHub520" target="_blank" rel="noopener">https://github.com/521xueweihan/GitHub520</a></p></blockquote><p>æ¥ç€å°±å¯ä»¥æ‹‰å–ä»£ç äº†ï¼Œä½†æ˜¯é€Ÿåº¦å¹¶ä¸ä¼šå¾ˆå¿«ï¼Œå› ä¸º Github ç”¨çš„æ˜¯ç¾å›½ IPã€‚</p><h2><span id="4-é…ç½®å‘½ä»¤è¡Œä»£ç†">4. é…ç½®å‘½ä»¤è¡Œä»£ç†</span></h2><p>å¦‚æœæœ‰å¯ç”¨çš„ä»£ç†æœåŠ¡ï¼Œé‚£ä¹ˆåœ¨æœ¬åœ° Terminal ä¸­é…ç½®ä»£ç†å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Proxy</span><br><span class="line">function proxy_off()&#123;</span><br><span class="line">    unset http_proxy</span><br><span class="line">    unset HTTP_PROXY</span><br><span class="line">    unset https_proxy</span><br><span class="line">    unset HTTPS_PROXY</span><br><span class="line">    echo -e &quot;å·²å…³é—­ä»£ç†&quot;</span><br><span class="line">&#125;</span><br><span class="line">function proxy_on()&#123;</span><br><span class="line">    export http_proxy&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:1087&quot;;</span><br><span class="line">    export HTTP_PROXY&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:1087&quot;;</span><br><span class="line">    export https_proxy&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:1087&quot;;</span><br><span class="line">    export HTTPS_PROXY&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:1087&quot;;</span><br><span class="line">    echo -e &quot;å·²å¼€å¯ä»£ç†&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œé™ˆå°‘æ–‡çš„ç½‘ç«™ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/4tubycn9" target="_blank" rel="noopener">https://tinyurl.com/4tubycn9</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œåœ¨å›½å†…çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œè®¿é—® Github æ—¶ï¼Œç½‘ç»œä¼šé˜»æ–­æˆ–è€…å¾ˆæ…¢ã€‚æœ¬æ–‡æä¾›äº†è‹¥å¹²è®¿é—®æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1-ä½¿ç”¨-Github-Mirror-ä¸‹è½½&quot;&gt;1. ä½¿ç”¨ Github Mirror ä¸‹è½½&lt;/h2&gt;
&lt;p&gt;ç›´æ¥åœ¨ GitHub ä»“åº“å‰é¢æ‹¼æ¥ Proxy åœ°å€ï¼Œä¸åŒçš„ Mirror æ‹¼æ¥æ–¹å¼å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä¸‹é¢ä»¥æ‹‰å– &lt;a href=&quot;https://github.com/shaowenchen/scripts&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/shaowenchen/scripts&lt;/a&gt; ä»“åº“ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mirror.ghproxy.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mirror.ghproxy.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ git clone https:&amp;#x2F;&amp;#x2F;mirror.ghproxy.com&amp;#x2F;https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;shaowenchen&amp;#x2F;scripts&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com.cnpmjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com.cnpmjs.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ git clone https:&amp;#x2F;&amp;#x2F;github.com.cnpmjs.org&amp;#x2F;shaowenchen&amp;#x2F;scripts&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="WireGuard" scheme="https://www.hi-linux.com/categories/WireGuard/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="æ•™ç¨‹" scheme="https://www.hi-linux.com/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="GitHub" scheme="https://www.hi-linux.com/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>Wintunï¼šä¸€æ¬¾æƒŠè‰³çš„ WireGuard è™šæ‹Ÿç½‘å¡æ¥å£é©±åŠ¨</title>
    <link href="https://www.hi-linux.com/posts/42946.html"/>
    <id>https://www.hi-linux.com/posts/42946.html</id>
    <published>2021-07-07T01:00:00.000Z</published>
    <updated>2021-07-08T08:13:31.352Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>å‰ä¸€æ®µæ—¶é—´ï¼Œä¸€ç›´åœ¨æ‰¾å¯» Windows æ“ä½œç³»ç»Ÿä¸Šçš„è™šæ‹Ÿç½‘å¡æ¥å£ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ­å»ºéš§é“ä½¿ç”¨ã€‚ä½†æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸åƒ Linux æ“ä½œç³»ç»Ÿï¼Œå®ƒçš„ä»£ç ä¸å¼€æºï¼Œå¯¼è‡´è¿™æ–¹é¢çš„èµ„æ–™å¾ˆå°‘ï¼Œå› æ­¤èŠ±è´¹äº†è¾ƒé•¿æ—¶é—´æ¥å¯»æ‰¾ç›¸å…³å®ç°æ¡†æ¶ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†ä¸¤æ¬¾å¼€æºé¡¹ç›®çš„è™šæ‹Ÿæ¥å£é©±åŠ¨ï¼š</p><ul><li>Wireguard é¡¹ç›®çš„ Wintun æ¥å£[1]</li><li>OpenVPN çš„ Tap æ¥å£[2]</li></ul><p>è¿™ä¸¤ä¸ªé¡¹ç›®éƒ½æ˜¯éå¸¸å‡ºåçš„æ­å»ºéš§é“çš„å¼€æº V.P.N é¡¹ç›®ã€‚ç”±äºç›®å‰å¯¹ openVPN é¡¹ç›®ä¸å¤ªäº†è§£ï¼Œä¹Ÿæ²¡æœ‰é€‚é… Tap æ¥å£ï¼Œå› æ­¤è¿™é‡Œé‡ç‚¹ä»‹ç»ä¸‹ WinTun æ¥å£ã€‚æ­¤æ¥å£å®ç°æˆ‘æ˜¯éå¸¸éå¸¸çš„å–œæ¬¢ï¼Œå–œæ¬¢åˆ°ç®€ç›´ä¸è¦ä¸è¦çš„ã€‚</p><a id="more"></a><h2><span id="ç®€ä»‹">ç®€ä»‹</span></h2><p>è¯´åˆ° Wintun é¡¹ç›®ï¼Œå°±ä¸å¾—ä¸è¯´åˆ°å®ƒçš„çˆ¶äº²ï¼šWireGuard é¡¹ç›®ï¼ˆä»¥ä¸‹ç®€ç§° WGï¼‰ã€‚<strong>Github ä¼ é€é—¨</strong>[3]</p><p><img src="https://img.hi-linux.com/staticfile/640-20210630113612450-2021-06-30-Tfcrxr.png" alt></p><p>WG é¡¹ç›®ä½œä¸ºå¼€æº V.P.N é¡¹ç›®ï¼Œä¸åŒäº OpenVPN, Openswan, Strongswan ç­‰ï¼Œå®ƒçš„å®ç°éå¸¸ç®€ä»‹ï¼ŒLinux å†…æ ¸ä»£ç å®ç°ä¸åˆ° 4000 è¡Œã€‚ç›¸å¯¹äºä¸Šè¿°çš„ä¸‰ä¸ª â€œæŒ‰è¡Œæ”¶è´¹â€ çš„é¡¹ç›®ï¼ˆä»£ç  10 ä¸‡è¡Œèµ·æ­¥ï¼‰ï¼Œå®ƒç®€ç›´æ˜¯å¤ªç®€æ´äº†ã€‚æ•…è€Œå¾—åˆ°äº†ä¼—å¤šå¥½è¯„ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ Linux é¼»ç¥–ï¼šLinus Torvaldsã€‚ä»–çš„è¯„ä»·å¦‚ä¸‹ï¼š</p><blockquote><p>Btw, on an unrelated issue: I see that Jason actually made the pull request to have wireguard included in the kernel.</p><p>Can I just once again state my love for it and hope it gets merged soon? Maybe the code isnâ€™t perfect, but Iâ€™ve skimmed it, and compared to the horrors that are OpenVPN and IPSec, itâ€™s a work of art.</p><p>Linus</p></blockquote><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼š<strong>åŠ³èµ„ç¨€ç½•ä½ ï¼Œè¦æŠŠä½ åˆå…¥æˆ‘çš„ Linux é¡¹ç›®ä¸­</strong>ã€‚å› æ­¤ Linux å†…æ ¸è‡ª 5.6 ä¹‹åä¾¿è‡ªå¸¦ WG éš§é“åŠŸèƒ½ï¼Œé…ç½®éå¸¸çš„ç®€å•ã€‚é€šè¿‡å‡ è¡Œä»£ç ä¾¿å¯ä»¥å®Œæˆä¸€ä¸ª WG éš§é“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ip link add dev wg0 type wireguard</span><br><span class="line">$ ip address add dev wg0 10.0.0.1&#x2F;24</span><br><span class="line">$ wg set wg0 listen-port 51820 private-key .&#x2F;private.key peer NIk5TyDpRDoU9tfIckTTXCsz1eht2aEmdN7l0Q31ow0&#x3D; allowed-ips 10.0.0.2&#x2F;32 endpoint 192.168.1.5:51820</span><br><span class="line">$ ip link set dev wg0 up</span><br></pre></td></tr></table></figure><p>é…ç½®éå¸¸ç®€å•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æä¾›äº† Windows å®¢æˆ·ç«¯ï¼Œè¿™ä¹Ÿæ˜¯æ­¤é¡¹ç›®ä¸ºä½•åŒ…å« Wintun è™šæ‹Ÿç½‘ç»œæ¥å£çš„åŸå› ã€‚</p><p>å®¢æˆ·ç«¯é¡µé¢ä¹Ÿæ˜¯éå¸¸ç®€æ´ï¼Œæ²¡æœ‰å¤šä½™çš„ä¸œè¥¿ (<strong>å®¢æˆ·ç«¯é“¾æ¥</strong>[4])ï¼š</p><p><img src="https://img.hi-linux.com/staticfile/640-20210630113622279-2021-06-30-pTYDow.png" alt></p><p>å®¢æˆ·ç«¯ä¸Šéš§é“åå•†æˆåŠŸä¹‹åï¼Œä¼šæ ¹æ®éš§é“åç§°å»ºç«‹ä¸€ä¸ªè™šæ‹Ÿç½‘å¡ï¼Œéš§é“æ‹†é™¤åæ¥å£è‡ªåŠ¨åˆ é™¤ã€‚ç”±äºæˆ‘çš„éš§é“åç§°ä¸º Tun-1ï¼Œå› æ­¤åœ¨ â€œæ§åˆ¶ç‰ˆé¢â€ çš„â€œç½‘ç»œè¿æ¥â€ä¸­å‡ºç°äº†ä¸€ä¸ª Tun-1 çš„ç½‘ç»œæ¥å£ï¼š</p><p><img src="https://img.hi-linux.com/staticfile/640-20210630113627967-2021-06-30-a6Sb0B.png" alt></p><p>å¥½äº†ï¼Œä¸‹é¢å¼€å§‹ä»‹ç»æ­¤è™šæ‹Ÿç½‘ç»œæ¥å£ã€‚</p><h2><span id="wintun-è™šæ‹Ÿç½‘ç»œæ¥å£">WinTun è™šæ‹Ÿç½‘ç»œæ¥å£</span></h2><p><img src="https://img.hi-linux.com/staticfile/640-20210630113633922-2021-06-30-rnV9d1.png" alt></p><ul><li><p><strong>Github ä¼ é€é—¨</strong>[5]</p></li><li><p><strong>wintun å®˜ç½‘ä¼ é€é—¨</strong>[6]</p></li></ul><p>å¸¸è§çš„ <strong>windwos çš„æ¥å£é©±åŠ¨å¼€å‘</strong>[7]ã€å®‰è£…æ¯”è¾ƒå¤æ‚ã€‚å¸¸è§çš„é©±åŠ¨å®‰è£…åŒ…æœ‰ï¼š.inf æ–‡ä»¶ã€.sys æ–‡ä»¶ã€.cat æ–‡ä»¶; é™¤æ­¤ä¹‹å¤–è¿˜æ¶‰åŠé©±åŠ¨ç¨‹åºç­¾åï¼Œå¦åˆ™æ— æ³•å®‰è£…æˆåŠŸã€‚å°¤å…¶åœ¨å¼€å‘è°ƒè¯•é˜¶æ®µï¼Œæ¯æ¬¡éƒ½å¾—ç­¾åï¼Œå¤ªç£¨å½äº†ã€‚</p><p>ä½†æ˜¯ WinTun æ¥å£ç”¨æ³•<strong>éå¸¸ç®€å•é«˜æ•ˆ</strong>ã€‚<strong>éå¸¸ç®€å•é«˜æ•ˆ</strong>ã€‚<strong>éå¸¸ç®€å•é«˜æ•ˆ</strong>ã€‚</p><blockquote><ol><li>å¼•å…¥å¤´æ–‡ä»¶ï¼šwintun.h</li><li>åŠ è½½åŠ¨æ€åº“ï¼Œè§£æåŠ¨æ€åº“ä¸­çš„å‡½æ•°æŒ‡é’ˆ</li></ol></blockquote><p>å®ƒé€šè¿‡<strong>åŠ¨æ€åº“</strong>ä¸­æ–¹å¼æ¥æä¾›æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åŠ è½½æ­¤åŠ¨æ€åº“ï¼Œç„¶åè°ƒç”¨åŠ¨æ€åº“ä¸­çš„å‡½æ•°æŒ‡é’ˆæ¥å®Œæˆè™šæ‹Ÿæ¥å£çš„åˆ›å»ºã€é”€æ¯ã€æ”¶å‘æ•°æ®åŒ…ç­‰å·¥ä½œã€‚æ­¤å¤–<strong>å®ƒæä¾›äº†ä¸€ä¸ªç¤ºä¾‹ä¾›å¤§å®¶å­¦ä¹ </strong>[8]ï¼Œæˆ‘ä¾¿æ˜¯é€šè¿‡å‚è€ƒå¼€æºä»£ç ä¸­çš„ç¤ºä¾‹ï¼ˆexample.cï¼‰ï¼Œå°† Wintun æ¥å£ç§»æ¤åˆ°æˆ‘çš„å·¥ç¨‹ä¹‹ä¸­ã€‚éå¸¸ç®€å•ï¼Œæˆ‘å¤ªå–œæ¬¢å®ƒäº†ã€‚</p><p>å®ä¾‹ä»£ç å°± 400 è¡Œï¼Œå…¶ä¸­å¤§éƒ¨åˆ†ä¸º log ä¿¡æ¯ï¼Œä¾›å¤§å®¶æŸ¥çœ‹ç¨‹åºè¿è¡ŒçŠ¶æ€å’ŒæŠ¥æ–‡æ”¶å‘ä¿¡æ¯ã€‚</p><h3><span id="åŠ è½½åŠ¨æ€åº“ä¸­çš„å‡½æ•°æŒ‡é’ˆ">åŠ è½½åŠ¨æ€åº“ä¸­çš„å‡½æ•°æŒ‡é’ˆ</span></h3><p>æ­¤å‡½æ•°çš„ä½œç”¨ï¼š</p><ul><li><strong>åŠ è½½åŠ¨æ€åº“ï¼Œè·å–åˆ°åŠ¨æ€åº“ä¸­çš„å‡½æ•°æŒ‡é’ˆï¼Œåé¢é€šè¿‡å‡½æ•°æŒ‡é’ˆæ¥æ“ä½œè™šæ‹Ÿç½‘å¡æ¥å£ã€‚</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">static HMODULE</span><br><span class="line">InitializeWintun(void)</span><br><span class="line">&#123;</span><br><span class="line">    HMODULE Wintun &#x3D;</span><br><span class="line">        LoadLibraryExW(L&quot;wintun.dll&quot;, NULL, LOAD_LIBRARY_SEARCH_APPLICATION_DIR | LOAD_LIBRARY_SEARCH_SYSTEM32);</span><br><span class="line">    if (!Wintun)</span><br><span class="line">        return NULL;</span><br><span class="line">#define X(Name, Type) ((Name &#x3D; (Type)GetProcAddress(Wintun, #Name)) &#x3D;&#x3D; NULL)</span><br><span class="line">    if (X(WintunCreateAdapter, WINTUN_CREATE_ADAPTER_FUNC) || X(WintunDeleteAdapter, WINTUN_DELETE_ADAPTER_FUNC) ||</span><br><span class="line">        X(WintunDeletePoolDriver, WINTUN_DELETE_POOL_DRIVER_FUNC) || X(WintunEnumAdapters, WINTUN_ENUM_ADAPTERS_FUNC) ||</span><br><span class="line">        X(WintunFreeAdapter, WINTUN_FREE_ADAPTER_FUNC) || X(WintunOpenAdapter, WINTUN_OPEN_ADAPTER_FUNC) ||</span><br><span class="line">        X(WintunGetAdapterLUID, WINTUN_GET_ADAPTER_LUID_FUNC) ||</span><br><span class="line">        X(WintunGetAdapterName, WINTUN_GET_ADAPTER_NAME_FUNC) ||</span><br><span class="line">        X(WintunSetAdapterName, WINTUN_SET_ADAPTER_NAME_FUNC) ||</span><br><span class="line">        X(WintunGetRunningDriverVersion, WINTUN_GET_RUNNING_DRIVER_VERSION_FUNC) ||</span><br><span class="line">        X(WintunSetLogger, WINTUN_SET_LOGGER_FUNC) || X(WintunStartSession, WINTUN_START_SESSION_FUNC) ||</span><br><span class="line">        X(WintunEndSession, WINTUN_END_SESSION_FUNC) || X(WintunGetReadWaitEvent, WINTUN_GET_READ_WAIT_EVENT_FUNC) ||</span><br><span class="line">        X(WintunReceivePacket, WINTUN_RECEIVE_PACKET_FUNC) ||</span><br><span class="line">        X(WintunReleaseReceivePacket, WINTUN_RELEASE_RECEIVE_PACKET_FUNC) ||</span><br><span class="line">        X(WintunAllocateSendPacket, WINTUN_ALLOCATE_SEND_PACKET_FUNC) || X(WintunSendPacket, WINTUN_SEND_PACKET_FUNC))</span><br><span class="line">#undef X</span><br><span class="line">    &#123;</span><br><span class="line">        DWORD LastError &#x3D; GetLastError();</span><br><span class="line">        FreeLibrary(Wintun);</span><br><span class="line">        SetLastError(LastError);</span><br><span class="line">        return NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    return Wintun;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="main-å‡½æ•°">main() å‡½æ•°</span></h3><p>ä½œç”¨ï¼š</p><ul><li><strong>é€šè¿‡å‡½æ•°æŒ‡é’ˆåˆ›å»ºè™šæ‹Ÿç½‘å¡</strong></li><li><strong>åˆ›å»ºè™šæ‹Ÿç½‘å¡çš„æ”¶å‘çº¿ç¨‹</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">int</span><br><span class="line">main(void)</span><br><span class="line">&#123;</span><br><span class="line">    HMODULE Wintun &#x3D; InitializeWintun();</span><br><span class="line">    if (!Wintun)</span><br><span class="line">        return LogError(L&quot;Failed to initialize Wintun&quot;, GetLastError());</span><br><span class="line">    WintunSetLogger(ConsoleLogger);</span><br><span class="line">    Log(WINTUN_LOG_INFO, L&quot;Wintun library loaded&quot;);</span><br><span class="line">    WintunEnumAdapters(L&quot;Example&quot;, PrintAdapter, 0);</span><br><span class="line"></span><br><span class="line">    DWORD LastError;</span><br><span class="line">    HaveQuit &#x3D; FALSE;</span><br><span class="line">    QuitEvent &#x3D; CreateEventW(NULL, TRUE, FALSE, NULL);</span><br><span class="line">    if (!QuitEvent)</span><br><span class="line">    &#123;</span><br><span class="line">        LastError &#x3D; LogError(L&quot;Failed to create event&quot;, GetLastError());</span><br><span class="line">        goto cleanupWintun;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!SetConsoleCtrlHandler(CtrlHandler, TRUE))</span><br><span class="line">    &#123;</span><br><span class="line">        LastError &#x3D; LogError(L&quot;Failed to set console handler&quot;, GetLastError());</span><br><span class="line">        goto cleanupQuit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    GUID ExampleGuid &#x3D; &#123; 0xdeadbabe, 0xcafe, 0xbeef, &#123; 0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef &#125; &#125;;</span><br><span class="line">    WINTUN_ADAPTER_HANDLE Adapter &#x3D; WintunOpenAdapter(L&quot;Example&quot;, L&quot;Demo&quot;);</span><br><span class="line">    if (!Adapter)</span><br><span class="line">    &#123;</span><br><span class="line">        Adapter &#x3D; WintunCreateAdapter(L&quot;Example&quot;, L&quot;Demo&quot;, &amp;ExampleGuid, NULL);</span><br><span class="line">        if (!Adapter)</span><br><span class="line">        &#123;</span><br><span class="line">            LastError &#x3D; GetLastError();</span><br><span class="line">            LogError(L&quot;Failed to create adapter&quot;, LastError);</span><br><span class="line">            goto cleanupQuit;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    DWORD Version &#x3D; WintunGetRunningDriverVersion();</span><br><span class="line">    Log(WINTUN_LOG_INFO, L&quot;Wintun v%u.%u loaded&quot;, (Version &gt;&gt; 16) &amp; 0xff, (Version &gt;&gt; 0) &amp; 0xff);</span><br><span class="line"></span><br><span class="line">    MIB_UNICASTIPADDRESS_ROW AddressRow;</span><br><span class="line">    InitializeUnicastIpAddressEntry(&amp;AddressRow);</span><br><span class="line">    WintunGetAdapterLUID(Adapter, &amp;AddressRow.InterfaceLuid);</span><br><span class="line">    AddressRow.Address.Ipv4.sin_family &#x3D; AF_INET;</span><br><span class="line">    AddressRow.Address.Ipv4.sin_addr.S_un.S_addr &#x3D; htonl((10 &lt;&lt; 24) | (6 &lt;&lt; 16) | (7 &lt;&lt; 8) | (7 &lt;&lt; 0)); &#x2F;* 10.6.7.7 *&#x2F;</span><br><span class="line">    AddressRow.OnLinkPrefixLength &#x3D; 24; &#x2F;* This is a &#x2F;24 network *&#x2F;</span><br><span class="line">    LastError &#x3D; CreateUnicastIpAddressEntry(&amp;AddressRow);</span><br><span class="line">    if (LastError !&#x3D; ERROR_SUCCESS &amp;&amp; LastError !&#x3D; ERROR_OBJECT_ALREADY_EXISTS)</span><br><span class="line">    &#123;</span><br><span class="line">        LogError(L&quot;Failed to set IP address&quot;, LastError);</span><br><span class="line">        goto cleanupAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    WINTUN_SESSION_HANDLE Session &#x3D; WintunStartSession(Adapter, 0x400000);</span><br><span class="line">    if (!Session)</span><br><span class="line">    &#123;</span><br><span class="line">        LastError &#x3D; LogLastError(L&quot;Failed to create adapter&quot;);</span><br><span class="line">        goto cleanupAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Log(WINTUN_LOG_INFO, L&quot;Launching threads and mangling packets...&quot;);</span><br><span class="line"></span><br><span class="line">    HANDLE Workers[] &#x3D; &#123; CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)ReceivePackets, (LPVOID)Session, 0, NULL),</span><br><span class="line">                         CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)SendPackets, (LPVOID)Session, 0, NULL) &#125;;</span><br><span class="line">    if (!Workers[0] || !Workers[1])</span><br><span class="line">    &#123;</span><br><span class="line">        LastError &#x3D; LogError(L&quot;Failed to create threads&quot;, GetLastError());</span><br><span class="line">        goto cleanupWorkers;</span><br><span class="line">    &#125;</span><br><span class="line">    WaitForMultipleObjectsEx(_countof(Workers), Workers, TRUE, INFINITE, TRUE);</span><br><span class="line">    LastError &#x3D; ERROR_SUCCESS;</span><br><span class="line"></span><br><span class="line">cleanupWorkers:</span><br><span class="line">    HaveQuit &#x3D; TRUE;</span><br><span class="line">    SetEvent(QuitEvent);</span><br><span class="line">    for (size_t i &#x3D; 0; i &lt; _countof(Workers); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        if (Workers[i])</span><br><span class="line">        &#123;</span><br><span class="line">            WaitForSingleObject(Workers[i], INFINITE);</span><br><span class="line">            CloseHandle(Workers[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    WintunEndSession(Session);</span><br><span class="line">cleanupAdapter:</span><br><span class="line">    WintunDeleteAdapter(Adapter, FALSE, NULL);</span><br><span class="line">    WintunFreeAdapter(Adapter);</span><br><span class="line">cleanupQuit:</span><br><span class="line">    SetConsoleCtrlHandler(CtrlHandler, FALSE);</span><br><span class="line">    CloseHandle(QuitEvent);</span><br><span class="line">cleanupWintun:</span><br><span class="line">    FreeLibrary(Wintun);</span><br><span class="line">    return LastError;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¶å‘æŠ¥æ–‡çš„æ¥å£æ“ä½œä¹Ÿéå¸¸ç®€å•ï¼Œä½†æ˜¯ä¸ windows ç½‘ç»œåè®®æ ˆä¹‹é—´çš„å…³ç³»ä»éœ€è¦ç»§ç»­æ‘¸ç´¢ã€‚</p><h3><span id="ç‰¹åˆ«è¯´æ˜">ç‰¹åˆ«è¯´æ˜</span></h3><p>Wintun æ¥å£æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ 3 å±‚é€»è¾‘æ¥å£ã€‚åŸæ–‡å¦‚ä¸‹ï¼š</p><blockquote><p>Wintun is a very simple and minimal TUN driver for the Windows kernel, which provides userspace programs with a simple network adapter for reading and writing packets. It is akin to Linuxâ€™s /dev/net/tun and BSDâ€™s /dev/tun. Originally designed for use in WireGuard, Wintun is meant to be generally useful for a wide variety of layer 3 networking protocols and experiments. The driver is open source, so anybody can inspect and build it. Due to Microsoftâ€™s driver signing requirements, we provide precompiled and signed versions that may be distributed with your software. The goal of the project is to be as simple as possible, opting to do things in the most pure and straight-forward way provided by NDIS.</p></blockquote><p>è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªå°å°çš„é—®é¢˜ï¼š<strong>Wireshark ä¸Šæ— æ³•æŠ“å–æ­¤æ¥å£æŠ¥æ–‡</strong>ã€‚å¦‚æœæƒ³çœ‹å°è£…åçš„æŠ¥æ–‡ä¿¡æ¯ï¼Œåˆ™éœ€è¦å•ç‹¬è®°å½•æ—¥å¿—è€ŒéæŠ“åŒ…æ¥å®Œæˆã€‚</p><p><img src="https://img.hi-linux.com/staticfile/640-20210630113648931-2021-06-30-rB5kXq.png" alt></p><p>å¯¼è‡´è¿™ä¸ªé—®é¢˜åŸå› æ²¡æœ‰æ‰¾åˆ°ï¼Œæˆ‘è®¤ä¸ºæ˜¯ï¼š<strong>wireshark æŠ“å–çš„æŠ¥æ–‡æ˜¯äºŒå±‚æŠ¥æ–‡ (ä¸€ä¸ªå®Œæ•´çš„ä»¥å¤ªç½‘å¸§)ï¼Œè€Œ 3 å±‚é€»è¾‘æ¥å£ä¸Šçš„æŠ¥æ–‡å°šæœªå°è£…ä»¥å¤ªç½‘å¸§ï¼Œæ•…æ— æ³•æŠ“å–æ­¤æ¥å£ã€‚è¿™åªæ˜¯ä¸ªäººçŒœæµ‹ï¼Œæ ¹æœ¬åŸå› ä¸å¾—è€ŒçŸ¥ã€‚</strong></p><p><img src="https://img.hi-linux.com/staticfile/640-20210630113654931-2021-06-30-0mF6hi.png" alt></p><p>å¥½äº†ï¼ŒåŸºæœ¬ä»‹ç»å®Œæ¯•ï¼Œé‡æ–°è¡¨è¾¾ä¸‹æˆ‘å¯¹ WireGuard å’Œ WinTun çš„æ€åº¦ï¼š<strong>åŠ³èµ„ç¨€ç½•ä½ ï¼Œvery å–œæ¬¢ã€‚</strong></p><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/s2603898260/article/details/117389372" target="_blank" rel="noopener">https://blog.csdn.net/s2603898260/article/details/117389372</a></p></blockquote><h3><span id="è„šæ³¨">è„šæ³¨</span></h3><p>[1]Wireguard é¡¹ç›®çš„ Wintun æ¥å£: <em><a href="https://github.com/WireGuard" target="_blank" rel="noopener">https://github.com/WireGuard</a></em></p><p>[2]OpenVPN çš„ Tap æ¥å£: <em><a href="https://github.com/Toney-Sun/openvpn" target="_blank" rel="noopener">https://github.com/Toney-Sun/openvpn</a></em></p><p>[3]Github ä¼ é€é—¨: <em><a href="https://github.com/WireGuard" target="_blank" rel="noopener">https://github.com/WireGuard</a></em></p><p>[4]å®¢æˆ·ç«¯é“¾æ¥: <em><a href="https://www.wireguard.com/install/" target="_blank" rel="noopener">https://www.wireguard.com/install/</a></em></p><p>[5]Github ä¼ é€é—¨: <em><a href="https://github.com/Toney-Sun/wintun" target="_blank" rel="noopener">https://github.com/Toney-Sun/wintun</a></em></p><p>[6]wintun å®˜ç½‘ä¼ é€é—¨: <em><a href="https://www.wintun.net/" target="_blank" rel="noopener">https://www.wintun.net/</a></em></p><p>[7]windwos çš„æ¥å£é©±åŠ¨å¼€å‘: <em><a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/install/components-of-a-driver-package" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/windows-hardware/drivers/install/components-of-a-driver-package</a></em></p><p>[8]å®ƒæä¾›äº†ä¸€ä¸ªç¤ºä¾‹ä¾›å¤§å®¶å­¦ä¹ : <em><a href="https://git.zx2c4.com/wintun/tree/example/example.c" target="_blank" rel="noopener">https://git.zx2c4.com/wintun/tree/example/example.c</a></em></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œäº‘åŸç”Ÿå®éªŒå®¤ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y6mv2ym2" target="_blank" rel="noopener">https://tinyurl.com/y6mv2ym2</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰ä¸€æ®µæ—¶é—´ï¼Œä¸€ç›´åœ¨æ‰¾å¯» Windows æ“ä½œç³»ç»Ÿä¸Šçš„è™šæ‹Ÿç½‘å¡æ¥å£ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ­å»ºéš§é“ä½¿ç”¨ã€‚ä½†æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸åƒ Linux æ“ä½œç³»ç»Ÿï¼Œå®ƒçš„ä»£ç ä¸å¼€æºï¼Œå¯¼è‡´è¿™æ–¹é¢çš„èµ„æ–™å¾ˆå°‘ï¼Œå› æ­¤èŠ±è´¹äº†è¾ƒé•¿æ—¶é—´æ¥å¯»æ‰¾ç›¸å…³å®ç°æ¡†æ¶ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†ä¸¤æ¬¾å¼€æºé¡¹ç›®çš„è™šæ‹Ÿæ¥å£é©±åŠ¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Wireguard é¡¹ç›®çš„ Wintun æ¥å£[1]&lt;/li&gt;
&lt;li&gt;OpenVPN çš„ Tap æ¥å£[2]&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªé¡¹ç›®éƒ½æ˜¯éå¸¸å‡ºåçš„æ­å»ºéš§é“çš„å¼€æº V.P.N é¡¹ç›®ã€‚ç”±äºç›®å‰å¯¹ openVPN é¡¹ç›®ä¸å¤ªäº†è§£ï¼Œä¹Ÿæ²¡æœ‰é€‚é… Tap æ¥å£ï¼Œå› æ­¤è¿™é‡Œé‡ç‚¹ä»‹ç»ä¸‹ WinTun æ¥å£ã€‚æ­¤æ¥å£å®ç°æˆ‘æ˜¯éå¸¸éå¸¸çš„å–œæ¬¢ï¼Œå–œæ¬¢åˆ°ç®€ç›´ä¸è¦ä¸è¦çš„ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="WireGuard" scheme="https://www.hi-linux.com/categories/WireGuard/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="æ•™ç¨‹" scheme="https://www.hi-linux.com/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="WireGuard" scheme="https://www.hi-linux.com/tags/WireGuard/"/>
    
  </entry>
  
</feed>
