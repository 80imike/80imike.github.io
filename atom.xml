<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>è¿ç»´ä¹‹ç¾</title>
  
  <subtitle>ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.hi-linux.com/"/>
  <updated>2020-08-06T06:43:16.897Z</updated>
  <id>https://www.hi-linux.com/</id>
  
  <author>
    <name>Mike</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Kubernetes é«˜æ€§èƒ½ç½‘ç»œç»„ä»¶ Calico å…¥é—¨æ•™ç¨‹</title>
    <link href="https://www.hi-linux.com/posts/38692.html"/>
    <id>https://www.hi-linux.com/posts/38692.html</id>
    <published>2020-08-06T01:00:00.000Z</published>
    <updated>2020-08-06T06:43:16.897Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2 id="1-calicoæ¦‚è¿°">1ã€Calicoæ¦‚è¿°</h2><p>Calico æ˜¯ Kubernetes ç”Ÿæ€ç³»ç»Ÿä¸­å¦ä¸€ç§æµè¡Œçš„ç½‘ç»œé€‰æ‹©ã€‚è™½ç„¶ Flannel è¢«å…¬è®¤ä¸ºæ˜¯æœ€ç®€å•çš„é€‰æ‹©ï¼Œä½† Calico ä»¥å…¶æ€§èƒ½ã€çµæ´»æ€§è€Œé—»åã€‚Calico çš„åŠŸèƒ½æ›´ä¸ºå…¨é¢ï¼Œä¸ä»…æä¾›ä¸»æœºå’Œpodä¹‹é—´çš„ç½‘ç»œè¿æ¥ï¼Œè¿˜æ¶‰åŠç½‘ç»œå®‰å…¨å’Œç®¡ç†ã€‚Calico CNIæ’ä»¶åœ¨ CNI æ¡†æ¶å†…å°è£…äº†Calicoçš„åŠŸèƒ½ã€‚</p><p>Calico æ˜¯ä¸€ä¸ªåŸºäºBGPçš„çº¯ä¸‰å±‚çš„ç½‘ç»œæ–¹æ¡ˆï¼Œä¸ OpenStackã€Kubernetesã€AWSã€GCE ç­‰äº‘å¹³å°éƒ½èƒ½å¤Ÿè‰¯å¥½åœ°é›†æˆã€‚Calico åœ¨æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹éƒ½åˆ©ç”¨ Linux Kernel å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„è™šæ‹Ÿè·¯ç”±å™¨ vRouter æ¥è´Ÿè´£æ•°æ®è½¬å‘ã€‚æ¯ä¸ª vRouter éƒ½é€šè¿‡ BGP1 åè®®æŠŠåœ¨æœ¬èŠ‚ç‚¹ä¸Šè¿è¡Œçš„å®¹å™¨çš„è·¯ç”±ä¿¡æ¯å‘æ•´ä¸ª Calico ç½‘ç»œå¹¿æ’­ï¼Œå¹¶è‡ªåŠ¨è®¾ç½®åˆ°è¾¾å…¶ä»–èŠ‚ç‚¹çš„è·¯ç”±è½¬å‘è§„åˆ™ã€‚Calico ä¿è¯æ‰€æœ‰å®¹å™¨ä¹‹é—´çš„æ•°æ®æµé‡éƒ½æ˜¯é€šè¿‡IPè·¯ç”±çš„æ–¹å¼å®Œæˆäº’è”äº’é€šçš„ã€‚Calico èŠ‚ç‚¹ç»„ç½‘æ—¶å¯ä»¥ç›´æ¥åˆ©ç”¨æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œç»“æ„ï¼ˆ L2 æˆ–è€… L3ï¼‰ï¼Œä¸éœ€è¦é¢å¤–çš„ NATã€éš§é“æˆ–è€… Overlay Networkï¼Œæ²¡æœ‰é¢å¤–çš„å°åŒ…è§£åŒ…ï¼Œèƒ½å¤ŸèŠ‚çº¦ CPU è¿ç®—ï¼Œæé«˜ç½‘ç»œæ•ˆç‡ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/k8s-calico-1.png" alt=""></p><p>Calico åœ¨å°è§„æ¨¡é›†ç¾¤ä¸­å¯ä»¥ç›´æ¥äº’è”ï¼Œåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­å¯ä»¥é€šè¿‡é¢å¤–çš„ BGP route reflector æ¥å®Œæˆã€‚</p><p><img src="https://www.hi-linux.com/img/linux/k8s-calico-2.png" alt=""></p><p>æ­¤å¤–ï¼ŒCalico åŸºäº Iptables è¿˜æä¾›äº†ä¸°å¯Œçš„ç½‘ç»œç­–ç•¥ï¼Œå®ç°äº† Kubernetes çš„ Network Policy ç­–ç•¥ï¼Œæä¾›å®¹å™¨é—´ç½‘ç»œå¯è¾¾æ€§é™åˆ¶çš„åŠŸèƒ½ã€‚</p><a id="more"></a><h2 id="2-calico-æ¶æ„åŠ-bgp-å®ç°">2ã€Calico æ¶æ„åŠ BGP å®ç°</h2><p>BGP æ˜¯äº’è”ç½‘ä¸Šä¸€ä¸ªæ ¸å¿ƒçš„å»ä¸­å¿ƒåŒ–è‡ªæ²»è·¯ç”±åè®®ï¼Œå®ƒé€šè¿‡ç»´æŠ¤IPè·¯ç”±è¡¨æˆ–â€œå‰ç¼€â€è¡¨æ¥å®ç°è‡ªæ²»ç³»ç»ŸASä¹‹é—´çš„å¯è¾¾æ€§ï¼Œå±äºçŸ¢é‡è·¯ç”±åè®®ã€‚ä¸è¿‡ï¼Œè€ƒè™‘åˆ°å¹¶éæ‰€æœ‰çš„ç½‘ç»œéƒ½èƒ½æ”¯æŒ BGPï¼Œä»¥åŠ Calico æ§åˆ¶å¹³é¢çš„è®¾è®¡è¦æ±‚ç‰©ç†ç½‘ç»œå¿…é¡»æ˜¯äºŒå±‚ç½‘ç»œï¼Œä»¥ç¡®ä¿ vRouter é—´å‡ç›´æ¥å¯è¾¾ï¼Œè·¯ç”±ä¸èƒ½å¤Ÿå°†ç‰©ç†è®¾å¤‡å½“ä½œä¸‹ä¸€è·³ç­‰åŸå› ï¼Œä¸ºäº†æ”¯æŒä¸‰å±‚ç½‘ç»œï¼ŒCalico è¿˜æ¨å‡ºäº† IP-in-IP å åŠ çš„æ¨¡å‹ï¼Œå®ƒä¹Ÿä½¿ç”¨ Overlay çš„æ–¹å¼æ¥ä¼ è¾“æ•°æ®ã€‚IPIP çš„åŒ…å¤´éå¸¸å°ï¼Œè€Œä¸”ä¹Ÿæ˜¯å†…ç½®åœ¨å†…æ ¸ä¸­ï¼Œå› æ­¤ç†è®ºä¸Šå®ƒçš„é€Ÿåº¦è¦æ¯” VxLAN å¿«ä¸€ç‚¹ ï¼Œä½†å®‰å…¨æ€§æ›´å·®ã€‚Calico 3.x çš„é»˜è®¤é…ç½®ä½¿ç”¨çš„æ˜¯IPIPç±»å‹çš„ä¼ è¾“æ–¹æ¡ˆè€Œé BGPã€‚</p><p>Calico çš„ç³»ç»Ÿæ¶æ„å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://www.hi-linux.com/img/linux/k8s-calico-3.png" alt=""></p><p>Calico ä¸»è¦ç”± Felixã€Orchestrator Pluginã€etcdã€BIRD å’Œ BGP Router Reflector ç­‰ç»„ä»¶ç»„æˆã€‚</p><ul><li>Felix: Calico Agentï¼Œè¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ã€‚</li><li>Orchestrator Plugiï¼šç¼–æ’ç³»ç»Ÿï¼ˆå¦‚ Kubernetes ã€ OpenStack ç­‰ï¼‰ä»¥å°† Calico æ•´åˆè¿›ç³»ç»Ÿä¸­çš„æ’ä»¶ï¼Œä¾‹å¦‚ Kubernetes çš„ CNIã€‚</li><li>etcdï¼šæŒä¹…å­˜å‚¨Calicoæ•°æ®çš„å­˜å‚¨ç®¡ç†ç³»ç»Ÿã€‚</li><li>BIRDï¼šç”¨äºåˆ†å‘è·¯ç”±ä¿¡æ¯çš„BGPå®¢æˆ·ç«¯ã€‚</li><li>BGP Route Reflector: BGP è·¯ç”±åå°„å™¨ï¼Œå¯é€‰ç»„ä»¶ï¼Œç”¨äºè¾ƒå¤§è§„æ¨¡çš„ç½‘ç»œåœºæ™¯ã€‚</li></ul><h2 id="3-calicoéƒ¨ç½²">3ã€Calicoéƒ¨ç½²</h2><p>åœ¨ Kubernetes ä¸­éƒ¨ç½² Calico çš„ä¸»è¦æ­¥éª¤å¦‚ä¸‹:</p><ul><li><p>ä¿®æ”¹ Kubernetes æœåŠ¡çš„å¯åŠ¨å‚æ•°ï¼Œå¹¶é‡å¯æœåŠ¡</p><ul><li>è®¾ç½® Master ä¸Š kube-apiserver æœåŠ¡çš„å¯åŠ¨å‚æ•°ï¼šâ€“allowprivileged=trueï¼ˆå› ä¸º calico-node éœ€è¦ä»¥ç‰¹æƒæ¨¡å¼è¿è¡Œåœ¨å„ Node ä¸Šï¼‰ã€‚</li><li>è®¾ç½®å„ Node ä¸Š kubelet æœåŠ¡çš„å¯åŠ¨å‚æ•°ï¼šâ€“networkplugin=cniï¼ˆä½¿ç”¨ CNI ç½‘ç»œæ’ä»¶ï¼‰</li></ul></li><li><p>åˆ›å»º Calico æœåŠ¡ï¼Œä¸»è¦åŒ…æ‹¬ calico-node å’Œ calico policy controllerã€‚éœ€è¦åˆ›å»ºçš„èµ„æºå¯¹è±¡å¦‚ä¸‹</p><ul><li>åˆ›å»º ConfigMap calico-configï¼ŒåŒ…å« Calico æ‰€éœ€çš„é…ç½®å‚æ•°</li><li>åˆ›å»º Secret calico-etcd-secretsï¼Œç”¨äºä½¿ç”¨ TLS æ–¹å¼è¿æ¥ etcdã€‚</li><li>åœ¨æ¯ä¸ª Node ä¸Šéƒ½è¿è¡Œ calico/node å®¹å™¨ï¼Œéƒ¨ç½²ä¸º DaemonSet</li><li>åœ¨æ¯ä¸ª Node ä¸Šéƒ½å®‰è£… Calicoï¼ˆç”± install-cni å®¹å™¨å®Œæˆï¼‰</li><li>éƒ¨ç½²ä¸€ä¸ªåä¸º calico/kube-policy-controller çš„ Deploymentï¼Œä»¥å¯¹æ¥ Kubernetes é›†ç¾¤ä¸­ä¸º Pod è®¾ç½®çš„ Network Policy</li></ul></li></ul><p>å…·ä½“éƒ¨ç½²çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>ä¸‹è½½ yaml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># curl https:&#x2F;&#x2F;docs.projectcalico.org&#x2F;v3.11&#x2F;manifests&#x2F;calico-etcd.yaml -o calico-etcd.yaml</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œåä¿®æ”¹é…ç½®é¡¹</p><ul><li>é…ç½®è¿æ¥ etcd åœ°å€ï¼Œå¦‚æœä½¿ç”¨ httpsï¼Œè¿˜éœ€è¦é…ç½®è¯ä¹¦ã€‚ï¼ˆConfigMapï¼ŒSecretï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;opt&#x2F;etcd&#x2F;ssl&#x2F;ca.pem | base64 -w 0</span><br><span class="line">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURlakNDQW1LZ0F3SUJBZ0lVRHQrZ21iYnhzWmoxRGNrbGl3K240MkI5YW5Nd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1F6RUxNQWtHQTFVRUJoTUNRMDR4RURBT0JnTlZCQWdUQjBKbGFXcHBibWN4RURBT0JnTlZCQWNUQjBKbAphV3BwYm1jeEVEQU9CZ05WQkFNVEIyVjBZMlFnUTBFd0hoY05NVGt4TWpBeE1UQXdNREF3V2hjTk1qUXhNVEk1Ck1UQXdNREF3V2pCRE1Rc3dDUVlEVlFRR0V3SkRUakVRTUE0R0ExVUVDQk1IUW1WcGFtbHVaekVRTUE0R0ExVUUKQnhNSFFtVnBhbWx1WnpFUU1BNEdBMVVFQXhNSFpYUmpaQ0JEUVRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRApnZ0VQQURDQ0FRb0NnZ0VCQUtEaGFsNHFaVG5DUE0ra3hvN3pYT2ZRZEFheGo2R3JVSWFwOGd4MTR4dFhRcnhrCmR0ZmVvUXh0UG5EbDdVdG1ZUkUza2xlYXdDOVhxM0hPZ3J1YkRuQ2ZMRnJZV05DUjFkeG1KZkNFdXU0YmZKeE4KVHNETVF1aUlxcnZ2aVN3QnQ3ZHUzczVTbEJUc2NOV0Y4TWNBMkNLTkVRbzR2Snp5RFZXRTlGTm1kdC8wOEV3UwpmZVNPRmpRV3BWWnprQW1Fc0VRaldtYUVHZjcyUXZvbmRNM2Raejl5M2x0UTgrWnJxOGdaZHRBeWpXQmdrZHB1ClVXZ2NaUTBZWmQ2Q2p4YWUwVzBqVkt5RER4bGlSQ3pLcUFiaUNucW9XYW1DVDR3RUdNU2o0Q0JiYTkwVXc3cTgKajVyekFIVVdMK0dnM2dzdndQcXFnL2JmMTR2TzQ2clRkR1g0Q2hzQ0F3RUFBYU5tTUdRd0RnWURWUjBQQVFILwpCQVFEQWdFR01CSUdBMVVkRXdFQi93UUlNQVlCQWY4Q0FRSXdIUVlEVlIwT0JCWUVGRFJTakhxMm0wVWVFM0JmCks2bDZJUUpPU2Vzck1COEdBMVVkSXdRWU1CYUFGRFJTakhxMm0wVWVFM0JmSzZsNklRSk9TZXNyTUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQkFRQUsyZXhBY2VhUndIRU9rQXkxbUsyWlhad1Q1ZC9jRXFFMmZCTmROTXpFeFJSbApnZDV0aGwvYlBKWHRSeWt0aEFUdVB2dzBjWVFPM1gwK09QUGJkOHl6dzRsZk5Ka1FBaUlvRUJUZEQvZWdmODFPCmxZOCtrRFhxZ1FZdFZLQm9HSGt5K2xRNEw4UUdOVEdaeWIvU3J5N0g3VXVDcTN0UmhzR2E4WGQ2YTNIeHJKYUsKTWZna1ZsNDA0bW83QXlWUHl0eHMrNmpLWCtJSmd3a2dHcG9DOXA2cDMyZDI1Q0NJelEweDRiZCtqejQzNXY1VApvRldBUmcySGdiTTR0aHdhRm1VRDcrbHdqVHpMczMreFN3Tys0S3Bmc2tScTR5dEEydUdNRDRqUTd0bnpoNi8wCkhQRkx6N0FGazRHRXoxaTNmMEtVTThEUlhwS0JKUXZNYzk4a3IrK24KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo&#x3D;</span><br><span class="line"></span><br><span class="line"># cat &#x2F;opt&#x2F;etcd&#x2F;ssl&#x2F;server-key.pem | base64 -w 0        </span><br><span class="line">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBdUZJdlNWNndHTTROZURqZktSWDgzWEVTWHhDVERvSVdpcFVJQmVTL3JnTHBFek10Cmk3enp6SjRyUGplbElJZ2ZRdVJHMHdJVXNzN3FDOVhpa3JGcEdnNXp5d2dMNmREZE9KNkUxcUIrUWprbk85ZzgKalRaenc3cWwxSitVOExNZ0k3TWNCU2VtWVo0TUFSTmd6Z09xd2x2WkVBMnUvNFh5azdBdUJYWFgrUTI2SitLVApYVEJ4MnBHOXoxdnVmU0xzMG52YzdKY2gxT2lLZ2R2UHBqSktPQjNMTm83ZnJXMWlaenprTExWSjlEV3U1NFdMCk4rVE5GZWZCK1lBTTdlSHVHTjdHSTJKdW1YL3hKczc3dnQzRjF2VStYSitzVTZ3cmRGMStULzVyamNUN1dDdmgKbkZVWlBxTk9NWUZTWUdlOVBIY1l0Y1Y1MENnUVV2NUx2OTE1elFJREFRQUJBb0lCQUY1YkRBUG1LZ1Y0cmVLRwpVbzhJeDNwZ29NUHppeVJaS2NybGdjYnFrOGt6aWpjZThzamZBSHNWMlJNdmp5TjVLMitseGkvTWwrWDFFRkRnCnUreldUdlJjdzZBQ3pYNXpRbHZ5b2hQdzh0Rlp5cURURUNSRjVMc2t1REdCUTlCNEVoTFVaSnFxOG54MFdMYlEKUWJVVW9YeC9ZajNhazJRUklOM0R5YnRYMlNpUHBPN1hVMmFiVkNzYkZBWW1uN2lweW16M25WWFRseDJuVk1sZQpmYzhXbERsd09pL3FJUThwZjNpRnowRDVoUGl5ZDY5eXp2b2ZrVk5CbCtodGFPbGdwdVNqSEFrNnhIcFpBUExTCkIxclVJaDk1RWozTUk5U3BuSnNWcUFFVHFSSmpYOHl3bFZYa2dvd3I2TXJuTnVXelRZUnlSNDY5UFVmKzhaSzQKUjE1WTdvMENnWUVBM21HdjErSmRuSkVrL1R4M2ZaMkFmOWJIazJ1dE5FemxUakN5YlZtYkxKamx0M1pjSG96UgphZVR2azJSQ0Q4VDU0NU9EWmIzS3Zxdzg2TXkxQW9lWmpqV3pTR1VIVHZJYTRDQ3lMenBXaVNaQkRHSE9KbDBtCk9nbnRRclFPK0UwZjNXOHZtbkp0NGoySGxMWHByL1R6Zk12R05lTWVkSUlIMC8xZXV0WkJjNnNDZ1lFQTFDK0gKaDVtQ0pnbllNcm5zK3dZZ2lWVTJFdjZmRUc2VGl2QU5XUUlldVpHcDRoclZISXc0UTV3SHhZNWgrNE15bXFORAprMmVDYU15RjFxb1NCS1hOckFZS3RtWCtxR3ltaVBpWlRJWEltZlppcENocWl3dm1udjMxbWE1Njk2NkZ6SjdaCjJTLzZkTGtweWI2OTUxRTl5azRBOEYzNVdQRlY4M01DanJ1bjBHY0NnWUFoOFVFWXIybGdZMXNFOS95NUJKZy8KYXZYdFQyc1JaNGM4WnZ4azZsOWY4RHBueFQ0TVA2d2JBS0Y4bXJubWxFY2I4RUVHLzIvNXFHcG5rZzh5d3FXeQphZ25pUytGUXNHMWZ0ajNjTFloVnlLdjNDdHFmU21weVExK2VaY00vTE81bkt2aFdGNDhrRUFZb3NaZG9qdmUzCkhaYzBWR1VxblVvNmxocW1ZOXQ3bndLQmdGbFFVRm9Sa2FqMVI5M0NTVEE0bWdWMHFyaEFHVEJQZXlkbWVCZloKUHBtWjZNcFZ4UktwS3gyNlZjTWdkYm5xdGFoRnhMSU5SZVZiQVpNa0wwVnBqVE0xcjlpckFoQmUrNUo0SWY4Rgo2VFIxYzN2cHp6OE1HVjBmUlB3Vlo0bE9HdC9RbFo1SUJjS1FGampuWXdRMVBDOGx1bHR6RXZ3UFNjQ1p6cC9KCitZOU5Bb0dBVkpybjl4QmZhYWF5T3BlMHFTTjNGVzRlaEZyaTFaRUYvVHZqS3lnMnJGUng3VDRhY1dNWWdSK20KL2RsYU9CRFN6bjNheVVXNlBwSnN1UTBFanpIajFNSVFtV3JOQXNGSVJiN0Z6YzdhaVQzMFZmNFFYUmMwQUloLwpXNHk0OW5wNWNDWUZ5SXRSWEhXMUk5bkZPSjViQjF2b1pYTWNMK1dyMVZVa2FuVlIvNEE9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line"># cat &#x2F;opt&#x2F;etcd&#x2F;ssl&#x2F;server.pem | base64 -w 0</span><br><span class="line">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURyekNDQXBlZ0F3SUJBZ0lVZUFZTHdLMkxVdnE0V2ZiSG92cTlzVS8rWlJ3d0RRWUpLb1pJaHZjTkFRRUwKQlFBd1F6RUxNQWtHQTFVRUJoTUNRMDR4RURBT0JnTlZCQWdUQjBKbGFXcHBibWN4RURBT0JnTlZCQWNUQjBKbAphV3BwYm1jeEVEQU9CZ05WQkFNVEIyVjBZMlFnUTBFd0hoY05NVGt4TWpBeE1UQXdNREF3V2hjTk1qa3hNVEk0Ck1UQXdNREF3V2pCQU1Rc3dDUVlEVlFRR0V3SkRUakVRTUE0R0ExVUVDQk1IUW1WcFNtbHVaekVRTUE0R0ExVUUKQnhNSFFtVnBTbWx1WnpFTk1Bc0dBMVVFQXhNRVpYUmpaRENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUApBRENDQVFvQ2dnRUJBTGhTTDBsZXNCak9EWGc0M3lrVi9OMXhFbDhRa3c2Q0ZvcVZDQVhrdjY0QzZSTXpMWXU4Cjg4eWVLejQzcFNDSUgwTGtSdE1DRkxMTzZndlY0cEt4YVJvT2M4c0lDK25RM1RpZWhOYWdma0k1Snp2WVBJMDIKYzhPNnBkU2ZsUEN6SUNPekhBVW5wbUdlREFFVFlNNERxc0piMlJBTnJ2K0Y4cE93TGdWMTEva051aWZpazEwdwpjZHFSdmM5YjduMGk3Tko3M095WElkVG9pb0hiejZZeVNqZ2R5emFPMzYxdFltYzg1Q3kxU2ZRMXJ1ZUZpemZrCnpSWG53Zm1BRE8zaDdoamV4aU5pYnBsLzhTYk8rNzdkeGRiMVBseWZyRk9zSzNSZGZrLythNDNFKzFncjRaeFYKR1Q2alRqR0JVbUJudlR4M0dMWEZlZEFvRUZMK1M3L2RlYzBDQXdFQUFhT0JuVENCbWpBT0JnTlZIUThCQWY4RQpCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQXdHQTFVZEV3RUIvd1FDCk1BQXdIUVlEVlIwT0JCWUVGTHNKb2pPRUZGcGVEdEhFSTBZOEZIUjQvV0c4TUI4R0ExVWRJd1FZTUJhQUZEUlMKakhxMm0wVWVFM0JmSzZsNklRSk9TZXNyTUJzR0ExVWRFUVFVTUJLSEJNQ29BajJIQk1Db0FqNkhCTUNvQWo4dwpEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQzVOSlh6QTQvTStFRjFHNXBsc2luSC9sTjlWWDlqK1FHdU0wRWZrCjhmQnh3bmV1ZzNBM2l4OGxXQkhZTCtCZ0VySWNsc21ZVXpJWFJXd0h4ZklKV2x1Ukx5NEk3OHB4bDBaVTZWUTYKalFiQVI2YzhrK0FhbGxBTUJUTkphY3lTWkV4MVp2c3BVTUJUU0l3bmk5RFFDUDJIQStDNG5mdHEwMGRvckQwcgp5OXVDZ3dnSDFrOG42TkdSZ0lJbVl6dFlZZmZHbEQ3R3lybEM1N0plSkFFbElUaElEMks1Y090M2dUb2JiNk5oCk9pSWpNWVAwYzRKL1FTTHNMNjZZRTh5YnhvZ2M2L3JTYzBIblladkNZbXc5MFZxY05oU3hkT2liaWtPUy9SdDAKZHVRSnU3cmdkM3pldys3Y05CaTIwTFZrbzc3dDNRZWRZK0c3dUxVZ21qNWJudkU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><br></pre></td></tr></table></figure><p>å°†ä¸Šè¿° Base64 åŠ å¯†çš„å­—ç¬¦ä¸²ä¿®æ”¹è‡³æ–‡ä»¶ä¸­å£°æ˜ï¼šca.pem å¯¹åº” etcd-caã€server-key.pem å¯¹åº” etcd-keyã€server.pem å¯¹åº” etcd-certï¼›ä¿®æ”¹ etcd è¯ä¹¦çš„ä½ç½®ï¼›ä¿®æ”¹ etcd çš„è¿æ¥åœ°å€(ä¸ api-server ä¸­é…ç½® /opt/kubernetes/cfg/kube-apiserver.conf ä¸­ç›¸åŒ)ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># vim calico-etcd.yaml</span><br><span class="line">...</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">type: Opaque</span><br><span class="line">metadata:</span><br><span class="line">  name: calico-etcd-secrets</span><br><span class="line">  namespace: kube-system</span><br><span class="line">data:</span><br><span class="line">  # Populate the following with etcd TLS configuration if desired, but leave blank if</span><br><span class="line">  # not using TLS for etcd.</span><br><span class="line">  # The keys below should be uncommented and the values populated with the base64</span><br><span class="line">  # encoded contents of each file that would be associated with the TLS data.</span><br><span class="line">  # Example command for encoding a file contents: cat &lt;file&gt; | base64 -w 0</span><br><span class="line">  etcd-key: å¡«å†™ä¸Šé¢çš„åŠ å¯†å­—ç¬¦ä¸²</span><br><span class="line">  etcd-cert: å¡«å†™ä¸Šé¢çš„åŠ å¯†å­—ç¬¦ä¸²</span><br><span class="line">  etcd-ca: å¡«å†™ä¸Šé¢çš„åŠ å¯†å­—ç¬¦ä¸²</span><br><span class="line">...</span><br><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: calico-config</span><br><span class="line">  namespace: kube-system</span><br><span class="line">data:</span><br><span class="line">  # Configure this with the location of your etcd cluster.</span><br><span class="line">  etcd_endpoints: &quot;https:&#x2F;&#x2F;192.168.2.61:2379,https:&#x2F;&#x2F;192.168.2.62:2379,https:&#x2F;&#x2F;192.168.2.63:2379&quot;</span><br><span class="line">  # If you&#39;re using TLS enabled etcd uncomment the following.</span><br><span class="line">  # You must also populate the Secret below with these files.</span><br><span class="line">  etcd_ca: &quot;&#x2F;calico-secrets&#x2F;etcd-ca&quot;</span><br><span class="line">  etcd_cert: &quot;&#x2F;calico-secrets&#x2F;etcd-cert&quot;</span><br><span class="line">  etcd_key: &quot;&#x2F;calico-secrets&#x2F;etcd-key&quot;</span><br></pre></td></tr></table></figure><p>æ ¹æ®å®é™…ç½‘ç»œè§„åˆ’ä¿®æ”¹ Pod CIDRï¼ˆCALICO_IPV4POOL_CIDRï¼‰,ä¸ controller-manager é…ç½® /opt/kubernetes/cfg/kube-controller-manager.conf ä¸­ç›¸åŒã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vim calico-etcd.yaml</span><br><span class="line">...</span><br><span class="line">320             - name: CALICO_IPV4POOL_CIDR</span><br><span class="line">321               value: &quot;10.244.0.0&#x2F;16&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é€‰æ‹©å·¥ä½œæ¨¡å¼ï¼ˆCALICO_IPV4POOL_IPIPï¼‰ï¼Œæ”¯æŒ BGPï¼ŒIPIPï¼Œæ­¤å¤„å…ˆå…³é—­ IPIP æ¨¡å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vim calico-etcd.yaml</span><br><span class="line">...</span><br><span class="line">309             - name: CALICO_IPV4POOL_IPIP</span><br><span class="line">310               value: &quot;Never&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œååº”ç”¨æ¸…å•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># kubectl apply -f calico-etcd.yaml </span><br><span class="line">secret&#x2F;calico-etcd-secrets created</span><br><span class="line">configmap&#x2F;calico-config created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io&#x2F;calico-kube-controllers created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io&#x2F;calico-kube-controllers created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io&#x2F;calico-node created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io&#x2F;calico-node created</span><br><span class="line">daemonset.apps&#x2F;calico-node created</span><br><span class="line">serviceaccount&#x2F;calico-node created</span><br><span class="line">deployment.apps&#x2F;calico-kube-controllers created</span><br><span class="line">serviceaccount&#x2F;calico-kube-controllers created</span><br><span class="line"># kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure><p>å¦‚æœäº‹å…ˆéƒ¨ç½²äº† Fannel ç½‘ç»œç»„ä»¶ï¼Œéœ€è¦å…ˆå¸è½½å’Œåˆ é™¤ Flannelï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹å‡éœ€è¦æ“ä½œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># kubectl delete -f kube-flannel.yaml</span><br><span class="line"># ip link delete cni0</span><br><span class="line"># ip link delete flannel.1</span><br><span class="line"># ip route </span><br><span class="line">default via 192.168.2.2 dev eth0 </span><br><span class="line">10.244.1.0&#x2F;24 via 192.168.2.63 dev eth0 </span><br><span class="line">10.244.2.0&#x2F;24 via 192.168.2.62 dev eth0 </span><br><span class="line">169.254.0.0&#x2F;16 dev eth0 scope link metric 1002 </span><br><span class="line">172.17.0.0&#x2F;16 dev docker0 proto kernel scope link src 172.17.0.1 </span><br><span class="line">192.168.2.0&#x2F;24 dev eth0 proto kernel scope link src 192.168.2.61 </span><br><span class="line"># ip route del 10.244.1.0&#x2F;24 via 192.168.2.63 dev eth0 </span><br><span class="line"># ip route del 10.244.2.0&#x2F;24 via 192.168.2.62 dev eth0</span><br><span class="line"># ip route </span><br><span class="line">default via 192.168.2.2 dev eth0 </span><br><span class="line">169.254.0.0&#x2F;16 dev eth0 scope link metric 1002 </span><br><span class="line">172.17.0.0&#x2F;16 dev docker0 proto kernel scope link src 172.17.0.1 </span><br><span class="line">192.168.2.0&#x2F;24 dev eth0 proto kernel scope link src 192.168.2.61</span><br></pre></td></tr></table></figure><h2 id="4-calico-ç®¡ç†å·¥å…·">4ã€Calico ç®¡ç†å·¥å…·</h2><p>ä¸‹è½½å·¥å…·ï¼š<a href="https://github.com/projectcalico/calicoctl/releases" target="_blank" rel="noopener">https://github.com/projectcalico/calicoctl/releases</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># wget -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;calicoctl https:&#x2F;&#x2F;github.com&#x2F;projectcalico&#x2F;calicoctl&#x2F;releases&#x2F;download&#x2F;v3.11.1&#x2F;calicoctl</span><br><span class="line"># chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;calicoctl</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ calicoctl æŸ¥çœ‹æœåŠ¡çŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># .&#x2F;calicoctl node status</span><br><span class="line">Calico process is running.</span><br><span class="line"></span><br><span class="line">IPv4 BGP status</span><br><span class="line">+--------------+-------------------+-------+----------+-------------+</span><br><span class="line">| PEER ADDRESS |     PEER TYPE     | STATE |  SINCE   |    INFO     |</span><br><span class="line">+--------------+-------------------+-------+----------+-------------+</span><br><span class="line">| 192.168.2.62 | node-to-node mesh | up    | 02:58:05 | Established |</span><br><span class="line">| 192.168.2.63 | node-to-node mesh | up    | 03:08:46 | Established |</span><br><span class="line">+--------------+-------------------+-------+----------+-------------+</span><br><span class="line"></span><br><span class="line">IPv6 BGP status</span><br><span class="line">No IPv6 peers found.</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œä½¿ç”¨ calicoctl æŸ¥çœ‹ Node çŠ¶æ€å°±æ˜¯è°ƒç”¨ç³»ç»ŸæŸ¥çœ‹çš„ï¼Œä¸ netstat æ•ˆæœä¸€æ ·ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># netstat -antp|grep bird  </span><br><span class="line">tcp        0      0 0.0.0.0:179             0.0.0.0:*               LISTEN      62709&#x2F;bird          </span><br><span class="line">tcp        0      0 192.168.2.61:179        192.168.2.63:58963      ESTABLISHED 62709&#x2F;bird          </span><br><span class="line">tcp        0      0 192.168.2.61:179        192.168.2.62:37390      ESTABLISHED 62709&#x2F;bird</span><br></pre></td></tr></table></figure><p>æƒ³è¦æŸ¥çœ‹æ›´å¤šçš„ä¿¡æ¯ï¼Œéœ€è¦æŒ‡å®šé…ç½®æŸ¥çœ‹ etcd ä¸­çš„æ•°æ®</p><p>åˆ›å»ºé…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># mkdir &#x2F;etc&#x2F;calico</span><br><span class="line"># vim &#x2F;etc&#x2F;calico&#x2F;calicoctl.cfg  </span><br><span class="line">apiVersion: projectcalico.org&#x2F;v3</span><br><span class="line">kind: CalicoAPIConfig</span><br><span class="line">metadata:</span><br><span class="line">spec:</span><br><span class="line">  datastoreType: &quot;etcdv3&quot;</span><br><span class="line">  etcdEndpoints: &quot;https:&#x2F;&#x2F;192.168.2.61:2379,https:&#x2F;&#x2F;192.168.2.62:2379,https:&#x2F;&#x2F;192.168.2.63:2379&quot;</span><br><span class="line">  etcdKeyFile: &quot;&#x2F;opt&#x2F;etcd&#x2F;ssl&#x2F;server-key.pem&quot;</span><br><span class="line">  etcdCertFile: &quot;&#x2F;opt&#x2F;etcd&#x2F;ssl&#x2F;server.pem&quot;</span><br><span class="line">  etcdCACertFile: &quot;&#x2F;opt&#x2F;etcd&#x2F;ssl&#x2F;ca.pem&quot;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ•°æ®ç­‰æ“ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># calicoctl get node</span><br><span class="line">NAME            </span><br><span class="line">k8s-master-01   </span><br><span class="line">k8s-node-01     </span><br><span class="line">k8s-node-02</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ IPAM çš„ IP åœ°å€æ± ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># .&#x2F;calicoctl get ippool</span><br><span class="line">NAME                  CIDR            SELECTOR   </span><br><span class="line">default-ipv4-ippool   10.244.0.0&#x2F;16   all()      </span><br><span class="line"></span><br><span class="line"># .&#x2F;calicoctl get ippool -o wide</span><br><span class="line">NAME                  CIDR            NAT    IPIPMODE   VXLANMODE   DISABLED   SELECTOR   </span><br><span class="line">default-ipv4-ippool   10.244.0.0&#x2F;16   true   Never      Never       false      all()</span><br></pre></td></tr></table></figure><h2 id="5-calico-bgp-æ¨¡å¼">5ã€Calico BGP æ¨¡å¼</h2><p><img src="https://www.hi-linux.com/img/linux/k8s-calico-4.png" alt=""></p><p>Pod 1 è®¿é—® Pod 2 å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ•°æ®åŒ…ä»å®¹å™¨ 1 å‡ºåˆ°è¾¾ Veth Pair å¦ä¸€ç«¯ï¼ˆå®¿ä¸»æœºä¸Šï¼Œä»¥ cali å‰ç¼€å¼€å¤´ï¼‰ï¼›</li><li>å®¿ä¸»æœºæ ¹æ®è·¯ç”±è§„åˆ™ï¼Œå°†æ•°æ®åŒ…è½¬å‘ç»™ä¸‹ä¸€è·³ï¼ˆç½‘å…³ï¼‰ï¼›</li><li>åˆ°è¾¾ Node 2ï¼Œæ ¹æ®è·¯ç”±è§„åˆ™å°†æ•°æ®åŒ…è½¬å‘ç»™ cali è®¾å¤‡ï¼Œä»è€Œåˆ°è¾¾å®¹å™¨ 2ã€‚</li></ul><p>è·¯ç”±è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># node1</span><br><span class="line">10.244.36.65 dev cali4f18ce2c9a1 scope link </span><br><span class="line">10.244.169.128&#x2F;26 via 192.168.31.63 dev ens33 proto bird </span><br><span class="line">10.244.235.192&#x2F;26 via 192.168.31.61 dev ens33 proto bird </span><br><span class="line"></span><br><span class="line"># node2</span><br><span class="line">10.244.169.129 dev calia4d5b2258bb scope link </span><br><span class="line">10.244.36.64&#x2F;26 via 192.168.31.62 dev ens33 proto bird</span><br><span class="line">10.244.235.192&#x2F;26 via 192.168.31.61 dev ens33 proto bird</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œè¿™é‡Œæœ€æ ¸å¿ƒçš„ â€œä¸‹ä¸€è·³â€ è·¯ç”±è§„åˆ™ï¼Œå°±æ˜¯ç”± Calico çš„ Felix è¿›ç¨‹è´Ÿè´£ç»´æŠ¤çš„ã€‚è¿™äº›è·¯ç”±è§„åˆ™ä¿¡æ¯ï¼Œåˆ™æ˜¯é€šè¿‡ BGP Client ä¹Ÿå°±æ˜¯ BIRD ç»„ä»¶ï¼Œä½¿ç”¨ BGP åè®®ä¼ è¾“è€Œæ¥çš„ã€‚</p><p>ä¸éš¾å‘ç°ï¼ŒCalico é¡¹ç›®å®é™…ä¸Šå°†é›†ç¾¤é‡Œçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œéƒ½å½“ä½œæ˜¯è¾¹ç•Œè·¯ç”±å™¨æ¥å¤„ç†ï¼Œå®ƒä»¬ä¸€èµ·ç»„æˆäº†ä¸€ä¸ªå…¨è¿é€šçš„ç½‘ç»œï¼Œäº’ç›¸ä¹‹é—´é€šè¿‡ BGP åè®®äº¤æ¢è·¯ç”±è§„åˆ™ã€‚è¿™äº›èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç§°ä¸º BGP Peerã€‚</p><p>Calico ç›¸å…³æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># ls &#x2F;opt&#x2F;cni&#x2F;bin&#x2F;calico-ipam </span><br><span class="line">&#x2F;opt&#x2F;cni&#x2F;bin&#x2F;calico-ipam</span><br><span class="line"># cat &#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;</span><br><span class="line">10-calico.conflist  calico-kubeconfig    calico-tls&#x2F;          </span><br><span class="line"># cat &#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;10-calico.conflist </span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;k8s-pod-network&quot;,</span><br><span class="line">  &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;calico&quot;,</span><br><span class="line">      &quot;log_level&quot;: &quot;info&quot;,</span><br><span class="line">      &quot;etcd_endpoints&quot;: &quot;https:&#x2F;&#x2F;192.168.2.61:2379,https:&#x2F;&#x2F;192.168.2.62:2379,https:&#x2F;&#x2F;192.168.2.63:2379&quot;,</span><br><span class="line">      &quot;etcd_key_file&quot;: &quot;&#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;calico-tls&#x2F;etcd-key&quot;,</span><br><span class="line">      &quot;etcd_cert_file&quot;: &quot;&#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;calico-tls&#x2F;etcd-cert&quot;,</span><br><span class="line">      &quot;etcd_ca_cert_file&quot;: &quot;&#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;calico-tls&#x2F;etcd-ca&quot;,</span><br><span class="line">      &quot;mtu&quot;: 1440,</span><br><span class="line">      &quot;ipam&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;calico-ipam&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;policy&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;k8s&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;kubernetes&quot;: &#123;</span><br><span class="line">          &quot;kubeconfig&quot;: &quot;&#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;calico-kubeconfig&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;portmap&quot;,</span><br><span class="line">      &quot;snat&quot;: true,</span><br><span class="line">      &quot;capabilities&quot;: &#123;&quot;portMappings&quot;: true&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-calico-route-reflector-æ¨¡å¼rr">6ã€Calico Route Reflector æ¨¡å¼ï¼ˆRRï¼‰</h2><p>Calico ç»´æŠ¤çš„ç½‘ç»œåœ¨é»˜è®¤æ˜¯ï¼ˆNode-to-Node Meshï¼‰å…¨äº’è”æ¨¡å¼ï¼ŒCalico é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹‹é—´éƒ½ä¼šç›¸äº’å»ºç«‹è¿æ¥ï¼Œç”¨äºè·¯ç”±äº¤æ¢ã€‚ä½†æ˜¯éšç€é›†ç¾¤è§„æ¨¡çš„æ‰©å¤§ï¼ŒMesh æ¨¡å¼å°†å½¢æˆä¸€ä¸ªå·¨å¤§æœåŠ¡ç½‘æ ¼ï¼Œè¿æ¥æ•°æˆå€å¢åŠ ã€‚</p><p>è¿™æ—¶å°±éœ€è¦ä½¿ç”¨ Route Reflectorï¼ˆè·¯ç”±å™¨åå°„ï¼‰æ¨¡å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ç¡®å®šä¸€ä¸ªæˆ–å¤šä¸ª Calico èŠ‚ç‚¹å……å½“è·¯ç”±åå°„å™¨ï¼ˆä¸€èˆ¬é…ç½®ä¸¤ä¸ªä»¥ä¸Šï¼‰ï¼Œè®©å…¶ä»–èŠ‚ç‚¹ä»è¿™ä¸ª RR èŠ‚ç‚¹è·å–è·¯ç”±ä¿¡æ¯ã€‚</p><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å…³é—­ node-to-node BGP ç½‘æ ¼</li></ol><p>é»˜è®¤ node to node æ¨¡å¼æœ€å¥½åœ¨ 100 ä¸ªèŠ‚ç‚¹ä»¥ä¸‹</p><p>æ·»åŠ  default BGP é…ç½®ï¼Œè°ƒæ•´ nodeToNodeMeshEnabled å’Œ asNumberï¼šbgp.yaml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># cat &lt;&lt; EOF | calicoctl create -f -</span><br><span class="line">apiVersion: projectcalico.org&#x2F;v3</span><br><span class="line">kind: BGPConfiguration</span><br><span class="line">metadata:</span><br><span class="line">  name: default</span><br><span class="line">spec:</span><br><span class="line">  logSeverityScreen: Info</span><br><span class="line">  nodeToNodeMeshEnabled: false  </span><br><span class="line">  asNumber: 63400</span><br><span class="line">EOF</span><br><span class="line"># calicoctl apply -f bgp.yaml  # ä¸€æ—¦æ‰§è¡Œï¼Œé›†ç¾¤ä¼šç«‹å³æ–­ç½‘</span><br><span class="line">Successfully applied 1 &#39;BGPConfiguration&#39; resource(s)</span><br><span class="line"># calicoctl get bgpconfig</span><br><span class="line">NAME      LOGSEVERITY   MESHENABLED   ASNUMBER   </span><br><span class="line">default   Info          false         63400</span><br><span class="line"># calicoctl node status</span><br><span class="line">Calico process is running.</span><br><span class="line"></span><br><span class="line">IPv4 BGP status</span><br><span class="line">No IPv4 peers found.</span><br><span class="line"></span><br><span class="line">IPv6 BGP status</span><br><span class="line">No IPv6 peers found.</span><br></pre></td></tr></table></figure><p>ASN å·å¯ä»¥é€šè¿‡è·å–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># calicoctl get nodes --output&#x3D;wide  </span><br><span class="line">NAME            ASN       IPV4              IPV6   </span><br><span class="line">k8s-master-01   (63400)   192.168.2.61&#x2F;24          </span><br><span class="line">k8s-node-01     (63400)   192.168.2.62&#x2F;24          </span><br><span class="line">k8s-node-02     (63400)   192.168.2.63&#x2F;24</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®æŒ‡å®šèŠ‚ç‚¹å……å½“è·¯ç”±åå°„å™¨</li></ol><p>ä¸ºæ–¹ä¾¿è®© BGPPeer è½»æ¾é€‰æ‹©èŠ‚ç‚¹ï¼Œé€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨åŒ¹é…ã€‚</p><p>ç»™è·¯ç”±å™¨åå°„å™¨èŠ‚ç‚¹æ‰“æ ‡ç­¾ï¼š</p><p>å¢åŠ ç¬¬äºŒä¸ªè·¯ç”±åå°„å™¨æ—¶ï¼Œç»™æ–°çš„ node æ‰“æ ‡ç­¾å¹¶é…ç½®æˆåå°„å™¨èŠ‚ç‚¹å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># kubectl label node k8s-node-02 route-reflector&#x3D;true</span><br><span class="line">node&#x2F;k8s-node-02 labeled</span><br></pre></td></tr></table></figure><p>ç„¶åé…ç½®è·¯ç”±å™¨åå°„å™¨èŠ‚ç‚¹ routeReflectorClusterIDï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># calicoctl get nodes k8s-node-02 -o yaml&gt; node.yaml</span><br><span class="line"># vim node.yaml</span><br><span class="line">apiVersion: projectcalico.org&#x2F;v3</span><br><span class="line">kind: Node</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    projectcalico.org&#x2F;kube-labels: &#39;&#123;&quot;beta.kubernetes.io&#x2F;arch&quot;:&quot;amd64&quot;,&quot;beta.kubernetes.io&#x2F;os&quot;:&quot;linux&quot;,&quot;kubernetes.io&#x2F;arch&quot;:&quot;amd64&quot;,&quot;kubernetes.io&#x2F;hostname&quot;:&quot;k8s-node2&quot;,&quot;kubernetes.io&#x2F;os&quot;:&quot;linux&quot;&#125;&#39;</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    beta.kubernetes.io&#x2F;arch: amd64</span><br><span class="line">    beta.kubernetes.io&#x2F;os: linux</span><br><span class="line">    kubernetes.io&#x2F;arch: amd64</span><br><span class="line">    kubernetes.io&#x2F;hostname: k8s-node2</span><br><span class="line">    kubernetes.io&#x2F;os: linux</span><br><span class="line">  name: k8s-node2</span><br><span class="line">spec:</span><br><span class="line">  bgp:</span><br><span class="line">    ipv4Address: 192.168.31.63&#x2F;24</span><br><span class="line">    routeReflectorClusterID: 244.0.0.1   # å¢åŠ é›†ç¾¤ID</span><br><span class="line">  orchRefs:</span><br><span class="line">  - nodeName: k8s-node2</span><br><span class="line">    orchestrator: k8s</span><br><span class="line"># .&#x2F;calicoctl apply -f node.yaml </span><br><span class="line">Successfully applied 1 &#39;Node&#39; resource(s)</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå¾ˆå®¹æ˜“ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨å°†è·¯ç”±åå°„å™¨èŠ‚ç‚¹ä¸å…¶ä»–éè·¯ç”±åå°„å™¨èŠ‚ç‚¹é…ç½®ä¸ºå¯¹ç­‰ã€‚è¡¨ç¤ºæ‰€æœ‰èŠ‚ç‚¹éƒ½è¿æ¥è·¯ç”±åå°„å™¨èŠ‚ç‚¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># vim peer-with-route-reflectors.yaml</span><br><span class="line">apiVersion: projectcalico.org&#x2F;v3</span><br><span class="line">kind: BGPPeer</span><br><span class="line">metadata:</span><br><span class="line">  name: peer-with-route-reflectors</span><br><span class="line">spec:</span><br><span class="line">  nodeSelector: all()</span><br><span class="line">  peerSelector: route-reflector &#x3D;&#x3D; &#39;true&#39;</span><br><span class="line"># calicoctl apply -f peer-with-route-reflectors.yaml</span><br><span class="line">Successfully applied 1 &#39;BGPPeer&#39; resource(s)</span><br><span class="line"># calicoctl get bgppeer</span><br><span class="line">NAME                         PEERIP   NODE    ASN   </span><br><span class="line">peer-with-route-reflectors            all()   0</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹èŠ‚ç‚¹çš„BGPè¿æ¥çŠ¶æ€ï¼Œåªæœ‰æœ¬èŠ‚ç‚¹ä¸è·¯ç”±åå°„å™¨èŠ‚ç‚¹çš„è¿æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># calicoctl node status                             </span><br><span class="line">Calico process is running.</span><br><span class="line"></span><br><span class="line">IPv4 BGP status</span><br><span class="line">+--------------+---------------+-------+----------+-------------+</span><br><span class="line">| PEER ADDRESS |   PEER TYPE   | STATE |  SINCE   |    INFO     |</span><br><span class="line">+--------------+---------------+-------+----------+-------------+</span><br><span class="line">| 192.168.2.63 | node specific | up    | 04:17:14 | Established |</span><br><span class="line">+--------------+---------------+-------+----------+-------------+</span><br><span class="line"></span><br><span class="line">IPv6 BGP status</span><br><span class="line">No IPv6 peers found.</span><br></pre></td></tr></table></figure><h2 id="7-calico-ipip-æ¨¡å¼">7ã€Calico IPIP æ¨¡å¼</h2><p>Flannel host-gw æ¨¡å¼æœ€ä¸»è¦çš„é™åˆ¶ï¼Œå°±æ˜¯è¦æ±‚é›†ç¾¤å®¿ä¸»æœºä¹‹é—´æ˜¯äºŒå±‚è¿é€šçš„ã€‚è€Œè¿™ä¸ªé™åˆ¶å¯¹äº Calico æ¥è¯´ï¼Œä¹ŸåŒæ ·å­˜åœ¨ã€‚</p><p>ä¿®æ”¹ä¸º IPIP æ¨¡å¼ï¼š</p><p>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨éƒ¨ç½² Calico çš„æ—¶å€™ç›´æ¥ä¿®æ”¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># calicoctl get ipPool -o yaml &gt; ipip.yaml</span><br><span class="line"># vi ipip.yaml</span><br><span class="line">apiVersion: projectcalico.org&#x2F;v3</span><br><span class="line">kind: IPPool</span><br><span class="line">metadata:</span><br><span class="line">  name: default-ipv4-ippool</span><br><span class="line">spec:</span><br><span class="line">  blockSize: 26</span><br><span class="line">  cidr: 10.244.0.0&#x2F;16</span><br><span class="line">  ipipMode: Always  # å¯åŠ¨ipipæ¨¡å¼</span><br><span class="line">  natOutgoing: true</span><br><span class="line"></span><br><span class="line"># calicoctl apply -f ipip.yaml</span><br><span class="line"># calicoctl get ippool -o wide</span><br><span class="line">NAME                  CIDR            NAT    IPIPMODE   VXLANMODE   DISABLED   SELECTOR   </span><br><span class="line">default-ipv4-ippool   10.244.0.0&#x2F;16   true   Always     Never       false      all()</span><br><span class="line"># ip route # ä¼šå¢åŠ tunl0ç½‘å¡</span><br><span class="line">default via 192.168.2.2 dev eth0 </span><br><span class="line">10.244.44.192&#x2F;26 via 192.168.2.63 dev tunl0 proto bird onlink </span><br><span class="line">blackhole 10.244.151.128&#x2F;26 proto bird </span><br><span class="line">10.244.154.192&#x2F;26 via 192.168.2.62 dev tunl0 proto bird onlink </span><br><span class="line">169.254.0.0&#x2F;16 dev eth0 scope link metric 1002 </span><br><span class="line">172.17.0.0&#x2F;16 dev docker0 proto kernel scope link src 172.17.0.1 </span><br><span class="line">192.168.2.0&#x2F;24 dev eth0 proto kernel scope link src 192.168.2.61</span><br></pre></td></tr></table></figure><p>IPIP ç¤ºæ„å›¾ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/k8s-calico-5.png" alt=""></p><p>Pod 1 è®¿é—® Pod 2 å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ•°æ®åŒ…ä»å®¹å™¨1 å‡ºåˆ°è¾¾ Veth Pair å¦ä¸€ç«¯ï¼ˆå®¿ä¸»æœºä¸Šï¼Œä»¥ cali å‰ç¼€å¼€å¤´ï¼‰ï¼›</li><li>è¿›å…¥ IP éš§é“è®¾å¤‡ï¼ˆ tunl0 ï¼‰ï¼Œç”± Linux å†…æ ¸ IPIP é©±åŠ¨å°è£…åœ¨å®¿ä¸»æœºç½‘ç»œçš„ IP åŒ…ä¸­ï¼ˆæ–°çš„ IP åŒ…ç›®çš„åœ°ä¹‹æ˜¯åŸ IP åŒ…çš„ä¸‹ä¸€è·³åœ°å€ï¼Œå³ 192.168.31.63 ï¼‰ï¼Œè¿™æ ·ï¼Œå°±æˆäº† Node1 åˆ° Node2 çš„æ•°æ®åŒ…ï¼›</li><li>æ•°æ®åŒ…ç»è¿‡è·¯ç”±å™¨ä¸‰å±‚è½¬å‘åˆ° Node2ï¼›</li><li>Node2 æ”¶åˆ°æ•°æ®åŒ…åï¼Œç½‘ç»œåè®®æ ˆä¼šä½¿ç”¨ IPIP é©±åŠ¨è¿›è¡Œè§£åŒ…ï¼Œä»ä¸­æ‹¿åˆ°åŸå§‹ IP åŒ…ï¼›</li><li>ç„¶åæ ¹æ®è·¯ç”±è§„åˆ™ï¼Œæ ¹æ®è·¯ç”±è§„åˆ™å°†æ•°æ®åŒ…è½¬å‘ç»™ Cali è®¾å¤‡ï¼Œä»è€Œåˆ°è¾¾å®¹å™¨ 2ã€‚</li></ul><p>è·¯ç”±è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># node1</span><br><span class="line">10.244.36.65 dev cali4f18ce2c9a1 scope link </span><br><span class="line">10.244.169.128&#x2F;26 via 192.168.31.63 dev tunl0 proto bird onlink </span><br><span class="line"># node2</span><br><span class="line">10.244.169.129 dev calia4d5b2258bb scope link </span><br><span class="line">10.244.36.64&#x2F;26 via 192.168.31.62 dev tunl0 proto bird onlink</span><br></pre></td></tr></table></figure><p>ä¸éš¾çœ‹åˆ°ï¼Œå½“ Calico ä½¿ç”¨ IPIP æ¨¡å¼çš„æ—¶å€™ï¼Œé›†ç¾¤çš„ç½‘ç»œæ€§èƒ½ä¼šå› ä¸ºé¢å¤–çš„å°åŒ…å’Œè§£åŒ…å·¥ä½œè€Œä¸‹é™ã€‚æ‰€ä»¥å»ºè®®ä½ å°†æ‰€æœ‰å®¿ä¸»æœºèŠ‚ç‚¹æ”¾åœ¨ä¸€ä¸ªå­ç½‘é‡Œï¼Œé¿å…ä½¿ç”¨ IPIPã€‚</p><h2 id="8-calico-ç½‘ç»œç­–ç•¥">8ã€Calico ç½‘ç»œç­–ç•¥</h2><p>éƒ¨ç½²å®Œæˆ Calico åï¼Œå°±å¯ä»¥å®ç° K8s ä¸­çš„ç½‘ç»œç­–ç•¥ NetworkPolicyï¼Œå¯¹äºç½‘ç»œç­–ç•¥åœ¨å‰é¢çš„æ–‡ç« ä½¿ç”¨ Flannel+ Canal å®ç° K8s çš„ NetworkPolicy æœ‰è¯¦ç»†æè¿°ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ğŸ˜Š</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œå±±å±±ä»™äººåšå®¢ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y2hlh7ks%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/y2hlh7ksï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1ã€Calicoæ¦‚è¿°&quot;&gt;1ã€Calicoæ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;Calico æ˜¯ Kubernetes ç”Ÿæ€ç³»ç»Ÿä¸­å¦ä¸€ç§æµè¡Œçš„ç½‘ç»œé€‰æ‹©ã€‚è™½ç„¶ Flannel è¢«å…¬è®¤ä¸ºæ˜¯æœ€ç®€å•çš„é€‰æ‹©ï¼Œä½† Calico ä»¥å…¶æ€§èƒ½ã€çµæ´»æ€§è€Œé—»åã€‚Calico çš„åŠŸèƒ½æ›´ä¸ºå…¨é¢ï¼Œä¸ä»…æä¾›ä¸»æœºå’Œpodä¹‹é—´çš„ç½‘ç»œè¿æ¥ï¼Œè¿˜æ¶‰åŠç½‘ç»œå®‰å…¨å’Œç®¡ç†ã€‚Calico CNIæ’ä»¶åœ¨ CNI æ¡†æ¶å†…å°è£…äº†Calicoçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Calico æ˜¯ä¸€ä¸ªåŸºäºBGPçš„çº¯ä¸‰å±‚çš„ç½‘ç»œæ–¹æ¡ˆï¼Œä¸ OpenStackã€Kubernetesã€AWSã€GCE ç­‰äº‘å¹³å°éƒ½èƒ½å¤Ÿè‰¯å¥½åœ°é›†æˆã€‚Calico åœ¨æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹éƒ½åˆ©ç”¨ Linux Kernel å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„è™šæ‹Ÿè·¯ç”±å™¨ vRouter æ¥è´Ÿè´£æ•°æ®è½¬å‘ã€‚æ¯ä¸ª vRouter éƒ½é€šè¿‡ BGP1 åè®®æŠŠåœ¨æœ¬èŠ‚ç‚¹ä¸Šè¿è¡Œçš„å®¹å™¨çš„è·¯ç”±ä¿¡æ¯å‘æ•´ä¸ª Calico ç½‘ç»œå¹¿æ’­ï¼Œå¹¶è‡ªåŠ¨è®¾ç½®åˆ°è¾¾å…¶ä»–èŠ‚ç‚¹çš„è·¯ç”±è½¬å‘è§„åˆ™ã€‚Calico ä¿è¯æ‰€æœ‰å®¹å™¨ä¹‹é—´çš„æ•°æ®æµé‡éƒ½æ˜¯é€šè¿‡IPè·¯ç”±çš„æ–¹å¼å®Œæˆäº’è”äº’é€šçš„ã€‚Calico èŠ‚ç‚¹ç»„ç½‘æ—¶å¯ä»¥ç›´æ¥åˆ©ç”¨æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œç»“æ„ï¼ˆ L2 æˆ–è€… L3ï¼‰ï¼Œä¸éœ€è¦é¢å¤–çš„ NATã€éš§é“æˆ–è€… Overlay Networkï¼Œæ²¡æœ‰é¢å¤–çš„å°åŒ…è§£åŒ…ï¼Œèƒ½å¤ŸèŠ‚çº¦ CPU è¿ç®—ï¼Œæé«˜ç½‘ç»œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/k8s-calico-1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Calico åœ¨å°è§„æ¨¡é›†ç¾¤ä¸­å¯ä»¥ç›´æ¥äº’è”ï¼Œåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­å¯ä»¥é€šè¿‡é¢å¤–çš„ BGP route reflector æ¥å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/k8s-calico-2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒCalico åŸºäº Iptables è¿˜æä¾›äº†ä¸°å¯Œçš„ç½‘ç»œç­–ç•¥ï¼Œå®ç°äº† Kubernetes çš„ Network Policy ç­–ç•¥ï¼Œæä¾›å®¹å™¨é—´ç½‘ç»œå¯è¾¾æ€§é™åˆ¶çš„åŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Calico" scheme="https://www.hi-linux.com/categories/Calico/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="Calico" scheme="https://www.hi-linux.com/tags/Calico/"/>
    
  </entry>
  
  <entry>
    <title>å·§ç”¨ Nginx å¿«é€Ÿå®ç° HTTPS åŒå‘è®¤è¯</title>
    <link href="https://www.hi-linux.com/posts/38492.html"/>
    <id>https://www.hi-linux.com/posts/38492.html</id>
    <published>2020-08-03T01:00:00.000Z</published>
    <updated>2020-08-03T02:28:16.331Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>ç ”ç©¶ <code>HTTPS</code> çš„åŒå‘è®¤è¯å®ç°ä¸åŸç†ï¼Œè¸©äº†ä¸å°‘å‘ï¼Œç»ˆäºæ•´ä¸ªæµç¨‹éƒ½è·‘é€šäº†ï¼Œç°åœ¨æ€»ç»“å‡ºä¸€ç¯‡æ–‡æ¡£æ¥ï¼ŒæŠŠä¸€äº›å¿ƒå¾—ï¼Œç‰¹åˆ«æ˜¯å®¹æ˜“è¸©å‘çš„åœ°æ–¹è®°å½•ä¸‹æ¥ã€‚</p><h2 id="1åŸç†">1.åŸç†</h2><p>åŒå‘è®¤è¯ï¼Œé¡¾åæ€ä¹‰ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œåœ¨å»ºç«‹ <code>HTTPS</code> è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œæ¡æ‰‹çš„æµç¨‹æ¯”å•å‘è®¤è¯å¤šäº†å‡ æ­¥ã€‚å•å‘è®¤è¯çš„è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯ä»æœåŠ¡å™¨ç«¯ä¸‹è½½æœåŠ¡å™¨ç«¯å…¬é’¥è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œç„¶åå»ºç«‹å®‰å…¨é€šä¿¡é€šé“ã€‚åŒå‘é€šä¿¡æµç¨‹ï¼Œå®¢æˆ·ç«¯é™¤äº†éœ€è¦ä»æœåŠ¡å™¨ç«¯ä¸‹è½½æœåŠ¡å™¨çš„å…¬é’¥è¯ä¹¦è¿›è¡ŒéªŒè¯å¤–ï¼Œè¿˜éœ€è¦æŠŠå®¢æˆ·ç«¯çš„å…¬é’¥è¯ä¹¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ç»™æœåŠ¡å™¨ç«¯è¿›è¡ŒéªŒè¯ï¼Œç­‰åŒæ–¹éƒ½è®¤è¯é€šè¿‡äº†ï¼Œæ‰å¼€å§‹å»ºç«‹å®‰å…¨é€šä¿¡é€šé“è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><h3 id="11-å•å‘è®¤è¯æµç¨‹">1.1 å•å‘è®¤è¯æµç¨‹</h3><p>å•å‘è®¤è¯æµç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ç«¯ä¿å­˜ç€å…¬é’¥è¯ä¹¦å’Œç§é’¥ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/nginx-ssl-01.png" alt=""></p><ol><li>å®¢æˆ·ç«¯å‘èµ·å»ºç«‹ HTTPS è¿æ¥è¯·æ±‚ï¼Œå°† SSL åè®®ç‰ˆæœ¬çš„ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ç«¯ï¼›</li><li>æœåŠ¡å™¨ç«¯å°†æœ¬æœºçš„å…¬é’¥è¯ä¹¦ï¼ˆserver.crtï¼‰å‘é€ç»™å®¢æˆ·ç«¯ï¼›</li><li>å®¢æˆ·ç«¯è¯»å–å…¬é’¥è¯ä¹¦ (server.crt)ï¼Œå–å‡ºäº†æœåŠ¡ç«¯å…¬é’¥ï¼›</li><li>å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ˆå¯†é’¥ Rï¼‰ï¼Œç”¨åˆšæ‰å¾—åˆ°çš„æœåŠ¡å™¨å…¬é’¥å»åŠ å¯†è¿™ä¸ªéšæœºæ•°å½¢æˆå¯†æ–‡ï¼Œå‘é€ç»™æœåŠ¡ç«¯ï¼›</li><li>æœåŠ¡ç«¯ç”¨è‡ªå·±çš„ç§é’¥ (server.key) å»è§£å¯†è¿™ä¸ªå¯†æ–‡ï¼Œå¾—åˆ°äº†å¯†é’¥ R</li><li>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åœ¨åç»­é€šè®¯è¿‡ç¨‹ä¸­å°±ä½¿ç”¨è¿™ä¸ªå¯†é’¥Rè¿›è¡Œé€šä¿¡äº†ã€‚</li></ol><h3 id="12-åŒå‘è®¤è¯æµç¨‹">1.2 åŒå‘è®¤è¯æµç¨‹</h3><p><img src="https://www.hi-linux.com/img/linux/nginx-ssl-02.png" alt=""></p><ol><li>å®¢æˆ·ç«¯å‘èµ·å»ºç«‹ HTTPS è¿æ¥è¯·æ±‚ï¼Œå°† SSL åè®®ç‰ˆæœ¬çš„ä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯ï¼›</li><li>æœåŠ¡å™¨ç«¯å°†æœ¬æœºçš„å…¬é’¥è¯ä¹¦ (server.crt) å‘é€ç»™å®¢æˆ·ç«¯ï¼›</li><li>å®¢æˆ·ç«¯è¯»å–å…¬é’¥è¯ä¹¦ (server.crt)ï¼Œå–å‡ºäº†æœåŠ¡ç«¯å…¬é’¥ï¼›</li><li>å®¢æˆ·ç«¯å°†å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦ (client.crt) å‘é€ç»™æœåŠ¡å™¨ç«¯ï¼›</li><li>æœåŠ¡å™¨ç«¯è§£å¯†å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦ï¼Œæ‹¿åˆ°å®¢æˆ·ç«¯å…¬é’¥ï¼›</li><li>å®¢æˆ·ç«¯å‘é€è‡ªå·±æ”¯æŒçš„åŠ å¯†æ–¹æ¡ˆç»™æœåŠ¡å™¨ç«¯ï¼›</li><li>æœåŠ¡å™¨ç«¯æ ¹æ®è‡ªå·±å’Œå®¢æˆ·ç«¯çš„èƒ½åŠ›ï¼Œé€‰æ‹©ä¸€ä¸ªåŒæ–¹éƒ½èƒ½æ¥å—çš„åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨å®¢æˆ·ç«¯çš„å…¬é’¥åŠ å¯†åå‘é€ç»™å®¢æˆ·ç«¯ï¼›</li><li>å®¢æˆ·ç«¯ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†åŠ å¯†æ–¹æ¡ˆï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•° Rï¼Œä½¿ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†åä¼ ç»™æœåŠ¡å™¨ç«¯ï¼›</li><li>æœåŠ¡ç«¯ç”¨è‡ªå·±çš„ç§é’¥å»è§£å¯†è¿™ä¸ªå¯†æ–‡ï¼Œå¾—åˆ°äº†å¯†é’¥ R</li><li>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åœ¨åç»­é€šè®¯è¿‡ç¨‹ä¸­å°±ä½¿ç”¨è¿™ä¸ªå¯†é’¥Rè¿›è¡Œé€šä¿¡äº†ã€‚</li></ol><a id="more"></a><h2 id="2-è¯ä¹¦ç”Ÿæˆ">2. è¯ä¹¦ç”Ÿæˆ</h2><p>ä»ä¸Šä¸€ç« å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºæ¥ï¼Œå¦‚æœè¦æŠŠæ•´ä¸ªåŒå‘è®¤è¯çš„æµç¨‹è·‘é€šï¼Œæœ€ç»ˆéœ€è¦äº”ä¸ªè¯ä¹¦æ–‡ä»¶ï¼š</p><ul><li>æœåŠ¡å™¨ç«¯å…¬é’¥è¯ä¹¦ï¼šserver.crt</li><li>æœåŠ¡å™¨ç«¯ç§é’¥æ–‡ä»¶ï¼šserver.key</li><li>å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦ï¼šclient.crt</li><li>å®¢æˆ·ç«¯ç§é’¥æ–‡ä»¶ï¼šclient.key</li><li>å®¢æˆ·ç«¯é›†æˆè¯ä¹¦ï¼ˆåŒ…æ‹¬å…¬é’¥å’Œç§é’¥ï¼Œç”¨äºæµè§ˆå™¨è®¿é—®åœºæ™¯ï¼‰ï¼šclient.p12</li></ul><p>ç”Ÿæˆè¿™ä¸€äº›åˆ—è¯ä¹¦ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç”Ÿæˆä¸€ä¸ª <code>CA</code> æ ¹è¯ä¹¦ï¼Œç„¶åç”±è¿™ä¸ª <code>CA</code> æ ¹è¯ä¹¦é¢å‘æœåŠ¡å™¨å…¬é’¥è¯ä¹¦å’Œå®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/nginx-ssl-03.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥å…¨ç¨‹ä½¿ç”¨ <code>Openssl</code> æ¥ç”Ÿæˆä¸€äº›åˆ—çš„è‡ªç­¾åè¯ä¹¦ï¼Œè‡ªç­¾åè¯ä¹¦æ²¡æœ‰é€šè¿‡è¯ä¹¦æœºæ„çš„è®¤è¯ï¼Œå¾ˆå¤šæµè§ˆå™¨ä¼šè®¤ä¸ºä¸å®‰å…¨ï¼Œä½†æˆ‘ä»¬ç”¨æ¥å®éªŒæ˜¯è¶³å¤Ÿçš„ã€‚éœ€è¦åœ¨æœ¬æœºå®‰è£…äº† <code>Openssl</code> åæ‰èƒ½ç»§ç»­æœ¬ç« çš„å®éªŒã€‚</p><h3 id="21-ç”Ÿæˆè‡ªç­¾åæ ¹è¯ä¹¦">2.1 ç”Ÿæˆè‡ªç­¾åæ ¹è¯ä¹¦</h3><ol><li>åˆ›å»ºæ ¹è¯ä¹¦ç§é’¥ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl genrsa -out root.key 1024</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»ºæ ¹è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ openssl req -new -out root.csr -key root.key</span><br><span class="line"></span><br><span class="line">åç»­å‚æ•°è¯·è‡ªè¡Œå¡«å†™ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</span><br><span class="line"></span><br><span class="line">Country Name (2 letter code) [XX]:cn</span><br><span class="line">State or Province Name (full name) []:bj</span><br><span class="line">Locality Name (eg, city) [Default City]:bj</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:alibaba</span><br><span class="line">Organizational Unit Name (eg, section) []:test</span><br><span class="line">Common Name (eg, your name or your servers hostname) []:www.yourdomain.com</span><br><span class="line">Email Address []:a.alibaba.com</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºæ ¹è¯ä¹¦ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl x509 -req -in root.csr -out root.crt -signkey root.key -CAcreateserial -days 3650</span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸‰ç‚¹ï¼Œä¸‹é¢ç”ŸæˆæœåŠ¡å™¨è¯·æ±‚æ–‡ä»¶å’Œå®¢æˆ·ç«¯è¯·æ±‚æ–‡ä»¶å‡è¦æ³¨æ„è¿™ä¸‰ç‚¹ï¼š</p><ul><li>Common Name å¡«å†™è¯ä¹¦å¯¹åº”çš„æœåŠ¡åŸŸåï¼›</li><li>æ‰€æœ‰å­—æ®µçš„å¡«å†™ï¼Œæ ¹è¯ä¹¦ã€æœåŠ¡å™¨ç«¯è¯ä¹¦ã€å®¢æˆ·ç«¯è¯ä¹¦éœ€ä¿æŒä¸€è‡´</li><li>æœ€åçš„å¯†ç å¯ä»¥ç›´æ¥å›è½¦è·³è¿‡ã€‚</li></ul><p>ç»è¿‡ä¸Šé¢ä¸‰ä¸ªå‘½ä»¤è¡Œï¼Œæˆ‘ä»¬æœ€ç»ˆå¯ä»¥å¾—åˆ°ä¸€ä¸ªç­¾åæœ‰æ•ˆæœŸä¸º 10 å¹´çš„æ ¹è¯ä¹¦ root.crtï¼Œåé¢æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ ¹è¯ä¹¦å»é¢å‘æœåŠ¡å™¨è¯ä¹¦å’Œå®¢æˆ·ç«¯è¯ä¹¦ã€‚</p><h3 id="22-ç”Ÿæˆè‡ªç­¾åæœåŠ¡å™¨ç«¯è¯ä¹¦">2.2 ç”Ÿæˆè‡ªç­¾åæœåŠ¡å™¨ç«¯è¯ä¹¦</h3><ol><li>ç”ŸæˆæœåŠ¡å™¨ç«¯è¯ä¹¦ç§é’¥ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl genrsa -out server.key 1024</span><br></pre></td></tr></table></figure><ol start="2"><li>ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œè¿‡ç¨‹å’Œæ³¨æ„äº‹é¡¹å‚è€ƒæ ¹è¯ä¹¦ï¼Œæœ¬èŠ‚ä¸è¯¦è¿°ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl req -new -out server.csr -key server.key</span><br></pre></td></tr></table></figure><ol start="3"><li>ç”ŸæˆæœåŠ¡å™¨ç«¯å…¬é’¥è¯ä¹¦</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl x509 -req -in server.csr -out server.crt -signkey server.key -CA root.crt -CAkey root.key -CAcreateserial -days 3650</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢çš„ä¸‰ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p><ul><li>server.keyï¼šæœåŠ¡å™¨ç«¯çš„ç§˜é’¥æ–‡ä»¶</li><li>server.crtï¼šæœ‰æ•ˆæœŸåå¹´çš„æœåŠ¡å™¨ç«¯å…¬é’¥è¯ä¹¦ï¼Œä½¿ç”¨æ ¹è¯ä¹¦å’ŒæœåŠ¡å™¨ç«¯ç§é’¥æ–‡ä»¶ä¸€èµ·ç”Ÿæˆ</li></ul><h3 id="23-ç”Ÿæˆè‡ªç­¾åå®¢æˆ·ç«¯è¯ä¹¦">2.3 ç”Ÿæˆè‡ªç­¾åå®¢æˆ·ç«¯è¯ä¹¦</h3><ol><li>ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦ç§˜é’¥ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl genrsa -out client.key 1024</span><br></pre></td></tr></table></figure><ol start="2"><li>ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œè¿‡ç¨‹å’Œæ³¨æ„äº‹é¡¹å‚è€ƒæ ¹è¯ä¹¦ï¼Œæœ¬èŠ‚ä¸è¯¦è¿°ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl req -new -out client.csr -key client.key</span><br></pre></td></tr></table></figure><ol start="3"><li>ç”Ÿå®¢æˆ·ç«¯è¯ä¹¦</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl x509 -req -in client.csr -out client.crt -signkey client.key -CA root.crt -CAkey root.key -CAcreateserial -days 3650</span><br></pre></td></tr></table></figure><ol start="4"><li>ç”Ÿå®¢æˆ·ç«¯ P12 æ ¼å¼è¯ä¹¦</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl pkcs12 -export -clcerts -in client.crt -inkey client.key -out client.p12</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢çš„ä¸‰ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p><ul><li>client.keyï¼šå®¢æˆ·ç«¯çš„ç§é’¥æ–‡ä»¶</li><li>client.crtï¼šæœ‰æ•ˆæœŸåå¹´çš„å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä½¿ç”¨æ ¹è¯ä¹¦å’Œå®¢æˆ·ç«¯ç§é’¥ä¸€èµ·ç”Ÿæˆ</li><li>client.p12ï¼šå®¢æˆ·ç«¯ p12 æ ¼å¼ï¼Œè¿™ä¸ªè¯ä¹¦æ–‡ä»¶åŒ…å«å®¢æˆ·ç«¯çš„å…¬é’¥å’Œç§é’¥ï¼Œä¸»è¦ç”¨æ¥ç»™æµè§ˆå™¨è®¿é—®ä½¿ç”¨</li></ul><h2 id="3nginx-é…ç½®">3.Nginx é…ç½®</h2><p>æœ‰äº†ä¸Šé¢çš„ä¸€äº›åˆ—è¯ä¹¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>Nginx</code> æœåŠ¡å™¨ä¸Šé…ç½®åŒå‘è®¤è¯çš„ <code>HTTPS</code> æœåŠ¡äº†ï¼Œå…·ä½“é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       443 ssl;</span><br><span class="line">        server_name  www.yourdomain.com;</span><br><span class="line">        ssl                  on;  </span><br><span class="line">        ssl_certificate      &#x2F;data&#x2F;sslKey&#x2F;server.crt;  #serverå…¬é’¥è¯ä¹¦</span><br><span class="line">        ssl_certificate_key  &#x2F;data&#x2F;sslKey&#x2F;server.key;  #serverç§é’¥</span><br><span class="line">        ssl_client_certificate &#x2F;data&#x2F;sslKey&#x2F;client.crt;  #å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦</span><br><span class="line">        ssl_verify_client on;  #å¼€å¯å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯  </span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“å°±æ˜¯å°†æœåŠ¡å™¨ç«¯çš„ä¸¤ä¸ªè¯ä¹¦æ–‡ä»¶ (server.crt/server.key) å’Œå®¢æˆ·ç«¯çš„å…¬é’¥è¯ä¹¦æ–‡ä»¶ (client.crt) çš„è·¯å¾„é…ç½®åˆ° <code>Nginx</code> çš„ <code>server</code> èŠ‚ç‚¹é…ç½®ä¸­ï¼Œå¹¶ä¸”æŠŠ <code>ssl_verify_client</code> è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º <code>on</code>ã€‚</p><p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„å°±æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯ä¹¦ä¸æ˜¯ç”±æ ¹è¯ä¹¦ç›´æ¥é¢å‘çš„ï¼Œé…ç½®ä¸­è¿˜éœ€è¦åŠ ä¸€ä¸ªé…ç½®ï¼š<code>ssl_verify_depth 1</code> ;</p><p>é…ç½®å®Œæˆåï¼Œæ‰§è¡Œ <code>nginx -s reload</code> é‡æ–°åŠ è½½ä¸‹å°±ç”Ÿæ•ˆäº†ã€‚</p><h2 id="4curl-è°ƒç”¨">4.curl è°ƒç”¨</h2><p>ä½¿ç”¨ <code>curl</code> åŠ ä¸Šè¯ä¹¦è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥æµ‹è¯• <code>Nginx</code> çš„ <code>HTTPS</code> åŒå‘è®¤è¯æ˜¯å¦é…ç½®æˆåŠŸã€‚</p><ol><li>å¸¦è¯ä¹¦çš„æˆåŠŸè°ƒç”¨</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># --certæŒ‡å®šå®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦çš„è·¯å¾„</span><br><span class="line"># --keyæŒ‡å®šå®¢æˆ·ç«¯ç§é’¥æ–‡ä»¶çš„è·¯å¾„</span><br><span class="line"># -kä¸æ ¡éªŒè¯ä¹¦çš„åˆæ³•æ€§ï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œæ‰€ä»¥éœ€è¦åŠ è¿™ä¸ªå‚æ•°</span><br><span class="line"># å¯ä»¥ä½¿ç”¨ -v æ¥è§‚å¯Ÿå…·ä½“çš„ SSL æ¡æ‰‹è¿‡ç¨‹</span><br><span class="line"></span><br><span class="line">$ curl --cert .&#x2F;client.crt --key .&#x2F;client.key https:&#x2F;&#x2F;integration-fred2.fredhuang.com -k -v</span><br><span class="line">* Rebuilt URL to: https:&#x2F;&#x2F;integration-fred2.fredhuang.com&#x2F;</span><br><span class="line">*   Trying 47.91.39.145...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to integration-fred2.fredhuang.com (47.91.39.145) port 443 (#0)</span><br><span class="line">* ALPN, offering h2</span><br><span class="line">* ALPN, offering http&#x2F;1.1</span><br><span class="line">* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH</span><br><span class="line">* successfully set certificate verify locations:</span><br><span class="line">*   CAfile: &#x2F;etc&#x2F;ssl&#x2F;cert.pem</span><br><span class="line">  CApath: none</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Client hello (1):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server hello (2):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Certificate (11):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server key exchange (12):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Request CERT (13):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server finished (14):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Certificate (11):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, CERT verify (15):</span><br><span class="line">* TLSv1.2 (OUT), TLS change cipher, Client hello (1):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Finished (20):</span><br><span class="line">* TLSv1.2 (IN), TLS change cipher, Client hello (1):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Finished (20):</span><br><span class="line">* SSL connection using TLSv1.2 &#x2F; ECDHE-RSA-AES128-GCM-SHA256</span><br><span class="line">* ALPN, server accepted to use h2</span><br><span class="line">* Server certificate:</span><br><span class="line">*  subject: C&#x3D;CN; ST&#x3D;BeiJing; L&#x3D;BeiJing; O&#x3D;Alibaba; OU&#x3D;Test; CN&#x3D;integration-fred2.fredhuang.com; emailAddress&#x3D;a@alibaba.com</span><br><span class="line">*  start date: Oct 30 06:43:19 2019 GMT</span><br><span class="line">*  expire date: Oct 27 06:43:19 2029 GMT</span><br><span class="line">*  issuer: C&#x3D;CN; ST&#x3D;BeiJing; L&#x3D;BeiJing; O&#x3D;Alibaba; OU&#x3D;Test; CN&#x3D;integration-fred2.fredhuang.com; emailAddress&#x3D;a@alibaba.com</span><br><span class="line">*  SSL certificate verify result: self signed certificate (18), continuing anyway.</span><br><span class="line">* Using HTTP2, server supports multi-use</span><br><span class="line">* Connection state changed (HTTP&#x2F;2 confirmed)</span><br><span class="line">* Copying HTTP&#x2F;2 data in stream buffer to connection buffer after upgrade: len&#x3D;0</span><br><span class="line">* Using Stream ID: 1 (easy handle 0x7f8ae1809a00)</span><br><span class="line">&gt; GET &#x2F; HTTP&#x2F;2</span><br><span class="line">&gt; Host: integration-fred2.fredhuang.com</span><br><span class="line">&gt; User-Agent: curl&#x2F;7.54.0</span><br><span class="line">&gt; Accept: *&#x2F;*</span><br><span class="line">&gt;</span><br><span class="line">* Connection state changed (MAX_CONCURRENT_STREAMS updated)!</span><br><span class="line">&lt; HTTP&#x2F;2 200</span><br><span class="line">&lt; server: Tengine</span><br><span class="line">&lt; date: Fri, 01 Nov 2019 11:16:39 GMT</span><br><span class="line">&lt; content-type: text&#x2F;plain;charset&#x3D;UTF-8</span><br><span class="line">&lt; content-length: 0</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¸å¸¦è¯ä¹¦çš„å¤±è´¥è°ƒç”¨</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">$ curl  https:&#x2F;&#x2F;integration-fred2.fredhuang.com -k -v</span><br><span class="line">* Rebuilt URL to: https:&#x2F;&#x2F;integration-fred2.fredhuang.com&#x2F;</span><br><span class="line">*   Trying 47.91.39.145...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to integration-fred2.fredhuang.com (47.91.39.145) port 443 (#0)</span><br><span class="line">* ALPN, offering h2</span><br><span class="line">* ALPN, offering http&#x2F;1.1</span><br><span class="line">* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH</span><br><span class="line">* successfully set certificate verify locations:</span><br><span class="line">*   CAfile: &#x2F;etc&#x2F;ssl&#x2F;cert.pem</span><br><span class="line">  CApath: none</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Client hello (1):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server hello (2):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Certificate (11):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server key exchange (12):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Request CERT (13):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server finished (14):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Certificate (11):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):</span><br><span class="line">* TLSv1.2 (OUT), TLS change cipher, Client hello (1):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Finished (20):</span><br><span class="line">* TLSv1.2 (IN), TLS change cipher, Client hello (1):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Finished (20):</span><br><span class="line">* SSL connection using TLSv1.2 &#x2F; ECDHE-RSA-AES128-GCM-SHA256</span><br><span class="line">* ALPN, server accepted to use h2</span><br><span class="line">* Server certificate:</span><br><span class="line">*  subject: C&#x3D;CN; ST&#x3D;BeiJing; L&#x3D;BeiJing; O&#x3D;Alibaba; OU&#x3D;Test; CN&#x3D;integration-fred2.fredhuang.com; emailAddress&#x3D;a@alibaba.com</span><br><span class="line">*  start date: Oct 30 06:43:19 2019 GMT</span><br><span class="line">*  expire date: Oct 27 06:43:19 2029 GMT</span><br><span class="line">*  issuer: C&#x3D;CN; ST&#x3D;BeiJing; L&#x3D;BeiJing; O&#x3D;Alibaba; OU&#x3D;Test; CN&#x3D;integration-fred2.fredhuang.com; emailAddress&#x3D;a@alibaba.com</span><br><span class="line">*  SSL certificate verify result: self signed certificate (18), continuing anyway.</span><br><span class="line">* Using HTTP2, server supports multi-use</span><br><span class="line">* Connection state changed (HTTP&#x2F;2 confirmed)</span><br><span class="line">* Copying HTTP&#x2F;2 data in stream buffer to connection buffer after upgrade: len&#x3D;0</span><br><span class="line">* Using Stream ID: 1 (easy handle 0x7fcc52805e00)</span><br><span class="line">&gt; GET &#x2F; HTTP&#x2F;2</span><br><span class="line">&gt; Host: integration-fred2.fredhuang.com</span><br><span class="line">&gt; User-Agent: curl&#x2F;7.54.0</span><br><span class="line">&gt; Accept: *&#x2F;*</span><br><span class="line">&gt;</span><br><span class="line">* Connection state changed (MAX_CONCURRENT_STREAMS updated)!</span><br><span class="line">&lt; HTTP&#x2F;2 400</span><br><span class="line">&lt; server: Tengine</span><br><span class="line">&lt; date: Fri, 01 Nov 2019 11:25:28 GMT</span><br><span class="line">&lt; content-type: text&#x2F;html</span><br><span class="line">&lt; content-length: 685</span><br><span class="line">&lt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;IETF&#x2F;&#x2F;DTD HTML 2.0&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;400 No required SSL certificate was sent&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;center&gt;No required SSL certificate was sent&lt;&#x2F;center&gt;</span><br><span class="line"> Sorry for the inconvenience.&lt;br&#x2F;&gt;</span><br><span class="line">Please report this message and include the following information to us.&lt;br&#x2F;&gt;</span><br><span class="line">Thank you very much!&lt;&#x2F;p&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;URL:&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;https:&#x2F;&#x2F;integration-fred2.fredhuang.com:444&#x2F;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;&#x2F;tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;Server:&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;cag-access-tengine011192099198.au49&lt;&#x2F;td&gt;</span><br><span class="line">&lt;&#x2F;tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;Date:&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;2019&#x2F;11&#x2F;01 19:25:28&lt;&#x2F;td&gt;</span><br><span class="line">&lt;&#x2F;tr&gt;</span><br><span class="line">&lt;&#x2F;table&gt;</span><br><span class="line">&lt;hr&#x2F;&gt;Powered by Tengine&lt;hr&gt;&lt;center&gt;tengine&lt;&#x2F;center&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><h2 id="5java-è°ƒç”¨">5.Java è°ƒç”¨</h2><p>ç”±äºä½¿ç”¨çš„æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œä½¿ç”¨ <code>ApacheHttpClient</code> å»è°ƒç”¨çš„è¯ï¼Œéœ€è¦å°†æœåŠ¡å™¨è¯ä¹¦åŠ å…¥å¯ä¿¡ä»»è¯ä¹¦åº“ä¸­ï¼Œæ‰èƒ½æˆåŠŸè°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­ç®€å•å¿½ç•¥è¯ä¹¦ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd $JAVA_HOME</span><br><span class="line">$ sudo .&#x2F;bin&#x2F;keytool -import -alias ttt -keystore cacerts -file &#x2F;Users&#x2F;fred&#x2F;temp&#x2F;cert5&#x2F;server.crt</span><br></pre></td></tr></table></figure><p>å°†æœåŠ¡å™¨ç«¯å…¬é’¥è¯ä¹¦è®¾ç½®ä¸ºå¯ä¿¡è¯ä¹¦åï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç å¯ä»¥ç›´æ¥å‘èµ·å¸¦å®¢æˆ·ç«¯è¯ä¹¦çš„ <code>HTTPS</code> è¯·æ±‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.http.HttpEntity;</span><br><span class="line">import org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line">import org.apache.http.client.methods.HttpGet;</span><br><span class="line">import org.apache.http.conn.ssl.SSLConnectionSocketFactory;</span><br><span class="line">import org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line">import org.apache.http.impl.client.HttpClients;</span><br><span class="line">import org.apache.http.ssl.SSLContexts;</span><br><span class="line">import org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line">import javax.net.ssl.SSLContext;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.security.KeyStore;</span><br><span class="line"></span><br><span class="line">public class HttpClientWithClientCert &#123;</span><br><span class="line"></span><br><span class="line">    private final static String PFX_PATH &#x3D; &quot;&#x2F;Users&#x2F;fred&#x2F;temp&#x2F;cert5&#x2F;client.p12&quot;;    &#x2F;&#x2F;å®¢æˆ·ç«¯è¯ä¹¦è·¯å¾„</span><br><span class="line">    private final static String PFX_PWD &#x3D; &quot;123456&quot;;    &#x2F;&#x2F;å®¢æˆ·ç«¯è¯ä¹¦å¯†ç </span><br><span class="line"></span><br><span class="line">    public static String sslRequestGet(String url) throws Exception &#123;</span><br><span class="line">        KeyStore keyStore &#x3D; KeyStore.getInstance(&quot;PKCS12&quot;);</span><br><span class="line">        InputStream instream &#x3D; new FileInputStream(new File(PFX_PATH));</span><br><span class="line">        try &#123;</span><br><span class="line">            keyStore.load(instream, PFX_PWD.toCharArray());</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            instream.close();</span><br><span class="line">        &#125;</span><br><span class="line">        SSLContext sslcontext &#x3D; SSLContexts.custom().loadKeyMaterial(keyStore, PFX_PWD.toCharArray()).build();</span><br><span class="line">        SSLConnectionSocketFactory sslsf &#x3D; new SSLConnectionSocketFactory(sslcontext</span><br><span class="line">                , new String[] &#123; &quot;TLSv1&quot; &#125;    &#x2F;&#x2F; supportedProtocols ,è¿™é‡Œå¯ä»¥æŒ‰éœ€è¦è®¾ç½®</span><br><span class="line">                , null    &#x2F;&#x2F; supportedCipherSuites</span><br><span class="line">                , SSLConnectionSocketFactory.getDefaultHostnameVerifier());</span><br><span class="line"></span><br><span class="line">        CloseableHttpClient httpclient &#x3D; HttpClients.custom().setSSLSocketFactory(sslsf).build();</span><br><span class="line">        try &#123;</span><br><span class="line">            HttpGet httpget &#x3D; new HttpGet(url);</span><br><span class="line">            &#x2F;&#x2F;httpget.addHeader(&quot;host&quot;, &quot;integration-fred2.fredhuang.com&quot;);&#x2F;&#x2F; è®¾ç½®ä¸€äº›heanderç­‰</span><br><span class="line">            CloseableHttpResponse response &#x3D; httpclient.execute(httpget);</span><br><span class="line">            try &#123;</span><br><span class="line">                HttpEntity entity &#x3D; response.getEntity();</span><br><span class="line">                String jsonStr &#x3D; EntityUtils.toString(response.getEntity(), &quot;UTF-8&quot;);&#x2F;&#x2F;è¿”å›ç»“æœ</span><br><span class="line">                EntityUtils.consume(entity);</span><br><span class="line">                return jsonStr;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            httpclient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        System.out.println(System.getProperty(&quot;java.home&quot;));</span><br><span class="line">        System.out.println(sslRequestGet(&quot;https:&#x2F;&#x2F;integration-fred2.fredhuang.com&#x2F;test&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-å­˜ç–‘">6. å­˜ç–‘</h2><p>ç½‘ä¸Šå¾ˆå¤šæ–‡ç« éƒ½æè¿°åˆ° <code>Nginx</code> é…ç½®ä¸­çš„å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆ<code>ssl_client_certificate</code>ï¼‰å¯ä»¥é…ç½®æ ¹è¯ä¹¦ root.crtï¼Œç„¶åå°±å¯ä»¥é€‚é…æ‰€æœ‰è¿™ä¸ªæ ¹è¯ä¹¦åŠæ³•çš„å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦äº†ã€‚æˆ‘è¯•äº†ï¼Œä½¿ç”¨ root.crt ä½œä¸º <code>ssl_client_certificate</code> çš„å€¼ï¼Œç„¶åä½¿ç”¨ client.crt æ¥è®¿é—®ï¼Œå‘ç°ä¸è¡Œï¼Œ<code>Nginx</code> ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;400 The SSL certificate error&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;center&gt;The SSL certificate error&lt;&#x2F;center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.17.5&lt;&#x2F;center&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç‰¹æ€§åŸä½œè€…ä¸€ç›´æ²¡æœ‰é…ç½®æˆåŠŸ (æˆ‘ä¹Ÿæ²¡é…ç½®æˆåŠŸ)ï¼Œæœ‰å¯èƒ½æ˜¯é…ç½®æœ‰é—®é¢˜ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç½‘ä¸Šæ–‡ç« ä¸é è°±ï¼Œå†™é”™äº†ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œé˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒºã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/yaamh7vf%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/yaamh7vfï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote><h2 id="æ‰©å±•é˜…è¯»-æœ¬æ–‡æ ¸å¿ƒ">æ‰©å±•é˜…è¯» (æœ¬æ–‡æ ¸å¿ƒ)</h2><p>åœ¨åŸæ–‡åŸºç¡€ä¸Šï¼Œæˆ‘åœ¨åˆ†äº«ä¸€ä¸ªä½ åœ¨å¤§å¤šæ•°ç½‘ç«™å’Œæœç´¢å¼•æ“ä¸­éƒ½æ‰¾ä¸åˆ°çš„å¾ˆå®ç”¨çš„å°æŠ€å·§ï¼Œè¯´å¾—è¿™ä¹ˆç¥ç§˜åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é‚£å°±æ˜¯ä½¿ç”¨å—ä¿¡è¯ä¹¦è¿›è¡ŒåŒå‘è®¤è¯ï¼Œç½‘ä¸Šå¤§å¤šæ•°æ–‡ç« ä»‹ç»çš„å®ç° <code>HTTPS</code> åŒå‘è®¤è¯çš„æ–‡ç« éƒ½æ˜¯ä½¿ç”¨ <code>CA</code> è‡ªç­¾çš„æ–¹å¼è¿›è¡Œã€‚è™½ç„¶è¿™èƒ½å®ç°ç›®çš„ï¼Œä½†æ–¹æ³•ä¸å¤ªä¼˜é›…ã€‚</p><p>åœ¨ <code>SSL</code> è¯ä¹¦å…¨é¢æ™®åŠçš„å½“ä¸‹ï¼Œä½ å…¶å®å¾ˆæœ‰å¿…è¦ç”³è¯·ä¸€ä¸ªå—ä¿¡è¯ä¹¦æ¥è¿›è¡Œ <code>HTTPS</code> åŒå‘è®¤è¯ã€‚è¿™æ ·çœ‹ä¸Šå»ä¸ä½†æ›´æƒå¨ï¼Œè€Œä¸”å®ç°ä¸Šä¹Ÿæ›´ä¾¿æ·ä¸€äº›ã€‚</p><h3 id="ä½¿ç”¨å—ä¿¡è¯ä¹¦è¿›è¡ŒåŒå‘è®¤è¯">ä½¿ç”¨å—ä¿¡è¯ä¹¦è¿›è¡ŒåŒå‘è®¤è¯</h3><p>è¦ä½¿ç”¨å—ä¿¡è¯ä¹¦è¿›è¡Œè®¤è¯çš„å‰ææ¡ä»¶ï¼šå½“ç„¶æ˜¯ä½ å¿…é¡»æœ‰ä¸€ä¸ªæƒå¨ CA æœºæ„ç»™ä½ ç­¾å‘çš„è¯ä¹¦ã€‚</p><ul><li>å¦‚æœä½ æ˜¯åœŸè±ªï¼Œéšä¾¿è´­ä¹°ä¸€ä¸ªå°±è¡Œäº†ã€‚</li><li>å¦‚æœä½ å›Šä¸­ç¾æ¶©ï¼Œä¹Ÿä¸è¦ç´§ï¼Œå¯ä»¥å»ç”³è¯·ä¸€ä¸ªå…è´¹çš„ <code>SSL</code> è¯ä¹¦ã€‚ç›®å‰ <code>Let's Encrypt</code>ã€<code>é˜¿é‡Œäº‘</code> éƒ½å¯ä»¥ç”³è¯·ï¼Œå…·ä½“æ–¹æ³•å°±ä¸åœ¨è¿™å±•å¼€äº†ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨å…¬ä¼—å·ä¸Šæœç´¢ç›¸å…³æ–‡ç« ã€‚</li><li>ä¸ºäº†ä¾¿äºç®¡ç†å’Œå¤šåœºæ™¯ä½¿ç”¨ï¼Œå»ºè®®ç›´æ¥ç”³è¯·é€šé…è¯ä¹¦ã€‚</li></ul><p>è¯ä¹¦å‡†å¤‡å®Œæˆåï¼Œæ¥ä¸‹æ¥å½“ç„¶æ˜¯ç›´æ¥ä½¿ç”¨å®ƒã€‚å› ä¸ºæ˜¯å—ä¿¡è¯ä¹¦ï¼Œä¸Šé¢æ‰€æœ‰çš„è¯ä¹¦è‡ªç­¾æ“ä½œéƒ½ä¸éœ€è¦äº†ï¼Œä½ åªéœ€ç›´æ¥é…ç½® <code>Nginx</code> å°±å¯ä»¥äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">                listen       443 ssl;</span><br><span class="line">                access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;accesse.log  main;</span><br><span class="line">                server_name  ci.hi-linux.com;</span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">                ssl_certificate      &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;hi-linux.com&#x2F;hi-linux.com.pem;</span><br><span class="line">                ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;hi-linux.com&#x2F;hi-linux.com.key;</span><br><span class="line">                ssl_client_certificate &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;hi-linux.com&#x2F;hi-linux.com.pem;</span><br><span class="line"></span><br><span class="line">                ssl_verify_depth 3;</span><br><span class="line">                ssl_session_timeout  5m;</span><br><span class="line">                ssl_verify_client on;</span><br><span class="line"></span><br><span class="line">                ssl_protocols  SSLv2 SSLv3 TLSv1;</span><br><span class="line">                ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;</span><br><span class="line">                ssl_prefer_server_ciphers   on;</span><br><span class="line"></span><br><span class="line">                location &#x2F; &#123;</span><br><span class="line">                        proxy_pass   http:&#x2F;&#x2F;ci&#x2F;;</span><br><span class="line">                        proxy_set_header Host $host:$server_port;</span><br><span class="line">                        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">                        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<code>ssl_certificate</code> æŒ‡å®šçš„æ˜¯è¯ä¹¦ï¼Œ<code>ssl_certificate_key</code> æŒ‡å®šæ˜¯è¯ä¹¦å¯¹åº”çš„ç§é’¥ï¼Œè¯·è‡ªè¡Œå°†å¯¹åº”è¯ä¹¦æ–‡ä»¶æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ç›®å½•ä¸­ã€‚</p></blockquote><p>ä»¥ä¸Šé…ç½®æ®µå’Œä¸Šé¢çš„è‡ªç­¾è¯ä¹¦å¤§åŒå°å¼‚ï¼Œä¸»è¦éœ€æ³¨æ„çš„æœ‰ <code>ssl_client_certificate</code> å’Œ <code>ssl_verify_depth</code> è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p><ul><li><code>ssl_client_certificate</code> ä¸»è¦ç”¨äºæŒ‡å®šå®¢æˆ·ç«¯æ‰€ä½¿ç”¨çš„è¯ä¹¦ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨å—ä¿¡è¯ä¹¦æœºæ„ç­¾å‘çš„è¯ä¹¦æ–‡ä»¶ã€‚</li><li><code>ssl_verify_depth</code>  è¿™ä¸ªå‚æ•°æ˜¯ä½¿ç”¨å—ä¿¡è¯ä¹¦èƒ½æˆåŠŸè¿›è¡Œå®¢æˆ·ç«¯éªŒè¯çš„å…³é”®ï¼Œæ³¨æ„å®ƒçš„å€¼æ˜¯ <code>3</code>ã€‚</li></ul><p>å› ä¸ºå½“ <code>ssl_verify_depth</code> è®¾ç½®ä¸º <code>1</code>ï¼ˆ <code>Nginx</code> çš„é»˜è®¤å€¼ï¼‰çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯åªä¼šæ¥å—ç›´æ¥è¢« <code>CA</code> ç­¾å‘çš„å®¢æˆ·ç«¯è¯ä¹¦æˆ–è‡ªç­¾åçš„è¯ä¹¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç›´æ¥å°è¯•ä½¿ç”¨ä¸­çº§ <code>CA</code> æ¥éªŒè¯å®¢æˆ·ç«¯æ˜¯æ— æ³•é€šè¿‡çš„ï¼Œ<code>OpenSSL</code> ä¼šè‡ªåŠ¨çš„å»æ‰¾ä¸­çº§ <code>CA</code> çš„ç­¾å‘è€…å¹¶ä¸€å±‚å±‚éªŒè¯ä¸Šå»ï¼Œç›´åˆ°æ‰¾åˆ°æ ¹è¯ä¹¦ã€‚</p><p>æ‰€ä»¥ï¼Œå°±ç®—å°†ä¸­çº§ <code>CA</code> å’Œæ ¹ <code>CA</code> éƒ½æ”¾åœ¨ä¿¡ä»»è¯ä¹¦åˆ—è¡¨ä¸­ï¼Œç”±äºæœ€ç»ˆ <code>ssl_verify_depth</code> ä¸º <code>2</code> çš„ç¼˜æ•…ï¼ŒéªŒè¯è¿˜æ˜¯é€šä¸è¿‡çš„ã€‚</p><p>å› æ­¤ï¼Œåœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>CA æ–‡ä»¶ä¸­å¿…é¡»åŒæ—¶å­˜åœ¨ ä¸­çº§ <code>CA</code> å’Œæ ¹ <code>CA</code>ï¼Œå¿…é¡»æ„æˆå®Œæ•´è¯ä¹¦é“¾ï¼Œä¸èƒ½å°‘ä»»ä½•ä¸€ä¸ªï¼›</li><li>é»˜è®¤çš„éªŒè¯æ·±åº¦ <code>ssl_verify_depth</code> æ˜¯ 1ï¼Œä¸­çº§ <code>CA</code> ç­¾å‘çš„å®¢æˆ·ç«¯è¯ä¹¦ä¸€å¾‹æ— æ³•é€šè¿‡è®¤è¯ï¼Œéœ€è¦å¢å¤§è¯¥å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šé¢é…ç½®ä¸­ <code>ssl_verify_depth</code> å€¼ä¸º <code>3</code> ã€‚</li></ul><p>ä¸ºäº†å®¢æˆ·ç«¯æ–¹ä¾¿å¯¼å…¥ï¼Œä½ åŒæ ·è¿˜æ˜¯éœ€è¦å°†è¯ä¹¦æ–‡ä»¶è½¬æ¢æˆ P12 æ ¼å¼ã€‚å½“ç„¶ä½ è¿˜å¯ä»¥åœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ç»™è¯ä¹¦åŠ ä¸ªå¯†ç ï¼Œä»¥ä¿è¯è¯ä¹¦çš„å®‰å…¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl pkcs12 -export -clcerts -in hi-linux.com.pem -inkey hi-linux.com.key -out hi-linux.com-client.p12</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œ<code>HTTPS</code> åŒå‘è¯ä¹¦çš„å®ç°å°±è®²å®Œäº†ï¼Œå¦‚æœä½ è¿˜æœ‰ä»€ä¹ˆæ›´å¥½çš„è¡¥å……ï¼Œæ¬¢è¿å¤§å®¶ç§¯æç•™è¨€äº¤æµå“Ÿï¼</p></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç ”ç©¶ &lt;code&gt;HTTPS&lt;/code&gt; çš„åŒå‘è®¤è¯å®ç°ä¸åŸç†ï¼Œè¸©äº†ä¸å°‘å‘ï¼Œç»ˆäºæ•´ä¸ªæµç¨‹éƒ½è·‘é€šäº†ï¼Œç°åœ¨æ€»ç»“å‡ºä¸€ç¯‡æ–‡æ¡£æ¥ï¼ŒæŠŠä¸€äº›å¿ƒå¾—ï¼Œç‰¹åˆ«æ˜¯å®¹æ˜“è¸©å‘çš„åœ°æ–¹è®°å½•ä¸‹æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1-åŸç†&quot;&gt;1.åŸç†&lt;/h2&gt;
&lt;p&gt;åŒå‘è®¤è¯ï¼Œé¡¾åæ€ä¹‰ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œåœ¨å»ºç«‹ &lt;code&gt;HTTPS&lt;/code&gt; è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œæ¡æ‰‹çš„æµç¨‹æ¯”å•å‘è®¤è¯å¤šäº†å‡ æ­¥ã€‚å•å‘è®¤è¯çš„è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯ä»æœåŠ¡å™¨ç«¯ä¸‹è½½æœåŠ¡å™¨ç«¯å…¬é’¥è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œç„¶åå»ºç«‹å®‰å…¨é€šä¿¡é€šé“ã€‚åŒå‘é€šä¿¡æµç¨‹ï¼Œå®¢æˆ·ç«¯é™¤äº†éœ€è¦ä»æœåŠ¡å™¨ç«¯ä¸‹è½½æœåŠ¡å™¨çš„å…¬é’¥è¯ä¹¦è¿›è¡ŒéªŒè¯å¤–ï¼Œè¿˜éœ€è¦æŠŠå®¢æˆ·ç«¯çš„å…¬é’¥è¯ä¹¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ç»™æœåŠ¡å™¨ç«¯è¿›è¡ŒéªŒè¯ï¼Œç­‰åŒæ–¹éƒ½è®¤è¯é€šè¿‡äº†ï¼Œæ‰å¼€å§‹å»ºç«‹å®‰å…¨é€šä¿¡é€šé“è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-1-å•å‘è®¤è¯æµç¨‹&quot;&gt;1.1 å•å‘è®¤è¯æµç¨‹&lt;/h3&gt;
&lt;p&gt;å•å‘è®¤è¯æµç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ç«¯ä¿å­˜ç€å…¬é’¥è¯ä¹¦å’Œç§é’¥ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/nginx-ssl-01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘èµ·å»ºç«‹ HTTPS è¿æ¥è¯·æ±‚ï¼Œå°† SSL åè®®ç‰ˆæœ¬çš„ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯å°†æœ¬æœºçš„å…¬é’¥è¯ä¹¦ï¼ˆserver.crtï¼‰å‘é€ç»™å®¢æˆ·ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è¯»å–å…¬é’¥è¯ä¹¦ (server.crt)ï¼Œå–å‡ºäº†æœåŠ¡ç«¯å…¬é’¥ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ˆå¯†é’¥ Rï¼‰ï¼Œç”¨åˆšæ‰å¾—åˆ°çš„æœåŠ¡å™¨å…¬é’¥å»åŠ å¯†è¿™ä¸ªéšæœºæ•°å½¢æˆå¯†æ–‡ï¼Œå‘é€ç»™æœåŠ¡ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯ç”¨è‡ªå·±çš„ç§é’¥ (server.key) å»è§£å¯†è¿™ä¸ªå¯†æ–‡ï¼Œå¾—åˆ°äº†å¯†é’¥ R&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åœ¨åç»­é€šè®¯è¿‡ç¨‹ä¸­å°±ä½¿ç”¨è¿™ä¸ªå¯†é’¥Rè¿›è¡Œé€šä¿¡äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;1-2-åŒå‘è®¤è¯æµç¨‹&quot;&gt;1.2 åŒå‘è®¤è¯æµç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/nginx-ssl-02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘èµ·å»ºç«‹ HTTPS è¿æ¥è¯·æ±‚ï¼Œå°† SSL åè®®ç‰ˆæœ¬çš„ä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯å°†æœ¬æœºçš„å…¬é’¥è¯ä¹¦ (server.crt) å‘é€ç»™å®¢æˆ·ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è¯»å–å…¬é’¥è¯ä¹¦ (server.crt)ï¼Œå–å‡ºäº†æœåŠ¡ç«¯å…¬é’¥ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å°†å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦ (client.crt) å‘é€ç»™æœåŠ¡å™¨ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯è§£å¯†å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦ï¼Œæ‹¿åˆ°å®¢æˆ·ç«¯å…¬é’¥ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘é€è‡ªå·±æ”¯æŒçš„åŠ å¯†æ–¹æ¡ˆç»™æœåŠ¡å™¨ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯æ ¹æ®è‡ªå·±å’Œå®¢æˆ·ç«¯çš„èƒ½åŠ›ï¼Œé€‰æ‹©ä¸€ä¸ªåŒæ–¹éƒ½èƒ½æ¥å—çš„åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨å®¢æˆ·ç«¯çš„å…¬é’¥åŠ å¯†åå‘é€ç»™å®¢æˆ·ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†åŠ å¯†æ–¹æ¡ˆï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•° Rï¼Œä½¿ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†åä¼ ç»™æœåŠ¡å™¨ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯ç”¨è‡ªå·±çš„ç§é’¥å»è§£å¯†è¿™ä¸ªå¯†æ–‡ï¼Œå¾—åˆ°äº†å¯†é’¥ R&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åœ¨åç»­é€šè®¯è¿‡ç¨‹ä¸­å°±ä½¿ç”¨è¿™ä¸ªå¯†é’¥Rè¿›è¡Œé€šä¿¡äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="Nginx" scheme="https://www.hi-linux.com/categories/nginx/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Nginx" scheme="https://www.hi-linux.com/tags/Nginx/"/>
    
      <category term="HTTPS" scheme="https://www.hi-linux.com/tags/HTTPS/"/>
    
  </entry>
  
  <entry>
    <title>ä¸¤ä¸ªåŠ©ä½ é«˜æ•ˆç¼–å†™ Kubernetes YAML æ–‡ä»¶çš„ç¥æŠ€</title>
    <link href="https://www.hi-linux.com/posts/52035.html"/>
    <id>https://www.hi-linux.com/posts/52035.html</id>
    <published>2020-07-30T01:00:00.000Z</published>
    <updated>2020-07-30T04:49:05.917Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>æˆ‘ä»¬åœ¨ç¼–å†™ <code>Kubernetes</code> èµ„æºæ¸…å•çš„æ—¶å€™å¯èƒ½ä¼šç»å¸¸ä¼šå¿˜è®°è¦åˆ›å»ºçš„èµ„æºåç§°ï¼Œå³ä½¿çŸ¥é“äº†å¯èƒ½ä¹Ÿä¸è®°å¾—è¯¥èµ„æºå¯¹è±¡æœ‰å“ªäº›å±æ€§å¯ä»¥ä½¿ç”¨äº†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›åç§°å¾ˆé•¿çš„èµ„æºæˆ–è€…å±æ€§ï¼Œå³ä½¿æ­»è®°ç¡¬èƒŒä¸‹æ¥éš”ä¸€æ®µæ—¶é—´åˆä¼šå¿˜è®°äº†ã€‚</p><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª <code>validating</code> çš„ <code>admission webhook</code>ï¼Œæˆ‘ä»¬å°±éœ€è¦å®šä¹‰ä¸€ä¸ª <code>ValidatingWebhookConfiguration</code> çš„èµ„æºå¯¹è±¡ï¼Œä½†æ˜¯å¯èƒ½æˆ‘ä»¬ä¸è®°å¾—å®ƒçš„å…¨åäº†ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>kubectl api-resources</code> å‘½ä»¤æ¥æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ <code>API</code> èµ„æºã€‚æ‰¾åˆ°äº†æ­£ç¡®çš„èµ„æºåç§°ä¹‹åï¼Œå°±éœ€è¦äº†è§£å¦‚ä½•ç¼–å†™æ­£ç¡®çš„ <code>YAML</code> èµ„æºæ¸…å•æ–‡ä»¶äº†ï¼Œä½†æ˜¯ <code>Kubernetes</code> ä¸­èµ„æºå¯¹è±¡å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œè€Œä¸”æ¯ä¸€ä¸ªèµ„æºå¯¹è±¡ä¸­é…ç½®å±æ€§ä¹Ÿæ˜¯éå¸¸å¤šçš„ï¼Œæˆ‘ä»¬ä¸å¯èƒ½éƒ½èƒ½å®Œå…¨è®°ä½ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ© <code>kubectl explain</code> å‘½ä»¤æ¥æ‰¾åˆ°å®Œæ•´çš„ç»“æ„ï¼Œè¿™å¯¹äºæˆ‘ä»¬ç¼–å†™ <code>YAML</code> èµ„æºæ¸…å•æ–‡ä»¶éå¸¸æœ‰å¸®åŠ©ã€‚</p><h2 id="kubectl-api-resources-å‘½ä»¤">kubectl api-resources å‘½ä»¤</h2><p><code>kubectl api-resources</code> å‘½ä»¤å¯ä»¥æ‰“å°æ‰€æœ‰å·²ç»æ³¨å†Œçš„ <code>API</code> èµ„æºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ Kubectl api-resources</span><br><span class="line">NAME                              SHORTNAMES                                   APIGROUP                       NAMESPACED   KIND</span><br><span class="line">bindings                                                                                                      true         Binding</span><br><span class="line">componentstatuses                 cs                                                                          false        ComponentStatus</span><br><span class="line">configmaps                        cm                                                                          true         ConfigMap</span><br><span class="line">endpoints                         ep                                                                          true         Endpoints</span><br><span class="line">events                            ev                                                                          true         Event</span><br><span class="line">limitranges                       limits                                                                      true         LimitRange</span><br><span class="line">namespaces                        ns                                                                          false        Namespace</span><br><span class="line">nodes                             no                                                                          false        Node</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä¹Ÿä¼šåŒ…å«ä¸Šé¢æåˆ°çš„ <code>ValidatingWebhookConfiguration</code> èµ„æºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mutatingwebhookconfigurations                                                  admissionregistration.k8s.io   false        MutatingWebhookConfiguration</span><br><span class="line">validatingwebhookconfigurations                                                admissionregistration.k8s.io   false        ValidatingWebhookConfiguration</span><br><span class="line">customresourcedefinitions         crd,crds                                     apiextensions.k8s.io           false        CustomResourceDefinition</span><br><span class="line">apiservices                                                                    apiregistration.k8s.io         false        APIService</span><br></pre></td></tr></table></figure><p>ç”±äº <code>Kubernetes</code> ä¸­å·²ç»æ³¨å†Œçš„èµ„æºå¯¹è±¡éå¸¸å¤šï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬è¦æŸ¥æ‰¾çš„èµ„æºåç§°åŒ…å«ä¸€äº›å…³é”®è¯çš„è¯ï¼Œå¯ä»¥ç”¨ <code>grep</code> æ¥è¿‡æ»¤:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl api-resources |grep validating</span><br><span class="line">validatingwebhookconfigurations                                                admissionregistration.k8s.io   false        ValidatingWebhookConfiguration</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥æ›´ç²¾ç¡®çš„æœç´¢åˆ°éœ€è¦ä½¿ç”¨çš„èµ„æºåç§°äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œå°±æ˜¯ <code>ValidatingWebhookConfiguration</code> ï¼Œç°åœ¨çŸ¥é“äº†èµ„æºå¯¹è±¡çš„åç§°ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ <code>kubectl explain</code> å‘½ä»¤æ¥æŸ¥æ‰¾èµ„æºå¯¹è±¡çš„å±æ€§ã€‚</p><a id="more"></a><h2 id="kubectl-explain-å‘½ä»¤">kubectl explain å‘½ä»¤</h2><p><code>kubectl explain</code> å‘½ä»¤å¯ä»¥å°†èµ„æºå¯¹è±¡çš„è¯¦ç»†å±æ€§éƒ½å±•ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨ä¸çŸ¥é“å¦‚ä½•å»ç¼–å†™ <code>ValidatingWebhookConfiguration</code> ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤ <code>kubectl explain ValidatingWebhookConfiguration</code> æ¥è·å–è¯¦ç»†çš„ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl explain ValidatingWebhookConfiguration</span><br><span class="line">KIND:     ValidatingWebhookConfiguration</span><br><span class="line">VERSION:  admissionregistration.k8s.io&#x2F;v1</span><br><span class="line"></span><br><span class="line">DESCRIPTION:</span><br><span class="line">     ValidatingWebhookConfiguration describes the configuration of and admission</span><br><span class="line">     webhook that accept or reject and object without changing it.</span><br><span class="line"></span><br><span class="line">FIELDS:</span><br><span class="line">   apiVersion  &lt;string&gt;</span><br><span class="line">     APIVersion defines the versioned schema of this representation of an</span><br><span class="line">     object. Servers should convert recognized schemas to the latest internal</span><br><span class="line">     value, and may reject unrecognized values. More info:</span><br><span class="line">     https:&#x2F;&#x2F;git.k8s.io&#x2F;community&#x2F;contributors&#x2F;devel&#x2F;sig-architecture&#x2F;api-conventions.md#resources</span><br><span class="line"></span><br><span class="line">   kind  &lt;string&gt;</span><br><span class="line">     Kind is a string value representing the REST resource this object</span><br><span class="line">     represents. Servers may infer this from the endpoint the client submits</span><br><span class="line">     requests to. Cannot be updated. In CamelCase. More info:</span><br><span class="line">     https:&#x2F;&#x2F;git.k8s.io&#x2F;community&#x2F;contributors&#x2F;devel&#x2F;sig-architecture&#x2F;api-conventions.md#types-kinds</span><br><span class="line"></span><br><span class="line">   metadata  &lt;Object&gt;</span><br><span class="line">     Standard object metadata; More info:</span><br><span class="line">     https:&#x2F;&#x2F;git.k8s.io&#x2F;community&#x2F;contributors&#x2F;devel&#x2F;sig-architecture&#x2F;api-conventions.md#metadata.</span><br><span class="line"></span><br><span class="line">   webhooks  &lt;[]Object&gt;</span><br><span class="line">     Webhooks is a list of webhooks and the affected resources and operations.</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šè¾“å‡ºé¡¶å±‚çš„å±æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦æ˜ç™½ <code>&lt;string&gt;</code> è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œ<code>&lt;Object&gt;</code> è¡¨ç¤ºå¯¹è±¡, <code>[]</code> è¡¨ç¤ºæ•°ç»„å³å¯ï¼Œå¯¹è±¡åœ¨ <code>YAML</code> æ–‡ä»¶ä¸­å°±éœ€è¦ç¼©è¿›ï¼Œæ•°ç»„å°±éœ€è¦é€šè¿‡æ·»åŠ ä¸€ä¸ªç ´æŠ˜å·æ¥è¡¨ç¤ºä¸€ä¸ª <code>Item</code>ï¼Œå¯¹äºå¯¹è±¡å’Œå¯¹è±¡æ•°ç»„æˆ‘ä»¬ä¸çŸ¥é“é‡Œé¢æœ‰ä»€ä¹ˆå±æ€§çš„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­åœ¨åé¢æŸ¥çœ‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl explain ValidatingWebhookConfiguration.metadata</span><br><span class="line">KIND:     ValidatingWebhookConfiguration</span><br><span class="line">VERSION:  admissionregistration.k8s.io&#x2F;v1</span><br><span class="line"></span><br><span class="line">RESOURCE: metadata &lt;Object&gt;</span><br><span class="line"></span><br><span class="line">DESCRIPTION:</span><br><span class="line">     Standard object metadata; More info:</span><br><span class="line">     https:&#x2F;&#x2F;git.k8s.io&#x2F;community&#x2F;contributors&#x2F;devel&#x2F;sig-architecture&#x2F;api-conventions.md#metadata.</span><br><span class="line"></span><br><span class="line">     ObjectMeta is metadata that all persisted resources must have, which</span><br><span class="line">     includes all objects users must create.</span><br><span class="line"></span><br><span class="line">FIELDS:</span><br><span class="line">   annotations  &lt;map[string]string&gt;</span><br><span class="line">     Annotations is an unstructured key value map stored with a resource that</span><br><span class="line">     may be set by external tools to store and retrieve arbitrary metadata. They</span><br><span class="line">     are not queryable and should be preserved when modifying objects. More</span><br><span class="line">     info: http:&#x2F;&#x2F;kubernetes.io&#x2F;docs&#x2F;user-guide&#x2F;annotations</span><br><span class="line"></span><br><span class="line">   ......</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¾“å‡ºçš„å±æ€§å°±æ˜¯å±äº <code>metadata</code> è¿™ä¸ª <code>key</code> ä¸‹é¢å¯¹åº”çš„å¯¹è±¡äº†ï¼Œæœ‰çš„æ—¶å€™å¦‚æœè§‰å¾—è¿™æ ·ä¸€å±‚ä¸€å±‚çš„å»æŸ¥çœ‹æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ª <code>--recursive</code> å‚æ•°æ¥è·å–æ‰€æœ‰çš„å±æ€§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl explain validatingwebhookconfiguration --recursive</span><br><span class="line">KIND:     ValidatingWebhookConfiguration</span><br><span class="line">VERSION:  admissionregistration.k8s.io&#x2F;v1</span><br><span class="line"></span><br><span class="line">DESCRIPTION:</span><br><span class="line">     ValidatingWebhookConfiguration describes the configuration of and admission</span><br><span class="line">     webhook that accept or reject and object without changing it.</span><br><span class="line"></span><br><span class="line">FIELDS:</span><br><span class="line">   apiVersion  &lt;string&gt;</span><br><span class="line">   kind  &lt;string&gt;</span><br><span class="line">   metadata  &lt;Object&gt;</span><br><span class="line">      annotations  &lt;map[string]string&gt;</span><br><span class="line">      clusterName  &lt;string&gt;</span><br><span class="line">      creationTimestamp  &lt;string&gt;</span><br><span class="line">      deletionGracePeriodSeconds  &lt;integer&gt;</span><br><span class="line">      deletionTimestamp  &lt;string&gt;</span><br><span class="line">      finalizers  &lt;[]string&gt;</span><br><span class="line">      generateName  &lt;string&gt;</span><br><span class="line">      generation  &lt;integer&gt;</span><br><span class="line">      labels  &lt;map[string]string&gt;</span><br><span class="line">      managedFields  &lt;[]Object&gt;</span><br><span class="line">         apiVersion  &lt;string&gt;</span><br><span class="line">         fieldsType  &lt;string&gt;</span><br><span class="line">         fieldsV1  &lt;map[string]&gt;</span><br><span class="line">         manager  &lt;string&gt;</span><br><span class="line">         operation  &lt;string&gt;</span><br><span class="line">         time  &lt;string&gt;</span><br><span class="line">      name  &lt;string&gt;</span><br><span class="line">      namespace  &lt;string&gt;</span><br><span class="line">      ownerReferences  &lt;[]Object&gt;</span><br><span class="line">         apiVersion  &lt;string&gt;</span><br><span class="line">         blockOwnerDeletion  &lt;boolean&gt;</span><br><span class="line">         controller  &lt;boolean&gt;</span><br><span class="line">         kind  &lt;string&gt;</span><br><span class="line">         name  &lt;string&gt;</span><br><span class="line">         uid  &lt;string&gt;</span><br><span class="line">      resourceVersion  &lt;string&gt;</span><br><span class="line">      selfLink  &lt;string&gt;</span><br><span class="line">      uid  &lt;string&gt;</span><br><span class="line">   webhooks  &lt;[]Object&gt;</span><br><span class="line">      admissionReviewVersions  &lt;[]string&gt;</span><br><span class="line">      clientConfig  &lt;Object&gt;</span><br><span class="line">         caBundle  &lt;string&gt;</span><br><span class="line">         service  &lt;Object&gt;</span><br><span class="line">            name  &lt;string&gt;</span><br><span class="line">            namespace  &lt;string&gt;</span><br><span class="line">            path  &lt;string&gt;</span><br><span class="line">            port  &lt;integer&gt;</span><br><span class="line">         url  &lt;string&gt;</span><br><span class="line">      failurePolicy  &lt;string&gt;</span><br><span class="line">      matchPolicy  &lt;string&gt;</span><br><span class="line">      name  &lt;string&gt;</span><br><span class="line">      namespaceSelector  &lt;Object&gt;</span><br><span class="line">         matchExpressions  &lt;[]Object&gt;</span><br><span class="line">            key  &lt;string&gt;</span><br><span class="line">            operator  &lt;string&gt;</span><br><span class="line">            values  &lt;[]string&gt;</span><br><span class="line">         matchLabels  &lt;map[string]string&gt;</span><br><span class="line">      objectSelector  &lt;Object&gt;</span><br><span class="line">         matchExpressions  &lt;[]Object&gt;</span><br><span class="line">            key  &lt;string&gt;</span><br><span class="line">            operator  &lt;string&gt;</span><br><span class="line">            values  &lt;[]string&gt;</span><br><span class="line">         matchLabels  &lt;map[string]string&gt;</span><br><span class="line">      rules  &lt;[]Object&gt;</span><br><span class="line">         apiGroups  &lt;[]string&gt;</span><br><span class="line">         apiVersions  &lt;[]string&gt;</span><br><span class="line">         operations  &lt;[]string&gt;</span><br><span class="line">         resources  &lt;[]string&gt;</span><br><span class="line">         scope  &lt;string&gt;</span><br><span class="line">      sideEffects  &lt;string&gt;</span><br><span class="line">      timeoutSeconds  &lt;integer&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥å°†èµ„æºå¯¹è±¡çš„å®Œæ•´å±æ€§åˆ—å‡ºæ¥ï¼Œè€Œä¸”ç¼©è¿›æ ¼å¼å’Œ <code>YAML</code> æ–‡ä»¶åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·å¯¹äºæˆ‘ä»¬å»ç¼–å†™èµ„æºæ¸…å•æ–‡ä»¶å°±æ›´åŠ å‹å¥½äº†ã€‚</p><p>è‡ªä»ä½¿ç”¨ <code>kubectl api-resources</code> å’Œ <code>kubectl explain</code> è¿™ä¸¤ä¸ªå‘½ä»¤åï¼Œä¸ºæˆ‘ä»¬ç¼–å†™èµ„æºæ¸…å•æ–‡ä»¶èŠ‚çœäº†å¾ˆå¤šæ—¶é—´ï¼Œå·¥ä½œæ•ˆç‡å¤§å¤§æé«˜äº†ï¼</p><p>è¿™ä¹ˆå¥½çš„ç¥æŠ€ï¼Œä½ è¿˜ä¸èµ¶ç´§ç”¨èµ·æ¥å—ï¼Ÿ å¦‚æœä½ è¿˜æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œæ¬¢è¿å¤§å®¶ç§¯æç•™è¨€è®¨è®ºå“Ÿï¼</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œk8sæŠ€æœ¯åœˆã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y4vvln2x%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/y4vvln2xï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æˆ‘ä»¬åœ¨ç¼–å†™ &lt;code&gt;Kubernetes&lt;/code&gt; èµ„æºæ¸…å•çš„æ—¶å€™å¯èƒ½ä¼šç»å¸¸ä¼šå¿˜è®°è¦åˆ›å»ºçš„èµ„æºåç§°ï¼Œå³ä½¿çŸ¥é“äº†å¯èƒ½ä¹Ÿä¸è®°å¾—è¯¥èµ„æºå¯¹è±¡æœ‰å“ªäº›å±æ€§å¯ä»¥ä½¿ç”¨äº†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›åç§°å¾ˆé•¿çš„èµ„æºæˆ–è€…å±æ€§ï¼Œå³ä½¿æ­»è®°ç¡¬èƒŒä¸‹æ¥éš”ä¸€æ®µæ—¶é—´åˆä¼šå¿˜è®°äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ç°åœ¨æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª &lt;code&gt;validating&lt;/code&gt; çš„ &lt;code&gt;admission webhook&lt;/code&gt;ï¼Œæˆ‘ä»¬å°±éœ€è¦å®šä¹‰ä¸€ä¸ª &lt;code&gt;ValidatingWebhookConfiguration&lt;/code&gt; çš„èµ„æºå¯¹è±¡ï¼Œä½†æ˜¯å¯èƒ½æˆ‘ä»¬ä¸è®°å¾—å®ƒçš„å…¨åäº†ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl api-resources&lt;/code&gt; å‘½ä»¤æ¥æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ &lt;code&gt;API&lt;/code&gt; èµ„æºã€‚æ‰¾åˆ°äº†æ­£ç¡®çš„èµ„æºåç§°ä¹‹åï¼Œå°±éœ€è¦äº†è§£å¦‚ä½•ç¼–å†™æ­£ç¡®çš„ &lt;code&gt;YAML&lt;/code&gt; èµ„æºæ¸…å•æ–‡ä»¶äº†ï¼Œä½†æ˜¯ &lt;code&gt;Kubernetes&lt;/code&gt; ä¸­èµ„æºå¯¹è±¡å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œè€Œä¸”æ¯ä¸€ä¸ªèµ„æºå¯¹è±¡ä¸­é…ç½®å±æ€§ä¹Ÿæ˜¯éå¸¸å¤šçš„ï¼Œæˆ‘ä»¬ä¸å¯èƒ½éƒ½èƒ½å®Œå…¨è®°ä½ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ© &lt;code&gt;kubectl explain&lt;/code&gt; å‘½ä»¤æ¥æ‰¾åˆ°å®Œæ•´çš„ç»“æ„ï¼Œè¿™å¯¹äºæˆ‘ä»¬ç¼–å†™ &lt;code&gt;YAML&lt;/code&gt; èµ„æºæ¸…å•æ–‡ä»¶éå¸¸æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h2 id=&quot;kubectl-api-resources-å‘½ä»¤&quot;&gt;kubectl api-resources å‘½ä»¤&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;kubectl api-resources&lt;/code&gt; å‘½ä»¤å¯ä»¥æ‰“å°æ‰€æœ‰å·²ç»æ³¨å†Œçš„ &lt;code&gt;API&lt;/code&gt; èµ„æºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ Kubectl api-resources&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NAME                              SHORTNAMES                                   APIGROUP                       NAMESPACED   KIND&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bindings                                                                                                      true         Binding&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;componentstatuses                 cs                                                                          false        ComponentStatus&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configmaps                        cm                                                                          true         ConfigMap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;endpoints                         ep                                                                          true         Endpoints&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;events                            ev                                                                          true         Event&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;limitranges                       limits                                                                      true         LimitRange&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;namespaces                        ns                                                                          false        Namespace&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nodes                             no                                                                          false        Node&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;......&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­ä¹Ÿä¼šåŒ…å«ä¸Šé¢æåˆ°çš„ &lt;code&gt;ValidatingWebhookConfiguration&lt;/code&gt; èµ„æºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mutatingwebhookconfigurations                                                  admissionregistration.k8s.io   false        MutatingWebhookConfiguration&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;validatingwebhookconfigurations                                                admissionregistration.k8s.io   false        ValidatingWebhookConfiguration&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;customresourcedefinitions         crd,crds                                     apiextensions.k8s.io           false        CustomResourceDefinition&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;apiservices                                                                    apiregistration.k8s.io         false        APIService&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç”±äº &lt;code&gt;Kubernetes&lt;/code&gt; ä¸­å·²ç»æ³¨å†Œçš„èµ„æºå¯¹è±¡éå¸¸å¤šï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬è¦æŸ¥æ‰¾çš„èµ„æºåç§°åŒ…å«ä¸€äº›å…³é”®è¯çš„è¯ï¼Œå¯ä»¥ç”¨ &lt;code&gt;grep&lt;/code&gt; æ¥è¿‡æ»¤:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ kubectl api-resources |grep validating&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;validatingwebhookconfigurations                                                admissionregistration.k8s.io   false        ValidatingWebhookConfiguration&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ ·å°±å¯ä»¥æ›´ç²¾ç¡®çš„æœç´¢åˆ°éœ€è¦ä½¿ç”¨çš„èµ„æºåç§°äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œå°±æ˜¯ &lt;code&gt;ValidatingWebhookConfiguration&lt;/code&gt; ï¼Œç°åœ¨çŸ¥é“äº†èµ„æºå¯¹è±¡çš„åç§°ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl explain&lt;/code&gt; å‘½ä»¤æ¥æŸ¥æ‰¾èµ„æºå¯¹è±¡çš„å±æ€§ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="YAML" scheme="https://www.hi-linux.com/tags/YAML/"/>
    
  </entry>
  
  <entry>
    <title>å†è§ ELKï¼Œæ˜¯æ—¶å€™æ‹¥æŠ±ä¸‹ä¸€ä»£æ—¥å¿—ç³»ç»Ÿ Loki äº†</title>
    <link href="https://www.hi-linux.com/posts/61047.html"/>
    <id>https://www.hi-linux.com/posts/61047.html</id>
    <published>2020-07-27T01:00:00.000Z</published>
    <updated>2020-07-27T04:18:14.060Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>æœ€è¿‘ï¼Œåœ¨å¯¹å…¬å¸å®¹å™¨äº‘çš„æ—¥å¿—æ–¹æ¡ˆè¿›è¡Œè®¾è®¡çš„æ—¶å€™ï¼Œå‘ç°ä¸»æµçš„ ELK æˆ–è€… EFK æ¯”è¾ƒé‡ï¼Œå†åŠ ä¸Šç°é˜¶æ®µå¯¹äº ES å¤æ‚çš„æœç´¢åŠŸèƒ½å¾ˆå¤šéƒ½ç”¨ä¸ä¸Šï¼Œæœ€ç»ˆé€‰æ‹©äº† Grafana å¼€æºçš„ Loki æ—¥å¿—ç³»ç»Ÿã€‚ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸‹ Loki çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µå’Œæ¶æ„ã€‚</p><blockquote><p>Loki æ˜¯ Grafana Labs å›¢é˜Ÿæœ€æ–°çš„å¼€æºé¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ°´å¹³å¯æ‰©å±•ï¼Œé«˜å¯ç”¨æ€§ï¼Œå¤šç§Ÿæˆ·çš„æ—¥å¿—èšåˆç³»ç»Ÿã€‚å®ƒçš„è®¾è®¡éå¸¸ç»æµé«˜æ•ˆä¸”æ˜“äºæ“ä½œï¼Œå› ä¸ºå®ƒä¸ä¼šä¸ºæ—¥å¿—å†…å®¹ç¼–åˆ¶ç´¢å¼•ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªæ—¥å¿—æµç¼–åˆ¶ä¸€ç»„æ ‡ç­¾ï¼Œä¸“é—¨ä¸º Prometheus å’Œ Kubernetes ç”¨æˆ·åšäº†ç›¸å…³ä¼˜åŒ–ã€‚è¯¥é¡¹ç›®å— Prometheus å¯å‘ï¼Œå®˜æ–¹çš„ä»‹ç»å°±æ˜¯ï¼š <code>Like Prometheus,But For Logs.</code>ï¼Œç±»ä¼¼äº Prometheus çš„æ—¥å¿—ç³»ç»Ÿã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/grafana/loki/" target="_blank" rel="noopener">https://github.com/grafana/loki/</a></p></blockquote><p>ä¸å…¶ä»–æ—¥å¿—èšåˆç³»ç»Ÿç›¸æ¯”ï¼Œ Loki å…·æœ‰ä¸‹é¢çš„ä¸€äº›ç‰¹æ€§ï¼š</p><ul><li><p>ä¸å¯¹æ—¥å¿—è¿›è¡Œå…¨æ–‡ç´¢å¼•ã€‚é€šè¿‡å­˜å‚¨å‹ç¼©éç»“æ„åŒ–æ—¥å¿—å’Œä»…ç´¢å¼•å…ƒæ•°æ®ï¼ŒLoki æ“ä½œèµ·æ¥ä¼šæ›´ç®€å•ï¼Œæ›´çœæˆæœ¬ã€‚</p></li><li><p>é€šè¿‡ä½¿ç”¨ä¸ Prometheus ç›¸åŒçš„æ ‡ç­¾è®°å½•æµå¯¹æ—¥å¿—è¿›è¡Œç´¢å¼•å’Œåˆ†ç»„ï¼Œè¿™ä½¿å¾—æ—¥å¿—çš„æ‰©å±•å’Œæ“ä½œæ•ˆç‡æ›´é«˜ã€‚</p></li><li><p>ç‰¹åˆ«é€‚åˆå‚¨å­˜ Kubernetes Pod æ—¥å¿—; è¯¸å¦‚ Pod æ ‡ç­¾ä¹‹ç±»çš„å…ƒæ•°æ®ä¼šè¢«è‡ªåŠ¨åˆ é™¤å’Œç¼–å…¥ç´¢å¼•ã€‚</p></li><li><p>å— Grafana åŸç”Ÿæ”¯æŒã€‚</p></li></ul><h2 id="èƒŒæ™¯å’ŒåŠ¨æœº">èƒŒæ™¯å’ŒåŠ¨æœº</h2><p>å½“æˆ‘ä»¬çš„å®¹å™¨äº‘è¿è¡Œçš„åº”ç”¨æˆ–è€…æŸä¸ªèŠ‚ç‚¹å‡ºç°é—®é¢˜äº†ï¼Œè§£å†³æ€è·¯åº”è¯¥å¦‚ä¸‹ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/loki1.jpeg" alt=""></p><p>æˆ‘ä»¬çš„ç›‘æ§ä½¿ç”¨çš„æ˜¯åŸºäº Prometheus ä½“ç³»è¿›è¡Œæ”¹é€ çš„ï¼ŒPrometheus ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯ Metric å’Œ Alertï¼ŒMetric æ˜¯æ¥è¯´æ˜å½“å‰æˆ–è€…å†å²è¾¾åˆ°äº†æŸä¸ªå€¼ï¼ŒAlert è®¾ç½® Metric è¾¾åˆ°æŸä¸ªç‰¹å®šçš„åŸºæ•°è§¦å‘äº†å‘Šè­¦ï¼Œä½†æ˜¯è¿™äº›ä¿¡æ¯æ˜æ˜¾æ˜¯ä¸å¤Ÿçš„ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKubernetes çš„åŸºæœ¬å•ä½æ˜¯ Podï¼ŒPod æŠŠæ—¥å¿—è¾“å‡ºåˆ° Stdout å’Œ Stderrï¼Œå¹³æ—¶æœ‰ä»€ä¹ˆé—®é¢˜æˆ‘ä»¬é€šå¸¸åœ¨ç•Œé¢æˆ–è€…é€šè¿‡å‘½ä»¤æŸ¥çœ‹ç›¸å…³çš„æ—¥å¿—ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå½“æˆ‘ä»¬çš„æŸä¸ª Pod çš„å†…å­˜å˜å¾—å¾ˆå¤§ï¼Œè§¦å‘äº†æˆ‘ä»¬çš„ Alertã€‚è¿™æ—¶ç®¡ç†å‘˜ï¼Œå»é¡µé¢æŸ¥è¯¢ç¡®è®¤æ˜¯å“ªä¸ª Pod æœ‰é—®é¢˜ï¼Œç„¶åè¦ç¡®è®¤ Pod å†…å­˜å˜å¤§çš„åŸå› ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»æŸ¥è¯¢ Pod çš„æ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰æ—¥å¿—ç³»ç»Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åˆ°é¡µé¢æˆ–è€…ä½¿ç”¨å‘½ä»¤è¿›è¡ŒæŸ¥è¯¢ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/loki2.jpeg" alt=""></p><p>å¦‚æœï¼Œè¿™ä¸ªæ—¶å€™åº”ç”¨çªç„¶æŒ‚äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±æ— æ³•æŸ¥åˆ°ç›¸å…³çš„æ—¥å¿—äº†ã€‚æ‰€ä»¥éœ€è¦å¼•å…¥æ—¥å¿—ç³»ç»Ÿï¼Œç»Ÿä¸€æ”¶é›†æ—¥å¿—ã€‚è€Œä½¿ç”¨ ELK çš„è¯ï¼Œå°±éœ€è¦åœ¨ Kibana å’Œ Grafana ä¹‹é—´åˆ‡æ¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚æ‰€ä»¥ ï¼ŒLoki çš„ç¬¬ä¸€ç›®çš„å°±æ˜¯æœ€å°åŒ–åº¦é‡å’Œæ—¥å¿—çš„åˆ‡æ¢æˆæœ¬ï¼Œæœ‰åŠ©äºå‡å°‘å¼‚å¸¸äº‹ä»¶çš„å“åº”æ—¶é—´å’Œæé«˜ç”¨æˆ·çš„ä½“éªŒã€‚</p><a id="more"></a><h2 id="elk-å­˜åœ¨çš„é—®é¢˜">ELK å­˜åœ¨çš„é—®é¢˜</h2><p>ç°æœ‰çš„å¾ˆå¤šæ—¥å¿—é‡‡é›†çš„æ–¹æ¡ˆéƒ½æ˜¯é‡‡ç”¨å…¨æ–‡æ£€ç´¢å¯¹æ—¥å¿—è¿›è¡Œç´¢å¼•ï¼ˆå¦‚ ELK æ–¹æ¡ˆï¼‰ï¼Œä¼˜ç‚¹æ˜¯åŠŸèƒ½ä¸°å¯Œï¼Œå…è®¸å¤æ‚çš„æ“ä½œã€‚ä½†æ˜¯ï¼Œè¿™äº›æ–¹æ¡ˆå¾€å¾€è§„æ¨¡å¤æ‚ï¼Œèµ„æºå ç”¨é«˜ï¼Œæ“ä½œè‹¦éš¾ã€‚å¾ˆå¤šåŠŸèƒ½å¾€å¾€ç”¨ä¸ä¸Šï¼Œå¤§å¤šæ•°æŸ¥è¯¢åªå…³æ³¨ä¸€å®šæ—¶é—´èŒƒå›´å’Œä¸€äº›ç®€å•çš„å‚æ•°ï¼ˆå¦‚ï¼šhostã€service ç­‰ï¼‰ï¼Œä½¿ç”¨è¿™äº›è§£å†³æ–¹æ¡ˆå°±æœ‰ç‚¹æ€é¸¡ç”¨ç‰›åˆ€çš„æ„Ÿè§‰äº†ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/loki3.jpeg" alt=""></p><p>å› æ­¤ï¼ŒLoki çš„ç¬¬äºŒä¸ªç›®çš„æ˜¯ï¼Œåœ¨æŸ¥è¯¢è¯­è¨€çš„æ˜“æ“ä½œæ€§å’Œå¤æ‚æ€§ä¹‹é—´å¯ä»¥è¾¾åˆ°ä¸€ä¸ªæƒè¡¡ã€‚</p><h2 id="æˆæœ¬è€ƒé‡">æˆæœ¬è€ƒé‡</h2><p>å…¨æ–‡æ£€ç´¢çš„æ–¹æ¡ˆä¹Ÿå¸¦æ¥æˆæœ¬é—®é¢˜ï¼Œç®€å•çš„è¯´å°±æ˜¯å…¨æ–‡æœç´¢ï¼ˆå¦‚ï¼šESï¼‰çš„å€’æ’ç´¢å¼•çš„åˆ‡åˆ†å’Œå…±äº«çš„æˆæœ¬è¾ƒé«˜ã€‚åæ¥å‡ºç°äº†å…¶ä»–ä¸åŒçš„è®¾è®¡æ–¹æ¡ˆï¼Œå¦‚ï¼š</p><ul><li>OKlog</li></ul><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/oklog/oklog" target="_blank" rel="noopener">https://github.com/oklog/oklog</a></p><p>é‡‡ç”¨æœ€ç»ˆä¸€è‡´çš„ã€åŸºäºç½‘æ ¼çš„åˆ†å¸ƒç­–ç•¥ã€‚è¿™ä¸¤ä¸ªè®¾è®¡å†³ç­–æä¾›äº†å¤§é‡çš„æˆæœ¬é™ä½å’Œéå¸¸ç®€å•çš„æ“ä½œï¼Œä½†æ˜¯æŸ¥è¯¢ä¸å¤Ÿæ–¹ä¾¿ã€‚å› æ­¤ï¼ŒLoki çš„ç¬¬ä¸‰ä¸ªç›®çš„æ˜¯ï¼Œæä¾›ä¸€ä¸ªæ›´å…·æˆæœ¬æ•ˆç›Šçš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="æ•´ä½“æ¶æ„">æ•´ä½“æ¶æ„</h2><p>Loki çš„æ¶æ„å¦‚ä¸‹ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/loki4.jpeg" alt=""></p><p>ä¸éš¾çœ‹å‡ºï¼ŒLoki çš„æ¶æ„éå¸¸ç®€å•ï¼Œä¸»è¦ç”±ä»¥ä¸‹ 3 ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ul><li><p>Loki æ˜¯ä¸»æœåŠ¡å™¨ï¼Œè´Ÿè´£å­˜å‚¨æ—¥å¿—å’Œå¤„ç†æŸ¥è¯¢ã€‚</p></li><li><p>Promtailæ˜¯ä»£ç†ï¼Œè´Ÿè´£æ”¶é›†æ—¥å¿—å¹¶å°†å…¶å‘é€ç»™ Loki ã€‚</p></li><li><p>Grafana ç”¨äº UI å±•ç¤ºã€‚</p></li></ul><p>Loki ä½¿ç”¨äº†å’Œ Prometheus ä¸€æ ·çš„æ ‡ç­¾æ¥ä½œä¸ºç´¢å¼•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ é€šè¿‡è¿™äº›æ ‡ç­¾æ—¢å¯ä»¥æŸ¥è¯¢æ—¥å¿—çš„å†…å®¹ä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ°ç›‘æ§çš„æ•°æ®ï¼Œä¸ä½†å‡å°‘äº†ä¸¤ç§æŸ¥è¯¢ä¹‹é—´çš„åˆ‡æ¢æˆæœ¬ï¼Œä¹Ÿæå¤§åœ°é™ä½äº†æ—¥å¿—ç´¢å¼•çš„å­˜å‚¨ã€‚</p><p>Loki ä½¿ç”¨ä¸ Prometheus ç›¸åŒçš„æœåŠ¡å‘ç°å’Œæ ‡ç­¾é‡æ–°æ ‡è®°åº“ï¼Œç¼–å†™äº† Pormtailã€‚åœ¨ Kubernetes ä¸­ Promtail ä»¥ DaemonSet æ–¹å¼è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œé€šè¿‡ Kubernetes API å¾—åˆ°æ—¥å¿—çš„æ­£ç¡®å…ƒæ•°æ®ï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ° Lokiã€‚ä¸‹é¢æ˜¯æ—¥å¿—çš„å­˜å‚¨æ¶æ„ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/loki5.jpeg" alt=""></p><h3 id="è¯»å†™">è¯»å†™</h3><p>æ—¥å¿—æ•°æ®çš„å†™ä¸»è¦ä¾æ‰˜çš„æ˜¯ Distributor å’Œ Ingester ä¸¤ä¸ªç»„ä»¶ï¼Œæ•´ä½“çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/loki6.jpeg" alt=""></p><h3 id="distributor">Distributor</h3><p>ä¸€æ—¦ Promtail æ”¶é›†æ—¥å¿—å¹¶å°†å…¶å‘é€ç»™ Lokiï¼ŒDistributor å°±æ˜¯ç¬¬ä¸€ä¸ªæ¥æ”¶æ—¥å¿—çš„ç»„ä»¶ã€‚ç”±äºæ—¥å¿—çš„å†™å…¥é‡å¯èƒ½å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨å®ƒä»¬ä¼ å…¥æ—¶å°†å®ƒä»¬å†™å…¥æ•°æ®åº“ã€‚è¿™ä¼šæ¯æ‰æ•°æ®åº“ã€‚æˆ‘ä»¬éœ€è¦æ‰¹å¤„ç†å’Œå‹ç¼©æ•°æ®ã€‚</p><p>Loki é€šè¿‡æ„å»ºå‹ç¼©æ•°æ®å—æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œæ–¹æ³•æ˜¯åœ¨æ—¥å¿—è¿›å…¥æ—¶å¯¹å…¶è¿›è¡Œ Gzip æ“ä½œã€‚ç»„ä»¶ Ingester æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œè´Ÿè´£æ„å»ºå’Œåˆ·æ–° Chunckï¼Œå½“ Chunk è¾¾åˆ°ä¸€å®šçš„æ•°é‡æˆ–è€…æ—¶é—´åï¼Œåˆ·æ–°åˆ°å­˜å‚¨ä¸­å»ã€‚æ¯ä¸ªæµçš„æ—¥å¿—å¯¹åº”ä¸€ä¸ª Ingesterï¼Œå½“æ—¥å¿—åˆ°è¾¾ Distributor åï¼Œæ ¹æ®å…ƒæ•°æ®å’Œ Hash ç®—æ³•è®¡ç®—å‡ºåº”è¯¥åˆ°å“ªä¸ª Ingester ä¸Šé¢ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/loki7.jpeg" alt=""></p><p>æ­¤å¤–ï¼Œä¸ºäº†å†—ä½™å’Œå¼¹æ€§ï¼Œæˆ‘ä»¬å°†å…¶å¤åˆ¶ nï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸º 3ï¼‰æ¬¡ã€‚</p><h3 id="ingester">Ingester</h3><p>Ingester æ¥æ”¶åˆ°æ—¥å¿—å¹¶å¼€å§‹æ„å»º Chunkï¼š</p><p><img src="https://www.hi-linux.com/img/linux/loki8.jpeg" alt=""></p><p>åŸºæœ¬ä¸Šå°±æ˜¯å°†æ—¥å¿—è¿›è¡Œå‹ç¼©å¹¶é™„åŠ åˆ° Chunk ä¸Šé¢ã€‚ä¸€æ—¦ Chunk å¡«æ»¡ï¼ˆæ•°æ®è¾¾åˆ°ä¸€å®šæ•°é‡æˆ–è€…è¿‡äº†ä¸€å®šæœŸé™ï¼‰ï¼ŒIngester å°†å…¶åˆ·æ–°åˆ°æ•°æ®åº“ã€‚æˆ‘ä»¬å¯¹å—å’Œç´¢å¼•ä½¿ç”¨å•ç‹¬çš„æ•°æ®åº“ï¼Œå› ä¸ºå®ƒä»¬å­˜å‚¨çš„æ•°æ®ç±»å‹ä¸åŒã€‚</p><p><img src="https://www.hi-linux.com/img/linux/loki9.jpeg" alt=""></p><p>åˆ·æ–°ä¸€ä¸ª Chunk ä¹‹åï¼ŒIngester ç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ç©º Chunk å¹¶å°†æ–°æ¡ç›®æ·»åŠ åˆ°è¯¥ Chunk ä¸­ã€‚</p><h3 id="querier">Querier</h3><p>è¯»å–å°±éå¸¸ç®€å•äº†ï¼Œç”± Querier è´Ÿè´£ç»™å®šä¸€ä¸ªæ—¶é—´èŒƒå›´å’Œæ ‡ç­¾é€‰æ‹©å™¨ï¼ŒQuerier æŸ¥çœ‹ç´¢å¼•ä»¥ç¡®å®šå“ªäº›å—åŒ¹é…ï¼Œå¹¶é€šè¿‡ Greps å°†ç»“æœæ˜¾ç¤ºå‡ºæ¥ã€‚å®ƒè¿˜ä» Ingester è·å–å°šæœªåˆ·æ–°çš„æœ€æ–°æ•°æ®ã€‚</p><p>å¯¹äºæ¯ä¸ªæŸ¥è¯¢ï¼Œä¸€ä¸ªæŸ¥è¯¢å™¨å°†ä¸ºæ‚¨æ˜¾ç¤ºæ‰€æœ‰ç›¸å…³æ—¥å¿—ã€‚å®ç°äº†æŸ¥è¯¢å¹¶è¡ŒåŒ–ï¼Œæä¾›åˆ†å¸ƒå¼ Grepï¼Œä½¿å³ä½¿æ˜¯å¤§å‹æŸ¥è¯¢ä¹Ÿæ˜¯è¶³å¤Ÿçš„ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/loki10.jpeg" alt=""></p><h3 id="å¯æ‰©å±•æ€§">å¯æ‰©å±•æ€§</h3><p>Loki çš„ç´¢å¼•å­˜å‚¨å¯ä»¥æ˜¯ Cassandra/Bigtable/Dynamodbï¼Œè€Œ Chuncks å¯ä»¥æ˜¯å„ç§å¯¹è±¡å­˜å‚¨ï¼ŒQuerier å’Œ Distributor éƒ½æ˜¯æ— çŠ¶æ€çš„ç»„ä»¶ã€‚</p><p>å¯¹äº Ingesterï¼Œå®ƒè™½ç„¶æ˜¯æœ‰çŠ¶æ€çš„ã€‚ä½†æ˜¯ï¼Œå½“æ–°çš„èŠ‚ç‚¹åŠ å…¥æˆ–è€…å‡å°‘ï¼Œæ•´èŠ‚ç‚¹é—´çš„ Chunk ä¼šé‡æ–°åˆ†é…ï¼Œå·²é€‚åº”æ–°çš„æ•£åˆ—ç¯ã€‚è€Œ Loki åº•å±‚å­˜å‚¨çš„å®ç° Cortex å·²ç»åœ¨å®é™…çš„ç”Ÿäº§ä¸­æŠ•å…¥ä½¿ç”¨å¤šå¹´äº†ã€‚</p><h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2><ol><li><p><a href="https://blog.csdn.net/Linkthaha/article/details/100575278" target="_blank" rel="noopener">https://blog.csdn.net/Linkthaha/article/details/100575278</a></p></li><li><p><a href="http://blog.csdn.net/Linkthaha/article/details/100575651" target="_blank" rel="noopener">http://blog.csdn.net/Linkthaha/article/details/100575651</a></p></li><li><p><a href="https://www.qikqiak.com/post/grafana-log-tool-loki/" target="_blank" rel="noopener">https://www.qikqiak.com/post/grafana-log-tool-loki/</a></p></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ï¼Œåœ¨å¯¹å…¬å¸å®¹å™¨äº‘çš„æ—¥å¿—æ–¹æ¡ˆè¿›è¡Œè®¾è®¡çš„æ—¶å€™ï¼Œå‘ç°ä¸»æµçš„ ELK æˆ–è€… EFK æ¯”è¾ƒé‡ï¼Œå†åŠ ä¸Šç°é˜¶æ®µå¯¹äº ES å¤æ‚çš„æœç´¢åŠŸèƒ½å¾ˆå¤šéƒ½ç”¨ä¸ä¸Šï¼Œæœ€ç»ˆé€‰æ‹©äº† Grafana å¼€æºçš„ Loki æ—¥å¿—ç³»ç»Ÿã€‚ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸‹ Loki çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µå’Œæ¶æ„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Loki æ˜¯ Grafana Labs å›¢é˜Ÿæœ€æ–°çš„å¼€æºé¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ°´å¹³å¯æ‰©å±•ï¼Œé«˜å¯ç”¨æ€§ï¼Œå¤šç§Ÿæˆ·çš„æ—¥å¿—èšåˆç³»ç»Ÿã€‚å®ƒçš„è®¾è®¡éå¸¸ç»æµé«˜æ•ˆä¸”æ˜“äºæ“ä½œï¼Œå› ä¸ºå®ƒä¸ä¼šä¸ºæ—¥å¿—å†…å®¹ç¼–åˆ¶ç´¢å¼•ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªæ—¥å¿—æµç¼–åˆ¶ä¸€ç»„æ ‡ç­¾ï¼Œä¸“é—¨ä¸º Prometheus å’Œ Kubernetes ç”¨æˆ·åšäº†ç›¸å…³ä¼˜åŒ–ã€‚è¯¥é¡¹ç›®å— Prometheus å¯å‘ï¼Œå®˜æ–¹çš„ä»‹ç»å°±æ˜¯ï¼š &lt;code&gt;Like Prometheus,But For Logs.&lt;/code&gt;ï¼Œç±»ä¼¼äº Prometheus çš„æ—¥å¿—ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&quot;https://github.com/grafana/loki/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/grafana/loki/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸å…¶ä»–æ—¥å¿—èšåˆç³»ç»Ÿç›¸æ¯”ï¼Œ Loki å…·æœ‰ä¸‹é¢çš„ä¸€äº›ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸å¯¹æ—¥å¿—è¿›è¡Œå…¨æ–‡ç´¢å¼•ã€‚é€šè¿‡å­˜å‚¨å‹ç¼©éç»“æ„åŒ–æ—¥å¿—å’Œä»…ç´¢å¼•å…ƒæ•°æ®ï¼ŒLoki æ“ä½œèµ·æ¥ä¼šæ›´ç®€å•ï¼Œæ›´çœæˆæœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨ä¸ Prometheus ç›¸åŒçš„æ ‡ç­¾è®°å½•æµå¯¹æ—¥å¿—è¿›è¡Œç´¢å¼•å’Œåˆ†ç»„ï¼Œè¿™ä½¿å¾—æ—¥å¿—çš„æ‰©å±•å’Œæ“ä½œæ•ˆç‡æ›´é«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç‰¹åˆ«é€‚åˆå‚¨å­˜ Kubernetes Pod æ—¥å¿—; è¯¸å¦‚ Pod æ ‡ç­¾ä¹‹ç±»çš„å…ƒæ•°æ®ä¼šè¢«è‡ªåŠ¨åˆ é™¤å’Œç¼–å…¥ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å— Grafana åŸç”Ÿæ”¯æŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;èƒŒæ™¯å’ŒåŠ¨æœº&quot;&gt;èƒŒæ™¯å’ŒåŠ¨æœº&lt;/h2&gt;
&lt;p&gt;å½“æˆ‘ä»¬çš„å®¹å™¨äº‘è¿è¡Œçš„åº”ç”¨æˆ–è€…æŸä¸ªèŠ‚ç‚¹å‡ºç°é—®é¢˜äº†ï¼Œè§£å†³æ€è·¯åº”è¯¥å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/loki1.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„ç›‘æ§ä½¿ç”¨çš„æ˜¯åŸºäº Prometheus ä½“ç³»è¿›è¡Œæ”¹é€ çš„ï¼ŒPrometheus ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯ Metric å’Œ Alertï¼ŒMetric æ˜¯æ¥è¯´æ˜å½“å‰æˆ–è€…å†å²è¾¾åˆ°äº†æŸä¸ªå€¼ï¼ŒAlert è®¾ç½® Metric è¾¾åˆ°æŸä¸ªç‰¹å®šçš„åŸºæ•°è§¦å‘äº†å‘Šè­¦ï¼Œä½†æ˜¯è¿™äº›ä¿¡æ¯æ˜æ˜¾æ˜¯ä¸å¤Ÿçš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKubernetes çš„åŸºæœ¬å•ä½æ˜¯ Podï¼ŒPod æŠŠæ—¥å¿—è¾“å‡ºåˆ° Stdout å’Œ Stderrï¼Œå¹³æ—¶æœ‰ä»€ä¹ˆé—®é¢˜æˆ‘ä»¬é€šå¸¸åœ¨ç•Œé¢æˆ–è€…é€šè¿‡å‘½ä»¤æŸ¥çœ‹ç›¸å…³çš„æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼šå½“æˆ‘ä»¬çš„æŸä¸ª Pod çš„å†…å­˜å˜å¾—å¾ˆå¤§ï¼Œè§¦å‘äº†æˆ‘ä»¬çš„ Alertã€‚è¿™æ—¶ç®¡ç†å‘˜ï¼Œå»é¡µé¢æŸ¥è¯¢ç¡®è®¤æ˜¯å“ªä¸ª Pod æœ‰é—®é¢˜ï¼Œç„¶åè¦ç¡®è®¤ Pod å†…å­˜å˜å¤§çš„åŸå› ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»æŸ¥è¯¢ Pod çš„æ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰æ—¥å¿—ç³»ç»Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åˆ°é¡µé¢æˆ–è€…ä½¿ç”¨å‘½ä»¤è¿›è¡ŒæŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/loki2.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœï¼Œè¿™ä¸ªæ—¶å€™åº”ç”¨çªç„¶æŒ‚äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±æ— æ³•æŸ¥åˆ°ç›¸å…³çš„æ—¥å¿—äº†ã€‚æ‰€ä»¥éœ€è¦å¼•å…¥æ—¥å¿—ç³»ç»Ÿï¼Œç»Ÿä¸€æ”¶é›†æ—¥å¿—ã€‚è€Œä½¿ç”¨ ELK çš„è¯ï¼Œå°±éœ€è¦åœ¨ Kibana å’Œ Grafana ä¹‹é—´åˆ‡æ¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚æ‰€ä»¥ ï¼ŒLoki çš„ç¬¬ä¸€ç›®çš„å°±æ˜¯æœ€å°åŒ–åº¦é‡å’Œæ—¥å¿—çš„åˆ‡æ¢æˆæœ¬ï¼Œæœ‰åŠ©äºå‡å°‘å¼‚å¸¸äº‹ä»¶çš„å“åº”æ—¶é—´å’Œæé«˜ç”¨æˆ·çš„ä½“éªŒã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Loki" scheme="https://www.hi-linux.com/categories/Loki/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
      <category term="Loki" scheme="https://www.hi-linux.com/tags/Loki/"/>
    
  </entry>
  
  <entry>
    <title>æ¨èå‡ æ¬¾å¿«é€Ÿç®¡ç† Kubernetes å¤šé›†ç¾¤ç¯å¢ƒçš„ç¥å™¨</title>
    <link href="https://www.hi-linux.com/posts/25886.html"/>
    <id>https://www.hi-linux.com/posts/25886.html</id>
    <published>2020-07-20T01:00:00.000Z</published>
    <updated>2020-07-20T01:24:53.671Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p><code>Kubernetes</code> ç”Ÿæ€åœ¨å¾ˆå¤šä¼ä¸šå¹¿æ³›åº”ç”¨çš„å½“ä¸‹ï¼Œç›¸ä¿¡å¾ˆå¤šè¿ç»´å’Œå¼€å‘äººå‘˜éƒ½ä¼šåŒæ—¶ç®¡ç†å’Œç»´æŠ¤å¤šä¸ª <code>Kubernetes</code> é›†ç¾¤ï¼Œæ¯”å¦‚ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€é¢„å‘å¸ƒç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒç­‰ç­‰ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†å¤šä¸ªç¯å¢ƒçš„é›†ç¾¤ï¼Œé€šå¸¸éƒ½æ˜¯åœ¨æœ¬åœ°ç¯å¢ƒé€šè¿‡ <code>Kubernetes</code> çš„å®¢æˆ·ç«¯å·¥å…· <code>kubectl</code> æ¥ç®¡ç†å¤šä¸ª <code>Kubernetes</code> é›†ç¾¤çš„ã€‚è¿™æ—¶ä½ å°±éœ€è¦ç”¨åˆ°å„ä¸ªé›†ç¾¤çš„ <code>kubeconfig</code> æ–‡ä»¶ï¼Œä½ æ˜¯ä¸æ˜¯é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æ‰‹åŠ¨å°†å¤šä¸ª <code>kubeconfig</code> é…ç½®æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªï¼Œç„¶åé€šè¿‡ <code>kubectx</code> æˆ– <code>kubie</code> è¿™æ ·çš„å·¥å…·æ¥å¿«é€Ÿåˆ‡æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆcontextï¼‰æ¥è¾¾åˆ°å¤šé›†ç¾¤ç¯å¢ƒçš„ç®¡ç†å‘¢ï¼Ÿè™½ç„¶æ‰‹åŠ¨åˆå¹¶ <code>kubeconfig</code> é…ç½®æ–‡ä»¶çš„æ–¹æ³•æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯é›†ç¾¤ç¯å¢ƒè¾ƒå¤šæ—¶æˆ–è€…é›†ç¾¤ç¯å¢ƒç»å¸¸å˜æ›´æ—¶ï¼Œè¿™æ ·çš„æ–¹æ³•å°±æ˜¾å¾—å¾ˆéº»çƒ¦äº†ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ç»™å¤§å®¶ä»‹ç»å‡ ç§æ›´æ–¹ä¾¿æ›´å¿«æ·çš„ <code>Kubernetes</code> å¤šé›†ç¾¤ç®¡ç†æ–¹æ³•ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹å®˜æ–¹æä¾›çš„å®ç°æ–¹å¼ï¼š</p><h3 id="å®˜æ–¹æä¾›çš„è§£å†³æ–¹æ³•">å®˜æ–¹æä¾›çš„è§£å†³æ–¹æ³•</h3><p>å®˜æ–¹ç›®å‰æä¾›äº†é…ç½®ç¯å¢ƒå˜é‡å’Œé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ˜¾ç¤ºæŒ‡å®šä¸¤ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><ol><li>é…ç½®ç¯å¢ƒå˜é‡æŒ‡å®šå¤šä¸ªé›†ç¾¤çš„ kubeconfig æ–‡ä»¶</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># é…ç½® Kubernetes å¤šé›†ç¾¤ï¼Œæ³¨æ„ä½¿ç”¨ : éš”å¼€</span><br><span class="line">export KUBECONFIG&#x3D;$KUBECONFIG:$HOME&#x2F;.kube&#x2F;config:$HOME&#x2F;.kube&#x2F;mike-local-kubernetes.yaml:$HOME&#x2F;.kube&#x2F;dev-kubernetes.yaml:$HOME&#x2F;.kube&#x2F;test-kubernetes.yaml:$HOME&#x2F;.kube&#x2F;prod-kubernetes.yaml:$HOME&#x2F;.kube&#x2F;okteto-kube.yaml</span><br></pre></td></tr></table></figure><ol start="2"><li>é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ˜¾ç¤ºæŒ‡å®šä¸åŒé›†ç¾¤çš„ kubeconfig æ–‡ä»¶</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># åˆ‡æ¢åˆ°æœ¬åœ°é›†ç¾¤</span><br><span class="line">kubectl get pod --kubeconfig&#x3D;$HOME&#x2F;.kube&#x2F;mike-local-kubernetes.yaml</span><br><span class="line"></span><br><span class="line"># åˆ‡æ¢åˆ°å¼€å‘é›†ç¾¤</span><br><span class="line">kubectl get pod --kubeconfig&#x3D;$HOME&#x2F;.kube&#x2F;dev-kubernetes.yaml</span><br><span class="line"></span><br><span class="line"># åˆ‡æ¢åˆ°æµ‹è¯•é›†ç¾¤</span><br><span class="line">kubectl get pod --kubeconfig&#x3D;$HOME&#x2F;.kube&#x2F;test-kubernetes.yaml</span><br><span class="line"></span><br><span class="line"># åˆ‡æ¢åˆ°ç”Ÿäº§é›†ç¾¤</span><br><span class="line">kubectl get pod --kubeconfig&#x3D;$HOME&#x2F;.kube&#x2F;prod-kubernetes.yaml</span><br></pre></td></tr></table></figure><p>è™½ç„¶å®˜æ–¹æä¾›çš„æ–¹æ³•ï¼Œèƒ½å®ç°å¤šé›†ç¾¤ç®¡ç†ã€‚ä½†æ˜¯ä¸æ–­æ¥å›åˆ‡æ¢ <code>kubeconfig</code> é…ç½®æ–‡ä»¶æˆ–è€…ç»å¸¸æ‰‹åŠ¨ç¼–è¾‘ç¯å¢ƒå˜é‡æ¥å¢å‡å¤šä¸ªé›†ç¾¤çš„é…ç½®æ–‡ä»¶ï¼Œæ˜¾ç„¶è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚</p><a id="more"></a><p>æ¥ä¸‹æ¥ï¼Œç»™å¤§å®¶ä»‹ç»çš„å°±æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œè¿™æ˜¯ä¸€ç§æ›´ä¼˜é›…çš„è§£å†³æ–¹æ³•ã€‚</p><h3 id="é€šè¿‡è‡ªåŠ¨åˆå¹¶å·¥å…·å®ç°å¤šé›†ç¾¤-kubeconfig-é…ç½®æ–‡ä»¶ç®¡ç†">é€šè¿‡è‡ªåŠ¨åˆå¹¶å·¥å…·å®ç°å¤šé›†ç¾¤ Kubeconfig é…ç½®æ–‡ä»¶ç®¡ç†</h3><p>æ—¢ç„¶æ‰‹åŠ¨åˆå¹¶å¤ªè¿‡éº»çƒ¦å’Œå¤æ‚ï¼Œæœ‰æ²¡æœ‰è‡ªåŠ¨åˆå¹¶å·¥å…·å‘¢ï¼Ÿä½ åˆ«è¯´ï¼Œè¿˜çœŸæœ‰ä¸”ä¸æ­¤ä¸€æ¬¾ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨è¿™å‡ æ¬¾å¥½ç”¨çš„è‡ªåŠ¨åˆå¹¶å·¥å…·ã€‚</p><h3 id="kubecm">KubeCM</h3><p><code>KubeCM</code> æ˜¯ä¸€æ¬¾ä½¿ç”¨ <code>Go</code> è¯­è¨€å¼€å‘çš„ <code>KubeConfig</code> ç®¡ç†å·¥å…·ï¼ŒåŠŸèƒ½éå¸¸çš„å¼ºå¤§ã€‚å®ƒä¸ä½†èƒ½å®ç°å¤šä¸ª <code>KubeConfig</code> æ–‡ä»¶çš„è‡ªåŠ¨åˆå¹¶ï¼Œè¿˜èƒ½å¾ˆæ–¹ä¾¿çš„ç®¡ç†å¤šä¸ª <code>Kubernetes</code> é›†ç¾¤ç¯å¢ƒï¼Œæ¯”å¦‚ï¼šå¢åŠ ã€åˆ é™¤ã€é‡å‘½åä¸åŒé›†ç¾¤ç¯å¢ƒç­‰ã€‚</p><ol><li>å®‰è£… KubeCM</li></ol><p><code>KubeCM</code> çš„å®‰è£…éå¸¸çš„ç®€å•ï¼Œä½ åªéœ€ç›´æ¥ä¸‹è½½ç›¸åº”å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶è§£å‹åå°±å¯ä½¿ç”¨äº†ï¼Œå®Œå…¨å°±æ˜¯å¼€ç®±å³ç”¨ã€‚</p><ul><li>é€šè¿‡äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># æ ¹æ®ä½ çš„å®é™…æƒ…å†µï¼Œä¸‹è½½å¯¹åº”å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚</span><br><span class="line"></span><br><span class="line"># Linux</span><br><span class="line">$ curl -Lo kubecm.tar.gz https:&#x2F;&#x2F;github.com&#x2F;sunny0826&#x2F;kubecm&#x2F;releases&#x2F;download&#x2F;v0.8.0&#x2F;kubecm_0.8.0_Linux_x86_64.tar.gz</span><br><span class="line"># macOS</span><br><span class="line">$ curl -Lo kubecm.tar.gz https:&#x2F;&#x2F;github.com&#x2F;sunny0826&#x2F;kubecm&#x2F;releases&#x2F;download&#x2F;v0.8.0&#x2F;kubecm_0.8.0_Darwin_x86_64.tar.gz</span><br><span class="line"># Windows</span><br><span class="line">$ curl -Lo kubecm.tar.gz https:&#x2F;&#x2F;github.com&#x2F;sunny0826&#x2F;kubecm&#x2F;releases&#x2F;download&#x2F;v0.8.0&#x2F;kubecm_0.8.0_Windows_x86_64.tar.gz</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåï¼Œè§£å‹å¯¹åº”å®‰è£…åŒ…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Linux &amp; macOS</span><br><span class="line">$ tar -zxvf kubecm.tar.gz kubecm</span><br><span class="line">$ sudo mv kubecm &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class="line"></span><br><span class="line"># Windows</span><br><span class="line"># ä½ å¯ä»¥ä½¿ç”¨åšä»»æ„ä¸€æ¬¾å‹ç¼©è½¯ä»¶è¿›è¡Œè§£å‹å¹¶æ”¾åˆ° $PATH ä¸­</span><br><span class="line">$ unzip kubecm.tar.gz</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…</li></ul><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <code>macOS</code>ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>Homebrew</code> æ¥è¿›è¡Œä¸€é”®å®‰è£…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install sunny0826&#x2F;tap&#x2F;kubecm</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨ KubeCM</li></ol><p>ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª <code>mike-kubeconfig</code> ç›®å½•å¹¶å°†å¤šä¸ªé›†ç¾¤é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°è¿™é‡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir mike-kubeconfig</span><br><span class="line">$ cp *.yaml mike-kubeconfig&#x2F;</span><br><span class="line">$ ls mike-kubeconfig</span><br><span class="line">dev-kubernetes.yaml   mike-local-kubernetes.yaml okteto-kube.yaml</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šä½ å¯èƒ½å‘ç°äº†ï¼Œæˆ‘è¿™é‡Œçš„ Kubeconfig é…ç½®æ–‡ä»¶éƒ½æ˜¯ä»¥ .yaml ç»“å°¾çš„ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿ Kubie è¿™ä¸ªå·¥å…·è¿›è¡Œå¤šé›†ç¾¤åˆ‡æ¢ã€‚ä½ åªéœ€æŒ‰è‡ªå·±ç¯å¢ƒçš„è§„åˆ™ç®¡ç† Kubeconfig æ–‡ä»¶å³å¯ã€‚</p></blockquote><ul><li>ä½¿ç”¨ KubeCM å®Œæˆè‡ªåŠ¨åˆå¹¶</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å°†æŒ‡å®šç›®å½•ä¸­çš„æ‰€æœ‰ kubeconfig é…ç½®æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ª</span><br><span class="line">$ kubecm merge -f mike-kubeconfig</span><br><span class="line">Loading kubeconfig file: [mike-kubeconfig&#x2F;dev-kubernetes.yaml mike-kubeconfig&#x2F;mike-local-kubernetes.yaml mike-kubeconfig&#x2F;okteto-kube.yaml]</span><br><span class="line">Context Add: dev-kubernetes</span><br><span class="line">Context Add: mike-local-kubernetes</span><br><span class="line">Context Add: okteto-kube</span><br><span class="line"></span><br><span class="line"># å°†æŒ‡å®šç›®å½•ä¸­çš„æ‰€æœ‰ kubeconfig é…ç½®æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªå¹¶ä¸”è¦†ç›–é»˜è®¤çš„ Kubeconfig é…ç½®æ–‡ä»¶</span><br><span class="line">$ kubecm merge -f mike-kubeconfig -c</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šæ˜¯å¦ä½¿ç”¨ -c å‚æ•°çš„åŒºåˆ«æ˜¯ï¼š-c å‚æ•°ç”Ÿæˆçš„åˆå¹¶åæ–‡ä»¶åä¸º .kube/configï¼Œè€Œä¸ä½¿ç”¨ -c å‚æ•°ç”Ÿæˆçš„åˆå¹¶åçš„æ–‡ä»¶åä¸º .kube/config.yamlã€‚</p></blockquote><ul><li>ä½¿ç”¨ KubeCM å¿«é€Ÿå¢åŠ ä¸€ä¸ªé›†ç¾¤é…ç½®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨ KubeCM å¿«é€Ÿå¢åŠ ä¸€ä¸ªé›†ç¾¤é…ç½®æ–‡ä»¶</span><br><span class="line">$ kubecm add -f mike-local-kubernetes.yaml</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ KubeCM å¿«é€Ÿå¢åŠ ä¸€ä¸ªé›†ç¾¤é…ç½®æ–‡ä»¶å¹¶æŒ‡å®šé»˜è®¤å‘½åç©ºé—´</span><br><span class="line">$ kubecm add -f mike-local-kubernetes.yaml -n test</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ KubeCM å¿«é€Ÿåˆ é™¤ä¸€ä¸ªé›†ç¾¤é…ç½®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># é€šè¿‡å‘½ä»¤è¡Œæ¨¡å¼åˆ é™¤ä¸€ä¸ªé›†ç¾¤é…ç½®</span><br><span class="line">$ kubecm delete mike-local-kubernetes</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ KubeCM å¿«é€Ÿé‡å‘½åä¸€ä¸ªé›†ç¾¤é…ç½®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å°† dev é‡å‘½åä¸º test</span><br><span class="line">$ kubecm rename -o dev -n test</span><br><span class="line"># å°†å½“å‰ä¸Šä¸‹æ–‡é‡å‘½åä¸º dev</span><br><span class="line">$ kubecm rename -n dev -c</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯ <code>KubeCM</code> çš„ä¸€äº›å‘½ä»¤è¡Œä¸‹çš„å¸¸è§„æ“ä½œï¼Œä¸ºäº†æ›´é«˜æ•ˆçš„ä½¿ç”¨å‘½ä»¤è¡Œã€‚<code>KubeCM</code> è¿˜æä¾›äº† <code>SHELL</code> è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œåªéœ€æŒ‰ä¸‹é¢çš„æ–¹æ³•ç®€å•è®¾ç½®ä¸€ä¸‹å³å¯ã€‚</p><ul><li>Bash</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubecm completion bash &gt; ~&#x2F;.kube&#x2F;kubecm.bash.inc</span><br><span class="line">$ printf &quot;</span><br><span class="line"># kubecm shell completion</span><br><span class="line">source &#39;$HOME&#x2F;.kube&#x2F;kubecm.bash.inc&#39;</span><br><span class="line">&quot; &gt;&gt; $HOME&#x2F;.bash_profile</span><br><span class="line">$ source $HOME&#x2F;.bash_profile</span><br></pre></td></tr></table></figure><ul><li>ZSH</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># add to $HOME&#x2F;.zshrc </span><br><span class="line">source &lt;(kubecm completion zsh)</span><br><span class="line"># or</span><br><span class="line">$ kubecm completion zsh &gt; &quot;$&#123;fpath[1]&#125;&#x2F;_kubecm&quot;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œä½ è‚¯å®šä»¥ä¸ºå°±è¯¥ç»“æŸäº†å§ï¼ä¸ï¼Œä½ é”™äº†ï¼Œ<code>KubeCM</code> ä¸ä»…æä¾›äº†å‘½ä»¤è¡Œæ¨¡å¼ï¼Œå®ƒè¿˜æä¾›æ›´åŠ äººæ€§åŒ–çš„äº¤äº’æ¨¡å¼ã€‚è¯ä¸å¤šè¯´ï¼Œç›´æ¥çœ‹å›¾ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/Kubecm-Interaction.gif" alt=""></p><p>è¿™æ ·æ“ä½œæ˜¯ä¸æ˜¯æ›´åŠ æ–¹ä¾¿äº†å‘¢ï¼Ÿé™¤æ­¤ä¹‹å¤–ï¼Œ<code>KubeCM</code> è¿˜æä¾›äº†å¿«é€Ÿåˆ‡æ¢é›†ç¾¤å’Œå‘½åç©ºé—´çš„åŠŸèƒ½å“Ÿï¼Œè¿™æ ·ä¸€æ¥ï¼Œä½ å®Œå…¨å¯ä»¥çœå»å®‰è£…æ–‡ç« å¼€å¤´æåˆ°çš„ <code>kubectx</code> æˆ– <code>kubie</code> è¿™ç±»é›†ç¾¤åˆ‡æ¢å·¥å…·äº†å‘¢ã€‚</p><ul><li>ä½¿ç”¨ KubeCM å¿«é€Ÿåˆ‡æ¢åˆ°ä¸åŒé›†ç¾¤ç¯å¢ƒ</li></ul><p><img src="https://www.hi-linux.com/img/linux/Kubecm-switch.gif" alt=""></p><ul><li>ä½¿ç”¨ KubeCM å¿«é€Ÿåˆ‡æ¢åˆ°é›†ç¾¤ä¸­çš„ä¸åŒå‘½åç©ºé—´</li></ul><p><img src="https://www.hi-linux.com/img/linux/Kubecm-ns.gif" alt=""></p><h3 id="kubectx-contexts-manager">Kubectx Contexts Manager</h3><p><code>Kubectx.Manager</code> å’Œ  <code>KubeCM</code> åŠŸèƒ½ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥å°†å¤šä¸ª <code>kubeconfig</code> é…ç½®æ–‡ä»¶è‡ªåŠ¨åˆå¹¶æˆä¸€ä¸ªç®¡ç†å·¥å…·ã€‚</p><p><code>Kubectx.Manager</code> ä½¿ç”¨ <code>Nodejs</code> å¼€å‘ã€‚åœ¨å®‰è£…å‰ï¼Œä½ å¿…é¡»å…ˆæœ‰ä¸€ä¸ª <code>Nodejs</code> ç¯å¢ƒã€‚<code>Nodejs</code> çš„å®‰è£…ä¹ŸæŒºç®€å•çš„ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®²äº†ï¼Œå¯è‡ªè¡Œ <code>Google</code>ã€‚</p><p><code>Nodejs</code> ç¯å¢ƒå®‰è£…å®Œæˆåï¼Œä½ åªéœ€è¿è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯å®Œæˆå®‰è£…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g git+https:&#x2F;&#x2F;git@github.com&#x2F;AveryanovS&#x2F;kubectx.manager</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;kubemanager -&gt; &#x2F;usr&#x2F;local&#x2F;lib&#x2F;node_modules&#x2F;kubectx.manager&#x2F;cli.js</span><br><span class="line">+ kubectx.manager@1.0.0</span><br><span class="line">added 4 packages from 6 contributors in 11.208s</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å°±æ¥æ¼”ç¤ºå¦‚ä½•åˆå¹¶å¤šä¸ª <code>kubeconfig</code> é…ç½®æ–‡ä»¶ã€‚<code>Kubectx.Manager</code> åŒæ ·ä¹Ÿæ˜¯æ”¯æŒäº¤äº’å¼æ“ä½œçš„ï¼Œä½ åªéœ€æ‰§è¡Œå‘½ä»¤ï¼Œç„¶åæ ¹æ®ä¸€ç³»åˆ—äº¤äº’åŠ¨ä½œçš„æç¤ºè¿›è¡Œæ“ä½œä¾¿å¯è½»æ¾å®Œæˆæ“ä½œã€‚</p><ol><li>ä½¿ç”¨ Kubectx.Manager è‡ªåŠ¨åˆå¹¶</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubemanager</span><br><span class="line">âœ” Select action Â· merge</span><br><span class="line">âœ” Path to current kube config? Â· &#x2F;Users&#x2F;Mike&#x2F;.kube&#x2F;config</span><br><span class="line">âœ” Path to config to merge? Â· &#x2F;Users&#x2F;Mike&#x2F;.kube&#x2F;mike-local-kubernetes.yaml</span><br><span class="line">âœ” Name of new context? Â· mike-local</span><br><span class="line">Context test created!</span><br><span class="line">Config file updated!</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬æ¥ç®€å•è¯´è¯´ä»¥ä¸Šå‡ æ­¥æ“ä½œçš„ä½œç”¨ã€‚</p><ul><li>ç¬¬ä¸€è¡Œé€‰æ‹© mergeï¼Œè¡¨ç¤ºåˆå¹¶ã€‚</li><li>ç¬¬äºŒè¡Œé€‰æ‹©éœ€è¦åˆå¹¶åˆ°å“ªä¸ª Kubeconfigï¼Œä¹Ÿå°±æ˜¯ä½ æœ€ç»ˆè¦ç”¨çš„ Kubeconfigã€‚</li><li>ç¬¬ä¸‰è¡Œé€‰æ‹©éœ€è¦åˆå¹¶çš„ Kubeconfigã€‚</li><li>ç¬¬å››è¡Œå®šä¹‰åˆå¹¶åæ–°åŠ å…¥çš„ Context åç§°ã€‚</li></ul><ol start="2"><li>ä½¿ç”¨ Kubectx.Manager åˆ é™¤æŒ‡å®šçš„é›†ç¾¤ç¯å¢ƒ</li></ol><p>åˆ é™¤æ“ä½œå’Œåˆå¹¶æ“ä½œç±»ä¼¼ï¼Œç›¸ä¿¡èªæ˜çš„ä½ ä¸€çœ‹å°±æ˜ç™½äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubemanager</span><br><span class="line">âœ” Select action Â· delete</span><br><span class="line">âœ” Path to current kube config? Â· &#x2F;Users&#x2F;Mike&#x2F;.kube&#x2F;config</span><br><span class="line">âœ” Select context to delete Â· mike-local</span><br><span class="line">Context mike-local deleted!</span><br><span class="line">Config file updated!</span><br></pre></td></tr></table></figure><p><code>Kubectx.Manager</code> ç›®å‰ä»…æ”¯æŒä»¥ä¸Šçš„ä¸¤ç§å¯¹ <code>Kubeconfig</code> æ–‡ä»¶çš„ç®¡ç†æ“ä½œï¼Œç›¸å¯¹äº <code>KubeCM</code> æ¥è¯´åŠŸèƒ½è¿˜æ˜¯ç›¸å¯¹äºå¼±ä¸€äº›ã€‚å®ƒå¹¶ä¸æ”¯æŒå¤šé›†ç¾¤å’Œå¤šå‘½åç©ºé—´çš„å¿«é€Ÿåˆ‡æ¢ã€‚å¦‚æœè¦å®ç°å¤šé›†ç¾¤å’Œå¤šå‘½åç©ºé—´çš„å¿«é€Ÿåˆ‡æ¢ï¼Œä½ è¿˜éœ€è¦ç»“åˆ <code>kubectx</code> æˆ– <code>kubie</code> è¿™ç±»å¿«é€Ÿé›†ç¾¤åˆ‡æ¢å·¥å…·ä¸€å¹¶ä½¿ç”¨å“Ÿ!</p><h3 id="mergekubeconfig">mergeKubeConfig</h3><p><code>mergeKubeConfig</code> æ˜¯ç”± <code>Python</code> å¼€å‘çš„ç±»ä¼¼çš„å·¥å…·ï¼Œå®ƒå’Œ <code>KubeCM</code> æ¥è‡ªåŒä¸€å¼€å‘è€…ã€‚ç›®å‰å·²åœæ­¢ç»´æŠ¤ï¼Œéƒ½æœ‰ <code>Go</code> ç‰ˆæœ¬äº†ï¼Œè¿˜è¦ä»€ä¹ˆè‡ªè¡Œè½¦å‘¢ï¼Ÿ</p><p>è¿™é‡Œé¡ºæ‰‹æä¸€ä¸‹çº¯ç²¹æ˜¯è®°å½•ä¸‹å®ƒæ›¾ç»å­˜åœ¨è¿‡ï¼Œå“ˆå“ˆï¼</p><p>å¥½äº†ï¼Œæœ¬æ–‡åˆ°æ­¤å°±ç»“æŸäº†ã€‚è¿™äº›ç¥å¥‡çš„å°å·¥å…·æ˜¯ä¸æ˜¯å¾ˆå¥½çš„è§£å†³äº†ä½ åœ¨ <code>Kubernetes</code> å¤šé›†ç¾¤ç®¡ç†ä¸­çš„ç—›ç‚¹å‘¢ï¼Ÿ</p><p>æœ€åï¼Œæ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé€‰ä¸€ä¸ªæœ€ç¬¦åˆä½ éœ€æ±‚çš„ä½¿ç”¨å§ã€‚è¿™æ—¶ï¼Œä½ å¯èƒ½ä¼šæƒŠå¥‡çš„å‘ç°æ–‡ä¸­å¹¶æ²¡æœ‰è¿™å‡ ä¸ªå°å·¥å…·çš„é¡¹ç›®åœ°å€ï¼</p><p>å“ˆå“ˆï¼Œæ˜¯æ—¶å€™æ”¯æŒä¸€æ³¢å…¬ä¼—å·äº†ï¼å¦‚éœ€ä»¥ä¸Šå°å·¥å…·é¡¹ç›®åœ°å€ï¼Œ<strong>è¯·åœ¨å…¬ä¼—å·å¯¹è¯æ¡†å†…å›å¤ ã€Œ<code>Kubeconfig</code>ã€ï¼Œå³å¯è·å–è¿™ä¸€ç³»åˆ—å°å·¥å…·çš„é¡¹ç›®ä¸‹è½½åœ°å€ã€‚</strong></p><h3 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h3><ol><li><p><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></p></li><li><p><a href="https://yq.aliyun.com/articles/695429" target="_blank" rel="noopener">https://yq.aliyun.com/articles/695429</a></p></li><li><p><a href="https://mp.weixin.qq.com/s/Sp37W-5C3YGSNf_H8HTuUA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Sp37W-5C3YGSNf_H8HTuUA</a></p></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;Kubernetes&lt;/code&gt; ç”Ÿæ€åœ¨å¾ˆå¤šä¼ä¸šå¹¿æ³›åº”ç”¨çš„å½“ä¸‹ï¼Œç›¸ä¿¡å¾ˆå¤šè¿ç»´å’Œå¼€å‘äººå‘˜éƒ½ä¼šåŒæ—¶ç®¡ç†å’Œç»´æŠ¤å¤šä¸ª &lt;code&gt;Kubernetes&lt;/code&gt; é›†ç¾¤ï¼Œæ¯”å¦‚ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€é¢„å‘å¸ƒç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿ç®¡ç†å¤šä¸ªç¯å¢ƒçš„é›†ç¾¤ï¼Œé€šå¸¸éƒ½æ˜¯åœ¨æœ¬åœ°ç¯å¢ƒé€šè¿‡ &lt;code&gt;Kubernetes&lt;/code&gt; çš„å®¢æˆ·ç«¯å·¥å…· &lt;code&gt;kubectl&lt;/code&gt; æ¥ç®¡ç†å¤šä¸ª &lt;code&gt;Kubernetes&lt;/code&gt; é›†ç¾¤çš„ã€‚è¿™æ—¶ä½ å°±éœ€è¦ç”¨åˆ°å„ä¸ªé›†ç¾¤çš„ &lt;code&gt;kubeconfig&lt;/code&gt; æ–‡ä»¶ï¼Œä½ æ˜¯ä¸æ˜¯é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æ‰‹åŠ¨å°†å¤šä¸ª &lt;code&gt;kubeconfig&lt;/code&gt; é…ç½®æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªï¼Œç„¶åé€šè¿‡ &lt;code&gt;kubectx&lt;/code&gt; æˆ– &lt;code&gt;kubie&lt;/code&gt; è¿™æ ·çš„å·¥å…·æ¥å¿«é€Ÿåˆ‡æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆcontextï¼‰æ¥è¾¾åˆ°å¤šé›†ç¾¤ç¯å¢ƒçš„ç®¡ç†å‘¢ï¼Ÿè™½ç„¶æ‰‹åŠ¨åˆå¹¶ &lt;code&gt;kubeconfig&lt;/code&gt; é…ç½®æ–‡ä»¶çš„æ–¹æ³•æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯é›†ç¾¤ç¯å¢ƒè¾ƒå¤šæ—¶æˆ–è€…é›†ç¾¤ç¯å¢ƒç»å¸¸å˜æ›´æ—¶ï¼Œè¿™æ ·çš„æ–¹æ³•å°±æ˜¾å¾—å¾ˆéº»çƒ¦äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ç»™å¤§å®¶ä»‹ç»å‡ ç§æ›´æ–¹ä¾¿æ›´å¿«æ·çš„ &lt;code&gt;Kubernetes&lt;/code&gt; å¤šé›†ç¾¤ç®¡ç†æ–¹æ³•ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹å®˜æ–¹æä¾›çš„å®ç°æ–¹å¼ï¼š&lt;/p&gt;
&lt;h3 id=&quot;å®˜æ–¹æä¾›çš„è§£å†³æ–¹æ³•&quot;&gt;å®˜æ–¹æä¾›çš„è§£å†³æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;å®˜æ–¹ç›®å‰æä¾›äº†é…ç½®ç¯å¢ƒå˜é‡å’Œé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ˜¾ç¤ºæŒ‡å®šä¸¤ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é…ç½®ç¯å¢ƒå˜é‡æŒ‡å®šå¤šä¸ªé›†ç¾¤çš„ kubeconfig æ–‡ä»¶&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# é…ç½® Kubernetes å¤šé›†ç¾¤ï¼Œæ³¨æ„ä½¿ç”¨ : éš”å¼€&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;export KUBECONFIG&amp;#x3D;$KUBECONFIG:$HOME&amp;#x2F;.kube&amp;#x2F;config:$HOME&amp;#x2F;.kube&amp;#x2F;mike-local-kubernetes.yaml:$HOME&amp;#x2F;.kube&amp;#x2F;dev-kubernetes.yaml:$HOME&amp;#x2F;.kube&amp;#x2F;test-kubernetes.yaml:$HOME&amp;#x2F;.kube&amp;#x2F;prod-kubernetes.yaml:$HOME&amp;#x2F;.kube&amp;#x2F;okteto-kube.yaml&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ˜¾ç¤ºæŒ‡å®šä¸åŒé›†ç¾¤çš„ kubeconfig æ–‡ä»¶&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# åˆ‡æ¢åˆ°æœ¬åœ°é›†ç¾¤&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kubectl get pod --kubeconfig&amp;#x3D;$HOME&amp;#x2F;.kube&amp;#x2F;mike-local-kubernetes.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# åˆ‡æ¢åˆ°å¼€å‘é›†ç¾¤&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kubectl get pod --kubeconfig&amp;#x3D;$HOME&amp;#x2F;.kube&amp;#x2F;dev-kubernetes.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# åˆ‡æ¢åˆ°æµ‹è¯•é›†ç¾¤&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kubectl get pod --kubeconfig&amp;#x3D;$HOME&amp;#x2F;.kube&amp;#x2F;test-kubernetes.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# åˆ‡æ¢åˆ°ç”Ÿäº§é›†ç¾¤&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kubectl get pod --kubeconfig&amp;#x3D;$HOME&amp;#x2F;.kube&amp;#x2F;prod-kubernetes.yaml&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è™½ç„¶å®˜æ–¹æä¾›çš„æ–¹æ³•ï¼Œèƒ½å®ç°å¤šé›†ç¾¤ç®¡ç†ã€‚ä½†æ˜¯ä¸æ–­æ¥å›åˆ‡æ¢ &lt;code&gt;kubeconfig&lt;/code&gt; é…ç½®æ–‡ä»¶æˆ–è€…ç»å¸¸æ‰‹åŠ¨ç¼–è¾‘ç¯å¢ƒå˜é‡æ¥å¢å‡å¤šä¸ªé›†ç¾¤çš„é…ç½®æ–‡ä»¶ï¼Œæ˜¾ç„¶è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>æ¨è 3 æ¬¾è¶…å¥½ç”¨çš„ Docker å›¾å½¢åŒ–ç®¡ç†å·¥å…·</title>
    <link href="https://www.hi-linux.com/posts/279.html"/>
    <id>https://www.hi-linux.com/posts/279.html</id>
    <published>2020-07-17T01:00:00.000Z</published>
    <updated>2020-07-17T03:54:56.828Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>Docker æ˜¯ä¸€é¡¹éå¸¸æµè¡Œçš„å®¹å™¨æŠ€æœ¯ï¼Œç°åœ¨åœ¨å„è¡Œå„ä¸šæœ‰ç€å¹¿æ³›çš„ä½¿ç”¨ã€‚ä¸è¿‡å¦‚ä½•ç®¡ç† Docker å®¹å™¨æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©å‘å¤§å®¶ä»‹ç» 3 æ¬¾ Docker å¯è§†åŒ–å·¥å…·ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚</p><h3 id="portainer">Portainer</h3><p>Portainer æ˜¯ä¸€æ¬¾ Docker å¯è§†åŒ–ç®¡ç†å·¥å…·ï¼Œå…è®¸æˆ‘ä»¬åœ¨ç½‘é¡µä¸­æ–¹ä¾¿çš„æŸ¥çœ‹å’Œç®¡ç† Docker å®¹å™¨ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://www.portainer.io/" target="_blank" rel="noopener">https://www.portainer.io/</a></p><p><img src="https://www.hi-linux.com/img/linux/portainer-1.jpeg" alt=""></p><p>è¦ä½¿ç”¨ Portainer å¾ˆç®€å•ï¼Œè¿è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤å³å¯ã€‚è¿™äº›å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ª Portainer ä¸“ç”¨çš„å·ï¼Œç„¶ååœ¨ 8000 å’Œ 9000 ç«¯å£åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume create portainer_data</span><br><span class="line">$ docker run --name portainer -d -p 8000:8000 -p 9000:9000 -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock -v portainer_data:&#x2F;data portainer&#x2F;portainer</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æµè§ˆå™¨æ‰“å¼€å¯¹åº”åœ°å€ï¼Œå°±ä¼šå‘ç°æˆåŠŸè¿è¡Œäº†ã€‚ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™éœ€è¦è®¾ç½®è´¦å·ï¼Œç„¶åé€‰æ‹©è¦ç®¡ç†çš„ Docker ä¸»æœºã€‚</p><p><img src="https://www.hi-linux.com/img/linux/portainer-2.jpeg" alt=""></p><p>è®¾ç½®è´¦å·</p><p><img src="https://www.hi-linux.com/img/linux/portainer-3.jpeg" alt=""></p><p>é€‰æ‹©è¦ç®¡ç†çš„ä¸»æœº</p><p>ä¹‹åå°±å¯ä»¥çœ‹åˆ°æœ¬æœºä¸Šè¿è¡Œçš„ Docker å®¹å™¨äº†ï¼Œç‚¹å‡»å®ƒä»¬è¿˜å¯ä»¥è¿›è¡Œå®¹å™¨çš„ç®¡ç†ã€‚å·¦è¾¹çš„æ¡ç›®å¯ä»¥ç®¡ç†å·ã€åˆ›å»ºå®¹å™¨ã€æŸ¥çœ‹ä¸»æœºä¿¡æ¯ç­‰ç­‰ã€‚åŸºæœ¬ä¸Šè¯¥æœ‰çš„åŠŸèƒ½éƒ½æœ‰äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ¨èçš„ä¸€ä¸ªå·¥å…·ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/portainer-4.jpeg" alt=""></p><a id="more"></a><h3 id="lazydocker">LazyDocker</h3><p>LazyDocker æ˜¯åŸºäºç»ˆç«¯çš„ä¸€ä¸ªå¯è§†åŒ–æŸ¥è¯¢å·¥å…·ï¼Œæ”¯æŒé”®ç›˜æ“ä½œå’Œé¼ æ ‡ç‚¹å‡»ã€‚ç›¸æ¯” Portainer æ¥è¯´å¯èƒ½ä¸é‚£ä¹ˆä¸“ä¸šï¼Œä¸è¿‡å¯¹äºå¼€å‘è€…æ¥è¯´å¯èƒ½åè€Œæ›´åŠ å¥½ç”¨äº†ã€‚å› ä¸ºä¸€èˆ¬å¼€å‘è€…éƒ½æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œæ¥è¿è¡Œ Dockerï¼Œå¶å°”éœ€è¦å›¾å½¢åŒ–æŸ¥çœ‹çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨ LazyDocker è¿™ä¸ªå·¥å…·ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/jesseduffield/lazydocker" target="_blank" rel="noopener">https://github.com/jesseduffield/lazydocker</a></p><p><img src="https://www.hi-linux.com/img/linux/lazydocker-1.gif" alt=""></p><p>å®˜ç½‘æ¼”ç¤ºå›¾</p><p>å®‰è£… LazyDocker ä¹Ÿéå¸¸ç®€å•ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm -it -v \</span><br><span class="line">&#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock \</span><br><span class="line">-v ~&#x2F;.config&#x2F;lazydocker:&#x2F;.config&#x2F;jesseduffield&#x2F;lazydocker \</span><br><span class="line">lazyteam&#x2F;lazydocker</span><br></pre></td></tr></table></figure><p>å½“ç„¶å¦‚æœå‘ç° LazyDocker æŒºå¥½ç”¨ï¼Œå‡†å¤‡ç»å¸¸ä½¿ç”¨çš„è¯ï¼Œè¿˜å¯ä»¥æŠŠå®ƒåšæˆç¼©å†™æ·»åŠ åˆ° Shell é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å°†å®ƒå˜æˆä¸€ä¸ªç®€å•çš„å‘½ä»¤ã€‚</p><p>ä¾‹å¦‚æˆ‘ç”¨çš„æ˜¯ zshï¼Œå°±å°†ä¸‹é¢è¿™æ ·æ·»åŠ åˆ° .zshrc æ–‡ä»¶ä¸­ã€‚ä»¥åå°±å¯ä»¥ç›´æ¥ç”¨ lzd æ¥ è°ƒç”¨ LazyDocker äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias lzd&#x3D;&#39;docker run --rm -it -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock -v ~&#x2F;.config&#x2F;lazydocker:&#x2F;.config&#x2F;jesseduffield&#x2F;lazydocker lazyteam&#x2F;lazydocker&#39;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹ Docker å®¹å™¨ã€é•œåƒå’Œå·çš„ä¿¡æ¯äº†ã€‚</p><p>LazyDocker æ”¯æŒé”®ç›˜æ“ä½œå’Œé¼ æ ‡ç‚¹å‡»ï¼Œç›´æ¥ç”¨é¼ æ ‡ç‚¹å‡»å°±å¯ä»¥æŸ¥çœ‹å¯¹åº”ä¿¡æ¯äº†ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/lazydocker-2.jpeg" alt=""></p><p>éœ€è¦æ³¨æ„å¦‚æœä½ çš„ç»ˆç«¯ LazyDocker çš„å›¾å½¢æ˜¾ç¤ºçš„æ˜¯ä¹±çš„ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œåªä¸è¿‡æ˜¯æ˜¾ç¤ºå­—ä½“çš„é—®é¢˜ã€‚é‡æ–°è®¾ç½®ä¸€ä¸‹ç»ˆç«¯å­—ä½“å°±å¯ä»¥è§£å†³äº†ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/lazydocker-3.jpeg" alt=""></p><h3 id="docui">Docui</h3><p>Docui åŒæ ·æ˜¯ä¸€ä¸ªå¼€æºçš„ç»ˆç«¯ Docker ç®¡ç†å·¥å…·ï¼Œå½¢å¼ä¸ Lazydocker ä¸€æ ·ï¼Œä¹Ÿæ˜¯ ç»ˆç«¯ UI çš„å½¢å¼ã€‚</p><p>Docui å’Œ Lazydocker å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ä¼˜åŠ¿ï¼Œå°±æ˜¯æ”¯æŒå¤§é‡çš„å¿«æ·é”®ï¼Œç†Ÿç»ƒåä¼šæå…¶ä¾¿åˆ©ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/skanehira/docui" target="_blank" rel="noopener">https://github.com/skanehira/docui</a></p><p><img src="https://www.hi-linux.com/img/linux/docui.jpeg" alt=""></p><p>Docui å®‰è£…ä¹Ÿæ˜¯å¾ˆç®€å•çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># é€šè¿‡æºç å®‰è£…</span><br><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;skanehira&#x2F;docui.git</span><br><span class="line">$ cd docui&#x2F;</span><br><span class="line">$ GO111MODULE&#x3D;on go install</span><br><span class="line"></span><br><span class="line"># macOS å¯èƒ½é€šè¿‡ Homebrew å®‰è£…</span><br><span class="line">$ brew tap skanehira&#x2F;docui</span><br><span class="line">$ brew install docui</span><br></pre></td></tr></table></figure><h3 id="å°ç»“">å°ç»“</h3><p>å¦‚æœä½ æ˜¯å›¢é˜Ÿä½¿ç”¨ï¼ŒPortainer ä¼šæ¯”è¾ƒé€‚åˆï¼Œå› ä¸ºå®ƒæœ‰è®¿é—®æ§åˆ¶ã€‚</p><p>Lazydocker å’Œ Docui éƒ½å±äºç®€å•çµæ´»çš„ç»ˆç«¯å°å·¥å…·ï¼Œå¦‚æœä½ ä¸éœ€è¦å¤æ‚çš„åŠŸèƒ½ï¼Œæˆ–è®¸å®ƒä»¬ä¼šæ›´é€‚åˆä½ ã€‚</p><p>Docker æœ‰å¾ˆå¤šå…è´¹çš„å¥½ç”¨ä¸‰æ–¹å®¢æˆ·ç«¯å·¥å…·ï¼Œä¸Šé¢åªæ˜¯å…¶ä¸­çš„ä¸€äº›ï¼Œå…·ä½“å“ªä¸€æ¬¾æ›´é€‚åˆä½ ï¼Œè¿˜éœ€è¦è‡ªè¡Œè¯•ç”¨äº†è§£åæ ¹æ®å®é™…éœ€æ±‚æ¥é€‰æ‹©æœ€é€‚åˆçš„ã€‚</p><h3 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h3><ol><li><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></li><li><a href="https://www.toutiao.com/i6780014313227682316/" target="_blank" rel="noopener">https://www.toutiao.com/i6780014313227682316/</a></li><li><a href="https://mp.weixin.qq.com/s/sbnFeAk0NvkG-3ahq6lUfg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/sbnFeAk0NvkG-3ahq6lUfg</a></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Docker æ˜¯ä¸€é¡¹éå¸¸æµè¡Œçš„å®¹å™¨æŠ€æœ¯ï¼Œç°åœ¨åœ¨å„è¡Œå„ä¸šæœ‰ç€å¹¿æ³›çš„ä½¿ç”¨ã€‚ä¸è¿‡å¦‚ä½•ç®¡ç† Docker å®¹å™¨æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©å‘å¤§å®¶ä»‹ç» 3 æ¬¾ Docker å¯è§†åŒ–å·¥å…·ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h3 id=&quot;Portainer&quot;&gt;Portainer&lt;/h3&gt;
&lt;p&gt;Portainer æ˜¯ä¸€æ¬¾ Docker å¯è§†åŒ–ç®¡ç†å·¥å…·ï¼Œå…è®¸æˆ‘ä»¬åœ¨ç½‘é¡µä¸­æ–¹ä¾¿çš„æŸ¥çœ‹å’Œç®¡ç† Docker å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&quot;https://www.portainer.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.portainer.io/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/portainer-1.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¦ä½¿ç”¨ Portainer å¾ˆç®€å•ï¼Œè¿è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤å³å¯ã€‚è¿™äº›å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ª Portainer ä¸“ç”¨çš„å·ï¼Œç„¶ååœ¨ 8000 å’Œ 9000 ç«¯å£åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ docker volume create portainer_data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ docker run --name portainer -d -p 8000:8000 -p 9000:9000 -v &amp;#x2F;var&amp;#x2F;run&amp;#x2F;docker.sock:&amp;#x2F;var&amp;#x2F;run&amp;#x2F;docker.sock -v portainer_data:&amp;#x2F;data portainer&amp;#x2F;portainer&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååœ¨æµè§ˆå™¨æ‰“å¼€å¯¹åº”åœ°å€ï¼Œå°±ä¼šå‘ç°æˆåŠŸè¿è¡Œäº†ã€‚ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™éœ€è¦è®¾ç½®è´¦å·ï¼Œç„¶åé€‰æ‹©è¦ç®¡ç†çš„ Docker ä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/portainer-2.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;è®¾ç½®è´¦å·&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/portainer-3.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©è¦ç®¡ç†çš„ä¸»æœº&lt;/p&gt;
&lt;p&gt;ä¹‹åå°±å¯ä»¥çœ‹åˆ°æœ¬æœºä¸Šè¿è¡Œçš„ Docker å®¹å™¨äº†ï¼Œç‚¹å‡»å®ƒä»¬è¿˜å¯ä»¥è¿›è¡Œå®¹å™¨çš„ç®¡ç†ã€‚å·¦è¾¹çš„æ¡ç›®å¯ä»¥ç®¡ç†å·ã€åˆ›å»ºå®¹å™¨ã€æŸ¥çœ‹ä¸»æœºä¿¡æ¯ç­‰ç­‰ã€‚åŸºæœ¬ä¸Šè¯¥æœ‰çš„åŠŸèƒ½éƒ½æœ‰äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ¨èçš„ä¸€ä¸ªå·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/portainer-4.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://www.hi-linux.com/categories/docker/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>SSH è¯ä¹¦ç™»å½•æ•™ç¨‹</title>
    <link href="https://www.hi-linux.com/posts/5424.html"/>
    <id>https://www.hi-linux.com/posts/5424.html</id>
    <published>2020-07-09T01:00:00.000Z</published>
    <updated>2020-07-09T06:04:42.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>SSH æ˜¯æœåŠ¡å™¨ç™»å½•å·¥å…·ï¼Œæä¾›å¯†ç ç™»å½•å’Œå¯†é’¥ç™»å½•ã€‚</p><p>ä½†æ˜¯ï¼ŒSSH è¿˜æœ‰ç¬¬ä¸‰ç§ç™»å½•æ–¹æ³•ï¼Œé‚£å°±æ˜¯è¯ä¹¦ç™»å½•ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æ›´åˆç†ã€æ›´å®‰å…¨çš„ç™»å½•æ–¹æ³•ï¼Œæœ¬æ–‡å°±ä»‹ç»è¿™ç§ç™»å½•æ–¹æ³•ã€‚</p><h2 id="ä¸€-éè¯ä¹¦ç™»å½•çš„ç¼ºç‚¹">ä¸€ã€éè¯ä¹¦ç™»å½•çš„ç¼ºç‚¹</h2><p>å¯†ç ç™»å½•å’Œå¯†é’¥ç™»å½•ï¼Œéƒ½æœ‰å„è‡ªçš„ç¼ºç‚¹ã€‚</p><p>å¯†ç ç™»å½•éœ€è¦è¾“å…¥æœåŠ¡å™¨å¯†ç ï¼Œè¿™éå¸¸éº»çƒ¦ï¼Œä¹Ÿä¸å®‰å…¨ï¼Œå­˜åœ¨è¢«æš´åŠ›ç ´è§£çš„é£é™©ã€‚</p><p>å¯†é’¥ç™»å½•éœ€è¦æœåŠ¡å™¨ä¿å­˜ç”¨æˆ·çš„å…¬é’¥ï¼Œä¹Ÿéœ€è¦ç”¨æˆ·ä¿å­˜æœåŠ¡å™¨å…¬é’¥çš„æŒ‡çº¹ã€‚è¿™å¯¹äºå¤šç”¨æˆ·ã€å¤šæœåŠ¡å™¨çš„å¤§å‹æœºæ„å¾ˆä¸æ–¹ä¾¿ï¼Œå¦‚æœæœ‰å‘˜å·¥ç¦»èŒï¼Œéœ€è¦å°†ä»–çš„å…¬é’¥ä»æ¯å°æœåŠ¡å™¨åˆ é™¤ã€‚</p><h2 id="äºŒ-è¯ä¹¦ç™»å½•æ˜¯ä»€ä¹ˆ">äºŒã€è¯ä¹¦ç™»å½•æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>è¯ä¹¦ç™»å½•å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢çš„ç¼ºç‚¹è€Œè®¾è®¡çš„ã€‚å®ƒå¼•å…¥äº†ä¸€ä¸ªè¯ä¹¦é¢å‘æœºæ„ï¼ˆCertificate1 authorityï¼Œç®€ç§° CAï¼‰ï¼Œå¯¹ä¿¡ä»»çš„æœåŠ¡å™¨é¢å‘æœåŠ¡å™¨è¯ä¹¦ï¼Œå¯¹ä¿¡ä»»çš„ç”¨æˆ·é¢å‘ç”¨æˆ·è¯ä¹¦ã€‚</p><p>ç™»å½•æ—¶ï¼Œç”¨æˆ·å’ŒæœåŠ¡å™¨ä¸éœ€è¦æå‰çŸ¥é“å½¼æ­¤çš„å…¬é’¥ï¼Œåªéœ€è¦äº¤æ¢å„è‡ªçš„è¯ä¹¦ï¼ŒéªŒè¯æ˜¯å¦å¯ä¿¡å³å¯ã€‚</p><p>è¯ä¹¦ç™»å½•çš„ä¸»è¦ä¼˜ç‚¹æœ‰ä¸¤ä¸ªï¼šï¼ˆ1ï¼‰ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¸ç”¨äº¤æ¢å…¬é’¥ï¼Œè¿™æ›´å®¹æ˜“ç®¡ç†ï¼Œä¹Ÿå…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚ï¼ˆ2ï¼‰è¯ä¹¦å¯ä»¥è®¾ç½®åˆ°æœŸæ—¶é—´ï¼Œè€Œå…¬é’¥æ²¡æœ‰åˆ°æœŸæ—¶é—´ã€‚é’ˆå¯¹ä¸åŒçš„æƒ…å†µï¼Œå¯ä»¥è®¾ç½®æœ‰æ•ˆæœŸå¾ˆçŸ­çš„è¯ä¹¦ï¼Œè¿›ä¸€æ­¥æé«˜å®‰å…¨æ€§ã€‚</p><a id="more"></a><h2 id="ä¸‰-è¯ä¹¦ç™»å½•çš„æµç¨‹">ä¸‰ã€è¯ä¹¦ç™»å½•çš„æµç¨‹</h2><p>SSH è¯ä¹¦ç™»å½•ä¹‹å‰ï¼Œå¦‚æœè¿˜æ²¡æœ‰è¯ä¹¦ï¼Œéœ€è¦ç”Ÿæˆè¯ä¹¦ã€‚å…·ä½“æ–¹æ³•æ˜¯ï¼šï¼ˆ1ï¼‰ç”¨æˆ·å’ŒæœåŠ¡å™¨éƒ½å°†è‡ªå·±çš„å…¬é’¥ï¼Œå‘ç»™ CAï¼›ï¼ˆ2ï¼‰CA ä½¿ç”¨æœåŠ¡å™¨å…¬é’¥ï¼Œç”ŸæˆæœåŠ¡å™¨è¯ä¹¦ï¼Œå‘ç»™æœåŠ¡å™¨ï¼›ï¼ˆ3ï¼‰CA ä½¿ç”¨ç”¨æˆ·çš„å…¬é’¥ï¼Œç”Ÿæˆç”¨æˆ·è¯ä¹¦ï¼Œå‘ç»™ç”¨æˆ·ã€‚</p><p>æœ‰äº†è¯ä¹¦ä»¥åï¼Œç”¨æˆ·å°±å¯ä»¥ç™»å½•æœåŠ¡å™¨äº†ã€‚æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯ SSH è‡ªåŠ¨å¤„ç†ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œç”¨æˆ·ç™»å½•æœåŠ¡å™¨æ—¶ï¼ŒSSH è‡ªåŠ¨å°†ç”¨æˆ·è¯ä¹¦å‘ç»™æœåŠ¡å™¨ã€‚</p><p>ç¬¬äºŒæ­¥ï¼ŒæœåŠ¡å™¨æ£€æŸ¥ç”¨æˆ·è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼Œä»¥åŠæ˜¯å¦ç”±å¯ä¿¡çš„ CA é¢å‘ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼ŒSSH è‡ªåŠ¨å°†æœåŠ¡å™¨è¯ä¹¦å‘ç»™ç”¨æˆ·ã€‚</p><p>ç¬¬å››æ­¥ï¼Œç”¨æˆ·æ£€æŸ¥æœåŠ¡å™¨è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼Œä»¥åŠæ˜¯å¦ç”±ä¿¡ä»»çš„ CA é¢å‘ã€‚</p><p>ç¬¬äº”æ­¥ï¼ŒåŒæ–¹å»ºç«‹è¿æ¥ï¼ŒæœåŠ¡å™¨å…è®¸ç”¨æˆ·ç™»å½•ã€‚</p><h2 id="å››-ç”Ÿæˆ-ca-çš„å¯†é’¥">å››ã€ç”Ÿæˆ CA çš„å¯†é’¥</h2><p>è¯ä¹¦ç™»å½•çš„å‰ææ˜¯ï¼Œå¿…é¡»æœ‰ä¸€ä¸ª CAï¼Œè€Œ CA æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¯¹å¯†é’¥ï¼Œè·Ÿå…¶ä»–å¯†é’¥æ²¡æœ‰ä¸åŒï¼ŒCA å°±ç”¨è¿™å¯¹å¯†é’¥å»ç­¾å‘è¯ä¹¦ã€‚</p><p>è™½ç„¶ CA å¯ä»¥ç”¨åŒä¸€å¯¹å¯†ç ç­¾å‘ç”¨æˆ·è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦ï¼Œä½†æ˜¯å‡ºäºå®‰å…¨æ€§å’Œçµæ´»æ€§ï¼Œæœ€å¥½ç”¨ä¸åŒçš„å¯†é’¥åˆ†åˆ«ç­¾å‘ã€‚æ‰€ä»¥ï¼ŒCA è‡³å°‘éœ€è¦ä¸¤å¯¹å¯†é’¥ï¼Œä¸€å¯¹æ˜¯ç­¾å‘ç”¨æˆ·è¯ä¹¦çš„å¯†é’¥ï¼Œå‡è®¾å«åš user_caï¼Œå¦ä¸€å¯¹æ˜¯ç­¾å‘æœåŠ¡å™¨è¯ä¹¦çš„å¯†é’¥ï¼Œå‡è®¾å«åš host_caã€‚</p><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œç”Ÿæˆ user_caã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ç”Ÿæˆ CA ç­¾å‘ç”¨æˆ·è¯ä¹¦çš„å¯†é’¥</span><br><span class="line">$ ssh-keygen -t rsa -b 4096 -f ~&#x2F;.ssh&#x2F;user_ca -C user_ca</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šåœ¨ ~/.ssh ç›®å½•ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼šuser_caï¼ˆç§é’¥ï¼‰å’Œ user_ca.pubï¼ˆå…¬é’¥ï¼‰ã€‚</p><p>è¿™ä¸ªå‘½ä»¤çš„å„ä¸ªå‚æ•°å«ä¹‰å¦‚ä¸‹ã€‚</p><ul><li>-t rsaï¼šæŒ‡å®šå¯†é’¥ç®—æ³• RSAã€‚</li><li>-b 4096ï¼šæŒ‡å®šå¯†é’¥çš„ä½æ•°æ˜¯4096ä½ã€‚å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„åœºåˆï¼Œè¿™ä¸ªå€¼å¯ä»¥å°ä¸€ç‚¹ï¼Œä½†æ˜¯ä¸åº”å°äº1024ã€‚</li><li>-f ~/.ssh/user_caï¼šæŒ‡å®šç”Ÿæˆå¯†é’¥çš„ä½ç½®å’Œæ–‡ä»¶åã€‚</li><li>-C user_caï¼šæŒ‡å®šå¯†é’¥çš„è¯†åˆ«å­—ç¬¦ä¸²ï¼Œç›¸å½“äºæ³¨é‡Šï¼Œå¯ä»¥éšæ„è®¾ç½®ã€‚</li></ul><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œç”Ÿæˆ host_caã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ç”Ÿæˆ CA ç­¾å‘æœåŠ¡å™¨è¯ä¹¦çš„å¯†é’¥</span><br><span class="line">$ ssh-keygen -t rsa -b 4096 -f host_ca -C host_ca</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šåœ¨~/.sshç›®å½•ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼šhost_caï¼ˆç§é’¥ï¼‰å’Œ host_ca.pubï¼ˆå…¬é’¥ï¼‰ã€‚</p><p>ç°åœ¨ï¼Œ~/.ssh ç›®å½•åº”è¯¥è‡³å°‘æœ‰å››æŠŠå¯†é’¥ã€‚</p><ul><li>~/.ssh/user_ca</li><li>~/.ssh/user_ca.pub</li><li>~/.ssh/host_ca</li><li>~/.ssh/host_ca.pub</li></ul><h2 id="äº”-ca-ç­¾å‘æœåŠ¡å™¨è¯ä¹¦">äº”ã€CA ç­¾å‘æœåŠ¡å™¨è¯ä¹¦</h2><p>æœ‰äº† CA ä»¥åï¼Œå°±å¯ä»¥ç­¾å‘æœåŠ¡å™¨è¯ä¹¦äº†ã€‚</p><p>ç­¾å‘è¯ä¹¦ï¼Œé™¤äº† CA çš„å¯†é’¥ä»¥å¤–ï¼Œè¿˜éœ€è¦æœåŠ¡å™¨çš„å…¬é’¥ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒSSH æœåŠ¡å™¨ï¼ˆé€šå¸¸æ˜¯sshdï¼‰å®‰è£…æ—¶ï¼Œå·²ç»ç”Ÿæˆå¯†é’¥ /etc/ssh/ssh_host_rsa_key äº†ã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ssh-keygen -f &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key -b 4096 -t rsa</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤ä¼šåœ¨ /etc/ssh ç›®å½•ï¼Œç”Ÿæˆ ssh_host_rsa_keyï¼ˆç§é’¥ï¼‰å’Œ ssh_host_rsa_key.pubï¼ˆå…¬é’¥ï¼‰ã€‚ç„¶åï¼Œéœ€è¦æŠŠæœåŠ¡å™¨å…¬é’¥ ssh_host_rsa_key.pubï¼Œå¤åˆ¶æˆ–ä¸Šä¼ åˆ° CA æ‰€åœ¨çš„æœåŠ¡å™¨ã€‚</p><p>ä¸Šä¼ ä»¥åï¼ŒCA å°±å¯ä»¥ä½¿ç”¨å¯†é’¥ host_ca ä¸ºæœåŠ¡å™¨çš„å…¬é’¥ ssh_host_rsa_key.pub ç­¾å‘æœåŠ¡å™¨è¯ä¹¦ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -s host_ca -I host.example.com -h -n host.example.com -V +52w ssh_host_rsa_key.pub</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šç”ŸæˆæœåŠ¡å™¨è¯ä¹¦ ssh_host_rsa_key-cert.pubï¼ˆæœåŠ¡å™¨å…¬é’¥åå­—åŠ åç¼€-certï¼‰ã€‚è¿™ä¸ªå‘½ä»¤å„ä¸ªå‚æ•°çš„å«ä¹‰å¦‚ä¸‹ã€‚</p><ul><li>-sï¼šæŒ‡å®š CA ç­¾å‘è¯ä¹¦çš„å¯†é’¥ã€‚</li><li>-Iï¼šèº«ä»½å­—ç¬¦ä¸²ï¼Œå¯ä»¥éšä¾¿è®¾ç½®ï¼Œç›¸å½“äºæ³¨é‡Šï¼Œæ–¹ä¾¿åŒºåˆ†è¯ä¹¦ï¼Œå°†æ¥å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²æ’¤é”€è¯ä¹¦ã€‚</li><li>-hï¼šæŒ‡å®šè¯¥è¯ä¹¦æ˜¯æœåŠ¡å™¨è¯ä¹¦ï¼Œè€Œä¸æ˜¯ç”¨æˆ·è¯ä¹¦ã€‚</li><li>-n <a href="http://host.example.com" target="_blank" rel="noopener">host.example.com</a>ï¼šæŒ‡å®šæœåŠ¡å™¨çš„åŸŸåï¼Œè¡¨ç¤ºè¯ä¹¦ä»…å¯¹è¯¥åŸŸåæœ‰æ•ˆã€‚å¦‚æœæœ‰å¤šä¸ªåŸŸåï¼Œåˆ™ä½¿ç”¨é€—å·åˆ†éš”ã€‚ç”¨æˆ·ç™»å½•è¯¥åŸŸåæœåŠ¡å™¨æ—¶ï¼ŒSSH é€šè¿‡è¯ä¹¦çš„è¿™ä¸ªå€¼ï¼Œåˆ†è¾¨åº”è¯¥ä½¿ç”¨å“ªå¼ è¯ä¹¦å‘ç»™ç”¨æˆ·ï¼Œç”¨æ¥è¯æ˜æœåŠ¡å™¨çš„å¯ä¿¡æ€§ã€‚</li><li>-V +52wï¼šæŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œè¿™é‡Œä¸º 52 å‘¨ï¼ˆä¸€å¹´ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯ä¹¦æ˜¯æ°¸è¿œæœ‰æ•ˆçš„ã€‚å»ºè®®ä½¿ç”¨è¯¥å‚æ•°æŒ‡å®šæœ‰æ•ˆæœŸï¼Œå¹¶ä¸”æœ‰æ•ˆæœŸæœ€å¥½çŸ­ä¸€ç‚¹ï¼Œæœ€é•¿ä¸è¶…è¿‡ 52 å‘¨ã€‚</li><li>ssh_host_rsa_key.pubï¼šæœåŠ¡å™¨å…¬é’¥ã€‚</li></ul><p>ç”Ÿæˆè¯ä¹¦ä»¥åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹è¯ä¹¦çš„ç»†èŠ‚ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -L -f ssh_host_rsa_key-cert.pub</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œä¸ºè¯ä¹¦è®¾ç½®æƒé™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 600 ssh_host_rsa_key-cert.pub</span><br></pre></td></tr></table></figure><h2 id="å…­-ca-ç­¾å‘ç”¨æˆ·è¯ä¹¦">å…­ã€CA ç­¾å‘ç”¨æˆ·è¯ä¹¦</h2><p>ä¸‹é¢ï¼Œå†ç”¨ CA ç­¾å‘ç”¨æˆ·è¯ä¹¦ã€‚è¿™æ—¶éœ€è¦ç”¨æˆ·çš„å…¬é’¥ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆä¸€å¯¹å¯†é’¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -f ~&#x2F;.ssh&#x2F;user_key -b 4096 -t rsa</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤ä¼šåœ¨ ~/.ssh ç›®å½•ï¼Œç”Ÿæˆ user_keyï¼ˆç§é’¥ï¼‰å’Œ user_key.pubï¼ˆå…¬é’¥ï¼‰ã€‚</p><p>ç„¶åï¼Œå°†ç”¨æˆ·å…¬é’¥ user_key.pubï¼Œä¸Šä¼ æˆ–å¤åˆ¶åˆ° CA æœåŠ¡å™¨ã€‚æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨ CA çš„å¯†é’¥ user_ca ä¸ºç”¨æˆ·å…¬é’¥ user_key.pub ç­¾å‘ç”¨æˆ·è¯ä¹¦ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -s user_ca -I user@example.com -n user -V +1d user_key.pub</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šç”Ÿæˆç”¨æˆ·è¯ä¹¦ user_key-cert.pubï¼ˆç”¨æˆ·å…¬é’¥åå­—åŠ åç¼€-certï¼‰ã€‚è¿™ä¸ªå‘½ä»¤å„ä¸ªå‚æ•°çš„å«ä¹‰å¦‚ä¸‹ã€‚</p><ul><li>-sï¼šæŒ‡å®š CA ç­¾å‘è¯ä¹¦çš„å¯†é’¥</li><li>-Iï¼šèº«ä»½å­—ç¬¦ä¸²ï¼Œå¯ä»¥éšä¾¿è®¾ç½®ï¼Œç›¸å½“äºæ³¨é‡Šï¼Œæ–¹ä¾¿åŒºåˆ†è¯ä¹¦ï¼Œå°†æ¥å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²æ’¤é”€è¯ä¹¦ã€‚</li><li>-n userï¼šæŒ‡å®šç”¨æˆ·åï¼Œè¡¨ç¤ºè¯ä¹¦ä»…å¯¹è¯¥ç”¨æˆ·åæœ‰æ•ˆã€‚å¦‚æœæœ‰å¤šä¸ªç”¨æˆ·åï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚ç”¨æˆ·ä»¥è¯¥ç”¨æˆ·åç™»å½•æœåŠ¡å™¨æ—¶ï¼ŒSSH é€šè¿‡è¿™ä¸ªå€¼ï¼Œåˆ†è¾¨åº”è¯¥ä½¿ç”¨å“ªå¼ è¯ä¹¦ï¼Œè¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œå‘ç»™æœåŠ¡å™¨ã€‚</li><li>-V +1dï¼šæŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œè¿™é‡Œä¸º1å¤©ï¼Œå¼ºåˆ¶ç”¨æˆ·æ¯å¤©éƒ½ç”³è¯·ä¸€æ¬¡è¯ä¹¦ï¼Œæé«˜å®‰å…¨æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯ä¹¦æ˜¯æ°¸è¿œæœ‰æ•ˆçš„ã€‚</li><li>user_key.pubï¼šç”¨æˆ·å…¬é’¥ã€‚</li></ul><p>ç”Ÿæˆè¯ä¹¦ä»¥åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹è¯ä¹¦çš„ç»†èŠ‚ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -L -f user_key-cert.pub</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œä¸ºè¯ä¹¦è®¾ç½®æƒé™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 600 user_key-cert.pub</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒ-æœåŠ¡å™¨å®‰è£…è¯ä¹¦">ä¸ƒã€æœåŠ¡å™¨å®‰è£…è¯ä¹¦</h2><p>CA ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦ ssh_host_rsa_key-cert.pub ä»¥åï¼Œéœ€è¦å°†è¯¥è¯ä¹¦å‘å›æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ scp å‘½ä»¤ï¼Œå°†è¯ä¹¦æ‹·è´è¿‡å»ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp ~&#x2F;.ssh&#x2F;ssh_host_rsa_key-cert.pub root@host.example.com:&#x2F;etc&#x2F;ssh&#x2F;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå°†ä¸‹é¢ä¸€è¡Œæ·»åŠ åˆ°æœåŠ¡å™¨é…ç½®æ–‡ä»¶ /etc/ssh/sshd_configã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HostCertificate &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key-cert.pub</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å‘Šè¯‰ sshdï¼ŒæœåŠ¡å™¨è¯ä¹¦æ˜¯å“ªä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>é‡æ–°å¯åŠ¨ sshdã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart sshd</span><br><span class="line"># æˆ–è€…</span><br><span class="line">$ sudo service sshd restart</span><br></pre></td></tr></table></figure><h2 id="å…«-æœåŠ¡å™¨å®‰è£…-ca-å…¬é’¥">å…«ã€æœåŠ¡å™¨å®‰è£… CA å…¬é’¥</h2><p>ä¸ºäº†è®©æœåŠ¡å™¨ä¿¡ä»»ç”¨æˆ·è¯ä¹¦ï¼Œå¿…é¡»å°† CA ç­¾å‘ç”¨æˆ·è¯ä¹¦çš„å…¬é’¥ user_ca.pubï¼Œæ‹·è´åˆ°æœåŠ¡å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp ~&#x2F;.ssh&#x2F;user_ca.pub root@host.example.com:&#x2F;etc&#x2F;ssh&#x2F;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ï¼Œå°† CA ç­¾å‘ç”¨æˆ·è¯ä¹¦çš„å…¬é’¥ user_ca.pubï¼Œæ‹·è´åˆ° SSH æœåŠ¡å™¨çš„ /etc/ssh ç›®å½•ã€‚</p><p>ç„¶åï¼Œå°†ä¸‹é¢ä¸€è¡Œæ·»åŠ åˆ°æœåŠ¡å™¨é…ç½®æ–‡ä»¶ /etc/ssh/sshd_configã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TrustedUserCAKeys &#x2F;etc&#x2F;ssh&#x2F;user_ca.pub</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„åšæ³•æ˜¯å°† user_ca.pub åŠ åˆ° /etc/ssh/sshd_configï¼Œè¿™ä¼šäº§ç”Ÿå…¨å±€æ•ˆæœï¼Œå³æœåŠ¡å™¨çš„æ‰€æœ‰è´¦æˆ·éƒ½ä¼šä¿¡ä»» user_ca ç­¾å‘çš„æ‰€æœ‰ç”¨æˆ·è¯ä¹¦ã€‚</p><p>å¦ä¸€ç§åšæ³•æ˜¯å°† user_ca.pub åŠ åˆ°æœåŠ¡å™¨æŸä¸ªè´¦æˆ·çš„ ~/.ssh/authorized_keys æ–‡ä»¶ï¼Œåªè®©è¯¥è´¦æˆ·ä¿¡ä»» user_ca ç­¾å‘çš„ç”¨æˆ·è¯ä¹¦ã€‚å…·ä½“æ–¹æ³•æ˜¯æ‰“å¼€ ~/.ssh/authorized_keysï¼Œè¿½åŠ ä¸€è¡Œï¼Œå¼€å¤´æ˜¯ <code>@cert-authority principals=&quot;...&quot;</code>ï¼Œç„¶ååé¢åŠ ä¸Š user_ca.pub çš„å†…å®¹ï¼Œå¤§æ¦‚æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@cert-authority principals&#x3D;&quot;user&quot; ssh-rsa AAAAB3Nz...XNRM1EX2gQ&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>principals=&quot;user&quot;</code> æŒ‡å®šç”¨æˆ·ç™»å½•çš„æœåŠ¡å™¨è´¦æˆ·åï¼Œä¸€èˆ¬å°±æ˜¯ authorized_keys æ–‡ä»¶æ‰€åœ¨çš„è´¦æˆ·ã€‚</p><p>é‡æ–°å¯åŠ¨ sshdã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart sshd</span><br><span class="line"># æˆ–è€…</span><br><span class="line">$ sudo service sshd restart</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒSSH æœåŠ¡å™¨å·²é…ç½®ä¸ºä¿¡ä»» user_ca ç­¾å‘çš„è¯ä¹¦ã€‚</p><h2 id="ä¹-å®¢æˆ·ç«¯å®‰è£…è¯ä¹¦">ä¹ã€å®¢æˆ·ç«¯å®‰è£…è¯ä¹¦</h2><p>å®¢æˆ·ç«¯å®‰è£…ç”¨æˆ·è¯ä¹¦å¾ˆç®€å•ï¼Œå°±æ˜¯ä» CA å°†ç”¨æˆ·è¯ä¹¦ user_key-cert.pub å¤åˆ¶åˆ°å®¢æˆ·ç«¯ï¼Œä¸ç”¨æˆ·çš„å¯†é’¥ user_key ä¿å­˜åœ¨åŒä¸€ä¸ªç›®å½•å³å¯ã€‚</p><h2 id="å-å®¢æˆ·ç«¯å®‰è£…-ca-å…¬é’¥">åã€å®¢æˆ·ç«¯å®‰è£… CA å…¬é’¥</h2><p>ä¸ºäº†è®©å®¢æˆ·ç«¯ä¿¡ä»»æœåŠ¡å™¨è¯ä¹¦ï¼Œå¿…é¡»å°† CA ç­¾å‘æœåŠ¡å™¨è¯ä¹¦çš„å…¬é’¥ host_ca.pubï¼ŒåŠ åˆ°å®¢æˆ·ç«¯çš„ /etc/ssh/ssh_known_hosts æ–‡ä»¶ï¼ˆå…¨å±€çº§åˆ«ï¼‰æˆ–è€… ~/.ssh/known_hosts æ–‡ä»¶ï¼ˆç”¨æˆ·çº§åˆ«ï¼‰ã€‚</p><p>å…·ä½“åšæ³•æ˜¯æ‰“å¼€ ssh_known_hosts æˆ– known_hosts æ–‡ä»¶ï¼Œè¿½åŠ ä¸€è¡Œï¼Œå¼€å¤´ä¸º <code>@cert-authority *.example.com</code>ï¼Œç„¶åå°† <code>host_ca.pub</code> æ–‡ä»¶çš„å†…å®¹ï¼ˆå³å…¬é’¥ï¼‰ç²˜è´´åœ¨åé¢ï¼Œå¤§æ¦‚æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@cert-authority *.example.com ssh-rsa AAAAB3Nz...XNRM1EX2gQ&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>*.example.com</code> æ˜¯åŸŸåçš„æ¨¡å¼åŒ¹é…ï¼Œè¡¨ç¤ºåªè¦æœåŠ¡å™¨ç¬¦åˆè¯¥æ¨¡å¼çš„åŸŸåï¼Œä¸”ç­¾å‘æœåŠ¡å™¨è¯ä¹¦çš„ CA åŒ¹é…åé¢ç»™å‡ºçš„å…¬é’¥ï¼Œå°±éƒ½å¯ä»¥ä¿¡ä»»ã€‚å¦‚æœæ²¡æœ‰åŸŸåé™åˆ¶ï¼Œè¿™é‡Œå¯ä»¥å†™æˆ*ã€‚å¦‚æœæœ‰å¤šä¸ªåŸŸåæ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”ï¼›å¦‚æœæœåŠ¡å™¨æ²¡æœ‰åŸŸåï¼Œå¯ä»¥ç”¨ä¸»æœºåï¼ˆæ¯”å¦‚ host1,host2,host3ï¼‰æˆ–è€… IP åœ°å€ï¼ˆæ¯”å¦‚ 11.12.13.14,21.22.23.24ï¼‰ã€‚</p><p>ç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨è¯ä¹¦ï¼Œç™»å½•è¿œç¨‹æœåŠ¡å™¨äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -i ~&#x2F;.ssh&#x2F;user_key user@host.example.com</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤çš„ -i å‚æ•°ç”¨æ¥æŒ‡å®šç”¨æˆ·çš„å¯†é’¥ã€‚å¦‚æœè¯ä¹¦ä¸å¯†é’¥åœ¨åŒä¸€ä¸ªç›®å½•ï¼Œåˆ™è¿æ¥æœåŠ¡å™¨æ—¶å°†è‡ªåŠ¨ä½¿ç”¨è¯¥è¯ä¹¦ã€‚</p><h2 id="åä¸€-åºŸé™¤è¯ä¹¦">åä¸€ã€åºŸé™¤è¯ä¹¦</h2><p>åºŸé™¤è¯ä¹¦çš„æ“ä½œï¼Œåˆ†æˆç”¨æˆ·è¯ä¹¦çš„åºŸé™¤å’ŒæœåŠ¡å™¨è¯ä¹¦çš„åºŸé™¤ä¸¤ç§ã€‚</p><p>æœåŠ¡å™¨è¯ä¹¦çš„åºŸé™¤ï¼Œç”¨æˆ·éœ€è¦åœ¨ known_hosts æ–‡ä»¶é‡Œé¢ï¼Œä¿®æ”¹æˆ–åˆ é™¤å¯¹åº”çš„ <code>@cert-authority</code> å‘½ä»¤çš„é‚£ä¸€è¡Œã€‚</p><p>ç”¨æˆ·è¯ä¹¦çš„åºŸé™¤ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ª /etc/ssh/revoked_keys æ–‡ä»¶ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶ sshd_config æ·»åŠ ä¸€è¡Œï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RevokedKeys &#x2F;etc&#x2F;ssh&#x2F;revoked_keys</span><br></pre></td></tr></table></figure><p>revoked_keys æ–‡ä»¶ä¿å­˜ä¸å†ä¿¡ä»»çš„ç”¨æˆ·å…¬é’¥ï¼Œç”±ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -kf &#x2F;etc&#x2F;ssh&#x2F;revoked_keys -z 1 ~&#x2F;.ssh&#x2F;user1_key.pub</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤ä¸­ï¼Œ-z å‚æ•°ç”¨æ¥æŒ‡å®šç”¨æˆ·å…¬é’¥ä¿å­˜åœ¨ revoked_keys æ–‡ä»¶çš„å“ªä¸€è¡Œï¼Œè¿™ä¸ªä¾‹å­æ˜¯ä¿å­˜åœ¨ç¬¬ 1 è¡Œã€‚</p><p>å¦‚æœä»¥åéœ€è¦åºŸé™¤å…¶ä»–çš„ç”¨æˆ·å…¬é’¥ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ä¿å­˜åœ¨ç¬¬ 2 è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -ukf &#x2F;etc&#x2F;ssh&#x2F;revoked_keys -z 2 ~&#x2F;.ssh&#x2F;user2_key.pub</span><br></pre></td></tr></table></figure><h2 id="åäºŒ-å‚è€ƒé“¾æ¥">åäºŒã€å‚è€ƒé“¾æ¥</h2><ul><li>SSH Emergency Access, Carl Tashian</li><li>Using OpenSSH Certificate Authentication, Red Hat Enterprise Linux Deployment Guide</li><li>How to SSH Properly, Gus Luxton</li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œé˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/yc9xrc7t%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/yc9xrc7tï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SSH æ˜¯æœåŠ¡å™¨ç™»å½•å·¥å…·ï¼Œæä¾›å¯†ç ç™»å½•å’Œå¯†é’¥ç™»å½•ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼ŒSSH è¿˜æœ‰ç¬¬ä¸‰ç§ç™»å½•æ–¹æ³•ï¼Œé‚£å°±æ˜¯è¯ä¹¦ç™»å½•ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æ›´åˆç†ã€æ›´å®‰å…¨çš„ç™»å½•æ–¹æ³•ï¼Œæœ¬æ–‡å°±ä»‹ç»è¿™ç§ç™»å½•æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ã€éè¯ä¹¦ç™»å½•çš„ç¼ºç‚¹&quot;&gt;ä¸€ã€éè¯ä¹¦ç™»å½•çš„ç¼ºç‚¹&lt;/h2&gt;
&lt;p&gt;å¯†ç ç™»å½•å’Œå¯†é’¥ç™»å½•ï¼Œéƒ½æœ‰å„è‡ªçš„ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¯†ç ç™»å½•éœ€è¦è¾“å…¥æœåŠ¡å™¨å¯†ç ï¼Œè¿™éå¸¸éº»çƒ¦ï¼Œä¹Ÿä¸å®‰å…¨ï¼Œå­˜åœ¨è¢«æš´åŠ›ç ´è§£çš„é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;å¯†é’¥ç™»å½•éœ€è¦æœåŠ¡å™¨ä¿å­˜ç”¨æˆ·çš„å…¬é’¥ï¼Œä¹Ÿéœ€è¦ç”¨æˆ·ä¿å­˜æœåŠ¡å™¨å…¬é’¥çš„æŒ‡çº¹ã€‚è¿™å¯¹äºå¤šç”¨æˆ·ã€å¤šæœåŠ¡å™¨çš„å¤§å‹æœºæ„å¾ˆä¸æ–¹ä¾¿ï¼Œå¦‚æœæœ‰å‘˜å·¥ç¦»èŒï¼Œéœ€è¦å°†ä»–çš„å…¬é’¥ä»æ¯å°æœåŠ¡å™¨åˆ é™¤ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äºŒã€è¯ä¹¦ç™»å½•æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;äºŒã€è¯ä¹¦ç™»å½•æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è¯ä¹¦ç™»å½•å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢çš„ç¼ºç‚¹è€Œè®¾è®¡çš„ã€‚å®ƒå¼•å…¥äº†ä¸€ä¸ªè¯ä¹¦é¢å‘æœºæ„ï¼ˆCertificate1 authorityï¼Œç®€ç§° CAï¼‰ï¼Œå¯¹ä¿¡ä»»çš„æœåŠ¡å™¨é¢å‘æœåŠ¡å™¨è¯ä¹¦ï¼Œå¯¹ä¿¡ä»»çš„ç”¨æˆ·é¢å‘ç”¨æˆ·è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;ç™»å½•æ—¶ï¼Œç”¨æˆ·å’ŒæœåŠ¡å™¨ä¸éœ€è¦æå‰çŸ¥é“å½¼æ­¤çš„å…¬é’¥ï¼Œåªéœ€è¦äº¤æ¢å„è‡ªçš„è¯ä¹¦ï¼ŒéªŒè¯æ˜¯å¦å¯ä¿¡å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;è¯ä¹¦ç™»å½•çš„ä¸»è¦ä¼˜ç‚¹æœ‰ä¸¤ä¸ªï¼šï¼ˆ1ï¼‰ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¸ç”¨äº¤æ¢å…¬é’¥ï¼Œè¿™æ›´å®¹æ˜“ç®¡ç†ï¼Œä¹Ÿå…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚ï¼ˆ2ï¼‰è¯ä¹¦å¯ä»¥è®¾ç½®åˆ°æœŸæ—¶é—´ï¼Œè€Œå…¬é’¥æ²¡æœ‰åˆ°æœŸæ—¶é—´ã€‚é’ˆå¯¹ä¸åŒçš„æƒ…å†µï¼Œå¯ä»¥è®¾ç½®æœ‰æ•ˆæœŸå¾ˆçŸ­çš„è¯ä¹¦ï¼Œè¿›ä¸€æ­¥æé«˜å®‰å…¨æ€§ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="SSH" scheme="https://www.hi-linux.com/categories/SSH/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="SSH" scheme="https://www.hi-linux.com/tags/SSH/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä¼šä½ è§£å†³ Chrome è®¿é—®éå—ä¿¡è¯ä¹¦é¡µé¢æ—¶ï¼Œæç¤ºã€Œæ‚¨çš„è¿æ¥ä¸æ˜¯ç§å¯†è¿æ¥ã€é”™è¯¯çš„æ–¹æ³•</title>
    <link href="https://www.hi-linux.com/posts/35330.html"/>
    <id>https://www.hi-linux.com/posts/35330.html</id>
    <published>2020-07-06T01:00:00.000Z</published>
    <updated>2020-07-06T06:20:14.078Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ <code>Chrome</code> ä¸­è®¿é—®ä¸€äº›æœªå—ä¿¡ä»»çš„ <code>HTTPS</code> é¡µé¢æ—¶ï¼Œä¼šæç¤ºç±»ä¼¼ <code>NET::ERR_CERT_INVALID</code> çš„é”™è¯¯ã€‚ä»¥å¾€æ—§ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è·³è¿‡å¾—ä»¥ç»§ç»­è®¿é—®ï¼Œä½†æ˜¯æ–°ç‰ˆæœ¬çš„ <code>Chrome</code> ä¸­å¹¶ä¸å…è®¸ç»§ç»­ï¼Œä¸”æç¤ºä»¥ä¸‹é”™è¯¯ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-1.png" alt=""></p><p>ç»è¿‡å¾ˆå¤šç§å°è¯•åï¼Œç›®å‰å‘ç°åªæœ‰ä¸¤ç§æ¯”è¾ƒæœ‰æ•ˆçš„æ–¹æ³•å¯ä»¥è§£å†³ã€‚</p><ul><li>æ–¹æ³•ä¸€</li></ul><p>ä½ å¯ä»¥åœ¨ <code>Chrome</code> å¯åŠ¨æ—¶åŠ ä¸Š <code>--ignore-certificate-errors</code> å’Œ <code>--ignore-urlfetcher-cert-requests</code> å‚æ•°æ¥è§£å†³è¯¥é—®é¢˜ã€‚</p><ol><li>Windows ç”¨æˆ·</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files (x86)\Google\Chrome\Application\chrome.exe&quot; --ignore-certificate-errors</span><br></pre></td></tr></table></figure><ol start="2"><li>Mac ç”¨æˆ·</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Applications&#x2F;Google\ Chrome.app&#x2F;Contents&#x2F;MacOS&#x2F;Google\ Chrome --ignore-certificate-errors --ignore-urlfetcher-cert-requests &amp;&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°æ‰“å¼€ <code>Chrome</code> å¹¶æµè§ˆæ‚¨çš„ç½‘ç«™ï¼Œä¾¿å¯æ­£å¸¸è®¿é—®ã€‚</p><a id="more"></a><ul><li>æ–¹æ³•äºŒ</li></ul><p>å½“å‡ºç° â€œæ‚¨çš„è¿æ¥ä¸æ˜¯ç§å¯†â€ é¡µé¢æ—¶ï¼Œç‚¹å‡»é«˜çº§åï¼Œå¹¶ç›´æ¥è¾“å…¥ <code>thisisunsafe</code> å…³é”®å­—å¹¶å›è½¦ã€‚å½“ä½ ä½¿ç”¨çš„ <code>Chrome</code> ç‰ˆæœ¬ä¸å…è®¸é€šè¿‡ç‚¹å‡»æ“ä½œè®¾ç½®ä¾‹å¤–æ—¶ï¼Œè¿™æ ·æ“ä½œå°†å…è®¸å°†æ­¤æ¬¡è¯·æ±‚è®¾ç½®åˆ°å®‰å…¨ä¾‹å¤–ä¸­ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-4.png" alt=""></p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-6.png" alt=""></p><blockquote><p>æ³¨æ„ï¼šåœ¨ Chrome è¯¥é¡µé¢ä¸Šï¼Œç›´æ¥é”®ç›˜è¾“å…¥åå›è½¦ï¼Œå¹¶ä¸æ˜¯åœ¨åœ°å€æ è¾“å…¥ã€‚</p></blockquote><p>å¦‚æœä½ çœŸçš„çœ‹ä¸æ˜ç™½ä¸Šé¢çš„æ–‡å­—æè¿°ï¼Œè¿˜å¯ä»¥å‚è€ƒä¸‹é¢çš„æ“ä½œæ¼”ç¤ºï¼š</p><p><img src="https://www.hi-linux.com/img/linux/chrome-unsafessl.gif" alt=""></p><p><strong>å‚è€ƒæ–‡æ¡£</strong></p><ol><li><p><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></p></li><li><p><a href="http://www.hackdig.com/03/hack-68770.htm" target="_blank" rel="noopener">http://www.hackdig.com/03/hack-68770.htm</a></p></li><li><p><a href="https://blog.csdn.net/quanqxj/article/details/103076795" target="_blank" rel="noopener">https://blog.csdn.net/quanqxj/article/details/103076795</a></p></li><li><p><a href="https://medium.com/@dblazeski/chrome-bypass-net-err-cert-invalid-for-development-daefae43eb12" target="_blank" rel="noopener">https://medium.com/@dblazeski/chrome-bypass-net-err-cert-invalid-for-development-daefae43eb12</a></p></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ &lt;code&gt;Chrome&lt;/code&gt; ä¸­è®¿é—®ä¸€äº›æœªå—ä¿¡ä»»çš„ &lt;code&gt;HTTPS&lt;/code&gt; é¡µé¢æ—¶ï¼Œä¼šæç¤ºç±»ä¼¼ &lt;code&gt;NET::ERR_CERT_INVALID&lt;/code&gt; çš„é”™è¯¯ã€‚ä»¥å¾€æ—§ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è·³è¿‡å¾—ä»¥ç»§ç»­è®¿é—®ï¼Œä½†æ˜¯æ–°ç‰ˆæœ¬çš„ &lt;code&gt;Chrome&lt;/code&gt; ä¸­å¹¶ä¸å…è®¸ç»§ç»­ï¼Œä¸”æç¤ºä»¥ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡å¾ˆå¤šç§å°è¯•åï¼Œç›®å‰å‘ç°åªæœ‰ä¸¤ç§æ¯”è¾ƒæœ‰æ•ˆçš„æ–¹æ³•å¯ä»¥è§£å†³ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–¹æ³•ä¸€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨ &lt;code&gt;Chrome&lt;/code&gt; å¯åŠ¨æ—¶åŠ ä¸Š &lt;code&gt;--ignore-certificate-errors&lt;/code&gt; å’Œ &lt;code&gt;--ignore-urlfetcher-cert-requests&lt;/code&gt; å‚æ•°æ¥è§£å†³è¯¥é—®é¢˜ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Windows ç”¨æˆ·&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;C:\Program Files (x86)\Google\Chrome\Application\chrome.exe&amp;quot; --ignore-certificate-errors&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;Mac ç”¨æˆ·&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x2F;Applications&amp;#x2F;Google\ Chrome.app&amp;#x2F;Contents&amp;#x2F;MacOS&amp;#x2F;Google\ Chrome --ignore-certificate-errors --ignore-urlfetcher-cert-requests &amp;amp;&amp;gt; &amp;#x2F;dev&amp;#x2F;null&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶åé‡æ–°æ‰“å¼€ &lt;code&gt;Chrome&lt;/code&gt; å¹¶æµè§ˆæ‚¨çš„ç½‘ç«™ï¼Œä¾¿å¯æ­£å¸¸è®¿é—®ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Chrome" scheme="https://www.hi-linux.com/categories/Chrome/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Chrome" scheme="https://www.hi-linux.com/tags/Chrome/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†äº«ä¸€ä¸ªè§£å†³ sudo å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡çš„å°æŠ€å·§</title>
    <link href="https://www.hi-linux.com/posts/30418.html"/>
    <id>https://www.hi-linux.com/posts/30418.html</id>
    <published>2020-06-22T01:00:00.000Z</published>
    <updated>2020-06-22T04:44:37.009Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h3 id="å¦‚ä½•è§£å†³-sudo-å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡çš„é—®é¢˜">å¦‚ä½•è§£å†³ sudo å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡çš„é—®é¢˜</h3><p>åœ¨é€šè¿‡ <code>sudo</code> è¿è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šé»˜è®¤é‡ç½®ç¯å¢ƒå˜é‡ä¸ºå®‰å…¨çš„ç¯å¢ƒå˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆå‰è®¾ç½®çš„å˜é‡éƒ½ä¼šå¤±æ•ˆï¼Œåªæœ‰å°‘æ•°é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ç¯å¢ƒå˜é‡èƒ½å¤Ÿä¿å­˜ä¸‹æ¥ã€‚</p><p><code>sudo</code> çš„é…ç½®æ–‡ä»¶æ˜¯ <code>/etc/sudoers</code>ï¼Œéœ€è¦ <code>root</code> æƒé™æ‰èƒ½è¯»å–ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sed &#39;&#x2F;^#&#x2F;d;&#x2F;^$&#x2F;d&#39; &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure><p><code>sudo</code> çš„é…ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://ghoulich.xninja.org/wp-content/uploads/sites/2/2017/05/image-01_sudo-conf.png" alt=""></p><p>sudo é…ç½®æ–‡ä»¶</p><p>è¯·æ³¨æ„ï¼š</p><ul><li><p>ç¬¬ 3 è¡Œçš„ <code>Defaults env_reset</code> è¡¨ç¤ºé»˜è®¤ä¼šé‡ç½®ç¯å¢ƒå˜é‡ï¼Œå› æ­¤è‡ªå®šä¹‰çš„å˜é‡ä¼šåœ¨ <code>sudo</code> ç¯å¢ƒä¸­å¤±æ•ˆï¼Œä¹Ÿå°±ä¸ä¼šè·å–æ­£ç¡®çš„å˜é‡å€¼ã€‚</p></li><li><p>ç¬¬ 4 è¡Œè‡³ç¬¬ 8 è¡Œçš„ <code>env_keep</code> é…ç½®é¡¹ï¼Œç”¨äºä¿ç•™éƒ¨åˆ†ç¯å¢ƒå˜é‡ä¸è¢«é‡ç½®ï¼Œéœ€è¦ä¿ç•™çš„å˜é‡å°±å†™å…¥åŒå¼•å·ä¹‹ä¸­ã€‚</p></li><li><p>ç¬¬ 9 è¡Œçš„ <code>secure_path</code> é…ç½®é¡¹ï¼Œå…¶ä¸­åŒ…å«çš„è·¯å¾„å°†è¢«å½“åš <code>sudo</code> ç¯å¢ƒçš„ <code>PATH</code> å˜é‡ä½¿ç”¨ï¼Œå¦‚æœåœ¨ <code>sudo</code> ç¯å¢ƒæ— æ³•æ‰¾åˆ°æŸäº›å‘½ä»¤ï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›å‘½ä»¤çš„è·¯å¾„åŠ å…¥è¯¥é…ç½®é¡¹ä¹‹ä¸­ã€‚</p></li></ul><a id="more"></a><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>sudo</code> å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡æˆ–å‘½ä»¤çš„é—®é¢˜ï¼Œæœ‰ä¸‰ç§è§£å†³æ–¹æ³•ï¼š</p><ol><li>sudo -E</li></ol><p>åŠ ä¸Š <code>-E</code>  é€‰é¡¹åï¼Œç”¨æˆ·å¯ä»¥åœ¨ <code>sudo</code>  æ‰§è¡Œæ—¶ä¿ç•™å½“å‰ç”¨æˆ·å·²å­˜åœ¨çš„ç¯å¢ƒå˜é‡ï¼Œä¸ä¼šè¢« <code>sudo</code> é‡ç½®ã€‚å¦å¤–ï¼Œå¦‚æœç”¨æˆ·å¯¹äºæŒ‡å®šçš„ç¯å¢ƒå˜é‡æ²¡æœ‰æƒé™ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚</p><ol start="2"><li>ä¿®æ”¹ sudo é…ç½®æ–‡ä»¶</li></ol><p>åœ¨å†…éƒ¨æµ‹è¯•æœºå™¨ä¸­ï¼Œå®‰å…¨æ€§è¦æ±‚ä¸é«˜ï¼Œæ€»æ˜¯éœ€è¦åŠ ä¸Š <code>-E</code> å‚æ•°æ¥æ‰§è¡Œè„šæœ¬ï¼Œè¿™ä¸ªå®‰å…¨è®¾å®šä¹Ÿä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ <code>/etc/sudoers</code> æ–‡ä»¶çš„ <code>env_keep</code> å’Œ <code>secure_path</code> é…ç½®é¡¹ï¼Œæ¥æŒ‡å®š <code>sudo</code> ç¯å¢ƒä¸­éœ€è¦ä¿ç•™çš„ç¯å¢ƒå˜é‡å’Œè·¯å¾„ã€‚</p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨æ›´ç®€å•ç²—æš´çš„æ–¹å¼ï¼šç›´æ¥å°† <code>Defaults env_reset</code> æ”¹æˆ <code>Defaults !env_reset</code> æ¥å–æ¶ˆæ‰å¯¹ <code>PATH</code> å˜é‡çš„é‡ç½®ï¼Œç„¶ååœ¨ <code>.bashrc</code> ä¸­æœ€åæ·»åŠ  <code>alias sudo='sudo env PATH=$PATH'</code>ã€‚è¿™æ · <code>sudo</code> æ‰§è¡Œå‘½ä»¤æ—¶æ‰€æœå¯»çš„è·¯å¾„å°±æ˜¯ç³»ç»Ÿçš„ <code>PATH</code> å˜é‡ä¸­çš„è·¯å¾„ï¼Œå¦‚æœä½ æƒ³æ·»åŠ å…¶ä»–å˜é‡æ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼ã€‚</p><ol start="3"><li>æ‰‹åŠ¨æ·»åŠ å˜é‡</li></ol><p>æ‰‹åŠ¨åœ¨è„šæœ¬ä¸­è®¾ç½®æ‰€éœ€çš„å˜é‡ï¼Œåœ¨æ‰§è¡Œ <code>sudo</code> è„šæœ¬å‰å…ˆå°†æ‰€éœ€è¦çš„å˜é‡å†™å…¥åˆ°éœ€è¦æ‰§è¡Œçš„è„šæœ¬å¼€å¤´ã€‚</p><h3 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h3><ol><li><p><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></p></li><li><p><a href="http://ghoulich.xninja.org/2017/05/09/how-to-find-env-variables-when-exec-sudo-commands/" target="_blank" rel="noopener">http://ghoulich.xninja.org/2017/05/09/how-to-find-env-variables-when-exec-sudo-commands/</a></p></li><li><p><a href="http://www.ibm.com/developerworks/cn/aix/library/au-sudo/index.html" target="_blank" rel="noopener">http://www.ibm.com/developerworks/cn/aix/library/au-sudo/index.html</a></p></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å¦‚ä½•è§£å†³-sudo-å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡çš„é—®é¢˜&quot;&gt;å¦‚ä½•è§£å†³ sudo å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡çš„é—®é¢˜&lt;/h3&gt;
&lt;p&gt;åœ¨é€šè¿‡ &lt;code&gt;sudo&lt;/code&gt; è¿è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šé»˜è®¤é‡ç½®ç¯å¢ƒå˜é‡ä¸ºå®‰å…¨çš„ç¯å¢ƒå˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆå‰è®¾ç½®çš„å˜é‡éƒ½ä¼šå¤±æ•ˆï¼Œåªæœ‰å°‘æ•°é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ç¯å¢ƒå˜é‡èƒ½å¤Ÿä¿å­˜ä¸‹æ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo&lt;/code&gt; çš„é…ç½®æ–‡ä»¶æ˜¯ &lt;code&gt;/etc/sudoers&lt;/code&gt;ï¼Œéœ€è¦ &lt;code&gt;root&lt;/code&gt; æƒé™æ‰èƒ½è¯»å–ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sudo sed &amp;#39;&amp;#x2F;^#&amp;#x2F;d;&amp;#x2F;^$&amp;#x2F;d&amp;#39; &amp;#x2F;etc&amp;#x2F;sudoers&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;sudo&lt;/code&gt; çš„é…ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ghoulich.xninja.org/wp-content/uploads/sites/2/2017/05/image-01_sudo-conf.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;sudo é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ 3 è¡Œçš„ &lt;code&gt;Defaults env_reset&lt;/code&gt; è¡¨ç¤ºé»˜è®¤ä¼šé‡ç½®ç¯å¢ƒå˜é‡ï¼Œå› æ­¤è‡ªå®šä¹‰çš„å˜é‡ä¼šåœ¨ &lt;code&gt;sudo&lt;/code&gt; ç¯å¢ƒä¸­å¤±æ•ˆï¼Œä¹Ÿå°±ä¸ä¼šè·å–æ­£ç¡®çš„å˜é‡å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ 4 è¡Œè‡³ç¬¬ 8 è¡Œçš„ &lt;code&gt;env_keep&lt;/code&gt; é…ç½®é¡¹ï¼Œç”¨äºä¿ç•™éƒ¨åˆ†ç¯å¢ƒå˜é‡ä¸è¢«é‡ç½®ï¼Œéœ€è¦ä¿ç•™çš„å˜é‡å°±å†™å…¥åŒå¼•å·ä¹‹ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ 9 è¡Œçš„ &lt;code&gt;secure_path&lt;/code&gt; é…ç½®é¡¹ï¼Œå…¶ä¸­åŒ…å«çš„è·¯å¾„å°†è¢«å½“åš &lt;code&gt;sudo&lt;/code&gt; ç¯å¢ƒçš„ &lt;code&gt;PATH&lt;/code&gt; å˜é‡ä½¿ç”¨ï¼Œå¦‚æœåœ¨ &lt;code&gt;sudo&lt;/code&gt; ç¯å¢ƒæ— æ³•æ‰¾åˆ°æŸäº›å‘½ä»¤ï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›å‘½ä»¤çš„è·¯å¾„åŠ å…¥è¯¥é…ç½®é¡¹ä¹‹ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="sudo" scheme="https://www.hi-linux.com/tags/sudo/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ è§£å†³ Chromeã€IE ç­‰æµè§ˆå™¨æ— æ³•æ­£å¸¸è®¿é—® Kubernetes Dashboard çš„é—®é¢˜</title>
    <link href="https://www.hi-linux.com/posts/13787.html"/>
    <id>https://www.hi-linux.com/posts/13787.html</id>
    <published>2020-06-13T01:00:00.000Z</published>
    <updated>2020-06-13T12:06:20.411Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ­£å¸¸å®‰è£…éƒ¨ç½²å®Œ <code>Kubernetes Dashboard</code> åï¼Œé€šè¿‡å¤§å¤šæ•°ä¸»æµæµè§ˆå™¨ï¼ˆ<code>Chrome</code>ã€<code>IE</code>ã€<code>Safari</code>ï¼‰æ˜¯ä¸èƒ½æ­£å¸¸è®¿é—®çš„ï¼Œå”¯æœ‰ <code>Firefox</code> æ‰èƒ½è§£å¿§ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-1.png" alt=""></p><p>ä½¿ç”¨ç«ç‹æµè§ˆå™¨æ‰“å¼€åï¼Œä¼šæœ‰ä¸€ä¸ªå®‰å…¨é£é™©æç¤ºã€‚</p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-2.png" alt=""></p><p>æ¥å—å®‰å…¨é£é™©åï¼Œè¿˜æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-3.png" alt=""></p><p>è¯¥é—®é¢˜æ˜¯ç”±äºéƒ¨ç½² <code>Kubernetes Dashboard</code> æ—¶é»˜è®¤ç”Ÿæˆçš„è¯ä¹¦æœ‰é—®é¢˜å¯¼è‡´çš„ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±æ¥æ•™ä½ å¦‚ä½•å¿«é€Ÿä¼˜é›…çš„è§£å†³å®ƒã€‚</p><p>æ—¢ç„¶æ˜¯è¯¥ä¹¦é—®é¢˜ï¼Œé‚£è§£å†³åŠæ³•å½“ç„¶æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„æœ‰æ•ˆè¯ä¹¦æ›¿æ¢æ‰è¿‡æœŸçš„å³å¯ã€‚</p><a id="more"></a><h3 id="é€šè¿‡ç”Ÿæˆæ–°çš„è¯ä¹¦æ°¸ä¹…è§£å†³">é€šè¿‡ç”Ÿæˆæ–°çš„è¯ä¹¦æ°¸ä¹…è§£å†³</h3><p>ä¸‹é¢æ˜¯ç”Ÿæˆ <code>Kubernetes Dashboard</code> åŸŸåè¯ä¹¦çš„å‡ ç§å¸¸ç”¨æ–¹æ³•ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªèº«å®é™…æƒ…å†µé€‰ç”¨ä»»ä½•ä¸€ç§å°±è¡Œã€‚</p><ul><li><p>é€šè¿‡ <code>https://freessl.cn</code> ç½‘ç«™ï¼Œåœ¨çº¿ç”Ÿæˆå…è´¹ 1 å¹´çš„è¯ä¹¦</p></li><li><p>é€šè¿‡ <code>Letâ€™s Encrypt</code> ç”Ÿæˆ <code>90</code> å¤©å…è´¹è¯ä¹¦</p></li><li><p>é€šè¿‡ <code>Cert-Manager</code> æœåŠ¡æ¥ç”Ÿæˆå’Œç®¡ç†è¯ä¹¦</p></li><li><p>é€šè¿‡ <code>IP</code> ç›´æ¥è‡ªç­¾ä¸€ä¸ªè¯ä¹¦</p></li></ul><p>å‡ ç§æ–¹å¼çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨è‡ªç­¾è¯ä¹¦çš„æ–¹æ³•æ¥è¿›è¡Œæ¼”ç¤ºã€‚</p><ol><li>é€šè¿‡è‡ªç­¾æ–¹å¼ç”Ÿæˆè¯ä¹¦</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªç”¨äºè‡ªç­¾è¯ä¹¦çš„ç›®å½•</span><br><span class="line">$ mkdir kubernetes-dashboard-key &amp;&amp; cd kubernetes-dashboard-key</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆè¯ä¹¦è¯·æ±‚çš„key</span><br><span class="line">$ openssl genrsa -out dashboard.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">....................................+++</span><br><span class="line">.......................................................................+++</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆè¯ä¹¦è¯·æ±‚</span><br><span class="line">$ openssl req -days 3650 -new -out dashboard.csr -key dashboard.key -subj &#39;&#x2F;CN&#x3D;192.168.100.100&#39;</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆè‡ªç­¾è¯ä¹¦</span><br><span class="line">$ openssl x509 -req -in dashboard.csr -signkey dashboard.key -out dashboard.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject&#x3D;&#x2F;CN&#x3D;192.168.100.100</span><br><span class="line">Getting Private key</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨æ–°è¯ä¹¦æ¥åˆ›å»ºä¸€ä¸ªä¸ Kubernetes Dashboard éƒ¨ç½²æ–‡ä»¶ä¸­åŒåçš„ Secret</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥æ‰¾ Kubernetes ä¸­åŸæœ‰è¯ä¹¦çš„ Secret</span><br><span class="line">$ kubectl get secret kubernetes-dashboard-certs -n kubernetes-dashboard</span><br><span class="line">NAME                         TYPE     DATA   AGE</span><br><span class="line">kubernetes-dashboard-certs   Opaque   0      65d</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ Kubernetes ä¸­åŸæœ‰çš„è¯ä¹¦ Secret çš„å†…å®¹ ï¼ˆæ­¤æ­¥éª¤éå¿…é¡»ï¼‰</span><br><span class="line">$ kubectl get  secret kubernetes-dashboard-certs -n kubernetes-dashboard -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    kubectl.kubernetes.io&#x2F;last-applied-configuration: |</span><br><span class="line">      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Secret&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;k8s-app&quot;:&quot;kubernetes-dashboard&quot;&#125;,&quot;name&quot;:&quot;kubernetes-dashboard-certs&quot;,&quot;namespace&quot;:&quot;kubernetes-dashboard&quot;&#125;,&quot;type&quot;:&quot;Opaque&quot;&#125;</span><br><span class="line">  creationTimestamp: &quot;2020-03-24T17:42:42Z&quot;</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard-certs</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">  resourceVersion: &quot;20913&quot;</span><br><span class="line">  selfLink: &#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;kubernetes-dashboard&#x2F;secrets&#x2F;kubernetes-dashboard-certs</span><br><span class="line">  uid: 329888d4-aa59-4c32-84d8-b88ef2ebfa32</span><br><span class="line">type: Opaque</span><br><span class="line"></span><br><span class="line"># åˆ é™¤ Kubernetes ä¸­åŸæœ‰çš„è¯ä¹¦ Secret</span><br><span class="line">$ kubectl delete secret kubernetes-dashboard-certs -n kubernetes-dashboard</span><br><span class="line">secret &quot;kubernetes-dashboard-certs&quot; deleted</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨æ–°è¯ä¹¦åˆ›å»ºä¸€ä¸ªåŒåçš„ Secret</span><br><span class="line">$ kubectl create secret generic kubernetes-dashboard-certs --from-file&#x3D;dashboard.key --from-file&#x3D;dashboard.crt -n kubernetes-dashboard</span><br><span class="line">secret&#x2F;kubernetes-dashboard-certs created</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šæ–°ç‰ˆçš„ Dashboard çš„ namespace å·²ç»æ˜¯ kubernetes-dashboard ã€‚</p></blockquote><ol start="3"><li>æŸ¥æ‰¾å½“å‰æ­£åœ¨è¿è¡Œçš„ Kubernetes-Dashboard çš„ Pod</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -n kubernetes-dashboard</span><br><span class="line">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">dashboard-metrics-scraper-7b8b58dc8b-nw7l7   1&#x2F;1     Running   3          64d</span><br><span class="line">kubernetes-dashboard-5f5f847d57-88ssx        1&#x2F;1     Running   3          64d</span><br></pre></td></tr></table></figure><ol start="4"><li>åˆ é™¤ç°æœ‰çš„ Kubernetes-Dashboard çš„ Pod</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete po kubernetes-dashboard-5f5f847d57-88ssx -n kubernetes-dashboard</span><br><span class="line">pod &quot;kubernetes-dashboard-5f5f847d57-88ssx&quot; deleted</span><br><span class="line"></span><br><span class="line">$ kubectl delete po dashboard-metrics-scraper-7b8b58dc8b-nw7l7 -n kubernetes-dashboard</span><br><span class="line">pod &quot;dashboard-metrics-scraper-7b8b58dc8b-nw7l7&quot; deleted</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>Pod</code> æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¿™æ¡å‘½ä»¤æ‰¹é‡åˆ é™¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -n kubernetes-dashboard | grep -v NAME | awk &#39;&#123;print &quot;kubectl delete po &quot; $1 &quot; -n kubernetes-dashboard&quot;&#125;&#39; | sh</span><br></pre></td></tr></table></figure><p>åˆ é™¤å®Œæˆåï¼Œæ–°çš„ <code>Kubernetes-Dashboard Pod</code> ä¼šè‡ªåŠ¨å¯åŠ¨èµ·æ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -n kubernetes-dashboard</span><br><span class="line">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">dashboard-metrics-scraper-7b8b58dc8b-w9zzh   1&#x2F;1     Running   0          35s</span><br><span class="line">kubernetes-dashboard-5f5f847d57-4q76w        1&#x2F;1     Running   0          53s</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œå†æ¬¡åˆ·æ–° <code>Chrome</code> æµè§ˆå™¨çš„ <code>Dashboard</code> é¡µé¢åï¼Œå…ˆç‚¹é«˜çº§ï¼š</p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-4.png" alt=""></p><p>ç„¶åç‚¹å‡»ç»§ç»­å‰å¾€ï¼Œé¡µé¢å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº†ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-5.png" alt=""></p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-6.png" alt=""></p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-7.png" alt=""></p><h3 id="ä¸´æ—¶è§£å†³æ–¹æ¡ˆ">ä¸´æ—¶è§£å†³æ–¹æ¡ˆ</h3><p>å¦‚æœä½ åªæ˜¯æƒ³ä¸´æ—¶ä½¿ç”¨ <code>Chrome</code> è®¿é—®ä¸‹ <code>Kubernetes-Dashboard</code> æˆ–è€…ä½ æ²¡æœ‰æƒé™æ›´æ¢ <code>Kubernetes-Dashboard</code> çš„è¯ä¹¦ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ <code>Chrome</code> å¯åŠ¨æ—¶åŠ ä¸Š <code>--ignore-certificate-errors</code> å’Œ <code>--ignore-urlfetcher-cert-requests</code> å‚æ•°æ¥è§£å†³è¯¥é—®é¢˜ã€‚</p><ol><li>Windows ç”¨æˆ·</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files (x86)\Google\Chrome\Application\chrome.exe&quot; --ignore-certificate-errors</span><br></pre></td></tr></table></figure><ol start="2"><li>Mac ç”¨æˆ·</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Applications&#x2F;Google\ Chrome.app&#x2F;Contents&#x2F;MacOS&#x2F;Google\ Chrome --ignore-certificate-errors --ignore-urlfetcher-cert-requests &amp;&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h1><ol><li><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></li><li><a href="https://blog.51cto.com/10616534/2430512" target="_blank" rel="noopener">https://blog.51cto.com/10616534/2430512</a></li><li><a href="https://www.jianshu.com/p/8021285cc37d" target="_blank" rel="noopener">https://www.jianshu.com/p/8021285cc37d</a></li><li><a href="https://stackoverflow.com/questions/26388405/chrome-disable-ssl-checking-for-sites" target="_blank" rel="noopener">https://stackoverflow.com/questions/26388405/chrome-disable-ssl-checking-for-sites</a></li><li><a href="https://my.oschina.net/u/4407987/blog/3319315" target="_blank" rel="noopener">https://my.oschina.net/u/4407987/blog/3319315</a></li><li><a href="https://zhangguanzhang.github.io/2019/02/12/dashboard/" target="_blank" rel="noopener">https://zhangguanzhang.github.io/2019/02/12/dashboard/</a></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ­£å¸¸å®‰è£…éƒ¨ç½²å®Œ &lt;code&gt;Kubernetes Dashboard&lt;/code&gt; åï¼Œé€šè¿‡å¤§å¤šæ•°ä¸»æµæµè§ˆå™¨ï¼ˆ&lt;code&gt;Chrome&lt;/code&gt;ã€&lt;code&gt;IE&lt;/code&gt;ã€&lt;code&gt;Safari&lt;/code&gt;ï¼‰æ˜¯ä¸èƒ½æ­£å¸¸è®¿é—®çš„ï¼Œå”¯æœ‰ &lt;code&gt;Firefox&lt;/code&gt; æ‰èƒ½è§£å¿§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç«ç‹æµè§ˆå™¨æ‰“å¼€åï¼Œä¼šæœ‰ä¸€ä¸ªå®‰å…¨é£é™©æç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ¥å—å®‰å…¨é£é™©åï¼Œè¿˜æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/Kubernetes-Dashboard-3.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¯¥é—®é¢˜æ˜¯ç”±äºéƒ¨ç½² &lt;code&gt;Kubernetes Dashboard&lt;/code&gt; æ—¶é»˜è®¤ç”Ÿæˆçš„è¯ä¹¦æœ‰é—®é¢˜å¯¼è‡´çš„ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±æ¥æ•™ä½ å¦‚ä½•å¿«é€Ÿä¼˜é›…çš„è§£å†³å®ƒã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶æ˜¯è¯¥ä¹¦é—®é¢˜ï¼Œé‚£è§£å†³åŠæ³•å½“ç„¶æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„æœ‰æ•ˆè¯ä¹¦æ›¿æ¢æ‰è¿‡æœŸçš„å³å¯ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ å®šåˆ¶ä¸€ä¸ªä¸“å±çš„ä¸ªæ€§åŒ–ç»ˆç«¯ç™»é™†ç•Œé¢</title>
    <link href="https://www.hi-linux.com/posts/51306.html"/>
    <id>https://www.hi-linux.com/posts/51306.html</id>
    <published>2020-05-28T01:00:00.000Z</published>
    <updated>2020-05-28T07:30:10.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>åœ¨æˆ‘ä»¬ç™»å…¥ macOS çš„ç»ˆç«¯åï¼Œç»ˆç«¯å¾€å¾€ä¼šå¼¹å‡ºä¸€æ®µæ¬¢è¿ä¿¡æ¯ï¼Œæ˜¾ç¤ºç™»å½•ä¸»æœºã€ä¸»æœºä¾›åº”å•†æç¤ºç­‰ä¿¡æ¯ã€‚ä½†æ¯æ¬¡çœ‹åˆ°çš„éƒ½æ˜¯åŒæ ·çš„ä¿¡æ¯éš¾å…æœ‰äº›åŒå€¦ã€‚</p><p>é€šè¿‡ä¿®æ”¹ Motd æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ SSH åŠ ç‚¹æ–™ï¼Œè®©å®ƒæ›´åŠ å¥½çœ‹å’Œæœ‰è¶£ã€‚</p><p>é»˜è®¤æç¤º</p><p><img src="https://cdn.sspai.com/2020/03/04/119ed2f44f8c779e52e5d0b61f0572b0.png" alt=""></p><h2 id="åŸç†">åŸç†</h2><blockquote><p>åœ¨ç±» Unix ç³»ç»Ÿä¸­ï¼Œ/etc/motd æ˜¯ä¸€ä¸ªåŒ…å«ã€Œä»Šæ—¥æ¶ˆæ¯ï¼ˆMessage of the dayï¼‰ã€çš„æ–‡ä»¶ã€‚æ¯”èµ·ç”µå­é‚®ä»¶ï¼Œä½¿ç”¨ Motd ç»™æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯æ˜¾å¾—æ›´æœ‰æ•ˆç‡ã€‚å…¶å®ƒæ“ä½œç³»ç»Ÿä¸­ä¹Ÿå¯èƒ½æœ‰è¿™ä¸€åŠŸèƒ½ï¼Œæ¯”å¦‚ Multics ä¸­çš„ Motd ä¿¡æ¯åˆ†æ®µã€‚/etc/motd çš„å†…å®¹ä¼šåœ¨ç”¨æˆ·æˆåŠŸç™»å½•åç”± Unix ç™»å½•å‘½ä»¤æ˜¾ç¤ºï¼Œæ•´ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨ Shell ç™»å½•ä¹‹å‰ã€‚è¾ƒæ–°çš„ç±» Unix ç³»ç»Ÿå¯ä»¥ç”ŸæˆåŠ¨æ€æ¶ˆæ¯ã€‚ï¼­otd ä¹Ÿè¢«è¿ç”¨åœ¨å…¶å®ƒé¢†åŸŸï¼Œæ¯”å¦‚ IRC æœåŠ¡å™¨ã€åŠæ¡å‘½ç³»åˆ—æ¸¸æˆç­‰ã€‚</p><p>æ¥æºï¼šç»´åŸºç™¾ç§‘</p></blockquote><p>Linux ç³»ç»Ÿé€šè¿‡ /etc/issueã€/etc/issue.netã€/etc/motd ä»¥åŠ /run/motd.dynamic æ¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…æ˜¯è¿œç¨‹ç™»å½•åçš„æç¤ºä¿¡æ¯ï¼Œè¿™ä¸ªæç¤ºä¿¡æ¯é€šå¸¸ç”¨äºå‘ç”¨æˆ·å±•ç¤ºç³»ç»Ÿç‰ˆæœ¬ã€ç¡¬ä»¶å‚æ•°ç­‰ä¿¡æ¯ã€‚å…¶ä¸­ /etc/issueã€/etc/issue.net é€šå¸¸åœ¨æœªç™»å½•ç»ˆç«¯å‰æ˜¾ç¤ºï¼Œ/etc/motdã€/run/motd.dynamic åˆ™æ˜¯åœ¨æˆåŠŸç™»å½•ç»ˆç«¯åæ˜¾ç¤ºã€‚</p><p>æ­¤å¤–è¿˜æœ‰ /etc/profile ä¸ /etc/profile.d/ï¼Œåœ¨ç™»å½•åä¼šè¿è¡Œå…¶ä¸­çš„è„šæœ¬ã€‚</p><a id="more"></a><h2 id="å“ªé‡Œ-get-åˆ°å¥½åº·çš„æç¤ºä¿¡æ¯">å“ªé‡Œ Get åˆ°å¥½åº·çš„æç¤ºä¿¡æ¯ï¼Ÿ</h2><h3 id="asciiworld">ASCiiWorld</h3><p>åœ¨ AsciiWorld ä¸­æä¾›äº†ç°æˆçš„å›¾æ¡ˆï¼Œå·¦ä¾§å¯æŒ‰ç…§åˆ†ç±»æ¥æœå¯»è‡ªå·±éœ€è¦çš„å­—ç¬¦ç”»ã€‚ä¸è¿‡ ASCiiWorld å†å²æ‚ ä¹…ï¼Œä¸Šé¢çš„å­—ç¬¦ç”»ç¨æ˜¾é™ˆæ—§ï¼Œä¸å¤ªç¬¦åˆæˆ‘çš„å®¡ç¾ï¼Œå“ˆå“ˆå“ˆã€‚</p><p><img src="https://cdn.sspai.com/2020/03/04/57a737ad43d131f259820d9b410d886b.png" alt=""></p><p>ASCiiWorld</p><p>ç½‘ç«™é“¾æ¥ï¼š<a href="http://www.asciiworld.com/" target="_blank" rel="noopener">http://www.asciiworld.com/</a></p><h3 id="é€šè¿‡å›¾ç‰‡è½¬æ¢">é€šè¿‡å›¾ç‰‡è½¬æ¢</h3><p>V å‹ Kokodayo åŸºäº Img2Motd å¼€å‘äº†ç½‘é¡µç‰ˆçš„ å›¾ç‰‡è½¬ Linux Shell å½©è‰²æ–‡æœ¬ã€‚è¯•äº†ä¸€ä¸‹è¿˜æŒºå¥½ç©çš„äºšå­ï¼Œä¸è¿‡å¯¹å›¾ç‰‡å’Œç»ˆç«¯çš„è¦æ±‚æœ‰ç‚¹é«˜ã€‚å›¾ç‰‡çš„é•¿å®½å°½é‡æ§åˆ¶åœ¨ 100 * 100 ä»¥å†…ï¼ŒåŒæ—¶å°½é‡é¿å…ä½¿ç”¨è¿‡äºå¤æ‚çš„å›¾æ¡ˆã€‚</p><p><img src="https://cdn.sspai.com/2020/03/04/7eb2b4325eed153625ce2cb027fae6b8.png" alt=""></p><p>Bakaya-Motd</p><p>ç½‘ç«™é“¾æ¥ï¼š<a href="https://motd.bakaya.ro/" target="_blank" rel="noopener">https://motd.bakaya.ro/</a></p><h3 id="æ–‡å­—ç‰¹æ•ˆ">æ–‡å­—ç‰¹æ•ˆ</h3><p>Patorjk å¯ä»¥æ ¹æ®è‡ªå·±è¾“å…¥çš„æ–‡å­—ï¼Œå¹¶é€‰æ‹©å¯¹åº”çš„å­—ä½“æ¥ç”Ÿæˆå­—ç¬¦ç”»ï¼Œå­—ä½“ç§ç±»æ¯”è¾ƒä¸°å¯Œï¼ˆè€æ¿ï¼šæ¯å¤©ç»™æˆ‘æ¢ 150 ç§ï¼Œä½†é—æ†¾çš„æ˜¯ç”Ÿæˆè¯­è¨€ä»…æ”¯æŒè‹±æ–‡ï¼Œå¦‚æœæœ‰ä¸­æ–‡ç”Ÿæˆéœ€è¦çš„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ ASCii å­—ç¬¦ç”»ç”Ÿæˆå™¨æ¥å®ç°ã€‚</p><p><img src="https://cdn.sspai.com/2020/03/04/aac68b477cef72eea48c0534e2b954b9.png" alt=""></p><p>Patorjk</p><p>ç½‘ç«™é“¾æ¥ï¼š<a href="http://patorjk.com/software/taag/" target="_blank" rel="noopener">http://patorjk.com/software/taag/</a></p><h3 id="neofetch">Neofetch</h3><p>å½“ç„¶ï¼Œé™¤äº†é™æ€çš„å­—ç¬¦ç”»ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€äº›å·¥å…·æ¥åŠ¨æ€æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ã€‚</p><p>Neofetch æ˜¯ä¸€æ¬¾ç”¨äºæ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯çš„è„šæœ¬ï¼ŒåŒç±»çš„å·¥å…·è¿˜æœ‰ ScreenFetch å’Œ Linux_Logoã€‚Neofetch é™¤äº†å¯ä»¥æ˜¾ç¤º ASCii å­—ç¬¦ç”»ï¼Œè¿˜å¯ä»¥é€šè¿‡ w3m-img ç­‰è¿è¡Œåº“åœ¨ç»ˆç«¯ä¸­æ˜¾ç¤ºå…¨å½©å›¾ç‰‡ï¼ˆä¸è¿‡æˆ‘è¿˜æ²¡æŠ˜è…¾å‡ºæ¥ï¼Œæ²¡ææ‡‚æ˜¯ç»ˆç«¯çš„åŸå› è¿˜æ˜¯å…¶å®ƒä»€ä¹ˆåŸå› ã€‚</p><p><img src="https://cdn.sspai.com/2020/03/04/083f03f3d42afafec9aace46d31351b3.png" alt=""></p><p>Neofetch</p><blockquote><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/dylanaraps/neofetch/" target="_blank" rel="noopener">https://github.com/dylanaraps/neofetch/</a></p></blockquote><ol><li>å®‰è£…æ–¹æ³•</li></ol><ul><li>Debian / Ubuntu</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt update &amp;&amp; apt upgrade -y</span><br><span class="line">$ apt install neofetch -y</span><br></pre></td></tr></table></figure><ul><li>CentOS / Fedora / RHEL</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ yum update &amp;&amp; yum upgrade -y</span><br><span class="line">$ yum install dnf-plugins-core -y</span><br><span class="line">$ dnf copr enable konimex&#x2F;neofetch</span><br><span class="line">$ dnf install neofetch</span><br></pre></td></tr></table></figure><ul><li>macOS</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install neofetch</span><br></pre></td></tr></table></figure><p>æ›´å¤š Neofetch çš„ç©æ³•å¯ä»¥å‚è€ƒ Neofetch-Wikiï¼Œæ¯”å¦‚è¯´é€šè¿‡ w3m-img å±•ç¤ºå…¨å½©å›¾ç‰‡ã€æ˜¾ç¤ºæ¡Œé¢æˆªå›¾ã€ä¿®æ”¹æ˜¾ç¤ºä¿¡æ¯çš„ç±»å‹ã€æ˜¾ç¤ºä¸»æœºçš„æ‰©å±•ä¿¡æ¯ç­‰ç­‰ï¼Œåœ¨æ­¤ä¸åšè¿‡å¤šé˜è¿°ã€‚</p><ol start="2"><li>æ›´æ”¹æ–¹æ³•</li></ol><ul><li><p>é™æ€ Motdï¼šå¦‚æœæ˜¯ä»å›¾ç‰‡è½¬æ¢çš„ï¼Œé‚£ä¹ˆå°†æ–° Motd æ›´åä¸º motd ä¸Šä¼ è‡³ /etc ç›®å½•ä¸­ï¼Œé‡æ–°ç™»å½•ç»ˆç«¯å³å¯ç”Ÿæ•ˆã€‚</p></li><li><p>åŠ¨æ€ Motdï¼šåœ¨ Ubuntu 16.04 ï¼ˆå…¶å®ƒç³»ç»ŸåŒç†ï¼‰åï¼Œå¯ç”¨äº†åŠ¨æ€ Motdï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦å°†ç”Ÿæˆçš„ motd æ–‡ä»¶å†™å…¥è‡³ /etc/update-motd.d/30-banner ä¸­çš„å¯¹åº”ä½ç½®ã€‚</p></li><li><p>Neofetchï¼šåœ¨ /etc/profile.d/ åˆ›å»ºä¸€ä¸ªåä¸º <a href="http://neofetch.sh" target="_blank" rel="noopener">neofetch.sh</a> çš„è„šæœ¬ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜åé‡æ–°ç™»å…¥ SSH å³å¯ç”Ÿæ•ˆã€‚</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#&#x2F;bin&#x2F;sh</span><br><span class="line">neofetch</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ•ˆæœ</p><p><img src="https://cdn.sspai.com/2020/03/04/dac33bf6a775a51c33826f95d30f153e.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1" alt=""></p><p>Patorjk</p><p><img src="https://cdn.sspai.com/2020/03/04/ae6a16a19a582d1e3cedfe06b0afff0b.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1" alt=""></p><p>Neofetch</p><p><img src="https://cdn.sspai.com/2020/03/04/ae6a16a19a582d1e3cedfe06b0afff0b.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1" alt=""></p><p>Neofetch in macOS</p><h2 id="ç»“è¯­">ç»“è¯­</h2><p>æœ‰äººä¹Ÿè®¸ä¼šè®¤ä¸ºä¿®æ”¹ Motd çº¯å±æ˜¯ã€Œå¾’å¢åŠŸè€—ã€æ–¹å‘é”™äº†ã€ï¼Œä½†æˆ‘ä¸ªäººè§‰å¾—ï¼Œé™¤äº†èƒ½å¤Ÿè®©ä½ çš„ç»ˆç«¯æ›´åŠ æœ‰è¶£ï¼Œè¿˜èƒ½å¤Ÿåœ¨ä½ ç™»å½•ç»ˆç«¯å‰æ˜¾ç¤ºä¸»æœºçš„é‡è¦ä¿¡æ¯ï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€Œrm -rf /*ã€ã€‚</p><p>å¦‚æœä½ æœ‰æ›´å¤šæœ‰è¶£ã€æ–°å¥‡çš„ç©æ³•ï¼Œä¸å¦¨åœ¨è®¨è®ºåŒºä¸­å’Œå¤§å®¶ä¸€èµ·åˆ†äº«ã€‚å–œæ¬¢è¿™ç¯‡æ–‡ç« çš„è¯ï¼Œä¸è¦å¿˜è®°ç‚¹èµã€åˆ†äº«å’Œå…³æ³¨å“¦ã€‚</p><h3 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h3><ul><li><p>Linux å…¬ç¤¾ï¼šbashçš„ç™»å½•ä¸æ¬¢è¿ä¿¡æ¯: /etc/issue,/etc/motd</p></li><li><p>æ—·ä¸–çš„å¿§ä¼¤ï¼šLinux æœåŠ¡å™¨ç»´æŠ¤ç®€æ˜“æŒ‡å—</p></li><li><p>Kokodayoï¼šåœ¨ Linux Shell çš„ç™»å½•æ¬¢è¿è¯­é‡Œâ€¦â€¦æ”¾â€œå›¾ç‰‡â€ï¼</p></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œé¸Ÿä¹‹è¨€è¯­ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/qqczh4n%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/qqczh4nï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨æˆ‘ä»¬ç™»å…¥ macOS çš„ç»ˆç«¯åï¼Œç»ˆç«¯å¾€å¾€ä¼šå¼¹å‡ºä¸€æ®µæ¬¢è¿ä¿¡æ¯ï¼Œæ˜¾ç¤ºç™»å½•ä¸»æœºã€ä¸»æœºä¾›åº”å•†æç¤ºç­‰ä¿¡æ¯ã€‚ä½†æ¯æ¬¡çœ‹åˆ°çš„éƒ½æ˜¯åŒæ ·çš„ä¿¡æ¯éš¾å…æœ‰äº›åŒå€¦ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¿®æ”¹ Motd æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ SSH åŠ ç‚¹æ–™ï¼Œè®©å®ƒæ›´åŠ å¥½çœ‹å’Œæœ‰è¶£ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æç¤º&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.sspai.com/2020/03/04/119ed2f44f8c779e52e5d0b61f0572b0.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;åŸç†&quot;&gt;åŸç†&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ç±» Unix ç³»ç»Ÿä¸­ï¼Œ/etc/motd æ˜¯ä¸€ä¸ªåŒ…å«ã€Œä»Šæ—¥æ¶ˆæ¯ï¼ˆMessage of the dayï¼‰ã€çš„æ–‡ä»¶ã€‚æ¯”èµ·ç”µå­é‚®ä»¶ï¼Œä½¿ç”¨ Motd ç»™æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯æ˜¾å¾—æ›´æœ‰æ•ˆç‡ã€‚å…¶å®ƒæ“ä½œç³»ç»Ÿä¸­ä¹Ÿå¯èƒ½æœ‰è¿™ä¸€åŠŸèƒ½ï¼Œæ¯”å¦‚ Multics ä¸­çš„ Motd ä¿¡æ¯åˆ†æ®µã€‚/etc/motd çš„å†…å®¹ä¼šåœ¨ç”¨æˆ·æˆåŠŸç™»å½•åç”± Unix ç™»å½•å‘½ä»¤æ˜¾ç¤ºï¼Œæ•´ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨ Shell ç™»å½•ä¹‹å‰ã€‚è¾ƒæ–°çš„ç±» Unix ç³»ç»Ÿå¯ä»¥ç”ŸæˆåŠ¨æ€æ¶ˆæ¯ã€‚ï¼­otd ä¹Ÿè¢«è¿ç”¨åœ¨å…¶å®ƒé¢†åŸŸï¼Œæ¯”å¦‚ IRC æœåŠ¡å™¨ã€åŠæ¡å‘½ç³»åˆ—æ¸¸æˆç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¥æºï¼šç»´åŸºç™¾ç§‘&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Linux ç³»ç»Ÿé€šè¿‡ /etc/issueã€/etc/issue.netã€/etc/motd ä»¥åŠ /run/motd.dynamic æ¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…æ˜¯è¿œç¨‹ç™»å½•åçš„æç¤ºä¿¡æ¯ï¼Œè¿™ä¸ªæç¤ºä¿¡æ¯é€šå¸¸ç”¨äºå‘ç”¨æˆ·å±•ç¤ºç³»ç»Ÿç‰ˆæœ¬ã€ç¡¬ä»¶å‚æ•°ç­‰ä¿¡æ¯ã€‚å…¶ä¸­ /etc/issueã€/etc/issue.net é€šå¸¸åœ¨æœªç™»å½•ç»ˆç«¯å‰æ˜¾ç¤ºï¼Œ/etc/motdã€/run/motd.dynamic åˆ™æ˜¯åœ¨æˆåŠŸç™»å½•ç»ˆç«¯åæ˜¾ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–è¿˜æœ‰ /etc/profile ä¸ /etc/profile.d/ï¼Œåœ¨ç™»å½•åä¼šè¿è¡Œå…¶ä¸­çš„è„šæœ¬ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="å·¥å…·" scheme="https://www.hi-linux.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>æ¨èä¸€æ¬¾å¯åœ¨çº¿è®¿é—®ä»»æ„ Pod çš„ç¥å™¨ Podtnlï¼ˆæ— éœ€æš´éœ²æœåŠ¡ï¼‰</title>
    <link href="https://www.hi-linux.com/posts/57908.html"/>
    <id>https://www.hi-linux.com/posts/57908.html</id>
    <published>2020-05-26T01:00:00.000Z</published>
    <updated>2020-05-26T05:49:20.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p><code>Podtnl</code> æ˜¯ä¸€ä¸ªä¸é€šè¿‡æš´éœ² <code>Kubernetes Service</code> æœåŠ¡ä¹Ÿå¯ä»¥åœ¨çº¿è®¿é—® <code>Pod</code> çš„ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ <code>CLI</code> å·¥å…·ã€‚</p><blockquote><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/narendranathreddythota/podtnl" target="_blank" rel="noopener">https://github.com/narendranathreddythota/podtnl</a></p></blockquote><p><code>Podtnl</code> ä½¿ç”¨äº†ä¸¤ä¸ªä¸»è¦çš„æ¦‚å¿µï¼šç«¯å£è½¬å‘å’Œéš§é“ã€‚<code>Podtnl</code> ä½¿ç”¨éå¸¸ç®€å•ï¼Œç‰¹åˆ«æ˜¯åœ¨åº”ç”¨å¼€å‘é˜¶æ®µéå¸¸æœ‰ç”¨ï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒæœ‰æ²¡æœ‰åˆ›å»º <code>Ingress</code>ã€<code>LoadBalancer</code> ç­‰èµ„æºã€‚</p><p><img src="https://www.hi-linux.com/img/linux/tunnel.png" alt=""></p><h3 id="podtnl-å®‰è£…">Podtnl å®‰è£…</h3><p>ç›´æ¥ä¸‹è½½ <code>GitHub</code> ä»“åº“ä¸Š <code>Release</code> çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¼€ç®±å³ç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget https:&#x2F;&#x2F;github.com&#x2F;narendranathreddythota&#x2F;podtnl&#x2F;releases&#x2F;download&#x2F;1.0&#x2F;podtnl</span><br><span class="line">$ chmod +x podtnl</span><br><span class="line">$ mv podtnl &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨ <code>macOS</code>ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>Homebrew</code> è¿›è¡Œå®‰è£…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap narendranathreddythota&#x2F;podtnl</span><br><span class="line">$ brew install podtnl</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="podtnl-ä½¿ç”¨">Podtnl ä½¿ç”¨</h3><p>è¦ä½¿ç”¨ <code>Podtnl</code> ï¼Œä½ éœ€è¦å…ˆæä¾›ä¸€ä¸ªéš§é“ã€‚ç›®å‰ <code>Podtnl</code> åªæ”¯æŒ <code>Ngrok</code> ä½œä¸ºéš§é“æä¾›å•†ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…é…ç½®å¥½ <code>Ngrok</code>ã€‚ä½ å¯ä»¥é€šè¿‡åœ°å€ <code>https://dashboard.ngrok.com/get-started/setup</code> è¿›è¡Œé…ç½®ã€‚</p><p>å½“ <code>Podtnl</code> å’Œ <code>Ngrok</code> éƒ½é…ç½®å¥½è¿‡åï¼Œå³å¯ä½¿ç”¨ <code>Podtnl</code>ã€‚ <code>Podtnl</code> å¯ä»¥ä½¿ç”¨çš„ä¸€äº›å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Available Flage</span><br><span class="line">  version        : Output Podtnl Version</span><br><span class="line">  provider       : Input Tunnel Provider</span><br><span class="line">  providerPath   : Input Tunnel Provider Path</span><br><span class="line">  podname        : Input Pod Name</span><br><span class="line">  protocol       : Input Type of Protocol</span><br><span class="line">  namespace      : Input Namespace</span><br><span class="line">  podport        : Input Pod Port</span><br><span class="line">  auth           : Need Authentication ? Applicable for HTTP</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼šå½“å‰ <code>Kubernetes</code> é›†ç¾¤ä¸­åœ¨ <code>kube-ops</code> å‘½åç©ºé—´ä¸‹é¢æœ‰å¦‚ä¸‹ä¸€ä¸ª <code>Pod</code>ï¼Œå®¹å™¨æš´éœ² <code>8080</code> ç«¯å£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kube-ops</span><br><span class="line">NAME                                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">devops-name-devops-demo-7cf5fcc5c6-j76h5         1&#x2F;1     Running   0          3d14h</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤æ¥ç›´æ¥æš´éœ²è¯¥ <code>Pod</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ podtnl -provider ngrok -podname devops-name-devops-demo-7cf5fcc5c6-j76h5 -podport 8080 -namespace kube-ops</span><br><span class="line">[INFO] ...Tunnel provider ngrok</span><br><span class="line">[INFO] NGROK is Ready</span><br><span class="line">[INFO] Username: hBIHNsBB3G3OFQ8vj7lm8WXC17EybR59</span><br><span class="line">[INFO] Password: fRJrZs3mtvTSWLKpFa2VcxVjCw5RexbVHnxirWqPqL44K47Q4VMetM4McwFZBJFm</span><br><span class="line">Forwarding from 127.0.0.1:8080 -&gt; 8080</span><br><span class="line">Forwarding from [::1]:8080 -&gt; 8080</span><br><span class="line">[INFO] mytunnel is created and Live: -&gt; https:&#x2F;&#x2F;c13f78fe.ngrok.io</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢ç”Ÿæˆçš„åœ°å€ <code>https://c13f78fe.ngrok.io</code> æ¥ç›´æ¥è®¿é—®è¯¥ <code>Pod</code>ã€‚é»˜è®¤ä¼šä½¿ç”¨ <code>Basic Auth</code> è®¤è¯æ–¹å¼ï¼Œä½¿ç”¨ä¸Šé¢ç”Ÿæˆçš„ <code>Username</code> å’Œ <code>Password</code> å³å¯è®¤è¯ã€‚</p><p>å¦‚æœ <code>Pod</code> æ˜¯ <code>TCP</code> æœåŠ¡éœ€è¦ç›´æ¥æš´éœ²ï¼Œåˆ™éœ€æ·»åŠ  <code>protocol</code> å‚æ•°æŒ‡å®šå³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ podtnl -provider ngrok -podname orderer1-7cb4b7565-nv95k -podport 7050 -protocol tcp</span><br><span class="line"></span><br><span class="line">Expected Output:</span><br><span class="line">[INFO] ...Tunnel provider ngrok</span><br><span class="line">[INFO] NGROK is Ready</span><br><span class="line">[INFO] mytunnel is created and Live: -&gt; tcp:&#x2F;&#x2F;0.tcp.ngrok.io:10467</span><br><span class="line"></span><br><span class="line">^C[WARN] Shutting down all open tunnels..</span><br><span class="line">[DBUG] Closing tunnel in tcp:&#x2F;&#x2F;0.tcp.ngrok.io:10467</span><br></pre></td></tr></table></figure><p>æ›´å¤šå¥½ç”¨çš„ç©æ³•ï¼Œä½ å¯ä»¥å» ã€Œ<a href="https://github.com/narendranathreddythota/podtnl" target="_blank" rel="noopener">Podtnl å®˜ç½‘</a>ã€è¿›è¡Œæ¢ç´¢å“Ÿï¼</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œk8s æŠ€æœ¯åœˆã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y6urwkgt%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/y6urwkgtï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <code>editor@hi-linux.com</code> ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;Podtnl&lt;/code&gt; æ˜¯ä¸€ä¸ªä¸é€šè¿‡æš´éœ² &lt;code&gt;Kubernetes Service&lt;/code&gt; æœåŠ¡ä¹Ÿå¯ä»¥åœ¨çº¿è®¿é—® &lt;code&gt;Pod&lt;/code&gt; çš„ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ &lt;code&gt;CLI&lt;/code&gt; å·¥å…·ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&quot;https://github.com/narendranathreddythota/podtnl&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/narendranathreddythota/podtnl&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;Podtnl&lt;/code&gt; ä½¿ç”¨äº†ä¸¤ä¸ªä¸»è¦çš„æ¦‚å¿µï¼šç«¯å£è½¬å‘å’Œéš§é“ã€‚&lt;code&gt;Podtnl&lt;/code&gt; ä½¿ç”¨éå¸¸ç®€å•ï¼Œç‰¹åˆ«æ˜¯åœ¨åº”ç”¨å¼€å‘é˜¶æ®µéå¸¸æœ‰ç”¨ï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒæœ‰æ²¡æœ‰åˆ›å»º &lt;code&gt;Ingress&lt;/code&gt;ã€&lt;code&gt;LoadBalancer&lt;/code&gt; ç­‰èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.hi-linux.com/img/linux/tunnel.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Podtnl-å®‰è£…&quot;&gt;Podtnl å®‰è£…&lt;/h3&gt;
&lt;p&gt;ç›´æ¥ä¸‹è½½ &lt;code&gt;GitHub&lt;/code&gt; ä»“åº“ä¸Š &lt;code&gt;Release&lt;/code&gt; çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¼€ç®±å³ç”¨ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ wget https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;narendranathreddythota&amp;#x2F;podtnl&amp;#x2F;releases&amp;#x2F;download&amp;#x2F;1.0&amp;#x2F;podtnl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ chmod +x podtnl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ mv podtnl &amp;#x2F;usr&amp;#x2F;local&amp;#x2F;bin&amp;#x2F;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨ &lt;code&gt;macOS&lt;/code&gt;ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ &lt;code&gt;Homebrew&lt;/code&gt; è¿›è¡Œå®‰è£…ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ brew tap narendranathreddythota&amp;#x2F;podtnl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ brew install podtnl&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>å†…ç½‘ç©¿é€ç¥å™¨ ZeroTier ä½¿ç”¨æ•™ç¨‹</title>
    <link href="https://www.hi-linux.com/posts/33914.html"/>
    <id>https://www.hi-linux.com/posts/33914.html</id>
    <published>2020-05-25T01:00:00.000Z</published>
    <updated>2020-05-25T09:18:23.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>éšç€å¯ç”¨çš„å…¬ç½‘ IPv4 åœ°å€è¶Šæ¥è¶Šå°‘ï¼Œç°åœ¨çš„è¿è¥å•†åŸºæœ¬ä¸ç»™å®¶ç”¨å®½å¸¦åˆ†é…å…¬ç½‘ IP äº†ã€‚å¦‚æœä½ æƒ³é€šè¿‡å¤–ç½‘è®¿é—®åˆ°å†…ç½‘çš„èµ„æºï¼Œç›®å‰åªèƒ½é‡‡ç”¨å†…ç½‘ç©¿é€çš„è½¯ä»¶æ¥å®ç°ã€‚è€Œä¸€èˆ¬å¸¸è§„çš„å†…ç½‘ç©¿é€è½¯ä»¶éƒ½éœ€è¦ä¸€ä¸ªå…¬ç½‘ IP æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œæ¯”å¦‚ï¼šã€Œ<a href="https://mp.weixin.qq.com/s?__biz=MzI3MTI2NzkxMA==&amp;mid=2247485670&amp;idx=1&amp;sn=df62f2df93f112a7bc0b8d7e843bbc16&amp;chksm=eac529cfddb2a0d9b0fb22324f3eaf5cffeb8e0a56d16efb87ad97d3cca6479e96e12c68eb88&amp;token=211998253&amp;lang=zh_CN#rd" target="_blank" rel="noopener">FRP</a>ã€ æˆ– ã€Œ<a href="https://mp.weixin.qq.com/s?__biz=MzI3MTI2NzkxMA==&amp;mid=2247483754&amp;idx=1&amp;sn=c701d750ea87421446ec2f3202beab33&amp;chksm=eac52043ddb2a955c282f8337d6c0fc63034f3f9e378ae1b1fcc0b53be1f20c8b4f55c159c94&amp;token=211998253&amp;lang=zh_CN#rd" target="_blank" rel="noopener">Ngork</a>ã€ ç­‰ã€‚è¿™æ ·ä½ å°±ä¸å¾—ä¸ç§Ÿç”¨ä¸€ä¸ªæ‹¥æœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨æ‰èƒ½å®ç°ä¸Šè¿°éœ€æ±‚ï¼Œæ˜¾ç„¶å¢åŠ äº†ä¸å°‘ä½¿ç”¨æˆæœ¬ã€‚</p><p>åšä¸ºä¸€ä¸ª<code>æœˆè–ª 3000</code> çš„å±Œä¸æ€ä¹ˆå¯èƒ½æŠ˜è…¾å¾—èµ·å‘¢ï¼Ÿä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€æ¬¾ä¸éœ€è¦å…¬ç½‘ IP å®ç°å†…ç½‘ç©¿é€çš„å·¥å…· <code>ZeroTier</code> ã€‚<code>ZeroTier</code> æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥å»ºç«‹ç‚¹å¯¹ç‚¹è™šæ‹Ÿä¸“ç”¨ç½‘ï¼ˆ<code>P2P VPN</code>ï¼‰çš„å·¥å…·ï¼Œå®ƒæä¾›åœ¨çº¿ç®¡ç†ç•Œé¢å’Œå…¨å¹³å°çš„å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦å¤æ‚è®¾ç½®ï¼Œåªè¦å®‰è£…å®¢æˆ·ç«¯å¹¶åŠ å…¥åˆ°è‡ªå·±åˆ›å»ºçš„ç½‘ç»œå³å¯ã€‚</p><blockquote><ol><li><p>å®˜æ–¹ç½‘ç«™åœ°å€ï¼š<a href="https://www.zerotier.com" target="_blank" rel="noopener">https://www.zerotier.com</a></p></li><li><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/zerotier" target="_blank" rel="noopener">https://github.com/zerotier</a></p></li></ol></blockquote><a id="more"></a><h2 id="zerotier-åŸç†">ZeroTier åŸç†</h2><p><code>ZeroTier</code> è¿™ä¸€ç±» <code>P2P VPN</code> æ˜¯åœ¨äº’è”ç½‘çš„åŸºç¡€ä¸Šå°†è‡ªå·±çš„æ‰€æœ‰è®¾å¤‡ç»„æˆä¸€ä¸ªç§æœ‰çš„ç½‘ç»œï¼Œå¯ä»¥ç†è§£ä¸ºäº’è”ç½‘è¿æ¥çš„å±€åŸŸç½‘ã€‚æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯åœ¨å…¬å¸å¯ä»¥ç”¨æ‰‹æœºç›´æ¥è®¿é—®å®¶é‡Œçš„ <code>NAS</code>ï¼Œè€Œä¸”æ˜¯ç‚¹å¯¹ç‚¹ç›´è¿ï¼Œæ•°æ®ä¼ è¾“å¹¶ä¸ç»ç”±ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ä¸­è½¬ã€‚</p><p><code>Zerotier</code> åœ¨å¤šè®¾å¤‡ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ª <code>Peer to Peer VPNï¼ˆP2PVPNï¼‰</code> è¿æ¥ï¼Œå¦‚ï¼šåœ¨ç¬”è®°æœ¬ç”µè„‘ã€å°å¼æœºã€åµŒå…¥å¼è®¾å¤‡ã€äº‘èµ„æºå’Œåº”ç”¨ã€‚è¿™äº›è®¾å¤‡åªéœ€è¦é€šè¿‡ <code>ZeroTier One</code> ( ZeroTier çš„å®¢æˆ·ç«¯) åœ¨ä¸åŒè®¾å¤‡ä¹‹é—´å»ºç«‹ç›´æ¥è¿æ¥ï¼Œå³ä½¿å®ƒä»¬ä½äº <code>NAT</code> ä¹‹åã€‚è¿æ¥åˆ°è™šæ‹Ÿ <code>LAN</code> çš„ä»»ä½•è®¡ç®—æœºå’Œè®¾å¤‡é€šå¸¸é€šè¿‡ <code>NAT</code> æˆ–è·¯ç”±å™¨è®¾å¤‡ä¸ <code>Internet</code> è¿æ¥ï¼Œ<code>ZeroTier One</code> ä½¿ç”¨ <code>STUN</code> å’Œéš§é“æ¥å»ºç«‹ <code>NAT</code> åè®¾å¤‡ä¹‹é—´çš„ <code>VPN</code> ç›´è¿ã€‚</p><p>ç®€å•ä¸€ç‚¹è¯´ï¼Œ<code>Zerotier</code> å°±æ˜¯é€šè¿‡ <code>P2P</code> ç­‰æ–¹å¼å®ç°å½¢å¦‚äº¤æ¢æœºæˆ–è·¯ç”±å™¨ä¸Š <code>LAN</code> è®¾å¤‡çš„å†…ç½‘äº’è”ã€‚</p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/zerotier-network.png" alt=""></p><p><code>ZeroTier</code> å®˜æ–¹æ­å»ºäº†ä¸€ä¸ªè¡Œæ˜Ÿæ ¹æœåŠ¡å™¨å«åš <code>åœ°çƒ Earth</code>ï¼Œè¿™ä¸ªè¡Œæ˜Ÿæ ¹æœåŠ¡å™¨æ˜¯å”¯ä¸€ä¸”æ˜¯å…è´¹çš„ï¼Œå®ƒè®°å½•äº†æ‰€æœ‰çš„è·¯å¾„ä¿¡æ¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¤§å®¶éƒ½ç›´æ¥ç”¨çš„è¿™ä¸ªã€‚</p><p>è¡Œæ˜Ÿæ ¹æœåŠ¡å™¨ R è®°å½•äº†æ‰€æœ‰çš„è·¯å¾„ä¿¡æ¯ï¼Œè®¾å¤‡ A èƒ½é€šè¿‡ <code>ZeroTier</code> å”¯ä¸€åœ°å€æ ‡è¯†æ‰¾åˆ°éœ€è¦è¿æ¥çš„è®¾å¤‡ Bã€‚è¿™ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>A æƒ³è¦å°†æ•°æ®åŒ…å‘é€åˆ° Bï¼Œä½†ç”±äºå®ƒæ²¡æœ‰ç›´æ¥è·¯å¾„ï¼Œå› æ­¤å°†å…¶å‘ä¸Šå‘é€åˆ° Rã€‚</p></li><li><p>å¦‚æœ R æœ‰ç›´æ¥é“¾æ¥åˆ° Bï¼Œå®ƒä¼šè½¬å‘æ•°æ®åŒ…ç»™ Bã€‚å¦åˆ™å®ƒä¼šç»§ç»­å‘ä¸Šæ¸¸å‘é€æ•°æ®åŒ…ï¼Œç›´åˆ°è¾¾åˆ°è¡Œæ˜Ÿæ ¹ (planet)ã€‚è¡Œæ˜Ÿæ ¹çŸ¥é“æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¦‚æœ B åœ¨çº¿ï¼Œæœ€ç»ˆæ•°æ®åŒ…å°†åˆ°è¾¾ Bã€‚</p></li><li><p>R è¿˜å‘ A å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼ŒåŒ…å«æœ‰å…³å®ƒå¦‚ä½•åˆ°è¾¾ B çš„æç¤ºã€‚åŒæ—¶ï¼Œå°†æ¶ˆæ¯å‘ç»™ Bï¼Œé€šçŸ¥ B å®ƒå¦‚ä½•åˆ°è¾¾ Aã€‚</p></li><li><p>A å’Œ B è·å–å®ƒä»¬çš„æ¶ˆæ¯å¹¶å°è¯•ç›¸äº’å‘é€æµ‹è¯•æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šå¯¹ NAT æˆ–çŠ¶æ€é˜²ç«å¢™è¿›è¡Œç©¿é€ã€‚å¦‚æœè¿™æ ·å¯ä»¥å»ºç«‹ç›´æ¥é“¾è·¯ï¼Œåˆ™ä¸å†éœ€è¦ä¸­ç»§ã€‚</p></li><li><p>å¦‚æœæ— æ³•å»ºç«‹ç›´æ¥è·¯å¾„ï¼Œåˆ™é€šä¿¡å¯ä»¥ç»§ç»­ä¸­ç»§ (é€Ÿåº¦æ…¢)</p></li></ol><p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ 12 ä¸ªéå¸ƒå…¨çƒçš„æ ¹æœåŠ¡å™¨ï¼Œè¿™äº›æ˜¯æ”¶è´¹çš„æœåŠ¡ã€‚ç”±äº Earth åœ¨å›½å¤–ï¼Œå¦‚æœä½¿ç”¨å…è´¹å¥—é¤ï¼Œè¿æ¥æ—¶çš„å»¶è¿Ÿå¯èƒ½ä¼šå¾ˆé«˜ã€‚ä¸è¿‡ <code>ZeroTier</code> èƒ½è‡ªå·±åˆ›å»ºæ ¹æœåŠ¡å™¨ <code>æœˆçƒ Moons</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨å¤§å±€åŸŸç½‘ä¸­å¾—åˆ°æ›´å¥½çš„ä½“éªŒäº†ã€‚</p><h2 id="æ³¨å†Œä¸å®¢æˆ·ç«¯å®‰è£…">æ³¨å†Œä¸å®¢æˆ·ç«¯å®‰è£…</h2><h3 id="æ³¨å†Œå¸å·">æ³¨å†Œå¸å·</h3><p>ç™»å½•å®˜ç½‘æ³¨å†Œå³å¯ï¼Œå¡«å†™ä½ çš„é‚®ç®±å’Œå¯†ç ã€‚</p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/QQ20190729-220707@2x.png" alt=""></p><p>æ³¨å†Œä¹‹åæ˜¯è¿™æ ·çš„ï¼Œä¿æŒé»˜è®¤å°±å¥½ã€‚æ¯ä¸ªå…è´¹å¥—é¤å¯ä»¥äº«å— 100 å°è®¾å¤‡çš„å†…ç½‘äº’è”ï¼Œä¸€èˆ¬å¤Ÿç”¨äº†ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/ZeroTier3.jpeg" alt=""></p><h3 id="ç½‘ç»œé…ç½®">ç½‘ç»œé…ç½®</h3><p>æ³¨å†Œå¥½ä¹‹åï¼Œæˆ‘ä»¬æ¥å»ºç«‹ä¸€ä¸ª Network å¹¶åˆ†é…å†…ç½‘ç½‘æ®µã€‚</p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/QQ20190729-222030@2x.png" alt=""></p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œä¹‹åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª <code>Network ID</code>ã€‚è¿™æ˜¯å®¢æˆ·ç«¯è¿æ¥åˆ°è¡Œæ˜ŸæœåŠ¡å™¨çš„å”¯ä¸€è¯†åˆ«ç ï¼Œéœ€è¦ç‰¢è®°ã€‚</p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/QQ20190729-222125@2x.png" alt=""></p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/QQ20190730-185605@2x.png" alt=""></p><h3 id="å®¢æˆ·ç«¯é…ç½®">å®¢æˆ·ç«¯é…ç½®</h3><p><code>ZeroTier</code> æ”¯æŒ <code>Windows</code>ã€<code>macOS</code>ã€<code>Linux</code> ä¸‰å¤§æ¡Œé¢å¹³å°ï¼Œ<code>iOS</code>ã€<code>Android</code> ä¸¤å¤§ç§»åŠ¨å¹³å°ï¼Œ<code>QNAPï¼ˆå¨è¿é€šï¼‰</code>ã€<code>Synologyï¼ˆç¾¤æ™–ï¼‰</code>ã€<code>Western Digital MyCloud NASï¼ˆè¥¿éƒ¨æ•°æ®ï¼‰</code> ä¸‰ä¸ª <code>NAS</code> å¹³å°ï¼Œè¿˜æ”¯æŒ <code>OpenWrt/LEDE</code> å¼€æºè·¯ç”±å™¨é¡¹ç›®ã€‚</p><blockquote><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.zerotier.com/download/" target="_blank" rel="noopener">https://www.zerotier.com/download/</a></p></blockquote><p>è¿™é‡Œæˆ‘ä»¬ä»¥ <code>iOS</code> å’Œ <code>Mac</code> è®¾å¤‡ä¸ºä¾‹ä»‹ç»ä¸€ä¸‹å®¢æˆ·ç«¯å¦‚ä½•ä¸ <code>Planet</code> ç›¸è¿æ¥å¹¶åˆ†é…åˆ°å†…ç½‘åœ°å€ã€‚</p><p><code>iOS</code> ä¸‹è½½å¥½ <code>ZeroTier One</code> ä¹‹åï¼Œå¡«å…¥åˆšåˆšçš„ <code>Network ID</code>ï¼Œé…ç½®å¥½ <code>VPN</code> åå°±ä¼šå¯åŠ¨è¿æ¥ã€‚</p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/IMG_9003.png" alt=""></p><p><code>macOS</code> ä½¿ç”¨æ–¹æ³•åŒç†ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œæ“ä½œã€‚</p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/QQ20190730-194142@2x.png" alt=""></p><p>ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œæ“ä½œçš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">$ zerotier-one -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–åœ°å€å’ŒæœåŠ¡çŠ¶æ€</span></span><br><span class="line">$ zerotier-cli status</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥ã€ç¦»å¼€ã€åˆ—å‡ºç½‘ç»œ</span></span><br><span class="line">$ zerotier-cli join <span class="comment"># Network ID</span></span><br><span class="line">$ zerotier-cli leave <span class="comment"># Network ID</span></span><br><span class="line">$ zerotier-cli listnetworks</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ä¼šæ ¹æ® <code>MAC</code> åœ°å€åˆ†é…ç»™è®¾å¤‡ä¸€ä¸ªå”¯ä¸€è®¤è¯å­—ç¬¦ä¸² <code>Node ID</code>ï¼Œå¯ç”¨æ¥åœ¨ <code>Web</code> é…ç½®ç•Œé¢ä¿ç•™è¯¥è®¾å¤‡ä¸è¢«åˆ é™¤ä»¥åŠå¸®åŠ©æˆ‘ä»¬åŒºåˆ†è®¾å¤‡ã€‚</p><h3 id="è®¤è¯è®¾å¤‡å’Œç»„ç½‘">è®¤è¯è®¾å¤‡å’Œç»„ç½‘</h3><p>å›åˆ°ä¸€å¼€å§‹æ³¨å†Œçš„ç½‘é¡µï¼Œä¼šå‘ç°è®¾å¤‡åˆ—è¡¨å½“ä¸­æ–°å¢äº†ä¸¤å°è®¾å¤‡ï¼Œåœ¨å‰é¢çš„æ–¹æ¡†æ‰“é’©å³å¯ã€‚æ ¹æ® <code>Node ID</code> åˆ¤æ–­è®¾å¤‡çš„ç±»å‹ï¼Œç‰¢è®°è®¾å¤‡è¢«åˆ†é…çš„ <code>IP</code> ã€‚</p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/QQ20190730-183819@2x.png" alt=""></p><h3 id="æµ‹è¯•è®¾å¤‡é—´äº’è®¿">æµ‹è¯•è®¾å¤‡é—´äº’è®¿</h3><p>ä¸ºäº†æµ‹è¯•ä¸åŒç½‘ç»œè®¿é—®ï¼š<code>MBP</code> è¿æ¥ç”µä¿¡ç½‘ç»œï¼Œ<code>iPhone</code> è¿æ¥ç§»åŠ¨ <code>4G</code> ç½‘ç»œã€‚</p><p><img src="https://www.newlearner.site/%E2%80%9Cwp-content/uploads%E2%80%9D/2019/07/IMG_9006-e1564489212233.png" alt=""></p><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸè¿æ¥ä¸Šäº† <code>Mac</code> çš„ <code>SSH</code>ã€‚ç”±äºå…è´¹çš„æ ¹æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œå¯èƒ½è®¿é—®é€Ÿåº¦ä¸å¤ªç¨³å®šã€‚</p><blockquote><p>é™¤éä½ æœ‰ä¸¤å°è·¯ç”±å™¨ï¼Œä¸€å°æ”¾åœ¨å®¶é‡Œï¼Œå¦ä¸€å°æ”¾åœ¨å…¬å¸ç­‰åœ°ï¼Œå¹¶ä¸”æœ‰å¤§é‡è®¾å¤‡è¿æ¥äºè¿™ä¸¤å°è·¯ç”±å™¨ä¸”éœ€è¦å†…ç½‘ç©¿é€ï¼Œå¦åˆ™ä¸è¦åœ¨è·¯ç”±å™¨ä¸Šé¢éƒ¨ç½² <code>ZeroTier</code>ï¼Œä»…ä½¿ç”¨å•è®¾å¤‡å®¢æˆ·ç«¯å³å¯ã€‚å¹¶ä¸”ä¸ºäº†è¿æ¥çš„ç¨³å®šæ€§ï¼Œå¼ºçƒˆå»ºè®®è‡ªå·±éƒ¨ç½² <code>Moon</code> èŠ‚ç‚¹ã€‚</p></blockquote><h2 id="å»¶ä¼¸é˜…è¯»">å»¶ä¼¸é˜…è¯»</h2><p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åªä»‹ç»äº† <code>ZeroTier</code> çš„åŸºæœ¬ä½¿ç”¨ã€‚<code>ZeroTier</code> çš„åŠŸèƒ½è¿œä¸æ­¢è¿™äº›ï¼Œå¦‚æœä½ éå¸¸æ„Ÿå…´è¶£è¿˜å¯ä»¥å‚è€ƒä¸‹é¢è¿™äº›æ–‡æ¡£ï¼š</p><blockquote><ol><li>Openwrt ä½¿ç”¨ ZeroTier å®ç°å†…ç½‘ç©¿é€</li></ol><p>é“¾æ¥ï¼š<a href="https://qingsay.com/zerotier-openwrt.html" target="_blank" rel="noopener">https://qingsay.com/zerotier-openwrt.html</a></p><ol start="2"><li>æ— å…¬ç½‘ IP æå®šç¾¤æ™– + ZEROTIER ONE å®ç°å†…ç½‘ç©¿é€</li></ol><p>é“¾æ¥ 1ï¼š<a href="https://www.hao4k.cn/thread-29377-1-1.html" target="_blank" rel="noopener">https://www.hao4k.cn/thread-29377-1-1.html</a></p><p>é“¾æ¥ 2ï¼š<a href="https://zhuanlan.zhihu.com/p/73558450" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/73558450</a></p><ol start="3"><li>ä½¿ç”¨ ZeroTier å»ºç«‹ IPv6 éš§é“</li></ol><p>é“¾æ¥ï¼š<a href="https://moe.best/tutorial/zerotier-ipv6.html" target="_blank" rel="noopener">https://moe.best/tutorial/zerotier-ipv6.html</a></p><ol start="4"><li>åœ¨å®¹å™¨ä¸­ä¸ä¾èµ– TUN/TAP ä½¿ç”¨ ZeroTier å®ç° P2P VPN</li></ol><p>é“¾æ¥ï¼š<a href="http://www.senra.me/nat-traversal-series-zerotier-p2p-vpn-can-be-used-in-container-without-tuntap/" target="_blank" rel="noopener">http://www.senra.me/nat-traversal-series-zerotier-p2p-vpn-can-be-used-in-container-without-tuntap/</a></p><ol start="5"><li>Zerotier ç®€æ˜æ•™ç¨‹</li></ol><p>é“¾æ¥ï¼š<a href="https://jiajunhuang.com/articles/2019_09_11-zerotier.md.html" target="_blank" rel="noopener">https://jiajunhuang.com/articles/2019_09_11-zerotier.md.html</a></p><ol start="6"><li>ä½¿ç”¨ Docker åˆ›å»º ZeroTier Moon èŠ‚ç‚¹</li></ol><p>é“¾æ¥ï¼š<a href="https://www.cnblogs.com/webenh/p/11263421.html" target="_blank" rel="noopener">https://www.cnblogs.com/webenh/p/11263421.html</a></p><ol start="7"><li>Zerotier 2.0 çš„æ„¿æ™¯å›¾</li></ol><p>é“¾æ¥ï¼š<a href="https://www.zealic.com/2019/10/zerotier2/" target="_blank" rel="noopener">https://www.zealic.com/2019/10/zerotier2/</a></p></blockquote><h2 id="æ€»ç»“">æ€»ç»“</h2><p>ä»ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>ZeroTier</code> åœ¨ä½¿ç”¨ä¸Šéå¸¸ç®€å•ã€ä¹Ÿæ”¯æŒå¤šè®¾å¤‡å¤šå¹³å°ï¼Œå¹¶ä¸”å¯ä»¥æ— éœ€å…¬ç½‘æœåŠ¡å™¨ã€‚ä½†ç”±äºå…¶å…è´¹çš„æ ¹æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œå¯èƒ½ç½‘é€Ÿä¼šä¸€å®šå½±å“ï¼Œå»ºè®®è‡ªå»ºç§æœ‰æ ¹æœåŠ¡å™¨ã€‚</p><h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2><ol><li><p><a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></p></li><li><p><a href="https://zhih.me/zerotier-getting-started/" target="_blank" rel="noopener">https://zhih.me/zerotier-getting-started/</a></p></li><li><p><a href="https://www.newlearner.site/2019/07/30/zerotier.html" target="_blank" rel="noopener">https://www.newlearner.site/2019/07/30/zerotier.html</a></p></li></ol></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;éšç€å¯ç”¨çš„å…¬ç½‘ IPv4 åœ°å€è¶Šæ¥è¶Šå°‘ï¼Œç°åœ¨çš„è¿è¥å•†åŸºæœ¬ä¸ç»™å®¶ç”¨å®½å¸¦åˆ†é…å…¬ç½‘ IP äº†ã€‚å¦‚æœä½ æƒ³é€šè¿‡å¤–ç½‘è®¿é—®åˆ°å†…ç½‘çš„èµ„æºï¼Œç›®å‰åªèƒ½é‡‡ç”¨å†…ç½‘ç©¿é€çš„è½¯ä»¶æ¥å®ç°ã€‚è€Œä¸€èˆ¬å¸¸è§„çš„å†…ç½‘ç©¿é€è½¯ä»¶éƒ½éœ€è¦ä¸€ä¸ªå…¬ç½‘ IP æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œæ¯”å¦‚ï¼šã€Œ&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzI3MTI2NzkxMA==&amp;amp;mid=2247485670&amp;amp;idx=1&amp;amp;sn=df62f2df93f112a7bc0b8d7e843bbc16&amp;amp;chksm=eac529cfddb2a0d9b0fb22324f3eaf5cffeb8e0a56d16efb87ad97d3cca6479e96e12c68eb88&amp;amp;token=211998253&amp;amp;lang=zh_CN#rd&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;FRP&lt;/a&gt;ã€ æˆ– ã€Œ&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzI3MTI2NzkxMA==&amp;amp;mid=2247483754&amp;amp;idx=1&amp;amp;sn=c701d750ea87421446ec2f3202beab33&amp;amp;chksm=eac52043ddb2a955c282f8337d6c0fc63034f3f9e378ae1b1fcc0b53be1f20c8b4f55c159c94&amp;amp;token=211998253&amp;amp;lang=zh_CN#rd&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Ngork&lt;/a&gt;ã€ ç­‰ã€‚è¿™æ ·ä½ å°±ä¸å¾—ä¸ç§Ÿç”¨ä¸€ä¸ªæ‹¥æœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨æ‰èƒ½å®ç°ä¸Šè¿°éœ€æ±‚ï¼Œæ˜¾ç„¶å¢åŠ äº†ä¸å°‘ä½¿ç”¨æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;åšä¸ºä¸€ä¸ª&lt;code&gt;æœˆè–ª 3000&lt;/code&gt; çš„å±Œä¸æ€ä¹ˆå¯èƒ½æŠ˜è…¾å¾—èµ·å‘¢ï¼Ÿä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€æ¬¾ä¸éœ€è¦å…¬ç½‘ IP å®ç°å†…ç½‘ç©¿é€çš„å·¥å…· &lt;code&gt;ZeroTier&lt;/code&gt; ã€‚&lt;code&gt;ZeroTier&lt;/code&gt; æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥å»ºç«‹ç‚¹å¯¹ç‚¹è™šæ‹Ÿä¸“ç”¨ç½‘ï¼ˆ&lt;code&gt;P2P VPN&lt;/code&gt;ï¼‰çš„å·¥å…·ï¼Œå®ƒæä¾›åœ¨çº¿ç®¡ç†ç•Œé¢å’Œå…¨å¹³å°çš„å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦å¤æ‚è®¾ç½®ï¼Œåªè¦å®‰è£…å®¢æˆ·ç«¯å¹¶åŠ å…¥åˆ°è‡ªå·±åˆ›å»ºçš„ç½‘ç»œå³å¯ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å®˜æ–¹ç½‘ç«™åœ°å€ï¼š&lt;a href=&quot;https://www.zerotier.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.zerotier.com&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&quot;https://github.com/zerotier&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/zerotier&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="å·¥å…·" scheme="https://www.hi-linux.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="ZeroTier" scheme="https://www.hi-linux.com/tags/ZeroTier/"/>
    
  </entry>
  
  <entry>
    <title>5 åˆ†é’Ÿè¯»æ‡‚ MySQL å››ç§éš”ç¦»çº§åˆ«é—´çš„åŒºåˆ«</title>
    <link href="https://www.hi-linux.com/posts/22448.html"/>
    <id>https://www.hi-linux.com/posts/22448.html</id>
    <published>2020-05-24T01:22:00.000Z</published>
    <updated>2020-05-24T09:38:04.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡">ä»€ä¹ˆæ˜¯äº‹åŠ¡</h2><p>äº‹åŠ¡æ˜¯åº”ç”¨ç¨‹åºä¸­ä¸€ç³»åˆ—ä¸¥å¯†çš„æ“ä½œï¼Œæ‰€æœ‰æ“ä½œå¿…é¡»æˆåŠŸå®Œæˆï¼Œå¦åˆ™åœ¨æ¯ä¸ªæ“ä½œä¸­æ‰€ä½œçš„æ‰€æœ‰æ›´æ”¹éƒ½ä¼šè¢«æ’¤æ¶ˆã€‚ä¹Ÿå°±æ˜¯äº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸€ç³»åˆ—çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸åšã€‚</p><p>äº‹åŠ¡çš„ç»“æŸæœ‰ä¸¤ç§ï¼Œå½“äº‹åŠ¡ä¸­çš„æ‰€ä»¥æ­¥éª¤å…¨éƒ¨æˆåŠŸæ‰§è¡Œæ—¶ï¼Œäº‹åŠ¡æäº¤ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªæ­¥éª¤å¤±è´¥ï¼Œå°†å‘ç”Ÿå›æ»šæ“ä½œï¼Œæ’¤æ¶ˆæ’¤æ¶ˆä¹‹å‰åˆ°äº‹åŠ¡å¼€å§‹æ—¶çš„æ‰€ä»¥æ“ä½œã€‚</p><h2 id="äº‹åŠ¡çš„-acid">äº‹åŠ¡çš„ ACID</h2><p><strong>äº‹åŠ¡å…·æœ‰å››ä¸ªç‰¹å¾ï¼šåŸå­æ€§ï¼ˆ Atomicity ï¼‰ã€ä¸€è‡´æ€§ï¼ˆ Consistency ï¼‰ã€éš”ç¦»æ€§ï¼ˆ Isolation ï¼‰å’ŒæŒç»­æ€§ï¼ˆ Durability ï¼‰ã€‚è¿™å››ä¸ªç‰¹æ€§ç®€ç§°ä¸º ACID ç‰¹æ€§ã€‚</strong></p><ol><li>åŸå­æ€§ï¼šäº‹åŠ¡æ˜¯æ•°æ®åº“çš„é€»è¾‘å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…å«çš„å„æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åš</li><li>ä¸€è‡´æ€§ï¼šäº‹åŠ¡æ‰§è¡Œçš„ç»“æœå¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚å› æ­¤å½“æ•°æ®åº“åªåŒ…å«æˆåŠŸäº‹åŠ¡æäº¤çš„ç»“æœæ—¶ï¼Œå°±è¯´æ•°æ®åº“å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚å¦‚æœæ•°æ®åº“ç³»ç»Ÿ è¿è¡Œä¸­å‘ç”Ÿæ•…éšœï¼Œæœ‰äº›äº‹åŠ¡å°šæœªå®Œæˆå°±è¢«è¿«ä¸­æ–­ï¼Œè¿™äº›æœªå®Œæˆäº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„ä¿®æ”¹æœ‰ä¸€éƒ¨åˆ†å·²å†™å…¥ç‰©ç†æ•°æ®åº“ï¼Œè¿™æ—¶æ•°æ®åº“å°±å¤„äºä¸€ç§ä¸æ­£ç¡®çš„çŠ¶æ€ï¼Œæˆ–è€…è¯´æ˜¯ä¸ä¸€è‡´çš„çŠ¶æ€ã€‚</li><li>éš”ç¦»æ€§ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½å…¶å®ƒäº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å…¶å®ƒå¹¶å‘äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</li><li>æŒç»­æ€§ï¼šä¹Ÿç§°æ°¸ä¹…æ€§ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚æ¥ä¸‹æ¥çš„å…¶å®ƒæ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æ‰§è¡Œç»“æœæœ‰ä»»ä½•å½±å“ã€‚</li></ol><a id="more"></a><h2 id="mysql-çš„å››ç§éš”ç¦»çº§åˆ«">MySQL çš„å››ç§éš”ç¦»çº§åˆ«</h2><p><strong>SQL æ ‡å‡†å®šä¹‰äº† 4 ç±»éš”ç¦»çº§åˆ«ï¼ŒåŒ…æ‹¬äº†ä¸€äº›å…·ä½“è§„åˆ™ï¼Œç”¨æ¥é™å®šäº‹åŠ¡å†…å¤–çš„å“ªäº›æ”¹å˜æ˜¯å¯è§çš„ï¼Œå“ªäº›æ˜¯ä¸å¯è§çš„ã€‚ä½çº§åˆ«çš„éš”ç¦»çº§ä¸€èˆ¬æ”¯æŒæ›´é«˜çš„å¹¶å‘å¤„ç†ï¼Œå¹¶æ‹¥æœ‰æ›´ä½çš„ç³»ç»Ÿå¼€é”€ã€‚</strong></p><h3 id="read-uncommittedè¯»å–æœªæäº¤å†…å®¹">Read Uncommittedï¼ˆè¯»å–æœªæäº¤å†…å®¹ï¼‰</h3><p>åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚æœ¬éš”ç¦»çº§åˆ«å¾ˆå°‘ç”¨äºå®é™…åº”ç”¨ï¼Œå› ä¸ºå®ƒçš„æ€§èƒ½ä¹Ÿä¸æ¯”å…¶ä»–çº§åˆ«å¥½å¤šå°‘ã€‚è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸ºè„è¯»ï¼ˆDirty Readï¼‰ã€‚</p><h3 id="read-committedè¯»å–æäº¤å†…å®¹">Read Committedï¼ˆè¯»å–æäº¤å†…å®¹ï¼‰</h3><p>è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆä½†ä¸æ˜¯ MySQL é»˜è®¤çš„ï¼‰ã€‚å®ƒæ»¡è¶³äº†éš”ç¦»çš„ç®€å•å®šä¹‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚è¿™ç§éš”ç¦»çº§åˆ« ä¹Ÿæ”¯æŒæ‰€è°“çš„ä¸å¯é‡å¤è¯»ï¼ˆNonrepeatable Readï¼‰ï¼Œå› ä¸ºåŒä¸€äº‹åŠ¡çš„å…¶ä»–å®ä¾‹åœ¨è¯¥å®ä¾‹å¤„ç†å…¶é—´å¯èƒ½ä¼šæœ‰æ–°çš„ Commitï¼Œæ‰€ä»¥åŒä¸€ Select å¯èƒ½è¿”å›ä¸åŒç»“æœã€‚</p><h3 id="repeatable-readå¯é‡è¯»">Repeatable Readï¼ˆå¯é‡è¯»ï¼‰</h3><p>è¿™æ˜¯ MySQL çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œã€‚ä¸è¿‡ç†è®ºä¸Šï¼Œè¿™ä¼šå¯¼è‡´å¦ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¹»è¯» ï¼ˆPhantom Readï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå¹»è¯»æŒ‡å½“ç”¨æˆ·è¯»å–æŸä¸€èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åˆåœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°è¡Œï¼Œå½“ç”¨æˆ·å†è¯»å–è¯¥èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œä¼šå‘ç°æœ‰æ–°çš„ â€œå¹»å½±â€ è¡Œã€‚InnoDB å’Œ Falcon å­˜å‚¨å¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼ŒMultiversion Concurrency Controlï¼‰æœºåˆ¶è§£å†³äº†è¯¥é—®é¢˜ã€‚</p><h3 id="serializableå¯ä¸²è¡ŒåŒ–">Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰</h3><p>è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡æ’åºï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»é—®é¢˜ã€‚ç®€è¨€ä¹‹ï¼Œå®ƒæ˜¯åœ¨æ¯ä¸ªè¯»çš„æ•°æ®è¡Œä¸ŠåŠ ä¸Šå…±äº«é”ã€‚åœ¨è¿™ä¸ªçº§åˆ«ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡çš„è¶…æ—¶ç°è±¡å’Œé”ç«äº‰ã€‚</p><p>è¿™å››ç§éš”ç¦»çº§åˆ«é‡‡å–ä¸åŒçš„é”ç±»å‹æ¥å®ç°ï¼Œè‹¥è¯»å–çš„æ˜¯åŒä¸€ä¸ªæ•°æ®çš„è¯ï¼Œå°±å®¹æ˜“å‘ç”Ÿé—®é¢˜ã€‚ä¾‹å¦‚ï¼š</p><p>è„è¯» (Drity Read)ï¼šæŸä¸ªäº‹åŠ¡å·²æ›´æ–°ä¸€ä»½æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ­¤æ—¶è¯»å–äº†åŒä¸€ä»½æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ï¼Œå‰ä¸€ä¸ª RollBack äº†æ“ä½œï¼Œåˆ™åä¸€ä¸ªäº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®å°±ä¼šæ˜¯ä¸æ­£ç¡®çš„ã€‚</p><p>ä¸å¯é‡å¤è¯» (Non-repeatable read):åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½æ˜¯ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„åŸæœ‰çš„æ•°æ®ã€‚</p><p>å¹»è¯» (Phantom Read):åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¸­æ•°æ®ç¬”æ•°ä¸ä¸€è‡´ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢äº†å‡ åˆ— (Row) æ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªäº‹åŠ¡å´åœ¨æ­¤æ—¶æ’å…¥äº†æ–°çš„å‡ åˆ—æ•°æ®ï¼Œå…ˆå‰çš„äº‹åŠ¡åœ¨æ¥ä¸‹æ¥çš„æŸ¥è¯¢ä¸­ï¼Œå°±ä¼šå‘ç°æœ‰å‡ åˆ—æ•°æ®æ˜¯å®ƒå…ˆå‰æ‰€æ²¡æœ‰çš„ã€‚</p><p>åœ¨ MySQL ä¸­ï¼Œå®ç°äº†è¿™å››ç§éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æœ‰å¯èƒ½äº§ç”Ÿé—®é¢˜å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-eceded962ef591d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/686/format/jpg" alt=""></p><h2 id="æµ‹è¯•-mysql-çš„éš”ç¦»çº§åˆ«">æµ‹è¯• MySQL çš„éš”ç¦»çº§åˆ«</h2><p>ä¸‹é¢ï¼Œå°†åˆ©ç”¨ MySQL çš„å®¢æˆ·ç«¯ç¨‹åºï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥æµ‹è¯•ä¸€ä¸‹è¿™å‡ ç§éš”ç¦»çº§åˆ«ã€‚</p><p>æµ‹è¯•æ•°æ®åº“ä¸º demoï¼Œè¡¨ä¸º testï¼›è¡¨ç»“æ„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-14163bb6124dd816.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/616/format/jpg" alt=""></p><p>ä¸¤ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯åˆ†åˆ«ä¸º Aï¼ŒBï¼›ä¸æ–­æ”¹å˜ A çš„éš”ç¦»çº§åˆ«ï¼Œåœ¨ B ç«¯ä¿®æ”¹æ•°æ®ã€‚</p><h3 id="1-å°†-a-çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸º-read-uncommitted-æœªæäº¤è¯»">1. å°† A çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸º Read Uncommitted (æœªæäº¤è¯»)</h3><p><img src="https://upload-images.jianshu.io/upload_images/1627454-66609deaf1f77a2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/708/format/jpg" alt=""></p><p>Aï¼šå¯åŠ¨äº‹åŠ¡ï¼Œæ­¤æ—¶æ•°æ®ä¸ºåˆå§‹çŠ¶æ€</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-895da4e5af710e10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/709/format/jpg" alt=""></p><p>Bï¼šå¯åŠ¨äº‹åŠ¡ï¼Œæ›´æ–°æ•°æ®ï¼Œä½†ä¸æäº¤</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-ebdce5eedc07a388.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/716/format/jpg" alt=""></p><p>Aï¼šå†æ¬¡è¯»å–æ•°æ®ï¼Œå‘ç°æ•°æ®å·²ç»è¢«ä¿®æ”¹äº†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ â€œè„è¯»â€</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-c2076c78c2f8721b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/710/format/jpg" alt=""></p><p>Bï¼šå›æ»šäº‹åŠ¡</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-4e0eb8e5b93e7508.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/716/format/jpg" alt=""></p><p>Aï¼šå†æ¬¡è¯»æ•°æ®ï¼Œå‘ç°æ•°æ®å˜å›åˆå§‹çŠ¶æ€</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-e0c4697a63bb7756.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/710/format/jpg" alt=""></p><p>ç»è¿‡ä¸Šé¢çš„å®éªŒå¯ä»¥å¾—å‡ºç»“è®ºï¼Œäº‹åŠ¡ B æ›´æ–°äº†ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯æ²¡æœ‰æäº¤ï¼Œæ­¤æ—¶äº‹åŠ¡ A å¯ä»¥æŸ¥è¯¢å‡ºæœªæäº¤è®°å½•ã€‚é€ æˆè„è¯»ç°è±¡ã€‚æœªæäº¤è¯»æ˜¯æœ€ä½çš„éš”ç¦»çº§åˆ«ã€‚</p><h3 id="2-å°†å®¢æˆ·ç«¯-a-çš„äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸º-read-committed-å·²æäº¤è¯»">2. å°†å®¢æˆ·ç«¯ A çš„äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸º Read Committed (å·²æäº¤è¯»)</h3><p><img src="https://upload-images.jianshu.io/upload_images/1627454-9850c93ff1d0b87e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/713/format/jpg" alt=""></p><p>Aï¼šå¯åŠ¨äº‹åŠ¡ï¼Œæ­¤æ—¶æ•°æ®ä¸ºåˆå§‹çŠ¶æ€</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-895da4e5af710e10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/709/format/jpg" alt=""></p><p>Bï¼šå¯åŠ¨äº‹åŠ¡ï¼Œæ›´æ–°æ•°æ®ï¼Œä½†ä¸æäº¤</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-ebdce5eedc07a388.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/716/format/jpg" alt=""></p><p>Aï¼šå†æ¬¡è¯»æ•°æ®ï¼Œå‘ç°æ•°æ®æœªè¢«ä¿®æ”¹</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-c27ffc43c74eaff7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/710/format/jpg" alt=""></p><p>Bï¼šæäº¤äº‹åŠ¡</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-e7fcfe11e7bc77f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/706/format/jpg" alt=""></p><p>Aï¼šå†æ¬¡è¯»å–æ•°æ®ï¼Œå‘ç°æ•°æ®å·²å‘ç”Ÿå˜åŒ–ï¼Œè¯´æ˜Bæäº¤çš„ä¿®æ”¹è¢«äº‹åŠ¡ä¸­çš„Aè¯»åˆ°äº†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ â€œä¸å¯é‡å¤è¯»â€</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-f75e52220936ba91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/709/format/jpg" alt=""></p><p>ç»è¿‡ä¸Šé¢çš„å®éªŒå¯ä»¥å¾—å‡ºç»“è®ºï¼Œå·²æäº¤è¯»éš”ç¦»çº§åˆ«è§£å†³äº†è„è¯»çš„é—®é¢˜ã€‚ä½†æ˜¯å‡ºç°äº†ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå³äº‹åŠ¡ A åœ¨ä¸¤æ¬¡æŸ¥è¯¢çš„æ•°æ®ä¸ä¸€è‡´ï¼Œå› ä¸ºåœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´äº‹åŠ¡ B æ›´æ–°äº†ä¸€æ¡æ•°æ®ã€‚å·²æäº¤è¯»åªå…è®¸è¯»å–å·²æäº¤çš„è®°å½•ï¼Œä½†ä¸è¦æ±‚å¯é‡å¤è¯»ã€‚</p><h3 id="3-å°†-a-çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸º-repeatable-read-å¯é‡å¤è¯»">3. å°† A çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸º Repeatable Read (å¯é‡å¤è¯»)</h3><p><img src="https://upload-images.jianshu.io/upload_images/1627454-cd82123669a159e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/711/format/jpg" alt=""></p><p>Aï¼šå¯åŠ¨äº‹åŠ¡ï¼Œæ­¤æ—¶æ•°æ®ä¸ºåˆå§‹çŠ¶æ€</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-034eb70d85fb2765.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/708/format/jpg" alt=""></p><p>Bï¼šå¯åŠ¨äº‹åŠ¡ï¼Œæ›´æ–°æ•°æ®ï¼Œä½†ä¸æäº¤</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-ebdce5eedc07a388.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/716/format/jpg" alt=""></p><p>Aï¼šå†æ¬¡è¯»å–æ•°æ®ï¼Œå‘ç°æ•°æ®æœªè¢«ä¿®æ”¹</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-c27ffc43c74eaff7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/710/format/jpg" alt=""></p><p>Bï¼šæäº¤äº‹åŠ¡</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-e7fcfe11e7bc77f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/706/format/jpg" alt=""></p><p>Aï¼šå†æ¬¡è¯»å–æ•°æ®ï¼Œå‘ç°æ•°æ®ä¾ç„¶æœªå‘ç”Ÿå˜åŒ–ï¼Œè¿™è¯´æ˜è¿™æ¬¡å¯ä»¥é‡å¤è¯»äº†</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-c27ffc43c74eaff7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/710/format/jpg" alt=""></p><p>Bï¼šæ’å…¥ä¸€æ¡æ–°çš„æ•°æ®ï¼Œå¹¶æäº¤</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-0cc15096520791ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/705/format/jpg" alt=""></p><p>Aï¼šå†æ¬¡è¯»å–æ•°æ®ï¼Œå‘ç°æ•°æ®ä¾ç„¶æœªå‘ç”Ÿå˜åŒ–ã€‚è™½ç„¶å¯ä»¥é‡å¤è¯»äº†ï¼Œä½†æ˜¯å´å‘ç°è¯»çš„ä¸æ˜¯æœ€æ–°æ•°æ®ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ â€œå¹»è¯»â€</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-c27ffc43c74eaff7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/710/format/jpg" alt=""></p><p>Aï¼šæäº¤æœ¬æ¬¡äº‹åŠ¡ï¼Œå†æ¬¡è¯»å–æ•°æ®ï¼Œå‘ç°è¯»å–æ­£å¸¸äº†</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-34a1fc2ace6ebc23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/706/format/jpg" alt=""></p><p>ç”±ä»¥ä¸Šçš„å®éªŒå¯ä»¥å¾—å‡ºç»“è®ºï¼Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«åªå…è®¸è¯»å–å·²æäº¤è®°å½•ï¼Œè€Œä¸”åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–ä¸€ä¸ªè®°å½•æœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡ä¸å¾—æ›´æ–°è¯¥è®°å½•ã€‚ä½†è¯¥äº‹åŠ¡ä¸è¦æ±‚ä¸å…¶ä»–äº‹åŠ¡å¯ä¸²è¡ŒåŒ–ï¼Œä¾‹å¦‚ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¯ä»¥æ‰¾åˆ°ç”±ä¸€ä¸ªå·²æäº¤äº‹åŠ¡æ›´æ–°çš„è®°å½•ï¼Œä½†æ˜¯å¯èƒ½äº§ç”Ÿå¹»è¯»é—®é¢˜(æ³¨æ„æ˜¯å¯èƒ½ï¼Œå› ä¸ºæ•°æ®åº“å¯¹éš”ç¦»çº§åˆ«çš„å®ç°æœ‰æ‰€å·®åˆ«)ã€‚åƒä»¥ä¸Šçš„å®éªŒï¼Œå°±æ²¡æœ‰å‡ºç°æ•°æ®å¹»è¯»çš„é—®é¢˜ã€‚</p><h3 id="4-å°†-a-çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºå¯ä¸²è¡ŒåŒ–-serializable">4. å°† A çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºå¯ä¸²è¡ŒåŒ– (Serializable)</h3><p><img src="https://upload-images.jianshu.io/upload_images/1627454-b3bdfa59a34f9f52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/705/format/jpg" alt=""></p><p>Aï¼šå¯åŠ¨äº‹åŠ¡ï¼Œæ­¤æ—¶æ•°æ®ä¸ºåˆå§‹çŠ¶æ€</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-a703dc5fbfa9556f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/711/format/jpg" alt=""></p><p>Bï¼šå‘ç° B æ­¤æ—¶è¿›å…¥äº†ç­‰å¾…çŠ¶æ€ï¼ŒåŸå› æ˜¯å› ä¸º A çš„äº‹åŠ¡å°šæœªæäº¤ï¼Œåªèƒ½ç­‰å¾…ï¼ˆæ­¤æ—¶ï¼ŒB å¯èƒ½ä¼šå‘ç”Ÿç­‰å¾…è¶…æ—¶ï¼‰</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-f6cc3d7f422eefa5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/710/format/jpg" alt=""></p><p>Aï¼šæäº¤äº‹åŠ¡</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-7ab66d7a2ee442e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/710/format/jpg" alt=""></p><p>Bï¼šå‘ç°æ’å…¥æˆåŠŸ</p><p><img src="https://upload-images.jianshu.io/upload_images/1627454-5dd245d3cc5954f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/714/format/jpg" alt=""></p><p>Serializable å®Œå…¨é”å®šå­—æ®µï¼Œè‹¥ä¸€ä¸ªäº‹åŠ¡æ¥æŸ¥è¯¢åŒä¸€ä»½æ•°æ®å°±å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°å‰ä¸€ä¸ªäº‹åŠ¡å®Œæˆå¹¶è§£é™¤é”å®šä¸ºæ­¢ã€‚æ˜¯å®Œæ•´çš„éš”ç¦»çº§åˆ«ï¼Œä¼šé”å®šå¯¹åº”çš„æ•°æ®è¡¨æ ¼ï¼Œå› è€Œä¼šæœ‰æ•ˆç‡çš„é—®é¢˜ã€‚</p><blockquote><p>æ¥æºï¼šçŸ¥ä¹</p><p>åŸæ–‡ï¼š<a href="https://url.cn/5tswojh" target="_blank" rel="noopener">https://url.cn/5tswojh</a></p><p>é¢˜å›¾ï¼šæ¥è‡ªè°·æ­Œå›¾ç‰‡æœç´¢</p><p>ç‰ˆæƒï¼šæœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰</p><p>æŠ•ç¨¿ï¼šæ¬¢è¿æŠ•ç¨¿ï¼Œé‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a></p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯äº‹åŠ¡&quot;&gt;ä»€ä¹ˆæ˜¯äº‹åŠ¡&lt;/h2&gt;
&lt;p&gt;äº‹åŠ¡æ˜¯åº”ç”¨ç¨‹åºä¸­ä¸€ç³»åˆ—ä¸¥å¯†çš„æ“ä½œï¼Œæ‰€æœ‰æ“ä½œå¿…é¡»æˆåŠŸå®Œæˆï¼Œå¦åˆ™åœ¨æ¯ä¸ªæ“ä½œä¸­æ‰€ä½œçš„æ‰€æœ‰æ›´æ”¹éƒ½ä¼šè¢«æ’¤æ¶ˆã€‚ä¹Ÿå°±æ˜¯äº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸€ç³»åˆ—çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸åšã€‚&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡çš„ç»“æŸæœ‰ä¸¤ç§ï¼Œå½“äº‹åŠ¡ä¸­çš„æ‰€ä»¥æ­¥éª¤å…¨éƒ¨æˆåŠŸæ‰§è¡Œæ—¶ï¼Œäº‹åŠ¡æäº¤ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªæ­¥éª¤å¤±è´¥ï¼Œå°†å‘ç”Ÿå›æ»šæ“ä½œï¼Œæ’¤æ¶ˆæ’¤æ¶ˆä¹‹å‰åˆ°äº‹åŠ¡å¼€å§‹æ—¶çš„æ‰€ä»¥æ“ä½œã€‚&lt;/p&gt;
&lt;h2 id=&quot;äº‹åŠ¡çš„-ACID&quot;&gt;äº‹åŠ¡çš„ ACID&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡å…·æœ‰å››ä¸ªç‰¹å¾ï¼šåŸå­æ€§ï¼ˆ Atomicity ï¼‰ã€ä¸€è‡´æ€§ï¼ˆ Consistency ï¼‰ã€éš”ç¦»æ€§ï¼ˆ Isolation ï¼‰å’ŒæŒç»­æ€§ï¼ˆ Durability ï¼‰ã€‚è¿™å››ä¸ªç‰¹æ€§ç®€ç§°ä¸º ACID ç‰¹æ€§ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŸå­æ€§ï¼šäº‹åŠ¡æ˜¯æ•°æ®åº“çš„é€»è¾‘å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…å«çš„å„æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åš&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§ï¼šäº‹åŠ¡æ‰§è¡Œçš„ç»“æœå¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚å› æ­¤å½“æ•°æ®åº“åªåŒ…å«æˆåŠŸäº‹åŠ¡æäº¤çš„ç»“æœæ—¶ï¼Œå°±è¯´æ•°æ®åº“å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚å¦‚æœæ•°æ®åº“ç³»ç»Ÿ è¿è¡Œä¸­å‘ç”Ÿæ•…éšœï¼Œæœ‰äº›äº‹åŠ¡å°šæœªå®Œæˆå°±è¢«è¿«ä¸­æ–­ï¼Œè¿™äº›æœªå®Œæˆäº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„ä¿®æ”¹æœ‰ä¸€éƒ¨åˆ†å·²å†™å…¥ç‰©ç†æ•°æ®åº“ï¼Œè¿™æ—¶æ•°æ®åº“å°±å¤„äºä¸€ç§ä¸æ­£ç¡®çš„çŠ¶æ€ï¼Œæˆ–è€…è¯´æ˜¯ä¸ä¸€è‡´çš„çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;éš”ç¦»æ€§ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½å…¶å®ƒäº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å…¶å®ƒå¹¶å‘äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚&lt;/li&gt;
&lt;li&gt;æŒç»­æ€§ï¼šä¹Ÿç§°æ°¸ä¹…æ€§ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚æ¥ä¸‹æ¥çš„å…¶å®ƒæ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æ‰§è¡Œç»“æœæœ‰ä»»ä½•å½±å“ã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="MySQL" scheme="https://www.hi-linux.com/categories/MySQL/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="MySQL" scheme="https://www.hi-linux.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>è°ˆè°ˆæ”¯ä»˜å®æ¶æ„</title>
    <link href="https://www.hi-linux.com/posts/39305.html"/>
    <id>https://www.hi-linux.com/posts/39305.html</id>
    <published>2020-05-24T01:21:00.000Z</published>
    <updated>2020-05-24T09:19:12.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2 id="1-èƒŒæ™¯">1. èƒŒæ™¯</h2><p>ä¸€å¹´ä¸€åº¦çš„åŒåä¸€åˆè¦æ¥äº†ï¼Œè‡ª2008å¹´åŒåä¸€ä»¥æ¥ï¼Œåœ¨æ¯å¹´åŒåä¸€è¶…å¤§è§„æ¨¡æµé‡çš„å†²å‡»ä¸Šï¼Œèš‚èšé‡‘æœéƒ½ä¼šä¸æ–­çªç ´ç°æœ‰æŠ€æœ¯çš„æé™ã€‚2010å¹´åŒ11çš„æ”¯ä»˜å³°å€¼ä¸º2ä¸‡ç¬”/åˆ†é’Ÿï¼Œå…¨å¤©1280ä¸‡ç¬”æ”¯ä»˜ï¼Œè¿™ä¸ªæ•°å­—åˆ°2017åŒ11æ—¶å˜ä¸ºäº†25.6ä¸‡ç¬”/ç§’ï¼Œå…¨å¤©14.8äº¿ç¬”ã€‚åœ¨å¦‚æ­¤ä¹‹å¤§çš„æ”¯ä»˜TPSèƒŒåé™¤äº†å‰Šå³°ç­‰é”¦ä¸Šæ·»èŠ±çš„åº”ç”¨çº§ä¼˜åŒ–ï¼Œæœ€è§£æ¸´æœ€å®è´¨çš„æ‹›æ•°å½“æ•°åŸºäºåˆ†åº“åˆ†è¡¨çš„å•å…ƒåŒ–äº†ï¼Œèš‚èšæŠ€æœ¯ç§°ä¹‹ä¸ºLDCï¼ˆé€»è¾‘æ•°æ®ä¸­å¿ƒï¼‰ã€‚æœ¬æ–‡ä¸æ‰“ç®—è®¨è®ºå…·ä½“åˆ°ä»£ç çº§çš„åˆ†æï¼Œè€Œæ˜¯å°è¯•ç”¨æœ€ç®€å•çš„æè¿°æ¥è¯´æ˜å…¶ä¸­æœ€å¤§å¿«äººå¿ƒçš„åŸç†ã€‚æˆ‘æƒ³å…³å¿ƒåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„äººéƒ½æ›¾è¢«ä¸‹é¢è¿™äº›é—®é¢˜æ‰€å›°æ‰°è¿‡ï¼š</p><ul><li><p>æ”¯ä»˜å®æµ·é‡æ”¯ä»˜èƒŒåæœ€è§£æ¸´çš„è®¾è®¡æ˜¯å•¥ï¼Ÿæ¢å¥è¯è¯´ï¼Œå®ç°æ”¯ä»˜å®é«˜TPSçš„æœ€å…³é”®çš„è®¾è®¡æ˜¯å•¥ï¼Ÿ</p></li><li><p>LDCæ˜¯å•¥ï¼ŸLDCæ€ä¹ˆå®ç°å¼‚åœ°å¤šæ´»å’Œå¼‚åœ°ç¾å¤‡çš„ï¼Ÿ</p></li><li><p>CAPé­”å’’åˆ°åº•æ˜¯å•¥ï¼ŸPåˆ°åº•æ€ä¹ˆç†è§£ï¼Ÿ</p></li><li><p>ä»€ä¹ˆæ˜¯è„‘è£‚ï¼Ÿè·ŸCAPåˆæ˜¯å•¥å…³ç³»ï¼Ÿ</p></li><li><p>ä»€ä¹ˆæ˜¯PAXOSï¼Œå®ƒè§£å†³äº†å•¥é—®é¢˜ï¼Ÿ</p></li><li><p>PAXOSå’ŒCAPå•¥å…³ç³»ï¼ŸPAXOSå¯ä»¥é€ƒè„±CAPé­”å’’ä¹ˆï¼Ÿ</p></li><li><p>Oceanbaseèƒ½é€ƒè„±CAPé­”å’’ä¹ˆï¼Ÿ</p></li></ul><p>å¦‚æœä½ å¯¹è¿™äº›æ„Ÿå…´è¶£ï¼Œä¸å¦¨çœ‹ä¸€åœºèµ¤è£¸è£¸çš„è®ºè¿°ï¼Œæ‹’ç»ä½¿ç”¨æ™¦æ¶©éš¾æ‡‚çš„è¯æ±‡ï¼Œç›´é¢æœ€æœ¬è´¨çš„é€»è¾‘ã€‚</p><h2 id="2-ldcå’Œå•å…ƒåŒ–">2. LDCå’Œå•å…ƒåŒ–</h2><p>LDCï¼ˆlogic data center)æ˜¯ç›¸å¯¹äºä¼ ç»Ÿçš„ï¼ˆInternet Data Center-IDCï¼‰æå‡ºçš„ï¼Œé€»è¾‘æ•°æ®ä¸­å¿ƒæ‰€è¡¨è¾¾çš„ä¸­å¿ƒæ€æƒ³æ˜¯æ— è®ºç‰©ç†ç»“æ„å¦‚ä½•çš„åˆ†å¸ƒï¼Œæ•´ä¸ªæ•°æ®ä¸­å¿ƒåœ¨é€»è¾‘ä¸Šæ˜¯ååŒå’Œç»Ÿä¸€çš„ã€‚è¿™å¥è¯æš—å«çš„æ˜¯å¼ºå¤§çš„ä½“ç³»è®¾è®¡ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æŒ‘æˆ˜å°±åœ¨äºæ•´ä½“ååŒå·¥ä½œï¼ˆå¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§ï¼‰å’Œç»Ÿä¸€ï¼ˆä¸€è‡´æ€§ï¼‰ã€‚</p><p>å•å…ƒåŒ–æ˜¯å¤§å‹äº’è”ç½‘ç³»ç»Ÿçš„å¿…ç„¶é€‰æ‹©è¶‹åŠ¿ï¼Œä¸¾ä¸ªæœ€æœ€é€šä¿—çš„ä¾‹å­æ¥è¯´æ˜å•å…ƒåŒ–ã€‚æˆ‘ä»¬æ€»æ˜¯è¯´TPSå¾ˆéš¾æå‡ï¼Œç¡®å®ä»»ä½•ä¸€å®¶äº’è”ç½‘ï¼ˆæ¯”å¦‚æ·˜å®ã€æºç¨‹ã€æ–°æµªï¼‰å®ƒçš„äº¤æ˜“TPSé¡¶å¤šä»¥åä¸‡è®¡é‡ï¼ˆå¹³å‡æ°´å¹³ï¼‰ï¼Œå¾ˆéš¾å¾€ä¸Šä¸²äº†ï¼Œå› ä¸ºæ•°æ®åº“å­˜å‚¨å±‚ç“¶é¢ˆçš„å­˜åœ¨å†å¤šæ°´å¹³æ‰©å±•çš„æœåŠ¡å™¨éƒ½æ— æ³•ç»•å¼€è¿™ä¸ªç“¶é¢ˆï¼Œè€Œä»æ•´ä¸ªäº’è”ç½‘çš„è§†è§’çœ‹ï¼Œå…¨ä¸–ç•Œç”µå•†çš„äº¤æ˜“TPSå¯ä»¥è½»æ¾ä¸Šäº¿ã€‚è¿™ä¸ªä¾‹å­å¸¦ç»™æˆ‘ä»¬ä¸€äº›æ€è€ƒï¼šä¸ºå•¥å‡ å®¶äº’è”ç½‘çš„TPSä¹‹å’Œå¯ä»¥é‚£ä¹ˆå¤§ï¼ŒæœåŠ¡çš„ç”¨æˆ·æ•°è§„æ¨¡ä¹Ÿæä¸ºå“äººï¼Œè€Œå•ä¸ªäº’è”ç½‘çš„TPSå´å¾ˆéš¾æå‡ï¼Ÿç©¶å…¶æœ¬è´¨ï¼Œæ¯å®¶äº’è”ç½‘éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¤§å‹å•å…ƒï¼Œä»–ä»¬å„è‡ªæœåŠ¡è‡ªå·±çš„ç”¨æˆ·äº’ä¸å¹²æ‰°ã€‚è¿™å°±æ˜¯å•å…ƒåŒ–çš„åŸºæœ¬ç‰¹æ€§ï¼Œä»»ä½•ä¸€å®¶äº’è”ç½‘å…¬å¸ï¼Œå…¶æƒ³è¦æˆå€çš„æ‰©å¤§è‡ªå·±ç³»ç»Ÿçš„æœåŠ¡èƒ½åŠ›ï¼Œéƒ½å¿…ç„¶ä¼šèµ°å‘å•å…ƒåŒ–ä¹‹è·¯ï¼Œå®ƒçš„æœ¬è´¨æ˜¯åˆ†æ²»ï¼Œæˆ‘ä»¬æŠŠå¹¿å¤§çš„ç”¨æˆ·åˆ†ä¸ºè‹¥å¹²éƒ¨åˆ†ï¼ŒåŒæ—¶æŠŠç³»ç»Ÿå¤åˆ¶å¤šä»½ï¼Œæ¯ä¸€ä»½éƒ½ç‹¬ç«‹éƒ¨ç½²ï¼Œæ¯ä¸€ä»½ç³»ç»Ÿéƒ½æœåŠ¡ç‰¹å®šçš„ä¸€ç¾¤ç”¨æˆ·ï¼Œä»¥æ·˜å®ä¸¾ä¾‹ï¼Œè¿™æ ·ä¹‹åï¼Œå°±ä¼šæœ‰å¾ˆå¤šä¸ªæ·˜å®ç³»ç»Ÿåˆ†åˆ«ä¸ºä¸åŒçš„ç”¨æˆ·æœåŠ¡ï¼Œæ¯ä¸ªæ·˜å®ç³»ç»Ÿéƒ½åšåˆ°åä¸‡TPSçš„è¯ï¼ŒNä¸ªè¿™æ ·çš„ç³»ç»Ÿå°±å¯ä»¥è½»æ¾åšåˆ°N*åä¸‡çš„TPSäº†ã€‚</p><p>LDCå®ç°çš„å…³é”®å°±åœ¨äºå•å…ƒåŒ–ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼Œæ‰€ä»¥åœ¨èš‚èšå†…éƒ¨ï¼ŒLDCå’Œå•å…ƒåŒ–æ˜¯ä¸åˆ†å®¶çš„ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šåŒå­¦æ¯”è¾ƒå›°æ‰°çš„åœ°æ–¹ï¼Œçœ‹ä¼¼æ²¡å•¥å…³ç³»ï¼Œå®åˆ™æ˜¯å•å…ƒåŒ–ä½“ç³»è®¾è®¡æˆå°±äº†LDCã€‚</p><blockquote><p>å°ç»“ï¼šåˆ†åº“åˆ†è¡¨è§£å†³çš„æœ€å¤§ç—›ç‚¹æ˜¯æ•°æ®åº“å•ç‚¹ç“¶é¢ˆï¼Œè¿™ä¸ªç“¶é¢ˆçš„äº§ç”Ÿæ˜¯ç”±ç°ä»£äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨ä½“ç³»å†³å®šçš„ï¼ˆå³I/Oé€Ÿåº¦ï¼‰ã€‚å•å…ƒåŒ–åªæ˜¯åˆ†åº“åˆ†è¡¨åç³»ç»Ÿéƒ¨ç½²çš„ä¸€ç§æ–¹å¼ï¼Œè¿™ç§éƒ¨ç½²æ¨¡å¼åœ¨ç¾å¤‡æ–¹é¢ä¹Ÿå‘æŒ¥äº†æå¤§çš„ä¼˜åŠ¿ã€‚</p></blockquote><a id="more"></a><h3 id="21-ç³»ç»Ÿæ¶æ„æ¼”åŒ–å²">2.1 ç³»ç»Ÿæ¶æ„æ¼”åŒ–å²</h3><p>å‡ ä¹ä»»ä½•è§„æ¨¡çš„äº’è”ç½‘å…¬å¸ï¼Œéƒ½æœ‰è‡ªå·±çš„ç³»ç»Ÿæ¶æ„è¿­ä»£å’Œæ›´æ–°ï¼Œå¤§è‡´çš„æ¼”åŒ–è·¯å¾„éƒ½å¤§åŒå°å¼‚ã€‚æœ€æ—©ä¸€èˆ¬ä¸ºäº†ä¸šåŠ¡å¿«é€Ÿä¸Šçº¿ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½ä¼šæ”¾åˆ°ä¸€ä¸ªåº”ç”¨é‡Œï¼Œç³»ç»Ÿæ¶æ„å¦‚å›¾ 1 æ‰€ç¤ºã€‚</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/monolithic-arch.jpg" alt="å•åº”ç”¨å•æœåŠ¡å™¨æ¶æ„"></p><p>è¿™æ ·çš„æ¶æ„æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ï¼Œå•æœºæœ‰ç€æ˜æ˜¾çš„å•ç‚¹æ•ˆåº”ï¼Œå•æœºçš„å®¹é‡å’Œæ€§èƒ½éƒ½æ˜¯å¾ˆå±€é™çš„ï¼Œè€Œä½¿ç”¨ä¸­å°å‹æœºä¼šå¸¦æ¥å¤§é‡çš„æµªè´¹ã€‚ éšç€ä¸šåŠ¡å‘å±•ï¼Œè¿™ä¸ªçŸ›ç›¾é€æ¸è½¬å˜ä¸ºä¸»è¦çŸ›ç›¾ï¼Œå› æ­¤å·¥ç¨‹å¸ˆä»¬é‡‡ç”¨äº†ä»¥ä¸‹æ¶æ„ã€‚</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/distributed-arch.jpg" alt="å•åº”ç”¨å¤šæœåŠ¡å™¨å•æ•°æ®åº“æ¶æ„"></p><p>è¿™æ˜¯æ•´ä¸ªå…¬å¸ç¬¬ä¸€æ¬¡è§¦ç¢°åˆ°åˆ†å¸ƒå¼ï¼Œä¹Ÿå°±æ˜¯å¯¹æŸä¸ªåº”ç”¨è¿›è¡Œäº†æ°´å¹³æ‰©å®¹ï¼Œå®ƒå°†å¤šä¸ªå¾®æœºçš„è®¡ç®—èƒ½åŠ›å›¢ç»“äº†èµ·æ¥ï¼Œå¯ä»¥å®ŒèƒœåŒç­‰ä»·æ ¼çš„ä¸­å°å‹æœºå™¨ã€‚æ…¢æ…¢çš„ï¼Œå¤§å®¶å‘ç°ï¼Œåº”ç”¨æœåŠ¡å™¨CPUéƒ½å¾ˆæ­£å¸¸äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šæ…¢è¯·æ±‚ï¼Œç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºå•ç‚¹æ•°æ®åº“å¸¦æ¥äº†æ€§èƒ½ç“¶é¢ˆã€‚äºæ˜¯ç¨‹åºå‘˜ä»¬å†³å®šä½¿ç”¨ä¸»ä»ç»“æ„çš„æ•°æ®åº“é›†ç¾¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/distributed-arch-with-master-slave-db.jpg" alt="å•åº”ç”¨å¤šæœåŠ¡å™¨æ•°æ®åº“é›†ç¾¤æ¶æ„"></p><p>å…¶ä¸­å¤§éƒ¨åˆ†è¯»æ“ä½œå¯ä»¥ç›´æ¥è®¿é—®ä»åº“ï¼Œä»è€Œå‡è½»ä¸»åº“çš„å‹åŠ›ã€‚ç„¶è€Œè¿™ç§æ–¹å¼è¿˜æ˜¯æ— æ³•è§£å†³å†™ç“¶é¢ˆï¼Œå†™ä¾æ—§éœ€è¦ä¸»åº“æ¥å¤„ç†ï¼Œå½“ä¸šåŠ¡é‡é‡çº§å†æ¬¡å¢é«˜æ—¶ï¼Œå†™å·²ç»å˜æˆåˆ»ä¸å®¹ç¼“çš„å¾…å¤„ç†ç“¶é¢ˆã€‚è¿™æ—¶å€™ï¼Œåˆ†åº“åˆ†è¡¨æ–¹æ¡ˆå‡ºç°äº†ã€‚</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/distributed-sharding-arch.jpg" alt="åˆ†åº“åˆ†è¡¨çš„åˆ†å¸ƒå¼æœåŠ¡æ¶æ„"></p><p>åˆ†åº“åˆ†è¡¨ä¸ä»…å¯ä»¥å¯¹ç›¸åŒçš„åº“è¿›è¡Œæ‹†åˆ†ï¼Œè¿˜å¯ä»¥è¿›è¡Œå¯¹ç›¸åŒçš„è¡¨è¿›è¡Œæ‹†åˆ†ï¼Œå¯¹è¡¨è¿›è¡Œæ‹†åˆ†çš„æ–¹å¼å«åšæ°´å¹³æ‹†åˆ†ã€‚ä¸åŒåŠŸèƒ½çš„è¡¨æ”¾åˆ°ä¸åŒçš„åº“é‡Œï¼Œä¸€èˆ¬å¯¹åº”çš„æ˜¯å‚ç›´æ‹†åˆ†ï¼ˆæŒ‰ç…§ä¸šåŠ¡åŠŸèƒ½è¿›è¡Œæ‹†åˆ†ï¼‰ï¼Œæ­¤æ—¶ä¸€èˆ¬è¿˜å¯¹åº”äº†å¾®æœåŠ¡åŒ–ã€‚è¿™ç§æ–¹æ³•åšåˆ°æè‡´åŸºæœ¬èƒ½æ”¯æ’‘TPSåœ¨ä¸‡çº§ç”šè‡³æ›´é«˜çš„è®¿é—®é‡äº†ã€‚ç„¶è€Œéšç€ç›¸åŒåº”ç”¨æ‰©å±•çš„è¶Šå¤šï¼Œæ¯ä¸ªæ•°æ®åº“çš„é“¾æ¥æ•°ä¹Ÿå·¨é‡å¢é•¿ï¼Œè¿™è®©æ•°æ®åº“æœ¬èº«çš„èµ„æºæˆä¸ºäº†ç“¶é¢ˆã€‚è¿™ä¸ªé—®é¢˜äº§ç”Ÿçš„æœ¬è´¨æ˜¯å…¨é‡æ•°æ®æ— å·®åˆ«çš„åˆ†äº«äº†æ‰€æœ‰çš„åº”ç”¨èµ„æºï¼Œæ¯”å¦‚Aç”¨æˆ·çš„è¯·æ±‚åœ¨è´Ÿè½½å‡è¡¡çš„åˆ†é…ä¸‹å¯èƒ½åˆ†é…åˆ°ä»»æ„ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œå› è€Œæ‰€æœ‰åº”ç”¨å…¨éƒ¨éƒ½è¦é“¾æ¥Aç”¨æˆ·æ‰€åœ¨çš„åˆ†åº“ï¼Œæ•°æ®åº“è¿æ¥æ•°å°±å˜æˆç¬›å¡å°”ä¹˜ç§¯äº†ã€‚åœ¨æœ¬è´¨ç‚¹è¯´ï¼Œè¿™ç§æ¨¡å¼çš„èµ„æºéš”ç¦»æ€§è¿˜ä¸å¤Ÿå½»åº•ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æŠŠè¯†åˆ«ç”¨æˆ·åˆ†åº“çš„é€»è¾‘å¾€ä¸Šå±‚ç§»åŠ¨ï¼Œä»æ•°æ®åº“å±‚ç§»åŠ¨åˆ°è·¯ç”±ç½‘å…³å±‚ã€‚è¿™æ ·ä¸€æ¥ï¼Œä»åº”ç”¨æœåŠ¡å™¨aè¿›æ¥çš„æ¥è‡ªAå®¢æˆ·çš„æ‰€æœ‰è¯·æ±‚å¿…ç„¶è½åº“åˆ°DB-Aï¼Œå› æ­¤aä¹Ÿä¸ç”¨é“¾æ¥å…¶ä»–çš„æ•°æ®åº“å®ä¾‹äº†ï¼Œè¿™æ ·ä¸€ä¸ªå•å…ƒåŒ–çš„é›å½¢å°±è¯ç”Ÿäº†ã€‚</p><blockquote><p>æ€è€ƒä¸€ä¸‹ï¼Œåº”ç”¨é—´å…¶å®ä¹Ÿå­˜åœ¨äº¤äº’ï¼ˆæ¯”å¦‚Aè½¬è´¦ç»™Bï¼‰ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œåº”ç”¨ä¸éœ€è¦é“¾æ¥å…¶ä»–çš„æ•°æ®åº“äº†ï¼Œä½†æ˜¯è¿˜éœ€è¦é“¾æ¥å…¶ä»–åº”ç”¨ã€‚å¦‚æœæ˜¯å¸¸è§çš„RPCæ¡†æ¶å¦‚dubboç­‰ï¼Œä½¿ç”¨çš„æ˜¯TCP/IPåè®®ï¼Œé‚£ä¹ˆç­‰åŒäºæŠŠä¹‹å‰ä¸æ•°æ®åº“å»ºç«‹çš„é“¾æ¥ï¼Œæ¢æˆä¸å…¶ä»–åº”ç”¨ä¹‹é—´çš„é“¾æ¥äº†ã€‚ä¸ºå•¥è¿™æ ·å°±æ¶ˆé™¤ç“¶é¢ˆäº†å‘¢ï¼Ÿé¦–å…ˆç”±äºåˆç†çš„è®¾è®¡ï¼Œåº”ç”¨é—´çš„æ•°æ®äº¤äº’å¹¶ä¸å·¨é‡ï¼Œå…¶æ¬¡åº”ç”¨é—´çš„äº¤äº’å¯ä»¥å…±äº«TCPé“¾æ¥ï¼Œæ¯”å¦‚A-&gt;Bä¹‹é—´çš„Socketé“¾æ¥å¯ä»¥è¢«Aä¸­çš„å¤šä¸ªçº¿ç¨‹å¤ç”¨ï¼Œè€Œä¸€èˆ¬çš„æ•°æ®åº“å¦‚MySQLåˆ™ä¸è¡Œï¼Œæ‰€ä»¥MySQLæ‰éœ€è¦æ•°æ®åº“é“¾æ¥æ± ã€‚</p></blockquote><p><img src="https://www.tbwork.org/image/ant-ldc-arch/unitize-arch.jpg" alt="å•å…ƒåŒ–åˆ†å¸ƒå¼æœåŠ¡æ¶æ„"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½†æˆ‘ä»¬æŠŠæ•´å¥—ç³»ç»Ÿæ‰“åŒ…ä¸ºå•å…ƒåŒ–æ—¶ï¼Œæ¯ä¸€ç±»çš„æ•°æ®ä»è¿›å•å…ƒå¼€å§‹å°±æ³¨å®šåœ¨è¿™ä¸ªå•å…ƒè¢«æ¶ˆåŒ–ï¼Œç”±äºè¿™ç§å½»åº•çš„éš”ç¦»æ€§ï¼Œæ•´ä¸ªå•å…ƒå¯ä»¥è½»æ¾çš„éƒ¨ç½²åˆ°ä»»æ„æœºæˆ¿è€Œä¾ç„¶èƒ½ä¿è¯é€»è¾‘ä¸Šçš„ç»Ÿä¸€ã€‚ä¸‹å›¾ä¸ºä¸€ä¸ªä¸‰åœ°äº”æœºæˆ¿çš„éƒ¨ç½²æ–¹å¼ã€‚</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/ant-3-city-5-center-arch.jpg" alt="ä¸‰åœ°äº”ä¸­å¿ƒæ¶æ„"></p><h3 id="22-èš‚èšå•å…ƒåŒ–æ¶æ„å®è·µ">2.2 èš‚èšå•å…ƒåŒ–æ¶æ„å®è·µ</h3><p>èš‚èšæ”¯ä»˜å®åº”è¯¥æ˜¯å›½å†…æœ€å¤§çš„æ”¯ä»˜å·¥å…·ï¼Œå…¶åœ¨åŒåä¸€ç­‰æ´»åŠ¨æ—¥å½“æ—¥çš„æ”¯ä»˜TPSå¯è¾¾å‡ åä¸‡çº§ï¼Œæœªæ¥è¿™ä¸ªæ•°å­—å¯èƒ½ä¼šæ›´å¤§ï¼Œè¿™å†³å®šäº†èš‚èšå•å…ƒåŒ–æ¶æ„ä»å®¹é‡è¦æ±‚ä¸Šçœ‹å¿…ç„¶ä»å•æœºæˆ¿èµ°å‘å¤šæœºæˆ¿ã€‚å¦ä¸€æ–¹é¢ï¼Œå¼‚åœ°ç¾å¤‡ä¹Ÿå†³å®šäº†è¿™äº›IDCæœºæˆ¿å¿…é¡»æ˜¯å¼‚åœ°éƒ¨ç½²çš„ã€‚ æ•´ä½“ä¸Šæ”¯ä»˜å®ä¹Ÿé‡‡ç”¨äº†ä¸‰åœ°äº”ä¸­å¿ƒï¼ˆIDCæœºæˆ¿ï¼‰æ¥ä¿éšœç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œè·Ÿ2.1ä¸­æè¿°çš„æœ‰æ‰€ä¸åŒçš„æ˜¯ï¼Œæ”¯ä»˜å®å°†å•å…ƒåˆ†æˆäº†ä¸‰ç±»ï¼ˆä¹Ÿç§°CRGæ¶æ„ï¼‰ï¼š</p><ul><li><p>RZone(Region Zone)ï¼šç›´è¯‘å¯èƒ½æœ‰ç‚¹åè€Œä¸å¥½ç†è§£ã€‚å®é™…ä¸Šå°±æ˜¯æ‰€æœ‰å¯ä»¥åˆ†åº“åˆ†è¡¨çš„ä¸šåŠ¡ç³»ç»Ÿæ•´ä½“éƒ¨ç½²çš„æœ€å°å•å…ƒã€‚æ¯ä¸ªRZoneè¿ä¸Šæ•°æ®åº“å°±å¯ä»¥æ’‘èµ·ä¸€ç‰‡å¤©ç©ºï¼ŒæŠŠä¸šåŠ¡è·‘çš„æºœæºœçš„ã€‚</p></li><li><p>GZone(Global Zone)ï¼šå…¨å±€å•å…ƒï¼Œæ„å‘³ç€å…¨å±€åªæœ‰ä¸€ä»½ã€‚éƒ¨ç½²äº†ä¸å¯æ‹†åˆ†çš„æ•°æ®å’ŒæœåŠ¡ï¼Œæ¯”å¦‚ç³»ç»Ÿé…ç½®ç­‰ã€‚å®é™…æƒ…å†µä¸‹ï¼ŒGZoneå¼‚åœ°ä¹Ÿä¼šéƒ¨ç½²ï¼Œä¸è¿‡ä»…æ˜¯ç”¨äºç¾å¤‡ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€åœ°GZoneè¿›è¡Œå…¨å±€æœåŠ¡ã€‚GZoneä¸€èˆ¬è¢«RZoneä¾èµ–ï¼Œæä¾›çš„å¤§éƒ¨åˆ†æ˜¯è¯»å–æœåŠ¡ã€‚</p></li><li><p>CZone(City Zone)ï¼šé¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ä»¥åŸå¸‚ä¸ºå•ä½éƒ¨ç½²çš„å•å…ƒã€‚åŒæ ·éƒ¨ç½²äº†ä¸å¯æ‹†åˆ†çš„æ•°æ®å’ŒæœåŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·è´¦å·æœåŠ¡ï¼Œå®¢æˆ·ä¿¡æ¯æœåŠ¡ç­‰ã€‚ç†è®ºä¸ŠCZoneä¼šè¢«RZoneä»¥æ¯”è®¿é—®GZoneé«˜å¾ˆå¤šçš„é¢‘ç‡è¿›è¡Œè®¿é—®ã€‚CZoneæ˜¯åŸºäºç‰¹å®šçš„GZoneåœºæ™¯è¿›è¡Œä¼˜åŒ–çš„ä¸€ç§å•å…ƒï¼Œå®ƒæŠŠGZoneä¸­æœ‰äº›æœ‰ç€â€å†™è¯»æ—¶é—´å·®ç°è±¡â€çš„æ•°æ®å’ŒæœåŠ¡è¿›è¡Œäº†çš„å•ç‹¬éƒ¨ç½²ï¼Œè¿™æ ·RZoneåªéœ€è¦è®¿é—®æœ¬åœ°çš„CZoneå³å¯ï¼Œè€Œä¸æ˜¯è®¿é—®å¼‚åœ°çš„GZoneã€‚</p></li></ul><blockquote><p>â€œå†™è¯»æ—¶é—´å·®ç°è±¡â€æ˜¯èš‚èšæ¶æ„å¸ˆä»¬æ ¹æ®å®è·µç»Ÿè®¡æ€»ç»“çš„ï¼Œä»–ä»¬å‘ç°å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ•°æ®è¢«å†™å…¥åï¼Œéƒ½ä¼šè¿‡è¶³å¤Ÿé•¿çš„æ—¶é—´åæ‰ä¼šè¢«è®¿é—®ã€‚ç”Ÿæ´»ä¸­è¿™ç§ä¾‹å­å¾ˆå¸¸è§ï¼Œæˆ‘ä»¬åŠå®Œé“¶è¡Œå¡åå¯èƒ½å¾ˆä¹…æ‰ä¼šå­˜ç¬¬ä¸€ç¬”é’±ï¼›æˆ‘ä»¬åˆ›å»ºå¾®åšè´¦å·åï¼Œå¯èƒ½æƒ³åŠå¤©æ‰ä¼šå‘å¾®åšï¼›æˆ‘ä»¬ä¸‹è½½åˆ›å»ºæ·˜å®è´¦å·åï¼Œå¯èƒ½å¾—æµè§ˆå¥½å‡ åˆ†é’Ÿæ‰ä¼šä¸‹å•ä¹°ä¸œè¥¿ã€‚å½“ç„¶äº†è¿™äº›ä¾‹å­ä¸­çš„æ—¶é—´å·®è¿œè¿œè¶…è¿‡äº†ç³»ç»ŸåŒæ­¥æ—¶é—´ã€‚ä¸€èˆ¬æ¥è¯´å¼‚åœ°çš„å»¶æ—¶åœ¨100msä»¥å†…ï¼Œæ‰€ä»¥åªè¦æ»¡è¶³æŸåœ°CZoneå†™å…¥æ•°æ®å100msä»¥åæ‰ç”¨è¿™ä¸ªæ•°æ®ï¼Œè¿™æ ·çš„æ•°æ®å’ŒæœåŠ¡å°±é€‚åˆæ”¾åˆ°CZoneä¸­ã€‚</p></blockquote><p>ç›¸ä¿¡å¤§å®¶çœ‹åˆ°è¿™éƒ½ä¼šé—®ï¼šä¸ºå•¥åˆ†è¿™ä¸‰ç§å•å…ƒï¼Ÿå…¶å®å…¶èƒŒåå¯¹åº”çš„æ˜¯ä¸åŒæ€§è´¨çš„æ•°æ®ï¼Œè€ŒæœåŠ¡ä¸è¿‡æ˜¯å¯¹æ•°æ®çš„æ“ä½œé›†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ ¹æ®æ•°æ®æ€§è´¨çš„ä¸åŒæ¥è§£é‡Šæ”¯ä»˜å®çš„CRGæ¶æ„ã€‚å½“ä¸‹å‡ ä¹æ‰€æœ‰äº’è”ç½‘å…¬å¸çš„åˆ†åº“åˆ†è¡¨è§„åˆ™éƒ½æ˜¯æ ¹æ®ç”¨æˆ·IDæ¥åˆ¶å®šçš„ï¼Œè€Œå›´ç»•ç”¨æˆ·æ¥çœ‹æ•´ä¸ªç³»ç»Ÿçš„æ•°æ®å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š</p><ul><li><p>ç”¨æˆ·æµæ°´å‹æ•°æ®ï¼šå…¸å‹çš„æœ‰ç”¨æˆ·çš„è®¢å•ã€ç”¨æˆ·å‘çš„è¯„è®ºã€ç”¨æˆ·çš„è¡Œä¸ºè®°å½•ç­‰ã€‚è¿™äº›æ•°æ®éƒ½æ˜¯ç”¨æˆ·è¡Œä¸ºäº§ç”Ÿçš„æµæ°´å‹æ•°æ®ï¼Œå…·å¤‡å¤©ç„¶çš„ç”¨æˆ·éš”ç¦»æ€§ï¼Œæ¯”å¦‚Aç”¨æˆ·çš„Appä¸Šç»å¯¹çœ‹ä¸åˆ°Bç”¨æˆ·çš„è®¢å•åˆ—è¡¨ã€‚æ‰€ä»¥æ­¤ç±»æ•°æ®éå¸¸é€‚åˆåˆ†åº“åˆ†è¡¨åç‹¬ç«‹éƒ¨ç½²æœåŠ¡ã€‚</p></li><li><p>ç”¨æˆ·é—´å…±äº«å‹æ•°æ®ï¼šè¿™ç§ç±»å‹çš„æ•°æ®åˆåˆ†ä¸¤ç±»ã€‚ä¸€ç±»å…±äº«å‹æ•°æ®æ˜¯åƒè´¦å·ã€ä¸ªäººåšå®¢ç­‰å¯èƒ½ä¼šè¢«æ‰€æœ‰ç”¨æˆ·è¯·æ±‚è®¿é—®çš„ç”¨æˆ·æ•°æ®ï¼Œæ¯”å¦‚Aå‘Bè½¬è´¦ï¼ŒAç»™Bå‘æ¶ˆæ¯ï¼Œè¿™æ—¶å€™éœ€è¦ç¡®è®¤Bè´¦å·æ˜¯å¦å­˜åœ¨ï¼›åˆæ¯”å¦‚Aæƒ³çœ‹Bçš„ä¸ªäººåšå®¢ä¹‹ç±»çš„ã€‚å¦å¤–ä¸€ç±»æ˜¯ç”¨æˆ·æ— å…³å‹æ•°æ®ï¼Œåƒå•†å“ã€ç³»ç»Ÿé…ç½®ï¼ˆæ±‡ç‡ã€ä¼˜æƒ æ”¿ç­–ï¼‰ã€è´¢åŠ¡ç»Ÿè®¡ç­‰è¿™äº›éç”¨æˆ·çº¬åº¦çš„æ•°æ®ï¼Œå¾ˆéš¾è¯´è·Ÿå…·ä½“çš„æŸä¸€ç±»ç”¨æˆ·æŒ‚é’©ï¼Œå¯èƒ½æ¶‰åŠåˆ°æ‰€æœ‰ç”¨æˆ·ã€‚æ¯”å¦‚å•†å“ï¼Œå‡è®¾æŒ‰å•†å“æ‰€åœ¨åœ°æ¥å­˜æ”¾å•†å“æ•°æ®ï¼ˆè¿™éœ€è¦åŒç»´åº¦åˆ†åº“åˆ†è¡¨ï¼‰ï¼Œé‚£ä¹ˆä¸Šæµ·çš„ç”¨æˆ·ä»ç„¶éœ€è¦è®¿é—®æ­å·çš„å•†å“ï¼Œè¿™å°±åˆæ„æˆè·¨åœ°è·¨zoneè®¿é—®äº†ï¼Œè¿˜æ˜¯è¾¾ä¸åˆ°å•å…ƒåŒ–çš„ç†æƒ³çŠ¶æ€ï¼Œè€Œä¸”åŒç»´åº¦åˆ†åº“åˆ†è¡¨ä¼šç»™æ•´ä¸ªLDCè¿ç»´å¸¦æ¥å¤æ‚åº¦æå‡ã€‚</p></li></ul><blockquote><p>æ³¨ï¼šç½‘ä¸Šå’Œæ”¯ä»˜å®å†…éƒ¨æœ‰å¦å¤–ä¸€äº›åˆ†æ³•ï¼Œæ¯”å¦‚æµæ°´å‹å’ŒçŠ¶æ€æ€§ï¼Œæœ‰æ—¶å€™è¿˜ä¼šåˆ†ä¸ºä¸‰ç±»ï¼šæµæ°´å‹ã€çŠ¶æ€å‹å’Œé…ç½®å‹ã€‚ä¸ªäººè§‰å¾—è¿™äº›åˆ†æ³•è™½ç„¶å°è¯•å»æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡æ•°æ®åˆ†ç±»ï¼Œä½†å®é™…ä¸Šè¾¹ç•Œå¾ˆæ¨¡ç³Šï¼Œé€‚å¾—å…¶åã€‚</p></blockquote><p>ç›´è§‚çš„ç±»æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“çš„å°†ä¸Šè¿°ä¸¤ç±»æ•°æ®å¯¹åº”çš„æœåŠ¡åˆ’åˆ†ä¸ºRZoneå’ŒGZoneï¼ŒRZoneåŒ…å«çš„å°±æ˜¯åˆ†åº“åˆ†è¡¨åè´Ÿè´£å›ºå®šå®¢æˆ·ç¾¤ä½“çš„æœåŠ¡ï¼ŒGZoneåˆ™åŒ…å«äº†ç”¨æˆ·é—´å…±äº«çš„å…¬å…±æ•°æ®å¯¹åº”çš„æœåŠ¡ã€‚åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½å¾ˆå®Œç¾ï¼Œè¿™ä¹Ÿæ˜¯ä¸»æµçš„å•å…ƒåŒ–è¯é¢˜äº†ã€‚</p><p>å¯¹æ¯”æ”¯ä»˜å®çš„CRGæ¶æ„ï¼Œæˆ‘ä»¬ä¸€çœ¼å°±å‘ç°å°‘äº†Cï¼ˆCity Zoneï¼‰ï¼ŒCZoneç¡®å®æ˜¯èš‚èšåœ¨å•å…ƒåŒ–å®è·µé¢†åŸŸçš„ä¸€ä¸ªåˆ›æ–°ç‚¹ã€‚å†æ¥åˆ†æä¸‹GZoneï¼ŒGZoneä¹‹æ‰€ä»¥åªèƒ½å•åœ°éƒ¨ç½²ï¼Œæ˜¯å› ä¸ºå…¶æ•°æ®è¦æ±‚è¢«æ‰€æœ‰ç”¨æˆ·å…±äº«ï¼Œæ— æ³•åˆ†åº“åˆ†è¡¨ï¼Œè€Œå¤šåœ°éƒ¨ç½²ä¼šå¸¦æ¥ç”±å¼‚åœ°å»¶æ—¶å¼•èµ·çš„ä¸ä¸€è‡´ï¼Œæ¯”å¦‚å®æ—¶é£æ§ç³»ç»Ÿï¼Œå¦‚æœå¤šåœ°éƒ¨ç½²ï¼ŒæŸä¸ªRZoneç›´æ¥è¯»å–æœ¬åœ°çš„è¯ï¼Œå¾ˆå®¹æ˜“è¯»å–åˆ°æ—§çš„é£æ§çŠ¶æ€ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ã€‚è¿™æ—¶èš‚èšæ¶æ„å¸ˆä»¬é—®äº†è‡ªå·±ä¸€ä¸ªé—®é¢˜â€”â€”éš¾é“æ‰€æœ‰æ•°æ®å—ä¸äº†å»¶æ—¶ä¹ˆï¼Ÿè¿™ä¸ªé—®é¢˜åƒæ˜¯æ‰“å¼€äº†æ–°ä¸–ç•Œçš„å¤§é—¨ï¼Œé€šè¿‡å¯¹RZoneå·²æœ‰ä¸šåŠ¡çš„åˆ†æï¼Œæ¶æ„å¸ˆä»¬å‘ç°80%ç”šè‡³æ›´é«˜çš„åœºæ™¯ä¸‹ï¼Œæ•°æ®æ›´æ–°åéƒ½ä¸è¦æ±‚ç«‹é©¬è¢«è¯»å–åˆ°ã€‚ä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„â€å†™è¯»æ—¶é—´å·®ç°è±¡â€ï¼Œé‚£ä¹ˆè¿™å°±å¥½åŠäº†ï¼Œå¯¹äºè¿™ç±»æ•°æ®ï¼Œæˆ‘ä»¬å…è®¸æ¯ä¸ªåœ°åŒºçš„RZoneæœåŠ¡ç›´æ¥è®¿é—®æœ¬åœ°ï¼Œä¸ºäº†ç»™è¿™äº›RZoneæä¾›è¿™äº›æ•°æ®çš„æœ¬åœ°è®¿é—®èƒ½åŠ›ï¼Œèš‚èšæ¶æ„å¸ˆè®¾è®¡å‡ºäº†CZoneã€‚åœ¨CZoneçš„åœºæ™¯ä¸‹ï¼Œå†™è¯·æ±‚ä¸€èˆ¬ä»GZoneå†™å…¥å…¬å…±æ•°æ®æ‰€åœ¨åº“ï¼Œç„¶ååŒæ­¥åˆ°æ•´ä¸ªOBé›†ç¾¤ï¼Œç„¶åç”±CZoneæä¾›è¯»å–æœåŠ¡ã€‚æ¯”å¦‚æ”¯ä»˜å®çš„ä¼šå‘˜æœåŠ¡å°±æ˜¯å¦‚æ­¤ã€‚</p><blockquote><p>å³ä¾¿æ¶æ„å¸ˆä»¬è®¾è®¡äº†å®Œç¾çš„CRGï¼Œä½†å³ä¾¿åœ¨èš‚èšçš„å®é™…åº”ç”¨ä¸­ï¼Œå„ä¸ªç³»ç»Ÿä»ç„¶å­˜åœ¨ä¸åˆç†çš„CRGåˆ†ç±»ï¼Œå°¤å…¶æ˜¯CGä¸åˆ†çš„ç°è±¡å¾ˆå¸¸è§ã€‚</p></blockquote><h2 id="3-æ”¯ä»˜å®å•å…ƒåŒ–çš„å¼‚åœ°å¤šæ´»å’Œç¾å¤‡">3. æ”¯ä»˜å®å•å…ƒåŒ–çš„å¼‚åœ°å¤šæ´»å’Œç¾å¤‡</h2><h3 id="31-æµé‡æŒ‘æ‹¨æŠ€æœ¯æ¢ç§˜ç®€ä»‹">3.1 æµé‡æŒ‘æ‹¨æŠ€æœ¯æ¢ç§˜ç®€ä»‹</h3><p>å•å…ƒåŒ–åï¼Œå¼‚åœ°å¤šæ´»åªæ˜¯å¤šåœ°éƒ¨ç½²è€Œå·²ã€‚æ¯”å¦‚ä¸Šæµ·çš„ä¸¤ä¸ªå•å…ƒä¸ºIDèŒƒå›´ä¸º[00<sub>19],[40</sub>59]çš„ç”¨æˆ·æœåŠ¡ï¼Œè€Œæ­å·çš„ä¸¤ä¸ªå•å…ƒä¸ºIDä¸º[20~39]å’Œ[60,79]çš„ç”¨æˆ·æœåŠ¡ï¼Œè¿™æ ·ä¸Šæµ·å’Œæ­å·å°±æ˜¯å¼‚åœ°åŒæ´»çš„ã€‚</p><p>æ”¯ä»˜å®å¯¹å•å…ƒåŒ–çš„åŸºæœ¬è¦æ±‚æ˜¯æ¯ä¸ªå•å…ƒéƒ½å…·å¤‡æœåŠ¡æ‰€æœ‰ç”¨æˆ·çš„èƒ½åŠ›ï¼Œå³â€”â€”å…·ä½“çš„é‚£ä¸ªå•å…ƒæœåŠ¡å“ªäº›ç”¨æˆ·æ˜¯å¯ä»¥åŠ¨æ€é…ç½®çš„ã€‚æ‰€ä»¥å¼‚åœ°åŒæ´»çš„è¿™äº›å•å…ƒè¿˜å……å½“äº†å½¼æ­¤çš„å¤‡ä»½ã€‚</p><blockquote><p>å‘ç°å·¥ä½œä¸­å†·å¤‡çƒ­å¤‡å·²ç»è¢«ç”¨çš„å¾ˆä¹±äº†ã€‚æœ€æ—©å†·å¤‡æ˜¯æŒ‡æ•°æ®åº“åœ¨å¤‡ä»½æ•°æ®æ—¶éœ€è¦å…³é—­åè¿›è¡Œå¤‡ä»½ï¼ˆä¹Ÿå«ç¦»çº¿å¤‡ä»½ï¼‰ï¼Œé˜²æ­¢æ•°æ®å¤‡ä»½è¿‡ç¨‹ä¸­åˆä¿®æ”¹äº†ï¼Œä¸éœ€è¦å…³é—­å³åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œæ•°æ®å¤‡ä»½çš„æ–¹å¼å«åšçƒ­å¤‡(ä¹Ÿå«åœ¨çº¿å¤‡ä»½)ã€‚ä¹Ÿä¸çŸ¥é“ä»å“ªä¸€å¤©å¼€å§‹ï¼Œå†·å¤‡åœ¨ä¸»å¤‡ç³»ç»Ÿé‡Œä»£è¡¨äº†è¿™å°å¤‡ç”¨æœºå™¨æ˜¯å…³é—­çŠ¶æ€çš„ï¼Œåªæœ‰ä¸»æœåŠ¡å™¨æŒ‚äº†ä¹‹åï¼Œå¤‡æœåŠ¡å™¨æ‰ä¼šè¢«å¯åŠ¨ï¼›è€Œç›¸åŒçš„çƒ­å¤‡å˜æˆäº†å¤‡æœåŠ¡å™¨ä¹Ÿæ˜¯å¯åŠ¨çš„ï¼Œåªæ˜¯æ²¡æœ‰æµé‡è€Œå·²ï¼Œä¸€æ—¦ä¸»æœåŠ¡å™¨æŒ‚äº†ä¹‹åï¼Œæµé‡è‡ªåŠ¨æ‰“åˆ°å¤‡æœåŠ¡å™¨ä¸Šã€‚æœ¬æ–‡ä¸æ‰“ç®—ç”¨ç¬¬äºŒç§ç†è§£ï¼Œå› ä¸ºæ„Ÿè§‰æœ‰ç‚¹é‡â€¦</p></blockquote><p>ä¸ºäº†åšåˆ°æ¯ä¸ªå•å…ƒè®¿é—®å“ªäº›ç”¨æˆ·å˜æˆå¯é…ç½®ï¼Œæ”¯ä»˜å®è¦æ±‚å•å…ƒåŒ–ç®¡ç†ç³»ç»Ÿå…·å¤‡æµé‡åˆ°å•å…ƒçš„å¯é…ç½®ä»¥åŠå•å…ƒåˆ°DBçš„å¯é…ç½®èƒ½åŠ›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/ant-unit-request-control.jpg" alt="èš‚èšå•å…ƒåŒ–æµé‡æŒ‘æ‹¨æ¶æ„"></p><p>å…¶ä¸­spanneræ˜¯èš‚èšåŸºäºnginxè‡ªç ”çš„åå‘ä»£ç†ç½‘å…³ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæœ‰äº›è¯·æ±‚æˆ‘ä»¬å¸Œæœ›åœ¨åå‘ä»£ç†å±‚å°±è¢«è½¬å‘è‡³å…¶ä»–IDCçš„spannerè€Œæ— éœ€è¿›å…¥åç«¯æœåŠ¡ï¼Œå¦‚å›¾ç®­å¤´2æ‰€ç¤ºã€‚é‚£ä¹ˆå¯¹äºåº”è¯¥åœ¨æœ¬IDCå¤„ç†çš„è¯·æ±‚ï¼Œå°±ç›´æ¥æ˜ å°„åˆ°å¯¹åº”çš„RZå³å¯ï¼Œå¦‚å›¾ç®­å¤´1ã€‚è¿›å…¥åç«¯æœåŠ¡åï¼Œç†è®ºä¸Šå¦‚æœè¯·æ±‚åªæ˜¯è¯»å–ç”¨æˆ·æµæ°´å‹æ•°æ®ï¼Œé‚£ä¹ˆä¸€èˆ¬ä¸ä¼šå†è¿›è¡Œè·¯ç”±äº†ã€‚ç„¶è€Œï¼Œå¯¹äºæœ‰äº›åœºæ™¯æ¥è¯´ï¼ŒAç”¨æˆ·çš„ä¸€ä¸ªè¯·æ±‚å¯èƒ½å…³è”äº†å¯¹Bç”¨æˆ·æ•°æ®çš„è®¿é—®ï¼Œæ¯”å¦‚Aè½¬è´¦ç»™Bï¼ŒAæ‰£å®Œé’±åè¦è°ƒç”¨è´¦åŠ¡ç³»ç»Ÿå»å¢åŠ Bçš„ä½™é¢ã€‚è¿™æ—¶å€™å°±æ¶‰åŠåˆ°å†æ¬¡çš„è·¯ç”±ï¼ŒåŒæ ·æœ‰ä¸¤ä¸ªç»“æœï¼šè·³è½¬åˆ°å…¶ä»–IDCï¼ˆå¦‚å›¾ç®­å¤´3ï¼‰æˆ–æ˜¯è·³è½¬åˆ°æœ¬IDCçš„å…¶ä»–RZoneï¼ˆå¦‚å›¾ç®­å¤´4ï¼‰ã€‚</p><p>RZoneåˆ°DBæ•°æ®åˆ†åŒºçš„è®¿é—®è¿™æ˜¯äº‹å…ˆé…ç½®å¥½çš„ï¼Œä¸Šå›¾ä¸­RZå’ŒDBæ•°æ®åˆ†åŒºçš„å…³ç³»ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RZ0* --&gt; a</span><br><span class="line">RZ1* --&gt; b</span><br><span class="line">RZ2* --&gt; c</span><br><span class="line">RZ3* --&gt; d</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜æ•´ä¸ªæµé‡æŒ‘æ‹¨çš„è¿‡ç¨‹ï¼Œå‡è®¾Cç”¨æˆ·æ‰€å±çš„æ•°æ®åˆ†åŒºæ˜¯cï¼Œ<a href="http://xn--Ccashier-h00m162e71qtjmspq6k9b2e8ale2bjgyb.alipay.com" target="_blank" rel="noopener">è€ŒCç”¨æˆ·åœ¨æ­å·è®¿é—®äº†cashier.alipay.com</a>ï¼ˆéšä¾¿ç¼–çš„ï¼‰ã€‚</p><p>ï¼ˆ1ï¼‰ç›®å‰æ”¯ä»˜å®é»˜è®¤ä¼šæŒ‰ç…§åœ°åŸŸæ¥è·¯ç”±æµé‡ï¼Œå…·ä½“çš„å®ç°æ‰¿è½½è€…æ˜¯è‡ªç ”çš„GLSBï¼ˆGlobal Server Load Balancingï¼‰[<a href="https://developer.alipay.com/article/1889" target="_blank" rel="noopener">https://developer.alipay.com/article/1889</a>]ï¼Œå®ƒä¼šæ ¹æ®è¯·æ±‚è€…çš„IPï¼Œè‡ªåŠ¨å°†cashier.alipay.comè§£æä¸ºæ­å·IDCçš„IPåœ°å€ï¼ˆæˆ–è€…è·³è½¬åˆ°IDCæ‰€åœ¨çš„åŸŸåï¼‰ã€‚å¤§å®¶è‡ªå·±é«˜è¿‡ç½‘ç«™çš„åŒ–åº”è¯¥çŸ¥é“å¤§éƒ¨åˆ†DNSæœåŠ¡å•†çš„åœ°å€éƒ½æ˜¯é äººå»é…ç½®çš„ï¼ŒGLSBå±äºåŠ¨æ€é…ç½®åŸŸåçš„ç³»ç»Ÿï¼Œç½‘ä¸Šä¹Ÿæœ‰æ¯”è¾ƒç«çš„ç±»ä¼¼äº§å“ï¼Œæ¯”å¦‚èŠ±ç”Ÿå£³ä¹‹ç±»ï¼ˆå»ºè¿‡ç§ç«™çš„åŒå­¦åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼‰çš„ã€‚</p><p>ï¼ˆ2ï¼‰å¥½äº†ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œç”¨æˆ·çš„è¯·æ±‚æ¥åˆ°äº†IDC-1çš„Spanneré›†ç¾¤æœåŠ¡å™¨ä¸Šï¼ŒSpannerä»å†…å­˜ä¸­è¯»å–åˆ°äº†è·¯ç”±é…ç½®ï¼ŒçŸ¥é“äº†è¿™ä¸ªè¯·æ±‚çš„ä¸»ä½“ç”¨æˆ·Cæ‰€å±çš„RZ3*ä¸å†æœ¬IDCï¼Œäºæ˜¯ç›´æ¥è½¬åˆ°äº†IDC-2è¿›è¡Œå¤„ç†ã€‚</p><p>ï¼ˆ3ï¼‰è¿›å…¥IDC-2ä¹‹åï¼Œæ ¹æ®æµé‡é…æ¯”è§„åˆ™ï¼Œè¯¥è¯·æ±‚è¢«åˆ†é…åˆ°äº†RZ3Bè¿›è¡Œå¤„ç†ã€‚</p><p>ï¼ˆ4ï¼‰RZ3Bå¾—åˆ°è¯·æ±‚åå¯¹æ•°æ®åˆ†åŒºcè¿›è¡Œè®¿é—®ã€‚</p><p>ï¼ˆ5ï¼‰å¤„ç†å®Œæ¯•ååŸè·¯è¿”å›ã€‚</p><p>å¤§å®¶åº”è¯¥å‘ç°é—®é¢˜æ‰€åœ¨äº†ï¼Œå¦‚æœå†æ¥ä¸€ä¸ªè¿™æ ·çš„è¯·æ±‚ï¼Œå²‚ä¸æ˜¯æ¯æ¬¡éƒ½è¦è·¨åœ°åŸŸè¿›è¡Œè°ƒç”¨å’Œè¿”å›ä½“ä¼ é€’ï¼Ÿç¡®å®æ˜¯å­˜åœ¨è¿™æ ·çš„é—®é¢˜çš„ï¼Œå¯¹äºè¿™ç§é—®é¢˜ï¼Œæ”¯ä»˜å®æ¶æ„å¸ˆä»¬å†³å®šç»§ç»­æŠŠå†³ç­–é€»è¾‘å¾€ç”¨æˆ·ç»ˆç«¯æ¨ç§»ã€‚æ¯”å¦‚ï¼Œæ¯ä¸ªIDCæœºæˆ¿éƒ½ä¼šæœ‰è‡ªå·±çš„åŸŸåï¼ˆçœŸå®æƒ…å†µå¯èƒ½ä¸æ˜¯è¿™æ ·å‘½åçš„ï¼‰: <a href="http://xn--IDC-1cashieridc-1-gd85ad64a.alipay.com" target="_blank" rel="noopener">IDC-1å¯¹åº”cashieridc-1.alipay.com</a> <a href="http://xn--IDC-2cashieridc-2-gd85ad64a.alipay.com" target="_blank" rel="noopener">IDC-2å¯¹åº”cashieridc-2.alipay.com</a> é‚£ä¹ˆè¯·æ±‚ä»IDC-1æ¶®è¿‡ä¸€éè¿”å›æ—¶ä¼šå°†å‰ç«¯è¯·æ±‚è·³è½¬åˆ°cashieridc-2.alipay.comå»ï¼ˆå¦‚æœæ˜¯APPï¼Œåªéœ€è¦æ›¿æ¢restè°ƒç”¨çš„æ¥å£åŸŸåï¼‰ï¼Œåé¢æ‰€æœ‰ç”¨æˆ·çš„è¡Œä¸ºéƒ½ä¼šåœ¨è¿™ä¸ªåŸŸåä¸Šå‘ç”Ÿï¼Œå°±é¿å…äº†èµ°ä¸€éIDC-1å¸¦æ¥çš„å»¶æ—¶ã€‚</p><h3 id="32-æ”¯ä»˜å®ç¾å¤‡æœºåˆ¶">3.2 æ”¯ä»˜å®ç¾å¤‡æœºåˆ¶</h3><p>æµé‡æŒ‘æ‹¨æ˜¯ç¾å¤‡åˆ‡æ¢çš„åŸºç¡€å’Œå‰ææ¡ä»¶ï¼Œå‘ç”Ÿç¾éš¾åçš„é€šç”¨æ–¹æ³•å°±æ˜¯æŠŠé™·å…¥ç¾éš¾çš„å•å…ƒçš„æµé‡é‡æ–°æ‰“åˆ°æ­£å¸¸çš„å•å…ƒä¸Šå»ï¼Œè¿™ä¸ªæµé‡åˆ‡æ¢çš„è¿‡ç¨‹ä¿—ç§°åˆ‡æµã€‚æ”¯ä»˜å®LDCæ¶æ„ä¸‹çš„ç¾å¤‡æœ‰ä¸‰ä¸ªå±‚æ¬¡ï¼š</p><ul><li><p>åŒæœºæˆ¿å•å…ƒé—´ç¾å¤‡ã€‚</p></li><li><p>åŒåŸæœºæˆ¿é—´ç¾å¤‡ã€‚</p></li><li><p>å¼‚åœ°æœºæˆ¿é—´ç¾å¤‡ã€‚</p></li></ul><p>ï¼ˆ1ï¼‰åŒæœºæˆ¿å•å…ƒé—´ç¾å¤‡</p><p>ç¾éš¾å‘ç”Ÿå¯èƒ½æ€§ç›¸å¯¹æœ€é«˜ï¼ˆä½†å…¶å®ä¹Ÿå¾ˆå°ï¼‰ã€‚å¯¹LDCæ¥è¯´ï¼Œæœ€å°çš„ç¾éš¾å°±æ˜¯æŸä¸ªå•å…ƒç”±äºä¸€äº›åŸå› ï¼ˆå±€éƒ¨æ’åº§æ–­å¼€ã€çº¿è·¯è€åŒ–ã€äººä¸ºæ“ä½œå¤±è¯¯ï¼‰å®•æœºäº†ã€‚ä»3.1èŠ‚é‡Œçš„å›¾ä¸­å¯ä»¥çœ‹åˆ°æ¯ç»„RZéƒ½æœ‰Aï¼ŒBä¸¤ä¸ªå•å…ƒï¼Œè¿™å°±æ˜¯ç”¨æ¥åšåŒæœºæˆ¿ç¾å¤‡çš„ï¼Œå¹¶ä¸”ABä¹‹é—´ä¹Ÿæ˜¯åŒæ´»åŒå¤‡çš„ï¼Œæ­£å¸¸æƒ…å†µä¸‹ABä¸¤ä¸ªå•å…ƒå…±åŒåˆ†æ‹…æ‰€æœ‰çš„è¯·æ±‚ï¼Œä¸€æ—¦Aå•å…ƒæŒ‚äº†ï¼ŒBå•å…ƒå°†è‡ªåŠ¨æ‰¿æ‹…Aå•å…ƒçš„æµé‡ä»½é¢ã€‚è¿™ä¸ªç¾å¤‡æ–¹æ¡ˆæ˜¯é»˜è®¤çš„ã€‚</p><p>(2) åŒåŸæœºæˆ¿é—´ç¾å¤‡</p><p>ç¾éš¾å‘ç”Ÿå¯èƒ½æ€§ç›¸å¯¹æ›´å°ã€‚è¿™ç§ç¾éš¾å‘ç”Ÿçš„åŸå› ä¸€èˆ¬æ˜¯æœºæˆ¿ç”µçº¿ç½‘çº¿è¢«æŒ–æ–­ï¼Œæˆ–è€…æœºæˆ¿ç»´æŠ¤äººå‘˜æ“ä½œå¤±è¯¯å¯¼è‡´çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦äººå·¥çš„åˆ¶å®šæµé‡æŒ‘æ‹¨ï¼ˆåˆ‡æµï¼‰æ–¹æ¡ˆäº†ã€‚ä¸‹é¢æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºä¸Šæµ·çš„ä¸¤ä¸ªIDCæœºæˆ¿ã€‚</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/disaster-backup.jpg" alt="åŒåŸåŒæœºæˆ¿ç¾å¤‡æ¼”ç»ƒ"></p><p>æ•´ä¸ªåˆ‡æµé…ç½®è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼Œé¦–å…ˆéœ€è¦å°†é™·å…¥ç¾éš¾çš„æœºæˆ¿ä¸­RZoneå¯¹åº”çš„æ•°æ®åˆ†åŒºçš„è®¿é—®æƒé…ç½®è¿›è¡Œä¿®æ”¹ï¼›å‡è®¾æˆ‘ä»¬çš„æ–¹æ¡ˆæ˜¯ç”±IDC-2æœºæˆ¿çš„RZ2å’ŒRZ3åˆ†åˆ«æ¥ç®¡IDC-1ä¸­çš„RZ0å’ŒRZ1ã€‚é‚£ä¹ˆé¦–å…ˆè¦åšçš„æ˜¯æŠŠæ•°æ®åˆ†åŒºaï¼Œbå¯¹åº”çš„è®¿é—®æƒä»RZ0å’ŒRZ1æ”¶å›ï¼Œåˆ†é…ç»™RZ2å’ŒRZ3ã€‚å³å°†ï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºä¸ºåˆå§‹æ˜ å°„ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RZ0* --&gt; a</span><br><span class="line">RZ1* --&gt; b</span><br><span class="line">RZ2* --&gt; c</span><br><span class="line">RZ3* --&gt; d</span><br></pre></td></tr></table></figure><p>å˜ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RZ0* --&gt; &#x2F;</span><br><span class="line">RZ1* --&gt; &#x2F;</span><br><span class="line">RZ2* --&gt; a</span><br><span class="line">RZ2* --&gt; c</span><br><span class="line">RZ3* --&gt; b</span><br><span class="line">RZ3* --&gt; d</span><br></pre></td></tr></table></figure><p>ç„¶åå†ä¿®æ”¹ç”¨æˆ·IDå’ŒRZä¹‹é—´çš„æ˜ å°„é…ç½®ã€‚å‡è®¾ä¹‹å‰ä¸º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[00-24] --&gt; RZ0A(50%),RZOB(50%)</span><br><span class="line">[25-49] --&gt; RZ1A(50%),RZ1B(50%)</span><br><span class="line">[50-74] --&gt; RZ2A(50%),RZ2B(50%)</span><br><span class="line">[75-99] --&gt; RZ3A(50%),RZ3B(50%)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæŒ‰ç…§ç¾å¤‡æ–¹æ¡ˆçš„è¦æ±‚ï¼Œè¿™ä¸ªæ˜ å°„é…ç½®å°†å˜ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[00-24] --&gt; RZ2A(50%),RZ2B(50%)</span><br><span class="line">[25-49] --&gt; RZ3A(50%),RZ3B(50%)</span><br><span class="line">[50-74] --&gt; RZ2A(50%),RZ2B(50%)</span><br><span class="line">[75-99] --&gt; RZ3A(50%),RZ3B(50%)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¹‹åï¼Œæ‰€æœ‰æµé‡å°†ä¼šè¢«æ‰“åˆ°IDC-2ä¸­ï¼ŒæœŸé—´éƒ¨åˆ†å·²ç»å‘IDC-1å‘èµ·è¯·æ±‚çš„ç”¨æˆ·ä¼šæ”¶åˆ°å¤±è´¥å¹¶é‡è¯•çš„æç¤ºã€‚ å®é™…æƒ…å†µä¸­ï¼Œæ•´ä¸ªè¿‡ç¨‹å¹¶ä¸æ˜¯ç¾éš¾å‘ç”Ÿåå†å»åšçš„ï¼Œæ•´ä¸ªåˆ‡æ¢çš„æµç¨‹ä¼šä»¥é¢„æ¡ˆé…ç½®çš„å½¢å¼äº‹å…ˆå‡†å¤‡å¥½ï¼Œæ¨é€ç»™æ¯ä¸ªæµé‡æŒ‘æ‹¨å®¢æˆ·ç«¯ï¼ˆé›†æˆåˆ°äº†æ‰€æœ‰çš„æœåŠ¡å’Œspannerä¸­ï¼‰ã€‚</p><blockquote><p>è¿™é‡Œå¯ä»¥æ€è€ƒä¸‹ï¼Œä¸ºä½•å…ˆåˆ‡æ•°æ®åº“æ˜ å°„ï¼Œå†åˆ‡æµé‡å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¦‚æœå…ˆåˆ‡æµé‡ï¼Œæ„å‘³ç€å¤§é‡æ³¨å®šå¤±è´¥çš„è¯·æ±‚ä¼šè¢«æ‰“åˆ°æ–°çš„æ­£å¸¸å•å…ƒä¸Šå»ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼ˆæ•°æ®åº“è¿˜æ²¡å‡†å¤‡å¥½ï¼‰ã€‚</p></blockquote><p>(2) å¼‚åœ°æœºæˆ¿é—´ç¾å¤‡</p><p>è¿™ä¸ªåŸºæœ¬ä¸Šè·ŸåŒåŸæœºæˆ¿é—´ç¾å¤‡ä¸€è‡´ï¼ˆè¿™ä¹Ÿæ˜¯å•å…ƒåŒ–çš„ä¼˜ç‚¹ï¼‰ï¼Œä¸å†èµ˜è¿°ã€‚</p><h2 id="4-èš‚èšå•å…ƒåŒ–æ¶æ„çš„capåˆ†æ">4. èš‚èšå•å…ƒåŒ–æ¶æ„çš„CAPåˆ†æ</h2><h3 id="41-å›é¡¾cap">4.1 å›é¡¾CAP</h3><h4 id="411-capçš„å®šä¹‰">4.1.1 CAPçš„å®šä¹‰</h4><p>CAPåŸåˆ™æ˜¯æŒ‡ä»»æ„ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒåŒæ—¶æœ€å¤šåªèƒ½æ»¡è¶³å…¶ä¸­çš„ä¸¤é¡¹ï¼Œè€Œæ— æ³•åŒæ—¶æ»¡è¶³ä¸‰é¡¹ã€‚æ‰€è°“çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€ä»¶äº‹ä¸€ä¸ªäººåšçš„ï¼Œç°åœ¨åˆ†ç»™å¥½å‡ ä¸ªäººä¸€èµ·å¹²ã€‚æˆ‘ä»¬å…ˆç®€å•å›é¡¾ä¸‹CAPå„ä¸ªç»´åº¦çš„å«ä¹‰ï¼š</p><ul><li><p>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼Œè¿™ä¸ªç†è§£èµ·æ¥å¾ˆç®€å•ï¼Œå°±æ˜¯æ¯æ—¶æ¯åˆ»æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„åŒä¸€ä»½æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚è¿™å°±è¦æ±‚ä»»ä½•æ›´æ–°éƒ½æ˜¯åŸå­çš„ï¼Œå³è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚æƒ³è±¡ä¸€ä¸‹ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯æ‰€æœ‰ç³»ç»Ÿçš„åŸå­æ€§æ˜¯å¤šä¹ˆä½æ•ˆçš„ä¸€ä¸ªæ“ä½œã€‚</p></li><li><p>Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ï¼Œè¿™ä¸ªå¯ç”¨æ€§çœ‹èµ·æ¥å¾ˆå®¹æ˜“ç†è§£ï¼Œä½†çœŸæ­£è¯´æ¸…æ¥šçš„ä¸å¤šã€‚æˆ‘æ›´æ„¿æ„æŠŠå¯ç”¨æ€§è§£é‡Šä¸ºï¼šä»»æ„æ—¶åˆ»ç³»ç»Ÿéƒ½å¯ä»¥æä¾›è¯»å†™æœåŠ¡ã€‚é‚£ä¹ˆä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬ç”¨äº‹åŠ¡å°†æ‰€æœ‰èŠ‚ç‚¹é”ä½æ¥è¿›è¡ŒæŸç§å†™æ“ä½œæ—¶ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹å‘ç”Ÿä¸å¯ç”¨çš„æƒ…å†µï¼Œä¼šè®©æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚å¯¹äºåˆ†ç‰‡å¼çš„NoSQLä¸­é—´ä»¶é›†ç¾¤ï¼ˆRedisï¼ŒMemcachedï¼‰æ¥è¯´ï¼Œä¸€æ—¦ä¸€ä¸ªåˆ†ç‰‡æ­‡èœäº†ï¼Œæ•´ä¸ªç³»ç»Ÿçš„æ•°æ®ä¹Ÿå°±ä¸å®Œæ•´äº†ï¼Œè¯»å–å®•æœºåˆ†ç‰‡çš„æ•°æ®å°±ä¼šæ²¡å“åº”ï¼Œä¹Ÿå°±æ˜¯ä¸å¯ç”¨äº†ã€‚éœ€è¦è¯´æ˜ä¸€ç‚¹ï¼Œå“ªäº›é€‰æ‹©CPçš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸æ˜¯ä»£è¡¨å¯ç”¨æ€§å°±å®Œå…¨æ²¡æœ‰äº†ï¼Œåªæ˜¯å¯ç”¨æ€§æ²¡æœ‰ä¿éšœäº†ã€‚ä¸ºäº†å¢åŠ å¯ç”¨æ€§ä¿éšœï¼Œè¿™ç±»ä¸­é—´ä»¶å¾€å¾€éƒ½æä¾›äº†â€åˆ†ç‰‡é›†ç¾¤+å¤åˆ¶é›†â€çš„æ–¹æ¡ˆã€‚</p></li><li><p>Partition toleranceï¼ˆåˆ†åŒºå®¹å¿æ€§ï¼‰ï¼Œè¿™ä¸ªå¯èƒ½ä¹Ÿæ˜¯å¾ˆå¤šæ–‡ç« éƒ½æ²¡è¯´æ¸…æ¥šçš„ã€‚På¹¶ä¸æ˜¯åƒCAä¸€æ ·æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ€§è´¨ï¼Œå®ƒä¾æ‰˜äºCAæ¥è¿›è¡Œè®¨è®ºã€‚å‚è€ƒæ–‡çŒ®ä¸­è§£é‡Šé“ï¼šâ€é™¤éæ•´ä¸ªç½‘ç»œç˜«ç—ªï¼Œå¦åˆ™ä»»ä½•æ—¶åˆ»ç³»ç»Ÿéƒ½èƒ½æ­£å¸¸å·¥ä½œâ€ï¼Œè¨€ä¸‹ä¹‹æ„æ˜¯å°èŒƒå›´çš„ç½‘ç»œç˜«ç—ªï¼ŒèŠ‚ç‚¹å®•æœºï¼Œéƒ½ä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„CAã€‚æˆ‘æ„Ÿè§‰è¿™ä¸ªè§£é‡Šå¬ç€è¿˜æ˜¯æœ‰ç‚¹æ‡µé€¼ï¼Œæ‰€ä»¥ä¸ªäººæ›´æ„¿æ„è§£é‡Šä¸ºâ€å½“èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œä¸é€šæ—¶ï¼ˆå‡ºç°ç½‘ç»œåˆ†åŒºï¼‰ï¼Œå¯ç”¨æ€§å’Œä¸€è‡´æ€§ä»ç„¶èƒ½å¾—åˆ°ä¿éšœâ€ã€‚ä»ä¸ªäººè§’åº¦ç†è§£ï¼Œåˆ†åŒºå®¹å¿æ€§åˆåˆ†ä¸ºâ€å¯ç”¨æ€§åˆ†åŒºå®¹å¿æ€§â€å’Œâ€ä¸€è‡´æ€§åˆ†åŒºå®¹å¿æ€§â€ã€‚â€å‡ºç°åˆ†åŒºæ—¶ä¼šä¸ä¼šå½±å“å¯ç”¨æ€§â€çš„å…³é”®åœ¨äºâ€éœ€ä¸éœ€è¦æ‰€æœ‰èŠ‚ç‚¹äº’ç›¸æ²Ÿé€šåä½œæ¥å®Œæˆä¸€æ¬¡äº‹åŠ¡â€ï¼Œä¸éœ€è¦çš„è¯æ˜¯é“å®šä¸å½±å“å¯ç”¨æ€§çš„ï¼Œåº†å¹¸çš„æ˜¯åº”è¯¥ä¸å¤ªä¼šæœ‰åˆ†å¸ƒå¼ç³»ç»Ÿä¼šè¢«è®¾è®¡æˆå®Œæˆä¸€æ¬¡äº‹åŠ¡éœ€è¦æ‰€æœ‰èŠ‚ç‚¹è”åŠ¨ï¼Œä¸€å®šè¦ä¸¾ä¸ªä¾‹å­çš„è¯ï¼Œå…¨åŒæ­¥å¤åˆ¶æŠ€æœ¯ä¸‹çš„Mysqlæ˜¯ä¸€ä¸ªå…¸å‹æ¡ˆä¾‹ã€‚â€å‡ºç°åˆ†åŒºæ—¶ä¼šä¸ä¼šå½±å“ä¸€è‡´æ€§â€çš„å…³é”®åˆ™åœ¨äºå‡ºç°è„‘è£‚æ—¶æœ‰æ²¡æœ‰ä¿è¯ä¸€è‡´æ€§çš„æ–¹æ¡ˆï¼Œè¿™å¯¹ä¸»ä»åŒæ­¥å‹æ•°æ®åº“ï¼ˆMySQLã€SQL Serverï¼‰æ˜¯è‡´å‘½çš„ï¼Œä¸€æ—¦ç½‘ç»œå‡ºç°åˆ†åŒºï¼Œäº§ç”Ÿè„‘è£‚ï¼Œç³»ç»Ÿä¼šå‡ºç°ä¸€ä»½æ•°æ®ä¸¤ä¸ªå€¼çš„çŠ¶æ€ï¼Œè°éƒ½ä¸è§‰å¾—è‡ªå·±æ˜¯é”™çš„ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæ­£å¸¸æ¥è¯´åŒä¸€å±€åŸŸç½‘å†…ï¼Œç½‘ç»œåˆ†åŒºçš„æ¦‚ç‡éå¸¸ä½ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºå•¥æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„æ•°æ®åº“ï¼ˆMySQLã€SQL Serverç­‰ï¼‰ä¹Ÿæ˜¯ä¸è€ƒè™‘Pçš„åŸå› ã€‚</p></li></ul><p>ä¸‹å›¾ä¸ºCAPä¹‹é—´çš„ç»å…¸å…³ç³»å›¾ï¼š</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/cap-principle.jpg" alt="CAP å…³ç³»å›¾"></p><p>è¿˜æœ‰ä¸ªéœ€è¦è¯´æ˜çš„åœ°æ–¹ï¼Œå…¶å®åˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆéš¾æ»¡è¶³CAPçš„å‰ææ¡ä»¶æ˜¯è¿™ä¸ªç³»ç»Ÿä¸€å®šæ˜¯æœ‰è¯»æœ‰å†™çš„ï¼Œå¦‚æœåªè€ƒè™‘è¯»ï¼Œé‚£ä¹ˆCAPå¾ˆå®¹æ˜“éƒ½æ»¡è¶³ï¼Œæ¯”å¦‚ä¸€ä¸ªè®¡ç®—å™¨æœåŠ¡ï¼Œæ¥å—è¡¨è¾¾å¼è¯·æ±‚ï¼Œè¿”å›è®¡ç®—ç»“æœï¼Œææˆæ°´å¹³æ‰©å±•çš„åˆ†å¸ƒå¼ï¼Œæ˜¾ç„¶è¿™æ ·çš„ç³»ç»Ÿæ²¡æœ‰ä¸€è‡´æ€§é—®é¢˜ï¼Œç½‘ç»œåˆ†åŒºä¹Ÿä¸æ€•ï¼Œå¯ç”¨æ€§ä¹Ÿæ˜¯å¾ˆç¨³çš„ï¼Œæ‰€ä»¥å¯ä»¥æ»¡è¶³CAPã€‚</p><h4 id="412-capåˆ†ææ–¹æ³•">4.1.2 CAPåˆ†ææ–¹æ³•</h4><p>å…ˆè¯´ä¸‹CAå’ŒPçš„å…³ç³»ï¼Œå¦‚æœä¸è€ƒè™‘Pçš„è¯ï¼Œç³»ç»Ÿæ˜¯å¯ä»¥è½»æ¾å®ç°CAçš„ã€‚è€ŒPå¹¶ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ€§è´¨ï¼Œå®ƒä»£è¡¨çš„æ˜¯ç›®æ ‡åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰æ²¡æœ‰å¯¹ç½‘ç»œåˆ†åŒºçš„æƒ…å†µåšå®¹é”™å¤„ç†ã€‚å¦‚æœåšäº†å¤„ç†ï¼Œå°±ä¸€å®šæ˜¯å¸¦æœ‰Pçš„ï¼Œæ¥ä¸‹æ¥å†è€ƒè™‘åˆ†åŒºæƒ…å†µä¸‹åˆ°åº•é€‰æ‹©äº†Aè¿˜æ˜¯Cã€‚æ‰€ä»¥åˆ†æCAPï¼Œå»ºè®®å…ˆç¡®å®šæœ‰æ²¡æœ‰å¯¹åˆ†åŒºæƒ…å†µåšå®¹é”™å¤„ç†ã€‚ ä»¥ä¸‹æ˜¯ä¸ªäººæ€»ç»“çš„åˆ†æä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»ŸCAPæ»¡è¶³æƒ…å†µçš„ä¸€èˆ¬æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if( ä¸å­˜åœ¨åˆ†åŒºçš„å¯èƒ½æ€§ || åˆ†åŒºåä¸å½±å“å¯ç”¨æ€§æˆ–ä¸€è‡´æ€§ || æœ‰å½±å“ä½†è€ƒè™‘äº†åˆ†åŒºæƒ…å†µ-P)&#123;</span><br><span class="line">    if(å¯ç”¨æ€§åˆ†åŒºå®¹å¿æ€§-A under P)ï¼‰</span><br><span class="line">      return &quot;AP&quot;;</span><br><span class="line">    else if(ä¸€è‡´æ€§åˆ†åŒºå®¹å¿æ€§-C under Pï¼‰</span><br><span class="line">      return &quot;CP&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;  &#x2F;&#x2F;åˆ†åŒºæœ‰å½±å“ä½†æ²¡è€ƒè™‘åˆ†åŒºæƒ…å†µä¸‹çš„å®¹é”™</span><br><span class="line">     if(å…·å¤‡å¯ç”¨æ€§-A &amp;&amp; å…·å¤‡ä¸€è‡´æ€§-Cï¼‰&#123;</span><br><span class="line">         return AC;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œè¯´æ˜ä¸‹ï¼Œå¦‚æœè€ƒè™‘äº†åˆ†åŒºå®¹å¿æ€§ï¼Œå°±ä¸éœ€è¦è€ƒè™‘ä¸åˆ†åŒºæƒ…å†µä¸‹çš„å¯ç”¨æ€§å’Œä¸€è‡´æ€§äº†ï¼ˆå¤§å¤šæ˜¯æ»¡è¶³çš„ï¼‰ã€‚</p></blockquote><h3 id="42-æ°´å¹³æ‰©å±•åº”ç”¨å•æ•°æ®åº“å®ä¾‹çš„capåˆ†æ">4.2 æ°´å¹³æ‰©å±•åº”ç”¨+å•æ•°æ®åº“å®ä¾‹çš„CAPåˆ†æ</h3><p>è®©æˆ‘ä»¬å†æ¥å›é¡¾ä¸‹åˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿçš„æ¥ç”±ï¼Œæ—©å¹´æ¯ä¸ªåº”ç”¨éƒ½æ˜¯å•ä½“çš„ï¼Œè·‘åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼ŒæœåŠ¡å™¨ä¸€æŒ‚ï¼ŒæœåŠ¡å°±ä¸å¯ç”¨äº†ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œå•ä½“åº”ç”¨ç”±äºä¸šåŠ¡åŠŸèƒ½å¤æ‚ï¼Œå¯¹æœºå™¨çš„è¦æ±‚ä¹Ÿé€æ¸å˜é«˜ï¼Œæ™®é€šçš„å¾®æœºæ— æ³•æ»¡è¶³è¿™ç§æ€§èƒ½å’Œå®¹é‡çš„è¦æ±‚ã€‚æ‰€ä»¥è¦æ‹†ï¼è¿˜åœ¨IBMå¤§å–å°å‹å•†ç”¨æœºçš„å¹´ä»£ï¼Œé˜¿é‡Œå·´å·´å°±æå‡ºè¦ä»¥åˆ†å¸ƒå¼å¾®æœºæ›¿ä»£å°å‹æœºã€‚æ‰€ä»¥æˆ‘ä»¬å‘ç°ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿè§£å†³çš„æœ€å¤§çš„ç—›ç‚¹ï¼Œå°±æ˜¯å•ä½“å•æœºç³»ç»Ÿçš„å¯ç”¨æ€§é—®é¢˜ã€‚è¦æƒ³é«˜å¯ç”¨ï¼Œå¿…é¡»åˆ†å¸ƒå¼ã€‚ ä¸€å®¶äº’è”ç½‘å…¬å¸çš„å‘å±•ä¹‹è·¯ä¸Šï¼Œç¬¬ä¸€æ¬¡ä¸åˆ†å¸ƒå¼ç›¸é‡åº”è¯¥éƒ½æ˜¯åœ¨å•ä½“åº”ç”¨çš„æ°´å¹³æ‰©å±•ä¸Šã€‚ä¹Ÿå°±æ˜¯åŒä¸€ä¸ªåº”ç”¨å¯åŠ¨äº†å¤šä¸ªå®ä¾‹ï¼Œè¿æ¥ç€ç›¸åŒçš„æ•°æ®åº“ï¼ˆä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œå…ˆä¸è€ƒè™‘æ•°æ®åº“æ˜¯å¦å•ç‚¹ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/horizontal-scale-arch.jpg" alt="å¤šæœåŠ¡å•æ•°æ®åº“"></p><p>è¿™æ ·çš„ç³»ç»Ÿå¤©ç„¶å…·æœ‰çš„å°±æ˜¯APï¼ˆå¯ç”¨æ€§å’Œåˆ†åŒºå®¹å¿æ€§ï¼‰ï¼Œä¸€æ–¹é¢è§£å†³äº†å•ç‚¹å¯¼è‡´çš„ä½å¯ç”¨æ€§é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢æ— è®ºè¿™äº›æ°´å¹³æ‰©å±•çš„æœºå™¨é—´ç½‘ç»œæ˜¯å¦å‡ºç°åˆ†åŒºï¼Œè¿™äº›æœåŠ¡å™¨éƒ½å¯ä»¥å„è‡ªæä¾›æœåŠ¡ï¼Œå› ä¸ºä»–ä»¬ä¹‹é—´ä¸éœ€è¦è¿›è¡Œæ²Ÿé€šã€‚ç„¶è€Œï¼Œè¿™æ ·çš„ç³»ç»Ÿæ˜¯æ²¡æœ‰ä¸€è‡´æ€§å¯è¨€çš„ï¼Œæƒ³è±¡ä¸€ä¸‹æ¯ä¸ªå®ä¾‹éƒ½å¯ä»¥å¾€æ•°æ®åº“insertå’Œupdateï¼ˆæ³¨æ„è¿™é‡Œè¿˜æ²¡è®¨è®ºåˆ°äº‹åŠ¡ï¼‰ï¼Œé‚£è¿˜ä¸ä¹±äº†å¥—ã€‚</p><p>äºæ˜¯æˆ‘ä»¬è½¬å‘äº†è®©DBå»åšè¿™ä¸ªäº‹ï¼Œè¿™æ—¶å€™â€æ•°æ®åº“äº‹åŠ¡â€å°±è¢«ç”¨ä¸Šäº†ã€‚ç”¨å¤§éƒ¨åˆ†å…¬å¸ä¼šé€‰æ‹©çš„Mysqlæ¥ä¸¾ä¾‹ï¼Œç”¨äº†äº‹åŠ¡ä¹‹åä¼šå‘ç°æ•°æ®åº“åˆå˜æˆäº†å•ç‚¹å’Œç“¶é¢ˆã€‚å•ç‚¹å°±åƒå•æœºä¸€æ ·(æœ¬ä¾‹å­ä¸­ä¸è€ƒè™‘ä»åº“æ¨¡å¼)ï¼Œç†è®ºä¸Šå°±ä¸å«åˆ†å¸ƒå¼äº†ï¼Œå¦‚æœä¸€å®šè¦åˆ†æå…¶CAPçš„è¯ï¼Œæ ¹æ®4.1.2çš„æ­¥éª¤åˆ†æè¿‡ç¨‹åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>åˆ†åŒºå®¹å¿æ€§ï¼šå…ˆçœ‹æœ‰æ²¡æœ‰è€ƒè™‘åˆ†åŒºå®¹å¿æ€§ï¼Œæˆ–è€…åˆ†åŒºåæ˜¯å¦ä¼šæœ‰å½±å“ã€‚å•å°MySQLæ— æ³•æ„æˆåˆ†åŒºï¼Œè¦ä¹ˆæ•´ä¸ªç³»ç»ŸæŒ‚äº†ï¼Œè¦ä¹ˆå°±æ´»ç€ã€‚</p></li><li><p>å¯ç”¨æ€§åˆ†åŒºå®¹å¿æ€§ï¼šåˆ†åŒºæƒ…å†µä¸‹ï¼Œå‡è®¾æ°å¥½æ˜¯è¯¥èŠ‚ç‚¹æŒ‚äº†ï¼Œç³»ç»Ÿä¹Ÿå°±ä¸å¯ç”¨äº†ï¼Œæ‰€ä»¥å¯ç”¨æ€§åˆ†åŒºå®¹å¿æ€§ä¸æ»¡è¶³ã€‚</p></li><li><p>ä¸€è‡´æ€§åˆ†åŒºå®¹å¿æ€§ï¼šåˆ†åŒºæƒ…å†µä¸‹ï¼Œåªè¦å¯ç”¨ï¼Œå•ç‚¹å•æœºçš„æœ€å¤§å¥½å¤„å°±æ˜¯ä¸€è‡´æ€§å¯ä»¥å¾—åˆ°ä¿éšœã€‚</p></li></ul><p>å› æ­¤è¿™æ ·çš„ä¸€ä¸ªç³»ç»Ÿï¼Œä¸ªäººè®¤ä¸ºåªæ˜¯æ»¡è¶³äº†CPã€‚Aæœ‰ä½†ä¸å‡ºè‰²ï¼Œä»è¿™ç‚¹å¯ä»¥çœ‹å‡ºï¼ŒCAPå¹¶ä¸æ˜¯éé»‘å³ç™½çš„ã€‚åŒ…æ‹¬å¸¸è¯´çš„BASEï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰æ–¹æ¡ˆï¼Œå…¶å®åªæ˜¯Cä¸å‡ºè‰²ï¼Œä½†æœ€ç»ˆä¹Ÿæ˜¯è¾¾åˆ°ä¸€è‡´æ€§çš„ï¼ŒBASEåœ¨ä¸€è‡´æ€§ä¸Šé€‰æ‹©äº†é€€è®©ã€‚</p><blockquote><p>å…³äºåˆ†å¸ƒå¼åº”ç”¨+å•ç‚¹æ•°æ®åº“çš„æ¨¡å¼ç®—ä¸ç®—çº¯æ­£çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè¿™ä¸ªå¯èƒ½æ¯ä¸ªäººçœ‹æ³•æœ‰ç‚¹å·®å¼‚ï¼Œä¸Šè¿°åªæ˜¯æˆ‘ä¸ªäººçš„ä¸€ç§ç†è§£ï¼Œæ˜¯ä¸æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯åˆ†æè¿‡ç¨‹ã€‚å…¶å®æˆ‘ä»¬è®¨è®ºåˆ†å¸ƒå¼ï¼Œå°±æ˜¯å¸Œæœ›ç³»ç»Ÿçš„å¯ç”¨æ€§æ˜¯å¤šä¸ªç³»ç»Ÿå¤šæ´»çš„ï¼Œä¸€ä¸ªæŒ‚äº†å¦å¤–çš„ä¹Ÿèƒ½é¡¶ä¸Šï¼Œæ˜¾ç„¶å•æœºå•ç‚¹çš„ç³»ç»Ÿä¸å…·å¤‡è¿™æ ·çš„é«˜å¯ç”¨ç‰¹æ€§ã€‚æ‰€ä»¥åœ¨æˆ‘çœ‹æ¥ï¼Œå¹¿ä¹‰çš„è¯´CAPä¹Ÿé€‚ç”¨äºå•ç‚¹å•æœºç³»ç»Ÿï¼Œå•æœºç³»ç»Ÿæ˜¯CPçš„ã€‚è¯´åˆ°è¿™é‡Œï¼Œå¤§å®¶ä¼¼ä¹ä¹Ÿå‘ç°äº†ï¼Œæ°´å¹³æ‰©å±•çš„æœåŠ¡åº”ç”¨+æ•°æ®åº“è¿™æ ·çš„ç³»ç»Ÿçš„CAPé­”å’’ä¸»è¦å‘ç”Ÿåœ¨æ•°æ®åº“å±‚ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è¿™æ ·çš„æœåŠ¡åº”ç”¨éƒ½åªæ˜¯æ‰¿æ‹…äº†è®¡ç®—çš„ä»»åŠ¡ï¼ˆåƒè®¡ç®—å™¨é‚£æ ·ï¼‰ï¼Œæœ¬èº«ä¸éœ€è¦äº’ç›¸åä½œï¼Œæ‰€æœ‰å†™è¯·æ±‚å¸¦æ¥çš„æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ä¸‹æ²‰åˆ°äº†æ•°æ®åº“å±‚å»è§£å†³ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®åº“å±‚ï¼Œè€Œæ˜¯åº”ç”¨è‡ªå·±æ¥ä¿éšœæ•°æ®ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆè¿™æ ·çš„åº”ç”¨ä¹‹é—´å°±æ¶‰åŠåˆ°çŠ¶æ€çš„åŒæ­¥å’Œäº¤äº’äº†ï¼ŒZookeeperå°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå…¸å‹çš„ä¾‹å­ã€‚</p></blockquote><h3 id="43-æ°´å¹³æ‰©å±•åº”ç”¨ä¸»ä»æ•°æ®åº“é›†ç¾¤çš„capåˆ†æ">4.3 æ°´å¹³æ‰©å±•åº”ç”¨+ä¸»ä»æ•°æ®åº“é›†ç¾¤çš„CAPåˆ†æ</h3><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬è®¨è®ºäº†å¤šåº”ç”¨å®ä¾‹+å•æ•°æ®åº“å®ä¾‹çš„æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¹Ÿå¥½ï¼Œä¸æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¹Ÿç½¢ï¼Œæ•´ä½“æ˜¯åCPçš„ã€‚ç°å®ä¸­ï¼ŒæŠ€æœ¯äººå‘˜ä»¬ä¹Ÿä¼šå¾ˆå¿«å‘ç°è¿™ç§æ¶æ„çš„ä¸åˆç†æ€§â€”â€”å¯ç”¨æ€§å¤ªä½äº†ã€‚äºæ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ¨¡å¼æˆä¸ºäº†å½“ä¸‹å¤§éƒ¨åˆ†ä¸­å°å…¬å¸æ‰€ä½¿ç”¨çš„æ¶æ„ï¼š</p><p><img src="https://www.tbwork.org/image/ant-ldc-arch/horizontal-scale-db-arch.jpg" alt="å¤šæœåŠ¡å¤šæ•°æ®åº“"></p><p>ä»ä¸Šå›¾æˆ‘å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæ•°æ®åº“å®ä¾‹ä¸­åªæœ‰ä¸€ä¸ªæ˜¯ä¸»åº“ï¼Œå…¶ä»–æ˜¯ä»åº“ã€‚ä¸€å®šç¨‹åº¦ä¸Šï¼Œè¿™ç§æ¶æ„æå¤§çš„ç¼“è§£äº†â€è¯»å¯ç”¨æ€§â€é—®é¢˜ï¼Œè€Œè¿™æ ·çš„æ¶æ„ä¸€èˆ¬ä¼šåšè¯»å†™åˆ†ç¦»æ¥è¾¾åˆ°æ›´é«˜çš„â€è¯»å¯ç”¨æ€§â€ï¼Œå¹¸è¿çš„æ˜¯å¤§éƒ¨åˆ†äº’è”ç½‘åœºæ™¯ä¸­è¯»éƒ½å äº†80%ä»¥ä¸Šï¼Œæ‰€ä»¥è¿™æ ·çš„æ¶æ„èƒ½å¾—åˆ°è¾ƒé•¿æ—¶é—´çš„å¹¿æ³›åº”ç”¨ã€‚â€å†™å¯ç”¨æ€§â€å¯ä»¥é€šè¿‡ keepalived è¿™ç§HAï¼ˆé«˜å¯ç”¨ï¼‰æ¡†æ¶æ¥ä¿è¯ä¸»åº“æ˜¯æ´»ç€çš„ï¼Œä½†ä»”ç»†ä¸€æƒ³å°±å¯ä»¥æ˜ç™½ï¼Œè¿™ç§æ–¹å¼å¹¶æ²¡æœ‰å¸¦æ¥æ€§èƒ½ä¸Šçš„å¯ç”¨æ€§æå‡ã€‚è¿˜å¥½ï¼Œè‡³å°‘ç³»ç»Ÿä¸ä¼šå› ä¸ºæŸä¸ªå®ä¾‹æŒ‚äº†å°±éƒ½ä¸å¯ç”¨äº†ã€‚å¯ç”¨æ€§å‹‰å¼ºè¾¾æ ‡äº†ï¼Œè¿™æ—¶å€™çš„CAPåˆ†æå¦‚ä¸‹ï¼š</p><ul><li><p>åˆ†åŒºå®¹å¿æ€§ï¼šä¾æ—§å…ˆçœ‹åˆ†åŒºå®¹å¿æ€§ï¼Œä¸»ä»ç»“æ„çš„æ•°æ®åº“å­˜åœ¨èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œä»–ä»¬ä¹‹é—´éœ€è¦é€šè¿‡å¿ƒè·³æ¥ä¿è¯åªæœ‰ä¸€ä¸ªMasterã€‚ç„¶è€Œä¸€æ—¦å‘ç”Ÿåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºä¼šè‡ªå·±é€‰å–ä¸€ä¸ªæ–°çš„Masterï¼Œè¿™æ ·å°±å‡ºç°äº†è„‘è£‚ï¼Œå¸¸è§çš„ä¸»ä»æ•°æ®åº“ï¼ˆMySQLï¼ŒOracleç­‰ï¼‰å¹¶æ²¡æœ‰è‡ªå¸¦è§£å†³è„‘è£‚çš„æ–¹æ¡ˆã€‚æ‰€ä»¥åˆ†åŒºå®¹å¿æ€§æ˜¯æ²¡è€ƒè™‘çš„ã€‚</p></li><li><p>ä¸€è‡´æ€§ï¼šä¸è€ƒè™‘åˆ†åŒºï¼Œç”±äºä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªä¸»åº“ï¼Œæ‰€ä»¥ä¸€è‡´æ€§æ˜¯æ»¡è¶³çš„ã€‚</p></li><li><p>å¯ç”¨æ€§ï¼šä¸è€ƒè™‘åˆ†åŒºï¼ŒHAæœºåˆ¶çš„å­˜åœ¨å¯ä»¥ä¿è¯å¯ç”¨æ€§ï¼Œæ‰€ä»¥å¯ç”¨æ€§æ˜¾ç„¶ä¹Ÿæ˜¯æ»¡è¶³çš„ã€‚</p></li></ul><p>æ‰€ä»¥è¿™æ ·çš„ä¸€ä¸ªç³»ç»Ÿï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒæ˜¯ACçš„ã€‚æˆ‘ä»¬å†æ·±å…¥ç ”ç©¶ä¸‹ï¼Œå¦‚æœå‘ç”Ÿè„‘è£‚äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´åæœ‰ä¸€ç§æ–¹å¼å¯ä»¥ä»²è£ä¸€è‡´æ€§é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥æ»¡è¶³Päº†å‘¢ã€‚è¿˜çœŸæœ‰å°è¯•é€šè¿‡é¢„å…ˆè®¾ç½®è§„åˆ™æ¥è§£å†³è¿™ç§å¤šä¸»åº“å¸¦æ¥çš„ä¸€è‡´æ€§é—®é¢˜çš„ç³»ç»Ÿï¼Œæ¯”å¦‚CouchDBï¼Œå®ƒé€šè¿‡ç‰ˆæœ¬ç®¡ç†æ¥æ”¯æŒå¤šåº“å†™å…¥ï¼Œåœ¨å…¶ä»²è£é˜¶æ®µä¼šé€šè¿‡DBAé…ç½®çš„ä»²è£è§„åˆ™ï¼ˆä¹Ÿå°±æ˜¯åˆå¹¶è§„åˆ™ï¼Œæ¯”å¦‚è°çš„æ—¶é—´æˆ³æœ€æ™šè°çš„ç”Ÿæ•ˆï¼‰è¿›è¡Œè‡ªåŠ¨ä»²è£ï¼ˆè‡ªåŠ¨åˆå¹¶ï¼‰ï¼Œä»è€Œä¿éšœæœ€ç»ˆä¸€è‡´æ€§ï¼ˆBASEï¼‰ï¼Œè‡ªåŠ¨è§„åˆ™æ— æ³•åˆå¹¶çš„æƒ…å†µåˆ™åªèƒ½ä¾èµ–äººå·¥å†³ç­–äº†ã€‚</p><h3 id="44-èš‚èšå•å…ƒåŒ–ldcæ¶æ„capåˆ†æ">4.4 èš‚èšå•å…ƒåŒ–LDCæ¶æ„CAPåˆ†æ</h3><h4 id="441-æˆ˜èƒœåˆ†åŒºå®¹å¿æ€§">4.4.1 æˆ˜èƒœåˆ†åŒºå®¹å¿æ€§</h4><p>åœ¨è®¨è®ºèš‚èšLDCæ¶æ„çš„CAPä¹‹å‰ï¼Œæˆ‘ä»¬å†æ¥æƒ³æƒ³åˆ†åŒºå®¹å¿æ€§æœ‰å•¥å€¼å¾—ä¸€æçš„ï¼Œä¸ºå•¥å¾ˆå¤šå¤§åé¼é¼çš„BASEï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä½“ç³»ç³»ç»Ÿéƒ½é€‰æ‹©æŸå¤±å®æ—¶ä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯ä¸¢å¼ƒåˆ†åŒºå®¹å¿æ€§å‘¢ï¼Ÿ</p><p>åˆ†åŒºçš„äº§ç”Ÿä¸€èˆ¬æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li><p>æŸå°æœºå™¨å®•æœºäº†ï¼Œè¿‡ä¸€ä¼šå„¿åˆé‡å¯äº†ï¼Œçœ‹èµ·æ¥å°±åƒå¤±è”äº†ä¸€æ®µæ—¶é—´ï¼Œåƒæ˜¯ç½‘ç»œä¸å¯è¾¾ä¸€æ ·ã€‚</p></li><li><p>å¼‚åœ°éƒ¨ç½²æƒ…å†µä¸‹ï¼Œå¼‚åœ°å¤šæ´»æ„å‘³ç€æ¯ä¸€åœ°éƒ½å¯èƒ½ä¼šäº§ç”Ÿæ•°æ®å†™å…¥ï¼Œè€Œå¼‚åœ°ä¹‹é—´å¶å°”çš„ç½‘ç»œå»¶æ—¶å°–åˆºï¼ˆç½‘ç»œå»¶æ—¶æ›²çº¿å›¾é™¡å¢ï¼‰ã€ç½‘ç»œæ•…éšœéƒ½ä¼šå¯¼è‡´å°èŒƒå›´çš„ç½‘ç»œåˆ†åŒºäº§ç”Ÿã€‚å‰æ–‡ä¹Ÿæåˆ°è¿‡ï¼Œå¦‚æœä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯éƒ¨ç½²åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…çš„ï¼ˆä¸€ä¸ªç‰©ç†æœºæˆ¿å†…ï¼‰ï¼Œé‚£ä¹ˆä¸ªäººè®¤ä¸ºåˆ†åŒºçš„æ¦‚ç‡æä½ï¼Œå³ä¾¿æœ‰å¤æ‚çš„æ‹“æ‰‘ï¼Œä¹Ÿå¾ˆå°‘ä¼šæœ‰åœ¨åŒä¸€ä¸ªæœºæˆ¿é‡Œå‡ºç°ç½‘ç»œåˆ†åŒºçš„æƒ…å†µã€‚è€Œå¼‚åœ°è¿™ä¸ªæ¦‚ç‡ä¼šå¤§å¤§å¢é«˜ï¼Œæ‰€ä»¥èš‚èšçš„ä¸‰åœ°äº”ä¸­å¿ƒå¿…é¡»éœ€è¦æ€è€ƒè¿™æ ·çš„é—®é¢˜ï¼Œåˆ†åŒºå®¹å¿ä¸èƒ½ä¸¢ï¼åŒæ ·çš„æƒ…å†µè¿˜ä¼šå‘ç”Ÿåœ¨ä¸åŒISPçš„æœºæˆ¿ä¹‹é—´ï¼ˆæƒ³è±¡ä¸€ä¸‹ä½ å’Œæœ‹å‹ç»„é˜Ÿç©DOTAï¼Œä»–åœ¨ç”µä¿¡ï¼Œä½ åœ¨è”é€šï¼‰ã€‚ä¸ºäº†åº”å¯¹æŸä¸€æ—¶åˆ»æŸä¸ªæœºæˆ¿çªå‘çš„ç½‘ç»œå»¶æ—¶å°–åˆºæ´»ç€é—´æ­‡æ€§å¤±è”ï¼Œä¸€ä¸ªå¥½çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸€å®šèƒ½å¤„ç†å¥½è¿™ç§æƒ…å†µä¸‹çš„ä¸€è‡´æ€§é—®é¢˜ã€‚</p></li></ul><p>é‚£ä¹ˆèš‚èšæ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿæˆ‘ä»¬åœ¨4.2çš„å¤‡æ³¨éƒ¨åˆ†è®¨è®ºè¿‡ï¼Œå…¶å®LDCæœºæˆ¿çš„å„ä¸ªå•å…ƒéƒ½ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šè´Ÿè´£ä¸šåŠ¡é€»è¾‘è®¡ç®—çš„åº”ç”¨æœåŠ¡å™¨å’Œè´Ÿè´£æ•°æ®æŒä¹…åŒ–çš„æ•°æ®åº“ã€‚å¤§éƒ¨åˆ†åº”ç”¨æœåŠ¡å™¨å°±åƒä¸€ä¸ªä¸ªè®¡ç®—å™¨ï¼Œè‡ªèº«æ˜¯ä¸å¯¹å†™ä¸€è‡´æ€§è´Ÿè´£çš„ï¼Œè¿™ä¸ªä»»åŠ¡è¢«ä¸‹æ²‰åˆ°äº†æ•°æ®åº“ã€‚æ‰€ä»¥èš‚èšè§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜çš„å…³é”®å°±åœ¨äºæ•°æ®åº“ï¼</p><p>æƒ³å¿…èš‚èšçš„è¯»è€…å¤§æ¦‚çŒœåˆ°ä¸‹é¢çš„è®¨è®ºé‡ç‚¹äº†â€”â€”OceanBaseï¼ˆä¸‹æ–‡ç®€ç§°OBï¼‰ï¼Œä¸­å›½ç¬¬ä¸€æ¬¾è‡ªä¸»ç ”å‘çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œä¸€æ—¶é—´ä¹Ÿç¡®å®è·å¾—äº†å¾ˆå¤šå…‰ç¯ã€‚åœ¨è®¨è®ºOBå‰ï¼Œæˆ‘ä»¬å…ˆæ¥æƒ³æƒ³Why not MySQL?</p><p>é¦–å…ˆï¼Œå°±åƒCAPä¸‰è§’å›¾ä¸­æŒ‡å‡ºçš„ï¼ŒMySQLæ˜¯ä¸€æ¬¾æ»¡è¶³ACä½†ä¸æ»¡è¶³Pçš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œä¸€ä¸ªMySQLä¸»ä»ç»“æ„çš„æ•°æ®åº“é›†ç¾¤ï¼Œå½“å‡ºç°åˆ†åŒºæ—¶ï¼Œé—®é¢˜åˆ†åŒºå†…çš„Slaveä¼šè®¤ä¸ºä¸»å·²ç»æŒ‚äº†ï¼Œæ‰€ä»¥è‡ªå·±æˆä¸ºæœ¬åˆ†åŒºçš„masterï¼ˆè„‘è£‚ï¼‰ï¼Œç­‰åˆ†åŒºé—®é¢˜æ¢å¤åï¼Œä¼šäº§ç”Ÿ2ä¸ªä¸»åº“çš„æ•°æ®ï¼Œè€Œæ— æ³•ç¡®å®šè°æ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿå°±æ˜¯åˆ†åŒºå¯¼è‡´äº†ä¸€è‡´æ€§è¢«ç ´åã€‚è¿™æ ·çš„ç»“æœæ˜¯ä¸¥é‡çš„ï¼Œè¿™ä¹Ÿæ˜¯èš‚èšå®æ„¿è‡ªç ”OceanBaseçš„åŸåŠ¨åŠ›ä¹‹ä¸€ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½è®©åˆ†å¸ƒå¼ç³»ç»Ÿå…·å¤‡åˆ†åŒºå®¹å¿æ€§å‘¢ï¼ŸæŒ‰ç…§è€æƒ¯ä¾‹ï¼Œæˆ‘ä»¬ä»â€å¯ç”¨æ€§åˆ†åŒºå®¹å¿â€å’Œâ€ä¸€è‡´æ€§åˆ†åŒºå®¹å¿â€ä¸¤ä¸ªæ–¹é¢æ¥è®¨è®ºã€‚ (1) å¯ç”¨æ€§åˆ†åŒºå®¹å¿æ€§ä¿éšœæœºåˆ¶</p><p>å¯ç”¨æ€§åˆ†åŒºå®¹å¿çš„å…³é”®åœ¨äºåˆ«è®©ä¸€ä¸ªäº‹åŠ¡ä»¥æ¥æ‰€æœ‰èŠ‚ç‚¹æ¥å®Œæˆï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œåˆ«è¦æ±‚æ‰€æœ‰èŠ‚ç‚¹å…±åŒåŒæ—¶å‚ä¸æŸä¸ªäº‹åŠ¡å³å¯ã€‚</p><p>(2) ä¸€è‡´æ€§åˆ†åŒºå®¹å¿æ€§ä¿éšœæœºåˆ¶</p><p>è€å®è¯´ï¼Œéƒ½äº§ç”Ÿåˆ†åŒºäº†ï¼Œå“ªè¿˜å¯èƒ½è·å¾—å®æ—¶ä¸€è‡´æ€§ã€‚ä½†è¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ä¹Ÿä¸ç®€å•ï¼Œä¸€æ—¦äº§ç”Ÿåˆ†åŒºï¼Œå¦‚ä½•ä¿è¯åŒä¸€æ—¶åˆ»åªä¼šäº§ç”Ÿä¸€ä»½æè®®å‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œå¦‚ä½•ä¿éšœä»ç„¶åªæœ‰ä¸€ä¸ªè„‘å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹PAXOSç®—æ³•æ˜¯å¦‚ä½•è§£å†³è„‘è£‚é—®é¢˜çš„ã€‚</p><blockquote><p>è¿™é‡Œå¯ä»¥å‘æ•£ä¸‹ï¼Œæ‰€è°“çš„â€è„‘â€å…¶å®å°±æ˜¯å…·å¤‡å†™èƒ½åŠ›çš„ç³»ç»Ÿï¼Œâ€éè„‘â€å°±æ˜¯åªå…·å¤‡è¯»èƒ½åŠ›çš„ç³»ç»Ÿï¼Œå¯¹åº”äº†MySQLé›†ç¾¤ä¸­çš„ä»åº“ã€‚</p></blockquote><p>ä¸‹é¢æ˜¯ä¸€æ®µæ‘˜è‡ªç»´åŸºç™¾ç§‘çš„PAXOSå®šä¹‰ï¼š</p><blockquote><p>Paxos is a family of protocols for solving consensus in a network of unreliable processors (that is, processors that may fail).</p></blockquote><p>å¤§è‡´æ„æ€å°±æ˜¯è¯´ï¼ŒPAXOSæ˜¯åœ¨ä¸€ç¾¤ä¸æ˜¯ç‰¹åˆ«å¯é çš„èŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ä¸­çš„ä¸€ç§å…±è¯†æœºåˆ¶ã€‚Paxosè¦æ±‚ä»»ä½•ä¸€ä¸ªæè®®ï¼Œè‡³å°‘æœ‰(N/2)+1çš„ç³»ç»ŸèŠ‚ç‚¹è®¤å¯ï¼Œæ‰è¢«è®¤ä¸ºæ˜¯å¯ä¿¡çš„ï¼Œè¿™èƒŒåçš„ä¸€ä¸ªåŸºç¡€ç†è®ºæ˜¯å°‘æ•°æœä»å¤šæ•°ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœå¤šæ•°èŠ‚ç‚¹è®¤å¯åï¼Œæ•´ä¸ªç³»ç»Ÿå®•æœºäº†ï¼Œé‡å¯åï¼Œä»ç„¶å¯ä»¥é€šè¿‡ä¸€æ¬¡æŠ•ç¥¨çŸ¥é“å“ªä¸ªå€¼æ˜¯åˆæ³•çš„ï¼ˆå¤šæ•°èŠ‚ç‚¹ä¿ç•™çš„é‚£ä¸ªå€¼ï¼‰ã€‚è¿™æ ·çš„è®¾å®šä¹Ÿå·§å¦™çš„è§£å†³äº†åˆ†åŒºæƒ…å†µä¸‹çš„å…±è¯†é—®é¢˜ï¼Œå› ä¸ºä¸€æ—¦äº§ç”Ÿåˆ†åŒºï¼ŒåŠ¿å¿…æœ€å¤šåªæœ‰ä¸€ä¸ªåˆ†åŒºå†…çš„èŠ‚ç‚¹æ•°é‡ä¼šå¤§äºç­‰äº(N/2)+1ã€‚é€šè¿‡è¿™æ ·çš„è®¾è®¡å°±å¯ä»¥å·§å¦™çš„é¿å¼€è„‘è£‚ï¼Œå½“ç„¶MySQLé›†ç¾¤çš„è„‘è£‚é—®é¢˜ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å…¶ä»–æ–¹æ³•æ¥è§£å†³çš„ï¼Œæ¯”å¦‚åŒæ—¶Pingä¸€ä¸ªå…¬å…±çš„IPï¼ŒæˆåŠŸè€…ç»§ç»­ä¸ºè„‘ï¼Œæ˜¾ç„¶è¿™å°±åˆåˆ¶é€ äº†å¦å¤–ä¸€ä¸ªå•ç‚¹ã€‚</p><blockquote><p>å¦‚æœä½ äº†è§£è¿‡æ¯”ç‰¹å¸æˆ–è€…åŒºå—é“¾ï¼Œä½ å°±çŸ¥é“åŒºå—é“¾çš„åŸºç¡€ç†è®ºä¹Ÿæ˜¯PAXOSã€‚åŒºå—é“¾å€ŸåŠ©PAXOSå¯¹æœ€ç»ˆä¸€è‡´æ€§çš„è´¡çŒ®æ¥æŠµå¾¡æ¶æ„ç¯¡æ”¹ã€‚è€Œæœ¬æ–‡æ¶‰åŠçš„åˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿåˆ™æ˜¯é€šè¿‡PAXOSæ¥è§£å†³åˆ†åŒºå®¹å¿æ€§ã€‚å†è¯´æœ¬è´¨ä¸€ç‚¹ï¼Œä¸€ä¸ªæ˜¯æŠµå¾¡éƒ¨åˆ†èŠ‚ç‚¹å˜åï¼Œä¸€ä¸ªæ˜¯é˜²èŒƒéƒ¨åˆ†èŠ‚ç‚¹å¤±è”ã€‚</p></blockquote><p>å¤§å®¶ä¸€å¬è¯´è¿‡è¿™æ ·çš„æè¿°â€”â€”PAXOSæ˜¯å”¯ä¸€èƒ½è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜çš„è§£æ³•ã€‚è¿™å¥è¯è¶Šæ˜¯ç†è§£è¶Šå‘è§‰å¾—è¯¡å¼‚ï¼Œè¿™ä¼šè®©äººä»¥ä¸ºPAXOSé€ƒç¦»äºCAPçº¦æŸäº†ï¼Œæ‰€ä»¥ä¸ªäººæ›´æ„¿æ„ç†è§£ä¸ºâ€”â€”PAXOSæ˜¯å”¯ä¸€ä¸€ç§ä¿éšœåˆ†å¸ƒå¼ç³»ç»Ÿæœ€ç»ˆä¸€è‡´æ€§çš„å…±è¯†ç®—æ³•ï¼ˆæ‰€è°“å…±è¯†ç®—æ³•ï¼Œå°±æ˜¯å¤§å®¶éƒ½æŒ‰ç…§è¿™ä¸ªç®—æ³•æ¥æ“ä½œï¼Œå¤§å®¶æœ€åçš„ç»“æœä¸€å®šç›¸åŒï¼‰ã€‚PAXOSå¹¶æ²¡æœ‰é€ƒç¦»CAPé­”å’’ï¼Œæ¯•ç«Ÿè¾¾æˆå…±è¯†æ˜¯(N/2)+1çš„èŠ‚ç‚¹ä¹‹é—´çš„äº‹ï¼Œå‰©ä¸‹çš„(N/2)-1çš„èŠ‚ç‚¹ä¸Šçš„æ•°æ®è¿˜æ˜¯æ—§çš„ï¼Œè¿™æ—¶å€™ä»ç„¶æ˜¯ä¸ä¸€è‡´çš„ï¼Œæ‰€ä»¥PAXOSå¯¹ä¸€è‡´æ€§çš„è´¡çŒ®åœ¨äºç»è¿‡ä¸€æ¬¡äº‹åŠ¡åï¼Œè¿™ä¸ªé›†ç¾¤é‡Œå·²ç»æœ‰éƒ¨åˆ†èŠ‚ç‚¹ä¿æœ‰äº†æœ¬æ¬¡äº‹åŠ¡æ­£ç¡®çš„ç»“æœï¼ˆå…±è¯†çš„ç»“æœï¼‰ï¼Œè¿™ä¸ªç»“æœéšåä¼šè¢«å¼‚æ­¥çš„åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ä»¥ä¸‹æ‘˜è‡ªç»´åŸºç™¾ç§‘ï¼š</p><blockquote><p>Quorums express the safety (or consistency) properties of Paxos by ensuring at least some surviving processor retains knowledge of the results.</p></blockquote><p>å¦å¤–PAXOSä¸è¦æ±‚å¯¹æ‰€æœ‰èŠ‚ç‚¹åšå®æ—¶åŒæ­¥ï¼Œå®è´¨ä¸Šæ˜¯è€ƒè™‘åˆ°äº†åˆ†åŒºæƒ…å†µä¸‹çš„å¯ç”¨æ€§ï¼Œé€šè¿‡å‡å°‘å®Œæˆä¸€æ¬¡äº‹åŠ¡éœ€è¦çš„å‚ä¸è€…ä¸ªæ•°ï¼Œæ¥ä¿éšœç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><h4 id="442-oceanbaseçš„capåˆ†æ">4.4.2 OceanBaseçš„CAPåˆ†æ</h4><p>ä¸Šæ–‡æåˆ°è¿‡ï¼Œå•å…ƒåŒ–æ¶æ„ä¸­çš„æˆåƒå±±ä¸‡çš„åº”ç”¨å°±åƒæ˜¯è®¡ç®—å™¨ï¼Œæœ¬èº«æ— CAPé™åˆ¶ï¼Œå…¶CAPé™åˆ¶ä¸‹æ²‰åˆ°äº†å…¶æ•°æ®åº“å±‚ï¼Œä¹Ÿå°±æ˜¯èš‚èšè‡ªç ”çš„åˆ†å¸ƒå¼æ•°æ®åº“OceanBaseï¼ˆæœ¬èŠ‚ç®€ç§°OBï¼‰ã€‚åœ¨OBä½“ç³»ä¸­ï¼Œæ¯ä¸ªæ•°æ®åº“å®ä¾‹éƒ½å…·å¤‡è¯»å†™èƒ½åŠ›ï¼Œå…·ä½“æ˜¯è¯»æ˜¯å†™å¯ä»¥åŠ¨æ€é…ç½®ï¼ˆå‚è€ƒ2.2éƒ¨åˆ†ï¼‰ã€‚å®é™…æƒ…å†µä¸‹å¤§éƒ¨åˆ†æ—¶å€™ï¼Œå¯¹äºæŸä¸€ç±»æ•°æ®ï¼ˆå›ºå®šç”¨æˆ·å·æ®µçš„æ•°æ®ï¼‰ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªå•å…ƒä¼šè´Ÿè´£å†™å…¥æŸä¸ªèŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹è¦ä¹ˆæ˜¯å®æ—¶åº“é—´åŒæ­¥ï¼Œè¦ä¹ˆæ˜¯å¼‚æ­¥æ•°æ®åŒæ­¥ã€‚OBä¹Ÿé‡‡ç”¨äº†PAXOSå…±è¯†åè®®ã€‚å®æ—¶åº“é—´åŒæ­¥çš„èŠ‚ç‚¹(åŒ…å«è‡ªå·±)ä¸ªæ•°è‡³å°‘éœ€è¦(N/2)+1ä¸ªï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³åˆ†åŒºå®¹å¿æ€§é—®é¢˜ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸ªé©¬è€å¸ˆæ”¹è‹±æ–‡åçš„ä¾‹å­æ¥è¯´æ˜OBè®¾è®¡çš„ç²¾å¦™ä¹‹å¤„ã€‚å‡è®¾æ•°æ®åº“æŒ‰ç…§ç”¨æˆ·IDåˆ†åº“åˆ†è¡¨ï¼Œé©¬è€å¸ˆçš„ç”¨æˆ·IDå¯¹åº”çš„æ•°æ®æ®µåœ¨[0-9]ï¼Œå¼€å§‹ç”±å•å…ƒAè´Ÿè´£æ•°æ®å†™å…¥ï¼Œå‡å¦‚é©¬è€å¸ˆï¼ˆç”¨æˆ·IDå‡è®¾ä¸º000ï¼‰æ­£åœ¨ç”¨æ”¯ä»˜å®APPä¿®æ”¹è‡ªå·±çš„è‹±æ–‡åï¼Œé©¬è€å¸ˆä¸€å¼€å§‹æ‰“é”™äº†ï¼Œæ‰“æˆäº†Jason Maï¼ŒAå•å…ƒæ”¶åˆ°äº†è¿™ä¸ªè¯·æ±‚ã€‚è¿™æ—¶å€™å‘ç”Ÿäº†åˆ†åŒºï¼ˆæ¯”å¦‚Aç½‘ç»œæ–­å¼€äº†ï¼‰ï¼Œæˆ‘ä»¬å°†å•å…ƒAå¯¹æ•°æ®æ®µ[0,9]çš„å†™å…¥æƒé™è½¬äº¤ç»™å•å…ƒBï¼ˆæ›´æ”¹æ˜ å°„ï¼‰ï¼Œé©¬è€å¸ˆè¿™æ¬¡å†™å¯¹äº†ï¼Œä¸ºJack Maã€‚è€Œåœ¨ç½‘ç»œæ–­å¼€å‰è¯·æ±‚å·²ç»è¿›å…¥äº†Aï¼Œå†™æƒé™è½¬äº¤ç»™å•å…ƒBç”Ÿæ•ˆåï¼ŒAå’ŒBåŒæ—¶å¯¹[0,9]æ•°æ®æ®µè¿›è¡Œå†™å…¥é©¬è€å¸ˆçš„è‹±æ–‡åã€‚å‡å¦‚è¿™æ—¶å€™éƒ½å…è®¸å†™å…¥çš„è¯å°±ä¼šå‡ºç°ä¸ä¸€è‡´ï¼ŒAå•å…ƒè¯´æˆ‘çœ‹åˆ°é©¬è€å¸ˆè®¾ç½®äº†Jason Maï¼ŒBå•å…ƒè¯´æˆ‘çœ‹åˆ°é©¬è€å¸ˆè®¾ç½®äº†Jack Maã€‚ç„¶è€Œè¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿçš„ï¼ŒAæè®®è¯´æˆ‘å»ºè®®æŠŠé©¬è€å¸ˆçš„è‹±æ–‡åè®¾ç½®ä¸ºJason Maæ—¶ï¼Œå‘ç°æ²¡äººå›åº”å®ƒï¼Œå› ä¸ºå‡ºç°äº†åˆ†åŒºï¼Œå…¶ä»–èŠ‚ç‚¹å¯¹å®ƒæ¥è¯´éƒ½æ˜¯ä¸å¯è¾¾çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæè®®è¢«è‡ªåŠ¨ä¸¢å¼ƒï¼ŒAå¿ƒé‡Œä¹Ÿæ˜ç™½æ˜¯è‡ªå·±åˆ†åŒºäº†ï¼Œä¼šæœ‰ä¸»åˆ†åŒºæ›¿è‡ªå·±å®Œæˆå†™å…¥ä»»åŠ¡çš„ã€‚åŒæ ·çš„ï¼ŒBæå‡ºäº†å°†é©¬è€å¸ˆçš„è‹±æ–‡åæ”¹æˆJack Maåï¼Œå¤§éƒ¨åˆ†èŠ‚ç‚¹éƒ½å“åº”äº†ï¼Œæ‰€ä»¥BæˆåŠŸå°†Jack Maå†™å…¥äº†é©¬è€å¸ˆçš„è´¦å·è®°å½•ã€‚å‡å¦‚åœ¨å†™æƒé™è½¬äº¤ç»™å•å…ƒBåAçªç„¶æ¢å¤äº†ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œä¸¤ç¬”å†™è¯·æ±‚åŒæ—¶è¦æ±‚è·å¾—(N/2)+1ä¸ªèŠ‚ç‚¹çš„äº‹åŠ¡é”ï¼Œé€šè¿‡no-waitè®¾è®¡ï¼Œåœ¨Bè·å¾—äº†é”ä¹‹åï¼Œå…¶ä»–æŒ£å¼ºè¯¥é”çš„äº‹åŠ¡éƒ½ä¼šå› ä¸ºå¤±è´¥è€Œå›æ»šã€‚</p><p>ä¸‹é¢æˆ‘ä»¬åˆ†æä¸‹OBçš„CAPï¼š</p><ul><li><p>åˆ†åŒºå®¹å¿æ€§ï¼šOBèŠ‚ç‚¹ä¹‹é—´æ˜¯æœ‰äº’ç›¸é€šä¿¡çš„ï¼ˆéœ€è¦ç›¸äº’åŒæ­¥æ•°æ®ï¼‰ï¼Œæ‰€ä»¥å­˜åœ¨åˆ†åŒºé—®é¢˜ï¼ŒOBé€šè¿‡ä»…åŒæ­¥åˆ°éƒ¨åˆ†èŠ‚ç‚¹æ¥ä¿è¯å¯ç”¨æ€§ã€‚è¿™ä¸€ç‚¹å°±è¯´æ˜OBåšäº†åˆ†åŒºå®¹é”™ã€‚</p></li><li><p>å¯ç”¨æ€§åˆ†åŒºå®¹å¿æ€§ï¼šOBäº‹åŠ¡åªéœ€è¦åŒæ­¥åˆ°ï¼ˆN/2)+1ä¸ªèŠ‚ç‚¹ï¼Œå…è®¸å…¶ä½™çš„ä¸€å°åŠèŠ‚ç‚¹åˆ†åŒºï¼ˆå®•æœºã€æ–­ç½‘ç­‰ï¼‰ï¼Œåªè¦(N/2)+1ä¸ªèŠ‚ç‚¹æ´»ç€å°±æ˜¯å¯ç”¨çš„ã€‚æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚5ä¸ªèŠ‚ç‚¹åˆ†æˆ3ä»½ï¼ˆ2:2:1ï¼‰ï¼Œé‚£å°±ç¡®å®ä¸å¯ç”¨äº†ï¼Œåªæ˜¯è¿™ç§æƒ…å†µæ¦‚ç‡æ¯”è¾ƒä½ã€‚</p></li><li><p>ä¸€è‡´æ€§åˆ†åŒºå®¹å¿æ€§ï¼šåˆ†åŒºæƒ…å†µä¸‹æ„å‘³ç€éƒ¨åˆ†èŠ‚ç‚¹å¤±è”äº†ï¼Œä¸€è‡´æ€§æ˜¾ç„¶æ˜¯ä¸æ»¡è¶³çš„ã€‚ä½†é€šè¿‡å…±è¯†ç®—æ³•å¯ä»¥ä¿è¯å½“ä¸‹åªæœ‰ä¸€ä¸ªå€¼æ˜¯åˆæ³•çš„ï¼Œå¹¶ä¸”æœ€ç»ˆä¼šé€šè¿‡èŠ‚ç‚¹é—´çš„åŒæ­¥è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p></li></ul><p>æ‰€ä»¥OBä»ç„¶æ²¡æœ‰é€ƒè„±CAPé­”å’’ï¼Œäº§ç”Ÿåˆ†åŒºçš„æ—¶å€™å®ƒå˜æˆAP+æœ€ç»ˆä¸€è‡´æ€§ï¼ˆCï¼‰ã€‚æ•´ä½“æ¥è¯´ï¼Œå®ƒæ˜¯APçš„ï¼Œå³é«˜å¯ç”¨å’Œåˆ†åŒºå®¹å¿ã€‚</p><h2 id="5-ç»“è¯­">5. ç»“è¯­</h2><p>ä¸ªäººæ„Ÿè§‰æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†é¢ç¡®å®ä¸å°‘ï¼Œæ¯ä¸ªç‚¹å•ç‹¬å±•å¼€éƒ½å¯ä»¥è®¨è®ºåŠå¤©ã€‚å›åˆ°æˆ‘ä»¬ç´§æ‰£çš„ä¸»æ—¨æ¥çœ‹ï¼ŒåŒåä¸€æµ·é‡æ”¯ä»˜èƒŒåæŠ€æœ¯ä¸Šå¤§å¿«äººå¿ƒçš„è®¾è®¡åˆ°åº•æ˜¯å•¥ï¼Ÿæˆ‘æƒ³æ— éæ˜¯ä»¥ä¸‹å‡ ç‚¹ï¼š</p><p>åŸºäºç”¨æˆ·åˆ†åº“åˆ†è¡¨çš„RZoneè®¾è®¡ã€‚æ¯ä¸ªç”¨æˆ·ç¾¤ç‹¬å ä¸€ä¸ªå•å…ƒç»™æ•´ä¸ªç³»ç»Ÿçš„å®¹é‡å¸¦æ¥äº†çˆ†å‘å¼å¢é•¿ã€‚</p><ul><li><p>RZoneåœ¨ç½‘ç»œåˆ†åŒºæˆ–ç¾å¤‡åˆ‡æ¢æ—¶OBçš„é˜²è„‘è£‚è®¾è®¡ï¼ˆPAXOSï¼‰ã€‚æˆ‘ä»¬çŸ¥é“RZoneæ˜¯å•è„‘çš„ï¼ˆè¯»å†™éƒ½åœ¨ä¸€ä¸ªå•å…ƒå¯¹åº”çš„åº“ï¼‰ï¼Œè€Œç½‘ç»œåˆ†åŒºæˆ–è€…ç¾å¤‡æ—¶çƒ­åˆ‡æ¢è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿå¤šä¸ªè„‘ï¼ŒOBè§£å†³äº†è„‘è£‚æƒ…å†µä¸‹çš„å…±è¯†é—®é¢˜ï¼ˆPAXOSç®—æ³•ï¼‰ã€‚</p></li><li><p>åŸºäºCZoneçš„æœ¬åœ°è¯»è®¾è®¡ã€‚è¿™ä¸€ç‚¹ä¿è¯äº†å¾ˆå¤§ä¸€éƒ¨åˆ†æœ‰ç€â€œå†™è¯»æ—¶é—´å·®â€ç°è±¡çš„å…¬å…±æ•°æ®èƒ½è¢«é«˜é€Ÿæœ¬åœ°è®¿é—®ã€‚</p></li><li><p>å‰©ä¸‹çš„é‚£ä¸€ä¸¢ä¸¢ä¸èƒ½æœ¬åœ°è®¿é—®åªèƒ½å®æ—¶è®¿é—®GZoneçš„å…¬å…±é…ç½®æ•°æ®ï¼Œä¹Ÿå…´ä¸èµ·ä»€ä¹ˆé£ï¼Œä½œä¸äº†ä»€ä¹ˆæµªã€‚æ¯”å¦‚ç”¨æˆ·åˆ›å»ºè¿™ç§TPSï¼Œä¸ä¼šé«˜åˆ°å“ªé‡Œå»ã€‚å†æ¯”å¦‚å¯¹äºå®æ—¶åº“å­˜æ•°æ®ï¼Œå¯ä»¥é€šè¿‡â€œé¡µé¢å±•ç¤ºæŸ¥è¯¢èµ°åº”ç”¨å±‚ç¼“å­˜â€+â€œå®é™…ä¸‹å•æ—¶å†æ ¡éªŒâ€çš„æ–¹å¼å‡å°‘å…¶GZoneè°ƒç”¨é‡ã€‚<br>è€Œè¿™å°±æ˜¯èš‚èšLDCçš„CRGæ¶æ„ï¼Œç›¸ä¿¡54.4ä¸‡ç¬”/ç§’è¿˜è¿œæ²¡åˆ°LDCçš„ä¸Šé™ï¼Œè¿™ä¸ªæ•°å­—å¯ä»¥åšåˆ°æ›´é«˜ã€‚å½“ç„¶åŒåä¸€æµ·é‡æ”¯ä»˜çš„æˆåŠŸä¸å•å•æ˜¯è¿™ä¹ˆä¸€å¥—è®¾è®¡æ‰€å†³å®šçš„ï¼Œè¿˜æœ‰é¢„çƒ­å‰Šå³°ç­‰è¿è¥+æŠ€æœ¯çš„æ‰‹æ®µï¼Œä»¥åŠæˆç™¾ä¸Šåƒçš„å…„å¼Ÿå§å¦¹å…±åŒå¥‹æˆ˜ï¼Œç‰¹æ­¤åœ¨è¿™å‘å„ä½åŒåä¸€ç•™å®ˆåŒå­¦è‡´æ•¬ã€‚</p></li></ul><p>æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼Œæ–‡ä¸­å¯èƒ½å­˜åœ¨ä¸è¶³æˆ–é—æ¼ä¹‹å¤„ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ã€‚</p><h2 id="6-å‚è€ƒæ–‡çŒ®">6. å‚è€ƒæ–‡çŒ®</h2><ul><li><p>[1] Practice of Cloud System Administration, The: DevOps and SRE Practices for Web Services, Volume 2. Thomas A. Limoncelli, Strata R. Chalup, Christina J. Hogan.</p></li><li><p>[2] MySQL 5.7åŠåŒæ­¥å¤åˆ¶æŠ€æœ¯. <a href="https://www.cnblogs.com/zero-gg/p/9057092.html" target="_blank" rel="noopener">https://www.cnblogs.com/zero-gg/p/9057092.html</a></p></li><li><p>[3] BASEç†è®ºåˆ†æ; <a href="https://www.jianshu.com/p/f6157118e54b" target="_blank" rel="noopener">https://www.jianshu.com/p/f6157118e54b</a></p></li><li><p>[4] Keepalived; <a href="https://baike.baidu.com/item/Keepalived/10346758?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/Keepalived/10346758?fr=aladdin</a></p></li><li><p>[5] PAXOS; <a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Paxos_(computer_science)</a></p></li><li><p>[6] OceanBaseæ”¯æ’‘2135äº¿æˆäº¤é¢èƒŒåçš„æŠ€æœ¯åŸç†; <a href="https://www.cnblogs.com/antfin/articles/10299396.html" target="_blank" rel="noopener">https://www.cnblogs.com/antfin/articles/10299396.html</a></p></li><li><p>[7] Backup; <a href="https://en.wikipedia.org/wiki/Backup" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Backup</a></p></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€ŒTBWORKsâ€™ ZONEã€ï¼ŒåŸæ–‡ï¼š<a href="https://url.cn/5NcT9mA%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://url.cn/5NcT9mAï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <code>editor@hi-linux.com</code> ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-èƒŒæ™¯&quot;&gt;1. èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ä¸€å¹´ä¸€åº¦çš„åŒåä¸€åˆè¦æ¥äº†ï¼Œè‡ª2008å¹´åŒåä¸€ä»¥æ¥ï¼Œåœ¨æ¯å¹´åŒåä¸€è¶…å¤§è§„æ¨¡æµé‡çš„å†²å‡»ä¸Šï¼Œèš‚èšé‡‘æœéƒ½ä¼šä¸æ–­çªç ´ç°æœ‰æŠ€æœ¯çš„æé™ã€‚2010å¹´åŒ11çš„æ”¯ä»˜å³°å€¼ä¸º2ä¸‡ç¬”/åˆ†é’Ÿï¼Œå…¨å¤©1280ä¸‡ç¬”æ”¯ä»˜ï¼Œè¿™ä¸ªæ•°å­—åˆ°2017åŒ11æ—¶å˜ä¸ºäº†25.6ä¸‡ç¬”/ç§’ï¼Œå…¨å¤©14.8äº¿ç¬”ã€‚åœ¨å¦‚æ­¤ä¹‹å¤§çš„æ”¯ä»˜TPSèƒŒåé™¤äº†å‰Šå³°ç­‰é”¦ä¸Šæ·»èŠ±çš„åº”ç”¨çº§ä¼˜åŒ–ï¼Œæœ€è§£æ¸´æœ€å®è´¨çš„æ‹›æ•°å½“æ•°åŸºäºåˆ†åº“åˆ†è¡¨çš„å•å…ƒåŒ–äº†ï¼Œèš‚èšæŠ€æœ¯ç§°ä¹‹ä¸ºLDCï¼ˆé€»è¾‘æ•°æ®ä¸­å¿ƒï¼‰ã€‚æœ¬æ–‡ä¸æ‰“ç®—è®¨è®ºå…·ä½“åˆ°ä»£ç çº§çš„åˆ†æï¼Œè€Œæ˜¯å°è¯•ç”¨æœ€ç®€å•çš„æè¿°æ¥è¯´æ˜å…¶ä¸­æœ€å¤§å¿«äººå¿ƒçš„åŸç†ã€‚æˆ‘æƒ³å…³å¿ƒåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„äººéƒ½æ›¾è¢«ä¸‹é¢è¿™äº›é—®é¢˜æ‰€å›°æ‰°è¿‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ”¯ä»˜å®æµ·é‡æ”¯ä»˜èƒŒåæœ€è§£æ¸´çš„è®¾è®¡æ˜¯å•¥ï¼Ÿæ¢å¥è¯è¯´ï¼Œå®ç°æ”¯ä»˜å®é«˜TPSçš„æœ€å…³é”®çš„è®¾è®¡æ˜¯å•¥ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LDCæ˜¯å•¥ï¼ŸLDCæ€ä¹ˆå®ç°å¼‚åœ°å¤šæ´»å’Œå¼‚åœ°ç¾å¤‡çš„ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CAPé­”å’’åˆ°åº•æ˜¯å•¥ï¼ŸPåˆ°åº•æ€ä¹ˆç†è§£ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯è„‘è£‚ï¼Ÿè·ŸCAPåˆæ˜¯å•¥å…³ç³»ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯PAXOSï¼Œå®ƒè§£å†³äº†å•¥é—®é¢˜ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PAXOSå’ŒCAPå•¥å…³ç³»ï¼ŸPAXOSå¯ä»¥é€ƒè„±CAPé­”å’’ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Oceanbaseèƒ½é€ƒè„±CAPé­”å’’ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä½ å¯¹è¿™äº›æ„Ÿå…´è¶£ï¼Œä¸å¦¨çœ‹ä¸€åœºèµ¤è£¸è£¸çš„è®ºè¿°ï¼Œæ‹’ç»ä½¿ç”¨æ™¦æ¶©éš¾æ‡‚çš„è¯æ±‡ï¼Œç›´é¢æœ€æœ¬è´¨çš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-LDCå’Œå•å…ƒåŒ–&quot;&gt;2. LDCå’Œå•å…ƒåŒ–&lt;/h2&gt;
&lt;p&gt;LDCï¼ˆlogic data center)æ˜¯ç›¸å¯¹äºä¼ ç»Ÿçš„ï¼ˆInternet Data Center-IDCï¼‰æå‡ºçš„ï¼Œé€»è¾‘æ•°æ®ä¸­å¿ƒæ‰€è¡¨è¾¾çš„ä¸­å¿ƒæ€æƒ³æ˜¯æ— è®ºç‰©ç†ç»“æ„å¦‚ä½•çš„åˆ†å¸ƒï¼Œæ•´ä¸ªæ•°æ®ä¸­å¿ƒåœ¨é€»è¾‘ä¸Šæ˜¯ååŒå’Œç»Ÿä¸€çš„ã€‚è¿™å¥è¯æš—å«çš„æ˜¯å¼ºå¤§çš„ä½“ç³»è®¾è®¡ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æŒ‘æˆ˜å°±åœ¨äºæ•´ä½“ååŒå·¥ä½œï¼ˆå¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§ï¼‰å’Œç»Ÿä¸€ï¼ˆä¸€è‡´æ€§ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å•å…ƒåŒ–æ˜¯å¤§å‹äº’è”ç½‘ç³»ç»Ÿçš„å¿…ç„¶é€‰æ‹©è¶‹åŠ¿ï¼Œä¸¾ä¸ªæœ€æœ€é€šä¿—çš„ä¾‹å­æ¥è¯´æ˜å•å…ƒåŒ–ã€‚æˆ‘ä»¬æ€»æ˜¯è¯´TPSå¾ˆéš¾æå‡ï¼Œç¡®å®ä»»ä½•ä¸€å®¶äº’è”ç½‘ï¼ˆæ¯”å¦‚æ·˜å®ã€æºç¨‹ã€æ–°æµªï¼‰å®ƒçš„äº¤æ˜“TPSé¡¶å¤šä»¥åä¸‡è®¡é‡ï¼ˆå¹³å‡æ°´å¹³ï¼‰ï¼Œå¾ˆéš¾å¾€ä¸Šä¸²äº†ï¼Œå› ä¸ºæ•°æ®åº“å­˜å‚¨å±‚ç“¶é¢ˆçš„å­˜åœ¨å†å¤šæ°´å¹³æ‰©å±•çš„æœåŠ¡å™¨éƒ½æ— æ³•ç»•å¼€è¿™ä¸ªç“¶é¢ˆï¼Œè€Œä»æ•´ä¸ªäº’è”ç½‘çš„è§†è§’çœ‹ï¼Œå…¨ä¸–ç•Œç”µå•†çš„äº¤æ˜“TPSå¯ä»¥è½»æ¾ä¸Šäº¿ã€‚è¿™ä¸ªä¾‹å­å¸¦ç»™æˆ‘ä»¬ä¸€äº›æ€è€ƒï¼šä¸ºå•¥å‡ å®¶äº’è”ç½‘çš„TPSä¹‹å’Œå¯ä»¥é‚£ä¹ˆå¤§ï¼ŒæœåŠ¡çš„ç”¨æˆ·æ•°è§„æ¨¡ä¹Ÿæä¸ºå“äººï¼Œè€Œå•ä¸ªäº’è”ç½‘çš„TPSå´å¾ˆéš¾æå‡ï¼Ÿç©¶å…¶æœ¬è´¨ï¼Œæ¯å®¶äº’è”ç½‘éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¤§å‹å•å…ƒï¼Œä»–ä»¬å„è‡ªæœåŠ¡è‡ªå·±çš„ç”¨æˆ·äº’ä¸å¹²æ‰°ã€‚è¿™å°±æ˜¯å•å…ƒåŒ–çš„åŸºæœ¬ç‰¹æ€§ï¼Œä»»ä½•ä¸€å®¶äº’è”ç½‘å…¬å¸ï¼Œå…¶æƒ³è¦æˆå€çš„æ‰©å¤§è‡ªå·±ç³»ç»Ÿçš„æœåŠ¡èƒ½åŠ›ï¼Œéƒ½å¿…ç„¶ä¼šèµ°å‘å•å…ƒåŒ–ä¹‹è·¯ï¼Œå®ƒçš„æœ¬è´¨æ˜¯åˆ†æ²»ï¼Œæˆ‘ä»¬æŠŠå¹¿å¤§çš„ç”¨æˆ·åˆ†ä¸ºè‹¥å¹²éƒ¨åˆ†ï¼ŒåŒæ—¶æŠŠç³»ç»Ÿå¤åˆ¶å¤šä»½ï¼Œæ¯ä¸€ä»½éƒ½ç‹¬ç«‹éƒ¨ç½²ï¼Œæ¯ä¸€ä»½ç³»ç»Ÿéƒ½æœåŠ¡ç‰¹å®šçš„ä¸€ç¾¤ç”¨æˆ·ï¼Œä»¥æ·˜å®ä¸¾ä¾‹ï¼Œè¿™æ ·ä¹‹åï¼Œå°±ä¼šæœ‰å¾ˆå¤šä¸ªæ·˜å®ç³»ç»Ÿåˆ†åˆ«ä¸ºä¸åŒçš„ç”¨æˆ·æœåŠ¡ï¼Œæ¯ä¸ªæ·˜å®ç³»ç»Ÿéƒ½åšåˆ°åä¸‡TPSçš„è¯ï¼ŒNä¸ªè¿™æ ·çš„ç³»ç»Ÿå°±å¯ä»¥è½»æ¾åšåˆ°N*åä¸‡çš„TPSäº†ã€‚&lt;/p&gt;
&lt;p&gt;LDCå®ç°çš„å…³é”®å°±åœ¨äºå•å…ƒåŒ–ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼Œæ‰€ä»¥åœ¨èš‚èšå†…éƒ¨ï¼ŒLDCå’Œå•å…ƒåŒ–æ˜¯ä¸åˆ†å®¶çš„ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šåŒå­¦æ¯”è¾ƒå›°æ‰°çš„åœ°æ–¹ï¼Œçœ‹ä¼¼æ²¡å•¥å…³ç³»ï¼Œå®åˆ™æ˜¯å•å…ƒåŒ–ä½“ç³»è®¾è®¡æˆå°±äº†LDCã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å°ç»“ï¼šåˆ†åº“åˆ†è¡¨è§£å†³çš„æœ€å¤§ç—›ç‚¹æ˜¯æ•°æ®åº“å•ç‚¹ç“¶é¢ˆï¼Œè¿™ä¸ªç“¶é¢ˆçš„äº§ç”Ÿæ˜¯ç”±ç°ä»£äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨ä½“ç³»å†³å®šçš„ï¼ˆå³I/Oé€Ÿåº¦ï¼‰ã€‚å•å…ƒåŒ–åªæ˜¯åˆ†åº“åˆ†è¡¨åç³»ç»Ÿéƒ¨ç½²çš„ä¸€ç§æ–¹å¼ï¼Œè¿™ç§éƒ¨ç½²æ¨¡å¼åœ¨ç¾å¤‡æ–¹é¢ä¹Ÿå‘æŒ¥äº†æå¤§çš„ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="åˆ†å¸ƒå¼" scheme="https://www.hi-linux.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>åŠå…¬ç¯å¢ƒä¸‹å®ç° Kubernetes ç½‘ç»œäº’é€šæ–¹æ¡ˆ</title>
    <link href="https://www.hi-linux.com/posts/55876.html"/>
    <id>https://www.hi-linux.com/posts/55876.html</id>
    <published>2020-05-24T01:20:00.000Z</published>
    <updated>2020-05-24T09:19:12.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>åœ¨ <code>Kubernetes</code> çš„ç½‘ç»œæ¨¡å‹ä¸­ï¼ŒåŸºäºå®˜æ–¹é»˜è®¤çš„ <code>CNI</code> ç½‘ç»œæ’ä»¶ <code>Flannel</code>ï¼Œè¿™ç§ <code>Overlay Network</code>ï¼ˆè¦†ç›–ç½‘ç»œï¼‰å¯ä»¥è½»æ¾çš„å®ç° <code>Pod</code> é—´ç½‘ç»œçš„äº’é€šã€‚å½“æˆ‘ä»¬æŠŠåŸºäº <code>Spring Cloud</code> çš„å¾®æœåŠ¡è¿ç§»åˆ° <code>K8S</code> ä¸­åï¼Œæ— é¡»ä»»ä½•æ”¹åŠ¨ï¼Œå¾®æœåŠ¡ <code>Pod</code> å¯ä»¥é€šè¿‡ <code>Eureka</code> æ³¨å†Œåå¯ä»¥äº’ç›¸è½»æ¾è®¿é—®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Ingress</code> + <code>Ingress Controller</code> ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼ŒæŠŠåŸºäº HTTP 80 ç«¯å£ã€HTTPS 443 ç«¯å£çš„ç”¨æˆ·è¯·æ±‚æµé‡å¼•å…¥åˆ°é›†ç¾¤æœåŠ¡ä¸­ã€‚</p><p>ä½†æ˜¯å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å‡ºç°äº†ä»¥ä¸‹éœ€æ±‚ï¼š</p><ul><li>åŠå…¬å®¤ç½‘ç»œ å’Œ <code>K8s Pod</code> ç½‘ç»œä¸é€šã€‚å¼€å‘åœ¨ç”µè„‘å®ŒæˆæŸä¸ªå¾®æœåŠ¡æ¨¡å—å¼€å‘åï¼Œå¸Œæœ›æœ¬åœ°å¯åŠ¨åï¼Œèƒ½æ³¨å†Œåˆ° <code>K8S</code> ä¸­å¼€å‘ç¯å¢ƒçš„æœåŠ¡ä¸­å¿ƒè¿›è¡Œè°ƒè¯•ï¼Œè€Œä¸æ˜¯æœ¬åœ°èµ·ä¸€å †ä¾èµ–çš„æœåŠ¡ã€‚</li><li>åŠå…¬å®¤ç½‘ç»œ å’Œ <code>K8s Svc</code> ç½‘ç»œä¸é€šã€‚åœ¨ <code>K8S</code> ä¸­è¿è¡Œçš„ <code>Mysql</code>ã€<code>Redis</code> ç­‰ï¼Œæ— æ³•é€šè¿‡ <code>Ingress</code> 7 å±‚æš´éœ²ï¼Œå¼€å‘ç”µè„‘æ— æ³•é€šè¿‡å®¢æˆ·ç«¯å·¥å…·ç›´æ¥è®¿é—®ï¼›å¦‚æœæˆ‘ä»¬é€šè¿‡ <code>Service</code> çš„ <code>NodePort</code> æ¨¡å¼ï¼Œä¼šå¯¼è‡´ç»´æŠ¤é‡å·¥ä½œé‡å·¨å¤§ã€‚</li></ul><h3 id="ç½‘ç»œäº’é€šé…ç½®">ç½‘ç»œäº’é€šé…ç½®</h3><p><code>K8S</code> é›†ç¾¤ä¸­æ–°åŠ ä¸€å°é…ç½®ä¸é«˜ï¼ˆ2 æ ¸ 4Gï¼‰çš„ <code>Node</code> èŠ‚ç‚¹ï¼ˆnode-30ï¼‰ä¸“é—¨åšè·¯ç”±è½¬å‘ï¼Œè¿æ¥åŠå…¬å®¤ç½‘ç»œå’Œ <code>K8S</code> é›†ç¾¤ <code>Pod</code>ã€<code>Svc</code>ã€‚</p><ul><li>node-30 IP åœ°å€ 10.60.20.30</li><li>å†…ç½‘ DNS IP åœ°å€ 10.60.20.1</li><li>Pod ç½‘æ®µ 10.244.0.0/24ï¼ŒSvc ç½‘æ®µ 10.96.0.0/12</li><li>åŠå…¬ ç½‘æ®µ 192.168.0.0/22</li></ul><p>ç»™ node-30 èŠ‚ç‚¹æ‰“ä¸Šæ±¡ç‚¹æ ‡ç­¾ï¼ˆTaintsï¼‰ï¼Œä¸è®© <code>K8S</code> è°ƒåº¦ <code>Pod</code> æ¥å ç”¨èµ„æºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl taint nodes node-30 forward&#x3D;node-30:NoSchedule</span><br></pre></td></tr></table></figure><a id="more"></a><p>node-30 èŠ‚ç‚¹ï¼Œåš <code>SNAT</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯è½¬å‘</span><br><span class="line">$ vim &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</span><br><span class="line">net.ipv4.ip_forward &#x3D; 1</span><br><span class="line">$ sysctl -p</span><br><span class="line"></span><br><span class="line"># æ¥è‡ªåŠå…¬å®¤è®¿é—®podã€service snat</span><br><span class="line">$ iptables -t nat -A POSTROUTING -s 192.168.0.0&#x2F;22 -d 10.244.0.0&#x2F;24 -j MASQUERADE</span><br><span class="line">$ iptables -t nat -A POSTROUTING -s 192.168.0.0&#x2F;22 -d 10.96.0.0&#x2F;12 -j  MASQUERADE</span><br></pre></td></tr></table></figure><p>åœ¨åŠå…¬å®¤çš„å‡ºå£è·¯ç”±å™¨ä¸Šï¼Œè®¾ç½®é™æ€è·¯ç”±ï¼Œå°† <code>K8S Pod</code> å’Œ <code>Service</code> çš„ç½‘æ®µï¼Œè·¯ç”±åˆ° node-30 èŠ‚ç‚¹ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ip route 10.244.0.0 255.255.255.0 10.60.20.30</span><br><span class="line">$ ip route 10.96.0.0  255.240.0.0   10.60.20.30</span><br></pre></td></tr></table></figure><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-office-1.jpeg" alt=""></p><h3 id="dns-è§£æé…ç½®">DNS è§£æé…ç½®</h3><p>ä»¥ä¸Šæ­¥éª¤æ“ä½œåï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æœ¬åœ°ç”µè„‘é€šè¿‡è®¿é—® <code>Pod IP</code> å’Œ <code>Service IP</code> å»è®¿é—®æœåŠ¡ã€‚ä½†æ˜¯åœ¨ <code>K8S</code> ä¸­ï¼Œç”±äº <code>Pod IP</code> éšæ—¶éƒ½å¯èƒ½åœ¨å˜åŒ–ï¼Œ<code>Service IP</code> ä¹Ÿä¸æ˜¯å¼€å‘ã€æµ‹è¯•èƒ½è½»æ¾è·å–åˆ°çš„ã€‚æˆ‘ä»¬å¸Œæœ›å†…ç½‘ <code>DNS</code> åœ¨è§£æ <code>*.cluster.local</code>ï¼Œ <code>CoreDNS</code> å¯»æ‰¾è§£æç»“æœã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çº¦å®šå°†ï¼ˆé¡¹ç›®A ã€å¼€å‘ç¯å¢ƒä¸€ ã€æ•°æ®åº“ <code>MySQL</code>ï¼‰éƒ¨ç½²åˆ° ProjectA-dev1 è¿™ä¸ª <code>Namespace</code> ä¸‹ï¼Œç”±äºæœ¬åœ°åˆ° <code>K8S</code> é›†ç¾¤ <code>Service</code> ç½‘ç»œå·²ç»æ‰“é€šï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°ç”µè„‘ä½¿ç”¨ <code>MySQL</code> å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåªéœ€è¦å¡«å†™ <code>mysql.ProjectA-dev1.svc.cluster.local</code> å³å¯ï¼Œ<code>DNS</code> æŸ¥è¯¢è¯·æ±‚åˆ°äº†å†…ç½‘ <code>DNS</code> åï¼Œèµ°å‘ <code>CoreDNS</code>ï¼Œä»è€Œè§£æå‡º <code>Service IP</code>ã€‚</p><p>ç”±äºå†…ç½‘ <code>DNS</code> åœ¨è§£æ <code>*.cluster.local</code>ï¼Œéœ€è¦è®¿é—® <code>CoreDNS</code> å¯»æ‰¾è§£æç»“æœã€‚è¿™å°±éœ€è¦ä¿è¯ç½‘ç»œå¯è¾¾ï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼Œ æœ€ç®€å•çš„åšæ³•ï¼Œæˆ‘ä»¬æŠŠå†…ç½‘ <code>DNS</code> æ¶è®¾åœ¨ node-30 è¿™å°èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆä»–è‚¯å®šè®¿é—®åˆ° <code>Kube-DNS</code> 10.96.0.10</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl  get svc  -n kube-system |grep kube-dns</span><br><span class="line">kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53&#x2F;UDP,53&#x2F;TCP   20d</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ¡ˆäºŒï¼Œç”±äºæˆ‘ä»¬å®éªŒåœºæ™¯å†…ç½‘ <code>DNS IP</code> åœ°å€ 10.60.20.1 ï¼Œå¹¶ä¸åœ¨ node-30 ä¸Šï¼Œæˆ‘ä»¬éœ€è¦æ‰“é€š 10.60.20.1 è®¿é—® <code>SVC</code> ç½‘æ®µ 10.96.0.0/12 å³å¯</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å†…ç½‘DNSï¼ˆIP 10.60.20.1ï¼‰ æ·»åŠ é™æ€è·¯ç”±</span><br><span class="line">$ route add -net 10.96.0.0&#x2F;12 gw 10.60.20.30</span><br><span class="line"></span><br><span class="line"># node-30ï¼ˆIP 10.60.20.30ï¼‰ åš SNAT</span><br><span class="line">$ iptables -t nat -A POSTROUTING -s 10.60.20.1&#x2F;32 -d 10.96.0.0&#x2F;12 -j MASQUERADE</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ¡ˆä¸‰ï¼ˆå®éªŒé€‰æ‹©ï¼‰ï¼Œç”±äºæˆ‘ä»¬å®éªŒåœºæ™¯å†…ç½‘ <code>DNS IP</code> 10.60.20.1 å¹¶ä¸åœ¨ node-30 ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>nodeSelector</code> åœ¨ node-30 éƒ¨ç½²ä¸€ä¸ª <code>Nginx Ingress Controller</code>ï¼Œ ç”¨ 4 å±‚æš´éœ²å‡ºæ¥ <code>CoreDNS</code> çš„ TCP/UDP 53 ç«¯å£ã€‚</li></ul><p>ç»™ node-30 æ‰“ä¸Šæ ‡ç­¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl label nodes node-30 node&#x3D;dns-l4</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ª <code>Namespace</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create ns dns-l4</span><br></pre></td></tr></table></figure><p>åœ¨ <code>Namespace</code> dns-l4 ä¸‹éƒ¨ç½² <code>Nginx Ingress Controller</code>ï¼Œé€‰æ‹©èŠ‚ç‚¹ node-30ï¼Œå¹¶ Tolerate (å®¹å¿ï¼‰å…¶æ±¡ç‚¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-configuration</span><br><span class="line">  namespace: dns-l4</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: tcp-services</span><br><span class="line">  namespace: dns-l4</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">data:</span><br><span class="line">  53: &quot;kube-system&#x2F;kube-dns:53&quot;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: udp-services</span><br><span class="line">  namespace: dns-l4</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">data:</span><br><span class="line">  53: &quot;kube-system&#x2F;kube-dns:53&quot;</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress-serviceaccount</span><br><span class="line">  namespace: dns-l4</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1beta1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress-clusterrole</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - configmaps</span><br><span class="line">      - endpoints</span><br><span class="line">      - nodes</span><br><span class="line">      - pods</span><br><span class="line">      - secrets</span><br><span class="line">    verbs:</span><br><span class="line">      - list</span><br><span class="line">      - watch</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - nodes</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - services</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line">      - list</span><br><span class="line">      - watch</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;extensions&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - ingresses</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line">      - list</span><br><span class="line">      - watch</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - events</span><br><span class="line">    verbs:</span><br><span class="line">      - create</span><br><span class="line">      - patch</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;extensions&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - ingresses&#x2F;status</span><br><span class="line">    verbs:</span><br><span class="line">      - update</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1beta1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress-role</span><br><span class="line">  namespace: dns-l4</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - configmaps</span><br><span class="line">      - pods</span><br><span class="line">      - secrets</span><br><span class="line">      - namespaces</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - configmaps</span><br><span class="line">    resourceNames:</span><br><span class="line">      # Defaults to &quot;&lt;election-id&gt;-&lt;ingress-class&gt;&quot;</span><br><span class="line">      # Here: &quot;&lt;ingress-controller-leader&gt;-&lt;nginx&gt;&quot;</span><br><span class="line">      # This has to be adapted if you change either parameter</span><br><span class="line">      # when launching the nginx-ingress-controller.</span><br><span class="line">      - &quot;ingress-controller-leader-nginx&quot;</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line">      - update</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - configmaps</span><br><span class="line">    verbs:</span><br><span class="line">      - create</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - endpoints</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1beta1</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress-role-nisa-binding</span><br><span class="line">  namespace: dns-l4</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Role</span><br><span class="line">  name: nginx-ingress-role</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: nginx-ingress-serviceaccount</span><br><span class="line">    namespace: dns-l4</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1beta1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress-clusterrole-nisa-binding</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: nginx-ingress-clusterrole</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: nginx-ingress-serviceaccount</span><br><span class="line">    namespace: dns-l4</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress-controller</span><br><span class="line">  namespace: dns-l4</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">    app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">      app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app.kubernetes.io&#x2F;name: ingress-nginx</span><br><span class="line">        app.kubernetes.io&#x2F;part-of: ingress-nginx</span><br><span class="line">      annotations:</span><br><span class="line">        prometheus.io&#x2F;port: &quot;10254&quot;</span><br><span class="line">        prometheus.io&#x2F;scrape: &quot;true&quot;</span><br><span class="line">    spec:</span><br><span class="line">      nodeSelector:</span><br><span class="line">        node: dns-l4</span><br><span class="line">      hostNetwork: true</span><br><span class="line">      serviceAccountName: nginx-ingress-serviceaccount</span><br><span class="line">      tolerations:</span><br><span class="line">      - key: &quot;node-30&quot;</span><br><span class="line">        operator: &quot;Exists&quot;</span><br><span class="line">        effect: &quot;NoSchedule&quot;</span><br><span class="line">      containers:</span><br><span class="line">        - name: nginx-ingress-controller</span><br><span class="line">          image: quay.io&#x2F;kubernetes-ingress-controller&#x2F;nginx-ingress-controller:0.21.0</span><br><span class="line">          args:</span><br><span class="line">            - &#x2F;nginx-ingress-controller</span><br><span class="line">            - --configmap&#x3D;$(POD_NAMESPACE)&#x2F;nginx-configuration</span><br><span class="line">            - --tcp-services-configmap&#x3D;$(POD_NAMESPACE)&#x2F;tcp-services</span><br><span class="line">            - --udp-services-configmap&#x3D;$(POD_NAMESPACE)&#x2F;udp-services</span><br><span class="line">            - --publish-service&#x3D;$(POD_NAMESPACE)&#x2F;ingress-nginx</span><br><span class="line">            - --annotations-prefix&#x3D;nginx.ingress.kubernetes.io</span><br><span class="line">          securityContext:</span><br><span class="line">            capabilities:</span><br><span class="line">              drop:</span><br><span class="line">                - ALL</span><br><span class="line">              add:</span><br><span class="line">                - NET_BIND_SERVICE</span><br><span class="line">            runAsUser: 33</span><br><span class="line">          env:</span><br><span class="line">            - name: POD_NAME</span><br><span class="line">              valueFrom:</span><br><span class="line">                fieldRef:</span><br><span class="line">                  fieldPath: metadata.name</span><br><span class="line">            - name: POD_NAMESPACE</span><br><span class="line">              valueFrom:</span><br><span class="line">                fieldRef:</span><br><span class="line">                  fieldPath: metadata.namespace</span><br><span class="line">          ports:</span><br><span class="line">            - name: http</span><br><span class="line">              containerPort: 80</span><br><span class="line">            - name: https</span><br><span class="line">              containerPort: 443</span><br><span class="line">          livenessProbe:</span><br><span class="line">            failureThreshold: 3</span><br><span class="line">            httpGet:</span><br><span class="line">              path: &#x2F;healthz</span><br><span class="line">              port: 10254</span><br><span class="line">              scheme: HTTP</span><br><span class="line">            initialDelaySeconds: 10</span><br><span class="line">            periodSeconds: 10</span><br><span class="line">            successThreshold: 1</span><br><span class="line">            timeoutSeconds: 1</span><br><span class="line">          readinessProbe:</span><br><span class="line">            failureThreshold: 3</span><br><span class="line">            httpGet:</span><br><span class="line">              path: &#x2F;healthz</span><br><span class="line">              port: 10254</span><br><span class="line">              scheme: HTTP</span><br><span class="line">            periodSeconds: 10</span><br><span class="line">            successThreshold: 1</span><br><span class="line">            timeoutSeconds: 1</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²å®Œæˆåï¼Œç”µè„‘éªŒè¯ï¼Œæ˜¯å¦ç”Ÿæ•ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nslookup -q&#x3D;A kube-dns.kube-system.svc.cluster.local  10.60.20.30</span><br></pre></td></tr></table></figure><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-office-2.jpeg" alt=""></p><p>è¿™é‡Œæˆ‘ä»¬ç”¨è½»é‡çº§çš„ <code>Dnsmasq</code> æ¥ä½œä¸ºå†…ç½‘ <code>DNS</code> é…ç½®æ¡ˆä¾‹ï¼Œå°†æ¥è‡ªå†…ç½‘çš„ <code>*.cluster.local</code> è§£æè¯·æ±‚ï¼Œèµ° <code>KubeDNS</code> 10.60.20.30ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim &#x2F;etc&#x2F;dnsmasq.conf</span><br><span class="line">strict-order</span><br><span class="line">listen-address&#x3D;10.60.20.1</span><br><span class="line">bogus-nxdomain&#x3D;61.139.2.69</span><br><span class="line">server&#x3D;&#x2F;cluster.local&#x2F;10.60.20.30</span><br></pre></td></tr></table></figure><p>å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæˆ‘ä»¬åŠå…¬ç½‘ç»œä¸ <code>Kubernetes</code> ç½‘ç»œäº’é€šçš„éœ€æ±‚ä¹Ÿå°±å®ç°äº†ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ <code>K8S Service</code> çš„åŸŸåè§„åˆ™å»è®¿é—®åˆ° <code>K8S</code> ä¸­çš„æœåŠ¡ã€‚</p><p><img src="https://www.hi-linux.com/img/linux/Kubernetes-office-3.jpeg" alt=""></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œé˜³æ˜çš„åšå®¢ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/EJNfDJY%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">http://t.cn/EJNfDJYï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <code>editor@hi-linux.com</code> ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ &lt;code&gt;Kubernetes&lt;/code&gt; çš„ç½‘ç»œæ¨¡å‹ä¸­ï¼ŒåŸºäºå®˜æ–¹é»˜è®¤çš„ &lt;code&gt;CNI&lt;/code&gt; ç½‘ç»œæ’ä»¶ &lt;code&gt;Flannel&lt;/code&gt;ï¼Œè¿™ç§ &lt;code&gt;Overlay Network&lt;/code&gt;ï¼ˆè¦†ç›–ç½‘ç»œï¼‰å¯ä»¥è½»æ¾çš„å®ç° &lt;code&gt;Pod&lt;/code&gt; é—´ç½‘ç»œçš„äº’é€šã€‚å½“æˆ‘ä»¬æŠŠåŸºäº &lt;code&gt;Spring Cloud&lt;/code&gt; çš„å¾®æœåŠ¡è¿ç§»åˆ° &lt;code&gt;K8S&lt;/code&gt; ä¸­åï¼Œæ— é¡»ä»»ä½•æ”¹åŠ¨ï¼Œå¾®æœåŠ¡ &lt;code&gt;Pod&lt;/code&gt; å¯ä»¥é€šè¿‡ &lt;code&gt;Eureka&lt;/code&gt; æ³¨å†Œåå¯ä»¥äº’ç›¸è½»æ¾è®¿é—®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code&gt;Ingress&lt;/code&gt; + &lt;code&gt;Ingress Controller&lt;/code&gt; ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼ŒæŠŠåŸºäº HTTP 80 ç«¯å£ã€HTTPS 443 ç«¯å£çš„ç”¨æˆ·è¯·æ±‚æµé‡å¼•å…¥åˆ°é›†ç¾¤æœåŠ¡ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å‡ºç°äº†ä»¥ä¸‹éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠå…¬å®¤ç½‘ç»œ å’Œ &lt;code&gt;K8s Pod&lt;/code&gt; ç½‘ç»œä¸é€šã€‚å¼€å‘åœ¨ç”µè„‘å®ŒæˆæŸä¸ªå¾®æœåŠ¡æ¨¡å—å¼€å‘åï¼Œå¸Œæœ›æœ¬åœ°å¯åŠ¨åï¼Œèƒ½æ³¨å†Œåˆ° &lt;code&gt;K8S&lt;/code&gt; ä¸­å¼€å‘ç¯å¢ƒçš„æœåŠ¡ä¸­å¿ƒè¿›è¡Œè°ƒè¯•ï¼Œè€Œä¸æ˜¯æœ¬åœ°èµ·ä¸€å †ä¾èµ–çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;åŠå…¬å®¤ç½‘ç»œ å’Œ &lt;code&gt;K8s Svc&lt;/code&gt; ç½‘ç»œä¸é€šã€‚åœ¨ &lt;code&gt;K8S&lt;/code&gt; ä¸­è¿è¡Œçš„ &lt;code&gt;Mysql&lt;/code&gt;ã€&lt;code&gt;Redis&lt;/code&gt; ç­‰ï¼Œæ— æ³•é€šè¿‡ &lt;code&gt;Ingress&lt;/code&gt; 7 å±‚æš´éœ²ï¼Œå¼€å‘ç”µè„‘æ— æ³•é€šè¿‡å®¢æˆ·ç«¯å·¥å…·ç›´æ¥è®¿é—®ï¼›å¦‚æœæˆ‘ä»¬é€šè¿‡ &lt;code&gt;Service&lt;/code&gt; çš„ &lt;code&gt;NodePort&lt;/code&gt; æ¨¡å¼ï¼Œä¼šå¯¼è‡´ç»´æŠ¤é‡å·¥ä½œé‡å·¨å¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;ç½‘ç»œäº’é€šé…ç½®&quot;&gt;ç½‘ç»œäº’é€šé…ç½®&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;K8S&lt;/code&gt; é›†ç¾¤ä¸­æ–°åŠ ä¸€å°é…ç½®ä¸é«˜ï¼ˆ2 æ ¸ 4Gï¼‰çš„ &lt;code&gt;Node&lt;/code&gt; èŠ‚ç‚¹ï¼ˆnode-30ï¼‰ä¸“é—¨åšè·¯ç”±è½¬å‘ï¼Œè¿æ¥åŠå…¬å®¤ç½‘ç»œå’Œ &lt;code&gt;K8S&lt;/code&gt; é›†ç¾¤ &lt;code&gt;Pod&lt;/code&gt;ã€&lt;code&gt;Svc&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;node-30 IP åœ°å€ 10.60.20.30&lt;/li&gt;
&lt;li&gt;å†…ç½‘ DNS IP åœ°å€ 10.60.20.1&lt;/li&gt;
&lt;li&gt;Pod ç½‘æ®µ 10.244.0.0/24ï¼ŒSvc ç½‘æ®µ 10.96.0.0/12&lt;/li&gt;
&lt;li&gt;åŠå…¬ ç½‘æ®µ 192.168.0.0/22&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»™ node-30 èŠ‚ç‚¹æ‰“ä¸Šæ±¡ç‚¹æ ‡ç­¾ï¼ˆTaintsï¼‰ï¼Œä¸è®© &lt;code&gt;K8S&lt;/code&gt; è°ƒåº¦ &lt;code&gt;Pod&lt;/code&gt; æ¥å ç”¨èµ„æºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ kubectl taint nodes node-30 forward&amp;#x3D;node-30:NoSchedule&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨ Katacoda å…è´¹åŒæ­¥ Docker é•œåƒåˆ° Docker Hub</title>
    <link href="https://www.hi-linux.com/posts/30618.html"/>
    <id>https://www.hi-linux.com/posts/30618.html</id>
    <published>2020-05-24T01:19:00.000Z</published>
    <updated>2020-05-24T09:07:13.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2 id="ä¸ºä»€ä¹ˆè¦åŒæ­¥">ä¸ºä»€ä¹ˆè¦åŒæ­¥</h2><p>å®‰è£… kubernetes çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° <code>gcr.io/google_containers</code> ä¸‹é¢çš„ä¸€äº›é•œåƒï¼Œåœ¨å›½å†…æ˜¯ä¸èƒ½ç›´æ¥ä¸‹è½½çš„ã€‚å¦‚æœç”¨ Self Host æ–¹å¼å®‰è£…ï¼ŒMaster ä¸Šçš„ç»„ä»¶é™¤å¼€ Kubelet ä¹‹å¤–éƒ½ç”¨å®¹å™¨è¿è¡Œï¼Œç”šè‡³ CNI æ’ä»¶ä¹Ÿæ˜¯å®¹å™¨è¿è¡Œã€‚æ¯”å¦‚ Flannelï¼Œåœ¨ <code>quay.io/coreos</code> ä¸‹é¢ï¼Œåœ¨å›½å†…ä¸‹è½½éå¸¸æ…¢ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›é•œåƒåŒæ­¥åˆ°æˆ‘ä»¬çš„ Docker Hub ä»“åº“é‡Œï¼Œå†é…ä¸ª Docker Hub åŠ é€Ÿå™¨ï¼Œè¿™æ ·ä¸‹è½½é•œåƒå°±å¾ˆå¿«äº†ã€‚</p><h2 id="åŸç†">åŸç†</h2><p>Katacoda æ˜¯ä¸€ä¸ªåœ¨çº¿å­¦ä¹ å¹³å°ï¼Œåœ¨ Web ä¸Šæä¾›å­¦ä¹ éœ€è¦çš„æœåŠ¡å™¨ç»ˆç«¯ï¼Œé‡Œé¢åŒ…å«å­¦ä¹ æ‰€éœ€çš„ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>Docker</code> è¯¾ç¨‹çš„ç»ˆç«¯æ¥åŒæ­¥ï¼Œå› ä¸ºé‡Œé¢æœ‰ <code>Docker</code> ç¯å¢ƒï¼Œå¯ä»¥æ‰§è¡Œ docker loginã€docker pullã€docker tagã€docker push ç­‰å‘½ä»¤æ¥å®ç°åŒæ­¥é•œåƒã€‚</p><p>ä½†æ˜¯æ‰‹å·¥å»æ‰§è¡Œå‘½ä»¤å¾ˆéº»çƒ¦ï¼Œå¦‚æœè¦åŒæ­¥çš„é•œåƒå’Œ Tag æ¯”è¾ƒå¤šï¼Œæ‰‹å·¥æ“ä½œé‚£å°±æ˜¯æµªè´¹ç”Ÿå‘½ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¨‹åºä»£æ›¿æ‰‹å·¥æ“ä½œï¼Œä¸è¿‡ Katacoda ä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸å…è®¸æ‰§è¡Œå¤–æ¥çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œä½†æ˜¯å¯ä»¥ Shell è„šæœ¬ï¼Œæˆ‘å†™å¥½äº†è„šæœ¬ï¼Œå¤§å®¶åªéœ€è¦ç²˜è´´è¿›å»æ ¹æ®è‡ªå·±éœ€è¦ç¨ç¨ä¿®æ”¹ä¸‹ï¼Œç„¶åè¿è¡Œå°±å¯ä»¥äº†ã€‚</p><a id="more"></a><h2 id="lets-do-it">Letâ€™s Do It</h2><p>ç‚¹å‡» <a href="https://www.katacoda.com/courses/docker/deploying-first-container" target="_blank" rel="noopener" title="Docker è¯¾ç¨‹">è¿™é‡Œ</a> è¿›å…¥ Docker è¯¾ç¨‹ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1520565820/blog/k8s/katacoda-docker.png" alt=""></p><p>ç‚¹å‡» <code>START SCENARIO</code> æˆ– ç»ˆç«¯å³ä¸Šè§’å…¨å±æŒ‰é’®å°†ç»ˆç«¯æ”¾å¤§ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1520565820/blog/k8s/katacoda-terminal.png" alt=""></p><p>å®‰è£…è„šæœ¬ä¾èµ–çš„ <code>jq</code> å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt install jq</span><br></pre></td></tr></table></figure><p>ç™»å½• Docker Hub</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker login</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè„šæœ¬å¹¶èµ‹äºˆæ‰§è¡Œæƒé™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ touch sync</span><br><span class="line">$ chmod +x sync</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/imroc/image/upload/v1520565825/blog/k8s/katacoda-terminal2.png" alt=""></p><p>ç¼–è¾‘è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„ vim ç¼–è¾‘å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim sync</span><br></pre></td></tr></table></figure><p>å°†è„šæœ¬ç²˜è´´è¿›å»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">docker_repo&#x3D;&quot;k8smirror&quot; # your docker hub username or organization name</span><br><span class="line">registry&#x3D;&quot;gcr.io&quot; # the registry of original image, e.g. gcr.io, quay.io</span><br><span class="line">repo&#x3D;&quot;google_containers&quot; # the repository name of original image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sync_one()&#123;</span><br><span class="line">  docker pull $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;$&#123;1&#125;:$&#123;2&#125;</span><br><span class="line">  docker tag $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;$&#123;1&#125;:$&#123;2&#125; docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;$&#123;1&#125;:$&#123;2&#125;</span><br><span class="line">  docker push docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;$&#123;1&#125;:$&#123;2&#125;</span><br><span class="line">  docker rmi -f $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;$&#123;1&#125;:$&#123;2&#125; docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;$&#123;1&#125;:$&#123;2&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sync_all_tags() &#123;</span><br><span class="line">  for image in $*; do</span><br><span class="line">    tags_str&#x3D;&#96;curl https:&#x2F;&#x2F;$&#123;registry&#125;&#x2F;v2&#x2F;$&#123;repo&#125;&#x2F;$image&#x2F;tags&#x2F;list | jq &#39;.tags&#39; -c | sed &#39;s&#x2F;\[&#x2F;\(&#x2F;g&#39; | sed &#39;s&#x2F;\]&#x2F;\)&#x2F;g&#39; | sed &#39;s&#x2F;,&#x2F; &#x2F;g&#39;&#96;</span><br><span class="line">    echo &quot;$image $tags_str&quot;</span><br><span class="line">    src&#x3D;&quot;</span><br><span class="line">sync_one()&#123;</span><br><span class="line">  docker pull $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125;</span><br><span class="line">  docker tag $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125; docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125;</span><br><span class="line">  docker push docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125;</span><br><span class="line">  docker rmi -f $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125; docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125;</span><br><span class="line">&#125;</span><br><span class="line">tags&#x3D;$&#123;tags_str&#125;</span><br><span class="line">echo \&quot;$image $&#123;tags_str&#125;\&quot;</span><br><span class="line">for tag in \$&#123;tags[@]&#125;</span><br><span class="line">do</span><br><span class="line">  sync_one $image \$&#123;tag&#125;</span><br><span class="line">done;&quot;</span><br><span class="line">    bash -c &quot;$src&quot;</span><br><span class="line">  done </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sync_with_tags()&#123;</span><br><span class="line">  image&#x3D;$1</span><br><span class="line">  skip&#x3D;1</span><br><span class="line">  for tag in $*; do</span><br><span class="line">    if [ $skip -eq 1 ]; then</span><br><span class="line">  skip&#x3D;0</span><br><span class="line">    else</span><br><span class="line">      sync_one $image $tag</span><br><span class="line">fi</span><br><span class="line">  done </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sync_after_tag()&#123;</span><br><span class="line">  image&#x3D;$1</span><br><span class="line">  start_tag&#x3D;$2</span><br><span class="line">  tags_str&#x3D;&#96;curl https:&#x2F;&#x2F;$&#123;registry&#125;&#x2F;v2&#x2F;$&#123;repo&#125;&#x2F;$image&#x2F;tags&#x2F;list | jq &#39;.tags&#39; -c | sed &#39;s&#x2F;\[&#x2F;\(&#x2F;g&#39; | sed &#39;s&#x2F;\]&#x2F;\)&#x2F;g&#39; | sed &#39;s&#x2F;,&#x2F; &#x2F;g&#39;&#96;</span><br><span class="line">  echo &quot;$image $tags_str&quot;</span><br><span class="line">  src&#x3D;&quot;</span><br><span class="line">sync_one()&#123;</span><br><span class="line">  docker pull $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125;</span><br><span class="line">  docker tag $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125; docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125;</span><br><span class="line">  docker push docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125;</span><br><span class="line">  docker rmi -f $&#123;registry&#125;&#x2F;$&#123;repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125; docker.io&#x2F;$&#123;docker_repo&#125;&#x2F;\$&#123;1&#125;:\$&#123;2&#125;</span><br><span class="line">&#125;</span><br><span class="line">tags&#x3D;$&#123;tags_str&#125;</span><br><span class="line">start&#x3D;0</span><br><span class="line">for tag in \$&#123;tags[@]&#125;; do</span><br><span class="line">  if [ \$start -eq 1 ]; then</span><br><span class="line">    sync_one $image \$tag</span><br><span class="line">  elif [ \$tag &#x3D;&#x3D; &#39;$start_tag&#39; ]; then</span><br><span class="line">    start&#x3D;1</span><br><span class="line">  fi</span><br><span class="line">done&quot;</span><br><span class="line">  bash -c &quot;$src&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">get_tags()&#123;</span><br><span class="line">  image&#x3D;$1</span><br><span class="line">  curl https:&#x2F;&#x2F;$&#123;registry&#125;&#x2F;v2&#x2F;$&#123;repo&#125;&#x2F;$image&#x2F;tags&#x2F;list | jq &#39;.tags&#39; -c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sync_with_tags etcd 2.0.12 2.0.13 # sync etcd:2.0.12 and etcd:2.0.13</span><br><span class="line">#sync_after_tag etcd 2.0.8 # sync tag after etcd:2.0.8</span><br><span class="line">#sync_all_tags etcd hyperkube # sync all tags of etcd and hyperkube</span><br></pre></td></tr></table></figure><p>è„šæœ¬ä¸­æœ‰ä¸€äº›å‚æ•°éœ€è¦æ ¹æ®ä½ è‡ªå·±æƒ…å†µä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨å®ƒè‡ªå¸¦çš„ <code>vim</code> åœ¨çº¿ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥åœ¨ä½ æœ¬åœ°æ”¹å¥½åœ¨ç²˜è´´ä¸Šå»ã€‚</p><ul><li><code>docker_repo</code> æ”¹ä¸ºä½ çš„ Docker Hub è´¦å·ç»„ç»‡å</li><li><code>registry</code> æ”¹ä¸ºè¢«åŒæ­¥é•œåƒæ‰€åœ¨ä»“åº“çš„åŸŸå</li><li><code>repo</code> æ”¹ä¸ºè¢«åŒæ­¥é•œåƒæ‰€åœ¨ä»“åº“çš„è´¦å·æˆ–ç»„ç»‡å</li></ul><p>åœ¨è„šæœ¬æœ€åï¼Œå¯ä»¥è°ƒç”¨å†™å¥½çš„å‡½æ•°æ¥å®ç°é•œåƒåŒæ­¥ï¼Œä¸¾ä¾‹ï¼š</p><ul><li>åŒæ­¥ä¸€ä¸ªé•œåƒä¸­æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ª tag</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sync_with_tags etcd 2.0.12 2.0.13</span><br></pre></td></tr></table></figure><ul><li>ä»æŸä¸ª Tag åé¢çš„ Tag å¼€å§‹ä¸€ç›´åŒæ­¥åˆ°æœ€åï¼ˆTag é¡ºåºæŒ‰ç…§å­—æ¯æ•°å­—æ¥çš„ï¼Œä¸æ˜¯ä¸Šä¼ æ—¥æœŸï¼›Katacoda ç»ˆç«¯ç”¨ä¹…äº†ä¼šæ–­è¿ï¼Œå¯èƒ½å¤„äºå®‰å…¨åŸå› è€ƒè™‘ï¼Œæ–­å¼€ä¹‹åå¯ä»¥çœ‹ Tag åŒæ­¥åˆ°å“ªä¸€ä¸ªäº†ï¼Œç„¶åæ‰§è¡Œç±»ä¼¼ä¸‹é¢çš„å‘½ä»¤ä»æ–­è¿çš„ Tag å¼€å§‹åŒæ­¥ï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sync_after_tag etcd 2.0.8</span><br></pre></td></tr></table></figure><p>åŒæ­¥ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒçš„æ‰€æœ‰ Tag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sync_all_tags etcd hyperkube</span><br></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œè„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;sync</span><br></pre></td></tr></table></figure><p>è¿™å°±å¼€å§‹åŒæ­¥äº†ï¼ŒKatacoda æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œä¸‹è½½ <a href="http://gcr.io" target="_blank" rel="noopener">gcr.io</a> æˆ– <a href="http://quay.io" target="_blank" rel="noopener">quay.io</a> ä¸Šé‚£äº›é•œåƒéƒ½å¾ˆå¿«ï¼Œä¸Šä¼  Docker Hub ä¹Ÿå¾ˆå¿«ã€‚å¦‚æœæ–­è¿äº†ï¼Œå¯ä»¥åœ¨ Docker Hub ä¸ŠæŸ¥æœ€æ–°ä¸Šä¼ çš„ Tag æ˜¯å“ªä¸ªï¼ˆå¦‚ï¼š<a href="https://hub.docker.com/r/k8smirror/hyperkube/tags/" target="_blank" rel="noopener">https://hub.docker.com/r/k8smirror/hyperkube/tags/</a> æŠŠ k8smirror æ”¹ä¸ºä½ çš„ Docker ç”¨æˆ·åæˆ–ç»„ç»‡åï¼Œhyperkube æ”¹ä¸ºé•œåƒåï¼‰ï¼Œç„¶åæ”¹è„šæœ¬ï¼Œç”¨ sync_after_tag è¿™ä¸ªå‡½æ•°ç»§ç»­ä¸Šä¼ ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€ŒIâ€™m roc Blogã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/AiW3Jpot%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">http://t.cn/AiW3Jpotï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <code>editor@hi-linux.com</code> ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸ºä»€ä¹ˆè¦åŒæ­¥&quot;&gt;ä¸ºä»€ä¹ˆè¦åŒæ­¥&lt;/h2&gt;
&lt;p&gt;å®‰è£… kubernetes çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° &lt;code&gt;gcr.io/google_containers&lt;/code&gt; ä¸‹é¢çš„ä¸€äº›é•œåƒï¼Œåœ¨å›½å†…æ˜¯ä¸èƒ½ç›´æ¥ä¸‹è½½çš„ã€‚å¦‚æœç”¨ Self Host æ–¹å¼å®‰è£…ï¼ŒMaster ä¸Šçš„ç»„ä»¶é™¤å¼€ Kubelet ä¹‹å¤–éƒ½ç”¨å®¹å™¨è¿è¡Œï¼Œç”šè‡³ CNI æ’ä»¶ä¹Ÿæ˜¯å®¹å™¨è¿è¡Œã€‚æ¯”å¦‚ Flannelï¼Œåœ¨ &lt;code&gt;quay.io/coreos&lt;/code&gt; ä¸‹é¢ï¼Œåœ¨å›½å†…ä¸‹è½½éå¸¸æ…¢ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›é•œåƒåŒæ­¥åˆ°æˆ‘ä»¬çš„ Docker Hub ä»“åº“é‡Œï¼Œå†é…ä¸ª Docker Hub åŠ é€Ÿå™¨ï¼Œè¿™æ ·ä¸‹è½½é•œåƒå°±å¾ˆå¿«äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŸç†&quot;&gt;åŸç†&lt;/h2&gt;
&lt;p&gt;Katacoda æ˜¯ä¸€ä¸ªåœ¨çº¿å­¦ä¹ å¹³å°ï¼Œåœ¨ Web ä¸Šæä¾›å­¦ä¹ éœ€è¦çš„æœåŠ¡å™¨ç»ˆç«¯ï¼Œé‡Œé¢åŒ…å«å­¦ä¹ æ‰€éœ€çš„ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ &lt;code&gt;Docker&lt;/code&gt; è¯¾ç¨‹çš„ç»ˆç«¯æ¥åŒæ­¥ï¼Œå› ä¸ºé‡Œé¢æœ‰ &lt;code&gt;Docker&lt;/code&gt; ç¯å¢ƒï¼Œå¯ä»¥æ‰§è¡Œ docker loginã€docker pullã€docker tagã€docker push ç­‰å‘½ä»¤æ¥å®ç°åŒæ­¥é•œåƒã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ‰‹å·¥å»æ‰§è¡Œå‘½ä»¤å¾ˆéº»çƒ¦ï¼Œå¦‚æœè¦åŒæ­¥çš„é•œåƒå’Œ Tag æ¯”è¾ƒå¤šï¼Œæ‰‹å·¥æ“ä½œé‚£å°±æ˜¯æµªè´¹ç”Ÿå‘½ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¨‹åºä»£æ›¿æ‰‹å·¥æ“ä½œï¼Œä¸è¿‡ Katacoda ä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸å…è®¸æ‰§è¡Œå¤–æ¥çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œä½†æ˜¯å¯ä»¥ Shell è„šæœ¬ï¼Œæˆ‘å†™å¥½äº†è„šæœ¬ï¼Œå¤§å®¶åªéœ€è¦ç²˜è´´è¿›å»æ ¹æ®è‡ªå·±éœ€è¦ç¨ç¨ä¿®æ”¹ä¸‹ï¼Œç„¶åè¿è¡Œå°±å¯ä»¥äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://www.hi-linux.com/categories/docker/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨ Gitlab å’Œ Jenkins æ„å»ºæŒç»­é›†æˆç¯å¢ƒ</title>
    <link href="https://www.hi-linux.com/posts/55356.html"/>
    <id>https://www.hi-linux.com/posts/55356.html</id>
    <published>2020-05-24T01:18:00.000Z</published>
    <updated>2020-05-24T09:07:13.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>æœ€è¿‘ç”¨åˆ°æŒç»­é›†æˆé¡ºä¾¿æ€»ç»“åœ¨è¿™é‡Œï¼Œéƒ½æ˜¯ç”¨çš„æœ€æ–°ç‰ˆã€‚æ­å»ºè¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€ä¸ª Demoï¼Œæäº¤ä»£ç åˆ° Gitlab è‡ªåŠ¨è§¦å‘ Jenkins ä»»åŠ¡ï¼Œè‡ªåŠ¨ç¼–è¯‘ä»£ç å’Œ Docker é•œåƒå¹¶ä¸Šä¼ ã€‚</p><h2 id="å®‰è£…è¿è¡Œ-gitlab">å®‰è£…è¿è¡Œ Gitlab</h2><p>Gitlab å›½å†…å®‰è£…å¾ˆéº»çƒ¦ï¼Œç”¨å®˜æ–¹çš„æºè£…ä¸äº†ï¼Œå› ä¸ºåœ¨å›½å¤–ï¼Œå¤ªæ…¢ï¼Œé“¾æ¥ä¼šæ–­æ‰ã€‚å›½å†…æ¸…åæœ‰ Gitlab çš„ Apt å’Œ Yum æºï¼Œä½†æ˜¯æˆ‘è¯•è¿‡å®‰è£… CentOS 7 çš„ Gitlab ï¼Œåˆ°æœ€åéƒ½ä¼šä¸€ç›´å¡ä½ç»“æŸä¸äº†ã€‚ç›´æ¥ä¸‹è½½æ¸…å Gitlab çš„ Rpm Mirror å®‰è£…ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯é€‰æ‹©ç”¨ Docker å¯åŠ¨ Gitlabï¼ˆæå‰é…å¥½ Docker Hub åŠ é€Ÿå™¨ï¼‰</p><ul><li>å‡†å¤‡é•œåƒ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull gitlab&#x2F;gitlab-ee:latest</span><br></pre></td></tr></table></figure><ul><li>å‡†å¤‡ Gitlab æ‰€éœ€ç›®å½•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir gitlab</span><br><span class="line">$ cd gitlab</span><br><span class="line">$ mkdir config logs data</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li>å‡†å¤‡å¯åŠ¨è„šæœ¬</li></ul><p>æ›¿æ¢æƒ³è¦çš„å¯åŠ¨çš„ç«¯å£ï¼ŒIP åœ°å€æ›¿æ¢ä¸ºè®¿é—®ä½ çš„ Gitlab çš„åœ°å€ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢æƒ³è¦çš„æŒ‚è½½ç›®å½•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ vi run</span><br><span class="line">#! &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">sudo docker run -d --rm \</span><br><span class="line">    -p 8088:8088 \</span><br><span class="line">    --name gitlab \</span><br><span class="line">    --env GITLAB_OMNIBUS_CONFIG&#x3D;&quot;external_url &#39;http:&#x2F;&#x2F;118.24.64.246:8088&#x2F;&#39;; gitlab_rails[&#39;lfs_enabled&#39;] &#x3D; true;&quot; \</span><br><span class="line">    -v $PWD&#x2F;config:&#x2F;etc&#x2F;gitlab \</span><br><span class="line">    -v $PWD&#x2F;logs:&#x2F;var&#x2F;log&#x2F;gitlab \</span><br><span class="line">    -v $PWD&#x2F;data:&#x2F;var&#x2F;opt&#x2F;gitlab \</span><br><span class="line">    gitlab&#x2F;gitlab-ee:latest</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><ul><li>èµ‹äºˆæ‰§è¡Œæƒé™</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x run</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ Gitlab</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;run</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ Gitlab æ§åˆ¶å°è¾“å‡º</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs -f gitlab</span><br></pre></td></tr></table></figure><p>è®¿é—® Gitlabï¼Œæ‰“å¼€è„šæœ¬ä¸­é…ç½®çš„ external_url åœ°å€ï¼Œè®¾ç½®ç®¡ç†å‘˜å¯†ç å’Œæ³¨å†Œ Gitlab è´¦å·ï¼Œç™»å½•å¹¶æ·»åŠ è‡ªå·±çš„ SSH key ã€‚åˆ›å»º Repo ï¼Œgit clone åˆ°æœ¬åœ°ï¼Œåé¢æˆ‘ä»¬æäº¤ä»£ç åˆ°è¿™ä¸ª Repo ï¼Œè§¦å‘ Jenkins çš„æŒç»­é›†æˆã€‚</p><h2 id="å®‰è£…è¿è¡Œ-jenkins">å®‰è£…è¿è¡Œ Jenkins</h2><p>Jenkins å»ºè®®ç›´æ¥å®‰è£…åœ¨å®¿ä¸»æœºï¼Œä¸ç”¨ Docker æ–¹å¼ï¼Œå› ä¸ºæŒç»­é›†æˆéœ€è¦å®‰è£…å„ç§æˆ‘ä»¬ç”¨åˆ°çš„å·¥å…·ï¼Œè¿™äº›å·¥å…·å¯èƒ½åé¢æ ¹æ®éœ€è¦æ‰å®‰è£…ï¼Œé‡å¯ä¸èƒ½è®©è¿™äº›å·¥å…·ä¸¢å¤±ã€‚æ¯”å¦‚ç¼–è¯‘ Java æºç éœ€è¦è£… JDK ç¯å¢ƒï¼Œç¼–è¯‘å’Œä¸Šä¼  Docker é•œåƒéœ€è¦å®‰è£… Docker ç¯å¢ƒï¼Œå¹¶ä¸”è¿˜éœ€è¦æå‰ docker login å¥½ï¼Œä¸ç„¶ä¸Šä¼ ä¸äº†ã€‚</p><p>å› ä¸º Jenkins ç”¨ JAVA å†™çš„ï¼Œæ‰€ä»¥ç¡®ä¿æœºå™¨ä¸Šè£…æœ‰ JDK æˆ– OpenJDK ç¯å¢ƒï¼Œå‡†å¤‡ä¸€ä¸ª Jenkins ç”¨çš„ç›®å½•ï¼Œä¸‹è½½ War åŒ…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir jenkins </span><br><span class="line">$ wget http:&#x2F;&#x2F;mirrors.jenkins.io&#x2F;war-stable&#x2F;latest&#x2F;jenkins.war</span><br></pre></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nohup java -jar jenkins.war --httpPort&#x3D;8080 &amp;&gt; jenkins.log &amp;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ jenkins è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tail -f jenkins.log</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡æ‰“å¼€ Jenkins Web ç•Œé¢ï¼Œè¦æ±‚è¾“å‡ºç®¡ç†å‘˜åˆå§‹å¯†ç ï¼Œç”Ÿæˆåœ¨æœåŠ¡å™¨ä¸Šï¼Œç•Œé¢ä¸Šæç¤ºæœ‰è·¯å¾„ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523432610/blog/ci/jenkins-initial.png" alt=""></p><p>æŸ¥çœ‹å¯†ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;root&#x2F;.jenkins&#x2F;secrets&#x2F;initialAdminPassword</span><br></pre></td></tr></table></figure><p>ç²˜è´´å¯†ç å¹¶ç»§ç»­ï¼Œå®‰è£…æ¨èçš„æ’ä»¶ï¼Œç­‰å¾…å®‰è£…å®Œæˆ</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523433013/blog/ci/xsrm.png" alt=""></p><p>åˆ›å»ºç®¡ç†å‘˜ï¼Œä¿å­˜å¹¶å®Œæˆã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523440941/blog/ci/create-admin.png" alt=""></p><p>è‡³æ­¤ï¼Œjenkins å®‰è£…å®Œæˆ</p><h2 id="jenkins-å®‰è£…éœ€è¦çš„æ’ä»¶">Jenkins å®‰è£…éœ€è¦çš„æ’ä»¶</h2><p>æ‰“å¼€ Jenkins-ç³»ç»Ÿè®¾ç½®-ç®¡ç†æ’ä»¶ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523440424/blog/ci/manage-plugin.png" alt=""></p><p>åœ¨å¯é€‰æ’ä»¶é‡Œé€‰æ‹©å¹¶å®‰è£…éœ€è¦çš„æ’ä»¶ï¼šGit ã€ GitLab ã€Build Authentication Token Root ï¼ˆGit æ’ä»¶åœ¨é»˜è®¤æ¨èæ’ä»¶é‡Œå·²å®‰è£…ï¼Œåœ¨å¯é€‰æ’ä»¶åˆ—è¡¨é‡Œå¯èƒ½æ²¡æœ‰ï¼‰ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523443519/blog/ci/install-plugin.png" alt=""></p><p>ç‚¹å‡» â€œç›´æ¥å®‰è£…â€ï¼Œå‹¾é€‰ â€œå®‰è£…å®Œæˆåé‡å¯ Jenkins (ç©ºé—²æ—¶)â€œï¼Œç­‰å¾…å®‰è£…å®Œæˆè‡ªåŠ¨é‡å¯ Jenkinsã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523443587/blog/ci/jenkins-plugin-install-and-restrart.png" alt=""></p><p>ç”±äºåé¢ Jenkins çš„æœºå™¨ä¸Šéœ€è¦ç”¨åˆ° Dockerï¼Œæ‰€ä»¥ä¿è¯ Jenkins æ‰€åœ¨æœºå™¨å®‰è£…å¥½ Docker å¹¶é…å¥½ Docker Hub çš„åŠ é€Ÿå™¨ï¼Œå¹¶ä¸” docker login ç™»å½•é•œåƒè¦ä¸Šä¼ çš„ä»“åº“ã€‚</p><h2 id="gitlab-åˆ›å»º-repo">Gitlab åˆ›å»º Repo</h2><p>æˆ‘ä»¬è¿™é‡Œå°±ä»¥ä¸€ä¸ªç®€å•çš„ Golang ç¨‹åºåšå®ä¾‹ï¼Œå®ç°æäº¤ä»£ç è‡ªåŠ¨ç¼–è¯‘ä»£ç ï¼Œç„¶å Docker ç¼–è¯‘é•œåƒå¹¶ä¸Šä¼ è‡³ CCR ï¼ˆè…¾è®¯äº‘çš„ Docker é•œåƒä»“åº“)ã€‚</p><p>åœ¨ Gitlab ä¸Šåˆ›å»ºç©º Repoï¼ŒClone åˆ°æœ¬åœ°ï¼Œæ·»åŠ ä¸‰ä¸ªæ–‡ä»¶ã€‚</p><ul><li>main.go ï¼ˆæºç ï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">println(&quot;hello world&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Dockerfile ï¼ˆç¼–è¯‘é•œåƒç”¨çš„ Dockerfileï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest</span><br><span class="line"></span><br><span class="line">MAINTAINER roc&lt;rockerchen@tencent.com&gt;</span><br><span class="line"></span><br><span class="line">COPY bd-ci-test &#x2F;bin&#x2F;bd-ci-test</span><br><span class="line"></span><br><span class="line">CMD [&quot;bd-ci-test&quot;]</span><br></pre></td></tr></table></figure><ul><li>build ï¼ˆç¼–è¯‘æºç ã€é•œåƒå’Œä¸Šä¼ é•œåƒçš„è„šæœ¬ï¼Œæ›¿æ¢ IMAGE åœ°å€ä¸ºè¦ä¸Šä¼ çš„åœ°å€ï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"># ç¼–è¯‘ä»£ç </span><br><span class="line">docker run --rm \</span><br><span class="line">  -v $PWD:&#x2F;go&#x2F;src&#x2F;bd-ci-test \</span><br><span class="line">  -w &#x2F;go&#x2F;src&#x2F;bd-ci-test \</span><br><span class="line">  golang:alpine go build</span><br><span class="line"></span><br><span class="line">IMAGE&#x3D;&quot;imroc&#x2F;bd-ci-test:latest&quot;</span><br><span class="line"></span><br><span class="line"># ç¼–è¯‘é•œåƒ</span><br><span class="line">docker build -t $IMAGE .</span><br><span class="line"></span><br><span class="line"># ä¸Šä¼ é•œåƒ (è¯·æå‰ç™»å½•å¥½,docker login åªéœ€ç™»å½•ä¸€æ¬¡)</span><br><span class="line">docker push $IMAGE</span><br><span class="line"></span><br><span class="line"># æ¸…ç†</span><br><span class="line">docker rmi $IMAGE</span><br><span class="line">rm bd-ci-test</span><br></pre></td></tr></table></figure><ul><li>ç»™ build è„šæœ¬æ‰§è¡Œæƒé™</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x build</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ä»£ç å‡†å¤‡å¥½äº†ï¼Œå…ˆä¸å¿™æäº¤ï¼Œæ¥ä¸‹æ¥é…ç½® Jenkins æ¥åšæŒç»­é›†æˆã€‚</p><h2 id="é…ç½®-jenkins">é…ç½® Jenkins</h2><p>æ–°å»º Jenkins é¡¹ç›®ï¼Œé€‰æ‹© â€œæ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®â€ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523444143/blog/ci/jenkins-new-project.png" alt=""></p><p>æºä»£ç ç®¡ç†é€‰ Gitï¼ŒRepository URL å¡«å†™ä½  Gitlab ä¸Šæºç  Repo çš„åœ°å€ï¼ŒCredentials æ˜¯æ‹‰å–ä»£ç æ—¶éœ€è¦ç”¨åˆ°çš„èº«ä»½è®¤è¯ï¼ˆå¦‚æœä½ çš„Repo ä¸æ˜¯å…¬æœ‰çš„ï¼Œæ²¡æœ‰èº«ä»½è®¤è¯å°±ä¼šæŠ¥é”™ï¼‰ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523451253/blog/ci/jenkins-git.png" alt=""></p><p>ç‚¹å‡» Add æ·»åŠ ä¸€ä¸ªï¼Œ Kind é€‰æ‹© â€œUsername with passwordâ€ï¼Œè¾“å…¥ Gitlab è´¦å·å¯†ç ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523451426/blog/ci/jenkins-credentials.png" alt=""></p><p>ç„¶å Credentials é€‰æ‹©æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„ï¼ˆæ£€æµ‹åˆ°è´¦å·å¯†ç æ­£ç¡®å°±ä¸ä¼šæŠ¥é”™äº†ï¼‰ï¼Œæˆ‘ä»¬å‡†å¤‡å¯¹ master åˆ†æ”¯çš„ä»£ç åšæŒç»­é›†æˆï¼Œæ‰€ä»¥ â€œBranches to buildâ€ å¡« â€œ*/masterâ€ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523451601/blog/ci/jenkins-git-after.png" alt=""></p><p>æ„å»ºè§¦å‘å™¨é€‰æ‹© â€œBuild when a change is pushed to GitLabâ€ ï¼ˆåé¢çš„ URL æ˜¯æˆ‘ä»¬éœ€è¦åœ¨ Gitlab ä¸Šé…çš„ Webhook åœ°å€ï¼‰ï¼ŒæŒ‰ç…§ä¸‹é¢å‹¾é€‰ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523452134/blog/ci/jenkins-construct-trigger.png" alt=""></p><p>ç‚¹å¼€é«˜çº§ï¼Œâ€œAllowd branchesâ€ å‹¾é€‰ â€œFilter branches by regexâ€ï¼Œå¡«å†™ â€œmasterâ€ã€‚ç‚¹ â€œGenerateâ€ ç”Ÿæˆ Tokenï¼Œè¿™ä¸ª Token ç”¨äºå¡«å†™åˆ° Gitlab çš„ Webhook é‡Œï¼ŒGitlab æ£€æµ‹åˆ°ä»£ç æäº¤ï¼Œä¼šé€šçŸ¥ Webhook é‡Œå¡«å†™çš„ Jenkins ç”Ÿæˆçš„å›æ‰ URLï¼Œå¹¶å¸¦ä¸Šè¿™ä¸ª Tokenï¼Œé˜²æ­¢å…¶å®ƒäººè§¦å‘ Jenkins çš„æŒç»­é›†æˆã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523452257/blog/ci/jenkins-advanced-trigger.png" alt=""></p><blockquote><p>æ³¨: å¤åˆ¶å‡º URL å’Œ Tokenï¼Œæˆ‘ä»¬åé¢é…ç½® Gitlab çš„ Webhook ä¼šç”¨åˆ°ã€‚</p></blockquote><p>å¢åŠ æ„å»ºæ­¥éª¤ â€œexecute shellâ€ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523452676/blog/ci/jenkins-construct.png" alt=""></p><p>ç”±äºæˆ‘ä»¬æŠŠæŒç»­é›†æˆçš„æ“ä½œéƒ½å†™åˆ° build è„šæœ¬äº†ï¼Œæ‰€ä»¥ç›´æ¥å¡«å†™æ‰§è¡Œ ./build å°±å¯ä»¥äº†ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523453127/blog/ci/jenkins-build.png" alt=""></p><p>æœ€åç‚¹å‡»ä¿å­˜ï¼Œè‡³æ­¤ï¼ŒJenkins çš„æŒç»­é›†æˆé…ç½®å¥½äº†ï¼Œè¿˜éœ€è¦é…ç½® Gitlab çš„ Webhookï¼Œç”¨äºä»£ç æäº¤é€šçŸ¥ Jenkinsã€‚</p><h2 id="é…ç½®-gitlab-webhook">é…ç½® Gitlab Webhook</h2><p>æ‰“å¼€ Gitlab çš„ Repo çš„ Settings-Integrationsã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523453629/blog/ci/gitlab-webhook.png" alt=""></p><p>URL å’Œ Secret Token å¡«å†™ Jenkins é¡¹ç›®ä¸­æ„å»ºè§¦å‘å™¨éƒ¨åˆ†ç”Ÿæˆçš„ï¼Œç‚¹å‡» â€œAdd webhookâ€ï¼Œæå®šï¼</p><h2 id="æµ‹è¯•">æµ‹è¯•</h2><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æäº¤ä»£ç æµ‹è¯•ä¸€ä¸‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">$ git commit -m &quot;test&quot;</span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹ Jenkins çš„è¾“å‡ºæ¥çœ‹æ˜¯å¦è§¦å‘ä»»åŠ¡ï¼Œç”±äºæˆ‘ä½¿ç”¨äº†ä¸€äº› Docker Hub çš„é•œåƒæ¥ç¼–è¯‘ä»£ç å’Œé•œåƒï¼Œå¦‚æœæ²¡æœ‰æå‰ Pull ä¸‹æ¥ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä»»åŠ¡å¯èƒ½ä¼šæ¯”è¾ƒä¹…ï¼Œç­‰å¾…è¿è¡Œç»“æŸï¼Œåˆ·æ–° Jenkins ä¸»é¡µã€‚</p><p>å¦‚æœè¿è¡ŒæˆåŠŸï¼Œä» â€œä¸Šæ¬¡æˆåŠŸâ€ ä¸‹æ‹‰é€‰æ‹© â€œæ§åˆ¶å°è¾“å‡ºâ€</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523453513/blog/ci/jenkins-console-tab.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°è¿è¡Œä»»åŠ¡è¿‡ç¨‹çš„è¾“å‡ºã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523453516/blog/ci/jenkins-console.png" alt=""></p><p>å¦‚æœéƒ½æ²¡é—®é¢˜ï¼Œä½ å¯ä»¥çœ‹çœ‹ä½ çš„é•œåƒä»“åº“ï¼Œé•œåƒå·²ç»æˆåŠŸä¸Šä¼ ï¼Œè‡³æ­¤ï¼Œè¿™ä¸ªç®€å•çš„æŒç»­é›†æˆæ­å»ºå®Œæ¯•ã€‚</p><h2 id="é™„å½•">é™„å½•</h2><h3 id="git-submodule">Git Submodule</h3><p>å¦‚æœä½ çš„é¡¹ç›®é‡Œé¢è¿˜å¼•ç”¨äº†å…¶å®ƒé¡¹ç›®ï¼Œä¹Ÿå°±æ˜¯ Git çš„ Submodulesï¼Œæ€ä¹ˆåŠï¼Ÿç”šè‡³ Submodule é‡Œé¢è¿˜è¦æŒ‡å®šåˆ†æ”¯å‘¢ï¼Ÿ</p><p>åœ¨åˆ›å»º Jenkins é¡¹ç›®çš„æ—¶å€™ï¼Œåœ¨ æºç ç®¡ç†-Git-Additional Behaviours-Add é€‰æ‹© Advanced sub-modules behavioursã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523628768/blog/ci/jekins-advanced-sub-modules.png" alt=""></p><p>å‹¾é€‰ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹ã€‚</p><p><img src="https://res.cloudinary.com/imroc/image/upload/v1523628769/blog/ci/jenkins-additional-behaviours.png" alt=""></p><p>Submodules çš„åˆ†æ”¯é  Git æœ¬æ¥æ”¯æŒçš„ <code>.gitmodules</code> æ–‡ä»¶æ¥æ§åˆ¶ï¼Œç”¨æ³•ä¸¾ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule add -b v1 https:&#x2F;&#x2F;github.com&#x2F;imroc&#x2F;req.git ref&#x2F;req</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ <code>.gitmodules</code> æ–‡ä»¶æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat .gitmodules</span><br><span class="line">[submodule &quot;ref&#x2F;req&quot;]</span><br><span class="line">path &#x3D; ref&#x2F;req</span><br><span class="line">url &#x3D; https:&#x2F;&#x2F;github.com&#x2F;imroc&#x2F;req.git</span><br><span class="line">branch &#x3D; v1</span><br></pre></td></tr></table></figure><p>å¯ä»¥è‡ªå·±æ‰‹åŠ¨ç¼–è¾‘æˆ–ç”¨ <code>git submodule add</code> å‘½ä»¤ç”Ÿæˆã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€ŒIâ€™m roc Blogã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/AiWDsnzq%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">http://t.cn/AiWDsnzqï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <code>editor@hi-linux.com</code> ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ç”¨åˆ°æŒç»­é›†æˆé¡ºä¾¿æ€»ç»“åœ¨è¿™é‡Œï¼Œéƒ½æ˜¯ç”¨çš„æœ€æ–°ç‰ˆã€‚æ­å»ºè¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€ä¸ª Demoï¼Œæäº¤ä»£ç åˆ° Gitlab è‡ªåŠ¨è§¦å‘ Jenkins ä»»åŠ¡ï¼Œè‡ªåŠ¨ç¼–è¯‘ä»£ç å’Œ Docker é•œåƒå¹¶ä¸Šä¼ ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®‰è£…è¿è¡Œ-Gitlab&quot;&gt;å®‰è£…è¿è¡Œ Gitlab&lt;/h2&gt;
&lt;p&gt;Gitlab å›½å†…å®‰è£…å¾ˆéº»çƒ¦ï¼Œç”¨å®˜æ–¹çš„æºè£…ä¸äº†ï¼Œå› ä¸ºåœ¨å›½å¤–ï¼Œå¤ªæ…¢ï¼Œé“¾æ¥ä¼šæ–­æ‰ã€‚å›½å†…æ¸…åæœ‰ Gitlab çš„ Apt å’Œ Yum æºï¼Œä½†æ˜¯æˆ‘è¯•è¿‡å®‰è£… CentOS 7 çš„ Gitlab ï¼Œåˆ°æœ€åéƒ½ä¼šä¸€ç›´å¡ä½ç»“æŸä¸äº†ã€‚ç›´æ¥ä¸‹è½½æ¸…å Gitlab çš„ Rpm Mirror å®‰è£…ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯é€‰æ‹©ç”¨ Docker å¯åŠ¨ Gitlabï¼ˆæå‰é…å¥½ Docker Hub åŠ é€Ÿå™¨ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡†å¤‡é•œåƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ docker pull gitlab&amp;#x2F;gitlab-ee:latest&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;å‡†å¤‡ Gitlab æ‰€éœ€ç›®å½•&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ mkdir gitlab&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ cd gitlab&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ mkdir config logs data&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Gitlab" scheme="https://www.hi-linux.com/tags/Gitlab/"/>
    
  </entry>
  
  <entry>
    <title>è°ˆè°ˆæŠ€æœ¯äººçš„å‘å±•ç”Ÿå­˜ä¹‹é“</title>
    <link href="https://www.hi-linux.com/posts/1788.html"/>
    <id>https://www.hi-linux.com/posts/1788.html</id>
    <published>2020-05-24T01:17:00.000Z</published>
    <updated>2020-05-24T08:56:22.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>è¿™æ˜¯ä¸€ç¯‡ä» â€œäººâ€ (è€ŒéæŠ€æœ¯ä¹Ÿéç®¡ç†)çš„è§’åº¦ï¼Œèšç„¦äºè‡ªèº«èŒä¸šå‘å±•æ–¹æ–¹é¢é¢çš„æ–‡ç« ï¼ŒåŒ…æ‹¬èŒä¸šã€å­¦ä¹ ã€ç”Ÿäº§åŠ›ã€å½±å“åŠ›ç­‰ã€‚</p><h2 id="æ‹¥æœ‰å•†ä¸šå¿ƒæ€">æ‹¥æœ‰å•†ä¸šå¿ƒæ€</h2><p>ä½ æ‰€èƒ½çŠ¯çš„æœ€å¤§é”™è¯¯å°±æ˜¯ç›¸ä¿¡è‡ªå·±æ˜¯åœ¨ä¸ºåˆ«äººå·¥ä½œï¼ŒèŒä¸šå‘å±•çš„é©±åŠ¨åŠ›ä¸€å®šæ˜¯æ¥è‡ªä¸ªä½“æœ¬èº«ï¼Œè€Œä¸æ˜¯é¢†å¯¼ã€å…¬å¸ï¼Œå› ä¸ºèŒä¸šå‘å±•æ˜¯å±äºä½ è‡ªå·±çš„ã€‚å¦‚æœä½ çœŸçš„æƒ³åœ¨è¿™ä¸ªå……æ»¡ç«äº‰çš„ä¸–ç•Œé‡Œè„±é¢–è€Œå‡ºï¼Œé‚£ä¹ˆä½ é¦–å…ˆå¿…é¡»åˆ¶è®¢ä¸€ä¸ªåšå®å¯é è€Œåˆæ·±æ€ç†Ÿè™‘çš„è®¡åˆ’ï¼Œå­¦ä¼šä¸»åŠ¨ç®¡ç†è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯ã€‚</p><p>èŒä¸šç”Ÿæ¶¯ä¸­è¦åšçš„ç¬¬ä¸€ä»¶äº‹ä¾¿æ˜¯ï¼Œè½¬å˜ä½ çš„å¿ƒæ€ã€‚è€Œå•†ä¸šå¿ƒæ€å¯¹äºç®¡ç†èŒä¸šè§„åˆ’è‡³å…³é‡è¦ã€‚å¦‚æœä½ å·²ç»ä¹ æƒ¯äºé¢†å–ä¸€ä»½å›ºå®šçš„è–ªé…¬ï¼Œä¾¿ä¼šå¾ˆå®¹æ˜“å¯¼è‡´ä½ äº§ç”Ÿï¼šä½ åªæ˜¯åœ¨ä¸ºè¿™å®¶å…¬å¸æ‰“å·¥çš„è°‹ç”Ÿå¿ƒæ€ã€‚å°½ç®¡åœ¨ä½ çš„èŒä¸šç”Ÿæ¶¯çš„æŸä¸ªç‰¹å®šæ—¶é—´æ®µé‡Œï¼Œä½ å¯èƒ½ç¡®å®æ˜¯åœ¨ä¸ºæŸå®¶å…¬å¸æ‰“å·¥ï¼Œä½†æ˜¯åƒä¸‡ä¸è¦å› æ­¤å›ºåŒ–äº†ä½ çš„æ•´ä¸ªèŒä¸šç”Ÿæ¶¯ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1562990262645-1c5cf817-03dd-4b0d-82d4-55e4dca112b0.png" alt=""></p><p>é‚£ä¹ˆå¿ƒæ€è¯¥å¦‚ä½•è½¬å˜å‘¢ï¼Ÿé¦–å…ˆä½ è¦æŠŠè‡ªå·±å½“ä½œä¸€ä¸ªä¼ä¸šå»æ€è€ƒï¼Œç„¶åæŠŠé›‡ä¸»å½“ä½œæ˜¯ä½ è¿™ä¸ªä¼ä¸šçš„ä¸€ä¸ªå®¢æˆ·ã€‚å½“ç„¶ï¼Œä½ å¯èƒ½åªæœ‰è¿™ä¹ˆä¸€ä¸ªå®¢æˆ·ï¼Œä½ æ‰€æœ‰çš„æ”¶å…¥éƒ½æ˜¯ä»è¿™ä¸€ä¸ªå®¢æˆ·å¾—æ¥çš„ï¼Œä½†æ˜¯è¿™ç§è¯ é‡Šé›‡ç”¨å…³ç³»çš„æ–¹å¼å¯ä»¥å°†ä½ ä»é›‡ä½£å…³ç³»çš„å¼±åŠ¿åœ°ä½è½¬æ¢æˆä¸ºè‡ªæˆ‘æ²»ç†å’Œè‡ªæˆ‘å¼•å¯¼çš„ä¸»åŠ¨åœ°ä½ï¼ŒåŒæ—¶ï¼Œå¿ƒæ€è½¬å˜åèƒ½æ›´æœ‰åˆ©äºä½ åšå‡ºè‰¯å¥½çš„å•†ä¸šå†³ç­–ã€‚</p><a id="more"></a><h2 id="ä½œä¸ºä¼ä¸šè¯¥å¦‚ä½•æ€è€ƒ">ä½œä¸ºä¼ä¸šï¼Œè¯¥å¦‚ä½•æ€è€ƒ</h2><p>ç°åœ¨ä½ å·²ç»æŠŠè‡ªå·±å½“ä½œä¸€ä¸ªä¼ä¸šäº†ï¼Œåœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œå…¶å®ä½ çš„æ”¶ç›Šå¹¶ä¸å¤§ï¼Œè‡³å°‘ç‰©è´¨ä¸Šå¹¶æ²¡æœ‰ç»™ä½ å¤ªå¤šå¥½å¤„ã€‚è¦æƒ³ä»ä¸­æœ‰æ‰€æ”¶è·ï¼Œä½ å¾—å…ˆå¼„æ˜ç™½ä¼ä¸šæ˜¯å¦‚ä½•æ€è€ƒã€å‘å±•çš„ï¼Ÿä¸Šä¸ªæœˆè·Ÿæˆ‘ä»¬çš„PMO@å†°éœ– æœ‰è¿‡ä¸€æ¬¡é—²è°ˆï¼Œè¿‡ç¨‹ä¸­å°è±¡æœ€æ·±çš„ä¸€å¥è¯æ˜¯ï¼šä¸€ä¸ªä¼ä¸šè¦å‘å±•ï¼Œé¦–å…ˆè¦æ‰¾åˆ°ä¸€ä¸ªèƒ½èµšé’±çš„äº§å“æˆ–æœåŠ¡ï¼Œç„¶åæ€è€ƒå¦‚ä½•å®Œå–„ã€æ”¹è¿›ï¼Œä»¥è¾¾åˆ°æ›´é•¿è¿œçš„å‘å±•ã€‚å‘å±•è¿‡ç¨‹ä¸­ï¼Œå§‹ç»ˆè¦è€ƒè™‘æŠ•å…¥äº§å‡ºï¼ˆæˆæœ¬ã€é£é™©ã€æ”¶ç›Šã€å›æŠ¥å‘¨æœŸï¼‰ï¼Œå°†æ”¶ç›Šæœ€å¤§åŒ–ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1562994831596-1f1844d1-ef9d-4bcd-bf0d-fb9c504ae2d4.png" alt=""></p><p>æŠŠä½ ä½œä¸ºä¸€ä¸ªä¼ä¸šï¼Œä½ ç›®å‰ä»¥åŠæœªæ¥èƒ½æä¾›ä»€ä¹ˆæœåŠ¡æˆ–äº§å“å‘¢ï¼Ÿå³ä½¿ä½ åˆšå¼€å§‹æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼Œå¯¹ä½ è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯æˆ–è®¸ä¹Ÿä¼šæ…¢æ…¢äº§ç”Ÿæ·±è¿œçš„å½±å“ã€‚æ‹¿æˆ‘æ¥ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ç›®å‰çš„èŒä¸šæ˜¯webå‰ç«¯å·¥ç¨‹å¸ˆï¼Œé‚£æˆ‘å”®å–çš„å°±æ˜¯å‰ç«¯å¼€å‘æŠ€èƒ½ï¼Œå‡†ç¡®æ¥è®²ï¼Œå”®å–çš„æ˜¯æŠŠå…¬å¸çš„æƒ³æ³•å®ç°æˆäº’è”ç½‘äº§å“äººæœºäº¤äº’çš„èƒ½åŠ›ã€‚ä¼ä¸šéœ€è¦æŒç»­ä¸æ–­åœ°è¿­ä»£ã€æ”¹è¿›å’Œå®Œå–„è‡ªå·±çš„äº§å“ã€‚ä½ ä¹Ÿåº”è¯¥è¿™ä¹ˆåšï¼Œé€šè¿‡ä¸æ–­å­¦ä¹ å‡çº§æ‰“æ€ªï¼Œå»å®Œå–„è‡ªæˆ‘ã€‚</p><h2 id="æ€è€ƒæœªæ¥çš„ç›®æ ‡">æ€è€ƒæœªæ¥çš„ç›®æ ‡</h2><p>ä½œä¸ºä¼ä¸šï¼Œå‡ºäº†è¦çŸ¥é“è‡ªå·±èƒ½æä¾›ä»€ä¹ˆæœåŠ¡æˆ–äº§å“ï¼Œè¿˜éœ€è¦æ˜ç¡®çš„ä¸šåŠ¡ç›®æ ‡ã€‚èµ·æ­¥é˜¶æ®µæœ€ç®€å•çš„å°±æ˜¯åœ¨å¿ƒä¸­æ ‘ç«‹ä¸€ä¸ªå¤§ ç›®æ ‡ï¼Œç„¶åå†å»ºç«‹èƒ½å¸®ä½ è¾¾æˆè¿™ä¸ªå¤§ç›®æ ‡çš„å°ç›®æ ‡ã€‚å¤§ç›®æ ‡å¹¶ä¸éœ€è¦é‚£ä¹ˆå…·ä½“ï¼Œä½†æ˜¯å¿…é¡»è¶³å¤Ÿæ¸…æ™°ï¼Œèƒ½å¤Ÿè®©ä½ çŸ¥é“è‡ªå·±æ˜¯åœ¨å‘å®ƒå‰è¿›è¿˜æ˜¯ç¦»å®ƒè¶Šæ¥è¶Šè¿œã€‚ ä¾‹å¦‚æƒ³æˆä¸ºä¸€å®¶å…¬å¸çš„ç»ç†æˆ–ä¸»ç®¡?æƒ³åœ¨æŸä¸€å¤©èµ°å‡ºå»å¼€æ‹“è‡ªå·±çš„ä¸šåŠ¡ï¼Œç ”å‘è‡ªå·±çš„äº§å“ï¼Ÿ</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1562994977456-d5af47d6-e8bc-41e1-9332-2dc5caaa69d5.png" alt=""></p><p>å¾ˆå¤šäººè®¤ä¸ºç›®æ ‡å¤ªè¿‡äºå¤§ï¼Œä¸å®¹æ˜“å®ç°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéœ€è¦è®¾ç«‹å°ç›®æ ‡çš„åŸå› ã€‚å®ç°ç›®æ ‡çš„è¿‡ç¨‹ï¼Œå°±å¥½æ¯”èˆªæµ·ï¼Œå°ç›®æ ‡å¯ä»¥è®©ä½ èˆªè¡Œè½¨é“å§‹ç»ˆæ§åˆ¶åœ¨æ­£ç¡®çš„æ–¹å‘ä¸Šï¼Œæ¿€åŠ±ä½ æœç€æ›´å¤§çš„ç›®æ ‡å‰è¿›ã€‚å¤§ç›®æ ‡å¦‚æœæ²¡æœ‰åˆ†è§£æˆå°ç›®æ ‡ï¼Œä½ å¾ˆå®¹æ˜“åç¦»èˆªå‘ï¼Œè¿·å¤±åœ¨èŒ«èŒ«å¤§æµ·ä¹‹ä¸­ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>èŒä¸šä¸Šï¼Œæˆ‘æƒ³æˆä¸ºä¸€ä¸ªèƒ½å¤Ÿå½±å“äº’è”ç½‘è¡Œä¸šå‘å±•çš„ä¸“å®¶ã€‚</p><p>åœ¨å®ç°ç›®æ ‡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘çš„å¿…ç»ä¹‹è·¯æ˜¯è¸å…¥è¡Œä¸šï¼ŒæŒæ¡è¡Œä¸šçš„æŸç§æŠ€èƒ½ï¼Œè€ƒæ ¸çš„æ ‡å‡†æ˜¯ï¼šèƒ½å¤Ÿé€šè¿‡è‡ªå·±æŒæ¡çš„æŠ€èƒ½ï¼Œå®ç°å°±ä¸šã€‚<br>ç»è¿‡åœ¨è¡Œä¸šä¸­çš„å‡ å¹´æ‘¸çˆ¬æ»šæ‰“ï¼Œä¸æ–­æå‡è‡ªå·±æŠ€æœ¯ï¼ˆä¸“ä¸šèƒ½åŠ›ï¼‰ã€ç§¯ç´¯äººè„‰ï¼ˆäº¤é™…èƒ½åŠ›ï¼‰ï¼Œæ…¢æ…¢æ‰“ç£¨è‡ªå·±å‘é«˜æ‰‹é æ‹¢ï¼Œè¡¡é‡çš„æ ‡å‡†æ˜¯æ˜¯å¦èƒ½è·Ÿå…¶ä»–é«˜æ‰‹/ä¸“å®¶è¿›è¡Œå¹³ç­‰å¯¹è¯ï¼ˆè¿™é‡Œçš„å¹³ç­‰å¯¹è¯ï¼Œå¹¶ä¸æ˜¯ä½äººä¸€ç­‰çš„æ„æ€ï¼Œè€Œæ˜¯äº’ç›¸äº¤æµè¿‡ç¨‹ä¸­èƒ½å¤Ÿç›¸äº’ä¼ é€’ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ä¸çŸ¥æ‰€äº‘ï¼‰ã€‚<br>è¶Šå¾€ä¸Šèµ°ï¼Œä½ ä¼šå‘ç°ä½ çš„è§†é‡æ­£åœ¨å˜åŒ–ï¼Œå¯ä»¥çœ‹åˆ°åˆ«äººæ‰€çœ‹ä¸åˆ°ï¼Œèƒ½å¤Ÿå½±å“ç”šè‡³å¼•é¢†è¡Œä¸šå‘å±•çš„ä¸œè¥¿æ­£ç­‰ç€ä½ å»æŒ–æ˜ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1562996074814-ec079c9f-721d-4ce2-afa3-baca30fd6ea8.png?x-oss-process=image/resize,w_1492" alt=""></p><p>è¦å®ç°ç›®æ ‡çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œé‚£æˆ‘å¯èƒ½ä¼šåˆ‡å‰²æˆå¦‚ä¸‹å°ç›®æ ‡ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1562999854321-11ddde78-ee69-4053-b6aa-50c0f012932d.png" alt=""></p><h2 id="æ‰¿æ‹…æ›´å¤šçš„è´£ä»»">æ‰¿æ‹…æ›´å¤šçš„è´£ä»»</h2><p>é€¼ç€è‡ªå·±ä¸€è·¯å‰è¡Œçš„æ–¹å¼æ–¹æ³•å¾ˆå¤šï¼Œä½†è´£ä»»æ˜¯æ°¸è¿œæ˜¯é­ç­–ä½ è‡ªæˆ‘æˆé•¿æœ€æœ‰æ•ˆçš„é€”å¾„ã€‚å¦‚æœä½ è‡ªé©±èƒ½åŠ›å¾ˆå¼ºï¼Œé‚£æˆ‘æ­å–œä½ å“ˆã€‚å¦‚æœä¸æ˜¯ï¼Œè¯·ä½ åœ¨æœ‰ä»»ä½•æœºä¼šå»æ‰¿æ‹…æ›´å¤šè´£ä»»æ—¶ï¼Œä¸»åŠ¨å»æ‰¿æ‹…ï¼Œæ¥å—æŒ‘æˆ˜ã€‚</p><p>å¾ˆå¤šäººä¼šé—®ï¼Œå‡å¦‚æ²¡æœ‰è¢«èµ‹äºˆæ›´å¤šè´£ä»»æ€ä¹ˆåŠï¼Ÿ</p><ul><li><p>ä¸»åŠ¨å¯»æ‰¾æœºä¼šã€‚é€šå¸¸æ²¡æœ‰äººæ„¿æ„æ¶‰è¶³çš„é¢†åŸŸæ˜¯æœå¯»æœºä¼šæœ€å¥½çš„åœ°æ–¹ã€‚ä»¥ç¨‹åºå‘˜æ¥è¯´ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªæ²¡äººæ„¿æ„ç¢°çš„é—ç•™åº”ç”¨ï¼Œæˆ–è€…ä»£ç åº“é‡Œçš„æŸä¸ªæ²¡äººæ•¢å»ç¢°çš„æ¨¡å—ã€‚æ­£å› ä¸ºæ²¡æœ‰äººæ„¿æ„ç¢°ã€æ²¡äººæ•¢å»ç¢°ï¼Œæ‰€ä»¥æ²¡äººè·Ÿä½ æŠ¢ï¼Œè¿™å°±æˆä¸ºäº†ä½ æ—¥ç›Šå¼ºå¤§çš„é˜µè¥ã€‚å¦‚æœä½ èƒ½æŠŠæ²¼æ³½å˜ä¸ºè‰¯ç”°ï¼Œä½ ä¹Ÿå°±å±•ç°äº†è‡ªå·±çš„ä»·å€¼ã€‚</p></li><li><p>é—´æ¥æ‰¿æ‹…è´£ä»»ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯æˆä¸ºå›¢é˜Ÿä¸­å…¶ä»–äººçš„å¯¼å¸ˆï¼Œè‡ªæ„¿å¸®åŠ©æ–°äººåŠ é€Ÿæˆé•¿ï¼Œä¸ºä»»ä½•æœ‰éœ€è¦çš„äººæä¾›å¸®åŠ©ã€‚é€šè¿‡ä»‹å…¥å’Œè§£å†³åˆ«äººçš„é—®é¢˜ï¼Œä½ ä¸ä»…å¯ä»¥å­¦åˆ°æ›´å¤šè‡ªå·±ä¸“ä¸šä¹‹å¤–çš„çŸ¥è¯†ï¼Œè€Œä¸”éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä½ è¿˜èƒ½åœ¨å›¢é˜Ÿä¸­é€æ­¥æ ‘ç«‹å½±å“åŠ›ã€‚</p></li></ul><h2 id="è§£å†³é—®é¢˜è€Œä¸æ˜¯æ¥æŠ±æ€¨é—®é¢˜">è§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯æ¥æŠ±æ€¨é—®é¢˜</h2><p>åœ¨ä»»ä½•ç»„ç»‡ä¸­ï¼Œæ€»æ˜¯æœ‰å¾ˆå¤šäººä¼šå‘Šè¯‰ä½ ä¸ºä»€ä¹ˆè¿™ä¸ªæƒ³æ³•è¡Œä¸é€šï¼Œé‚£ä¸ªé—®é¢˜å¤ªéš¾ï¼Œè¿™ä¸ªé—®é¢˜ä¸é€‚åˆæˆ‘æ¥åšï¼Œæ›´é€‚åˆè°å»åšã€‚è¿™æ ·çš„äººä¸èƒœæšä¸¾ã€‚åƒä¸‡ä¸è¦æˆä¸ºä»–ä»¬ä¸­çš„ä¸€å‘˜ã€‚ç›¸åï¼Œä½ è¦æˆä¸ºé‚£ä¸ªæ°¸è¿œèƒ½ä¸ºå„ç§é—®é¢˜æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ‰§è¡Œè½åœ°è¿™äº›è§£å†³æ–¹æ¡ˆä»¥è·å¾—æˆæœçš„äººã€‚æˆä¸ºè¿™ç§äººä¹Ÿæ˜¯è·å¾—æ™‹å‡çš„å¯é æ–¹æ³•ã€‚å¦‚æœä½ èƒ½è§£å†³åˆ«äººæ— æ³•è§£å†³æˆ–ä¸æ„¿è§£å†³çš„é—®é¢˜ï¼Œæ— è®ºåœ¨å“ªå®¶å…¬å¸ï¼Œä½ éƒ½èƒ½è½»è€Œæ˜“ä¸¾åœ°æˆä¸ºæœ€æœ‰ä»·å€¼çš„äººã€‚</p><h2 id="æŒæ¡å¿«é€Ÿè‡ªæˆ‘å­¦ä¹ çš„èƒ½åŠ›">æŒæ¡å¿«é€Ÿè‡ªæˆ‘å­¦ä¹ çš„èƒ½åŠ›</h2><p>å¾ˆå¤šç¨‹åºå‘˜è¢«ç»•è¿›äº†å­¦ä¹ æ–°æŠ€æœ¯ã€æ–°ç¼–ç¨‹è¯­è¨€ã€æ–°æ¡†æ¶çš„æ¼©æ¶¡ï¼Œæ„Ÿè§‰å­¦ä¹ çš„å‹åŠ›å¾ˆå¤§ï¼Œæ€ä¹ˆçˆ¬ä¹Ÿçˆ¬ä¸å‡ºæ¥ã€‚é€šå¸¸ï¼Œè¿™ç§å‹åŠ›æ˜¯è‡ªæˆ‘é€ æˆçš„ã€‚</p><p>åœ¨æˆ‘åˆšå‡ºæ¥å·¥ä½œçš„æ—¶å€™ï¼Œæˆ‘å­¦ä¹ æŠ€æœ¯çš„ä¸»è¦é€”å¾„å°±æ˜¯ä¹°ä¸€æœ¬ä¹¦ï¼Œç„¶ååªæœ‰é€šè¯»å®Œå…¨ä¹¦åï¼Œæˆ‘æ‰ä¼šå°†è‡ªå·±å­¦åˆ°çš„æŠ€æœ¯åº”ç”¨äºé¡¹ç›®å®è·µä¸­ã€‚è¿™ä¸ªæ–¹æ³•ï¼Œç¡®å®èƒ½å­¦åˆ°ä¸œè¥¿ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½ï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œè¿˜å¾—ç»å¸¸å›é¡¾ä¹¦çš„å†…å®¹ï¼Œæ¥å¼¥è¡¥è‡ªå·±åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é—æ¼çš„é—®é¢˜ã€‚</p><p>é€šå¸¸åœ¨ä¸šåŠ¡å‘å±•çš„è¿‡ç¨‹ä¸­ï¼ŒæŠ€æœ¯é€‰å‹æ˜¯ä¸ä¼šç­‰å¾…ä½ å­¦ä¹ å¥½ä¸€é—¨æŠ€æœ¯æ‰æŠ•å…¥åˆ°ä¸šåŠ¡ä¸­çš„ã€‚è¿™ä¾¿è¿«ä½¿æˆ‘ä»¬å»å¯»æ‰¾æ›´å¥½çš„è‡ªå­¦æ–¹æ³•ï¼Œèƒ½åœ¨æœ‰é™çš„æ—¶é—´å†…å¸æ”¶ã€æŒæ¡æ‰€éœ€å†…å®¹å³å¯ã€‚ä¾‹å¦‚æˆ‘åœ¨å·²æœ‰ React å¼€å‘ç»éªŒçš„æƒ…å†µä¸‹ï¼ŒåªèŠ±äº† 1 å¤©å·¦å³é›¶ç¢çš„æ—¶é—´ï¼Œé€šè¿‡å¯¹æ¯” React ä¸ Vue çš„è¯­æ³•åŒºåˆ«ï¼Œç„¶ååœ¨ JSBin (<a href="http://jsbin.com" target="_blank" rel="noopener">http://jsbin.com</a>) ä¸­è¯•è·‘ Demoï¼Œç¬¬äºŒå¤©ä¾¿å¯ä»¥å°† Vue æŠ•å…¥åˆ°é¡¹ç›®å¼€å‘ä¸­å»ã€‚</p><p>è¿™å…¶å®æ˜¯ä¸€ä¸ªç­›é€‰å­¦ä¹ å†…å®¹ã€åŠ¨æ‰‹æ“ä½œå†åˆ°å­¦ä»¥è‡´ç”¨çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ä¸æ–­å¾ªç¯ï¼Œä¸æ–­å¸æ”¶æ›´å¤šçš„çŸ¥è¯†ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1563001416773-405fedae-7ec7-4690-b55f-e303ca7e9a72.png" alt=""></p><p>è¿™ä¸ªæ–¹æ³•å¯ä»¥é«˜æ•ˆåœ°æŒæ¡ä¸€é—¨æŠ€æœ¯ï¼Œè€Œæ— éœ€é€šæ™“å…¨éƒ¨ç»†èŠ‚ã€‚é€šè¿‡åœ¨ä¸šåŠ¡å®è·µé¡¹ç›®ä¸­ä¸æ–­æš´æ¼é—®é¢˜ã€è§£å†³é—®é¢˜ã€æ€»ç»“é—®é¢˜ï¼Œä½ ä¼šå‘ç°æ‰€æœ‰æŠ€æœ¯é—®é¢˜ï¼Œæ…¢æ…¢éƒ½ä¼šæ”¶æ‹¢åˆ°ä¸€èµ·ï¼Œé€æ¸ä¸°å¯Œä½ çš„ç»éªŒï¼Œæœ€ç»ˆä½ ä¾¿å¼€å§‹èƒ½å¤Ÿè§£å†³â€œæŸä¸€ç±»é—®é¢˜â€ï¼Œè€Œä¸æ˜¯â€œæŸä¸€ä¸ªé—®é¢˜â€ï¼Œéšç€ä½ èƒ½å¤Ÿè§£å†³é—®é¢˜çš„ç±»å‹è¶Šå¤šï¼Œä½ èä¼šè´¯é€šçš„èƒ½åŠ›å°±ä¼šè¶Šå¼ºã€‚</p><h2 id="æ‰¾å‡ºè‡ªå·±çš„çŸ­æ¿å¹¶æ¶ˆç­å®ƒ">æ‰¾å‡ºè‡ªå·±çš„çŸ­æ¿ï¼Œå¹¶æ¶ˆç­å®ƒ</h2><p>ä¸“æ³¨äºè‡ªèº«å¼ºé¡¹ï¼Œè¿™æ²¡ä»€ä¹ˆä¸å¦¥ï¼Œä½†æœ‰æ—¶å€™ï¼Œå¦‚æœå¼±ç‚¹å¾—ä¸åˆ°è§£å†³ï¼Œé€šå¸¸ä¼šæˆä¸ºä½ çš„èŒä¸šæˆ–ç”Ÿæ´»çš„ç»Šè„šçŸ³ã€‚æˆ‘ä»¬æ¯ä¸ªäººéƒ½æœ‰å¼±ç‚¹ã€‚æˆ‘ä»¬èƒ½å‘ç°å¹¶æ¶ˆé™¤è‡ªèº«çš„çŸ­æ¿è¶Šå¤šï¼Œé•¿ä¹…æ¥çœ‹æˆ‘ä»¬ä»ä¸­å—ç›Šè¶Šå¤š----å¯ä»¥å‚è€ƒæœ¨æ¡¶æ•ˆç›Šã€‚</p><p>å¾ˆé—æ†¾çš„æ˜¯ï¼Œæ¯ä¸ªäººèº«ä¸Šå¤§å¤šæ•°çš„çŸ­æ¿ï¼Œè‡ªå·±åªèƒ½éšçº¦è§‰å¯Ÿåˆ°ã€‚å¯¹äºè‡ªå·±ä¸çŸ¥é“çš„ï¼Œä½ å¾ˆéš¾æ¸…æ¥šåœ°æ„è¯†åˆ°ï¼Œä¹Ÿå¾ˆå®¹æ˜“å¿½ç•¥ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1563002803796-5fd0afd6-11bd-4433-96a4-ea20abf2a587.png" alt=""></p><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°è‡ªå·±çš„çŸ­æ¿å‘¢ï¼Ÿæ—è§‚è€…æ¸…ã€å½“å±€è€…è¿·çš„é“ç†å¤§å®¶éƒ½çŸ¥é“ï¼Œä½†é€šå¸¸äººéƒ½ä¸å¤ªå–œæ¬¢é€†è€³çš„å£°éŸ³ï¼Œæ‰€ä»¥åˆ«äººå¾€å¾€ä¹Ÿä¸ä¼šå¾ˆç›´æ¥çš„æŒ‡å‡ºä½ çš„çŸ­æ¿ã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å°è¯•ï¼š</p><ul><li><p>è‡ªèº«ä¸»åŠ¨ä¸ä»–äººåšå¯¹æ¯”ï¼šåŒæ ·ä¸€ä»¶äº‹æƒ…ï¼Œäººå®¶åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œä½ èƒ½åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œäººå®¶æ˜¯æ€ä¹ˆåšçš„ï¼Œä½ æ˜¯æ€ä¹ˆåšçš„ï¼Œæ€»çš„æ¥è¯´ï¼Œä¸æ¯”ä¸çŸ¥é“ï¼Œä¸€æ¯”å“ä¸€è·³ã€‚é€šè¿‡æ¯”è¾ƒä½ å°±çŸ¥é“è‡ªå·±çš„æ€è·¯ï¼Œè¡ŒåŠ¨çš„å·®è·åœ¨å“ªé‡Œã€‚</p></li><li><p>åœ¨åæ€ä¸­æ‰¾åˆ°è‡ªå·±çš„çŸ­æ¿ï¼šæœ‰æ—¶å€™åšä¸€ä¸ªäº‹æƒ…ï¼Œä¸é¡ºåˆ©ï¼Œå¤±è´¥ã€‚è¿™æ—¶å€™è™½ç„¶å¾ˆæ²®ä¸§ï¼Œä½†æ˜¯å¦‚æœèƒ½å¤Ÿåœ¨æ²®ä¸§ä¸­åæ€è‡ªå·±ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯ï¼Œå¦‚æœå½“æ—¶æ€ä¹ˆæ ·å¤„ç†å°±ä¼šå¥½ä¸€äº›ï¼Œç”±æ­¤å°±çŸ¥é“ç¼ºå°‘å“ªä¸€æ–¹é¢çš„çŸ­æ¿äº†ã€‚</p></li><li><p>æœ‰ä¸€ä¸¤ä¸ªçŸ¥å·±æœ‹å‹ä¹Ÿä¼šèµ·åˆ°å¾ˆå¤§çš„ä½œç”¨ï¼Œè™šå¿ƒå¸æ”¶æœ‹å‹æŒ‡å‡ºçš„é—®é¢˜ï¼Œå¹¶çæƒœä½ ä¿©çš„åŸºå‹å§ã€‚</p></li><li><p>ä¸“æ³¨äºè‡ªå·±çš„é¢†åŸŸçš„åŒæ—¶ï¼Œä¹Ÿæœ‰æ‰©å®½è‡ªå·±çš„è§†é‡ï¼Œæ¶‰çŒä¸åŒé¢†åŸŸæ¸ é“çš„ä¿¡æ¯ã€‚</p></li></ul><h2 id="åˆç†è§„åˆ’æ—¶é—´æé«˜ç”Ÿäº§åŠ›">åˆç†è§„åˆ’æ—¶é—´ï¼Œæé«˜ç”Ÿäº§åŠ›</h2><p>å¤šå¹´æ¥ï¼Œæˆ‘å°è¯•è¿‡ä¸å°‘æå‡ç”Ÿäº§åŠ›çš„æ–¹æ³•ï¼Œç›®å‰æˆ‘ç”¨çš„æ˜¯å››è±¡é™å·¥ä½œäº‹é¡¹ç®¡ç†æ³•å’Œç•ªèŒ„æ—¶é—´ç®¡ç†æ³•ç»„åˆçš„æ–¹å¼ã€‚</p><h3 id="ç•ªèŒ„æ—¶é—´ç®¡ç†æ³•">ç•ªèŒ„æ—¶é—´ç®¡ç†æ³•</h3><p>ç¬¬ä¸€æ¬¡ä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•çš„æ—¶å€™ï¼Œæˆ‘å¹¶æ²¡æœ‰ä¸¥æ ¼åšåˆ°å®ƒè§„å®šçš„è¦æ±‚ã€‚æˆ‘åªæ˜¯æ¯å¤©ç”¨å®ƒæ¥è®¾ç½®è‹¥å¹²ä¸ªâ€œ25åˆ†é’Ÿâ€çš„ç•ªèŒ„é’Ÿã€‚æˆ‘å¹¶æ²¡æœ‰ç•™æ„è‡ªå·±æ¯å¤©å®Œæˆäº†å‡ ä¸ªç•ªèŒ„é’Ÿï¼Œä¹Ÿæ²¡æœ‰ä¼°ç®—æŸé¡¹ä»»åŠ¡è¦ç”¨æ‰å‡ ä¸ªç•ªèŒ„é’Ÿï¼›å› æ­¤æˆ‘å¹¶æ²¡æœ‰ä»ä¸­å—ç›Šã€‚åªæ˜¯ç®€å•è®¤ä¸ºæ•´ä¸ªæ–¹æ³•å°±æ˜¯è®©ä½ åœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…ä¿æŒä¸“æ³¨ã€‚</p><p>ç›´åˆ°åæ¥æˆ‘å†³å®šä¸¥æ ¼åœ°ä½¿ç”¨ç•ªèŒ„æ—¶é—´ç®¡ç†æ³•ï¼Œå‘ç°è‡ªå·±æ½œç§»é»˜åŒ–åœ°é€æ¸æœ‰èƒ½åŠ›ã€å¯é‡åŒ–å»çœŸæ­£è¯„ä¼°è‡ªå·±æ¯å¤©å¯ä»¥å®Œæˆçš„å·¥ä½œé‡ã€‚é€šè¿‡è·Ÿè¸ªè‡ªå·±ä¸€å¤©å†…å®Œæˆäº†å¤šå°‘ä¸ªç•ªèŒ„é’Ÿï¼Œå¹¶ä¸ºæ¯å¤©è¦å®Œæˆçš„ç•ªèŒ„é’Ÿçš„æ•°é‡è®¾å®šç›®æ ‡ã€‚ä»Šåæ¯æ¬¡é¡¹ç›®ä¸­ï¼Œéœ€è¦è¯„ä¼°å·¥ä½œé‡ã€ä¼°ç®—å·¥æ—¶ï¼Œä¾¿å‘æŒ¥äº†ç•ªèŒ„æ—¶é—´ç®¡ç†æ³•çœŸæ­£çš„å¨åŠ›ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1563004394385-f2460f92-19e2-487b-b3e4-1fa4dc0c3a09.png" alt=""></p><h3 id="å››è±¡é™å·¥ä½œæ³•">å››è±¡é™å·¥ä½œæ³•</h3><p>é‚£å››è±¡é™å·¥ä½œæ³•å¦‚ä½•ä¸ç•ªèŒ„æ—¶é—´ç®¡ç†ç»“åˆä½¿ç”¨å‘¢ï¼Ÿ</p><p>ä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•ï¼Œä½ å¯ä»¥æŠŠæ¯å‘¨çœ‹ä½œæ˜¯ç”±æœ‰é™ä¸ªç•ªèŒ„é’Ÿç»„æˆçš„ã€‚æƒ³åœ¨æ¯å‘¨å®Œæˆä¸€å®šæ•°é‡çš„ä»»åŠ¡?ä½ è¦ææ¸…æ¥šè‡ªå·±ä¸€å‘¨èƒ½å®Œæˆå¤šå°‘ä¸ªç•ªèŒ„é’Ÿï¼Œå¹¶ç›¸åº”åœ°è®¾ç½®ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚é€šè¿‡è®¡ç®—è‡ªå·±å®Œæˆçš„ç•ªèŒ„é’Ÿçš„æ•°é‡ï¼Œå¯ä»¥ç¡®åˆ‡çŸ¥é“è‡ªå·±ä¸€å‘¨å®Œæˆäº†å¤šå°‘ä»»åŠ¡ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼šå¦‚æœä½ æ²¡èƒ½å®Œæˆè‡ªå·±è®¾å®šçš„ä»»åŠ¡ï¼Œä½†æ˜¯å´ç”¨å®Œäº†è¶³å¤Ÿæ•°é‡çš„ç•ªèŒ„é’Ÿæ€ä¹ˆåŠï¼Ÿ</p><p>æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ€»æ˜¯å¹»æƒ³ç€è‡ªå·±å¯ä»¥åœ¨ä¸€å‘¨å†…å®Œæˆè¶…å‡ºè‡ªå·±å®é™…èƒ½åŠ›è®¸å¤šçš„å·¥ä½œï¼Œè¿‡é«˜åœ°ä¼°è®¡äº†è‡ªå·±çš„èƒ½åŠ›è€Œä½ä¼°äº†å®Œæˆä»»åŠ¡æ‰€éœ€çš„æ—¶é—´ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éå¸¸æœ‰å¿…è¦ç»™å„ä¸ªä»»åŠ¡é¡¹è®¾ç½®çš„ä¼˜å…ˆçº§äº†ï¼Œå°†ä½ æ¯å‘¨éœ€è¦å®Œæˆçš„ä»»åŠ¡æŒ‰ç…§é‡è¦ã€ç´§æ€¥åˆ’åˆ†æˆå››ç±»ï¼šé‡è¦ç´§æ€¥ã€é‡è¦ä¸ç´§æ€¥ã€ç´§æ€¥ä¸é‡è¦ã€ä¸é‡è¦ä¸ç´§æ€¥ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1563004203908-40f1d81e-f0c3-469d-a020-e12ec758528f.png?x-oss-process=image/resize,w_944" alt=""></p><p>æœ‰äººè¿‡æ¥é—®ï¼Œè¿™ä¸¤ä¸ªåˆ†åˆ«æ˜¯ä»€ä¹ˆè½¯ä»¶ï¼Ÿ</p><p>è¿™ä¸ªç»™å¤§å®¶ä»‹ç»ä¸‹å“ˆï¼Œåˆ†åˆ«æ˜¯Focus Matrixå’ŒBe Focusedã€‚ è¿™ä¸¤æ¬¾è½¯ä»¶æ•°æ®æ˜¯å¯ä»¥æ‰“é€šçš„ï¼ŒåŒæ—¶æä¾›äº†æ‰‹æœºç‰ˆã€‚</p><p><img src="https://ata2-img.cn-hangzhou.oss-pub.aliyun-inc.com/3e8b20818459d99ee23809e03d98bd1e.png" alt=""></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨è½¯ä»¶çš„æ–¹å¼ï¼Œè¿™åªæ˜¯ä¸€ä¸ªæ—¶é—´å’Œä»»åŠ¡ç®¡ç†çš„æ–¹æ³•è®ºï¼Œä½ ä¹Ÿå¯ä»¥ä¹°ä¸€ä¸ªæ²™æ¼â³ç®¡ç†æ—¶é—´å’Œä¾¿ç­¾ç®¡ç†ä»»åŠ¡ï¼Œä½¿ç”¨å¾—å½“çš„è¯ï¼Œä¹Ÿæ˜¯å¯ä»¥è¾¾åˆ°ä¸€æ ·æ•ˆæœçš„ã€‚</p><h2 id="æ‰“é€ ä¸ªäººå½±å“åŠ›">æ‰“é€ ä¸ªäººå½±å“åŠ›</h2><p>äº‹å®ä¸Šä¸ªäººå½±å“åŠ›çš„æå‡ä¸€å®šä¸æ˜¯ä¸€æœä¸€å¤•çš„äº‹æƒ…ï¼Œä¹Ÿä¸æ˜¯å…‰è®¾å®šç›®æ ‡å°±å¯ä»¥è¾¾æˆçš„ã€‚ç¡®å®æœ‰è®¸å¤šæ½œç§»é»˜åŒ–å’Œæœºç¼˜å·§åˆèåˆåœ¨é‡Œé¢ã€‚æˆ‘æ‰€è°ˆçš„ä¹Ÿä»…ä»…æ˜¯æ–¹æ³•è®ºï¼Œéœ€è¦å¤§å®¶å»è·µè¡Œï¼Œå†å»æç‚¼å’Œæ€»ç»“ã€‚è¿™é‡Œæ€»ç»“äº†ä¸‰æ­¥ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1563006995937-30960fb3-ab8a-4177-8be4-3b0fe075cf34.png" alt=""></p><p>ç¬¬ä¸€æ­¥æ˜¯åˆ†æè‡ªå·±ï¼Œå¾ˆå¤šäººè§‰å¾—æˆ‘æ€ä¹ˆä¼šä¸çŸ¥é“è‡ªå·±æ˜¯ä¸ªä»€ä¹ˆäººå‘¢ï¼ŸæŠ±æ­‰ï¼Œç»å¤§éƒ¨åˆ†80%çš„äººå‘¢ï¼Œéƒ½æ˜¯æ— æ³•è®¤æ¸…è‡ªå·±ï¼Œä¸€ä¸ªå¯ä»¥å®¢è§‚è¯„ä»·è‡ªå·±çš„äººï¼Œåœ¨è‡ªæˆ‘è®¤çŸ¥éƒ¨åˆ†å°±ä¼šæ›´ç²¾å‡†ã€‚æœ€ç®€å•å¯é‡åŒ–çš„æ–¹å¼å°±æ˜¯ä»æŠ€èƒ½ã€æ€§æ„Ÿç­‰æ–¹é¢å»ç»˜ç”»é›·è¾¾å›¾ï¼Œä»è€Œå®¢è§‚çš„è¯„ä»·è‡ªå·±ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1563007711443-58187a00-150e-463d-bfe5-a46699784340.png?x-oss-process=image/resize,w_482" alt=""><br><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1563007735585-2b7301e7-e098-4052-b153-eb753d250f8a.png?x-oss-process=image/resize,w_436" alt=""><br><img src="https://cdn.nlark.com/yuque/0/2019/png/89257/1563007787194-0f04689a-cbc7-4e37-89c7-b5c28ba1beb6.png?x-oss-process=image/resize,w_444" alt=""></p><p>ç¬¬äºŒæ­¥å°±åˆ°äº†å®šä½è‡ªå·±ï¼Œè¿™ä¸ªå…¶å®è·Ÿäº§å“çš„å®šä½æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸ºä»€ä¹ˆæœ‰äº›å“ç‰Œå¯ä»¥æˆåŠŸï¼Œç¡®å®ä¸å…¶å¯¹äºè‡ªèº«äº§å“çš„é«˜åº¦è®¤çŸ¥å’Œå“ç‰Œä»·å€¼çš„é›†ä¸­èƒå–ï¼Œä¸€çœ¼å°±å¯ä»¥åšè¯†åˆ«å’Œå…³è”ç”¨æˆ·ã€‚é‚£ä¹ˆå¯¹äºæˆ‘ä»¬äººæ¥è¯´ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œæˆ‘çŸ¥é“è‡ªå·±æ˜¯ä»€ä¹ˆæ ·çš„äººä¹‹åï¼Œæˆ‘ä¹Ÿä¼šæ¸…æ™°çš„çŸ¥é“ï¼Œè‡ªå·±é€‚åˆå¾€ä»€ä¹ˆæ ·çš„æ–¹å‘å»å‘å±•ï¼Œæ‰¾åˆ°è‡ªå·±çš„å®šä½ã€‚</p><p>ç¬¬ä¸‰æ­¥æ˜¯å½¢æˆæ ‡ç­¾ï¼Œåœ¨ä½ è¿‡å¾€çš„å„ç§å„æ ·çš„äººç”Ÿç»å†ä¸­ï¼Œä½ éœ€è¦æå–ä¸€äº›æ ‡ç­¾ï¼Œå›ºåŒ–è‡ªå·±ï¼Œè®©è‡ªå·±æˆä¸ºæ–œæ é’å¹´ï¼Œè®©é™Œç”Ÿçš„äººåœ¨è®¤è¯†ä½ çš„æ—¶å€™ï¼Œå¯ä»¥æ›´å¿«çš„è¯†åˆ«ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œå¼€æºä¸­å›½ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/ydxxfv7u%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/ydxxfv7uï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <code>editor@hi-linux.com</code> ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™æ˜¯ä¸€ç¯‡ä» â€œäººâ€ (è€ŒéæŠ€æœ¯ä¹Ÿéç®¡ç†)çš„è§’åº¦ï¼Œèšç„¦äºè‡ªèº«èŒä¸šå‘å±•æ–¹æ–¹é¢é¢çš„æ–‡ç« ï¼ŒåŒ…æ‹¬èŒä¸šã€å­¦ä¹ ã€ç”Ÿäº§åŠ›ã€å½±å“åŠ›ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ‹¥æœ‰å•†ä¸šå¿ƒæ€&quot;&gt;æ‹¥æœ‰å•†ä¸šå¿ƒæ€&lt;/h2&gt;
&lt;p&gt;ä½ æ‰€èƒ½çŠ¯çš„æœ€å¤§é”™è¯¯å°±æ˜¯ç›¸ä¿¡è‡ªå·±æ˜¯åœ¨ä¸ºåˆ«äººå·¥ä½œï¼ŒèŒä¸šå‘å±•çš„é©±åŠ¨åŠ›ä¸€å®šæ˜¯æ¥è‡ªä¸ªä½“æœ¬èº«ï¼Œè€Œä¸æ˜¯é¢†å¯¼ã€å…¬å¸ï¼Œå› ä¸ºèŒä¸šå‘å±•æ˜¯å±äºä½ è‡ªå·±çš„ã€‚å¦‚æœä½ çœŸçš„æƒ³åœ¨è¿™ä¸ªå……æ»¡ç«äº‰çš„ä¸–ç•Œé‡Œè„±é¢–è€Œå‡ºï¼Œé‚£ä¹ˆä½ é¦–å…ˆå¿…é¡»åˆ¶è®¢ä¸€ä¸ªåšå®å¯é è€Œåˆæ·±æ€ç†Ÿè™‘çš„è®¡åˆ’ï¼Œå­¦ä¼šä¸»åŠ¨ç®¡ç†è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯ã€‚&lt;/p&gt;
&lt;p&gt;èŒä¸šç”Ÿæ¶¯ä¸­è¦åšçš„ç¬¬ä¸€ä»¶äº‹ä¾¿æ˜¯ï¼Œè½¬å˜ä½ çš„å¿ƒæ€ã€‚è€Œå•†ä¸šå¿ƒæ€å¯¹äºç®¡ç†èŒä¸šè§„åˆ’è‡³å…³é‡è¦ã€‚å¦‚æœä½ å·²ç»ä¹ æƒ¯äºé¢†å–ä¸€ä»½å›ºå®šçš„è–ªé…¬ï¼Œä¾¿ä¼šå¾ˆå®¹æ˜“å¯¼è‡´ä½ äº§ç”Ÿï¼šä½ åªæ˜¯åœ¨ä¸ºè¿™å®¶å…¬å¸æ‰“å·¥çš„è°‹ç”Ÿå¿ƒæ€ã€‚å°½ç®¡åœ¨ä½ çš„èŒä¸šç”Ÿæ¶¯çš„æŸä¸ªç‰¹å®šæ—¶é—´æ®µé‡Œï¼Œä½ å¯èƒ½ç¡®å®æ˜¯åœ¨ä¸ºæŸå®¶å…¬å¸æ‰“å·¥ï¼Œä½†æ˜¯åƒä¸‡ä¸è¦å› æ­¤å›ºåŒ–äº†ä½ çš„æ•´ä¸ªèŒä¸šç”Ÿæ¶¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.nlark.com/yuque/0/2019/png/89257/1562990262645-1c5cf817-03dd-4b0d-82d4-55e4dca112b0.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¿ƒæ€è¯¥å¦‚ä½•è½¬å˜å‘¢ï¼Ÿé¦–å…ˆä½ è¦æŠŠè‡ªå·±å½“ä½œä¸€ä¸ªä¼ä¸šå»æ€è€ƒï¼Œç„¶åæŠŠé›‡ä¸»å½“ä½œæ˜¯ä½ è¿™ä¸ªä¼ä¸šçš„ä¸€ä¸ªå®¢æˆ·ã€‚å½“ç„¶ï¼Œä½ å¯èƒ½åªæœ‰è¿™ä¹ˆä¸€ä¸ªå®¢æˆ·ï¼Œä½ æ‰€æœ‰çš„æ”¶å…¥éƒ½æ˜¯ä»è¿™ä¸€ä¸ªå®¢æˆ·å¾—æ¥çš„ï¼Œä½†æ˜¯è¿™ç§è¯ é‡Šé›‡ç”¨å…³ç³»çš„æ–¹å¼å¯ä»¥å°†ä½ ä»é›‡ä½£å…³ç³»çš„å¼±åŠ¿åœ°ä½è½¬æ¢æˆä¸ºè‡ªæˆ‘æ²»ç†å’Œè‡ªæˆ‘å¼•å¯¼çš„ä¸»åŠ¨åœ°ä½ï¼ŒåŒæ—¶ï¼Œå¿ƒæ€è½¬å˜åèƒ½æ›´æœ‰åˆ©äºä½ åšå‡ºè‰¯å¥½çš„å•†ä¸šå†³ç­–ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="æ€æƒ³" scheme="https://www.hi-linux.com/tags/%E6%80%9D%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆ MySQL ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ</title>
    <link href="https://www.hi-linux.com/posts/34535.html"/>
    <id>https://www.hi-linux.com/posts/34535.html</id>
    <published>2020-05-24T01:16:00.000Z</published>
    <updated>2020-05-24T08:56:22.000Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>åœ¨è¿›è¡Œ MySQL çš„ä¼˜åŒ–ä¹‹å‰å¿…é¡»è¦äº†è§£çš„å°±æ˜¯ MySQL çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œå¾ˆå¤šçš„æŸ¥è¯¢ä¼˜åŒ–å·¥ä½œå®é™…ä¸Šå°±æ˜¯éµå¾ªä¸€äº›åŸåˆ™è®© MySQL çš„ä¼˜åŒ–å™¨èƒ½å¤ŸæŒ‰ç…§é¢„æƒ³çš„åˆç†æ–¹å¼è¿è¡Œè€Œå·²ã€‚</p><p><img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180106134347674-1416660436.png" alt=""></p><p>å›¾ - MySQLæŸ¥è¯¢è¿‡ç¨‹</p><h3 id="ä¼˜åŒ–çš„å“²å­¦">ä¼˜åŒ–çš„å“²å­¦</h3><p>ä¼˜åŒ–æœ‰é£é™©ï¼Œæ¶‰è¶³éœ€è°¨æ…</p><h4 id="ä¼˜åŒ–å¯èƒ½å¸¦æ¥çš„é—®é¢˜">ä¼˜åŒ–å¯èƒ½å¸¦æ¥çš„é—®é¢˜</h4><ul><li>ä¼˜åŒ–ä¸æ€»æ˜¯å¯¹ä¸€ä¸ªå•çº¯çš„ç¯å¢ƒè¿›è¡Œï¼Œè¿˜å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„å·²æŠ•äº§çš„ç³»ç»Ÿã€‚</li><li>ä¼˜åŒ–æ‰‹æ®µæœ¬æ¥å°±æœ‰å¾ˆå¤§çš„é£é™©ï¼Œåªä¸è¿‡ä½ æ²¡èƒ½åŠ›æ„è¯†åˆ°å’Œé¢„è§åˆ°ï¼</li><li>ä»»ä½•çš„æŠ€æœ¯å¯ä»¥è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œä½†å¿…ç„¶å­˜åœ¨å¸¦æ¥ä¸€ä¸ªé—®é¢˜çš„é£é™©ï¼</li><li>å¯¹äºä¼˜åŒ–æ¥è¯´è§£å†³é—®é¢˜è€Œå¸¦æ¥çš„é—®é¢˜,æ§åˆ¶åœ¨å¯æ¥å—çš„èŒƒå›´å†…æ‰æ˜¯æœ‰æˆæœã€‚</li><li>ä¿æŒç°çŠ¶æˆ–å‡ºç°æ›´å·®çš„æƒ…å†µéƒ½æ˜¯å¤±è´¥ï¼</li></ul><h4 id="ä¼˜åŒ–çš„éœ€æ±‚">ä¼˜åŒ–çš„éœ€æ±‚</h4><ul><li>ç¨³å®šæ€§å’Œä¸šåŠ¡å¯æŒç»­æ€§,é€šå¸¸æ¯”æ€§èƒ½æ›´é‡è¦ï¼</li><li>ä¼˜åŒ–ä¸å¯é¿å…æ¶‰åŠåˆ°å˜æ›´ï¼Œå˜æ›´å°±æœ‰é£é™©ï¼</li><li>ä¼˜åŒ–ä½¿æ€§èƒ½å˜å¥½ï¼Œç»´æŒå’Œå˜å·®æ˜¯ç­‰æ¦‚ç‡äº‹ä»¶ï¼</li><li>åˆ‡è®°ä¼˜åŒ–,åº”è¯¥æ˜¯å„éƒ¨é—¨ååŒï¼Œå…±åŒå‚ä¸çš„å·¥ä½œï¼Œä»»ä½•å•ä¸€éƒ¨é—¨éƒ½ä¸èƒ½å¯¹æ•°æ®åº“è¿›è¡Œä¼˜åŒ–ï¼</li><li>æ‰€ä»¥ä¼˜åŒ–å·¥ä½œ,æ˜¯ç”±ä¸šåŠ¡éœ€è¦é©±ä½¿çš„ï¼ï¼ï¼</li></ul><h4 id="ä¼˜åŒ–ç”±è°å‚ä¸">ä¼˜åŒ–ç”±è°å‚ä¸</h4><p>åœ¨è¿›è¡Œæ•°æ®åº“ä¼˜åŒ–æ—¶ï¼Œåº”ç”±æ•°æ®åº“ç®¡ç†å‘˜ã€ä¸šåŠ¡éƒ¨é—¨ä»£è¡¨ã€åº”ç”¨ç¨‹åºæ¶æ„å¸ˆã€åº”ç”¨ç¨‹åºè®¾è®¡äººå‘˜ã€åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ã€ç¡¬ä»¶åŠç³»ç»Ÿç®¡ç†å‘˜ã€å­˜å‚¨ç®¡ç†å‘˜ç­‰ï¼Œä¸šåŠ¡ç›¸å…³äººå‘˜å…±åŒå‚ä¸ã€‚</p><h3 id="ä¼˜åŒ–æ€è·¯">ä¼˜åŒ–æ€è·¯</h3><h4 id="ä¼˜åŒ–ä»€ä¹ˆ">ä¼˜åŒ–ä»€ä¹ˆ</h4><p>åœ¨æ•°æ®åº“ä¼˜åŒ–ä¸Šæœ‰ä¸¤ä¸ªä¸»è¦æ–¹é¢ï¼šå³å®‰å…¨ä¸æ€§èƒ½ã€‚</p><ul><li>å®‰å…¨ â€”&gt; æ•°æ®å¯æŒç»­æ€§</li><li>æ€§èƒ½ â€”&gt; æ•°æ®çš„é«˜æ€§èƒ½è®¿é—®</li></ul><h4 id="ä¼˜åŒ–çš„èŒƒå›´æœ‰å“ªäº›">ä¼˜åŒ–çš„èŒƒå›´æœ‰å“ªäº›</h4><p><em>å­˜å‚¨ã€ä¸»æœºå’Œæ“ä½œç³»ç»Ÿæ–¹é¢:</em></p><ul><li>ä¸»æœºæ¶æ„ç¨³å®šæ€§</li><li>I/O è§„åˆ’åŠé…ç½®</li><li>Swap äº¤æ¢åˆ†åŒº</li><li>OS å†…æ ¸å‚æ•°å’Œç½‘ç»œé—®é¢˜</li></ul><p><em>åº”ç”¨ç¨‹åºæ–¹é¢:</em></p><ul><li>åº”ç”¨ç¨‹åºç¨³å®šæ€§</li><li>SQLè¯­å¥æ€§èƒ½</li><li>ä¸²è¡Œè®¿é—®èµ„æº</li><li>æ€§èƒ½æ¬ ä½³ä¼šè¯ç®¡ç†</li><li>è¿™ä¸ªåº”ç”¨é€‚ä¸é€‚åˆç”¨ MySQL</li></ul><p><em>æ•°æ®åº“ä¼˜åŒ–æ–¹é¢:</em></p><ul><li>å†…å­˜</li><li>æ•°æ®åº“ç»“æ„(ç‰©ç†&amp;é€»è¾‘)</li><li>å®ä¾‹é…ç½®</li></ul><blockquote><p>è¯´æ˜ï¼šä¸ç®¡æ˜¯åœ¨ï¼Œè®¾è®¡ç³»ç»Ÿï¼Œå®šä½é—®é¢˜è¿˜æ˜¯ä¼˜åŒ–ï¼Œéƒ½å¯ä»¥æŒ‰ç…§è¿™ä¸ªé¡ºåºæ‰§è¡Œã€‚</p></blockquote><h4 id="ä¼˜åŒ–ç»´åº¦">ä¼˜åŒ–ç»´åº¦</h4><p><em>æ•°æ®åº“ä¼˜åŒ–ç»´åº¦æœ‰å››ä¸ª:</em></p><p>ç¡¬ä»¶ã€ç³»ç»Ÿé…ç½®ã€æ•°æ®åº“è¡¨ç»“æ„ã€SQLåŠç´¢å¼•</p><p><img src="https://images2017.cnblogs.com/blog/1190037/201801/1190037-20180108160315254-1073768194.png" alt=""></p><p><em>ä¼˜åŒ–é€‰æ‹©</em></p><ul><li>ä¼˜åŒ–æˆæœ¬:ç¡¬ä»¶&gt;ç³»ç»Ÿé…ç½®&gt;æ•°æ®åº“è¡¨ç»“æ„&gt;SQLåŠç´¢å¼•</li><li>ä¼˜åŒ–æ•ˆæœ:ç¡¬ä»¶&lt;ç³»ç»Ÿé…ç½®&lt;æ•°æ®åº“è¡¨ç»“æ„&lt;SQLåŠç´¢å¼•</li></ul><h3 id="ä¼˜åŒ–å·¥å…·æœ‰å•¥">ä¼˜åŒ–å·¥å…·æœ‰å•¥ï¼Ÿ</h3><h4 id="æ•°æ®åº“å±‚é¢">æ•°æ®åº“å±‚é¢</h4><p>æ£€æŸ¥é—®é¢˜å¸¸ç”¨å·¥å…·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">msyqladmin                                 mysqlå®¢æˆ·ç«¯ï¼Œå¯è¿›è¡Œç®¡ç†æ“ä½œ</span><br><span class="line">mysqlshow                                  åŠŸèƒ½å¼ºå¤§çš„æŸ¥çœ‹shellå‘½ä»¤</span><br><span class="line">show [SESSION | GLOBAL] variables          æŸ¥çœ‹æ•°æ®åº“å‚æ•°ä¿¡æ¯</span><br><span class="line">SHOW [SESSION | GLOBAL] STATUS             æŸ¥çœ‹æ•°æ®åº“çš„çŠ¶æ€ä¿¡æ¯</span><br><span class="line">information_schema                         è·å–å…ƒæ•°æ®çš„æ–¹æ³•</span><br><span class="line">SHOW ENGINE INNODB STATUS                  Innodbå¼•æ“çš„æ‰€æœ‰çŠ¶æ€</span><br><span class="line">SHOW PROCESSLIST                           æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿æ¥sessionçŠ¶æ€</span><br><span class="line">explain                                    è·å–æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</span><br><span class="line">show index                                 æŸ¥çœ‹è¡¨çš„ç´¢å¼•ä¿¡æ¯</span><br><span class="line">slow-log                                   è®°å½•æ…¢æŸ¥è¯¢è¯­å¥</span><br><span class="line">mysqldumpslow                              åˆ†æslowlogæ–‡ä»¶çš„</span><br></pre></td></tr></table></figure><p>ä¸å¸¸ç”¨ä½†å¥½ç”¨çš„å·¥å…·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zabbix                  ç›‘æ§ä¸»æœºã€ç³»ç»Ÿã€æ•°æ®åº“ï¼ˆéƒ¨ç½²zabbixç›‘æ§å¹³å°ï¼‰</span><br><span class="line">pt-query-digest         åˆ†ææ…¢æ—¥å¿—</span><br><span class="line">mysqlslap               åˆ†ææ…¢æ—¥å¿—</span><br><span class="line">sysbench                å‹åŠ›æµ‹è¯•å·¥å…·</span><br><span class="line">mysql profiling         ç»Ÿè®¡æ•°æ®åº“æ•´ä½“çŠ¶æ€å·¥å…·    </span><br><span class="line">Performance Schema      mysqlæ€§èƒ½çŠ¶æ€ç»Ÿè®¡çš„æ•°æ®</span><br><span class="line">workbench               ç®¡ç†ã€å¤‡ä»½ã€ç›‘æ§ã€åˆ†æã€ä¼˜åŒ–å·¥å…·ï¼ˆæ¯”è¾ƒè´¹èµ„æºï¼‰</span><br></pre></td></tr></table></figure><h4 id="æ•°æ®åº“å±‚é¢é—®é¢˜è§£å†³æ€è·¯">æ•°æ®åº“å±‚é¢é—®é¢˜è§£å†³æ€è·¯</h4><p><em>ä¸€èˆ¬åº”æ€¥è°ƒä¼˜çš„æ€è·¯ï¼š</em></p><p>é’ˆå¯¹çªç„¶çš„ä¸šåŠ¡åŠç†å¡é¡¿ï¼Œæ— æ³•è¿›è¡Œæ­£å¸¸çš„ä¸šåŠ¡å¤„ç†ï¼éœ€è¦ç«‹é©¬è§£å†³çš„åœºæ™¯ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1ã€show processlist</span><br><span class="line">2ã€explain  select id ,name from stu where name&#x3D;&#39;clsn&#39;; # ALL  id name age  sex</span><br><span class="line"></span><br><span class="line">            select id,name from stu  where id&#x3D;2-1 å‡½æ•° ç»“æœé›†&gt;30;</span><br><span class="line"></span><br><span class="line">ã€€ã€€ã€€ show index from table;</span><br><span class="line"></span><br><span class="line">3ã€é€šè¿‡æ‰§è¡Œè®¡åˆ’åˆ¤æ–­ï¼Œç´¢å¼•é—®é¢˜ï¼ˆæœ‰æ²¡æœ‰ã€åˆä¸åˆç†ï¼‰æˆ–è€…è¯­å¥æœ¬èº«é—®é¢˜</span><br><span class="line">4ã€show status  like &#39;%lock%&#39;;    # æŸ¥è¯¢é”çŠ¶æ€</span><br><span class="line">kill SESSION_ID;   # æ€æ‰æœ‰é—®é¢˜çš„session</span><br></pre></td></tr></table></figure><p><em>å¸¸è§„è°ƒä¼˜æ€è·¯ï¼š</em></p><p>é’ˆå¯¹ä¸šåŠ¡å‘¨æœŸæ€§çš„å¡é¡¿ï¼Œä¾‹å¦‚:åœ¨æ¯å¤© 10-11 ç‚¹ä¸šåŠ¡ç‰¹åˆ«æ…¢ï¼Œä½†æ˜¯è¿˜èƒ½å¤Ÿä½¿ç”¨ï¼Œè¿‡äº†è¿™æ®µæ—¶é—´å°±å¥½äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹ slowlogï¼Œåˆ†æ slowlogï¼Œåˆ†æå‡ºæŸ¥è¯¢æ…¢çš„è¯­å¥ã€‚</span><br><span class="line">2ã€æŒ‰ç…§ä¸€å®šä¼˜å…ˆçº§ï¼Œè¿›è¡Œä¸€ä¸ªä¸€ä¸ªçš„æ’æŸ¥æ‰€æœ‰æ…¢è¯­å¥ã€‚</span><br><span class="line">3ã€åˆ†æ top sqlï¼Œè¿›è¡Œ explain è°ƒè¯•ï¼ŒæŸ¥çœ‹è¯­å¥æ‰§è¡Œæ—¶é—´ã€‚</span><br><span class="line">4ã€è°ƒæ•´ç´¢å¼•æˆ–è¯­å¥æœ¬èº«ã€‚</span><br></pre></td></tr></table></figure><h4 id="ç³»ç»Ÿå±‚é¢">ç³»ç»Ÿå±‚é¢</h4><p><em>CPU æ–¹é¢</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmstatã€sar topã€htopã€nmonã€mpstat</span><br></pre></td></tr></table></figure><p><em>å†…å­˜</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free ã€ps -aux</span><br></pre></td></tr></table></figure><p><em>IOè®¾å¤‡ï¼ˆç£ç›˜ã€ç½‘ç»œï¼‰</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iostat ã€ ss  ã€ netstat ã€ iptrafã€iftopã€lsof</span><br></pre></td></tr></table></figure><p>vmstat å‘½ä»¤è¯´æ˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Procsï¼šr æ˜¾ç¤ºæœ‰å¤šå°‘è¿›ç¨‹æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ã€‚b æ˜¾ç¤ºå¤„äºä¸å¯ä¸­æ–­çš„ä¼‘çœ çš„è¿›ç¨‹æ•°é‡ã€‚åœ¨ç­‰å¾… I&#x2F;Oã€‚</span><br><span class="line">Memoryï¼šswpd æ˜¾ç¤ºè¢«äº¤æ¢åˆ°ç£ç›˜çš„æ•°æ®å—çš„æ•°é‡ã€‚æœªè¢«ä½¿ç”¨çš„æ•°æ®å—ï¼Œç”¨æˆ·ç¼“å†²æ•°æ®å—ï¼Œç”¨äºæ“ä½œç³»ç»Ÿçš„æ•°æ®å—çš„æ•°é‡ã€‚</span><br><span class="line">Swapï¼šæ“ä½œç³»ç»Ÿæ¯ç§’ä»ç£ç›˜ä¸Šäº¤æ¢åˆ°å†…å­˜å’Œä»å†…å­˜äº¤æ¢åˆ°ç£ç›˜çš„æ•°æ®å—çš„æ•°é‡ã€‚s1 å’Œ s0 æœ€å¥½æ˜¯ 0ã€‚</span><br><span class="line">Ioï¼šæ¯ç§’ä»è®¾å¤‡ä¸­è¯»å…¥ b1 çš„å†™å…¥åˆ°è®¾å¤‡ b0 çš„æ•°æ®å—çš„æ•°é‡ã€‚åæ˜ äº†ç£ç›˜ I&#x2F;Oã€‚</span><br><span class="line">Systemï¼šæ˜¾ç¤ºäº†æ¯ç§’å‘ç”Ÿä¸­æ–­çš„æ•°é‡ (in) å’Œä¸Šä¸‹æ–‡äº¤æ¢ (cs) çš„æ•°é‡ã€‚</span><br><span class="line">Cpuï¼šæ˜¾ç¤ºç”¨äºè¿è¡Œç”¨æˆ·ä»£ç ï¼Œç³»ç»Ÿä»£ç ï¼Œç©ºé—²ï¼Œç­‰å¾… I&#x2F;O çš„ CPU æ—¶é—´ã€‚</span><br></pre></td></tr></table></figure><p>iostat å‘½ä»¤è¯´æ˜:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å®ä¾‹å‘½ä»¤ï¼š  iostat -dk 1 5</span><br><span class="line">ã€€ã€€ã€€ã€€    iostat -d -k -x 5 ï¼ˆæŸ¥çœ‹è®¾å¤‡ä½¿ç”¨ç‡ï¼ˆ%utilï¼‰å’Œå“åº”æ—¶é—´ï¼ˆawaitï¼‰ï¼‰</span><br><span class="line"></span><br><span class="line">tpsï¼šè¯¥è®¾å¤‡æ¯ç§’çš„ä¼ è¾“æ¬¡æ•°ã€‚â€œä¸€æ¬¡ä¼ è¾“â€æ„æ€æ˜¯â€œä¸€æ¬¡I&#x2F;Oè¯·æ±‚â€ã€‚å¤šä¸ªé€»è¾‘è¯·æ±‚å¯èƒ½ä¼šè¢«åˆå¹¶ä¸ºâ€œä¸€æ¬¡I&#x2F;Oè¯·æ±‚â€ã€‚</span><br><span class="line">iops ï¼šç¡¬ä»¶å‡ºå‚çš„æ—¶å€™ï¼Œå‚å®¶å®šä¹‰çš„ä¸€ä¸ªæ¯ç§’æœ€å¤§çš„ IO æ¬¡æ•°ã€‚</span><br><span class="line">&quot;ä¸€æ¬¡ä¼ è¾“&quot;è¯·æ±‚çš„å¤§å°æ˜¯æœªçŸ¥çš„ã€‚</span><br><span class="line">kB_read&#x2F;sï¼šæ¯ç§’ä»è®¾å¤‡ï¼ˆdrive expressedï¼‰è¯»å–çš„æ•°æ®é‡ã€‚</span><br><span class="line">KB_wrtn&#x2F;sï¼šæ¯ç§’å‘è®¾å¤‡ï¼ˆdrive expressedï¼‰å†™å…¥çš„æ•°æ®é‡ã€‚</span><br><span class="line">kB_readï¼šè¯»å–çš„æ€»æ•°æ®é‡ã€‚</span><br><span class="line">kB_wrtnï¼šå†™å…¥çš„æ€»æ•°é‡æ•°æ®é‡ï¼Œè¿™äº›å•ä½éƒ½ä¸ºKilobytesã€‚</span><br></pre></td></tr></table></figure><h4 id="ç³»ç»Ÿå±‚é¢é—®é¢˜è§£å†³åŠæ³•">ç³»ç»Ÿå±‚é¢é—®é¢˜è§£å†³åŠæ³•</h4><p>ä½ è®¤ä¸ºåˆ°åº•è´Ÿè½½é«˜å¥½ï¼Œè¿˜æ˜¯ä½å¥½å‘¢ï¼Ÿ</p><p>åœ¨å®é™…çš„ç”Ÿäº§ä¸­ï¼Œä¸€èˆ¬è®¤ä¸º Cpu åªè¦ä¸è¶…è¿‡ 90% éƒ½æ²¡ä»€ä¹ˆé—®é¢˜ ã€‚</p><p>å½“ç„¶ä¸æ’é™¤ä¸‹é¢è¿™äº›ç‰¹æ®Šæƒ…å†µï¼š</p><ul><li>é—®é¢˜ä¸€ï¼šCpu è´Ÿè½½é«˜ï¼ŒIO è´Ÿè½½ä½</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å†…å­˜ä¸å¤Ÿ</span><br><span class="line"></span><br><span class="line">ç£ç›˜æ€§èƒ½å·®</span><br><span class="line"></span><br><span class="line">1. SQL é—®é¢˜ ------&gt; å»æ•°æ®åº“å±‚ï¼Œè¿›ä¸€æ­¥æ’æŸ¥ SQL é—®é¢˜</span><br><span class="line">2. IO å‡ºé—®é¢˜äº†ï¼ˆç£ç›˜åˆ°ä¸´ç•Œäº†ã€Raid è®¾è®¡ä¸å¥½ã€Raid é™çº§ã€é”ã€åœ¨å•ä½æ—¶é—´å†… TPS è¿‡é«˜ï¼‰</span><br><span class="line">3. TPS è¿‡é«˜: å¤§é‡çš„å°æ•°æ® IOã€å¤§é‡çš„å…¨è¡¨æ‰«æ</span><br></pre></td></tr></table></figure><ul><li>é—®é¢˜äºŒï¼šIO è´Ÿè½½é«˜ï¼ŒCpu è´Ÿè½½ä½</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å¤§é‡å°çš„ IO å†™æ“ä½œï¼š</span><br><span class="line"></span><br><span class="line">1. autocommit   ï¼Œäº§ç”Ÿå¤§é‡å° IO</span><br><span class="line">2. IO&#x2F;PS,ç£ç›˜çš„ä¸€ä¸ªå®šå€¼ï¼Œç¡¬ä»¶å‡ºå‚çš„æ—¶å€™ï¼Œå‚å®¶å®šä¹‰çš„ä¸€ä¸ªæ¯ç§’æœ€å¤§çš„ IO æ¬¡æ•°ã€‚</span><br><span class="line"></span><br><span class="line">å¤§é‡å¤§çš„IO å†™æ“ä½œ</span><br><span class="line"></span><br><span class="line">1. SQLé—®é¢˜çš„å‡ ç‡æ¯”è¾ƒå¤§</span><br></pre></td></tr></table></figure><ul><li>é—®é¢˜ä¸‰ï¼šIO å’Œ Cpu è´Ÿè½½éƒ½å¾ˆé«˜</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1. ç¡¬ä»¶ä¸å¤Ÿäº†æˆ– SQL å­˜åœ¨é—®é¢˜</span><br></pre></td></tr></table></figure><h3 id="åŸºç¡€ä¼˜åŒ–">åŸºç¡€ä¼˜åŒ–</h3><h4 id="ä¼˜åŒ–æ€è·¯">ä¼˜åŒ–æ€è·¯</h4><p><em>å®šä½é—®é¢˜ç‚¹å®å¸</em></p><p>ç¡¬ä»¶ --&gt; ç³»ç»Ÿ --&gt; åº”ç”¨ --&gt; æ•°æ®åº“ --&gt; æ¶æ„ï¼ˆé«˜å¯ç”¨ã€è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ï¼‰</p><p><em>å¤„ç†æ–¹å‘</em></p><p>æ˜ç¡®ä¼˜åŒ–ç›®æ ‡ã€æ€§èƒ½å’Œå®‰å…¨çš„æŠ˜ä¸­ã€é˜²æ‚£æœªç„¶ã€‚</p><h4 id="ç¡¬ä»¶ä¼˜åŒ–">ç¡¬ä»¶ä¼˜åŒ–</h4><ul><li>ä¸»æœºæ–¹é¢ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ ¹æ®æ•°æ®åº“ç±»å‹ï¼Œä¸»æœº CPU é€‰æ‹©ã€å†…å­˜å®¹é‡é€‰æ‹©ã€ç£ç›˜é€‰æ‹©ï¼š</span><br><span class="line"></span><br><span class="line">1. å¹³è¡¡å†…å­˜å’Œç£ç›˜èµ„æºã€‚</span><br><span class="line">2. éšæœºçš„ I&#x2F;O å’Œé¡ºåºçš„ I&#x2F;Oã€‚</span><br><span class="line">3. ä¸»æœº RAIDå¡çš„ BBU (Battery Backup Unit) å…³é—­ã€‚</span><br></pre></td></tr></table></figure><ul><li>Cpu çš„é€‰æ‹©ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cpu çš„ä¸¤ä¸ªå…³é”®å› ç´ ï¼šæ ¸æ•°ã€ä¸»é¢‘ï¼Œæ ¹æ®ä¸åŒçš„ä¸šåŠ¡ç±»å‹è¿›è¡Œé€‰æ‹©ï¼š</span><br><span class="line"></span><br><span class="line">1. Cpu å¯†é›†å‹ï¼šè®¡ç®—æ¯”è¾ƒå¤šï¼ŒOLTP--&gt;ä¸»é¢‘å¾ˆé«˜çš„ Cpuã€æ ¸æ•°è¿˜è¦å¤šã€‚</span><br><span class="line">2. IO å¯†é›†å‹ï¼šæŸ¥è¯¢æ¯”è¾ƒå¤šï¼ŒOLAP--&gt;æ ¸æ•°è¦å¤šï¼Œä¸»é¢‘ä¸ä¸€å®šé«˜çš„ã€‚</span><br></pre></td></tr></table></figure><ul><li>å†…å­˜çš„é€‰æ‹©ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. OLAP ç±»å‹æ•°æ®åº“ï¼Œéœ€è¦æ›´å¤šå†…å­˜ï¼Œå’Œæ•°æ®è·å–é‡çº§æœ‰å…³ã€‚</span><br><span class="line">2. OLTP ç±»å‹æ•°æ®ä¸€èˆ¬å†…å­˜æ˜¯ Cpu æ ¸å¿ƒæ•°é‡çš„ 2 å€åˆ° 4 å€ï¼Œæ²¡æœ‰æœ€ä½³å®è·µã€‚</span><br></pre></td></tr></table></figure><ul><li>å­˜å‚¨æ–¹é¢ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. æ ¹æ®å­˜å‚¨æ•°æ®ç§ç±»çš„ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„å­˜å‚¨è®¾å¤‡ã€‚</span><br><span class="line">2. é…ç½®åˆç†çš„ RAID çº§åˆ«(Raid5ã€Raid10ã€çƒ­å¤‡ç›˜)ã€‚</span><br><span class="line">3. å¯¹äºæ“ä½œç³»ç»Ÿæ¥è®²ï¼Œä¸éœ€è¦å¤ªç‰¹æ®Šçš„é€‰æ‹©ï¼Œæœ€å¥½åšå¥½å†—ä½™ï¼ˆRaid 1ï¼‰ï¼ˆSSDã€SAS ã€SATAï¼‰</span><br><span class="line">4. Raidå¡ï¼šä¸»æœº Raid å¡é€‰æ‹©ï¼š</span><br><span class="line">  4.1 å®ç°æ“ä½œç³»ç»Ÿç£ç›˜çš„å†—ä½™ï¼ˆRaid 1ï¼‰ã€‚</span><br><span class="line">  4.2 å¹³è¡¡å†…å­˜å’Œç£ç›˜èµ„æºã€‚</span><br><span class="line">  4.3  éšæœºçš„ I&#x2F;O å’Œé¡ºåºçš„ I&#x2F;Oã€‚</span><br><span class="line">  4.4 ä¸»æœº Raidå¡çš„ BBU (Battery Backup Unit) è¦å…³é—­ã€‚</span><br></pre></td></tr></table></figure><ul><li>ç½‘ç»œè®¾å¤‡æ–¹é¢ï¼š</li></ul><p>ä½¿ç”¨æµé‡æ”¯æŒæ›´é«˜çš„ç½‘ç»œè®¾å¤‡ï¼ˆäº¤æ¢æœºã€è·¯ç”±å™¨ã€ç½‘çº¿ã€ç½‘å¡ã€HBAå¡ï¼‰ã€‚</p><blockquote><p>æ³¨æ„ï¼šä»¥ä¸Šè¿™äº›è§„åˆ’åº”è¯¥åœ¨åˆå§‹è®¾è®¡ç³»ç»Ÿæ—¶å°±åº”è¯¥è€ƒè™‘å¥½ã€‚</p></blockquote><h4 id="æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–">æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç‰©ç†çŠ¶æ€ç¯ã€‚</span><br><span class="line">2ã€è‡ªå¸¦ç®¡ç†è®¾å¤‡ï¼šè¿œç¨‹æ§åˆ¶å¡ï¼ˆFENCE è®¾å¤‡ï¼šIPMIã€ILOã€IDARCï¼‰ï¼Œå¼€å…³æœºã€ç¡¬ä»¶ç›‘æ§ã€‚</span><br><span class="line">3ã€ç¬¬ä¸‰æ–¹çš„ç›‘æ§è½¯ä»¶ã€è®¾å¤‡ï¼ˆSnmpã€Agentï¼‰å¯¹ç‰©ç†è®¾æ–½è¿›è¡Œç›‘æ§ã€‚</span><br><span class="line">4ã€å­˜å‚¨è®¾å¤‡ï¼šè‡ªå¸¦çš„ç›‘æ§å¹³å°ã€‚EMC2ï¼ˆHP æ”¶è´­äº†ï¼‰ã€æ—¥ç«‹ï¼ˆhdsï¼‰ã€IBMä½ç«¯ OEM hdsï¼Œé«˜ç«¯å­˜å‚¨æ˜¯è‡ªå·±æŠ€æœ¯ï¼Œåä¸ºå­˜å‚¨ã€‚</span><br></pre></td></tr></table></figure><h4 id="ç³»ç»Ÿä¼˜åŒ–">ç³»ç»Ÿä¼˜åŒ–</h4><ul><li>Cpuï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1. åŸºæœ¬ä¸éœ€è¦è°ƒæ•´ï¼Œåœ¨ç¡¬ä»¶é€‰æ‹©æ–¹é¢ä¸‹åŠŸå¤«å³å¯ã€‚</span><br></pre></td></tr></table></figure><ul><li>å†…å­˜ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1. åŸºæœ¬ä¸éœ€è¦è°ƒæ•´ï¼Œåœ¨ç¡¬ä»¶é€‰æ‹©æ–¹é¢ä¸‹åŠŸå¤«å³å¯ã€‚</span><br></pre></td></tr></table></figure><ul><li>Swapï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. MySQL å°½é‡é¿å…ä½¿ç”¨ Swapã€‚</span><br><span class="line">2. é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ä¸­é»˜è®¤swapä¸º0</span><br></pre></td></tr></table></figure><ul><li>IO ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1. Raidã€No LVMã€ Ext 4æˆ– XFSã€SSDã€IO è°ƒåº¦ç­–ç•¥ã€‚</span><br></pre></td></tr></table></figure><ul><li>Swap è°ƒæ•´æ–¹æ³•</li></ul><p>è¦å…³é—­ Swap åˆ†åŒºï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•</p><ol><li>ä¸´æ—¶å…³é—­æ–¹æ³•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹ /proc/sys/vm/swappiness çš„å†…å®¹æ”¹æˆ 0 ã€‚</span><br></pre></td></tr></table></figure><ol start="2"><li>æ°¸ä¹…å…³é—­æ–¹æ³•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sysctl.conf æ–‡ä»¶ä¸­æ·»åŠ  vm.swappiness=0 ã€‚</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‚æ•°å†³å®šäº† Linux æ˜¯å€¾å‘äºä½¿ç”¨ Swapï¼Œè¿˜æ˜¯å€¾å‘äºé‡Šæ”¾æ–‡ä»¶ç³»ç»Ÿ Cacheã€‚åœ¨å†…å­˜ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œæ•°å€¼è¶Šä½è¶Šå€¾å‘äºé‡Šæ”¾æ–‡ä»¶ç³»ç»ŸCacheã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªå‚æ•°åªèƒ½å‡å°‘ä½¿ç”¨ Swap çš„æ¦‚ç‡ï¼Œå¹¶ä¸èƒ½é¿å… Linux ä½¿ç”¨ Swapã€‚</p><ul><li>å¼€å¯ O_DIRECT æ¨¡å¼</li></ul><p>ä¿®æ”¹ MySQL çš„é…ç½®å‚æ•° innodb_flush_methodï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒInnoDB çš„ Buffer Pool ä¼šç›´æ¥ç»•è¿‡æ–‡ä»¶ç³»ç»Ÿ Cache æ¥è®¿é—®ç£ç›˜ï¼Œä½†æ˜¯ Redo log ä¾æ—§ä¼šä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿ Cacheã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒRedo log æ˜¯è¦†å†™æ¨¡å¼çš„ï¼Œå³ä½¿ä½¿ç”¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ Cacheï¼Œä¹Ÿä¸ä¼šå ç”¨å¤ªå¤šã€‚</p><ul><li>IO è°ƒåº¦ç­–ç•¥</li></ul><ol><li>ä¸´æ—¶ä¿®æ”¹ä¸º deadline</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo deadline&gt;&#x2F;sys&#x2F;block&#x2F;sda&#x2F;queue&#x2F;scheduler</span><br></pre></td></tr></table></figure><ol start="2"><li>æ°¸ä¹…ä¿®æ”¹</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vi /boot/grub/grub.conf</span><br><span class="line"></span><br><span class="line">æ›´æ”¹åˆ°å¦‚ä¸‹å†…å®¹:</span><br><span class="line"></span><br><span class="line">kernel /boot/vmlinuz-2.6.18-8.el5 ro root=LABEL=/ elevator=deadline rhgb quiet</span><br></pre></td></tr></table></figure><h4 id="ç³»ç»Ÿå‚æ•°è°ƒæ•´">ç³»ç»Ÿå‚æ•°è°ƒæ•´</h4><p><em>Linux ç³»ç»Ÿå†…æ ¸å‚æ•°ä¼˜åŒ–</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/sysctl.conf</span><br><span class="line"><span class="comment"># ç”¨æˆ·ç«¯å£èŒƒå›´</span></span><br><span class="line">net.ipv4.ip_local_port_range = 1024 65535  </span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 4096 </span><br><span class="line">net.ipv4.tcp_fin_timeout = 30 </span><br><span class="line"><span class="comment"># ç³»ç»Ÿæœ€å¤§æ–‡ä»¶å¥æŸ„ï¼Œæ§åˆ¶çš„æ˜¯èƒ½æ‰“å¼€æ–‡ä»¶æœ€å¤§æ•°é‡</span></span><br><span class="line">fs.file-max=65535</span><br></pre></td></tr></table></figure><p><em>ç”¨æˆ·é™åˆ¶å‚æ•°</em></p><p>ï¼ˆMySQL å¯ä»¥ä¸è®¾ç½®ä»¥ä¸‹é…ç½®ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim    &#x2F;etc&#x2F;security&#x2F;limits.conf </span><br><span class="line">    * soft nproc 65535</span><br><span class="line">    * hard nproc 65535</span><br><span class="line">    * soft nofile 65535</span><br><span class="line">    * hard nofile 65535</span><br></pre></td></tr></table></figure><h4 id="åº”ç”¨ä¼˜åŒ–">åº”ç”¨ä¼˜åŒ–</h4><ol><li>ä¸šåŠ¡åº”ç”¨å’Œæ•°æ®åº“åº”ç”¨ç‹¬ç«‹ã€‚</li><li>å®‰è£…å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ä¸è¦å¯åŠ¨å›¾å½¢ç•Œé¢  runlevel 3 ã€‚</li><li>é˜²ç«å¢™ï¼šIptablesã€Selinux ç­‰å…¶ä»–æ— ç”¨æœåŠ¡(å…³é—­)ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --level 23456 acpid off</span><br><span class="line">chkconfig --level 23456 anacron off</span><br><span class="line">chkconfig --level 23456 autofs off</span><br><span class="line">chkconfig --level 23456 avahi-daemon off</span><br><span class="line">chkconfig --level 23456 bluetooth off</span><br><span class="line">chkconfig --level 23456 cups off</span><br><span class="line">chkconfig --level 23456 firstboot off</span><br><span class="line">chkconfig --level 23456 haldaemon off</span><br><span class="line">chkconfig --level 23456 hplip off</span><br><span class="line">chkconfig --level 23456 ip6tables off</span><br><span class="line">chkconfig --level 23456 iptables  off</span><br><span class="line">chkconfig --level 23456 isdn off</span><br><span class="line">chkconfig --level 23456 pcscd off</span><br><span class="line">chkconfig --level 23456 sendmail  off</span><br><span class="line">chkconfig --level 23456 yum-updatesd  off</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œæ€è€ƒå°†æ¥æˆ‘ä»¬çš„ä¸šåŠ¡æ˜¯å¦çœŸçš„éœ€è¦ MySQLï¼Œè¿˜æ˜¯ä½¿ç”¨å…¶ä»–ç§ç±»çš„æ•°æ®åº“ã€‚ç”¨æ•°æ®åº“çš„æœ€é«˜å¢ƒç•Œå°±æ˜¯ä¸ç”¨æ•°æ®åº“ã€‚</p><h3 id="æ•°æ®åº“ä¼˜åŒ–">æ•°æ®åº“ä¼˜åŒ–</h3><p>SQLä¼˜åŒ–æ–¹å‘ï¼šæ‰§è¡Œè®¡åˆ’ã€ç´¢å¼•ã€SQL æ”¹å†™ã€‚</p><p>æ¶æ„ä¼˜åŒ–æ–¹å‘ï¼šé«˜å¯ç”¨æ¶æ„ã€é«˜æ€§èƒ½æ¶æ„ã€åˆ†åº“åˆ†è¡¨ã€‚</p><h4 id="æ•°æ®åº“å‚æ•°ä¼˜åŒ–">æ•°æ®åº“å‚æ•°ä¼˜åŒ–</h4><ol><li>å®ä¾‹æ•´ä½“ï¼ˆé«˜çº§ä¼˜åŒ–ï¼Œæ‰©å±•ï¼‰</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">thread_concurrency       # å¹¶å‘çº¿ç¨‹æ•°é‡ä¸ªæ•°</span><br><span class="line">sort_buffer_size         # æ’åºç¼“å­˜</span><br><span class="line">read_buffer_size         # é¡ºåºè¯»å–ç¼“å­˜</span><br><span class="line">read_rnd_buffer_size     # éšæœºè¯»å–ç¼“å­˜</span><br><span class="line">key_buffer_size          # ç´¢å¼•ç¼“å­˜</span><br><span class="line">thread_cache_size        # (1Gâ€”&gt;8, 2Gâ€”&gt;16, 3Gâ€”&gt;32, &gt;3Gâ€”&gt;64)</span><br></pre></td></tr></table></figure><ol start="2"><li><p>è¿æ¥å±‚ï¼ˆåŸºç¡€ä¼˜åŒ–ï¼‰</p><p>è®¾ç½®åˆç†çš„è¿æ¥å®¢æˆ·å’Œè¿æ¥æ–¹å¼</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">max_connections           # æœ€å¤§è¿æ¥æ•°ï¼Œçœ‹äº¤æ˜“ç¬”æ•°è®¾ç½®    </span><br><span class="line">max_connect_errors        # æœ€å¤§é”™è¯¯è¿æ¥æ•°ï¼Œèƒ½å¤§åˆ™å¤§</span><br><span class="line">connect_timeout           # è¿æ¥è¶…æ—¶</span><br><span class="line">max_user_connections      # æœ€å¤§ç”¨æˆ·è¿æ¥æ•°</span><br><span class="line">skip-name-resolve         # è·³è¿‡åŸŸåè§£æ</span><br><span class="line">wait_timeout              # ç­‰å¾…è¶…æ—¶</span><br><span class="line">back_log                  # å¯ä»¥åœ¨å †æ ˆä¸­çš„è¿æ¥æ•°é‡</span><br></pre></td></tr></table></figure><ol start="3"><li>SQLå±‚ï¼ˆåŸºç¡€ä¼˜åŒ–ï¼‰</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query_cache_sizeï¼š æŸ¥è¯¢ç¼“å­˜   &gt;&gt;&gt;  OLAPç±»å‹æ•°æ®åº“,éœ€è¦é‡ç‚¹åŠ å¤§æ­¤å†…å­˜ç¼“å­˜ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ä¼šè¶…è¿‡GBã€‚å¯¹äºç»å¸¸è¢«ä¿®æ”¹çš„æ•°æ®ï¼Œç¼“å­˜ä¼šç«‹é©¬å¤±æ•ˆã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼ˆRedisã€Memecacheï¼‰ï¼Œæ›¿ä»£å®ƒçš„ç›¸åº”åŠŸèƒ½ã€‚</span><br></pre></td></tr></table></figure><h4 id="å­˜å‚¨å¼•æ“å±‚-innodb-åŸºç¡€ä¼˜åŒ–å‚æ•°">å­˜å‚¨å¼•æ“å±‚ï¼ˆ Innodb åŸºç¡€ä¼˜åŒ–å‚æ•°ï¼‰</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">default-storage-engine</span><br><span class="line">innodb_buffer_pool_size       # æ²¡æœ‰å›ºå®šå¤§å°ï¼Œ50% æµ‹è¯•å€¼ï¼Œçœ‹çœ‹æƒ…å†µå†å¾®è°ƒã€‚ä½†æ˜¯å°½é‡è®¾ç½®ä¸è¦è¶…è¿‡ç‰©ç†å†…å­˜ 70%ã€‚</span><br><span class="line">innodb_file_per_table&#x3D;(1,0)</span><br><span class="line">innodb_flush_log_at_trx_commit&#x3D;(0,1,2) # 1 æ˜¯æœ€å®‰å…¨çš„ï¼Œ0 æ˜¯æ€§èƒ½æœ€é«˜ï¼Œ2æŠ˜ä¸­ã€‚</span><br><span class="line">binlog_sync</span><br><span class="line">Innodb_flush_method&#x3D;(O_DIRECT, fdatasync)</span><br><span class="line">innodb_log_buffer_size        # 100M ä»¥ä¸‹ã€‚</span><br><span class="line">innodb_log_file_size          # 100M ä»¥ä¸‹ã€‚</span><br><span class="line">innodb_log_files_in_group     # 5ä¸ªæˆå‘˜ä»¥ä¸‹,ä¸€èˆ¬ 2-3 ä¸ªå¤Ÿç”¨ï¼ˆiblogfile 0-Nï¼‰ã€‚</span><br><span class="line">innodb_max_dirty_pages_pct   # è¾¾åˆ°ç™¾åˆ†ä¹‹ 75 çš„æ—¶å€™åˆ·å†™å†…å­˜è„é¡µåˆ°ç£ç›˜ã€‚</span><br><span class="line">log_bin</span><br><span class="line">max_binlog_cache_size         # å¯ä»¥ä¸è®¾ç½®ã€‚</span><br><span class="line">max_binlog_size               # å¯ä»¥ä¸è®¾ç½®ã€‚</span><br><span class="line">innodb_additional_mem_pool_size    #å°äº2Gå†…å­˜çš„æœºå™¨ï¼Œæ¨èå€¼æ˜¯ 20 Mã€‚32G å†…å­˜ä»¥ä¸Š 100Mã€‚</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><p>[1]  <a href="https://www.cnblogs.com/zishengY/p/6892345.html" target="_blank" rel="noopener">https://www.cnblogs.com/zishengY/p/6892345.html</a><br>[2]  <a href="https://www.jianshu.com/p/d7665192aaaf" target="_blank" rel="noopener">https://www.jianshu.com/p/d7665192aaaf</a></p></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;div id=&quot;vip-container&quot;&gt;&lt;p&gt;åœ¨è¿›è¡Œ MySQL çš„ä¼˜åŒ–ä¹‹å‰å¿…é¡»è¦äº†è§£çš„å°±æ˜¯ MySQL çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œå¾ˆå¤šçš„æŸ¥è¯¢ä¼˜åŒ–å·¥ä½œå®é™…ä¸Šå°±æ˜¯éµå¾ªä¸€äº›åŸåˆ™è®© MySQL çš„ä¼˜åŒ–å™¨èƒ½å¤ŸæŒ‰ç…§é¢„æƒ³çš„åˆç†æ–¹å¼è¿è¡Œè€Œå·²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img
        
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="MySQL" scheme="https://www.hi-linux.com/tags/MySQL/"/>
    
  </entry>
  
</feed>
