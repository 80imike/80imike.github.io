<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¥‡å¦™çš„ Linux ä¸–ç•Œ</title>
  
  <subtitle>ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.hi-linux.com/"/>
  <updated>2021-04-22T01:29:09.383Z</updated>
  <id>https://www.hi-linux.com/</id>
  
  <author>
    <name>Mike</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ¨èä¸€æ¬¾ Kubernetes åº”ç”¨æ€§èƒ½åˆ†æå·¥å…· Kubectl Flame</title>
    <link href="https://www.hi-linux.com/posts/55077.html"/>
    <id>https://www.hi-linux.com/posts/55077.html</id>
    <published>2021-04-22T01:00:00.000Z</published>
    <updated>2021-04-22T01:29:09.383Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2><span id="ä»€ä¹ˆæ˜¯æ€§èƒ½åˆ†æ">ä»€ä¹ˆæ˜¯æ€§èƒ½åˆ†æï¼Ÿ</span></h2><p>æ€§èƒ½åˆ†ææ˜¯åˆ†æåº”ç”¨ç¨‹åºæ€§èƒ½æ¥æ”¹è¿›ä»£ç è´¨é‡çš„å¸¸ç”¨æ–¹æ³•ï¼Œæœ€æµè¡Œçš„å¯è§†åŒ–æ€§èƒ½åˆ†ææ–¹æ³•æ˜¯ç”Ÿæˆç«ç„°å›¾ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/640-2021-03-12-ogeYMt.jpg" alt></p><p>åŸºäº Spring æ¡†æ¶çš„ Java åº”ç”¨çš„ç«ç„°å›¾</p><p>yè½´æ˜¯å †æ ˆæ·±åº¦ï¼Œxè½´è·¨è¶Šæ ·æœ¬æ€»ä½“ã€‚æ¯ä¸ªçŸ©å½¢éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­å®½åº¦æ˜¾ç¤ºå®ƒå‡ºç°çš„é¢‘ç‡ï¼Œä»å·¦åˆ°å³çš„æ’åºå¹¶ä¸é‡è¦ (å †æ ˆæŒ‰å­—æ¯é¡ºåºæ’åº)ã€‚</p><h2><span id="kubernetes-ä¸Šçš„æ€§èƒ½åˆ†æ">Kubernetes ä¸Šçš„æ€§èƒ½åˆ†æ</span></h2><p>æ€§èƒ½åˆ†ææ˜¯ä¸€é¡¹è¾ƒä¸ºå¤æ‚çš„ä»»åŠ¡ï¼Œå¤§å¤šæ•°æ¢æŸ¥å™¨æœ‰ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š</p><ul><li>éœ€è¦ä¿®æ”¹åº”ç”¨ç¨‹åºï¼Œé€šå¸¸å¯ä»¥é€šè¿‡å°†æ ‡å¿—æ·»åŠ åˆ°æ‰§è¡Œå‘½ä»¤æˆ–å°†ä¸€äº›æ€§èƒ½åˆ†æåº“å¯¼å…¥ä»£ç ä¸­æ¥å®ç°ã€‚</li><li>ç”±äºåœ¨åˆ†æè¿‡ç¨‹ä¸­ä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼Œå› æ­¤é€šå¸¸é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œæ€§èƒ½åˆ†æã€‚</li></ul><p>é€‰æ‹©æ­£ç¡®çš„æ¢æŸ¥å™¨å¯èƒ½ä¼šè§£å†³è¿™äº›é—®é¢˜ï¼Œä½†æ˜¯è¿™éœ€è¦ä»”ç»†å»è¿›è¡Œç ”ç©¶ï¼Œå¹¶ä¸”é€šå¸¸å–å†³äºç¼–ç¨‹è¯­è¨€å’Œæ“ä½œç³»ç»Ÿã€‚</p><p>åœ¨ Kubernetes é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œåˆ†ææ—¶ï¼Œä¼šå˜å¾—æ›´åŠ å›°éš¾ã€‚éœ€è¦éƒ¨ç½²ä¸€ä¸ªåŒ…å«é…ç½®æ–‡ä»¶ä¿®æ”¹çš„æ–°å®¹å™¨é•œåƒï¼Œè€Œä¸æ˜¯å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚æ­¤å¤–ï¼Œå½“åº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨æ—¶ï¼ŒæŸäº›æ€§èƒ½é—®é¢˜å¯èƒ½ä¼šæ¶ˆå¤±ï¼Œè¿™å°±ä½¿å¾—è°ƒè¯•å˜å¾—å›°éš¾ã€‚</p><a id="more"></a><h2><span id="kubectl-flame">Kubectl flame</span></h2><p>Kubectl Flame æ˜¯ä¸€ä¸ª kubectl æ’ä»¶ï¼Œå¯ä»¥ä»¥è¾ƒä½çš„å¼€é”€ç”Ÿæˆç«ç„°å›¾ğŸ”¥æ¥åˆ†æåº”ç”¨ç¨‹åºæ€§èƒ½ï¼Œæ— éœ€è¿›è¡Œä»»ä½•åº”ç”¨ç¨‹åºä¿®æ”¹æˆ–åœæœºã€‚</p><blockquote><p>é¡¹ç›®ä»“åº“åœ°å€ï¼š<a href="https://github.com/VerizonMedia/kubectl-flame" target="_blank" rel="noopener">https://github.com/VerizonMedia/kubectl-flame</a></p></blockquote><h3><span id="å®‰è£…">å®‰è£…</span></h3><p>å¯ä»¥é€šè¿‡ Krew æ¥å®‰è£… <code>kubectl flame</code> æ’ä»¶ï¼Œä¸€æ—¦å®‰è£…äº† Krewï¼Œå°±å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl krew install flame</span><br></pre></td></tr></table></figure><h3><span id="ä½¿ç”¨è¦æ±‚">ä½¿ç”¨è¦æ±‚</span></h3><ul><li>æ”¯æŒçš„è¯­è¨€ï¼šGoã€Javaï¼ˆä»»ä½•åŸºäºJVMçš„è¯­è¨€ï¼‰ã€Python å’Œ Ruby</li><li>ä½¿ç”¨ Docker ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶çš„ Kubernetes é›†ç¾¤ï¼ˆå·²åœ¨ GKEï¼ŒEKS å’Œ AKS ä¸Šæµ‹è¯•ï¼‰</li></ul><h3><span id="è¿è¡ŒåŸç†">è¿è¡ŒåŸç†</span></h3><p><code>kubectl-flame</code> é€šè¿‡åœ¨ä¸ç›®æ ‡å®¹å™¨ç›¸åŒçš„èŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ªæ¢æŸ¥å™¨æ¥å¯åŠ¨æ€§èƒ½åˆ†æï¼Œå¤§å¤šæ•°æ¢æŸ¥å™¨å°†ä¸ç›®æ ‡å®¹å™¨å…±äº«ä¸€äº›èµ„æºï¼šæ¯”å¦‚é€šè¿‡å°† <code>hostPID</code> è®¾ç½®ä¸º true æ¥å¯ç”¨ PID å‘½åç©ºé—´å…±äº«ï¼Œé€šè¿‡æŒ‚è½½ <code>/var/lib/docker</code> å¹¶æŸ¥è¯¢ overlayFS æ¥å¯ç”¨æ–‡ä»¶ç³»ç»Ÿå…±äº«ã€‚</p><p>åœ¨åå°<code>kubectl-flame</code>ä½¿ç”¨ async-profiler æ¥ä¸º Java åº”ç”¨ç¨‹åºç”Ÿæˆç«ç„°å›¾ï¼Œé€šè¿‡å…±äº«<code>/tmp</code>æ–‡ä»¶å¤¹ä¸ç›®æ ‡ JVM è¿›è¡Œäº¤äº’ï¼ŒGolang åˆ™æ”¯æŒåŸºäº ebpf åˆ†æï¼ŒPython æ”¯æŒåŸºäº py-spy è¿›è¡Œåˆ†æã€‚</p><p><img src="https://img.hi-linux.com/staticfile/640-20210312141618823-2021-03-12-Tdwboq.jpg" alt></p><p>kubectl flame æ¦‚è¿°</p><h3><span id="ä½¿ç”¨å®ä¾‹">ä½¿ç”¨å®ä¾‹</span></h3><ol><li>åˆ†æ Kubernetes Pod</li></ol><p>åˆ†æ Java åº”ç”¨ mypod 1åˆ†é’Ÿï¼Œå¹¶åœ¨å°†ç«ç„°å›¾ä¿å­˜åˆ° <code>/tmp/flamegraph.svg</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl flame mypod -t 1m --lang java -f &#x2F;tmp&#x2F;flamegraph.svg</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ†æåŸºäº alpine çš„å®¹å™¨</li></ol><p>åœ¨åŸºäº alpine çš„å®¹å™¨ä¸­åˆ†æ Java åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ <code>--alpine</code> æ ‡å¿—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl flame mypod -t 1m -f &#x2F;tmp&#x2F;flamegraph.svg --lang Java --alpine</span><br></pre></td></tr></table></figure><blockquote><p><em>æ³¨æ„</em>ï¼šä»… Java åº”ç”¨ç¨‹åºéœ€è¦æ­¤ <code>--alpine</code> æ ‡å¿—ï¼Œè€Œ Go åˆ†æåˆ™ä¸éœ€è¦è¯¥æ ‡å¿—ã€‚</p></blockquote><ol start="3"><li>åˆ†æ sidecar å®¹å™¨</li></ol><p>åŒ…å«å¤šä¸ªå®¹å™¨çš„ Pod éœ€è¦å°†ç›®æ ‡å®¹å™¨æŒ‡å®šä¸ºå‚æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl flame mypod -t 1m --lang go -f &#x2F;tmp&#x2F;flamegraph.svg mycontainer</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ k8sæŠ€æœ¯åœˆ ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A6t8p02V%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">http://t.cn/A6t8p02Vï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯æ€§èƒ½åˆ†æï¼Ÿ&quot;&gt;ä»€ä¹ˆæ˜¯æ€§èƒ½åˆ†æï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æ€§èƒ½åˆ†ææ˜¯åˆ†æåº”ç”¨ç¨‹åºæ€§èƒ½æ¥æ”¹è¿›ä»£ç è´¨é‡çš„å¸¸ç”¨æ–¹æ³•ï¼Œæœ€æµè¡Œçš„å¯è§†åŒ–æ€§èƒ½åˆ†ææ–¹æ³•æ˜¯ç”Ÿæˆç«ç„°å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img.hi-linux.com/staticfile/640-2021-03-12-ogeYMt.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;åŸºäº Spring æ¡†æ¶çš„ Java åº”ç”¨çš„ç«ç„°å›¾&lt;/p&gt;
&lt;p&gt;yè½´æ˜¯å †æ ˆæ·±åº¦ï¼Œxè½´è·¨è¶Šæ ·æœ¬æ€»ä½“ã€‚æ¯ä¸ªçŸ©å½¢éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­å®½åº¦æ˜¾ç¤ºå®ƒå‡ºç°çš„é¢‘ç‡ï¼Œä»å·¦åˆ°å³çš„æ’åºå¹¶ä¸é‡è¦ (å †æ ˆæŒ‰å­—æ¯é¡ºåºæ’åº)ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Kubernetes-ä¸Šçš„æ€§èƒ½åˆ†æ&quot;&gt;Kubernetes ä¸Šçš„æ€§èƒ½åˆ†æ&lt;/h2&gt;
&lt;p&gt;æ€§èƒ½åˆ†ææ˜¯ä¸€é¡¹è¾ƒä¸ºå¤æ‚çš„ä»»åŠ¡ï¼Œå¤§å¤šæ•°æ¢æŸ¥å™¨æœ‰ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦ä¿®æ”¹åº”ç”¨ç¨‹åºï¼Œé€šå¸¸å¯ä»¥é€šè¿‡å°†æ ‡å¿—æ·»åŠ åˆ°æ‰§è¡Œå‘½ä»¤æˆ–å°†ä¸€äº›æ€§èƒ½åˆ†æåº“å¯¼å…¥ä»£ç ä¸­æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºåœ¨åˆ†æè¿‡ç¨‹ä¸­ä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼Œå› æ­¤é€šå¸¸é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œæ€§èƒ½åˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€‰æ‹©æ­£ç¡®çš„æ¢æŸ¥å™¨å¯èƒ½ä¼šè§£å†³è¿™äº›é—®é¢˜ï¼Œä½†æ˜¯è¿™éœ€è¦ä»”ç»†å»è¿›è¡Œç ”ç©¶ï¼Œå¹¶ä¸”é€šå¸¸å–å†³äºç¼–ç¨‹è¯­è¨€å’Œæ“ä½œç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œåˆ†ææ—¶ï¼Œä¼šå˜å¾—æ›´åŠ å›°éš¾ã€‚éœ€è¦éƒ¨ç½²ä¸€ä¸ªåŒ…å«é…ç½®æ–‡ä»¶ä¿®æ”¹çš„æ–°å®¹å™¨é•œåƒï¼Œè€Œä¸æ˜¯å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚æ­¤å¤–ï¼Œå½“åº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨æ—¶ï¼ŒæŸäº›æ€§èƒ½é—®é¢˜å¯èƒ½ä¼šæ¶ˆå¤±ï¼Œè¿™å°±ä½¿å¾—è°ƒè¯•å˜å¾—å›°éš¾ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>ä¸‰ç§ä¸åŒåœºæ™¯ä¸‹çš„ Kubernetes æœåŠ¡è°ƒè¯•æ–¹æ³•</title>
    <link href="https://www.hi-linux.com/posts/21833.html"/>
    <id>https://www.hi-linux.com/posts/21833.html</id>
    <published>2021-04-19T01:00:00.000Z</published>
    <updated>2021-04-19T03:41:05.883Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>åœ¨å¼€å‘ã€è°ƒè¯•ä¸ºç”Ÿäº§ç¯å¢ƒä¸‹ K8s service ä¸­çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå¸¸å¸¸éœ€è¦ä¸€äº›å·¥å…·æˆ–è€…å‘½ä»¤ã€‚æœ¬æ–‡ä»‹ç»äº†ä¸‰ç§ä¸åŒåœºæ™¯ä¸‹å¯¹åº”çš„è§£å†³æ–¹æ¡ˆä»¥åŠå·¥å…·ã€‚</p><blockquote><ul><li>ä½œè€…ï¼šErkan Erol</li><li>ç¿»è¯‘ï¼šBachï¼ˆæ‰äº‘ï¼‰</li><li>æ ¡å¯¹ï¼šæœ¨å­ï¼ˆæ‰äº‘ï¼‰</li></ul></blockquote><h2><span id="åŸºæœ¬è®¾ç½®">åŸºæœ¬è®¾ç½®</span></h2><p>ä»¥ä¸‹è§£é‡Šäº†åœºæ™¯çš„åŸºæœ¬è®¾ç½®ï¼š</p><p><img src="https://img.hi-linux.com/staticfile/640-20210317135843521-2021-03-17-e2IA9c.jpg" alt></p><p>æˆ‘ä»¬æœ‰ 3 ä¸ª serviceï¼Œservice-front é€šè¿‡å…¥å£æš´éœ²ç»™å¤–ç½‘ã€‚service-front çš„åç«¯æœåŠ¡æ˜¯ service-middleï¼Œservice-middle çš„åç«¯æ˜¯ service-backã€‚é€šä¿¡æ˜¯é€šè¿‡ K8s service å®Œæˆçš„ã€‚</p><p>ä»¥ä¸‹æ˜¯å®‰è£…è¯¥è®¾ç½®çš„å¿…è¦å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create ns service-debug</span><br><span class="line">$ kubectl -n service-debug run service-back --image&#x3D;erkanerol&#x2F;service-back:v1 --port&#x3D;8080 --expose&#x3D;true --labels&#x3D;&quot;app&#x3D;back&quot;</span><br><span class="line">$ kubectl -n service-debug run service-middle --image&#x3D;erkanerol&#x2F;service-middle:v1 --port&#x3D;8081 --expose&#x3D;true --labels&#x3D;&quot;app&#x3D;middle&quot;</span><br><span class="line">$ kubectl -n service-debug run service-front --image&#x3D;erkanerol&#x2F;service-front:v1 --port&#x3D;8082 --expose&#x3D;true --labels&#x3D;&quot;app&#x3D;front&quot;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™æ˜¯è¿™äº›æœåŠ¡çš„æºä»£ç ï¼š<a href="https://github.com/erkanerol/service-examples-for-blog" target="_blank" rel="noopener">https://github.com/erkanerol/service-examples-for-blog</a></p></blockquote><a id="more"></a><h2><span id="å·¥å…·1kubectl-port-forward">å·¥å…·1ï¼škubectl port-forward</span></h2><h3><span id="åœºæ™¯">åœºæ™¯ï¼š</span></h3><p>ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘å¸Œæœ› service-back å¯ä»¥ç›´æ¥å‘é€ä¸€äº›è¯·æ±‚ï¼Œå¹¶åœ¨ä¸å½±å“å…¶ä»– service çš„æƒ…å†µä¸‹æŸ¥çœ‹ç»“æœã€‚</p><h3><span id="é—®é¢˜">é—®é¢˜ï¼š</span></h3><p>service-back ä¸ä¼šæš´éœ²åœ¨å¤–ç½‘ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥å‘å…¶å‘é€è¯·æ±‚ã€‚</p><h3><span id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆï¼š</span></h3><p>ä½¿ç”¨ kubectl port-forwardï¼Œå¯ä»¥æ‰“å¼€ä»æœ¬åœ°è®¡ç®—æœºåˆ° service-back é›†ç¾¤ä¸­çš„éš§é“ã€‚</p><blockquote><p>å¯å‚è€ƒï¼š<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward</a></p></blockquote><h3><span id="æ­¥éª¤">æ­¥éª¤ï¼š</span></h3><p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n service-debug port-forward service&#x2F;service-back 8080:8080</span><br><span class="line">Forwarding from 127.0.0.1:8080 -&gt; 8080</span><br><span class="line">Forwarding from [::1]:8080 -&gt; 8080</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹ curl å‘½ä»¤ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥è®¿é—® service-backï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl localhost:8080</span><br><span class="line">Timestamp from back:1614508193</span><br></pre></td></tr></table></figure><h3><span id="å®ç°åŸç†">å®ç°åŸç†ï¼š</span></h3><p><img src="https://img.hi-linux.com/staticfile/640-20210317134229552-2021-03-17-ENK3sw.jpg" alt></p><p>kubectl å¯åŠ¨ä¸€ä¸ªç›‘å¬åœ¨ localhost:8080 çš„è¿›ç¨‹ã€‚å®ƒç›‘æ§è¯¥ç«¯å£å¹¶å»ºç«‹ä¸ api-server çš„è¿æ¥ï¼Œè¯¥è¿æ¥å°†è¯·æ±‚è½¬å‘åˆ° service-backã€‚</p><h2><span id="å·¥å…·2kubefwd">å·¥å…·2ï¼škubefwd</span></h2><h3><span id="åœºæ™¯">åœºæ™¯ï¼š</span></h3><p>ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘å¸Œæœ›åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œ service-frontï¼Œä»¥ä¾¿åœ¨ IDE ä¸­è®¾ç½®æ–­ç‚¹æ¥è°ƒè¯•åº”ç”¨ç¨‹åºã€‚</p><h3><span id="é—®é¢˜">é—®é¢˜ï¼š</span></h3><p>service-front è¢«è®¾è®¡ä¸ºï¼Œåœ¨ Kubernetes ä¸­è¿è¡Œå¹¶å¯ä»¥é€šè¿‡ K8s service è®¿é—® service-middleã€‚service åç§°æ˜¯ç¡¬ç¼–ç çš„ï¼Œæˆ–è€…å¾ˆéš¾é…ç½®çš„ï¼Œåˆæˆ–è€…æˆ‘ä»¬æ‡’å¾—åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæ¨¡æ‹Ÿä¾èµ–é¡¹ã€‚</p><h3><span id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆï¼š</span></h3><p>kubefwd æ˜¯è§£å†³è¯¥é—®é¢˜çš„æœ‰ç”¨å·¥å…·ã€‚å®ƒå¯ä»¥æ‰§è¡Œæ‰¹é‡ç«¯å£è½¬å‘å¹¶ç®¡ç†æœ¬åœ°è®¡ç®—æœºä¸­çš„ DNS è®°å½•ã€‚</p><blockquote><p>å¯å‚è€ƒï¼š<a href="https://github.com/txn2/kubefwd" target="_blank" rel="noopener">https://github.com/txn2/kubefwd</a></p></blockquote><h3><span id="æ­¥éª¤">æ­¥éª¤ï¼š</span></h3><p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo KUBECONFIG&#x3D;$KUBECONFIG kubefwd svc -n service-debug -l app&#x3D;middle</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œkubefwd éœ€è¦ root ç‰¹æƒï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨ sudo è¿è¡Œã€‚äº‹å…ˆè®¾ç½® KUBECONFIG å˜é‡ï¼Œä¸éœ€è¦ä»»ä½•ä¸»æ–‡ä»¶å¤¹å¼•ç”¨ã€‚</p><p>åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œ front åº”ç”¨ç¨‹åºã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡Œå®ƒå¹¶è®¾ç½®æ–­ç‚¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;tmp</span><br><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;erkanerol&#x2F;service-examples-for-blog.git</span><br><span class="line">$ cd service-examples-for-blog&#x2F;front</span><br><span class="line">$ go run main.go</span><br></pre></td></tr></table></figure><p>å†åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œå‘ front åº”ç”¨å‘é€è¯·æ±‚ï¼Œä»¥æŸ¥çœ‹ front åº”ç”¨åœ¨æœ¬åœ°æä¾›æœåŠ¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é›†ç¾¤ä¸­è®¿é—® service-middleã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl localhost:8082</span><br><span class="line">Response from service middle:&#39;Response from service back:&#39;Timestamp from back:1614513901&#39;&#39;</span><br></pre></td></tr></table></figure><h3><span id="å®ç°åŸç†">å®ç°åŸç†ï¼š</span></h3><p><img src="https://img.hi-linux.com/staticfile/640-20210317135852855-2021-03-17-VCN08D.jpg" alt></p><p>ä» kubefwd çš„æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">INFO[14:07:38] &#39;cat &#x2F;etc&#x2F;hosts&#39; to see all host entries.</span><br><span class="line">INFO[14:07:38] Loaded hosts file &#x2F;etc&#x2F;hosts</span><br><span class="line">INFO[14:07:38] HostFile management: Original hosts backup already exists at &#x2F;root&#x2F;hosts.original</span><br><span class="line">...</span><br><span class="line">INFO[14:07:38] Port-Forward: 127.1.27.1 service-middle:8081 to pod service-middle:8081</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å®ƒå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œç›‘å¬åœ¨ 127.1.27.1:8081ï¼Œå¹¶é…ç½®äº† service-middle çš„ /etc/hostsï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;etc&#x2F;hosts |grep service-middle</span><br><span class="line">127.1.27.1       service-middle.default service-middle.default.svc service-middle.default.svc.cluster.local service-middle.default.minikube service-middle.default.svc.minikube service-middle.default.svc.cluster.minikube service-middle service-middle.service-debug service-middle.service-debug.svc service-middle.service-debug.svc.cluster.local service-middle.service-debug.minikube service-middle.service-debug.svc.minikube service-middle.service-debug.svc.cluster.minikube</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæœ¬åœ° front åº”ç”¨ç¨‹åºå¯ä»¥åƒè®¿é—® K8s é›†ç¾¤ä¸€æ ·è®¿é—® service-middleï¼Œè€Œæ— éœ€å…¶ä»–é¢å¤–çš„å·¥ä½œã€‚</p><h2><span id="å·¥å…·3telepresence">å·¥å…·3ï¼štelepresence</span></h2><h3><span id="åœºæ™¯">åœºæ™¯ï¼š</span></h3><p>ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘å¸Œæœ›åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œ service-middleï¼Œä»¥ä¾¿å¯ä»¥åœ¨ IDE ä¸­è®¾ç½®æ–­ç‚¹æ¥è°ƒè¯•åº”ç”¨ç¨‹åºã€‚</p><h3><span id="é—®é¢˜">é—®é¢˜ï¼š</span></h3><p>service-middle è®¾è®¡ä¸ºå¯åœ¨ Kubernetes ä¸­è¿è¡Œï¼Œå¯é€šè¿‡ K8s service è®¿é—® service-backã€‚å¦å¤–ï¼Œå®ƒçš„ service-front æ­£åœ¨ K8s ä¸Šè¿è¡Œã€‚è¿™äº› service åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šä¸å¯ç”¨ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿå¾ˆéš¾åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæ¨¡æ‹Ÿè¿™äº›ç¯å¢ƒã€‚</p><h3><span id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆï¼š</span></h3><p>telepresence æ˜¯è§£å†³æ­¤é—®é¢˜çš„æœ‰ç”¨å·¥å…·ã€‚</p><blockquote><p>å¯å‚è€ƒï¼š<a href="https://www.telepresence.io/" target="_blank" rel="noopener">https://www.telepresence.io/</a></p></blockquote><h3><span id="æ­¥éª¤">æ­¥éª¤ï¼š</span></h3><p>é¦–å…ˆä» K8s é›†ç¾¤ä¸­åˆ é™¤ service-middleã€‚æˆ‘ä»¬åœ¨æœ¬åœ°è¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n service-debug delete service service-middle --ignore-not-found&#x3D;true</span><br><span class="line">$ kubectl -n service-debug delete pod service-middle --ignore-not-found&#x3D;true</span><br></pre></td></tr></table></figure><p>ä¸º service-middle è¿è¡Œ telepresenceï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  telepresence --namespace service-debug --new-deployment service-middle --expose 8081</span><br></pre></td></tr></table></figure><p>åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œ middle åº”ç”¨ç¨‹åºã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡Œå¹¶è®¾ç½®æ–­ç‚¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;tmp</span><br><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;erkanerol&#x2F;service-examples-for-blog.git</span><br><span class="line">$ cd service-examples-for-blog&#x2F;middle</span><br><span class="line">$ go run main.go</span><br></pre></td></tr></table></figure><p>å†åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥é€šè¿‡é›†ç¾¤ä¸­çš„ä¸´æ—¶ Pod å‘é€è¯·æ±‚è‡³ service-front ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n service-debug run curl -it  --rm&#x3D;true --image&#x3D;curlimages&#x2F;curl --restart&#x3D;Never -- http:&#x2F;&#x2F;service-front:8082Response from service middle:&#39;</span><br><span class="line">Response from service back:&#39;Timestamp from back:1614517363&#39;&#39;pod &quot;curl&quot; deleted</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„ï¼Œè¿™é‡Œçš„è¯·æ±‚å°†è½¬åˆ° K8s ä¸­çš„ service-frontï¼ŒK8s å°†è¯·æ±‚å‘é€åˆ°æœ¬åœ°è®¡ç®—æœºä¸­çš„ service-middleï¼Œæœ¬åœ°è®¡ç®—æœºå†å°†è¯·æ±‚å‘é€åˆ°é›†ç¾¤ä¸­çš„ service-backã€‚</p><h3><span id="å®ç°åŸç†">å®ç°åŸç†ï¼š</span></h3><p><img src="https://img.hi-linux.com/staticfile/640-20210317135905079-2021-03-17-LvNbRd.jpg" alt></p><p>å®é™…ä¸Šï¼Œtelepresence å°† proxyã€fake agent éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ï¼Œå¹¶é€šè¿‡è¯¥ä»£ç†åœ¨æœ¬åœ°ç¯å¢ƒå’Œé›†ç¾¤ä¹‹é—´æ‰“å¼€ä¸€æ¡åŒå‘é€šé“ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œ middle serviceï¼Œè€Œæ— éœ€è°ƒæ•´ consumersã€dependent serviceã€‚</p><blockquote><p>telepresence å·¥ä½œåŸç†çš„è¯¦ç»†è¯´æ˜ï¼Œè¯¦è§ï¼š<a href="https://www.telepresence.io/discussion/how-it-works" target="_blank" rel="noopener">https://www.telepresence.io/discussion/how-it-works</a></p></blockquote><h2><span id="å°ç»“">å°ç»“</span></h2><p>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ä¸æš´éœ² service çš„æƒ…å†µä¸‹è®¿é—® serviceï¼Œkubectl port-forward å°±è¶³å¤Ÿäº†ã€‚</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°è¿è¡Œ service è¿›è¡Œè°ƒè¯•ï¼Œå¹¶ä¸” service éœ€è¦è®¿é—® K8s ä¸Šçš„å…¶ä»– service ï¼Œkubefwd å¯ä»¥å‘æŒ¥ä½œç”¨ã€‚å®ƒç®¡ç†ç€æœ¬åœ°è®¡ç®—æœºä¸­çš„ DNS è®°å½•ï¼Œå¹¶ä¸º service ä¾èµ–æ€§æ‰“å¼€ä»è®¡ç®—æœºåˆ°é›†ç¾¤çš„å•å‘é€šé“ã€‚</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°è¿è¡Œ service è¿›è¡Œè°ƒè¯•ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºåœ¨é›†ç¾¤ä¸­æœ‰ä¸€äº›ä½¿ç”¨æ–¹ï¼Œé‚£å°±ä½¿ç”¨telepresenceã€‚å®ƒå¯ä»¥æ‰“å¼€åŒå‘ç½‘ç»œé€šé“ï¼Œå¹¶å°†è¯·æ±‚ä»é›†ç¾¤è½¬å‘è‡³æœ¬åœ°å®ä¾‹ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://erkanerol.github.io/post/debugging-k8s-services/" target="_blank" rel="noopener">https://erkanerol.github.io/post/debugging-k8s-services/</a></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ K8sMeetupã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A6t1ABFC" target="_blank" rel="noopener">http://t.cn/A6t1ABFC</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨å¼€å‘ã€è°ƒè¯•ä¸ºç”Ÿäº§ç¯å¢ƒä¸‹ K8s service ä¸­çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå¸¸å¸¸éœ€è¦ä¸€äº›å·¥å…·æˆ–è€…å‘½ä»¤ã€‚æœ¬æ–‡ä»‹ç»äº†ä¸‰ç§ä¸åŒåœºæ™¯ä¸‹å¯¹åº”çš„è§£å†³æ–¹æ¡ˆä»¥åŠå·¥å…·ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ä½œè€…ï¼šErkan Erol&lt;/li&gt;
&lt;li&gt;ç¿»è¯‘ï¼šBachï¼ˆæ‰äº‘ï¼‰&lt;/li&gt;
&lt;li&gt;æ ¡å¯¹ï¼šæœ¨å­ï¼ˆæ‰äº‘ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;åŸºæœ¬è®¾ç½®&quot;&gt;åŸºæœ¬è®¾ç½®&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹è§£é‡Šäº†åœºæ™¯çš„åŸºæœ¬è®¾ç½®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img.hi-linux.com/staticfile/640-20210317135843521-2021-03-17-e2IA9c.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æœ‰ 3 ä¸ª serviceï¼Œservice-front é€šè¿‡å…¥å£æš´éœ²ç»™å¤–ç½‘ã€‚service-front çš„åç«¯æœåŠ¡æ˜¯ service-middleï¼Œservice-middle çš„åç«¯æ˜¯ service-backã€‚é€šä¿¡æ˜¯é€šè¿‡ K8s service å®Œæˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å®‰è£…è¯¥è®¾ç½®çš„å¿…è¦å‘½ä»¤ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ kubectl create ns service-debug&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ kubectl -n service-debug run service-back --image&amp;#x3D;erkanerol&amp;#x2F;service-back:v1 --port&amp;#x3D;8080 --expose&amp;#x3D;true --labels&amp;#x3D;&amp;quot;app&amp;#x3D;back&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ kubectl -n service-debug run service-middle --image&amp;#x3D;erkanerol&amp;#x2F;service-middle:v1 --port&amp;#x3D;8081 --expose&amp;#x3D;true --labels&amp;#x3D;&amp;quot;app&amp;#x3D;middle&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ kubectl -n service-debug run service-front --image&amp;#x3D;erkanerol&amp;#x2F;service-front:v1 --port&amp;#x3D;8082 --expose&amp;#x3D;true --labels&amp;#x3D;&amp;quot;app&amp;#x3D;front&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™æ˜¯è¿™äº›æœåŠ¡çš„æºä»£ç ï¼š&lt;a href=&quot;https://github.com/erkanerol/service-examples-for-blog&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/erkanerol/service-examples-for-blog&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>å¾®è½¯å†æ¨ Rust è¯­è¨€å…è´¹ä¸­æ–‡æ•™ç¨‹ï¼Œæ›´é¦™äº†ï¼</title>
    <link href="https://www.hi-linux.com/posts/42443.html"/>
    <id>https://www.hi-linux.com/posts/42443.html</id>
    <published>2021-04-19T01:00:00.000Z</published>
    <updated>2021-04-20T05:03:32.420Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>åœ¨è¿‡å»çš„å‡ ä¸ªæœˆï¼ŒAmazonã€Facebookã€å¾®è½¯ä»¥åŠè°·æ­Œç­‰ç§‘æŠ€å·¨å¤´æ­£ç–¯ç‹‚å¸çº³äººæ‰å¸‚åœºä¸Šçš„ Rust è¯­è¨€ç¨‹åºå‘˜ã€‚ Rust äººæ‰çš„åŠ¨å‘ï¼Œä¹Ÿæ ‡å¿—ç€è¯¥è¯­è¨€ç¤¾åŒºåœ¨å‘å±•è¿›ç¨‹ä¸­è¿æ¥äº†æ–°çš„è½¬æŠ˜ç‚¹ã€‚</p><p>è¿™åœº â€œæŠ¢äººå¤§æˆ˜â€ï¼Œæºè‡ªå„æ–¹ç€åŠ›ç­¹å¤‡çš„ Rust å›¢é˜Ÿç»„å»ºè®¡åˆ’ã€‚å‡­å€Ÿç€å‡ºè‰²çš„å†…å­˜æ•ˆç‡ã€é€Ÿåº¦ä¸å®‰å…¨æ€§ï¼ŒRust è¯­è¨€è¿‘å¹´æ¥çš„ä¼˜åŠ¿åœ°ä½æ„ˆå‘æ˜æ˜¾ã€‚äº‹å®ä¸Šï¼ŒRust æ­£è¶Šæ¥è¶Šè¢«è§†ä¸º Go ä»¥åŠ C++/C ç­‰ä¼ ç»Ÿç¼–ç¨‹è¯­è¨€çš„ç°ä»£æ›¿ä»£é€‰é¡¹ã€‚</p><p>å„å¤§å‚å•†å¼€å§‹ä½¿ç”¨ Rust è¯­è¨€æ”¯æŒä»ç½‘ç«™åˆ°å¼€å‘è€…å·¥å…·ã€å†åˆ°ç”µå­æ¸¸æˆçš„å¤šç§åº”ç”¨åœºæ™¯ã€‚Facebook ä¸€ç›´åœ¨ä½¿ç”¨ Rust è¯­è¨€æ„å»º Diem å¸ï¼ˆå³åŸ Libra å¸ï¼‰ï¼ŒAmazon åˆ™ä½¿ç”¨ Rust ä¸ºå…¶æ— æœåŠ¡å™¨å¹³å° Lambdaï¼ˆæ­¤å¹³å°å…è®¸å¼€å‘è€…åœ¨æ— éœ€ç®¡ç†åº•å±‚æœåŠ¡å™¨çš„å‰æä¸‹ï¼Œè½»æ¾è¿è¡Œå¹¶æ‰©å±•å¼€å‘ä»£ç ï¼‰ç­‰äº§å“ç¼–å†™ä»£ç ã€‚</p><blockquote><p>Rust è¯­è¨€æ˜¯ä¸€ç§é«˜æ•ˆã€å¯é çš„é€šç”¨é«˜çº§è¯­è¨€ã€‚å…¶é«˜æ•ˆä¸ä»…é™äºå¼€å‘æ•ˆç‡ï¼Œå®ƒçš„æ‰§è¡Œæ•ˆç‡ä¹Ÿæ˜¯ä»¤äººç§°èµçš„ï¼Œæ˜¯ä¸€ç§å°‘æœ‰çš„å…¼é¡¾å¼€å‘æ•ˆç‡å’Œæ‰§è¡Œæ•ˆç‡çš„è¯­è¨€ã€‚</p><p>Rust è¯­è¨€ç”± Mozilla å¼€å‘ï¼Œæœ€æ—©å‘å¸ƒäº 2014 å¹´ 9 æœˆã€‚Rust çš„ç¼–è¯‘å™¨æ˜¯åœ¨ MIT License å’Œ Apache License 2.0 åŒé‡åè®®å£°æ˜ä¸‹çš„å…è´¹å¼€æºè½¯ä»¶ã€‚</p></blockquote><a id="more"></a><p>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ä¸€å¥è¯ï¼ŒRust ç¼–ç¨‹è¯­è¨€è¶Šæ¥è¶Šå—æ¬¢è¿äº†ï¼Œå¦‚æœä½ æœ€è¿‘ä¹Ÿæ­£æƒ³å­¦ä¹ è¿™é—¨è¯­è¨€ï¼Œé‚£çœŸæ˜¯æ¥å¯¹åœ°æ–¹äº†ï¼Œå¾®è½¯æœ€è¿‘å¼€æ”¾äº†ä¸€ä¸ª Rust æ•™ç¨‹ï¼Œæœ€å…³é”®çš„æ˜¯è¿˜æœ‰ä¸­æ–‡ç‰ˆã€‚</p><p><img src="https://img.hi-linux.com/staticfile/image-20210420101730237-2021-04-20-RwaIqE.png" alt="image-20210420101730237"></p><p>é€šè¿‡è¿™ä»½æ•™ç¨‹ï¼Œ ä½ å°†æ‰“ä¸‹ä½¿ç”¨ Rust æ„å»ºå¿«é€Ÿã€é«˜æ•ˆçš„ç¨‹åºæ‰€éœ€çš„çŸ¥è¯†åŸºç¡€ã€‚</p><p>åœ¨æ­¤å­¦ä¹ è·¯å¾„ä¸‹ï¼Œä½ å°†ï¼š</p><ul><li><p>å®‰è£…ç¼–å†™ç¬¬ä¸€æ‰¹ Rust ä»£ç æ‰€éœ€çš„å·¥å…·ã€‚</p></li><li><p>äº†è§£ Rust ä¸­çš„åŸºæœ¬æ¦‚å¿µã€‚</p></li><li><p>äº†è§£å¦‚ä½•å¤„ç†é”™è¯¯ã€‚</p></li><li><p>åœ¨ Rust ä¸­ç®¡ç†å†…å­˜ã€‚</p></li><li><p>ä½¿ç”¨æ³›å‹ç±»å‹å’Œç‰¹å¾ã€‚</p></li><li><p>ä¸ºåŒ…å’Œç®±è®¾ç½®æ¨¡å—ã€‚</p></li><li><p>ç¼–å†™å¹¶è¿è¡Œè‡ªåŠ¨æµ‹è¯•ã€‚</p></li><li><p>åˆ›å»ºå‘½ä»¤è¡Œç¨‹åºã€‚</p></li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹éƒ¨åˆ†å­¦ä¹ æ¨¡å—ï¼š</p><h3><span id="rust-å…¥é—¨">Rust å…¥é—¨</span></h3><p><img src="https://img.hi-linux.com/staticfile/image-20210420102532317-2021-04-20-IiJ0AY.png" alt="image-20210420102532317"></p><p>åœ¨æ­¤æ¨¡å—ä¸­ï¼Œäº†è§£å¦‚ä½•å¼€å§‹ä½¿ç”¨ Rust - è®¾ç½®ç¯å¢ƒã€ç¼–å†™ç¨‹åºå’Œä½¿ç”¨ Cargo ç”Ÿæˆç³»ç»Ÿã€‚</p><h3><span id="äº†è§£-rust-ä¸­çš„å¸¸è§æ¦‚å¿µ">äº†è§£ Rust ä¸­çš„å¸¸è§æ¦‚å¿µ</span></h3><p><img src="https://img.hi-linux.com/staticfile/image-20210420103101356-2021-04-20-R9GuUV.png" alt="image-20210420103101356"></p><p>è¿™ä¸€æ¨¡å—ä¸­ä½ å°†äº†è§£ Rust çš„åŸºç¡€çŸ¥è¯†ã€‚ æµè§ˆå˜é‡ã€æ•°æ®ç±»å‹ã€ç»“æ„ã€æšä¸¾ã€å‡½æ•°ã€ç´¢å¼•ã€å“ˆå¸Œæ˜ å°„å’Œæµæ§åˆ¶ã€‚</p><h3><span id="åœ¨-rust-ä¸­å¤„ç†é”™è¯¯">åœ¨ Rust ä¸­å¤„ç†é”™è¯¯</span></h3><p><img src="https://img.hi-linux.com/staticfile/image-20210420103246334-2021-04-20-GtOzn4.png" alt="image-20210420103246334"></p><p>åœ¨æœ¬æ¨¡å—ä¸­ï¼Œä½ å°†äº†è§£åœ¨ Rust ä¸­å¤„ç†é”™è¯¯çš„æ–¹æ³•ã€‚</p><h3><span id="äº†è§£-rust-å¦‚ä½•ç®¡ç†å†…å­˜">äº†è§£ Rust å¦‚ä½•ç®¡ç†å†…å­˜</span></h3><p><img src="https://img.hi-linux.com/staticfile/image-20210420103303241-2021-04-20-6FbjVS.png" alt="image-20210420103303241"></p><p>è¿™ä¸€æ¨¡å—äº†è§£è®© Rust å¦‚æ­¤ä¸ä¼—ä¸åŒçš„ç‰¹æ€§ï¼šæ‰€æœ‰æƒå’Œå€Ÿç”¨ã€‚</p><p>çœ‹å®Œå‰å‡ ç« çš„ä»‹ç»ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦å¯¹ Rust è¯­è¨€æ„Ÿå…´è¶£å‘¢ï¼Ÿæ¬²æŸ¥çœ‹å®Œæ•´è¯¾ç¨‹çš„åœ°å€ï¼Œå¯åœ¨å…¬ä¼—å·åå°å›å¤ï¼šã€Œå¾®è½¯Rustã€è·å– ã€‚</p></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨è¿‡å»çš„å‡ ä¸ªæœˆï¼ŒAmazonã€Facebookã€å¾®è½¯ä»¥åŠè°·æ­Œç­‰ç§‘æŠ€å·¨å¤´æ­£ç–¯ç‹‚å¸çº³äººæ‰å¸‚åœºä¸Šçš„ Rust è¯­è¨€ç¨‹åºå‘˜ã€‚ Rust äººæ‰çš„åŠ¨å‘ï¼Œä¹Ÿæ ‡å¿—ç€è¯¥è¯­è¨€ç¤¾åŒºåœ¨å‘å±•è¿›ç¨‹ä¸­è¿æ¥äº†æ–°çš„è½¬æŠ˜ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™åœº â€œæŠ¢äººå¤§æˆ˜â€ï¼Œæºè‡ªå„æ–¹ç€åŠ›ç­¹å¤‡çš„ Rust å›¢é˜Ÿç»„å»ºè®¡åˆ’ã€‚å‡­å€Ÿç€å‡ºè‰²çš„å†…å­˜æ•ˆç‡ã€é€Ÿåº¦ä¸å®‰å…¨æ€§ï¼ŒRust è¯­è¨€è¿‘å¹´æ¥çš„ä¼˜åŠ¿åœ°ä½æ„ˆå‘æ˜æ˜¾ã€‚äº‹å®ä¸Šï¼ŒRust æ­£è¶Šæ¥è¶Šè¢«è§†ä¸º Go ä»¥åŠ C++/C ç­‰ä¼ ç»Ÿç¼–ç¨‹è¯­è¨€çš„ç°ä»£æ›¿ä»£é€‰é¡¹ã€‚&lt;/p&gt;
&lt;p&gt;å„å¤§å‚å•†å¼€å§‹ä½¿ç”¨ Rust è¯­è¨€æ”¯æŒä»ç½‘ç«™åˆ°å¼€å‘è€…å·¥å…·ã€å†åˆ°ç”µå­æ¸¸æˆçš„å¤šç§åº”ç”¨åœºæ™¯ã€‚Facebook ä¸€ç›´åœ¨ä½¿ç”¨ Rust è¯­è¨€æ„å»º Diem å¸ï¼ˆå³åŸ Libra å¸ï¼‰ï¼ŒAmazon åˆ™ä½¿ç”¨ Rust ä¸ºå…¶æ— æœåŠ¡å™¨å¹³å° Lambdaï¼ˆæ­¤å¹³å°å…è®¸å¼€å‘è€…åœ¨æ— éœ€ç®¡ç†åº•å±‚æœåŠ¡å™¨çš„å‰æä¸‹ï¼Œè½»æ¾è¿è¡Œå¹¶æ‰©å±•å¼€å‘ä»£ç ï¼‰ç­‰äº§å“ç¼–å†™ä»£ç ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Rust è¯­è¨€æ˜¯ä¸€ç§é«˜æ•ˆã€å¯é çš„é€šç”¨é«˜çº§è¯­è¨€ã€‚å…¶é«˜æ•ˆä¸ä»…é™äºå¼€å‘æ•ˆç‡ï¼Œå®ƒçš„æ‰§è¡Œæ•ˆç‡ä¹Ÿæ˜¯ä»¤äººç§°èµçš„ï¼Œæ˜¯ä¸€ç§å°‘æœ‰çš„å…¼é¡¾å¼€å‘æ•ˆç‡å’Œæ‰§è¡Œæ•ˆç‡çš„è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;Rust è¯­è¨€ç”± Mozilla å¼€å‘ï¼Œæœ€æ—©å‘å¸ƒäº 2014 å¹´ 9 æœˆã€‚Rust çš„ç¼–è¯‘å™¨æ˜¯åœ¨ MIT License å’Œ Apache License 2.0 åŒé‡åè®®å£°æ˜ä¸‹çš„å…è´¹å¼€æºè½¯ä»¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Rust" scheme="https://www.hi-linux.com/categories/Rust/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="å¾®è½¯" scheme="https://www.hi-linux.com/tags/%E5%BE%AE%E8%BD%AF/"/>
    
      <category term="Rust" scheme="https://www.hi-linux.com/tags/Rust/"/>
    
  </entry>
  
  <entry>
    <title>å·§ç”¨ Docker Compose ç®¡ç† GPU èµ„æº</title>
    <link href="https://www.hi-linux.com/posts/14919.html"/>
    <id>https://www.hi-linux.com/posts/14919.html</id>
    <published>2021-04-16T01:00:00.000Z</published>
    <updated>2021-04-16T03:17:43.760Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p><strong>åœ¨å®¹å™¨ä¸­ä½¿ç”¨ GPU ä¸€ç›´æ˜¯ä½¿ç”¨ Compose çš„ä¸€ä¸ªç—›ç‚¹ï¼</strong></p></blockquote><p>åœ¨é¢å‘ <code>AI</code> å¼€å‘çš„å¤§è¶‹åŠ¿ä¸‹ï¼Œå®¹å™¨åŒ–å¯ä»¥å°†ç¯å¢ƒæ— ç¼è¿ç§»ï¼Œå°†é…ç½®ç¯å¢ƒçš„æˆæœ¬æ— é™é™ä½ã€‚ä½†æ˜¯ï¼Œåœ¨å®¹å™¨ä¸­é…ç½® <code>CUDA</code> å¹¶è¿è¡Œ <code>TensorFlow</code> ä¸€æ®µæ—¶é—´å†…ç¡®å®æ˜¯ä¸ªæ¯”è¾ƒéº»çƒ¦çš„æ—¶å€™ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°±ä»‹ç»å’Œä½¿ç”¨å®ƒã€‚</p><ul><li><a href="https://docs.docker.com/compose/gpu-support/" target="_blank" rel="noopener">Enabling GPU access with Compose</a></li><li><a href="https://docs.docker.com/config/containers/resource_constraints/#gpu" target="_blank" rel="noopener">Runtime options with Memory, CPUs, and GPUs</a></li><li><a href="https://github.com/compose-spec/compose-spec/blob/master/spec.md" target="_blank" rel="noopener">The Compose Specification</a></li><li><a href="https://github.com/compose-spec/compose-spec/blob/master/deploy.md#devices" target="_blank" rel="noopener">The Compose Specification - Deployment support</a></li><li><a href="https://github.com/compose-spec/compose-spec/blob/master/build.md" target="_blank" rel="noopener">The Compose Specification - Build support</a></li></ul><p><strong>åœ¨ Compose ä¸­ä½¿ç”¨ GPU èµ„æº</strong></p><ul><li>å¦‚æœæˆ‘ä»¬éƒ¨ç½² <code>Docker</code> æœåŠ¡çš„çš„ä¸»æœºä¸Šæ­£ç¡®å®‰è£…å¹¶è®¾ç½®äº†å…¶å¯¹åº”é…ç½®ï¼Œä¸”è¯¥ä¸»æœºä¸Šæ°æ°ä¹Ÿæœ‰å¯¹åº”çš„ <code>GPU</code> æ˜¾å¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨ <code>Compose</code> ä¸­æ¥å®šä¹‰å’Œè®¾ç½®è¿™äº› <code>GPU</code> æ˜¾å¡äº†ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éœ€è¦å®‰è£…çš„é…ç½®</span></span><br><span class="line">$ apt-get install nvidia-container-runtime</span><br></pre></td></tr></table></figure><ul><li><strong>æ—§ç‰ˆæœ¬ &lt;= 19.03</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># runtime</span></span><br><span class="line">$ docker run --runtime=nvidia --rm nvidia/cuda nvidia-smi</span><br></pre></td></tr></table></figure><ul><li><strong>æ–°ç‰ˆæœ¬ &gt;= 19.03</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># with --gpus</span></span><br><span class="line">$ docker run -it --rm --gpus all ubuntu nvidia-smi</span><br><span class="line"></span><br><span class="line"><span class="comment"># use device</span></span><br><span class="line">$ docker run -it --rm --gpus \</span><br><span class="line">    device=GPU-3a23c669-1f69-c64e-cf85-44e9b07e7a2a \</span><br><span class="line">    ubuntu nvidia-smi</span><br><span class="line"></span><br><span class="line"><span class="comment"># specific gpu</span></span><br><span class="line">$ docker run -it --rm --gpus <span class="string">'"device=0,2"'</span> ubuntu nvidia-smi</span><br><span class="line"></span><br><span class="line"><span class="comment"># set nvidia capabilities</span></span><br><span class="line">$ docker run --gpus <span class="string">'all,capabilities=utility'</span> --rm ubuntu nvidia-smi</span><br></pre></td></tr></table></figure><ul><li>å¯¹åº” <code>Compose</code> å·¥å…·çš„è€ç‰ˆæœ¬(<code>v2.3</code>)é…ç½®æ–‡ä»¶æ¥è¯´çš„è¯ï¼Œæƒ³è¦åœ¨éƒ¨ç½²çš„æœåŠ¡å½“ä¸­ä½¿ç”¨ <code>GPU</code> æ˜¾å¡èµ„æºçš„è¯ï¼Œå°±å¿…é¡»ä½¿ç”¨ <strong><code>runtime</code></strong> å‚æ•°æ¥è¿›è¡Œé…ç½®æ‰å¯ä»¥ã€‚è™½ç„¶å¯ä»¥ä½œä¸ºè¿è¡Œæ—¶ä¸ºå®¹å™¨æä¾› <code>GPU</code> çš„è®¿é—®å’Œä½¿ç”¨ï¼Œä½†æ˜¯åœ¨è¯¥æ¨¡å¼ä¸‹å¹¶ä¸å…è®¸å¯¹ <code>GPU</code> è®¾å¤‡çš„ç‰¹å®šå±æ€§è¿›è¡Œæ§åˆ¶ã€‚</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nvidia/cuda:10.2-base</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">nvidia-smi</span></span><br><span class="line">    <span class="attr">runtime:</span> <span class="string">nvidia</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NVIDIA_VISIBLE_DEVICES=all</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>åœ¨ <code>Compose v1.28.0+</code> çš„ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨ <code>Compose Specification</code> çš„é…ç½®æ–‡ä»¶å†™æ³•ï¼Œå¹¶æä¾›äº†ä¸€äº›å¯ä»¥æ›´ç»†ç²’åº¦çš„æ§åˆ¶ <code>GPU</code> èµ„æºçš„é…ç½®å±æ€§å¯è¢«ä½¿ç”¨ï¼Œå› æ­¤å¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™æ¥ç²¾ç¡®è¡¨è¾¾æˆ‘ä»¬çš„éœ€æ±‚ã€‚å’³å’³å’³ï¼Œé‚£è¿™é‡Œæˆ‘ä»¬å°±ä¸€èµ·çœ‹çœ‹å§ï¼</strong></p></blockquote><ul><li><code>capabilities</code> - å¿…é¡»å­—æ®µ<ul><li>æŒ‡å®šéœ€è¦æ”¯æŒçš„åŠŸèƒ½ï¼›å¯ä»¥é…ç½®å¤šä¸ªä¸åŒåŠŸèƒ½ï¼›å¿…é¡»é…ç½®çš„å­—æ®µ</li><li><code>man 7 capabilities</code></li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">reservations:</span></span><br><span class="line">      <span class="attr">devices:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">capabilities:</span> <span class="string">["gpu"]</span></span><br></pre></td></tr></table></figure><ul><li><code>count</code><ul><li>æŒ‡å®šéœ€è¦ä½¿ç”¨çš„<code>GPU</code>æ•°é‡ï¼›å€¼ä¸º<code>int</code>ç±»å‹ï¼›ä¸<code>device_ids</code>å­—æ®µäºŒé€‰ä¸€</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">reservations:</span></span><br><span class="line">      <span class="attr">devices:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">capabilities:</span> <span class="string">["tpu"]</span></span><br><span class="line">          <span class="attr">count:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><ul><li><code>device_ids</code><ul><li>æŒ‡å®šä½¿ç”¨<code>GPU</code>è®¾å¤‡<code>ID</code>å€¼ï¼›ä¸<code>count</code>å­—æ®µäºŒé€‰ä¸€</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">reservations:</span></span><br><span class="line">      <span class="attr">devices:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">capabilities:</span> <span class="string">["gpu"]</span></span><br><span class="line">          <span class="attr">device_ids:</span> <span class="string">["0",</span> <span class="string">"3"</span><span class="string">]</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">reservations:</span></span><br><span class="line">      <span class="attr">devices:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">capabilities:</span> <span class="string">["gpu"]</span></span><br><span class="line">          <span class="attr">device_ids:</span> <span class="string">["GPU-f123d1c9-26bb-df9b-1c23-4a731f61d8c7"]</span></span><br></pre></td></tr></table></figure><ul><li><code>driver</code><ul><li>æŒ‡å®š<code>GPU</code>è®¾å¤‡é©±åŠ¨ç±»å‹</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">reservations:</span></span><br><span class="line">      <span class="attr">devices:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">capabilities:</span> <span class="string">["nvidia-compute"]</span></span><br><span class="line">          <span class="attr">driver:</span> <span class="string">nvidia</span></span><br></pre></td></tr></table></figure><ul><li><code>options</code><ul><li>æŒ‡å®šé©±åŠ¨ç¨‹åºçš„ç‰¹å®šé€‰é¡¹</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">reservations:</span></span><br><span class="line">      <span class="attr">devices:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">capabilities:</span> <span class="string">["gpu"]</span></span><br><span class="line">          <span class="attr">driver:</span> <span class="string">gpuvendor</span></span><br><span class="line">          <span class="attr">options:</span></span><br><span class="line">            <span class="attr">virtualization:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>å’³å’³å’³ï¼Œçœ‹ä¹Ÿçœ‹äº†ï¼Œè¯´ä¹Ÿè¯´äº†ï¼Œé‚£æˆ‘ä»¬å°±ç®€å•çš„ç¼–å†™ä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶ï¼Œè®©å¯åŠ¨çš„ <code>cuda</code> å®¹å™¨æœåŠ¡æ¥ä½¿ç”¨ä¸€ä¸ª <code>GPU</code> è®¾å¤‡èµ„æºï¼Œå¹¶è¿è¡Œå¾—åˆ°å¦‚ä¸‹è¾“å‡ºã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nvidia/cuda:10.2-base</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">nvidia-smi</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">5s</span></span><br><span class="line">        <span class="attr">max_attempts:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">window:</span> <span class="string">120s</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">"0.50"</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">50M</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">"0.25"</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">20M</span></span><br><span class="line">          <span class="attr">devices:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">driver:</span> <span class="string">nvidia</span></span><br><span class="line">              <span class="attr">count:</span> <span class="number">1</span></span><br><span class="line">              <span class="attr">capabilities:</span> <span class="string">[gpu,</span> <span class="string">utility]</span></span><br><span class="line">      <span class="attr">update_config:</span></span><br><span class="line">        <span class="attr">parallelism:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">order:</span> <span class="string">stop-first</span></span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„è¿™é‡Œï¼Œå¦‚æœè®¾ç½® <code>count: 2</code> çš„è¯ï¼Œå°±ä¼šä¸‹é¢çš„è¾“å‡ºä¸­çœ‹åˆ°ä¸¤å—æ˜¾å¡è®¾ç½®çš„ä¿¡æ¯ã€‚å¦‚æœï¼Œæˆ‘ä»¬è¿™é‡Œå‡æœªè®¾ç½® <code>count</code> æˆ– <code>device_ids</code> å­—æ®µçš„è¯ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å°†ä¸»æœºä¸Šæ‰€æœ‰ <code>GPU</code> ä¸€åŒä½¿ç”¨ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰å°ç›´æ¥è¿è¡Œ</span></span><br><span class="line">$ docker-compose up</span><br><span class="line">Creating network <span class="string">"gpu_default"</span> with the default driver</span><br><span class="line">Creating gpu_test_1 ... <span class="keyword">done</span></span><br><span class="line">Attaching to gpu_test_1</span><br><span class="line">test_1  | +-----------------------------------------------------------------------------+</span><br><span class="line">test_1  | | NVIDIA-SMI 450.80.02    Driver Version: 450.80.02    CUDA Version: 11.1     |</span><br><span class="line">test_1  | |-------------------------------+----------------------+----------------------+</span><br><span class="line">test_1  | | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">test_1  | | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">test_1  | |                               |                      |               MIG M. |</span><br><span class="line">test_1  | |===============================+======================+======================|</span><br><span class="line">test_1  | |   0  Tesla T4            On   | 00000000:00:1E.0 Off |                    0 |</span><br><span class="line">test_1  | | N/A   23C    P8     9W /  70W |      0MiB / 15109MiB |      0%      Default |</span><br><span class="line">test_1  | |                               |                      |                  N/A |</span><br><span class="line">test_1  | +-------------------------------+----------------------+----------------------+</span><br><span class="line">test_1  |</span><br><span class="line">test_1  | +-----------------------------------------------------------------------------+</span><br><span class="line">test_1  | | Processes:                                                                  |</span><br><span class="line">test_1  | |  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span><br><span class="line">test_1  | |        ID   ID                                                   Usage      |</span><br><span class="line">test_1  | |=============================================================================|</span><br><span class="line">test_1  | |  No running processes found                                                 |</span><br><span class="line">test_1  | +-----------------------------------------------------------------------------+</span><br><span class="line">gpu_test_1 exited with code 0</span><br></pre></td></tr></table></figure><ul><li>å½“ç„¶ï¼Œå¦‚æœè®¾ç½®äº† <code>count</code> æˆ– <code>device_ids</code> å­—æ®µçš„è¯ï¼Œå°±å¯ä»¥åœ¨å®¹å™¨é‡Œé¢çš„ç¨‹åºä¸­ä½¿ç”¨å¤šå—æ˜¾å¡èµ„æºäº†ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹éƒ¨ç½²é…ç½®æ–‡ä»¶æ¥è¿›è¡ŒéªŒè¯å’Œä½¿ç”¨ã€‚</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">tensorflow/tensorflow:latest-gpu</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">python</span> <span class="string">-c</span> <span class="string">"import tensorflow as tf;tf.test.gpu_device_name()"</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">devices:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">driver:</span> <span class="string">nvidia</span></span><br><span class="line">              <span class="attr">device_ids:</span> <span class="string">["0",</span> <span class="string">"3"</span><span class="string">]</span></span><br><span class="line">              <span class="attr">capabilities:</span> <span class="string">[gpu]</span></span><br></pre></td></tr></table></figure><ul><li>è¿è¡Œç»“æœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤å—æ˜¾å¡å‡å¯ä»¥è¢«ä½¿ç”¨åˆ°ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰å°ç›´æ¥è¿è¡Œ</span></span><br><span class="line">$ docker-compose up</span><br><span class="line">...</span><br><span class="line">Created TensorFlow device (/device:GPU:0 with 13970 MB memory -&gt; physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:00:1b.0, compute capability: 7.5)</span><br><span class="line">...</span><br><span class="line">Created TensorFlow device (/device:GPU:1 with 13970 MB memory) -&gt; physical GPU (device: 1, name: Tesla T4, pci bus id: 0000:00:1e.0, compute capability: 7.5)</span><br><span class="line">...</span><br><span class="line">gpu_test_1 exited with code 0</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Ecsape çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A6c6d4l1" target="_blank" rel="noopener">http://t.cn/A6c6d4l1</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;div id=&quot;vip-container&quot;&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;åœ¨å®¹å™¨ä¸­ä½¿ç”¨ GPU ä¸€ç›´æ˜¯ä½¿ç”¨ Compose çš„ä¸€ä¸ªç—›ç‚¹ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨é¢å‘ &lt;code&gt;AI&lt;/code&gt;
        
      
    
    </summary>
    
    
      <category term="Docker" scheme="https://www.hi-linux.com/categories/docker/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>é‡ç£… | AWS å…è´¹å¼€æºå¢å¼ºç‰ˆ Elasticsearch åˆ†æ”¯ OpenSearch</title>
    <link href="https://www.hi-linux.com/posts/50892.html"/>
    <id>https://www.hi-linux.com/posts/50892.html</id>
    <published>2021-04-15T01:00:00.000Z</published>
    <updated>2021-04-15T01:36:05.433Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>ä»Šå¹´ 1 æœˆï¼Œå¼€å‘ Elasticsearch å’Œ Kibana çš„å…¬å¸ Elastic å®£å¸ƒæ›´æ”¹è®¸å¯è¯ï¼Œæ–°ç‰ˆæœ¬å°†ä¸å†ä½¿ç”¨ Apache 2.0 è®¸å¯è¯ï¼Œè€Œæ˜¯ä½¿ç”¨ Elastic è®¸å¯è¯å’ŒæœåŠ¡å™¨ç«¯å…¬å…±è®¸å¯è¯ï¼ˆSSPLï¼‰ï¼Œæ­¤ä¸¾æ˜¯ä¸ºäº†ç¦æ­¢ç±»ä¼¼äºšé©¬é€Šç­‰äº‘æœåŠ¡å•†ä½¿ç”¨å®ƒçš„è½¯ä»¶ä½œä¸ºä¸€ç§æœåŠ¡æä¾›ç»™å®¢æˆ·ã€‚ä½†åŒæ—¶ï¼Œæ–°çš„è®¸å¯è¯ä¸å†ç¬¦åˆå¼€æºè®¸å¯è¯çš„å®šä¹‰ï¼Œæ„å‘³ç€ Elasticsearch å’Œ Kibana ä¸å†æ˜¯å¼€æºè½¯ä»¶äº†ã€‚</p><p>ç„¶åï¼Œäºšé©¬é€Šå®£å¸ƒè¦åˆ›å»ºå®ƒçš„ Elasticsearch åˆ†æ”¯ OpenSearch å’Œ Kibana åˆ†æ”¯ OpenSearch Dashboardsã€‚</p><p>è¿‘æ—¥ AWS å®£å¸ƒåˆ›å»º â€œçœŸæ­£â€ å¼€æºçš„ Elasticsearch åˆ†æ”¯æœ‰äº†ä¸‹æ–‡ã€‚ OpenSearch çš„æºä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Šã€‚äºšé©¬é€Šè¡¨ç¤ºä»¥åæ‰€æœ‰çš„æ›´æ–°å°†é€šè¿‡ OpenSearch é¡¹ç›®å‘å¸ƒã€‚åŒ…æ‹¬çº¢å¸½ã€SAPã€Capital One å’Œ <a href="http://Logz.io" target="_blank" rel="noopener">Logz.io</a> ç­‰åœ¨å†…çš„å¤šä¸ªç»„ç»‡å¯¹ AWS åˆ›å»º OpenSearch é¡¹ç›®è¡¨ç¤ºäº†æ”¯æŒã€‚</p><blockquote><p>OpenSearch é¡¹ç›®ç”± OpenSearch (fork Elasticsearch 7.10.2) å’Œ OpenSearch Dashboards (fork Kibana 7.10.2) ç»„æˆï¼ŒåŒ…æ‹¬ä¼ä¸šå®‰å…¨ã€å‘Šè­¦ã€æœºå™¨å­¦ä¹ ã€SQLã€ç´¢å¼•çŠ¶æ€ç®¡ç†ç­‰åŠŸèƒ½ã€‚OpenSearch é¡¹ç›®ä¸­çš„æ‰€æœ‰è½¯ä»¶å‡é‡‡ç”¨äº† Apache License 2.0 å¼€æºè®¸å¯åè®®ã€‚</p></blockquote><p><strong>OpenSearch é¡¹ç›®ä»“åº“åœ°å€</strong></p><ol><li>OpenSearch</li></ol><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/opensearch-project/OpenSearch" target="_blank" rel="noopener">https://github.com/opensearch-project/OpenSearch</a></p><ol start="2"><li>OpenSearch Dashboards</li></ol><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/opensearch-project/OpenSearch-Dashboards" target="_blank" rel="noopener">https://github.com/opensearch-project/OpenSearch-Dashboards</a></p><p>AWS ä»‹ç»ç§°ï¼Œä»–ä»¬æ¨å‡ºçš„ OpenSearch åˆ é™¤äº† Elasticsearch ä¸­å— Elastic å•†ä¸šè®¸å¯è¯é™åˆ¶çš„åŠŸèƒ½ã€ä»£ç å’Œå•†æ ‡ï¼Œä»¥å…¼å®¹ Apache License 2.0ï¼Œè‡ªç§°è¿™æ˜¯æ¯ä¸ªäººéƒ½å¯ä»¥æ„å»ºå’Œåˆ›æ–°çš„åŸºç¡€ï¼Œä»»ä½•äººæ— éœ€ç­¾ç½² CLA (Contributor License Agreement) å³å¯ä¸ºé¡¹ç›®è´¡çŒ®ä»£ç ã€‚</p><p>æ­¤å¤–ï¼ŒAWS ç°æœ‰çš„ Amazon Elasticsearch Service è¢«é‡å‘½åä¸º Amazon OpenSearch Serviceï¼ŒAWS è¡¨ç¤ºæ›´åä¸ä¼šå½±å“æ­£åœ¨è¿è¥çš„ä¸šåŠ¡ï¼ŒAmazon OpenSearch Service ä¼šæä¾›ä¸€ç³»åˆ—å¯ä¾›éƒ¨ç½²å’Œè¿è¡Œçš„å¼€æºå¼•æ“ï¼ŒåŒ…æ‹¬å½“å‰å¯ç”¨çš„ 19 ä¸ªç‰ˆæœ¬çš„ Elasticsearchï¼ˆ7.9 å’Œæ›´æ—©ç‰ˆæœ¬ã€è¿‘æœŸæ¨å‡ºçš„ 7.10ï¼‰ä»¥åŠæ–°ç‰ˆæœ¬çš„ OpenSearchã€‚</p><p>AWS è¿˜è¯´åˆ°ä¼šç»§ç»­é€šè¿‡å®‰å…¨æ€§å’Œé”™è¯¯ä¿®å¤æ¥æ”¯æŒå’Œç»´æŠ¤é‡‡ç”¨ Apache License 2.0 çš„ Elasticsearchï¼Œå¹¶å°†é€šè¿‡ OpenSearch å’Œ OpenSearch Dashboards æä¾›æ‰€æœ‰æ–°åŠŸèƒ½ã€‚Amazon OpenSearch Service API å°†ä¸ç°æœ‰æœåŠ¡ API å‘åå…¼å®¹ã€‚æ­¤å¤–ï¼ŒAWS ä¼šæä¾›ä»ç°æœ‰ Elasticsearch 6.x å’Œ 7.x æ‰˜ç®¡é›†ç¾¤è¿ç§»è‡³ OpenSearch çš„æ— ç¼å‡çº§è·¯å¾„ã€‚</p><p>AWS è¡¨ç¤ºï¼Œå½“å‰ç‰ˆæœ¬çš„ä»£ç å°šå¤„äº Alpha é˜¶æ®µï¼Œæœªç»å½»åº•æµ‹è¯•å¹¶ä¸”ä¸é€‚åˆç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ä»–ä»¬è®¡åˆ’åœ¨æ¥ä¸‹æ¥çš„å‡ å‘¨å†…å‘å¸ƒ Beta ç‰ˆæœ¬ï¼Œæœ‰æœ›åœ¨ 2021 å¹´ä¸­æœŸå‘å¸ƒç¨³å®šç‰ˆå¹¶æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ å¼€æºä¸­å›½ ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A6cxOsxg" target="_blank" rel="noopener">http://t.cn/A6cxOsxg</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;div id=&quot;vip-container&quot;&gt;&lt;p&gt;ä»Šå¹´ 1 æœˆï¼Œå¼€å‘ Elasticsearch å’Œ Kibana çš„å…¬å¸ Elastic å®£å¸ƒæ›´æ”¹è®¸å¯è¯ï¼Œæ–°ç‰ˆæœ¬å°†ä¸å†ä½¿ç”¨ Apache 2.0 è®¸å¯è¯ï¼Œè€Œæ˜¯ä½¿ç”¨ Elastic
        
      
    
    </summary>
    
    
      <category term="Elasticsearch" scheme="https://www.hi-linux.com/categories/Elasticsearch/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Elasticsearch" scheme="https://www.hi-linux.com/tags/Elasticsearch/"/>
    
      <category term="å¿«è¿…" scheme="https://www.hi-linux.com/tags/%E5%BF%AB%E8%BF%85/"/>
    
  </entry>
  
  <entry>
    <title>å…¨é“¾è·¯åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿ Apache SkyWalking å…¥é—¨æ•™ç¨‹</title>
    <link href="https://www.hi-linux.com/posts/13634.html"/>
    <id>https://www.hi-linux.com/posts/13634.html</id>
    <published>2021-04-09T01:00:00.000Z</published>
    <updated>2021-04-09T03:40:18.073Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2><span id="å…ˆå†³æ¡ä»¶">å…ˆå†³æ¡ä»¶</span></h2><p>ç¡®ä¿æœ‰ä¸€å¥—è¿è¡Œæ­£å¸¸çš„ Kubernetes é›†ç¾¤ï¼Œæœ¬æ–‡é»˜è®¤ä¸ºä½¿ç”¨ Elasticsearch7 ä½œä¸ºåç«¯å­˜å‚¨ï¼›**å¦‚æœæƒ³æŠŠ ES æ”¾åˆ° Kubernetes é›†ç¾¤é‡Œé‚£ä¹ˆè¿˜å¾—ç¡®ä¿é›†ç¾¤é…ç½®äº†æ­£ç¡®çš„å­˜å‚¨ï¼Œè­¬å¦‚é»˜è®¤çš„ StorageClass å¯ç”¨ç­‰ã€‚**æœ¬æ–‡ä¸ºäº†æ–¹ä¾¿èµ·è§(å…¶å®å°±æ˜¯ç©·)é‡‡ç”¨å¤–éƒ¨ ES å­˜å‚¨ä¸”ä½¿ç”¨ docker-compose å•èŠ‚ç‚¹éƒ¨ç½²ï¼Œæ‰€ä»¥ä¸éœ€è¦é›†ç¾¤çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼›æœ€åç¡®ä¿ä½ æœ¬åœ°çš„ <code>kubectl</code> èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚</p><h2><span id="åŸºæœ¬æ¶æ„">åŸºæœ¬æ¶æ„</span></h2><p>Skywalking åœ¨å¤§ä½“ä¸Š(ä¸å‡†ç¡®)åˆ†ä¸ºå››å¤§éƒ¨åˆ†:</p><ul><li>oap-server: æ— çŠ¶æ€æœåŠ¡åç«¯ï¼Œä¸»è¦è´Ÿè´£å¤„ç†æ ¸å¿ƒé€»è¾‘ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªæ ‡å‡† java web é¡¹ç›®ã€‚</li><li>skywalking-ui: UI å‰ç«¯ï¼Œé€šè¿‡ graphql è¿æ¥ oap-server æä¾›ç”¨æˆ·æŸ¥è¯¢ç­‰ UI å±•ç¤ºã€‚</li><li>agent: å„ç§è¯­è¨€å®ç°çš„ agent è´Ÿè´£æŠ“å–åº”ç”¨è¿è¡Œæ•°æ®å¹¶ä¸ŠæŠ¥ç»™ oap-serverï¼Œæ ¸å¿ƒçš„æŒ‡æ ‡ä¸ŠæŠ¥æ¥æºã€‚</li><li>DB: å„ç§æ•°æ®åº“ï¼Œè´Ÿè´£å­˜å‚¨ Skywalking çš„æŒ‡æ ‡æ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒæ¨è ESã€TiDBã€MySQLã€‚</li></ul><a id="more"></a><h2><span id="éƒ¨ç½²-skywalking">éƒ¨ç½² Skywalking</span></h2><h3><span id="31-éƒ¨ç½²-elasticsearch">3.1ã€éƒ¨ç½² Elasticsearch</span></h3><p>Elasticsearch å½“å‰ä½¿ç”¨ 7.9.2 ç‰ˆæœ¬ï¼Œç”±äºåªæ˜¯åˆæ¬¡å°è¯•è¿˜å¤„äºæµ‹è¯•é˜¶æ®µæ‰€ä»¥ç›´æ¥ docker-compose å¯åŠ¨ä¸€ä¸ªå•ç‚¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># å¦‚æœæœ‰éœ€è¦å¯ä»¥è¿›å…¥ es å®¹å™¨ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®å¯†ç </span><br><span class="line"># elasticsearch-setup-passwords interactive</span><br><span class="line">version: &#39;3.8&#39;</span><br><span class="line">services:</span><br><span class="line">  elasticsearch:</span><br><span class="line">    container_name: elasticsearch</span><br><span class="line">    image: docker.elastic.co&#x2F;elasticsearch&#x2F;elasticsearch:7.9.2</span><br><span class="line">    restart: always</span><br><span class="line">    network_mode: &quot;host&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - data:&#x2F;data&#x2F;elasticsearch</span><br><span class="line">    environment:</span><br><span class="line">      - http.host&#x3D;172.16.11.43</span><br><span class="line">      - http.port&#x3D;9200</span><br><span class="line">      - transport.tcp.port&#x3D;172.16.11.43</span><br><span class="line">      - transport.tcp.port&#x3D;9300</span><br><span class="line">      - cluster.name&#x3D;skyes</span><br><span class="line">      - node.name&#x3D;skyes</span><br><span class="line">      - discovery.type&#x3D;single-node</span><br><span class="line">      - xpack.security.enabled&#x3D;true</span><br><span class="line">      - xpack.monitoring.enabled&#x3D;true</span><br><span class="line">      - &quot;ES_JAVA_OPTS&#x3D;-Xms4096m -Xmx7168m&quot;</span><br><span class="line">volumes:</span><br><span class="line">  data:</span><br></pre></td></tr></table></figure><h3><span id="32-å®‰è£…-helm">3.2ã€å®‰è£… Helm</span></h3><p>ç”±äº Skywalking å®˜æ–¹ç»™å‡ºçš„ Kubernetes å®‰è£…æ–¹å¼ä¸º Helm å®‰è£…ï¼Œæ‰€ä»¥éœ€è¦æœ¬åœ°å…ˆå®‰è£… Helmï¼›Helm å®‰è£…æ–¹å¼éå¸¸ç®€å•ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£<strong>åœ¨ç½‘ç»œæ²¡é—®é¢˜çš„æƒ…å†µä¸‹</strong>ç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;helm&#x2F;helm&#x2F;master&#x2F;scripts&#x2F;get-helm-3 | bash</span><br></pre></td></tr></table></figure><p>å¦‚æœç½‘ç»œä¸æ˜¯é‚£ä¹ˆ OK çš„æƒ…å†µä¸‹è¯·å‚è€ƒ<a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>çš„åŒ…ç®¡ç†å™¨æ–¹å¼å®‰è£…æˆ–ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚</p><h3><span id="33-å…‹éš†ä»“åº“åˆå§‹åŒ–-helm">3.3ã€å…‹éš†ä»“åº“åˆå§‹åŒ– Helm</span></h3><p>Helm éƒ¨ç½²ä¹‹å‰æŒ‰ç…§<a href="https://github.com/apache/skywalking-kubernetes" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>æç¤ºéœ€è¦å…ˆåˆå§‹åŒ– Helm ä»“åº“:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># clone helm ä»“åº“</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;skywalking-kubernetes</span><br><span class="line">cd skywalking-kubernetes&#x2F;chart</span><br><span class="line"></span><br><span class="line"># å³ä½¿ä½¿ç”¨å¤–éƒ¨ ES ä¹Ÿè¦æ·»åŠ è¿™ä¸ª repoï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¾èµ–é”™è¯¯</span><br><span class="line">helm repo add elastic https:&#x2F;&#x2F;helm.elastic.co</span><br><span class="line">helm dep up skywalking</span><br><span class="line"></span><br><span class="line"># change the release name according to your scenario</span><br><span class="line">export SKYWALKING_RELEASE_NAME&#x3D;skywalking</span><br><span class="line"># å¦‚æœä¿®æ”¹äº† NAMESPACEï¼Œåç»­éƒ¨ç½²åˆ™éœ€è¦å…ˆé€šè¿‡ kuebctl åˆ›å»ºè¯¥ NAMESPACE</span><br><span class="line"># change the namespace according to your scenario</span><br><span class="line">export SKYWALKING_RELEASE_NAMESPACE&#x3D;default</span><br></pre></td></tr></table></figure><h3><span id="34-å®‰è£…-skywalking">3.4ã€å®‰è£… Skywalking</span></h3><p>Helm åˆå§‹åŒ–å®Œæˆåéœ€è¦è‡ªè¡Œè°ƒæ•´é…ç½®æ–‡ä»¶ï¼Œé…ç½® oap-server ä½¿ç”¨å¤–éƒ¨ ES</p><p><strong>values-my-es.yaml</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">oap:</span><br><span class="line">  image:</span><br><span class="line">    tag: 8.1.0-es7      # Set the right tag according to the existing Elasticsearch version</span><br><span class="line">  storageType: elasticsearch7</span><br><span class="line"></span><br><span class="line">ui:</span><br><span class="line">  image:</span><br><span class="line">    tag: 8.1.0</span><br><span class="line"></span><br><span class="line">elasticsearch:</span><br><span class="line">  enabled: false</span><br><span class="line">  config:               # For users of an existing elasticsearch cluster,takes effect when &#96;elasticsearch.enabled&#96; is false</span><br><span class="line">    host: 172.16.11.43</span><br><span class="line">    port:</span><br><span class="line">      http: 9200</span><br><span class="line">    user: &quot;elastic&quot;</span><br><span class="line">    password: &quot;elastic&quot;</span><br></pre></td></tr></table></figure><p>è°ƒæ•´å¥½é…ç½®ååªéœ€è¦ä½¿ç”¨ Helm å®‰è£…å³å¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm install &quot;$&#123;SKYWALKING_RELEASE_NAME&#125;&quot; skywalking -n &quot;$&#123;SKYWALKING_RELEASE_NAMESPACE&#125;&quot; \</span><br><span class="line">  -f .&#x2F;skywalking&#x2F;values-my-es.yaml --set oap.image.tag&#x3D;8.2.0-es7 --set ui.image.tag&#x3D;8.2.0</span><br></pre></td></tr></table></figure><p>å¦‚æœå®‰è£…å‡ºé”™æˆ–è€…å…¶ä»–é—®é¢˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå¸è½½:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall &quot;$&#123;SKYWALKING_RELEASE_NAME&#125;&quot; skywalking -n &quot;$&#123;SKYWALKING_RELEASE_NAMESPACE&#125;&quot;</span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸååº”è¯¥åœ¨ <code>${SKYWALKING_RELEASE_NAMESPACE}</code> ä¸‹çœ‹åˆ°ç›¸å…³ Pod:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">k8s21 âœ  ~ kubectl get pod -o wide -n skywalking</span><br><span class="line">NAME                              READY   STATUS      RESTARTS   AGE   IP             NODE    NOMINATED NODE   READINESS GATES</span><br><span class="line">skywalking-es-init-xw6tx          0&#x2F;1     Completed   0          32h   10.30.0.62     k8s21   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">skywalking-oap-64c65cc6bb-lnq82   1&#x2F;1     Running     0          32h   10.30.0.61     k8s21   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">skywalking-oap-64c65cc6bb-q7zj8   1&#x2F;1     Running     0          32h   10.30.32.103   k8s22   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">skywalking-ui-695ff9d69d-wqcm8    1&#x2F;1     Running     0          32h   10.30.161.42   k8s25   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ç¡®è®¤ Pod éƒ½è¿è¡Œæ­£å¸¸åå¯ä»¥é€šè¿‡ <code>kubectl port-forward</code> å‘½ä»¤æ¥æŸ¥çœ‹ UI ç•Œé¢:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè®¿é—® 127.0.0.1:8080 å³å¯è®¿é—®åˆ° skywalking-ui</span><br><span class="line">kubectl port-forward -n $&#123;SKYWALKING_RELEASE_NAMESPACE&#125; service&#x2F;skywalking-ui 8080:80</span><br></pre></td></tr></table></figure><p><strong>åœ¨ç”Ÿäº§ç¯å¢ƒå¯èƒ½éœ€è¦é…ç½®æ­£ç¡®çš„ Ingress æˆ–è€… NodePort ç­‰æ–¹å¼æš´éœ² skywalking-ui æœåŠ¡ï¼Œå…·ä½“å–å†³äºç”Ÿäº§é›†ç¾¤æœåŠ¡æš´éœ²æ–¹å¼ï¼Œè¯·è‡ªè¡Œè°ƒæ•´ã€‚</strong></p><h2><span id="agent-é…ç½®">Agent é…ç½®</span></h2><blockquote><p>ç”±äºç›®å‰ä»…åœ¨ Java é¡¹ç›®ä¸Šæµ‹è¯•ï¼Œæ‰€ä»¥ä»¥ä¸‹ Agent é…ç½®ä»…ä»…å¯¹ Java é¡¹ç›®æœ‰æ•ˆã€‚</p></blockquote><p>Skywalking åœ¨ç®€å•ä½¿ç”¨æ—¶ä¸éœ€è¦ä¾µå…¥ä»£ç ï¼Œå¯¹äº jar åŒ…å¯åŠ¨çš„é¡¹ç›®åªéœ€è¦åœ¨å¯åŠ¨æ—¶å¢åŠ  <code>-javaagent</code> é€‰é¡¹å³å¯ã€‚</p><h3><span id="41-agent-è·å–">4.1ã€Agent è·å–</span></h3><p><code>javaagent</code> å¯ä»¥é€šè¿‡ä¸‹è½½å¯¹åº”çš„ skywalking release å®‰è£…åŒ…è·å–ï¼Œå°†æ­¤ <code>agent</code> ç›®å½•è§£å‹åˆ°ä»»æ„ä½ç½®ï¼Œç¨åå°†æ·»åŠ åˆ° java å¯åŠ¨å‚æ•°ã€‚</p><p><a href="https://cdn.oss.link/markdown/y1q3k.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/y1q3k-2021-01-10-frobUo.png" alt="agent_dir"></a></p><p><a href="https://cdn.oss.link/markdown/y1q3k.png" target="_blank" rel="noopener">agent_dir</a></p><h3><span id="42-agent-é…ç½®">4.2ã€Agent é…ç½®</span></h3><p>Agent ä¸»é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ <code>config/agent.config</code> é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æ–‡ä»¶å†…æ”¯æŒç¯å¢ƒå˜é‡è¯»å–ï¼Œå¯ä»¥è‡ªè¡Œæ·»åŠ å…¶ä»–é…ç½®å’Œå¼•ç”¨å…¶ä»–å˜é‡ï¼›é€šå¸¸è¿™ä¸ªé…ç½®æ–‡ä»¶åœ¨å®¹å™¨åŒ–æ—¶æœ‰ä¸¤ç§é€‰æ‹©ï¼Œ**ä¸€ç§æ˜¯åˆ›å»º ConfigMapï¼Œç„¶åé€šè¿‡ ConfigMap æŒ‚è½½åˆ°å®¹å™¨é‡Œè¿›è¡Œè¦†ç›–ï¼›å¦ä¸€ç§æ˜¯åœ¨é»˜è®¤é…ç½®é‡Œå¼•ç”¨å„ç§å˜é‡ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥ã€‚**è¿™é‡Œæš‚æ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥çš„æ–¹å¼:</p><p><strong>agent.config</strong></p><p><a href="https://cdn.oss.link/markdown/4t67x.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/4t67x-2021-01-10-3Y4bcU.png" alt="agent.config"></a></p><p><a href="https://cdn.oss.link/markdown/4t67x.png" target="_blank" rel="noopener">agent.config</a></p><p><strong>deployment.yml</strong></p><p><a href="https://cdn.oss.link/markdown/q0uw7.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/q0uw7-2021-01-10-o1GxOG.png" alt="deployment.yml"></a></p><p><a href="https://cdn.oss.link/markdown/q0uw7.png" target="_blank" rel="noopener">deployment.yml</a></p><p>è°ƒæ•´å®Œæˆåï¼Œåº”ç”¨è¿è¡Œä¸€æ®µæ—¶é—´ååº”è¯¥èƒ½åœ¨ UI ä¸­çœ‹åˆ°æ•°æ®</p><p><a href="https://cdn.oss.link/markdown/86vmo.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/86vmo-2021-01-10-2BmbMj.png" alt="skwalking-ui"></a></p><p><a href="https://cdn.oss.link/markdown/86vmo.png" target="_blank" rel="noopener">skwalking-ui</a></p><h2><span id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</span></h2><ul><li><strong>é»˜è®¤æƒ…å†µä¸‹ Helm ç›¸å…³å‘½ä»¤æ‰§è¡Œç¼“æ…¢ï¼Œå¯èƒ½éœ€è¦è®¾ç½® <code>http(s)_proxy</code> <code>...( ï¼¿ ï¼¿)ãƒï½œå£</code>(è‡ªè¡Œä½“ä¼šè¿™ä¸ªè¡¨æƒ…)</strong></li><li><strong>Skywalking é•œåƒä¸€èˆ¬æ¯”è¾ƒå¤§ï¼Œä¸‹è½½ç¼“æ…¢ï¼Œæ¨èé¢„å…ˆæ‹‰å–å¥½ç„¶å load åˆ°æ¯ä¸ªèŠ‚ç‚¹</strong></li><li><strong>ES å¦‚æœè®¾ç½®äº†å¯†ç ï¼Œä¸è¦å¿˜è®°åœ¨ Helm å®‰è£…æ—¶è°ƒæ•´å¥½å¯†ç é…ç½®</strong></li><li><strong>jar åŒ…å¯åŠ¨æ—¶ <code>-javaagent</code> ä¸èƒ½æ”¾åœ¨ <code>-jar</code> é€‰é¡¹ä¹‹åï¼Œå¦åˆ™å¯èƒ½ä¸ç”Ÿæ•ˆ</strong></li><li><strong>é›†ç¾¤å†…è¿æ¥ oap-server æ¨èé€šè¿‡ <code>skywalking-oap.skywalking.svc.cluster.local</code> åŸŸåæœåŠ¡å‘ç°æ–¹å¼å¯»å€</strong></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Bleem ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y4uwbmmb" target="_blank" rel="noopener">https://tinyurl.com/y4uwbmmb</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å…ˆå†³æ¡ä»¶&quot;&gt;å…ˆå†³æ¡ä»¶&lt;/h2&gt;
&lt;p&gt;ç¡®ä¿æœ‰ä¸€å¥—è¿è¡Œæ­£å¸¸çš„ Kubernetes é›†ç¾¤ï¼Œæœ¬æ–‡é»˜è®¤ä¸ºä½¿ç”¨ Elasticsearch7 ä½œä¸ºåç«¯å­˜å‚¨ï¼›**å¦‚æœæƒ³æŠŠ ES æ”¾åˆ° Kubernetes é›†ç¾¤é‡Œé‚£ä¹ˆè¿˜å¾—ç¡®ä¿é›†ç¾¤é…ç½®äº†æ­£ç¡®çš„å­˜å‚¨ï¼Œè­¬å¦‚é»˜è®¤çš„ StorageClass å¯ç”¨ç­‰ã€‚**æœ¬æ–‡ä¸ºäº†æ–¹ä¾¿èµ·è§(å…¶å®å°±æ˜¯ç©·)é‡‡ç”¨å¤–éƒ¨ ES å­˜å‚¨ä¸”ä½¿ç”¨ docker-compose å•èŠ‚ç‚¹éƒ¨ç½²ï¼Œæ‰€ä»¥ä¸éœ€è¦é›†ç¾¤çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼›æœ€åç¡®ä¿ä½ æœ¬åœ°çš„ &lt;code&gt;kubectl&lt;/code&gt; èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŸºæœ¬æ¶æ„&quot;&gt;åŸºæœ¬æ¶æ„&lt;/h2&gt;
&lt;p&gt;Skywalking åœ¨å¤§ä½“ä¸Š(ä¸å‡†ç¡®)åˆ†ä¸ºå››å¤§éƒ¨åˆ†:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;oap-server: æ— çŠ¶æ€æœåŠ¡åç«¯ï¼Œä¸»è¦è´Ÿè´£å¤„ç†æ ¸å¿ƒé€»è¾‘ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªæ ‡å‡† java web é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;skywalking-ui: UI å‰ç«¯ï¼Œé€šè¿‡ graphql è¿æ¥ oap-server æä¾›ç”¨æˆ·æŸ¥è¯¢ç­‰ UI å±•ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;agent: å„ç§è¯­è¨€å®ç°çš„ agent è´Ÿè´£æŠ“å–åº”ç”¨è¿è¡Œæ•°æ®å¹¶ä¸ŠæŠ¥ç»™ oap-serverï¼Œæ ¸å¿ƒçš„æŒ‡æ ‡ä¸ŠæŠ¥æ¥æºã€‚&lt;/li&gt;
&lt;li&gt;DB: å„ç§æ•°æ®åº“ï¼Œè´Ÿè´£å­˜å‚¨ Skywalking çš„æŒ‡æ ‡æ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒæ¨è ESã€TiDBã€MySQLã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="SkyWalking" scheme="https://www.hi-linux.com/categories/SkyWalking/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="SkyWalking" scheme="https://www.hi-linux.com/tags/SkyWalking/"/>
    
  </entry>
  
  <entry>
    <title>Linux ä¸‹è‡ªåŠ¨åŒ–å·¥å…· Parallel SSH ä¸­æ–‡ä½¿ç”¨æŒ‡å—</title>
    <link href="https://www.hi-linux.com/posts/53648.html"/>
    <id>https://www.hi-linux.com/posts/53648.html</id>
    <published>2021-03-31T01:00:00.000Z</published>
    <updated>2021-03-31T04:42:44.961Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p><strong>parallel-ssh æ˜¯ä¸ºå°è§„æ¨¡è‡ªåŠ¨åŒ–è€Œè®¾è®¡çš„å¼‚æ­¥å¹¶è¡Œçš„ SSH åº“!</strong></p></blockquote><p><strong><code>parallel-ssh</code></strong> æ˜¯ä¸ºå°è§„æ¨¡è‡ªåŠ¨åŒ–è€Œè®¾è®¡çš„å¼‚æ­¥å¹¶è¡Œçš„ <code>SSH</code> åº“ï¼ŒåŒ…æ‹¬ <code>pssh</code>ã€<code>pscp</code>ã€<code>prsync</code>ã€<code>pslurp</code> å’Œ <code>pnuke</code>å·¥å…·ï¼Œå…¶æºä»£ç ä½¿ç”¨ <code>Python</code>è¯­è¨€ç¼–å†™å¼€å‘çš„ã€‚è¯¥é¡¹ç›®æœ€åˆä½äº<code>Google Code</code>ä¸Šï¼Œæ˜¯ç”±<code>Brent N.Chun</code>ç¼–å†™å’Œç»´æŠ¤çš„ï¼Œä½†æ˜¯ç”±äºå·¥ä½œç¹å¿™ï¼Œ<code>Brent</code>äº<code>2009</code>å¹´<code>10</code>æœˆå°†ç»´æŠ¤å·¥ä½œç§»äº¤ç»™äº†<code>Andrew McNabb</code>ç®¡ç†ã€‚åˆ°äº† <code>2012</code>å¹´çš„æ—¶å€™ï¼Œç”±äº<code>Google Code</code>çš„å·²å…³é—­ï¼Œè¯¥é¡¹ç›®ä¸€åº¦è¢«åºŸå¼ƒï¼Œç°åœ¨ä¹Ÿåªèƒ½åœ¨ <code>Google Code</code> çš„å½’æ¡£ä¸­æ‰¾åˆ°å½“æ—¶çš„ç‰ˆæœ¬äº†ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒ <code>Python3</code> çš„ï¼Œä½†æ˜¯ <code>Github</code> ä¸Šé¢æœ‰äºº <code>Fork</code> äº†ä¸€ä»½ï¼Œè‡ªå·±è¿›è¡Œäº†æ”¹é€ ä½¿å…¶æ”¯æŒ <code>Python3</code> ä»¥ä¸Šçš„ç‰ˆæœ¬äº†ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªç»„ç»‡ä¸“é—¨é’ˆå¯¹ <code>parallel-ssh</code> è¿›è¡Œäº†å¼€å‘å’Œç»´æŠ¤ï¼Œä»Šå¤©çœ‹äº†ä¸‹å¾ˆä¹…éƒ½æ²¡æœ‰æ›´æ–°äº†ã€‚æœ‰éœ€è¦çš„ï¼Œè‡ªå·±å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚</p><ul><li><p><a href="https://github.com/lilydjwg/pssh" target="_blank" rel="noopener">lilydjwg/pssh - supported on Python 3.5 and later</a></p></li><li><p><a href="https://github.com/ParallelSSH/parallel-ssh" target="_blank" rel="noopener">ParallelSSH/parallel-ssh - asynchronous parallel SSH client library</a></p></li><li><p>å¯æ‰©å±•æ€§</p><ul><li>æ”¯æŒæ‰©å±•åˆ°ç™¾å°ï¼Œç”šè‡³ä¸Šåƒå°ä¸»æœºä½¿ç”¨</li></ul></li><li><p>æ˜“äºä½¿ç”¨</p><ul><li>åªéœ€ä¸¤è¡Œä»£ç ï¼Œå³å¯åœ¨ä»»æ„æ•°é‡çš„ä¸»æœºä¸Šè¿è¡Œå‘½ä»¤</li></ul></li><li><p>æ‰§è¡Œé«˜æ•ˆ</p><ul><li>å·ç§°æ˜¯æœ€å¿«çš„ <code>Python SSH</code> åº“å¯ç”¨</li></ul></li><li><p>èµ„æºä½¿ç”¨</p><ul><li>ç›¸æ¯”äºå…¶ä»– <code>Python SSH</code> åº“ï¼Œå…¶æ¶ˆè€—èµ„æºæœ€å°‘</li></ul></li></ul><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Macç³»ç»Ÿå®‰è£…</span></span><br><span class="line">$ brew install pssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOSç³»ç»Ÿå®‰è£…</span></span><br><span class="line">$ yum install pssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntuç³»ç»Ÿå®‰è£…</span></span><br><span class="line">$ apt install pssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># PIPå®‰è£…</span></span><br><span class="line">$ pip insall pssh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æºä»£ç ç¼–è¯‘å®‰è£…(2.3.1)</span></span><br><span class="line"><span class="comment"># å®˜æ–¹åœ°å€: https://code.google.com/archive/p/parallel-ssh/source/default/source</span></span><br><span class="line">$ tar zxvf pssh-2.3.1.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> pssh-2.3.1</span><br><span class="line">$ python setup.py install</span><br></pre></td></tr></table></figure><p><img src="https://img.hi-linux.com/staticfile/learn-pssh-command-1-2021-01-27-TVMY3S.png" alt="ParallelSSHåœ¨Googleä¸Šé¢çš„ç‰ˆæœ¬"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å·¥å…·å¯¹åº”çš„å­å‘½ä»¤å­å‘½ä»¤</span></span><br><span class="line">$ ls -lh /usr/<span class="built_in">local</span>/Cellar/pssh/2.3.1_1/bin/</span><br><span class="line">pnuke -&gt; ../libexec/bin/pnuke</span><br><span class="line">prsync -&gt; ../libexec/bin/prsync</span><br><span class="line">pscp -&gt; ../libexec/bin/pscp</span><br><span class="line">pslurp -&gt; ../libexec/bin/pslurp</span><br><span class="line">pssh -&gt; ../libexec/bin/pssh</span><br><span class="line">pssh-askpass -&gt; ../libexec/bin/pssh-askpass</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">ç¼–å·</th><th style="text-align:left">å­å‘½ä»¤</th><th style="text-align:left">å¯¹åº”åŠŸèƒ½è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><strong><code>pssh</code></strong></td><td style="text-align:left">é€šè¿‡ ssh åè®®åœ¨å¤šå°ä¸»æœºä¸Šå¹¶è¡Œåœ°è¿è¡Œå‘½ä»¤</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><strong><code>pscp</code></strong></td><td style="text-align:left">é€šè¿‡ ssh åè®®æŠŠæ–‡ä»¶å¹¶è¡Œåœ°å¤åˆ¶åˆ°å¤šå°ä¸»æœºä¸Š</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><strong><code>rsync</code></strong></td><td style="text-align:left">é€šè¿‡ rsync åè®®æŠŠæ–‡ä»¶é«˜æ•ˆåœ°å¹¶è¡Œå¤åˆ¶åˆ°å¤šå°ä¸»æœºä¸Š</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><strong><code>slurp</code></strong></td><td style="text-align:left">é€šè¿‡ ssh åè®®æŠŠæ–‡ä»¶å¹¶è¡Œåœ°ä»å¤šä¸ªè¿œç¨‹ä¸»æœºå¤åˆ¶åˆ°ä¸­å¿ƒä¸»æœºä¸Š</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><strong><code>pnuke</code></strong></td><td style="text-align:left">é€šè¿‡ ssh åè®®å¹¶è¡Œåœ°åœ¨å¤šä¸ªè¿œç¨‹ä¸»æœºä¸Šæ€æ­»è¿›ç¨‹</td></tr></tbody></table><h2><span id="1-pssh">1. pssh</span></h2><blockquote><p><strong>é€šè¿‡ ssh åè®®åœ¨å¤šå°ä¸»æœºä¸Šå¹¶è¡Œåœ°è¿è¡Œå‘½ä»¤</strong></p></blockquote><ul><li><strong>å‘½ä»¤å‚æ•°ä½¿ç”¨</strong></li></ul><table><thead><tr><th style="text-align:left">ç¼–å·</th><th style="text-align:left">å‚æ•°é€‰é¡¹</th><th style="text-align:left">å¯¹åº”å‚æ•°è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><code>-h HOST_FILE</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºæ–‡ä»¶åˆ—è¡¨æ–‡ä»¶ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><code>-H HOST_STRING</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºå­—ç¬¦ä¸²åœ°å€ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><code>-l USER</code></td><td style="text-align:left">æŒ‡å®šç™»å½•ä½¿ç”¨çš„ç”¨æˆ·å</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><code>-p PAR</code></td><td style="text-align:left">è®¾ç½®å¹¶å‘çš„çº¿ç¨‹æ•°(å¯é€‰)</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><code>-o OUTDIR</code></td><td style="text-align:left">æ ‡å‡†æ­£å¸¸è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><code>-e ERRDIR</code></td><td style="text-align:left">æ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><code>-t TIMEOUT</code></td><td style="text-align:left">è¶…æ—¶æ—¶é—´è®¾ç½®ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— é™åˆ¶(å¯é€‰)</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><code>-O OPTION</code></td><td style="text-align:left">è®¾ç½® SSH çš„é€‰é¡¹</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><code>-x ARGS</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ä½¿ç”¨ç©ºç™½ç¬¦å·ã€å¼•å·ã€åæ–œçº¿å¤„ç†</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left"><code>-X ARG</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå•ä¸ªå‚æ•°æ¨¡å¼ï¼ŒåŒ-x å‚æ•°</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left"><code>-A</code></td><td style="text-align:left">æ‰‹åŠ¨è¾“å…¥å¯†ç æ¨¡å¼</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><code>-i</code></td><td style="text-align:left">æ¯ä¸ªæœåŠ¡å™¨å†…éƒ¨å¤„ç†ä¿¡æ¯è¾“å‡º</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left"><code>-P</code></td><td style="text-align:left">æ‰“å°å‡ºæœåŠ¡å™¨è¿”å›ä¿¡æ¯</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æŸ¥çœ‹å¸®åŠ©ï¼Œå³æ­¤ä¿¡æ¯</td></tr><tr><td style="text-align:left">15</td><td style="text-align:left"><code>--version</code></td><td style="text-align:left">æ˜¾ç¤ºç¨‹åºç‰ˆæœ¬å·</td></tr></tbody></table><ul><li><strong>é€‚ç”¨èŒƒä¾‹</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: pssh [OPTIONS] command [...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸¤ä¸ªä¸»æœºä¸Šè¿è¡Œå‘½ä»¤å¹¶åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šæ‰“å°å…¶è¾“å‡º</span></span><br><span class="line">$ pssh -i -H <span class="string">"host1 host2"</span> hostname -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå‘½ä»¤å¹¶å°†è¾“å‡ºä¿å­˜åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­</span></span><br><span class="line">$ pssh -H host1 -H host2 -o path/to/output_dir hostname -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å¤šä¸ªä¸»æœºä¸Šè¿è¡Œå‘½ä»¤å¹¶åœ¨æ–°è¡Œåˆ†éš”çš„æ–‡ä»¶ä¸­æŒ‡å®š</span></span><br><span class="line">$ pssh -i -h path/to/hosts_file hostname -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥rootè¿è¡Œå‘½ä»¤(è¦æ±‚è¾“å…¥rootç”¨æˆ·å¯†ç )</span></span><br><span class="line">$ pssh -i -h path/to/hosts_file -A -l root_username hostname -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå¸¦æœ‰é¢å¤–SSHå‚æ•°çš„å‘½ä»¤</span></span><br><span class="line">$ pssh -i -h path/to/hosts_file -x <span class="string">"-O VisualHostKey=yes"</span> hostname -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå¹¶è¡Œè¿æ¥æ•°é‡é™åˆ¶ä¸º10çš„å‘½ä»¤</span></span><br><span class="line">$ pssh -i -h path/to/hosts_file -p 10 <span class="string">'cd dir; ./script.sh; exit'</span></span><br></pre></td></tr></table></figure><h2><span id="2-pscp">2. pscp</span></h2><blockquote><p><strong>é€šè¿‡ ssh åè®®æŠŠæ–‡ä»¶å¹¶è¡Œåœ°å¤åˆ¶åˆ°å¤šå°ä¸»æœºä¸Š</strong></p></blockquote><ul><li><strong>å‘½ä»¤å‚æ•°ä½¿ç”¨</strong></li></ul><table><thead><tr><th style="text-align:left">ç¼–å·</th><th style="text-align:left">å‚æ•°é€‰é¡¹</th><th style="text-align:left">å¯¹åº”å‚æ•°è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><code>-h HOST_FILE</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºæ–‡ä»¶åˆ—è¡¨æ–‡ä»¶ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><code>-H HOST_STRING</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºå­—ç¬¦ä¸²åœ°å€ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><code>-l USER</code></td><td style="text-align:left">æŒ‡å®šç™»å½•ä½¿ç”¨çš„ç”¨æˆ·å</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><code>-p PAR</code></td><td style="text-align:left">è®¾ç½®å¹¶å‘çš„çº¿ç¨‹æ•°(å¯é€‰)</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><code>-o OUTDIR</code></td><td style="text-align:left">æ ‡å‡†æ­£å¸¸è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><code>-e ERRDIR</code></td><td style="text-align:left">æ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><code>-t TIMEOUT</code></td><td style="text-align:left">è¶…æ—¶æ—¶é—´è®¾ç½®ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— é™åˆ¶(å¯é€‰)</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><code>-O OPTION</code></td><td style="text-align:left">è®¾ç½® SSH çš„é€‰é¡¹</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><code>-x ARGS</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ä½¿ç”¨ç©ºç™½ç¬¦å·ã€å¼•å·ã€åæ–œçº¿å¤„ç†</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left"><code>-X ARG</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå•ä¸ªå‚æ•°æ¨¡å¼ï¼ŒåŒ-x å‚æ•°</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left"><code>-A</code></td><td style="text-align:left">æ‰‹åŠ¨è¾“å…¥å¯†ç æ¨¡å¼</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><code>-r</code></td><td style="text-align:left">ç”¨äºé€’å½’çš„å¤åˆ¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æŸ¥çœ‹å¸®åŠ©ï¼Œå³æ­¤ä¿¡æ¯</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left"><code>--version</code></td><td style="text-align:left">æ˜¾ç¤ºç¨‹åºç‰ˆæœ¬å·</td></tr></tbody></table><ul><li><strong>é€‚ç”¨èŒƒä¾‹</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: pscp [OPTIONS] local remote</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æœ¬åœ°æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨ä¸Š</span></span><br><span class="line">$ pscp -h hosts.txt -l root foo.txt /home/irb2/foo.txt</span><br><span class="line">[1] 23:00:08 [SUCCESS] 172.18.10.25</span><br><span class="line">[2] 09:52:28 [SUCCESS] 172.18.10.24</span><br></pre></td></tr></table></figure><h2><span id="3-prsync">3. prsync</span></h2><blockquote><p><strong>é€šè¿‡ rsync åè®®æŠŠæ–‡ä»¶é«˜æ•ˆåœ°å¹¶è¡Œå¤åˆ¶åˆ°å¤šå°ä¸»æœºä¸Š</strong></p></blockquote><ul><li><strong>å‘½ä»¤å‚æ•°ä½¿ç”¨</strong></li></ul><table><thead><tr><th style="text-align:left">ç¼–å·</th><th style="text-align:left">å‚æ•°é€‰é¡¹</th><th style="text-align:left">å¯¹åº”å‚æ•°è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><code>-h HOST_FILE</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºæ–‡ä»¶åˆ—è¡¨æ–‡ä»¶ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><code>-H HOST_STRING</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºå­—ç¬¦ä¸²åœ°å€ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><code>-l USER</code></td><td style="text-align:left">æŒ‡å®šç™»å½•ä½¿ç”¨çš„ç”¨æˆ·å</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><code>-p PAR</code></td><td style="text-align:left">è®¾ç½®å¹¶å‘çš„çº¿ç¨‹æ•°(å¯é€‰)</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><code>-o OUTDIR</code></td><td style="text-align:left">æ ‡å‡†æ­£å¸¸è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><code>-e ERRDIR</code></td><td style="text-align:left">æ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><code>-t TIMEOUT</code></td><td style="text-align:left">è¶…æ—¶æ—¶é—´è®¾ç½®ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— é™åˆ¶(å¯é€‰)</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><code>-O OPTION</code></td><td style="text-align:left">è®¾ç½® SSH çš„é€‰é¡¹</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><code>-x ARGS</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ä½¿ç”¨ç©ºç™½ç¬¦å·ã€å¼•å·ã€åæ–œçº¿å¤„ç†</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left"><code>-X ARG</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå•ä¸ªå‚æ•°æ¨¡å¼ï¼ŒåŒ-x å‚æ•°</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left"><code>-A</code></td><td style="text-align:left">æ‰‹åŠ¨è¾“å…¥å¯†ç æ¨¡å¼</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><code>-r</code></td><td style="text-align:left">ç”¨äºé€’å½’çš„å¤åˆ¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><code>-a</code></td><td style="text-align:left">ä½¿ç”¨ rsync çš„å½’æ¡£æ¨¡å¼(å¯é€‰)</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><code>-z</code></td><td style="text-align:left">ä½¿ç”¨ rsync çš„å‹ç¼©æ–¹å¼(å¯é€‰</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><code>-S ARGS</code></td><td style="text-align:left">è®¾ç½® ssh åè®®çš„æ‰©å±•å‚æ•°(å¯é€‰)</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æŸ¥çœ‹å¸®åŠ©ï¼Œå³æ­¤ä¿¡æ¯</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left"><code>--version</code></td><td style="text-align:left">æ˜¾ç¤ºç¨‹åºç‰ˆæœ¬å·</td></tr></tbody></table><ul><li><strong>é€‚ç”¨èŒƒä¾‹</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: prsync [OPTIONS] local remote</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨rsyncåè®®è¿›è¡Œæœ¬åœ°æ–‡ä»¶å¤åˆ¶æ“ä½œ</span></span><br><span class="line">$ prsync -r -h hosts.txt -l root foo /home/irb2/foo</span><br></pre></td></tr></table></figure><h2><span id="4-pslurp">4. pslurp</span></h2><blockquote><p><strong>é€šè¿‡ ssh åè®®æŠŠæ–‡ä»¶å¹¶è¡Œåœ°ä»å¤šä¸ªè¿œç¨‹ä¸»æœºå¤åˆ¶åˆ°ä¸­å¿ƒä¸»æœºä¸Š</strong></p></blockquote><ul><li><strong>å‘½ä»¤å‚æ•°ä½¿ç”¨</strong></li></ul><table><thead><tr><th style="text-align:left">ç¼–å·</th><th style="text-align:left">å‚æ•°é€‰é¡¹</th><th style="text-align:left">å¯¹åº”å‚æ•°è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><code>-h HOST_FILE</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºæ–‡ä»¶åˆ—è¡¨æ–‡ä»¶ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><code>-H HOST_STRING</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºå­—ç¬¦ä¸²åœ°å€ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><code>-l USER</code></td><td style="text-align:left">æŒ‡å®šç™»å½•ä½¿ç”¨çš„ç”¨æˆ·å</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><code>-p PAR</code></td><td style="text-align:left">è®¾ç½®å¹¶å‘çš„çº¿ç¨‹æ•°(å¯é€‰)</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><code>-o OUTDIR</code></td><td style="text-align:left">æ ‡å‡†æ­£å¸¸è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><code>-e ERRDIR</code></td><td style="text-align:left">æ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><code>-t TIMEOUT</code></td><td style="text-align:left">è¶…æ—¶æ—¶é—´è®¾ç½®ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— é™åˆ¶(å¯é€‰)</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><code>-O OPTION</code></td><td style="text-align:left">è®¾ç½® SSH çš„é€‰é¡¹</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><code>-x ARGS</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ä½¿ç”¨ç©ºç™½ç¬¦å·ã€å¼•å·ã€åæ–œçº¿å¤„ç†</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left"><code>-X ARG</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå•ä¸ªå‚æ•°æ¨¡å¼ï¼ŒåŒ-x å‚æ•°</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left"><code>-A</code></td><td style="text-align:left">æ‰‹åŠ¨è¾“å…¥å¯†ç æ¨¡å¼</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><code>-r</code></td><td style="text-align:left">ç”¨äºé€’å½’çš„å¤åˆ¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left"><code>-L LOCALDIR</code></td><td style="text-align:left">æŒ‡å®šæœ¬åœ°å­˜æ”¾æ–‡ä»¶çš„ç›®å½•</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æŸ¥çœ‹å¸®åŠ©ï¼Œå³æ­¤ä¿¡æ¯</td></tr><tr><td style="text-align:left">15</td><td style="text-align:left"><code>--version</code></td><td style="text-align:left">æ˜¾ç¤ºç¨‹åºç‰ˆæœ¬å·</td></tr></tbody></table><ul><li><strong>é€‚ç”¨èŒƒä¾‹</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: pslurp [OPTIONS] remote local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è¿œç¨‹ä¸»æœºä¸Šé¢çš„æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°</span></span><br><span class="line">$ pslurp -h hosts.txt -l root -L /tmp/outdir /home/irb2/foo.txt foo.txt</span><br></pre></td></tr></table></figure><h2><span id="5-pnuke">5. pnuke</span></h2><blockquote><p><strong>é€šè¿‡ ssh åè®®å¹¶è¡Œåœ°åœ¨å¤šä¸ªè¿œç¨‹ä¸»æœºä¸Šæ€æ­»è¿›ç¨‹</strong></p></blockquote><ul><li><strong>å‘½ä»¤å‚æ•°ä½¿ç”¨</strong></li></ul><table><thead><tr><th style="text-align:left">ç¼–å·</th><th style="text-align:left">å‚æ•°é€‰é¡¹</th><th style="text-align:left">å¯¹åº”å‚æ•°è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><code>-h HOST_FILE</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºæ–‡ä»¶åˆ—è¡¨æ–‡ä»¶ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><code>-H HOST_STRING</code></td><td style="text-align:left">æŒ‡å®šä¸»æœºå­—ç¬¦ä¸²åœ°å€ï¼›å†…å®¹æ ¼å¼ä¸ºâ€[user@]host[:port]â€</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><code>-l USER</code></td><td style="text-align:left">æŒ‡å®šç™»å½•ä½¿ç”¨çš„ç”¨æˆ·å</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><code>-p PAR</code></td><td style="text-align:left">è®¾ç½®å¹¶å‘çš„çº¿ç¨‹æ•°(å¯é€‰)</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><code>-o OUTDIR</code></td><td style="text-align:left">æ ‡å‡†æ­£å¸¸è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><code>-e ERRDIR</code></td><td style="text-align:left">æ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶ç›®å½•(å¯é€‰)</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><code>-t TIMEOUT</code></td><td style="text-align:left">è¶…æ—¶æ—¶é—´è®¾ç½®ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— é™åˆ¶(å¯é€‰)</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><code>-O OPTION</code></td><td style="text-align:left">è®¾ç½® SSH çš„é€‰é¡¹</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><code>-x ARGS</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ä½¿ç”¨ç©ºç™½ç¬¦å·ã€å¼•å·ã€åæ–œçº¿å¤„ç†</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left"><code>-X ARG</code></td><td style="text-align:left">é¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå•ä¸ªå‚æ•°æ¨¡å¼ï¼ŒåŒ-x å‚æ•°</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left"><code>-A</code></td><td style="text-align:left">æ‰‹åŠ¨è¾“å…¥å¯†ç æ¨¡å¼</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æŸ¥çœ‹å¸®åŠ©ï¼Œå³æ­¤ä¿¡æ¯</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left"><code>--version</code></td><td style="text-align:left">æ˜¾ç¤ºç¨‹åºç‰ˆæœ¬å·</td></tr></tbody></table><ul><li><strong>é€‚ç”¨èŒƒä¾‹</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: pnuke [OPTIONS] pattern</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æŸè¿œç¨‹ä¸»æœºä¸Šé¢çš„è¿›ç¨‹ä»»åŠ¡</span></span><br><span class="line">$ pnuke -h hosts.txt -l root java</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Escape çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y2zucscu%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/y2zucscuï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;parallel-ssh æ˜¯ä¸ºå°è§„æ¨¡è‡ªåŠ¨åŒ–è€Œè®¾è®¡çš„å¼‚æ­¥å¹¶è¡Œçš„ SSH åº“!&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;parallel-ssh&lt;/code&gt;&lt;/strong&gt; æ˜¯ä¸ºå°è§„æ¨¡è‡ªåŠ¨åŒ–è€Œè®¾è®¡çš„å¼‚æ­¥å¹¶è¡Œçš„ &lt;code&gt;SSH&lt;/code&gt; åº“ï¼ŒåŒ…æ‹¬ &lt;code&gt;pssh&lt;/code&gt;ã€&lt;code&gt;pscp&lt;/code&gt;ã€&lt;code&gt;prsync&lt;/code&gt;ã€&lt;code&gt;pslurp&lt;/code&gt; å’Œ &lt;code&gt;pnuke&lt;/code&gt;å·¥å…·ï¼Œå…¶æºä»£ç ä½¿ç”¨ &lt;code&gt;Python&lt;/code&gt;è¯­è¨€ç¼–å†™å¼€å‘çš„ã€‚è¯¥é¡¹ç›®æœ€åˆä½äº&lt;code&gt;Google Code&lt;/code&gt;ä¸Šï¼Œæ˜¯ç”±&lt;code&gt;Brent N.Chun&lt;/code&gt;ç¼–å†™å’Œç»´æŠ¤çš„ï¼Œä½†æ˜¯ç”±äºå·¥ä½œç¹å¿™ï¼Œ&lt;code&gt;Brent&lt;/code&gt;äº&lt;code&gt;2009&lt;/code&gt;å¹´&lt;code&gt;10&lt;/code&gt;æœˆå°†ç»´æŠ¤å·¥ä½œç§»äº¤ç»™äº†&lt;code&gt;Andrew McNabb&lt;/code&gt;ç®¡ç†ã€‚åˆ°äº† &lt;code&gt;2012&lt;/code&gt;å¹´çš„æ—¶å€™ï¼Œç”±äº&lt;code&gt;Google Code&lt;/code&gt;çš„å·²å…³é—­ï¼Œè¯¥é¡¹ç›®ä¸€åº¦è¢«åºŸå¼ƒï¼Œç°åœ¨ä¹Ÿåªèƒ½åœ¨ &lt;code&gt;Google Code&lt;/code&gt; çš„å½’æ¡£ä¸­æ‰¾åˆ°å½“æ—¶çš„ç‰ˆæœ¬äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒ &lt;code&gt;Python3&lt;/code&gt; çš„ï¼Œä½†æ˜¯ &lt;code&gt;Github&lt;/code&gt; ä¸Šé¢æœ‰äºº &lt;code&gt;Fork&lt;/code&gt; äº†ä¸€ä»½ï¼Œè‡ªå·±è¿›è¡Œäº†æ”¹é€ ä½¿å…¶æ”¯æŒ &lt;code&gt;Python3&lt;/code&gt; ä»¥ä¸Šçš„ç‰ˆæœ¬äº†ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªç»„ç»‡ä¸“é—¨é’ˆå¯¹ &lt;code&gt;parallel-ssh&lt;/code&gt; è¿›è¡Œäº†å¼€å‘å’Œç»´æŠ¤ï¼Œä»Šå¤©çœ‹äº†ä¸‹å¾ˆä¹…éƒ½æ²¡æœ‰æ›´æ–°äº†ã€‚æœ‰éœ€è¦çš„ï¼Œè‡ªå·±å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/lilydjwg/pssh&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;lilydjwg/pssh - supported on Python 3.5 and later&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ParallelSSH/parallel-ssh&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ParallelSSH/parallel-ssh - asynchronous parallel SSH client library&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯æ‰©å±•æ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒæ‰©å±•åˆ°ç™¾å°ï¼Œç”šè‡³ä¸Šåƒå°ä¸»æœºä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ˜“äºä½¿ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªéœ€ä¸¤è¡Œä»£ç ï¼Œå³å¯åœ¨ä»»æ„æ•°é‡çš„ä¸»æœºä¸Šè¿è¡Œå‘½ä»¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰§è¡Œé«˜æ•ˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·ç§°æ˜¯æœ€å¿«çš„ &lt;code&gt;Python SSH&lt;/code&gt; åº“å¯ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;èµ„æºä½¿ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›¸æ¯”äºå…¶ä»– &lt;code&gt;Python SSH&lt;/code&gt; åº“ï¼Œå…¶æ¶ˆè€—èµ„æºæœ€å°‘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="SSH" scheme="https://www.hi-linux.com/tags/SSH/"/>
    
  </entry>
  
  <entry>
    <title>è¶…å®ç”¨çš„å®¹å™¨é•œåƒæ¼æ´æ£€æµ‹å·¥å…· Trivy å…¥é—¨æŒ‡å—</title>
    <link href="https://www.hi-linux.com/posts/17574.html"/>
    <id>https://www.hi-linux.com/posts/17574.html</id>
    <published>2021-03-29T01:00:00.000Z</published>
    <updated>2021-03-29T01:34:20.681Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2><span id="trivy-çš„ç‰¹å¾">Trivy çš„ç‰¹å¾</span></h2><p>Trivy æ˜¯ä¸€ç§é€‚ç”¨äº CI çš„ç®€å•è€Œå…¨é¢çš„å®¹å™¨æ¼æ´æ‰«æç¨‹åºã€‚è½¯ä»¶æ¼æ´æ˜¯æŒ‡è½¯ä»¶æˆ–æ“ä½œç³»ç»Ÿä¸­å­˜åœ¨çš„æ•…éšœã€ç¼ºé™·æˆ–å¼±ç‚¹ã€‚Trivy æ£€æµ‹æ“ä½œç³»ç»ŸåŒ…ï¼ˆAlpineã€RHELã€CentOSç­‰ï¼‰å’Œåº”ç”¨ç¨‹åºä¾èµ–ï¼ˆBundlerã€Composerã€npmã€yarnç­‰ï¼‰çš„æ¼æ´ã€‚</p><p>Trivy å¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œåªè¦å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±å¯ä»¥æ‰«æäº†ã€‚æ‰«æåªéœ€æŒ‡å®šå®¹å™¨çš„é•œåƒåç§°ã€‚ä¸å…¶ä»–é•œåƒæ‰«æå·¥å…·ç›¸æ¯”ï¼Œä¾‹å¦‚ Clairï¼ŒAnchore Engineï¼ŒQuay ç›¸æ¯”ï¼ŒTrivy åœ¨å‡†ç¡®æ€§ã€æ–¹ä¾¿æ€§å’Œå¯¹ CI çš„æ”¯æŒç­‰æ–¹é¢éƒ½æœ‰ç€æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚</p><p>æ¨èåœ¨ CI ä¸­ä½¿ç”¨å®ƒï¼Œåœ¨æ¨é€åˆ° Container Registry ä¹‹å‰ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°æ‰«ææœ¬åœ°å®¹å™¨é•œåƒï¼ŒTrivyå…·å¤‡å¦‚ä¸‹çš„ç‰¹å¾ï¼š</p><ol><li><p>æ£€æµ‹é¢å¾ˆå…¨ï¼Œèƒ½æ£€æµ‹å…¨é¢çš„æ¼æ´ï¼Œæ“ä½œç³»ç»Ÿè½¯ä»¶åŒ…ï¼ˆAlpineã€Red Hat Universal Base Imageã€Red Hat Enterprise Linuxã€CentOSã€Oracle Linuxã€Debianã€Ubuntuã€Amazon Linuxã€openSUSE Leapã€SUSE Enterprise Linuxã€Photon OS å’Œ Distriolessï¼‰ã€åº”ç”¨ç¨‹åºä¾èµ–é¡¹ï¼ˆBundlerã€Composerã€Pipenvã€Poetryã€npmã€yarn å’Œ Cargoï¼‰ï¼›</p></li><li><p>ä½¿ç”¨ç®€å•ï¼Œä»…ä»…åªéœ€è¦æŒ‡å®šé•œåƒåç§°ï¼›</p></li><li><p>æ‰«æå¿«ä¸”æ— çŠ¶æ€ï¼Œç¬¬ä¸€æ¬¡æ‰«æå°†åœ¨ 10 ç§’å†…å®Œæˆï¼ˆå–å†³äºæ‚¨çš„ç½‘ç»œï¼‰ã€‚éšåçš„æ‰«æå°†åœ¨ä¸€ç§’é’Ÿå†…å®Œæˆã€‚ä¸å…¶ä»–æ‰«æå™¨åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶éœ€è¦å¾ˆé•¿æ—¶é—´ï¼ˆå¤§çº¦10åˆ†é’Ÿï¼‰æ¥è·å–æ¼æ´ä¿¡æ¯ï¼Œå¹¶é¼“åŠ±æ‚¨ç»´æŠ¤æŒä¹…çš„æ¼æ´æ•°æ®åº“ä¸åŒï¼ŒTrivy æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸éœ€è¦ç»´æŠ¤æˆ–å‡†å¤‡ï¼›</p></li><li><p>æ˜“äºå®‰è£…ï¼Œå®‰è£…æ–¹å¼ï¼š</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install trivy</span><br><span class="line">$ yum install trivy</span><br><span class="line">$ brew install trivy</span><br></pre></td></tr></table></figure><p>æ— éœ€å®‰è£…æ•°æ®åº“ã€åº“ç­‰å…ˆå†³æ¡ä»¶ï¼ˆä¾‹å¤–æƒ…å†µæ˜¯éœ€è¦å®‰è£… rpm ä»¥æ‰«æåŸºäº RHEL/CentOS çš„å›¾åƒï¼‰ã€‚</p><a id="more"></a><h2><span id="trivy-çš„å®‰è£…">Trivy çš„å®‰è£…</span></h2><p>è¿™é‡Œå®‰è£… Trivy çš„ç¯å¢ƒæ˜¯ Centos7ï¼Œå®‰è£…çš„ç‰ˆæœ¬æ˜¯ 0.16.0ï¼Œå®‰è£…çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ wget https:&#x2F;&#x2F;github.com&#x2F;aquasecurity&#x2F;trivy&#x2F;releases&#x2F;download&#x2F;v0.16.0&#x2F;trivy_0.16.0_Linux-64bit.rpm</span><br><span class="line"></span><br><span class="line">$ rpm -ivh trivy_0.16.0_Linux-64bit.rpm</span><br><span class="line">å‡†å¤‡ä¸­...                          ################################# [100%]</span><br><span class="line">æ­£åœ¨å‡çº§&#x2F;å®‰è£…...</span><br><span class="line">   1:trivy-0:0.16.0-1                 ################################# [100%]</span><br><span class="line"></span><br><span class="line">$ trivy -v</span><br><span class="line">Version: 0.16.0</span><br></pre></td></tr></table></figure><h2><span id="trivy-çš„ç®€å•ä½¿ç”¨">Trivy çš„ç®€å•ä½¿ç”¨</span></h2><p>ä¸‹é¢ä»‹ç»ä¸€äº› Trivy çš„ç®€å•ä½¿ç”¨çš„å‘½ä»¤å’Œä¸€äº›æµ‹è¯•çš„ç»“æœã€‚ä¸»è¦ä»å‡ ä¸ªæ–¹é¢æ¥æµ‹è¯• Trivy çš„æ€§èƒ½æŒ‡æ ‡ï¼š</p><ul><li>é•œåƒå¤§å°å¯¹ Trivy æ‰«æé€Ÿåº¦çš„å½±å“ï¼›</li><li>æ‰«æçš„é•œåƒå¤§å°å’Œç½‘ç»œæµé‡ä½¿ç”¨æƒ…å†µçš„å…³ç³»ï¼›</li><li>æ‰«æçš„ç»“æœæ˜¯å¦å®¹æ˜“è§£æï¼›</li></ul><h3><span id="é•œåƒå¤§å°å¯¹-trivy-æ‰«æé€Ÿåº¦çš„å½±å“">é•œåƒå¤§å°å¯¹ Trivy æ‰«æé€Ÿåº¦çš„å½±å“</span></h3><ul><li>å½“é•œåƒä½äºæœ¬åœ°ï¼Œå¤§å° 90MB å·¦å³æ—¶å€™çš„æ‰«æï¼š</li></ul><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy registry.cn-hangzhou.aliyuncs.com&#x2F;choerodon-tools&#x2F;javabase:0.5.0</span><br></pre></td></tr></table></figure><p>æ‰«æç»“æœï¼š</p><p><img src="https://img.hi-linux.com/staticfile/trivy-2-2021-03-23-8gwNk2.png" alt></p><p>æ—¶é—´ï¼šç¬¬ä¸€æ¬¡æ‰«æä¼š DownLoad DB,å¤§æ¦‚èŠ±ååˆ†é’Ÿä»¥å†…ï¼ˆ14Mï¼Œçœ‹ç½‘é€Ÿï¼‰ï¼Œå›½å¤–çš„ä¸»æœº 10s ä»¥å†…ï¼Œç¬¬äºŒæ¬¡æ‰«æåç§’é’Ÿä»¥å†…å®Œæˆã€‚</p><ul><li>å½“é•œåƒä½äºæœ¬åœ°ï¼Œå¤§å° 408MB å·¦å³æ—¶å€™çš„æ‰«æï¼š</li></ul><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy registry.cn-hangzhou.aliyuncs.com&#x2F;choerodon-tools&#x2F;mysql:5.7.17</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="https://img.hi-linux.com/staticfile/trivy-3-20210323150158269-2021-03-23-N7fY0h.png" alt></p><p>æ—¶é—´ï¼š10ç§’å·¦å³ã€‚</p><ul><li>å½“æ‰«æçš„é•œåƒä½äºçº¿ä¸Šï¼Œå¤§å°ä¸º 316M å·¦å³æ—¶å€™çš„æ‰«æï¼š</li></ul><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="https://img.hi-linux.com/staticfile/trivy-4-2021-03-23-TPlNlA.png" alt></p><p>æ—¶é—´ï¼š20så·¦å³</p><p>ç»“è®ºï¼šæœ¬åœ°æ‰«æé•œåƒçš„å¤§å°å¯¹æ‰«æé€Ÿåº¦å½±å“ä¸å¤§ï¼Œçº¿ä¸Šæ‰«æä¸æœ¬åœ°æ‰«æçš„æ–¹å¼å¯¹æ‰«æçš„é€Ÿåº¦å½±å“å¤§ä¸ã€‚</p><h3><span id="æ‰«æçš„é•œåƒå¤§å°å’Œç½‘ç»œæµé‡ä½¿ç”¨æƒ…å†µçš„å…³ç³»">æ‰«æçš„é•œåƒå¤§å°å’Œç½‘ç»œæµé‡ä½¿ç”¨æƒ…å†µçš„å…³ç³»</span></h3><ul><li>çº¿ä¸Šæ‰«æä¹‹å‰ç½‘ç»œæµé‡ä½¿ç”¨æƒ…å†µï¼š</li></ul><p><img src="https://img.hi-linux.com/staticfile/trivy-5-2021-03-23-kChKZU.png" alt></p><p>æ‰«æé•œåƒå¤§å°ï¼š316M å·¦å³</p><ul><li>æ‰«æä¹‹åæœåŠ¡å™¨çš„ç£ç›˜ï¼Œç½‘ç»œæµé‡ä½¿ç”¨æƒ…å†µï¼š</li></ul><p><img src="https://img.hi-linux.com/staticfile/trivy-6-2021-03-23-RCXCt6.png" alt></p><p>ç»“è®ºï¼šæ¥æ”¶åˆ°çš„ç½‘ç»œæµé‡ç­‰äºçº¿ä¸Šé•œåƒçš„å¤§å°ï¼Œé•œåƒè¢«ä¸‹è½½æ”¾åœ¨æœåŠ¡å™¨ç£ç›˜çš„æŸå¤„ï¼ˆç›®å‰æœ¬æœåŠ¡å™¨æœªè£…Dockerï¼‰ã€‚</p><blockquote><p>æ³¨ï¼šå†æ¬¡å…¨é‡æ‰«æç›¸åŒçš„é•œåƒï¼Œæ¥æ”¶æµé‡å’Œç£ç›˜ä½¿ç”¨å æ¯”å‡ä¸å†å¢åŠ ã€‚</p></blockquote><h3><span id="æ‰«æçš„ç»“æœæ˜¯å¦å®¹æ˜“è§£æ">æ‰«æçš„ç»“æœæ˜¯å¦å®¹æ˜“è§£æ</span></h3><ul><li>ä½¿ç”¨ JSON è¾“å‡ºæ‰«æçš„ç»“æœï¼š</li></ul><p>æ‰«æé•œåƒ,openjdk:15-ea-jdk-buster</p><p>å¤§å°ï¼š316M å·¦å³</p><p>æ—¶é—´ï¼š10s å·¦å³</p><p><img src="https://img.hi-linux.com/staticfile/trivy-7-2021-03-23-H1Pzjr.png" alt></p><p>è¿”å›ç»“æœï¼šæ ‡å‡†çš„ josn æ ¼å¼çš„æ–‡ä»¶</p><p><img src="https://img.hi-linux.com/staticfile/trivy-8-2021-03-23-iMgNEF.png" alt></p><h3><span id="å…¶ä»–æ›´å¤šå¯ä½¿ç”¨å‘½ä»¤">å…¶ä»–æ›´å¤šå¯ä½¿ç”¨å‘½ä»¤</span></h3><ol><li>æ‰«æé•œåƒæ–‡ä»¶</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker save ruby:2.3.0-alpine3.9 -o ruby-2.3.0.tar</span><br><span class="line">$ trivy --input ruby-2.3.0.tar</span><br></pre></td></tr></table></figure><ol start="2"><li>æŒ‰ä¸¥é‡æ€§ç­›é€‰æ¼æ´ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“severity HIGH,CRITICAL ruby:2.3.0</span><br></pre></td></tr></table></figure><ol start="3"><li>æŒ‰ç±»å‹ç­›é€‰æ¼æ´ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“vuln-type os ruby:2.3.0</span><br></pre></td></tr></table></figure><ol start="4"><li>è·³è¿‡æ¼æ´æ•°æ®åº“çš„æ›´æ–°</li></ol><p>Trivy åœ¨å¼€å§‹è¿è¡Œæ—¶æ€»æ˜¯æ›´æ–°å…¶æ¼æ´æ•°æ®åº“ã€‚è¿™é€šå¸¸å¾ˆå¿«ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå·®å¼‚æ›´æ–°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ç”šè‡³æƒ³è·³è¿‡è¿™ä¸€æ­¥ï¼Œè¯·ä½¿ç”¨ <code>-â€“skip update</code> é€‰é¡¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“skip-update python:3.4-alpine3.9</span><br></pre></td></tr></table></figure><ol start="5"><li>ä»…ä¸‹è½½æ¼æ´æ•°æ®åº“</li></ol><p>æ‚¨è¿˜å¯ä»¥è¦æ±‚ Trivy ç®€å•åœ°æ£€ç´¢æ¼æ´æ•°æ®åº“ã€‚è¿™å¯¹äºåˆå§‹åŒ–è¿ç»­é›†æˆç³»ç»Ÿä¸­çš„å·¥ä½œäººå‘˜éå¸¸æœ‰ç”¨ã€‚åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œä¸­ï¼Œ<code>-â€“only update</code> é€‰é¡¹å°†è¢«å¿½ç•¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“download-db-only</span><br><span class="line">$ trivy -â€“download-db-only -â€“only-update alpine</span><br></pre></td></tr></table></figure><ol start="6"><li>å¿½ç•¥æœªä¿®å¤çš„æ¼æ´</li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒTrivy è¿˜ä¼šæ£€æµ‹æœªä¿®è¡¥/æœªä¿®å¤çš„æ¼æ´ã€‚è¿™æ„å‘³ç€å³ä½¿æ›´æ–°äº†æ‰€æœ‰åŒ…ï¼Œä¹Ÿæ— æ³•ä¿®å¤è¿™äº›æ¼æ´ã€‚å¦‚æœè¦å¿½ç•¥å®ƒä»¬ï¼Œè¯·ä½¿ç”¨ <code>-â€“ignore unfixed</code> é€‰é¡¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy â€“-ignore-unfixed ruby:2.3.0</span><br></pre></td></tr></table></figure><ol start="7"><li>æŒ‡å®šé€€å‡ºä»£ç </li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå³ä½¿æ£€æµ‹åˆ°æ¼æ´ï¼ŒTrivy ä¹Ÿä¼šä»¥ä»£ç  0 é€€å‡ºã€‚å¦‚æœè¦ä½¿ç”¨éé›¶é€€å‡ºä»£ç é€€å‡ºï¼Œè¯·ä½¿ç”¨ <code>-â€“exit code</code> é€‰é¡¹ã€‚æ­¤é€‰é¡¹å¯¹ CI/CD å¾ˆæœ‰ç”¨ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä»…å½“å‘ç°å…³é”®æ¼æ´æ—¶ï¼Œæµ‹è¯•æ‰ä¼šå¤±è´¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“exit-code 1 python:3.4-alpine3.9</span><br><span class="line">$ trivy -â€“exit-code 0 â€“severity MEDIUM,HIGH ruby:2.3.0</span><br><span class="line">$ trivy -â€“exit-code 1 â€“severity CRITICAL ruby:2.3.0</span><br></pre></td></tr></table></figure><ol start="8"><li>å¿½ç•¥æŒ‡å®šçš„æ¼æ´</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat .trivyignore</span><br><span class="line">CVE-2018-14618</span><br><span class="line">CVE-2019-1543</span><br><span class="line">$ trivy python:3.4-alpine3.9</span><br></pre></td></tr></table></figure><ol start="9"><li>æŒ‡å®šç¼“å­˜ç›®å½•ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“cache-dir &#x2F;tmp&#x2F;trivy&#x2F; python:3.4-alpine3.9</span><br></pre></td></tr></table></figure><ol start="10"><li>æ¸…é™¤é•œåƒç¼“å­˜</li></ol><p><code>-â€“clear cache</code> é€‰é¡¹åˆ é™¤é•œåƒç¼“å­˜ã€‚å¦‚æœæ›´æ–°å…·æœ‰ç›¸åŒ tag çš„é•œåƒï¼ˆä¾‹å¦‚ä½¿ç”¨æœ€æ–° tag æ—¶ï¼‰ï¼Œæ­¤é€‰é¡¹éå¸¸æœ‰ç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“clear-cache</span><br></pre></td></tr></table></figure><p><code>--reset</code> é€‰é¡¹åˆ é™¤æ‰€æœ‰ç¼“å­˜å’Œæ•°æ®åº“ã€‚åœ¨æ­¤ä¹‹åï¼Œéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½åœ¨æœ¬åœ°é‡å»ºæ¼æ´æ•°æ®åº“ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“reset</span><br></pre></td></tr></table></figure><ol start="11"><li>ä½¿ç”¨è½»é‡çº§æ•°æ®åº“ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ trivy -â€“light alpine:3.10</span><br></pre></td></tr></table></figure><p>è½»é‡çº§æ•°æ®åº“ä¸åŒ…å«è¯¸å¦‚æè¿°å’Œå¼•ç”¨ä¹‹ç±»çš„æ¼æ´è¯¦ç»†ä¿¡æ¯ã€‚å› æ­¤ï¼Œæ•°æ®åº“çš„å¤§å°æ›´å°ï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿«ã€‚å½“æ‚¨ä¸éœ€è¦æ¼æ´è¯¦ç»†ä¿¡æ¯æ—¶ï¼Œæ­¤é€‰é¡¹éå¸¸æœ‰ç”¨ï¼Œå¹¶ä¸”é€‚ç”¨äºCI/CDã€‚</p><p>è¦æŸ¥æ‰¾å…¶ä»–ä¿¡æ¯ï¼Œå¯ä»¥åœ¨ NVD ç½‘ç«™ä¸Šæœç´¢æ¼æ´è¯¦ç»†ä¿¡æ¯ã€‚</p><p>ç½‘ç«™åœ°å€ï¼š<a href="https://nvd.nist.gov/vuln/search" target="_blank" rel="noopener">https://nvd.nist.gov/vuln/search</a></p><h2><span id="å°†-trivy-é›†æˆè¿›-ci">å°† Trivy é›†æˆè¿› CI</span></h2><p>Trivy æœ‰å¯¹ CI å‹å¥½çš„ç‰¹ç‚¹ï¼Œå¹¶ä¸”å®˜æ–¹ä¹Ÿä»¥è¿™ç§æ–¹å¼ä½¿ç”¨å®ƒï¼Œæƒ³è¦é›†æˆ CI åªéœ€è¦ä¸€æ®µç®€å•çš„ Yml é…ç½®æ–‡ä»¶å³å¯ï¼Œå¦‚æœå‘ç°æ¼æ´ï¼Œæµ‹è¯•å°†å¤±è´¥ã€‚å¦‚æœä¸å¸Œæœ›æµ‹è¯•å¤±è´¥ï¼Œè¯·æŒ‡å®š â€“exit code 0ã€‚ç”±äºåœ¨è‡ªåŠ¨åŒ–åœºæ™¯ï¼ˆå¦‚CI/CDï¼‰ä¸­ï¼Œæ‚¨åªå¯¹æœ€ç»ˆç»“æœæ„Ÿå…´è¶£ï¼Œè€Œä¸æ˜¯å¯¹å®Œæ•´çš„æŠ¥å‘Šæ„Ÿå…´è¶£ï¼Œå› æ­¤è¯·ä½¿ç”¨ â€“light æ ‡å¿—å¯¹æ­¤åœºæ™¯è¿›è¡Œä¼˜åŒ–ï¼Œä»¥è·å¾—å¿«é€Ÿçš„ç»“æœã€‚</p><p>é›†æˆ GitLab CI çš„ Yml é…ç½®å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/aquasecurity/trivy#gitlab-ci" target="_blank" rel="noopener">https://github.com/aquasecurity/trivy#gitlab-ci</a></p><h2><span id="ä½¿ç”¨æ³¨æ„ç‚¹">ä½¿ç”¨æ³¨æ„ç‚¹</span></h2><ul><li>å›½å†…æ‹‰å–æ¼æ´æ•°æ®åº“æ…¢ã€‚</li><li>åŒä¸€å°æœåŠ¡å™¨ï¼Œå¤šä¸ªé•œåƒæ‰«æçš„æ—¶å€™ä¸å¯å¹¶è¡Œæ‰§è¡Œã€‚</li><li>å¯ä»¥ä½¿ç”¨ <code>-â€“light</code> ä½¿ç”¨è½»é‡çº§æ•°æ®åº“æ¥ä¼˜åŒ–æ‰§è¡Œæ‰«æçš„æ•ˆç‡ã€‚</li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Choerodon çŒªé½¿é±¼ç¤¾åŒº ã€ï¼ŒåŸæ–‡ï¼š<a href="https://choerodon.io/zh/blog/trivy/" target="_blank" rel="noopener">https://choerodon.io/zh/blog/trivy/</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Trivy-çš„ç‰¹å¾&quot;&gt;Trivy çš„ç‰¹å¾&lt;/h2&gt;
&lt;p&gt;Trivy æ˜¯ä¸€ç§é€‚ç”¨äº CI çš„ç®€å•è€Œå…¨é¢çš„å®¹å™¨æ¼æ´æ‰«æç¨‹åºã€‚è½¯ä»¶æ¼æ´æ˜¯æŒ‡è½¯ä»¶æˆ–æ“ä½œç³»ç»Ÿä¸­å­˜åœ¨çš„æ•…éšœã€ç¼ºé™·æˆ–å¼±ç‚¹ã€‚Trivy æ£€æµ‹æ“ä½œç³»ç»ŸåŒ…ï¼ˆAlpineã€RHELã€CentOSç­‰ï¼‰å’Œåº”ç”¨ç¨‹åºä¾èµ–ï¼ˆBundlerã€Composerã€npmã€yarnç­‰ï¼‰çš„æ¼æ´ã€‚&lt;/p&gt;
&lt;p&gt;Trivy å¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œåªè¦å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±å¯ä»¥æ‰«æäº†ã€‚æ‰«æåªéœ€æŒ‡å®šå®¹å™¨çš„é•œåƒåç§°ã€‚ä¸å…¶ä»–é•œåƒæ‰«æå·¥å…·ç›¸æ¯”ï¼Œä¾‹å¦‚ Clairï¼ŒAnchore Engineï¼ŒQuay ç›¸æ¯”ï¼ŒTrivy åœ¨å‡†ç¡®æ€§ã€æ–¹ä¾¿æ€§å’Œå¯¹ CI çš„æ”¯æŒç­‰æ–¹é¢éƒ½æœ‰ç€æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;æ¨èåœ¨ CI ä¸­ä½¿ç”¨å®ƒï¼Œåœ¨æ¨é€åˆ° Container Registry ä¹‹å‰ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°æ‰«ææœ¬åœ°å®¹å™¨é•œåƒï¼ŒTrivyå…·å¤‡å¦‚ä¸‹çš„ç‰¹å¾ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ£€æµ‹é¢å¾ˆå…¨ï¼Œèƒ½æ£€æµ‹å…¨é¢çš„æ¼æ´ï¼Œæ“ä½œç³»ç»Ÿè½¯ä»¶åŒ…ï¼ˆAlpineã€Red Hat Universal Base Imageã€Red Hat Enterprise Linuxã€CentOSã€Oracle Linuxã€Debianã€Ubuntuã€Amazon Linuxã€openSUSE Leapã€SUSE Enterprise Linuxã€Photon OS å’Œ Distriolessï¼‰ã€åº”ç”¨ç¨‹åºä¾èµ–é¡¹ï¼ˆBundlerã€Composerã€Pipenvã€Poetryã€npmã€yarn å’Œ Cargoï¼‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ç®€å•ï¼Œä»…ä»…åªéœ€è¦æŒ‡å®šé•œåƒåç§°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰«æå¿«ä¸”æ— çŠ¶æ€ï¼Œç¬¬ä¸€æ¬¡æ‰«æå°†åœ¨ 10 ç§’å†…å®Œæˆï¼ˆå–å†³äºæ‚¨çš„ç½‘ç»œï¼‰ã€‚éšåçš„æ‰«æå°†åœ¨ä¸€ç§’é’Ÿå†…å®Œæˆã€‚ä¸å…¶ä»–æ‰«æå™¨åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶éœ€è¦å¾ˆé•¿æ—¶é—´ï¼ˆå¤§çº¦10åˆ†é’Ÿï¼‰æ¥è·å–æ¼æ´ä¿¡æ¯ï¼Œå¹¶é¼“åŠ±æ‚¨ç»´æŠ¤æŒä¹…çš„æ¼æ´æ•°æ®åº“ä¸åŒï¼ŒTrivy æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸éœ€è¦ç»´æŠ¤æˆ–å‡†å¤‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ˜“äºå®‰è£…ï¼Œå®‰è£…æ–¹å¼ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ apt-get install trivy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ yum install trivy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ brew install trivy&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ— éœ€å®‰è£…æ•°æ®åº“ã€åº“ç­‰å…ˆå†³æ¡ä»¶ï¼ˆä¾‹å¤–æƒ…å†µæ˜¯éœ€è¦å®‰è£… rpm ä»¥æ‰«æåŸºäº RHEL/CentOS çš„å›¾åƒï¼‰ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://www.hi-linux.com/categories/docker/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Trivy" scheme="https://www.hi-linux.com/tags/Trivy/"/>
    
  </entry>
  
  <entry>
    <title>é›¶é…ç½®ï¼Œä¸€æ¡æŒ‡ä»¤åŠ©ä½ å®ç° SSH å…å¯†ç™»é™†å’Œå®‰å…¨åŠ å›º</title>
    <link href="https://www.hi-linux.com/posts/37943.html"/>
    <id>https://www.hi-linux.com/posts/37943.html</id>
    <published>2021-03-26T01:00:00.000Z</published>
    <updated>2021-03-26T01:38:00.741Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2><span id="å‰è¨€">å‰è¨€</span></h2><p>å¯¹äºæ–°å…¥æ‰‹æˆ–é‡è£…åçš„ VPS é…ç½®å¯†é’¥ç™»å½•éœ€è¦åˆ›å»º <code>~/.ssh</code> ç›®å½•ã€æŠŠå…¬é’¥å†™å…¥åˆ° <code>~/.ssh/authorized_keys</code>ã€è®¾ç½®æƒé™ã€ç¦ç”¨å¯†ç ç™»å½•ç­‰æ“ä½œï¼Œè™½ç„¶éƒ½æ˜¯å¾ˆç®€å•çš„åŸºç¡€æ“ä½œï¼Œä½†è¿‡ç¨‹éº»çƒ¦ä¸”æ¯ç‡¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~&#x2F;.ssh</span><br><span class="line">curl -fsSL https:&#x2F;&#x2F;github.com&#x2F;P3TERX.keys &gt;&gt; ~&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">chmod 700 ~&#x2F;.ssh</span><br><span class="line">chmod 600 ~&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">sudo sed -i &quot;s@.*\(PasswordAuthentication \).*@\1no@&quot; &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">sudo service sshd restart</span><br></pre></td></tr></table></figure><p><a href="https://github.com/P3TERX/SSH_Key_Installer" target="_blank" rel="noopener">SSH å¯†é’¥ä¸€é”®é…ç½®è„šæœ¬</a>æ˜¯ä¸€å¥—ç”¨äºç®€åŒ– SSH å¯†é’¥é…ç½®è¿‡ç¨‹çš„è§£å†³æ–¹æ¡ˆã€‚ä½¿ç”¨å®ƒä»¥ä¸Šæ“ä½œåªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -g P3TERX -d</span><br></pre></td></tr></table></figure><a id="more"></a><h2><span id="è¯­æ³•åŠé€‰é¡¹è¯´æ˜">è¯­æ³•åŠé€‰é¡¹è¯´æ˜</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) [é€‰é¡¹...] &lt;å‚æ•°&gt;</span><br></pre></td></tr></table></figure><ul><li><code>-o</code> - è¦†ç›–æ¨¡å¼ï¼Œå¿…é¡»å†™åœ¨æœ€å‰é¢æ‰ä¼šç”Ÿæ•ˆ</li><li><code>-g</code> - ä» GitHub è·å–å…¬é’¥ï¼Œå‚æ•°ä¸º GitHub ç”¨æˆ·å</li><li><code>-u</code> - ä» URL è·å–å…¬é’¥ï¼Œå‚æ•°ä¸º URL</li><li><code>-l</code> - ä»æœ¬åœ°æ–‡ä»¶è·å–å…¬é’¥ï¼Œå‚æ•°ä¸ºæœ¬åœ°æ–‡ä»¶è·¯å¾„</li><li><code>-p</code> - ä¿®æ”¹ SSH ç«¯å£ï¼Œå‚æ•°ä¸ºç«¯å£å·</li><li><code>-d</code> - ç¦ç”¨å¯†ç ç™»å½•</li></ul><h2><span id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</span></h2><h3><span id="ç”Ÿæˆ-ssh-å¯†é’¥å¯¹">ç”Ÿæˆ SSH å¯†é’¥å¯¹</span></h3><p>å¦‚æœæ²¡æœ‰å¯†é’¥éœ€è¦å…ˆç”Ÿæˆï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åä¸€è·¯å›è½¦å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ecdsa -b 521</span><br></pre></td></tr></table></figure><blockquote><p>TIPSï¼š</p><p>æ­¤æ–¹æ³•é€‚ç”¨äº Windows 10 (1803å)çš„ PowerShell æˆ– WSLï¼ŒLinux å‘è¡Œç‰ˆå’Œ macOS è‡ªå¸¦çš„ç»ˆç«¯ï¼Œä½†ä¸ä»…é™äºè¿™äº›ç¯å¢ƒã€‚</p><p><strong>ç§‘æ™®ï¼š</strong> 521 ä½çš„ ECDSA å¯†é’¥æ¯”èµ· RSA å¯†é’¥æ›´å®‰å…¨ä¸”éªŒè¯é€Ÿåº¦æ›´å¿«ã€‚</p></blockquote><p>æ“ä½œå®Œåä¼šåœ¨ <code>~/.ssh</code> ç›®å½•ä¸­ç”Ÿä¸¤ä¸ªå¯†é’¥æ–‡ä»¶ï¼Œ<code>id_ecdsa</code> ä¸ºç§é’¥ï¼Œ<code>id_ecdsa.pub</code> ä¸ºå…¬é’¥ã€‚å…¬é’¥å°±æ˜¯æˆ‘ä»¬éœ€è¦å®‰è£…åœ¨è¿œç¨‹ä¸»æœºä¸Šçš„ã€‚</p><blockquote><p><strong>ç§‘æ™®ï¼š</strong><code>~</code>ç¬¦å·ä»£è¡¨<strong>ç”¨æˆ·ä¸»ç›®å½•</strong>ï¼Œä¿—ç§°<strong>å®¶ç›®å½•</strong>ã€‚å…¶è·¯å¾„ä¸å½“å‰ç™»é™†çš„ç”¨æˆ·æœ‰å…³ï¼Œåœ¨ Linux ä¸­æ™®é€šç”¨æˆ·å®¶ç›®å½•çš„è·¯å¾„æ˜¯<code>/home/ç”¨æˆ·å</code>ï¼Œè€Œ root ç”¨æˆ·æ˜¯<code>/root</code>ã€‚Windows 10 ä¸­è·¯å¾„æ˜¯<code>C:\Users\ç”¨æˆ·å</code>ã€‚åœ¨ macOS ä¸­è·¯å¾„æ˜¯<code>/Users/ç”¨æˆ·å</code>ã€‚</p></blockquote><h3><span id="å®‰è£…å…¬é’¥">å®‰è£…å…¬é’¥</span></h3><h4><span id="ä»-github-è·å–å…¬é’¥">ä» GitHub è·å–å…¬é’¥</span></h4><p>åœ¨ <a href="https://github.com/settings/keys" target="_blank" rel="noopener">GitHub å¯†é’¥ç®¡ç†é¡µé¢</a> æ·»åŠ å…¬é’¥ï¼Œæ¯”å¦‚æˆ‘çš„ç”¨æˆ·åæ˜¯ <code>P3TERX</code>ï¼Œé‚£ä¹ˆåœ¨ä¸»æœºä¸Šè¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -g P3TERX</span><br></pre></td></tr></table></figure><h4><span id="ä»-url-è·å–å…¬é’¥">ä» URL è·å–å…¬é’¥</span></h4><p>æŠŠå…¬é’¥ä¸Šä¼ åˆ°ç½‘ç›˜ï¼Œé€šè¿‡ç½‘ç›˜é“¾æ¥è·å–å…¬é’¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -u https:&#x2F;&#x2F;p3terx.com&#x2F;key.pub</span><br></pre></td></tr></table></figure><h4><span id="ä»æœ¬åœ°æ–‡ä»¶è·å–å…¬é’¥">ä»æœ¬åœ°æ–‡ä»¶è·å–å…¬é’¥</span></h4><p>é€šè¿‡ FTP çš„æ–¹å¼æŠŠå…¬é’¥ä¼ åˆ° VPS ä¸Šï¼Œç„¶åæŒ‡å®šå…¬é’¥è·¯å¾„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -f ~&#x2F;key.pub</span><br></pre></td></tr></table></figure><h3><span id="è¦†ç›–æ¨¡å¼">è¦†ç›–æ¨¡å¼</span></h3><p>ä½¿ç”¨è¦†ç›–æ¨¡å¼ï¼ˆ<code>-o</code>ï¼‰å°†è¦†ç›– <code>/.ssh/authorized_keys</code> æ–‡ä»¶ï¼Œä¹‹å‰çš„å¯†é’¥ä¼šè¢«å®Œå…¨æ›¿æ¢æ‰ï¼Œé€‰é¡¹å¿…é¡»å†™åœ¨æœ€å‰é¢æ‰ä¼šç”Ÿæ•ˆï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -o -g P3TERX</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -og P3TERX</span><br></pre></td></tr></table></figure><h3><span id="ç¦ç”¨å¯†ç ç™»å½•">ç¦ç”¨å¯†ç ç™»å½•</span></h3><p>åœ¨ç¡®å®šä½¿ç”¨å¯†é’¥èƒ½æ­£å¸¸ç™»å½•åç¦ç”¨å¯†ç ç™»å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -d</span><br></pre></td></tr></table></figure><h3><span id="ä¿®æ”¹-ssh-ç«¯å£">ä¿®æ”¹ SSH ç«¯å£</span></h3><p>æŠŠ SSH ç«¯å£ä¿®æ”¹ä¸º <code>2222</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -p 2222</span><br></pre></td></tr></table></figure><h3><span id="ä¸€é”®æ“ä½œ">ä¸€é”®æ“ä½œ</span></h3><p>å®‰è£…å¯†é’¥ã€ä¿®æ”¹ç«¯å£ã€ç¦ç”¨å¯†ç ç™»å½•ä¸€é”®æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL git.io&#x2F;key.sh) -og P3TERX -p 2222 -d</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ P3TERX ZONE ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A6tjJeR0" target="_blank" rel="noopener">http://t.cn/A6tjJeR0</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å¯¹äºæ–°å…¥æ‰‹æˆ–é‡è£…åçš„ VPS é…ç½®å¯†é’¥ç™»å½•éœ€è¦åˆ›å»º &lt;code&gt;~/.ssh&lt;/code&gt; ç›®å½•ã€æŠŠå…¬é’¥å†™å…¥åˆ° &lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt;ã€è®¾ç½®æƒé™ã€ç¦ç”¨å¯†ç ç™»å½•ç­‰æ“ä½œï¼Œè™½ç„¶éƒ½æ˜¯å¾ˆç®€å•çš„åŸºç¡€æ“ä½œï¼Œä½†è¿‡ç¨‹éº»çƒ¦ä¸”æ¯ç‡¥ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mkdir -p ~&amp;#x2F;.ssh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -fsSL https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;P3TERX.keys &amp;gt;&amp;gt; ~&amp;#x2F;.ssh&amp;#x2F;authorized_keys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chmod 700 ~&amp;#x2F;.ssh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chmod 600 ~&amp;#x2F;.ssh&amp;#x2F;authorized_keys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo sed -i &amp;quot;s@.*\(PasswordAuthentication \).*@\1no@&amp;quot; &amp;#x2F;etc&amp;#x2F;ssh&amp;#x2F;sshd_config&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo service sshd restart&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/P3TERX/SSH_Key_Installer&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SSH å¯†é’¥ä¸€é”®é…ç½®è„šæœ¬&lt;/a&gt;æ˜¯ä¸€å¥—ç”¨äºç®€åŒ– SSH å¯†é’¥é…ç½®è¿‡ç¨‹çš„è§£å†³æ–¹æ¡ˆã€‚ä½¿ç”¨å®ƒä»¥ä¸Šæ“ä½œåªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bash &amp;lt;(curl -fsSL git.io&amp;#x2F;key.sh) -g P3TERX -d&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="SSH" scheme="https://www.hi-linux.com/tags/SSH/"/>
    
  </entry>
  
  <entry>
    <title>å‡ ç§ä¿®æ”¹ Docker é•œåƒé»˜è®¤å­˜å‚¨ä½ç½®çš„æ–¹æ³•</title>
    <link href="https://www.hi-linux.com/posts/13457.html"/>
    <id>https://www.hi-linux.com/posts/13457.html</id>
    <published>2021-03-24T01:00:00.000Z</published>
    <updated>2021-03-24T01:00:24.788Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p>ç”±äºç³»ç»Ÿåˆå§‹åˆ†åŒºçš„åŸå› ï¼Œå¯¼è‡´æ“ä½œç³»ç»Ÿä¸­å¯¹åº” <code>/</code> åˆ†åŒºä¸ä¼šå¤ªå¤§ï¼Œé€šè¿‡ <code>/var</code> ç›®å½•ä¸ä¼šå•ç‹¬åˆ†åŒºã€‚å¦‚æœä¸Šé¢è¿è¡Œ <code>Docker</code> æœåŠ¡ï¼Œç»è¿‡é•¿æ—¶é—´çš„ä½¿ç”¨ï¼Œä¼šä½¿åŸæœ¬å°±æ¯”è¾ƒå¤§çš„åˆ†åŒºè¶Šæ¥è¶Šä¸å¤Ÿç”¨ã€‚å¦‚ä½•æ›´å¥½åœ°çš„å¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p></blockquote><h2><span id="1-ä½¿ç”¨è½¯é“¾æ¥">1. ä½¿ç”¨è½¯é“¾æ¥</span></h2><ul><li>æˆ‘ä»¬çŸ¥é“åœ¨æ“ä½œç³»ç»Ÿå½“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>Docker</code> å®¹å™¨çš„å­˜æ”¾ä½ç½®åœ¨ <code>/var/lib/docker</code> ç›®å½•ä¸‹é¢ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹å…·ä½“ä½ç½®ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤å­˜æ”¾ä½ç½®</span></span><br><span class="line">$ sudo docker info | grep <span class="string">"Docker Root Dir"</span></span><br></pre></td></tr></table></figure><ul><li>è§£å†³é»˜è®¤å­˜å‚¨å®¹é‡ä¸è¶³çš„æƒ…å†µï¼Œæœ€ç›´æ¥ä¸”æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯æŒ‚è½½æ–°çš„åˆ†åŒºåˆ°è¯¥ç›®å½•ã€‚ä½†æ˜¯åœ¨åŸæœ‰ç³»ç»Ÿç©ºé—´ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæ‰€ä»¥é‡‡ç”¨è½¯é“¾æ¥çš„æ–¹å¼ï¼Œä¿®æ”¹é•œåƒå’Œå®¹å™¨çš„å­˜æ”¾è·¯å¾„è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚</li></ul><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ‰DockeræœåŠ¡</span></span><br><span class="line">$ systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ‰DockeræœåŠ¡</span></span><br><span class="line">$ service docker stop</span><br></pre></td></tr></table></figure><ul><li>ç„¶åç§»åŠ¨æ•´ä¸ª <code>/var/lib/docker</code> ç›®å½•åˆ°ç©ºé—´ä¸è¾ƒå¤§çš„ç›®çš„è·¯å¾„ã€‚è¿™æ—¶å€™å¯åŠ¨ <code>Docker</code> æ—¶å‘ç°å­˜å‚¨ç›®å½•ä¾æ—§æ˜¯ <code>/var/lib/docker</code> ç›®å½•ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯å­˜å‚¨åœ¨æ•°æ®ç›˜ <code>/data/docker</code> ä¸Šäº†ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç§»åŠ¨åŸæœ‰çš„å†…å®¹</span></span><br><span class="line">$ mv /var/lib/docker /data/docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œé“¾æ¥</span></span><br><span class="line">$ ln -sf /data/docker /var/lib/docker</span><br></pre></td></tr></table></figure><h2><span id="2-æŒ‡å®šå®¹å™¨å¯åŠ¨å‚æ•°">2. æŒ‡å®šå®¹å™¨å¯åŠ¨å‚æ•°</span></h2><ul><li>åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå®¹å™¨å¯åŠ¨çš„å‚æ•° <code>--graph=/var/lib/docker</code> æ¥æŒ‡å®šé•œåƒå’Œå®¹å™¨å­˜æ”¾è·¯å¾„ã€‚<code>Docker</code> çš„é…ç½®æ–‡ä»¶å¯ä»¥è®¾ç½®å¤§éƒ¨åˆ†çš„åå°è¿›ç¨‹å‚æ•°ï¼Œåœ¨å„ä¸ªæ“ä½œç³»ç»Ÿä¸­çš„å­˜æ”¾ä½ç½®ä¸ä¸€è‡´ã€‚åœ¨ <code>Ubuntu</code> ä¸­çš„ä½ç½®æ˜¯ <code>/etc/default/docker</code> æ–‡ä»¶ï¼Œåœ¨ <code>CentOS</code> ä¸­çš„ä½ç½®æ˜¯ <code>/etc/sysconfig/docker</code> æ–‡ä»¶ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS6</span></span><br><span class="line"><span class="comment"># å› ä¸ºUbuntué»˜è®¤å¼€å¯äº†selinuxæœºåˆ¶</span></span><br><span class="line">OPTIONS=--graph=<span class="string">"/data/docker"</span> --selinux-enabled -H fd://</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS7</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹docker.serviceæ–‡ä»¶ï¼Œä½¿ç”¨-gå‚æ•°æŒ‡å®šå­˜å‚¨ä½ç½®</span></span><br><span class="line">$ vi /usr/lib/systemd/system/docker.service</span><br><span class="line">ExecStart=/usr/bin/dockerd --graph /new-path/docker</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line"><span class="comment"># å› ä¸ºUbuntué»˜è®¤æ²¡å¼€å¯selinuxæœºåˆ¶</span></span><br><span class="line">OPTIONS=--graph=<span class="string">"/data/docker"</span> -H fd://</span><br></pre></td></tr></table></figure><ul><li>é‡æ–°å¯åŠ¨ä¹‹åï¼Œ<code>Docker</code> çš„è·¯å¾„å°±æ”¹æˆ <code>/data/docker</code> äº†ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡æ–°reloadé…ç½®æ–‡ä»¶</span></span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯dockeræœåŠ¡</span></span><br><span class="line">$ sudo systemctl restart docker.service</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ <code>Docker</code> çš„ç‰ˆæœ¬æ˜¯ <code>1.12</code> æˆ–ä»¥ä¸Šçš„ï¼Œå¯ä»¥ä¿®æ”¹æˆ–æ–°å»º <code>daemon.json</code> æ–‡ä»¶ã€‚ä¿®æ”¹åä¼šç«‹å³ç”Ÿæ•ˆï¼Œä¸éœ€é‡å¯ <code>Docker</code> æœåŠ¡ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>:</span><br><span class="line">        [<span class="string">"http://7e61f7f9.m.daocloud.io"</span>],</span><br><span class="line">    <span class="string">"graph"</span>: <span class="string">"/new-path/docker"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="3-system-ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶">3. System ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶</span></h2><ul><li>åœ¨ <code>/etc/systemd/system/docker.service.d</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>Drop-In</code> æ–‡ä»¶ <code>docker.conf</code>ï¼Œé»˜è®¤ <code>docker.service.d</code> æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œå¿…é¡»å…ˆåˆ›å»ºå®ƒã€‚åˆ›å»º <code>Drop-In</code> æ–‡ä»¶çš„åŸå› ï¼Œæ˜¯æˆ‘ä»¬å¸Œæœ› <code>Docker</code>æœåŠ¡ä½¿ç”¨ <code>docker.conf</code> æ–‡ä»¶ä¸­æåˆ°çš„ç‰¹å®šå‚æ•°ï¼Œå°†é»˜è®¤æœåŠ¡æ‰€ä½¿ç”¨çš„ä½äº <code>/lib/systemd/system/docker.service</code> æ–‡ä»¶ä¸­çš„å‚æ•°è¿›è¡Œè¦†ç›–ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ–°çš„å­˜å‚¨ä½ç½®</span></span><br><span class="line">$ sudo vi /etc/systemd/system/docker.service.d/docker.conf</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/dockerd --graph=<span class="string">"/data/docker"</span> --storage-driver=devicemapper</span><br></pre></td></tr></table></figure><ul><li>ä¿å­˜å¹¶é€€å‡º <code>vim</code> ç¼–è¾‘å™¨ <code>/data/docker</code> å°±æ˜¯æ–°çš„å­˜å‚¨ä½ç½®ï¼Œè€Œ <code>devicemapper</code> æ˜¯å½“å‰ <code>Docker</code> æ‰€ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨ã€‚å¦‚æœä½ çš„å­˜å‚¨é©±åŠ¨æœ‰æ‰€ä¸åŒï¼Œè¯·è¾“å…¥ä¹‹å‰ç¬¬ä¸€æ­¥æŸ¥çœ‹å¹¶è®°ä¸‹çš„å€¼ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥é‡æ–°åŠ è½½æœåŠ¡å®ˆæŠ¤ç¨‹åºï¼Œå¹¶å¯åŠ¨ <code>Docker</code> æœåŠ¡äº†ï¼Œè¿™å°†æ”¹å˜æ–°çš„é•œåƒå’Œå®¹å™¨çš„å­˜å‚¨ä½ç½®ã€‚ä¸ºäº†ç¡®è®¤ä¸€åˆ‡é¡ºåˆ©ï¼Œè¿è¡Œ <code>docker info</code> å‘½ä»¤æ£€æŸ¥ <code>Docker</code> çš„æ ¹ç›®å½•ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡æ–°reloadé…ç½®æ–‡ä»¶</span></span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯dockeræœåŠ¡</span></span><br><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure><h2><span id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</span></h2><ul><li><a href="https://blog.51cto.com/forangela/1949947" target="_blank" rel="noopener">https://blog.51cto.com/forangela/1949947</a></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Escape çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y5v7btf2%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/y5v7btf2ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç”±äºç³»ç»Ÿåˆå§‹åˆ†åŒºçš„åŸå› ï¼Œå¯¼è‡´æ“ä½œç³»ç»Ÿä¸­å¯¹åº” &lt;code&gt;/&lt;/code&gt; åˆ†åŒºä¸ä¼šå¤ªå¤§ï¼Œé€šè¿‡ &lt;code&gt;/var&lt;/code&gt; ç›®å½•ä¸ä¼šå•ç‹¬åˆ†åŒºã€‚å¦‚æœä¸Šé¢è¿è¡Œ &lt;code&gt;Docker&lt;/code&gt; æœåŠ¡ï¼Œç»è¿‡é•¿æ—¶é—´çš„ä½¿ç”¨ï¼Œä¼šä½¿åŸæœ¬å°±æ¯”è¾ƒå¤§çš„åˆ†åŒºè¶Šæ¥è¶Šä¸å¤Ÿç”¨ã€‚å¦‚ä½•æ›´å¥½åœ°çš„å¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1-ä½¿ç”¨è½¯é“¾æ¥&quot;&gt;1. ä½¿ç”¨è½¯é“¾æ¥&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬çŸ¥é“åœ¨æ“ä½œç³»ç»Ÿå½“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ &lt;code&gt;Docker&lt;/code&gt; å®¹å™¨çš„å­˜æ”¾ä½ç½®åœ¨ &lt;code&gt;/var/lib/docker&lt;/code&gt; ç›®å½•ä¸‹é¢ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹å…·ä½“ä½ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# é»˜è®¤å­˜æ”¾ä½ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo docker info | grep &lt;span class=&quot;string&quot;&gt;&quot;Docker Root Dir&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;è§£å†³é»˜è®¤å­˜å‚¨å®¹é‡ä¸è¶³çš„æƒ…å†µï¼Œæœ€ç›´æ¥ä¸”æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯æŒ‚è½½æ–°çš„åˆ†åŒºåˆ°è¯¥ç›®å½•ã€‚ä½†æ˜¯åœ¨åŸæœ‰ç³»ç»Ÿç©ºé—´ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæ‰€ä»¥é‡‡ç”¨è½¯é“¾æ¥çš„æ–¹å¼ï¼Œä¿®æ”¹é•œåƒå’Œå®¹å™¨çš„å­˜æ”¾è·¯å¾„è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://www.hi-linux.com/categories/docker/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Linux ç½‘ç»œæµé‡ç›‘æ§åˆ©å™¨ iftop ä¸­æ–‡å…¥é—¨æŒ‡å—</title>
    <link href="https://www.hi-linux.com/posts/35952.html"/>
    <id>https://www.hi-linux.com/posts/35952.html</id>
    <published>2021-03-22T01:00:00.000Z</published>
    <updated>2021-03-22T01:20:03.624Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2><span id="iftop-æ˜¯ä»€ä¹ˆ">iftop æ˜¯ä»€ä¹ˆ</span></h2><blockquote><p>åœ¨ Linux ç³»ç»Ÿä¸‹å³æ—¶ç›‘æ§æœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½ä½¿ç”¨æƒ…å†µï¼Œæœ‰å¾ˆå¤šå·¥å…·ï¼Œæ¯”å¦‚ iptrafã€nethogs ç­‰ç­‰ï¼Œä½†æ˜¯æ¨èä½¿ç”¨å°å·§ä½†åŠŸèƒ½å¾ˆå¼ºå¤§çš„ iftop å·¥å…·ã€‚</p></blockquote><p>iftop æ˜¯ Linux ç³»ç»Ÿä¸€ä¸ªå…è´¹çš„ç½‘å¡å®æ—¶æµé‡ç›‘æ§å·¥å…·ï¼Œç±»ä¼¼äº top å‘½ä»¤ã€‚iftop å¯ä»¥ç›‘æ§æŒ‡å®šç½‘å¡çš„å®æ—¶æµé‡ã€ç«¯å£è¿æ¥ä¿¡æ¯ã€åå‘è§£æ IP ç­‰ï¼Œè¿˜å¯ä»¥ç²¾ç¡®æ˜¾ç¤ºæœ¬æœºç½‘ç»œæµé‡åŠç½‘ç»œå†…å„ä¸»æœºå’Œæœ¬æœºç›¸äº’é€šä¿¡çš„æµé‡é›†åˆï¼Œéå¸¸é€‚åˆäºç›‘æ§ä»£ç†æœåŠ¡å™¨æˆ–è·¯ç”±å™¨çš„ç½‘ç»œæµé‡ã€‚åŒæ—¶ï¼Œiftop å¯¹æ£€æµ‹æµé‡å¼‚å¸¸çš„ä¸»æœºéå¸¸æœ‰æ•ˆï¼Œé€šè¿‡ iftop çš„è¾“å‡ºå¯ä»¥è¿…é€Ÿå®šä½ä¸»æœºæµé‡å¼‚å¸¸çš„æ ¹æºï¼Œè¿™å¯¹äºç½‘ç»œæ•…éšœæ’æŸ¥ã€ç½‘ç»œå®‰å…¨æ£€æµ‹æ˜¯ååˆ†æœ‰ç”¨çš„ã€‚ç¼ºç‚¹å°±æ˜¯æ— æŠ¥è¡¨åŠŸèƒ½ï¼Œä¸”å¿…é¡»ä»¥ root èº«ä»½æ‰èƒ½è¿è¡Œã€‚</p><p>å®˜ç½‘ï¼š<a href="http://www.ex-parrot.com/~pdw/iftop/" target="_blank" rel="noopener">http://www.ex-parrot.com/~pdw/iftop/</a></p><h2><span id="å®‰è£…">å®‰è£…</span></h2><ol><li>é€šè¿‡è½¯ä»¶ç®¡ç†å·¥å…·å®‰è£…</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># CentOS</span><br><span class="line">$ sudo yum install iftop</span><br><span class="line"></span><br><span class="line"># Ubuntu</span><br><span class="line">$ sudo apt install iftop</span><br></pre></td></tr></table></figure><ol start="2"><li>é€šè¿‡æºä»£ç ç¼–è¯‘å®‰è£…</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…æ¯”è¾ƒè½¯ä»¶åŒ…</span><br><span class="line">$ sudo um install libpcap libpcap-devel ncurses ncurses-devel flex byacc</span><br><span class="line"></span><br><span class="line"># ä¸‹è½½è½¯ä»¶åŒ…</span><br><span class="line">$ wget &quot;http:&#x2F;&#x2F;www.ex-parrot.com&#x2F;~pdw&#x2F;iftop&#x2F;download&#x2F;iftop-0.17.tar.gz&quot;</span><br><span class="line">$ tar zxvf iftop-0.17.tar.gz</span><br><span class="line">$ cd iftop-0.17</span><br><span class="line">$ .&#x2F;configure</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure><a id="more"></a><h2><span id="å¸¸ç”¨å‚æ•°">å¸¸ç”¨å‚æ•°</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-i æŒ‡å®šéœ€è¦æ£€æµ‹çš„ç½‘å¡ï¼Œ å¦‚æœæœ‰å¤šä¸ªç½‘ç»œæ¥å£ï¼Œåˆ™éœ€è¦æ³¨æ„ç½‘ç»œæ¥å£çš„é€‰æ‹©ï¼Œå¦‚ï¼š# iftop -i eth1</span><br><span class="line">-B å°†è¾“å‡ºä»¥ byte ä¸ºå•ä½æ˜¾ç¤ºç½‘å¡æµé‡ï¼Œé»˜è®¤æ˜¯ bit</span><br><span class="line">-n å°†è¾“å‡ºçš„ä¸»æœºä¿¡æ¯éƒ½é€šè¿‡ IP æ˜¾ç¤ºï¼Œä¸è¿›è¡Œ DNS è§£æ </span><br><span class="line">-N åªæ˜¾ç¤ºè¿æ¥ç«¯å£å·ï¼Œä¸æ˜¾ç¤ºç«¯å£å¯¹åº”çš„æœåŠ¡åç§°</span><br><span class="line">-F æ˜¾ç¤ºç‰¹å®šç½‘æ®µçš„ç½‘å¡è¿›å‡ºæµé‡  å¦‚: iftop -F 192.168.85.0&#x2F;24</span><br><span class="line">-h å¸®åŠ©ï¼Œæ˜¾ç¤ºå‚æ•°ä¿¡æ¯</span><br><span class="line">-p ä»¥æ··æ‚æ¨¡å¼è¿è¡Œ iftopï¼Œæ­¤æ—¶ iftop å¯ä»¥ç”¨ä½œç½‘ç»œå—…æ¢å™¨</span><br><span class="line">-P æ˜¾ç¤ºä¸»æœºä»¥åŠç«¯å£ä¿¡æ¯</span><br><span class="line">-m è®¾ç½®è¾“å‡ºç•Œé¢ä¸­æœ€ä¸Šé¢çš„æµé‡åˆ»åº¦æœ€å¤§å€¼ï¼Œæµé‡åˆ»åº¦åˆ† 5 ä¸ªå¤§æ®µæ˜¾ç¤º  å¦‚ï¼š# iftop -m 100M</span><br><span class="line">-f ä½¿ç”¨ç­›é€‰ç é€‰æ‹©æ•°æ®åŒ…æ¥è®¡æ•°  å¦‚ iftop -f filter code</span><br><span class="line">-b ä¸æ˜¾ç¤ºæµé‡å›¾å½¢æ¡</span><br><span class="line">-c æŒ‡å®šå¯é€‰çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ï¼šiftop  -c config file</span><br><span class="line">-t ä½¿ç”¨ä¸å¸¦ ncurses çš„æ–‡æœ¬ç•Œé¢ï¼Œ</span><br><span class="line">    ä»¥ä¸‹ä¸¤ä¸ªæ˜¯åªå’Œ -t ä¸€èµ·ç”¨çš„ï¼š</span><br><span class="line">    -s num num ç§’åæ‰“å°ä¸€æ¬¡æ–‡æœ¬è¾“å‡ºç„¶åé€€å‡ºï¼Œ-t -s 60 ç»„åˆä½¿ç”¨ï¼Œè¡¨ç¤ºå– 60 ç§’ç½‘ç»œæµé‡è¾“å‡ºåˆ°ç»ˆç«¯</span><br><span class="line">    -L num æ‰“å°çš„è¡Œæ•°</span><br><span class="line">-f å‚æ•°æ”¯æŒ tcpdump çš„è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨å„ç§è¿‡æ»¤æ¡ä»¶ã€‚</span><br></pre></td></tr></table></figure><h2><span id="ç•Œé¢æ“ä½œ">ç•Œé¢æ“ä½œ</span></h2><ol><li>ç•Œé¢ä¿¡æ¯</li></ol><p>å®‰è£…å®Œ <code>iftop</code> å·¥å…·åï¼Œç›´æ¥è¾“å…¥ <code>iftop</code> å‘½ä»¤å³å¯æ˜¾ç¤ºç½‘å¡å®æ—¶æµé‡ä¿¡æ¯ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>iftop</code> æ˜¾ç¤ºç³»ç»Ÿç¬¬ä¸€å—ç½‘å¡çš„æµé‡ä¿¡æ¯ï¼Œå¦‚æœè¦æ˜¾ç¤ºæŒ‡å®šç½‘å¡ä¿¡æ¯ï¼Œå¯é€šè¿‡<code>â€œ-iâ€</code>å‚æ•°å®ç°ã€‚æ‰§è¡Œ<code>â€œiftop -P -i eth0â€</code>å‘½ä»¤ï¼Œå¾—åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ <code>iftop</code> çš„ä¸€ä¸ªå…¸å‹è¾“å‡ºç•Œé¢ã€‚</p><ul><li><p>ç¬¬ä¸€éƒ¨åˆ†</p><ul><li>iftop è¾“å‡ºä¸­æœ€ä¸Šé¢çš„ä¸€è¡Œï¼Œæ­¤è¡Œä¿¡æ¯æ˜¯æµé‡åˆ»åº¦ï¼Œç”¨äºæ˜¾ç¤ºç½‘å¡å¸¦å®½æµé‡ã€‚</li></ul></li><li><p>ç¬¬äºŒéƒ¨åˆ†</p><ul><li>æ­¤éƒ¨åˆ†ä¸ºåˆ†å‰²çº¿ä¸­é—´çš„éƒ¨åˆ†ï¼Œå…¶ä¸­åˆåˆ†åˆ«åˆ†ä¸ºå·¦ã€ä¸­ã€å³ä¸‰åˆ—ã€‚å·¦åˆ—å’Œä¸­åˆ—ï¼Œè®°å½•äº†å“ªäº› IP æˆ–ä¸»æœºæ­£åœ¨å’Œæœ¬æœºçš„ç½‘ç»œè¿›è¡Œè¿æ¥ã€‚å…¶ä¸­ï¼Œä¸­åˆ—çš„â€œ=&gt;â€ä»£è¡¨å‘é€æ•°æ®ï¼Œâ€œ&lt;=â€ä»£è¡¨æ¥æ”¶æ•°æ®ï¼Œé€šè¿‡è¿™ä¸ªæŒ‡ç¤ºç®­å¤´å¯ä»¥å¾ˆæ¸…æ™°åœ°çŸ¥é“ä¸¤ä¸ª IP ä¹‹é—´çš„é€šä¿¡æƒ…å†µã€‚æœ€å³åˆ—åˆåˆ†ä¸ºä¸‰å°åˆ—ï¼Œè¿™äº›å®æ—¶å‚æ•°åˆ†åˆ«è¡¨ç¤ºå¤–éƒ¨ IP è¿æ¥åˆ°æœ¬æœº 2 ç§’å†…ã€10 ç§’å†…å’Œ 40 ç§’å†…çš„å¹³å‡æµé‡å€¼ã€‚</li><li>å¦å¤–ï¼Œè¿™ä¸ªéƒ¨åˆ†è¿˜æœ‰ä¸€ä¸ªæµé‡å›¾å½¢æ¡ï¼Œæµé‡å›¾å½¢æ¡æ˜¯å¯¹æµé‡å¤§å°çš„åŠ¨æ€å±•ç¤ºï¼Œä»¥ç¬¬ä¸€éƒ¨åˆ†ä¸­çš„æµé‡åˆ»åº¦ä¸ºåŸºå‡†ã€‚é€šè¿‡è¿™ä¸ªæµé‡å›¾å½¢æ¡å¯ä»¥å¾ˆæ–¹ä¾¿åœ°çœ‹å‡ºå“ªä¸ª IP çš„æµé‡æœ€å¤§ï¼Œè¿›è€Œè¿…é€Ÿå®šä½ç½‘ç»œä¸­å¯èƒ½å‡ºç°çš„æµé‡é—®é¢˜ã€‚</li></ul></li><li><p>ç¬¬ä¸‰éƒ¨åˆ†</p><ul><li>ä½äº iftop è¾“å‡ºçš„æœ€ä¸‹é¢ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰è¡Œï¼Œå…¶ä¸­ï¼Œâ€œTXâ€è¡¨ç¤ºå‘é€æ•°æ®ï¼Œâ€œRXâ€è¡¨ç¤ºæ¥æ”¶æ•°æ®ï¼Œâ€œTOTALâ€è¡¨ç¤ºå‘é€å’Œæ¥æ”¶å…¨éƒ¨æµé‡ã€‚ä¸è¿™ä¸‰è¡Œå¯¹åº”çš„æœ‰ä¸‰åˆ—ï¼Œå…¶ä¸­â€œcumâ€åˆ—è¡¨ç¤ºä»è¿è¡Œ iftop åˆ°ç›®å‰çš„å‘é€ã€æ¥æ”¶å’Œæ€»æ•°æ®æµé‡ã€‚â€œpeakâ€åˆ—è¡¨ç¤ºå‘é€ã€æ¥æ”¶ä»¥åŠæ€»çš„æµé‡å³°å€¼ã€‚â€œratesâ€åˆ—è¡¨ç¤ºè¿‡å» 2sã€10sã€40s çš„å¹³å‡æµé‡å€¼ã€‚</li></ul></li></ul><p><img src="https://img.hi-linux.com/staticfile/linux-network-iftop-tools-1-2021-02-22-uOPjUB.png" alt></p><ol start="2"><li>äº¤äº’æ“ä½œ</li></ol><p>åœ¨ <code>iftop</code> çš„å®æ—¶ç›‘æ§ç•Œé¢ä¸­ï¼Œè¿˜å¯ä»¥å¯¹è¾“å‡ºç»“æœè¿›è¡Œäº¤äº’å¼æ“ä½œï¼Œç”¨äºå¯¹è¾“å‡ºä¿¡æ¯è¿›è¡Œæ•´ç†å’Œè¿‡æ»¤ï¼Œåœ¨ä¸Šå›¾æ‰€ç¤ºç•Œé¢ä¸­ï¼ŒæŒ‰é”® <code>â€œhâ€</code> å³å¯è¿›å…¥äº¤äº’é€‰é¡¹ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<code>iftop</code> çš„äº¤äº’åŠŸèƒ½å’Œ <code>Linux</code> ä¸‹çš„ <code>top</code> å‘½ä»¤éå¸¸ç±»ä¼¼ï¼Œäº¤äº’å‚æ•°ä¸»è¦åˆ†ä¸º <code>4</code> ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ä¸€èˆ¬å‚æ•°ã€ä¸»æœºæ˜¾ç¤ºå‚æ•°ã€ç«¯å£æ˜¾ç¤ºå‚æ•°å’Œè¾“å‡ºæ’åºå‚æ•°ã€‚ç›¸å…³å‚æ•°çš„å«ä¹‰å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p><p><img src="https://img.hi-linux.com/staticfile/linux-network-iftop-tools-2-2021-02-22-wisbVN.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•°      å«ä¹‰</span><br><span class="line">P        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æš‚åœ/ç»§ç»­æ˜¾ç¤º</span><br><span class="line">h        é€šè¿‡æ­¤é”®å¯åœ¨äº¤äº’å‚æ•°ç•Œé¢/çŠ¶æ€è¾“å‡ºç•Œé¢ä¹‹é—´æ¥å›åˆ‡æ¢</span><br><span class="line">b        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºå¹³å‡æµé‡å›¾å½¢æ¡</span><br><span class="line">B        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¾ç¤º2ç§’ã€10ç§’ã€40ç§’å†…çš„å¹³å‡æµé‡</span><br><span class="line">T        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºæ¯ä¸ªè¿æ¥çš„æ€»æµé‡</span><br><span class="line">j/k      æŒ‰jé”®æˆ–ké”®å¯ä»¥å‘ä¸Šæˆ–å‘ä¸‹æ»šåŠ¨å±å¹•æ˜¾ç¤ºå½“å‰çš„è¿æ¥ä¿¡æ¯</span><br><span class="line">l        é€šè¿‡æ­¤é”®å¯æ‰“å¼€iftopè¾“å‡ºè¿‡æ»¤åŠŸèƒ½ï¼Œæ¯”å¦‚è¾“å…¥è¦æ˜¾ç¤ºçš„IPï¼ŒæŒ‰å›è½¦åï¼Œå±å¹•å°±åªæ˜¾ç¤ºä¸è¿™ä¸ªIPç›¸å…³çš„æµé‡ä¿¡æ¯</span><br><span class="line">L        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¾ç¤ºæµé‡åˆ»åº¦èŒƒå›´ï¼Œåˆ»åº¦ä¸åŒï¼Œæµé‡å›¾å½¢æ¡ä¼šè·Ÿç€å˜åŒ–</span><br><span class="line">q        é€šè¿‡æ­¤é”®å¯é€€å‡ºiftopæµé‡ç›‘æ§ç•Œé¢</span><br><span class="line">n        é€šè¿‡æ­¤é”®å¯ä½¿iftopè¾“å‡ºç»“æœä»¥IPæˆ–ä¸»æœºåçš„æ–¹å¼æ˜¾ç¤º</span><br><span class="line">s        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºæºä¸»æœºä¿¡æ¯</span><br><span class="line">d        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºè¿œç«¯ç›®æ ‡ä¸»æœºä¿¡æ¯</span><br><span class="line">t        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢iftopæ˜¾ç¤ºæ ¼å¼ï¼Œè¿ç»­æŒ‰æ­¤é”®å¯ä¾æ¬¡æ˜¾ç¤ºï¼šä»¥ä¸¤è¡Œæ˜¾ç¤ºå‘é€æ¥æ”¶æµé‡ã€ä»¥ä¸€è¡Œæ˜¾ç¤ºå‘é€æ¥æ”¶æµé‡ã€åªæ˜¾ç¤ºå‘é€æµé‡/æ¥æ”¶æµé‡</span><br><span class="line">N        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¾ç¤ºç«¯å£å·/ç«¯å£å·å¯¹åº”æœåŠ¡åç§°</span><br><span class="line">S        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºæœ¬åœ°æºä¸»æœºçš„ç«¯å£ä¿¡æ¯</span><br><span class="line">D        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºè¿œç«¯ç›®æ ‡ä¸»æœºçš„ç«¯å£ä¿¡æ¯</span><br><span class="line">p        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºç«¯å£ä¿¡æ¯</span><br><span class="line">1/2/3    æ ¹æ®æœ€è¿‘ 2 ç§’ã€10 ç§’ã€40 ç§’çš„å¹³å‡ç½‘ç»œæµé‡æ’åº</span><br><span class="line">&lt;        é€šè¿‡æ­¤é”®å¯æ ¹æ®å·¦è¾¹çš„æœ¬åœ°ä¸»æœºåæˆ–IPåœ°å€è¿›è¡Œæ’åº</span><br><span class="line">&gt;        é€šè¿‡æ­¤é”®å¯æ ¹æ®è¿œç«¯ç›®æ ‡ä¸»æœºçš„ä¸»æœºåæˆ–IPåœ°å€è¿›è¡Œæ’åº</span><br><span class="line">o        é€šè¿‡æ­¤é”®å¯åˆ‡æ¢æ˜¯å¦å›ºå®šæ˜¾ç¤ºå½“å‰çš„è¿æ¥</span><br></pre></td></tr></table></figure><h2><span id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</span></h2><ol><li>æ˜¾ç¤ºç½‘å¡ eth0 çš„ä¿¡æ¯ï¼Œä¸»æœºé€šè¿‡ ip æ˜¾ç¤º</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iftop -i eth0 -n</span><br></pre></td></tr></table></figure><ol start="2"><li>æ˜¾ç¤ºç«¯å£å·ï¼ˆæ·»åŠ  -P å‚æ•°ï¼Œè¿›å…¥ç•Œé¢å¯é€šè¿‡ p å‚æ•°å…³é—­ï¼‰</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iftop -i eth0 -n -P</span><br></pre></td></tr></table></figure><ol start="3"><li>æ˜¾ç¤ºå°†è¾“å‡ºä»¥ byte ä¸ºå•ä½æ˜¾ç¤ºç½‘å¡æµé‡,é»˜è®¤æ˜¯ bit</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iftop -i eth0 -n -B</span><br></pre></td></tr></table></figure><ol start="4"><li>æ˜¾ç¤ºæµé‡è¿›åº¦æ¡</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## è¿›å…¥ç•Œé¢åæŒ‰ä¸‹ L </span><br><span class="line">$ iftop -i eth0 -n</span><br></pre></td></tr></table></figure><ol start="5"><li>æ˜¾ç¤ºæ¯ä¸ªè¿æ¥çš„æ€»æµé‡</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## è¿›å…¥ç•Œé¢åæŒ‰ä¸‹ T</span><br><span class="line">$ iftop -i eth0 -n</span><br></pre></td></tr></table></figure><ol start="6"><li>æ˜¾ç¤ºæŒ‡å®š ip 172.17.1.158 çš„æµé‡</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¿›å…¥ç•Œé¢åæŒ‰ä¸‹ l å,å†è¾“å…¥ 172.17.1.158 å¹¶å›è½¦)</span><br><span class="line">$ iftop -i eth0 -n</span><br></pre></td></tr></table></figure><h2><span id="å®æˆ˜">å®æˆ˜</span></h2><p>ä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡æ‰¾å‡ºæœ€è´¹æµé‡çš„ IP å’Œç«¯å£å·è¿™ä¸€å…·ä½“å®ä¾‹ï¼Œæ¥æ¼”ç¤º iftop å¼ºå¤§çš„åŠŸèƒ½ã€‚</p><ol><li>è¿›å…¥ç•Œé¢</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iftop -i eth0 -nNB -m 10M</span><br></pre></td></tr></table></figure><ul><li>-i æŒ‡å®šç½‘å¡ï¼Œ</li><li>-n ä»£è¡¨ä¸»æœºé€šè¿‡ipæ˜¾ç¤ºä¸èµ°DNS</li><li>-N åªæ˜¾ç¤ºè¿æ¥ç«¯å£å·ï¼Œä¸æ˜¾ç¤ºç«¯å£å¯¹åº”çš„æœåŠ¡åç§°(ä¸åŠ ä¼šæ˜¾ç¤ºå¦‚sshè¿™æ ·çš„æœåŠ¡åç§°ï¼Œä¸ä¾¿äºæ’æŸ¥)</li><li>-B æŒ‡å®šæ˜¾ç¤ºå•ä½ä¸ºKbï¼Œé»˜è®¤æ˜¯bitï¼Œå¤ªå°ï¼</li><li>-m è®¾ç½®è¾“å‡ºç•Œé¢ä¸­æœ€ä¸Šé¢çš„æµé‡åˆ»åº¦æœ€å¤§å€¼ï¼Œæµé‡åˆ»åº¦åˆ†5ä¸ªå¤§æ®µæ˜¾ç¤º</li></ul><p>è¿›å…¥åç•Œé¢å¦‚ä¸‹:</p><p><img src="https://img.hi-linux.com/staticfile/662544-20190409210125203-1972088283-2021-02-22-Dr2ib3.png" alt="img"></p><ol start="2"><li>æŒ‰ä¸‹ L æ˜¾ç¤ºæµé‡åˆ»åº¦</li></ol><p>L å‚æ•°ç›´æ¥æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œæ–¹ä¾¿äººç±»é˜…è¯»ã€‚</p><p><img src="https://img2018.cnblogs.com/blog/662544/201904/662544-20190409210311438-298086268.png" alt="img"></p><ol start="3"><li>æŒ‰ä¸‹ T æ˜¾ç¤ºæ€»é‡</li></ol><p>æœ‰ä¸ªæ€»æ•°ç»Ÿè®¡ï¼Œçœ‹ç€æ–¹ä¾¿ï¼</p><p><img src="https://img.hi-linux.com/staticfile/662544-20190409210410810-1883429367-2021-02-22-ncetd0.png" alt="img"></p><ol start="4"><li>æŒ‰ä¸‹ 3ï¼Œæ ¹æ®æœ€è¿‘ 40s ç»Ÿè®¡æ’åº</li></ol><p>ç”¨å¹³å‡å€¼æ¥ç»Ÿè®¡æœ€æƒå¨ç‚¹</p><p><img src="https://img.hi-linux.com/staticfile/662544-20190409210518173-21025455-2021-02-22-ePqAU2.png" alt="img"></p><ol start="5"><li>æŒ‰ä¸‹ tï¼Œå‘é€å’Œæ¥å—åˆæˆä¸€è¡Œ</li></ol><p><img src="https://img.hi-linux.com/staticfile/662544-20190409210625919-169291969-2021-02-22-6qL0Op.png" alt="img"></p><ol start="6"><li>å¤šæŒ‰å‡ æ¬¡ Bï¼ŒæŸ¥çœ‹æœ€è¿‘ 2sã€10sã€40s çš„ç»Ÿè®¡</li></ol><p><img src="https://img2018.cnblogs.com/blog/662544/201904/662544-20190409211010423-1486003558.png" alt="img"></p><p>æ²¡é”™ï¼Œå›¾ä¸­çš„ 172.17.1.158 å°±æ˜¯æˆ‘ä»¬æ‰¾åˆ°çš„æµé‡ç”¨å¾—æœ€å¤šçš„ IP</p><ol start="7"><li>ç­›é€‰æŒ‡å®š IP 172.17.1.158</li></ol><p>æŒ‰ä¸‹ l, è¾“å…¥172.17.1.158ï¼Œå‡ºç°å¦‚ä¸‹</p><p><img src="https://img.hi-linux.com/staticfile/662544-20190409211215269-1603240397-2021-02-22-l1x0Jt.png" alt="img"></p><p>å›è½¦åç”Ÿæ•ˆ</p><p><img src="https://img2018.cnblogs.com/blog/662544/201904/662544-20190409211236275-1078452279.png" alt="img"></p><p>è¿™ä¸‹å°±åªçœ‹åˆ°è¿™ä¸ª IP çš„æµé‡ç›‘æ§äº†</p><ol start="8"><li>æ‰¾åˆ°è¿™ä¸ª IP å“ªä¸ªç«¯å£æµé‡ç”¨å¾—æœ€å¤š</li></ol><p>æŒ‰ä¸‹ p, æ ¹æ®ç«¯å£å·æ˜¾ç¤º</p><p><img src="https://img.hi-linux.com/staticfile/662544-20190409211529439-1633640505-2021-02-22-NTAMbf.png" alt="img"></p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å­¦ä¼šäº†å¦‚ä½•æ‰¾å‡ºæµé‡ç”¨å¾—æœ€å¤šçš„ IP å’Œç«¯å£å·ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ åšå®¢å›­ ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A6tM3oLg" target="_blank" rel="noopener">http://t.cn/A6tM3oLg</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;iftop-æ˜¯ä»€ä¹ˆ&quot;&gt;iftop æ˜¯ä»€ä¹ˆ&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ Linux ç³»ç»Ÿä¸‹å³æ—¶ç›‘æ§æœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½ä½¿ç”¨æƒ…å†µï¼Œæœ‰å¾ˆå¤šå·¥å…·ï¼Œæ¯”å¦‚ iptrafã€nethogs ç­‰ç­‰ï¼Œä½†æ˜¯æ¨èä½¿ç”¨å°å·§ä½†åŠŸèƒ½å¾ˆå¼ºå¤§çš„ iftop å·¥å…·ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;iftop æ˜¯ Linux ç³»ç»Ÿä¸€ä¸ªå…è´¹çš„ç½‘å¡å®æ—¶æµé‡ç›‘æ§å·¥å…·ï¼Œç±»ä¼¼äº top å‘½ä»¤ã€‚iftop å¯ä»¥ç›‘æ§æŒ‡å®šç½‘å¡çš„å®æ—¶æµé‡ã€ç«¯å£è¿æ¥ä¿¡æ¯ã€åå‘è§£æ IP ç­‰ï¼Œè¿˜å¯ä»¥ç²¾ç¡®æ˜¾ç¤ºæœ¬æœºç½‘ç»œæµé‡åŠç½‘ç»œå†…å„ä¸»æœºå’Œæœ¬æœºç›¸äº’é€šä¿¡çš„æµé‡é›†åˆï¼Œéå¸¸é€‚åˆäºç›‘æ§ä»£ç†æœåŠ¡å™¨æˆ–è·¯ç”±å™¨çš„ç½‘ç»œæµé‡ã€‚åŒæ—¶ï¼Œiftop å¯¹æ£€æµ‹æµé‡å¼‚å¸¸çš„ä¸»æœºéå¸¸æœ‰æ•ˆï¼Œé€šè¿‡ iftop çš„è¾“å‡ºå¯ä»¥è¿…é€Ÿå®šä½ä¸»æœºæµé‡å¼‚å¸¸çš„æ ¹æºï¼Œè¿™å¯¹äºç½‘ç»œæ•…éšœæ’æŸ¥ã€ç½‘ç»œå®‰å…¨æ£€æµ‹æ˜¯ååˆ†æœ‰ç”¨çš„ã€‚ç¼ºç‚¹å°±æ˜¯æ— æŠ¥è¡¨åŠŸèƒ½ï¼Œä¸”å¿…é¡»ä»¥ root èº«ä»½æ‰èƒ½è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å®˜ç½‘ï¼š&lt;a href=&quot;http://www.ex-parrot.com/~pdw/iftop/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.ex-parrot.com/~pdw/iftop/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;å®‰è£…&quot;&gt;å®‰è£…&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;é€šè¿‡è½¯ä»¶ç®¡ç†å·¥å…·å®‰è£…&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# CentOS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo yum install iftop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Ubuntu&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo apt install iftop&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;é€šè¿‡æºä»£ç ç¼–è¯‘å®‰è£…&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# å®‰è£…æ¯”è¾ƒè½¯ä»¶åŒ…&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo um install libpcap libpcap-devel ncurses ncurses-devel flex byacc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# ä¸‹è½½è½¯ä»¶åŒ…&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ wget &amp;quot;http:&amp;#x2F;&amp;#x2F;www.ex-parrot.com&amp;#x2F;~pdw&amp;#x2F;iftop&amp;#x2F;download&amp;#x2F;iftop-0.17.tar.gz&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ tar zxvf iftop-0.17.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ cd iftop-0.17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ .&amp;#x2F;configure&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ make &amp;amp;&amp;amp; make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="iftop" scheme="https://www.hi-linux.com/tags/iftop/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•åœ¨ä¸é‡å»ºé•œåƒæƒ…å†µä¸‹ä¼˜é›…çš„ä¿®æ”¹å®¹å™¨å†…å®¹</title>
    <link href="https://www.hi-linux.com/posts/49989.html"/>
    <id>https://www.hi-linux.com/posts/49989.html</id>
    <published>2021-03-19T01:00:00.000Z</published>
    <updated>2021-03-19T01:12:00.006Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨å®¹å™¨éå¸¸é¢‘ç¹ï¼Œå¶å°”æœ‰ä¸€äº›éœ€æ±‚éœ€è¦æ›´æ”¹å®¹å™¨é•œåƒä¸­çš„ä¸€äº›è¡Œä¸ºï¼Œä¹Ÿè®¸æ˜¯ä¸€ä¸ªå¾ˆå°çš„å˜åŒ–ï¼Œä¸€èˆ¬æˆ‘ä»¬èƒ½æƒ³åˆ°çš„å°±æ˜¯é‡æ–°æ„å»ºé•œåƒï¼Œä½†æ˜¯è¿™ä¸ªæˆ‘ä»¬å°±éœ€è¦é‡æ–°æ„å»ºå‘å¸ƒé•œåƒäº†ï¼Œé™¤äº†æ„å»ºé•œåƒè¿™ç§æ–¹å¼ä¹‹å¤–å…¶å®è¿˜æœ‰å…¶ä»–æ–¹å¼å¯ä»¥æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚</p><h2><span id="åˆå§‹åŒ–å®¹å™¨">åˆå§‹åŒ–å®¹å™¨</span></h2><p>Init Containers æ˜¯ä¸ºäº†ç»™ Pod ä¸­å®šä¹‰çš„ä¸»å®¹å™¨æä¾›é™„åŠ åŠŸèƒ½çš„ã€‚å®ƒä»¬åœ¨ä¸»å®¹å™¨ä¹‹å‰æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„å®¹å™¨é•œåƒï¼Œå¦‚æœå‡ºç°ä»»ä½•æ•…éšœï¼Œå®ƒä»¬å°†é˜»æ­¢ä¸»å®¹å™¨çš„å¯åŠ¨ï¼Œæ‰€æœ‰çš„æ—¥å¿—éƒ½å¯ä»¥å¾ˆå®¹æ˜“æŸ¥çœ‹åˆ°ï¼Œæ•…éšœæ’é™¤ä¹Ÿç›¸å½“ç®€å•ï¼Œå®ƒä»¬å°±åƒåœ¨ Pod ä¸­å®šä¹‰çš„ä»»ä½•å…¶ä»–å®¹å™¨ä¸€æ ·ã€‚è¿™ç§æ–¹æ³•åœ¨æ•°æ®åº“ç­‰æœåŠ¡ä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œå¯ä»¥æ ¹æ®é…ç½®å‚æ•°å¯¹å®ƒä»¬è¿›è¡Œåˆå§‹åŒ–å’Œé…ç½®ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ä¸€ä¸ª <code>emptyDir</code> æ¥å­˜å‚¨ç”±åˆå§‹åŒ–å®¹å™¨åˆå§‹åŒ–çš„æ•°æ®ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„ <code>echo</code> å‘½ä»¤ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œåšä¸€äº›æ›´å¤æ‚çš„äº‹æƒ…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">  name: nginx-init</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      initContainers:</span><br><span class="line">        - name: prepare-webpage</span><br><span class="line">          image: busybox:1.28</span><br><span class="line">          command: [&quot;sh&quot;, &quot;-c&quot;]</span><br><span class="line">          args: [</span><br><span class="line">              &quot;set -x;</span><br><span class="line">              echo &#39;&lt;h2&gt;Page prepared by an init container&lt;&#x2F;h2&gt;&#39; &gt; &#x2F;web&#x2F;index.html;</span><br><span class="line">              echo &#39;Init finished successfully&#39;</span><br><span class="line">              &quot;,</span><br><span class="line">            ]</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - mountPath: &#x2F;web</span><br><span class="line">              name: web</span><br><span class="line">      containers:</span><br><span class="line">        - image: nginx:1.19</span><br><span class="line">          name: nginx</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - mountPath: &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;</span><br><span class="line">              name: web</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">              name: http</span><br><span class="line">      volumes:</span><br><span class="line">        - name: web</span><br><span class="line">          emptyDir: &#123;&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2><span id="poststart-hook">PostStart Hook</span></h2><p>post-start hook å¯ç”¨äºåœ¨ä¸»å®¹å™¨å¯åŠ¨åæ‰§è¡Œä¸€äº›æ“ä½œï¼Œå®ƒå¯ä»¥æ˜¯åœ¨ä¸å®¹å™¨ç›¸åŒçš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„è„šæœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯é’ˆå¯¹å®šä¹‰çš„ç«¯ç‚¹æ‰§è¡Œçš„ HTTP è¯·æ±‚ï¼Œä½†æ˜¯ï¼Œ<strong>ä¸èƒ½ä¿è¯å›è°ƒä¼šåœ¨å®¹å™¨å…¥å£ç‚¹ï¼ˆENTRYPOINTï¼‰ä¹‹å‰æ‰§è¡Œ</strong>ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ª shell è„šæœ¬ï¼ŒPodä¸€ç›´ä¿æŒåœ¨<code>ContainerCreating</code> çŠ¶æ€ï¼Œç›´åˆ°è¿™ä¸ªè„šæœ¬ç»“æŸã€‚ç”±äºæ²¡æœ‰å¯ç”¨çš„æ—¥å¿—ï¼Œæ‰€ä»¥è°ƒè¯•èµ·æ¥å¯èƒ½å¾ˆæ£˜æ‰‹ã€‚è¿™ä¸ªæ–¹æ³•æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼Œå½“ä¸»å®¹å™¨ä¸­çš„æœåŠ¡å¯åŠ¨æ—¶ï¼Œè„šæœ¬å°±ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ¥ä¸æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œé€šè¿‡é€‚å½“çš„ <code>readinessProbe</code> é…ç½®ï¼Œè¿™å¯ä»¥æä¾›ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ï¼Œåœ¨å…è®¸ä»»ä½•è¯·æ±‚ä¹‹å‰åˆå§‹åŒ–åº”ç”¨ç¨‹åºã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ªå¯åŠ¨åçš„é’©å­ä¼šæ‰§è¡Œ echo å‘½ä»¤ï¼Œä½†åŒæ ·è¿™å¯ä»¥æ˜¯ä»»ä½•ä½¿ç”¨å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šå¯ç”¨çš„åŒä¸€ç»„æ–‡ä»¶æ¥æ‰§è¡ŒæŸç§åˆå§‹åŒ–çš„ä¸œè¥¿ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">  name: nginx-hook</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - image: nginx:1.19</span><br><span class="line">          name: nginx</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">              name: http</span><br><span class="line">          lifecycle:</span><br><span class="line">            postStart:</span><br><span class="line">              exec:</span><br><span class="line">                command:</span><br><span class="line">                  [</span><br><span class="line">                    &quot;sh&quot;,</span><br><span class="line">                    &quot;-c&quot;,</span><br><span class="line">                    &quot;sleep 5;set -x; echo &#39;&lt;h2&gt;Page prepared by a PostStart hook&lt;&#x2F;h2&gt;&#39; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html&quot;,</span><br><span class="line">                  ]</span><br></pre></td></tr></table></figure><h2><span id="sidecar-å®¹å™¨">Sidecar å®¹å™¨</span></h2><p>è¿™ç§æ–¹æ³•åˆ©ç”¨äº† Pod çš„æ¦‚å¿µ - <strong>å¤šä¸ªå®¹å™¨åŒæ—¶è¿è¡Œã€å…±äº« IPC å’Œç½‘ç»œå‘½åç©ºé—´</strong>ã€‚åœ¨ Kubernetes ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œå®ƒå·²ç»è¢« Istioã€Consul Connect ç­‰é¡¹ç›®å¹¿æ³›ä½¿ç”¨ã€‚è¿™é‡Œçš„å‡è®¾æ˜¯æ‰€æœ‰å®¹å™¨åŒæ—¶è¿è¡Œï¼Œè¿™ä½¿å¾—ä½¿ç”¨ sidecar å®¹å™¨æ¥ä¿®æ”¹ä¸»å®¹å™¨çš„è¡Œä¸ºå˜å¾—æœ‰ç‚¹æ£˜æ‰‹ã€‚ä½†è¿™æ˜¯å¯è¡Œçš„ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä¸æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡è¿›è¡Œäº¤äº’ã€‚æˆ‘åœ¨ Jenkins Helm Chart ä¸­ä½¿ç”¨äº†è¿™ä¸ªåŠŸèƒ½ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª sidecar å®¹å™¨è´Ÿè´£è¯»å– ConfigMap å¯¹è±¡å’Œ <code>Configuration-as-Code</code> é…ç½®é¡¹ã€‚</p><p>åœ¨ä¸‹é¢ç¤ºä¾‹ä¸­åŒæ ·åªæ˜¯ä½¿ç”¨ echo è¿™ä¸ªå‘½ä»¤ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸º sidecar å®¹å™¨å¿…é¡»éµå¾ª restartPolicy è®¾ç½®ï¼Œæ‰€ä»¥è¿™ä¸ªå®¹å™¨åœ¨å®ŒæˆåŠ¨ä½œåè¿˜å¿…é¡»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œç¤ºä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç®€å•çš„ while æ— é™å¾ªç¯ï¼Œåœ¨å®é™…ç¯å¢ƒä¸­ï¼Œå¾€å¾€ä¼šæ˜¯ä¸€ä¸ªå°çš„å®ˆæŠ¤è¿›ç¨‹ï¼ŒåƒæœåŠ¡ä¸€æ ·ä¸€ç›´è¿è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">  name: nginx-sidecar</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - image: nginx:1.19</span><br><span class="line">          name: nginx</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - mountPath: &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;</span><br><span class="line">              name: web</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">              name: http</span><br><span class="line">        - name: prepare-webpage</span><br><span class="line">          image: busybox:1.28</span><br><span class="line">          command: [&quot;sh&quot;, &quot;-c&quot;]</span><br><span class="line">          args: [</span><br><span class="line">              &quot;set -x;</span><br><span class="line">              echo &#39;&lt;h2&gt;Page prepared by a sidecar container&lt;&#x2F;h2&gt;&#39; &gt; &#x2F;web&#x2F;index.html;</span><br><span class="line">              while :;do sleep 9999;done</span><br><span class="line">              &quot;,</span><br><span class="line">            ]</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - mountPath: &#x2F;web</span><br><span class="line">              name: web</span><br><span class="line">      volumes:</span><br><span class="line">        - name: web</span><br><span class="line">          emptyDir: &#123;&#125;</span><br></pre></td></tr></table></figure><h2><span id="entrypoint">EntryPoint</span></h2><p>æœ€åä¸€ç§æ–¹æ³•ä½¿ç”¨ç›¸åŒçš„å®¹å™¨é•œåƒï¼Œä¸ PostStart Hook ç±»ä¼¼ï¼Œåªæ˜¯å®ƒåœ¨ä¸»åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ä¹‹å‰è¿è¡Œã€‚æˆ‘ä»¬åœ¨å®¹å™¨é•œåƒä¸­éƒ½å®šä¹‰ä¸€ä¸ª<code>ENTRYPOINT</code> å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥æ‰§è¡Œä¸€äº›è„šæœ¬ï¼Œè¿™ç§æ–¹å¼ç»å¸¸è¢«å¾ˆå¤šå®˜æ–¹é•œåƒæ‰€ä½¿ç”¨ï¼Œåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦é¢„ç½®è‡ªå·±çš„è„šæœ¬æ¥ä¿®æ”¹ä¸»å®¹å™¨çš„è¡Œä¸ºã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªä¿®æ”¹åçš„åŸå§‹å…¥å£ç‚¹æ–‡ä»¶ã€‚</p><p>è¿™ä¸ªæ–¹æ³•ç›¸å¯¹å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª ConfigMapï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªè„šæœ¬å†…å®¹ï¼Œåœ¨ä¸»å…¥å£ç‚¹ä¹‹å‰æ‰§è¡Œã€‚å¦‚ä¸‹æ‰€ç¤ºæˆ‘ä»¬ä¿®æ”¹ nginx å…¥å£ç‚¹çš„è„šæœ¬ï¼Œç„¶ååµŒå…¥åˆ°ä¸‹é¢çš„ ConfigMap ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: scripts</span><br><span class="line">data:</span><br><span class="line">  prestart-script.sh: |-</span><br><span class="line">    #!&#x2F;usr&#x2F;bin&#x2F;env bash</span><br><span class="line">    echo &#39;&lt;h2&gt;Page prepared by a script executed before entrypoint container&lt;&#x2F;h2&gt;&#39; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html</span><br><span class="line">    # è¿™æ˜¯ &quot;ENTRYPOINT CMD &quot;ä»ä¸»å®¹å™¨é•œåƒå®šä¹‰ä¸­æå–å‡ºæ¥çš„</span><br><span class="line">    exec &#x2F;docker-entrypoint.sh nginx -g &quot;daemon off;&quot;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼Œå°±æ˜¯æœ€åä¸€è¡Œä¸ execï¼Œå®ƒæ‰§è¡Œçš„æ˜¯åŸå§‹çš„å…¥å£ç‚¹è„šæœ¬ï¼Œå¿…é¡»ä¸ Dockerfile ä¸­å®šä¹‰çš„è„šæœ¬å®Œå…¨åŒ¹é…ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒéœ€è¦é¢å¤–çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°æ˜¯åœ¨ CMD ä¸­å®šä¹‰çš„ã€‚ç°åœ¨è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸‹ Deployment èµ„æºå¯¹è±¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">  name: nginx-script</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - image: nginx:1.19</span><br><span class="line">          name: nginx</span><br><span class="line">          command: [&quot;bash&quot;, &quot;-c&quot;, &quot;&#x2F;scripts&#x2F;prestart-script.sh&quot;]</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">              name: http</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - mountPath: &#x2F;scripts</span><br><span class="line">              name: scripts</span><br><span class="line">      volumes:</span><br><span class="line">        - name: scripts</span><br><span class="line">          configMap:</span><br><span class="line">            name: scripts</span><br><span class="line">            defaultMode: 0755 # &lt;- è¿™ä¸ªå¾ˆé‡è¦</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨å‘½ä»¤è¦†ç›–å…¥å£ç‚¹ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»ç¡®ä¿æˆ‘ä»¬çš„è„šæœ¬æ˜¯ä»¥é€‚å½“çš„æƒé™æŒ‚è½½çš„ï¼ˆå› æ­¤éœ€è¦å®šä¹‰ defaultModeï¼‰ã€‚</p><h2><span id="æ€»ç»“">æ€»ç»“</span></h2><p>ç°åœ¨æˆ‘ä»¬æ¥æ€»ç»“ä¸‹ä¸Šé¢å‡ ç§æ–¹å¼çš„å·®å¼‚ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/640-2021-01-28-L0Y5IQ.png" alt="å›¾ç‰‡"></p><p>å®¹å™¨è®²ç©¶çš„æ˜¯å¯é‡ç”¨æ€§ï¼Œå¾ˆå¤šæ—¶å€™åšä¸€äº›å°çš„è°ƒæ•´ï¼Œä¸éœ€è¦é‡æ–°æ„å»ºæ•´ä¸ªå®¹å™¨çš„é•œåƒï¼Œè¿™æ ·å‘å¸ƒå’Œç»´æŠ¤å°±ä¼šè½»æ¾å¾ˆå¤šã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://cloudowski.com/articles/how-to-modify-containers-wihtout-rebuilding/" target="_blank" rel="noopener">https://cloudowski.com/articles/how-to-modify-containers-wihtout-rebuilding/</a></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ k8sæŠ€æœ¯åœˆ ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A65IGVpX%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">http://t.cn/A65IGVpXï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç°åœ¨æˆ‘ä»¬ä½¿ç”¨å®¹å™¨éå¸¸é¢‘ç¹ï¼Œå¶å°”æœ‰ä¸€äº›éœ€æ±‚éœ€è¦æ›´æ”¹å®¹å™¨é•œåƒä¸­çš„ä¸€äº›è¡Œä¸ºï¼Œä¹Ÿè®¸æ˜¯ä¸€ä¸ªå¾ˆå°çš„å˜åŒ–ï¼Œä¸€èˆ¬æˆ‘ä»¬èƒ½æƒ³åˆ°çš„å°±æ˜¯é‡æ–°æ„å»ºé•œåƒï¼Œä½†æ˜¯è¿™ä¸ªæˆ‘ä»¬å°±éœ€è¦é‡æ–°æ„å»ºå‘å¸ƒé•œåƒäº†ï¼Œé™¤äº†æ„å»ºé•œåƒè¿™ç§æ–¹å¼ä¹‹å¤–å…¶å®è¿˜æœ‰å…¶ä»–æ–¹å¼å¯ä»¥æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆå§‹åŒ–å®¹å™¨&quot;&gt;åˆå§‹åŒ–å®¹å™¨&lt;/h2&gt;
&lt;p&gt;Init Containers æ˜¯ä¸ºäº†ç»™ Pod ä¸­å®šä¹‰çš„ä¸»å®¹å™¨æä¾›é™„åŠ åŠŸèƒ½çš„ã€‚å®ƒä»¬åœ¨ä¸»å®¹å™¨ä¹‹å‰æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„å®¹å™¨é•œåƒï¼Œå¦‚æœå‡ºç°ä»»ä½•æ•…éšœï¼Œå®ƒä»¬å°†é˜»æ­¢ä¸»å®¹å™¨çš„å¯åŠ¨ï¼Œæ‰€æœ‰çš„æ—¥å¿—éƒ½å¯ä»¥å¾ˆå®¹æ˜“æŸ¥çœ‹åˆ°ï¼Œæ•…éšœæ’é™¤ä¹Ÿç›¸å½“ç®€å•ï¼Œå®ƒä»¬å°±åƒåœ¨ Pod ä¸­å®šä¹‰çš„ä»»ä½•å…¶ä»–å®¹å™¨ä¸€æ ·ã€‚è¿™ç§æ–¹æ³•åœ¨æ•°æ®åº“ç­‰æœåŠ¡ä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œå¯ä»¥æ ¹æ®é…ç½®å‚æ•°å¯¹å®ƒä»¬è¿›è¡Œåˆå§‹åŒ–å’Œé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;emptyDir&lt;/code&gt; æ¥å­˜å‚¨ç”±åˆå§‹åŒ–å®¹å™¨åˆå§‹åŒ–çš„æ•°æ®ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„ &lt;code&gt;echo&lt;/code&gt; å‘½ä»¤ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œåšä¸€äº›æ›´å¤æ‚çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;apiVersion: apps&amp;#x2F;v1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kind: Deployment&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    app: nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  name: nginx-init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  selector:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    matchLabels:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      app: nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  template:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        app: nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      initContainers:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        - name: prepare-webpage&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          image: busybox:1.28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          command: [&amp;quot;sh&amp;quot;, &amp;quot;-c&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          args: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;quot;set -x;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              echo &amp;#39;&amp;lt;h2&amp;gt;Page prepared by an init container&amp;lt;&amp;#x2F;h2&amp;gt;&amp;#39; &amp;gt; &amp;#x2F;web&amp;#x2F;index.html;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              echo &amp;#39;Init finished successfully&amp;#39;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          volumeMounts:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            - mountPath: &amp;#x2F;web&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              name: web&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      containers:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        - image: nginx:1.19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          name: nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          volumeMounts:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            - mountPath: &amp;#x2F;usr&amp;#x2F;share&amp;#x2F;nginx&amp;#x2F;html&amp;#x2F;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              name: web&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            - containerPort: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              name: http&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      volumes:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        - name: web&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          emptyDir: &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>å°ç™½ä¹Ÿèƒ½çœ‹æ‡‚çš„ç½‘ç»œåŸºç¡€ | 01 ä»€ä¹ˆæ˜¯ç½‘ç»œï¼Ÿ</title>
    <link href="https://www.hi-linux.com/posts/35925.html"/>
    <id>https://www.hi-linux.com/posts/35925.html</id>
    <published>2021-03-17T01:00:00.000Z</published>
    <updated>2021-03-17T02:02:47.313Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2><span id="å¼•è¨€">å¼•è¨€</span></h2><p>æ¬¢è¿æ¥åˆ°ç½‘ç»œä¸–ç•Œï¼Œã€Šå°ç™½ä¹Ÿèƒ½çœ‹æ‡‚çš„ç½‘ç»œåŸºç¡€ã€‹ç³»åˆ—æ–‡ç« ä¼šä»é›¶å¼€å§‹å¸®åŠ©ä½ æ„å»ºç½‘ç»œçš„åŸºç¡€çŸ¥è¯†ã€‚å¦‚æœä½ å®Œå…¨æ²¡æœ‰æ¥è§¦è¿‡ç½‘ç»œç›¸å…³çš„å†…å®¹ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸€æ ·çš„ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æˆ‘ä»¬è‚¯å®šé‡åˆ°äº†ç›¸åŒçš„é—®é¢˜ï¼å†™ä¸‹è¿™äº›æ–‡ç« ä¸€æ–¹é¢è¦è®°å½•è‡ªå·±çš„å­¦ä¹ å†ç¨‹ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¸Œæœ›å¸®åˆ°åŒæ ·æƒ³è¦å­¦ä¹ ç½‘ç»œåŸºç¡€çš„å°ä¼™ä¼´ã€‚</p><p>æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä¸ç´ ææ˜¯æˆ‘ä»ã€Youtubeå¹³å°ã€‘çš„ã€<a href="https://www.youtube.com/channel/UCtuXekfqj-paqsxtqVNCC2A" target="_blank" rel="noopener">Network Direction</a>ã€‘å‘å¸ƒçš„ç³»åˆ—è§†é¢‘å­¦ä¹ å’Œæœé›†è¿‡æ¥çš„ï¼Œç¿»è¯‘ä¸æ˜“ï¼Œéƒ¨åˆ†å†…å®¹å¯èƒ½æ— æ³•åšåˆ°å°½å–„å°½ç¾ï¼Œç”šè‡³å¯èƒ½ä¼šæœ‰éƒ¨åˆ†ç‘•ç–µï¼Œæˆ‘ä¼šå°½åŠ›è®©æ–‡ç« å†…å®¹é€šä¿—æ˜“æ‡‚ï¼Œè¦†ç›–å…¨é¢ã€‚è‹¥å„ä½å°ä¼™ä¼´å‘ç°ä»»ä½•é—®é¢˜ï¼Œå¸Œæœ›èƒ½å¤Ÿç•™è¨€æˆ–ç§ä¿¡å‘Šè¯‰æˆ‘ï¼Œåœ¨ä¸‹ä¸èƒœæ„Ÿæ¿€ï¼å½“ç„¶ï¼Œæˆ‘ä¹Ÿä¼šåœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œæ›´æ­£ã€‚</p><p>åœ¨å¾€åçš„æ¯ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘éƒ½ä¼šæŠŠçœ‹åˆ°æ–‡ç« çš„å°ä¼™ä¼´å½“æˆæ˜¯å®Œå…¨æ²¡æœ‰ç½‘ç»œç»éªŒçš„å°ç™½ï¼Œæˆ‘çš„ç›®æ ‡æ˜¯å’Œé›¶åŸºç¡€å°ç™½ä¸€èµ·å»ºç«‹åšå®çš„ç½‘ç»œåŸºç¡€ï¼Œç½‘ç»œå¤§ç¥è¯·ç•¥è¿‡æ­¤ç³»åˆ—æ–‡ç« ã€‚</p><p>è®©æˆ‘ä»¬å¼€å§‹ç½‘ç»œä¹‹æ—…å§ï¼</p><a id="more"></a><h2><span id="ä»€ä¹ˆæ˜¯ç½‘ç»œ">ä»€ä¹ˆæ˜¯ç½‘ç»œ</span></h2><p><img src="https://img.hi-linux.com/staticfile/1-2021-03-15-L9ffCR.png" alt="ä½ èº«è¾¹çš„ç½‘ç»œè®¾å¤‡"></p><p>ç½‘ç»œå…¶å®å­˜åœ¨äºæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æ¯ä¸€ä¸ªè§’è½ï¼ä½ çš„ <strong>ç”µè„‘</strong>ï¼Œ<strong>æ‰“å°æœº</strong>ï¼Œ<strong>æ‰‹æœºï¼Œç”šè‡³ç”µè§†</strong> ç­‰ç­‰éƒ½å±äºç½‘ç»œè®¾å¤‡ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›è®¾å¤‡é€šè¿‡ç½‘ç»œè¿æ¥èµ·æ¥ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ•°æ®çš„ä¼ è¾“å’Œå…±äº«ï¼Œè®©æˆ‘ä»¬çš„å·¥ä½œç”Ÿæ´»æ›´åŠ ä¾¿æ·ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/ebdeae9ed432126dd50bc72f5a06836d-20210315105021092-2021-03-15-PmrY9L.gif" alt="ååŒåŠå…¬"></p><p>å¦‚æœæˆ‘ä»¬çš„è¿æ¥æ²¡æœ‰é—®é¢˜ï¼Œå°±å¯ä»¥é€šè¿‡ç”µè„‘ç»™æ‰“å°æœºå‘é€æŒ‡ä»¤ï¼Œè®©å®ƒå¸®æˆ‘ä»¬æ‰“å°èµ„æ–™ï¼›æˆ–è€…å°†èµ„æ–™å­˜å‚¨åˆ°æˆ‘ä»¬çš„æœ¬åœ°æœåŠ¡å™¨ï¼›å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å‘å¸ƒæ–‡ç« æˆ–è§†é¢‘åˆ°äº’è”ç½‘ä¸Šã€‚</p><p>å¯é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬è™½ç„¶å¹³æ—¶éƒ½åœ¨è¿›è¡Œè¿™äº›æ—¥å¸¸æ“ä½œï¼Œå¯æˆ‘ä»¬å´å¹¶æ²¡æœ‰æ„è¯†åˆ°ç½‘ç»œçš„å­˜åœ¨ï¼Œæˆ–è€…è¯´ï¼Œæˆ‘ä»¬å¹¶ä¸å¤ªæ¸…æ¥šè¿™å†…éƒ¨çš„å·¥ä½œæµç¨‹ä¸ç»†èŠ‚ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥å¯ä»¥é€šè¿‡ç½‘ç»œ <strong>æµè§ˆè§†é¢‘</strong>ã€<strong>ä¸‹è½½èµ„æ–™</strong>ã€<strong>å‘é€é‚®ä»¶æˆ–ä¸æœ‹å‹è§†é¢‘èŠå¤©</strong>ï¼Œå…¶å®éƒ½æ˜¯ç½‘ç»œè®¾å¤‡ä¹‹é—´é»˜å¥‘é…åˆçš„ç»“æœã€‚</p><h3><span id="1äº¤æ¢æœº">1.äº¤æ¢æœº</span></h3><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬é ä»€ä¹ˆæ¥è¿æ¥è¿™äº›ç½‘ç»œè®¾å¤‡å‘¢ï¼Ÿ<strong>ã€Œäº¤æ¢æœºã€</strong>ï¼ŒåŒæ—¶éœ€è¦é…åˆè®¾å¤‡çº¿ç¼†ï¼Œå³å¯å®ç°è®¾å¤‡é—´çš„äº’è¿äº’é€šã€‚</p><p><img src="https://img.hi-linux.com/staticfile/2ddd34d27eabbad32baecbcad5cdae84-2021-03-15-TI9cMz.gif" alt="äº¤æ¢æœº"></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå…¬å¸åŠå…¬å®¤æˆ–å­¦æ ¡æ•™å®¤é‡Œçš„ç”µè„‘ï¼Œå¤§éƒ½å¯ä»¥ä½¿ç”¨ç½‘çº¿æ¥è¿æ¥åˆ°å¢™ä¸Šæˆ–å…¶ä»–ä½ç½®çš„ä¸€ä¸ªçš„ç½‘çº¿æ¥å£ä¸­ï¼Œè€Œç½‘çº¿æ¥å£åé¢åˆ™æ˜¯é€šè¿‡çº¿ç¼†åˆè¿æ¥åˆ°äº†é…çº¿æ¶ä¸Šï¼Œè¿™ä¸ªé…çº¿æ¶ä¸€èˆ¬éƒ½æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æˆ¿é—´æˆ–æŸœå­é‡Œé¢ï¼Œæ¥ç€ï¼Œåªéœ€è¦å†å°†é…çº¿æ¶å’Œ <strong>ã€Œäº¤æ¢æœºã€</strong> ç›¸è¿ï¼Œå³å¯å®ç°ä¸€ä¸ªæœ€åŸºç¡€çš„ç½‘ç»œè¿æ¥ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/dd01e6374c892d0e05d1daea412c09d1-2021-03-15-HlhmEP.gif" alt></p><p>å¯¹äº <strong>ã€Œäº¤æ¢æœºã€</strong>ï¼Œæ™®é€šçš„å®¶åº­ç”¨æˆ·å¯èƒ½é²œæœ‰è€³é—»ï¼Œé‚£æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬é€šå¸¸æŠŠçº¿ç¼†ç›´æ¥æ¥åˆ°å…‰çŒ«æˆ–è·¯ç”±å™¨ä¸Šäº†ï¼Œæ¯•ç«Ÿï¼Œæˆ‘ä»¬å®¶ä¸­çš„ç½‘ç»œè®¾å¤‡ç›¸å¯¹è¾ƒå°‘ï¼›ä½†æ˜¯å¯¹äºä¸€ä¸ªä¼ä¸šæˆ–å­¦æ ¡æœºæ„æ¥è¯´ï¼Œå®ƒä»¬çš„è®¡ç®—æœºéå¸¸å¤šï¼Œå¯¹äºçº¿ç¼†çš„ç®¡ç†ä¹Ÿå¤æ‚èµ·æ¥ï¼Œäº¤æ¢æœºå°±å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸€é—®é¢˜ã€‚ï¼ˆåé¢çš„ç« èŠ‚æˆ‘ä»¬ä¼šè¯¦ç»†å±•å¼€è®²è§£ <strong>ã€Œäº¤æ¢æœºã€</strong>ï¼‰</p><p><img src="https://img.hi-linux.com/staticfile/89b21b958bfac419efca4d53ccde8bce-20210315105036043-2021-03-15-uPdAcu.gif" alt="è®¾å¤‡ç›´è¿äº¤æ¢æœº"></p><p>å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬çš„è®¾å¤‡å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å°†çº¿ç¼†è¿æ¥åˆ°äº¤æ¢æœºä¸Šï¼Œå…·ä½“æƒ…å†µè¿˜è¦æ ¹æ®æˆ‘ä»¬çš„è®¾å¤‡ä¸çº¿ç¼†çš„å¤šå°‘æ¥å†³å®šçš„ã€‚</p><h3><span id="2æ— çº¿è¿æ¥">2.æ— çº¿è¿æ¥</span></h3><p>ç°å®æƒ…å†µå°±æ˜¯ï¼Œé™¤äº†å°å¼æœºï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯ç§»åŠ¨è®¾å¤‡äº†ï¼Œæ‰‹æœºï¼Œç§»åŠ¨ç¬”è®°æœ¬ï¼Œå¹³æ¿ç”µè„‘è¿™äº›è®¾å¤‡å¤§éƒ½ä¸éœ€è¦ä½¿ç”¨çº¿ç¼†ï¼Œä¹ŸåŒæ ·å¯ä»¥å®ç°ç½‘ç»œè¿æ¥ï¼Œè¿™å°±æ˜¯é€šè¿‡æ‰€è°“çš„ <strong>ã€Œæ— çº¿è¿æ¥æŠ€æœ¯ï¼ˆWi-Fiï¼‰ã€</strong>ï¼Œæ¥å®ç°çš„ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Wi-Fi è¦†ç›–çš„èŒƒå›´å†…è¿›è¡Œæ— çº¿ä¸Šç½‘äº†ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/0a6a4a7ace20c645c48ef49557ea6e21-2021-03-15-1g9cKp.gif" alt="æ— çº¿è¿æ¥"></p><p>å¦‚æœæŠŠæ— çº¿è®¾å¤‡ä¹Ÿè¿æ¥åˆ°äº¤æ¢æœºï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°åœ¨ä¸€ä¸ªå±€éƒ¨ç½‘ç»œä¸­å…±äº«æœ‰çº¿ä¸æ— çº¿è®¾å¤‡çš„å†…å®¹äº†ï¼Œæ¯”å¦‚ï¼Œå°†æ‰‹æœºä¸Šçš„ä¿¡æ¯ä¼ è¾“åˆ°æ‰“å°æœºä»¥å®ç°æ•°æ®æ‰“å°ï¼›éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ— çº¿è¿æ¥ä¸æœ‰çº¿è¿æ¥åœ¨æ•°æ®ä¼ è¾“é€Ÿåº¦ä¸Šä¼šæœ‰åŒºåˆ«ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/aba7496ed6f084b43453b06acdaf6bc4-2021-03-15-nAweir.gif" alt="æ— çº¿è®¾å¤‡è¿æ¥åˆ°æœ¬åœ°ç½‘ç»œ"></p><p>æˆ‘åœ¨å…¬å¸çš„å¯¹äºç§»åŠ¨è®¾å¤‡çš„ä½¿ç”¨æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œå½“æˆ‘ååœ¨åŠå…¬ä½ä¸ŠåŠå…¬ï¼Œæˆ‘ä¼šä½¿ç”¨æœ‰çº¿è¿æ¥ï¼Œæ¯•ç«Ÿè¿™æ ·é€Ÿåº¦æ›´å¿«ï¼›ä½†å¦‚æœè¦å¼€ä¼šçš„è¯ï¼Œæˆ‘å°±ä¼šæŠŠç”µè„‘ç½‘çº¿æ‹”äº†ï¼Œæ‹¿ç€èµ¤è£¸è£¸çš„ç¬”è®°æœ¬å»ä¼šè®®å®¤ï¼Œç„¶åè¿æ¥åˆ°æ— çº¿ç½‘ç»œã€‚</p><p><img src="https://img.hi-linux.com/staticfile/3cddaf73995bd37ab5a0546fbb44d4f2-20210315105046323-2021-03-15-Og9QF7.gif" alt="çœŸå®åŠå…¬åœºæ™¯"></p><h3><span id="3ç½‘ç»œåè®®">3.ç½‘ç»œåè®®</span></h3><p>æ— è®ºé€šè¿‡å“ªç§æ–¹å¼è¿›è¡Œè¿æ¥ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ï¼Œæ˜¯è¦å°†ä¿¡æ¯ä»ä¸€å°è®¾å¤‡å‘é€åˆ°å¦ä¸€å°è®¾å¤‡ï¼Œå› æ­¤ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹å¿…é¡»ç›¸äº’ç†è§£æ‰è¡Œï¼Œè¿™å°±éœ€è¦å®ƒä»¬åœ¨ç½‘ç»œä¸­è¯´ç›¸åŒçš„è¯­è¨€ã€‚è™½ç„¶æˆ‘ä»¬å¹¶ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ï¼Œæ¯•ç«Ÿè®¾å¤‡ä¹‹é—´åŸºæœ¬éƒ½çŸ¥é“è¯¥å¦‚ä½•ç»„ç»‡æ•°æ®å¹¶è¿›è¡Œå¤„ç†å’Œå‘é€ã€‚ç©¶å…¶æ ¹æœ¬ï¼Œå°±æ˜¯å› ä¸ºä»–ä»¬éƒ½éµå¾ªäº†åŒä¸€å¥—è§„åˆ™ï¼Œæˆ‘ä»¬ç§°è¿™å¥—è§„åˆ™ä¸º <strong>ã€Œåè®®ã€</strong>ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/e6d3cae0de6b53d54e8c1d9cf8c5bd66-20210315105057137-2021-03-15-TWZaLk.gif" alt="ç½‘ç»œåè®®"></p><p>åè®®ï¼Œå°±æ˜¯ <strong>ã€Œç»™åŒæ–¹åˆ¶å®šçš„é€šè®¯è§„åˆ™ã€</strong>ï¼Œè¿™æ„å‘³ç€åŒæ–¹æƒ³è¦é»˜å¥‘é…åˆï¼Œå°±å¿…é¡»éµå¾ªè¿™äº›åè®®ï¼Œä¹Ÿæ­£å› å¦‚æ­¤ï¼Œè‹¥ä¸€æ–¹å‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå‡†ç¡®çš„å®šä½åˆ°é—®é¢˜æ‰€åœ¨ä½ç½®ã€‚</p><p>åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œé‚£äº›è®¾è®¡ç½‘ç»œè½¯ä»¶å’Œç¡¬ä»¶çš„å·¥ç¨‹å¸ˆä¼šä¸¥æ ¼éµå¾ªè¿™å¥— <strong>ã€Œåè®®ã€</strong>ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å®ƒä»¬å†ç½‘ç»œä¸­çš„ç•…é€šæ— é˜»ï¼å¤§å®¶å¯èƒ½å¬è¯´è¿‡è¯¸å¦‚ <strong>ã€Œä»¥å¤ªç½‘ã€</strong> ä¹‹ç±»çš„åè®®ï¼Œä½ ä¹Ÿå¯èƒ½å¬è¯´è¿‡ <strong>ã€ŒTCP(ç”¨äºå‘é€å’Œæ¥æ”¶æ•°æ®)ã€</strong> åè®®ï¼Œæˆ– **ã€ŒHTTP(ç”¨äºè®¿é—®ç½‘ç»œ)ã€**åè®®ï¼Œæˆ– <strong>ã€ŒSMTP(ç”¨äºé‚®ä»¶æ”¶å‘)ã€</strong> åè®®ï¼Œåç»­ç« èŠ‚ä¼šè¯¦ç»†è®²è§£â€¦â€¦ æ— è®ºå“ªç§åè®®ï¼Œå…¶æœ€ç»ˆç›®çš„ï¼Œéƒ½æ˜¯ä¸ºäº†å®Œæˆæ•°æ®äº¤äº’ã€‚</p><p><strong>é€šå¸¸ï¼Œæˆ‘ä»¬éƒ½ä¼šå°†å‡ ç§åè®®ç»“åˆä½¿ç”¨ä»¥å®Œæˆä¸€é¡¹ä»»åŠ¡ã€‚</strong></p><h3><span id="4æ€»ç»“">4.æ€»ç»“</span></h3><ol><li>ç½‘ç»œçš„ä½œç”¨å°±æ˜¯å°†è®¾å¤‡è¿æ¥åœ¨ä¸€èµ·ï¼Œå¯ä»¥è®©è®¾å¤‡ä¹‹é—´è¿›è¡Œèµ„æºå…±äº«ã€ä¿¡æ¯äº¤æµç­‰åŠŸèƒ½</li><li>ç½‘ç»œè®¾å¤‡ä¹‹é—´éœ€è¦è¯´å…±åŒçš„è¯­è¨€ï¼Œéµå¾ªç›¸åŒçš„è§„åˆ™ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºã€Œåè®®ã€Œ</li><li>åè®®å°±æ˜¯ä¸€ç»„æœ‰å…³è®¾å¤‡å¦‚ä½•å¤„ç†ä¿¡æ¯çš„æŒ‡ä»¤</li></ol><h3><span id="5å°æµ‹è¯•">5.å°æµ‹è¯•</span></h3><ol><li>è®¡ç®—æœºè¿æ¥åˆ°ç½‘ç»œçš„ä¸¤ç§æ–¹å¼åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>å¤šä¸ªç½‘ç»œè®¾å¤‡ä¹‹é—´é€šå¸¸ä½¿ç”¨ä»€ä¹ˆè®¾å¤‡è¿›è¡Œç»Ÿä¸€è¿æ¥ï¼Ÿ</li><li>å½“ä½ æƒ³é€šè¿‡ä¸€å°è®¡ç®—æœºä¸å¦ä¸€å°è®¡ç®—æœºäº¤äº’ï¼Œä¼šåº”ç”¨åˆ°å“ªäº›åè®®ï¼Ÿ</li></ol><h2><span id="ç½‘ç»œç±»å‹">ç½‘ç»œç±»å‹</span></h2><p>åœ¨æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ä»¥ä¸‹å†…å®¹ï¼š</p><ol><li>ç½‘ç»œä¸­çš„ <strong>èŠ‚ç‚¹</strong> æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>æ ¹æ®ç½‘ç»œèŠ‚ç‚¹çš„ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå“ªäº› <strong>ç½‘ç»œç±»å‹</strong> ï¼Ÿ</li><li>åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œä¸åŒç½‘ç»œç±»å‹çš„ <strong>å®é™…åº”ç”¨åœºæ™¯</strong> ï¼Ÿ</li></ol><h3><span id="1ç½‘ç»œèŠ‚ç‚¹">1.ç½‘ç»œèŠ‚ç‚¹</span></h3><p>è¿æ¥åˆ°ç½‘ç»œä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡é€šä¿¡é€šé“å‘é€ã€æ¥æ”¶æˆ–è½¬å‘ä¿¡æ¯çš„è®¾å¤‡ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç§°å…¶ä¸ºä¸€ä¸ª <strong>ã€Œç½‘ç»œèŠ‚ç‚¹ã€</strong>ã€‚æ¯”å¦‚ <strong>äº¤æ¢æœº</strong>ã€<strong>è·¯ç”±å™¨</strong>ã€<strong>ç”µè„‘</strong>ã€<strong>æ‰“å°æœº</strong>ã€<strong>æ‰‹æœº</strong> ç­‰ï¼Œéƒ½å±äºç½‘ç»œä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><h3><span id="2sohoç½‘ç»œ">2.Sohoç½‘ç»œ</span></h3><p><img src="https://img.hi-linux.com/staticfile/8845acd31302596cd39383bdceead741-20210315105105464-2021-03-15-iqUHON.gif" alt></p><p>åªæœ‰å‡ ä¸ªèŠ‚ç‚¹çš„å°å‹ç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸º <strong>ã€Œsohoç½‘ç»œã€</strong>ï¼Œå°å‹åŠå…¬å®¤æˆ–å®¶åº­åŠå…¬å®¤ä¸­æ„å»ºçš„ç½‘ç»œéƒ½å±äº <strong>ã€Œsohoç½‘ç»œã€</strong>ã€‚é€šå¸¸æ˜¯åªæœ‰å‡ å°ç”µè„‘ï¼Œæ‰“å°æœºï¼Œå‡ éƒ¨æ‰‹æœºå’Œå¹³æ¿ç”µè„‘çš„å°èŒƒå›´å†…çš„ç½‘ç»œç¯å¢ƒã€‚</p><p><img src="https://img.hi-linux.com/staticfile/00480f87a5ef9b3dc953df3b5289dfba-2021-03-15-SfyT2P.gif" alt="äº¤æ¢æœº"></p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œäººä»¬ç»å¸¸æŠŠã€Œäº¤æ¢æœºã€è¯´æˆæ˜¯ã€Œä¸­å¤®é›†çº¿å™¨&quot;ï¼Œä¹Ÿç¡®å®ï¼Œã€äº¤æ¢æœºã€Œé•¿å¾—çš„ç¡®åƒã€é›†çº¿å™¨ã€Œï¼Œä½†æ˜¯è¿™é‡Œå¤§å®¶è¯·è®°ä½ï¼Œäº¤æ¢æœºå’Œé›†çº¿å™¨æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼é›†çº¿å™¨çœŸçš„æ˜¯å¾ˆè€çš„æŠ€æœ¯äº†ï¼Œæˆ‘ä»¬ç°åœ¨åŸºæœ¬ä¸Šè§ä¸åˆ°ã€‚è€Œäº¤æ¢æœºæ˜¯ç°åœ¨éå¸¸å¸¸ç”¨çš„ç½‘ç»œè®¾å¤‡ï¼Œä¸€å®šè¦åˆ†æ¸…æ¥šå“¦ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/8eebc49e3ac319985ca0b27d2c4d2826-2021-03-15-pmqxRF.gif" alt="è·¯ç”±å™¨ï¼ˆé›†æˆäº†äº¤æ¢æœºã€è·¯ç”±å™¨çš„åŠŸèƒ½ï¼‰"></p><p>åœ¨sohoç½‘ç»œä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨è·¯ç”±å™¨æ¥å®Œæˆç½‘ç»œè¿æ¥ï¼Œå› ä¸ºç°ä»£çš„è·¯ç”±å™¨å¤§å¤šé›†æˆäº†è·¯ç”±å™¨ã€äº¤æ¢æœºçš„åŠŸèƒ½ï¼Œä½†é€šå¸¸å› ä¸ºè·¯ç”±å™¨çš„æ¥å£å¾ˆå°‘ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½æ¥å…¥å°‘é‡èŠ‚ç‚¹è®¾å¤‡å®ç°ç½‘ç»œå…±äº«ã€‚</p><h3><span id="3å±€åŸŸç½‘lan">3.å±€åŸŸç½‘ï¼ˆLANï¼‰</span></h3><p><img src="https://img.hi-linux.com/staticfile/5d27a97a2cd85a9e5e220b3116e3d54b-20210315105115056-2021-03-15-KMcuoy.gif" alt="ä¼ä¸šç½‘ç»œ"></p><p>ä½†å…¶å®åœ¨ä¸€ä¸ªå…¬å¸ä¼ä¸šé‡Œé¢ï¼Œå¾ˆæ˜æ˜¾å…‰æœ‰ä¸€å°è·¯ç”±å™¨ï¼Œä¸€å°äº¤æ¢æœºæ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼ä¾‹å¦‚ï¼Œä¸€ä¸ªåœ°æ–¹é“¶è¡Œä¼ä¸šï¼Œä»–ä»¬çš„ç½‘ç»œè®¾å¤‡å¯èƒ½éå¸ƒå‡ ä¸ªæ¥¼å±‚ã€ç”šè‡³è·¨è¶Šå¤šæ ‹æ¥¼æˆ¿ï¼Œæ­¤æ—¶ï¼Œå°†æ­¤è§„æ¨¡çš„ç½‘ç»œè®¾å¤‡è¿æ¥åœ¨ä¸€èµ·çš„ç½‘ç»œï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <strong>ã€Œå±€åŸŸç½‘(LAN)ã€</strong>ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/b87d933f16478782b83735bd224e3084-20210315105119063-2021-03-15-kcFZQq.gif" alt="å±€åŸŸç½‘ - 1"></p><p>å…¶å®ã€sohoç½‘ç»œã€Œä¹Ÿå±äºå±€åŸŸç½‘ï¼Œåªä¸è¿‡ã€sohoç½‘ç»œã€Œè¿æ¥äº†å°‘æ•°è®¾å¤‡ã€‚è€Œåœ¨ä¼ä¸šç½‘ç»œä¸­ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨å¤šå°äº¤æ¢æœºä¸è·¯ç”±å™¨çš„é“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œå°±æ˜¯å°†å¤šä¸ªã€sohoç½‘ç»œã€Œè¿æ¥åœ¨ä¸€èµ·çš„è¾ƒå¤§çš„ç½‘ç»œç»“æ„ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/7e25a032df4756d4570d1f5cf8729c8c-2021-03-15-Ci5T4S.gif" alt="å±€åŸŸç½‘ - 2"></p><h3><span id="4å¹¿åŸŸç½‘wan">4.å¹¿åŸŸç½‘ï¼ˆWANï¼‰</span></h3><p>è™½ç„¶ã€å±€åŸŸç½‘æŠ€æœ¯ã€Œå¯ä»¥è®©ä¸€ä¸ªè¾ƒå¤§åŒºåŸŸå†…çš„ç½‘ç»œèŠ‚ç‚¹å®ç°äº’è¿äº’é€šä¸ä¿¡æ¯å…±äº«ï¼Œä½†å¦‚æœè¿™ä¸ªåŒºåŸŸå†æ‰©å¤§ï¼Œè·¨è¶Šäº†åŸå¸‚ï¼Œè·¨è¶Šäº†åœ°åŒºè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå°±æ¯”å¦‚ä¸€ä¸ªè·¨åœ°åŒºçš„é“¶è¡Œä¼ä¸šï¼Œé€šå¸¸ä¸ä¼šåªåœ¨ä¸€ä¸ªåœ°åŒºæœ‰åŠå…¬æ¥¼ï¼Œå¯èƒ½åœ¨å…¨å›½å„ä¸ªåœ°åŒºéƒ½ä¼šæœ‰è‡ªå·±çš„åŠå…¬æ¥¼ï¼Œæ­¤æ—¶é“¶è¡Œç½‘ç»œå˜å¾—éå¸¸å·¨å¤§ï¼Œå³ä½¿è·ç¦»é¥è¿œï¼Œé“¶è¡Œä¼ä¸šä¹Ÿæƒ³å®ç°è®©æ‰€æœ‰çš„è¿™äº›ç½‘ç»œéƒ½è¿æ¥åœ¨ä¸€èµ·ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°æ–°çš„ç½‘ç»œæ„å»ºæŠ€æœ¯ ã€Œå¹¿åŸŸç½‘(WAN)ã€ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/1-20210315104554845-2021-03-15-trNbY6.png" alt="å¹¿åŸŸç½‘"></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æœ‰ä¸€å®¶è·¨å›½å…¬å¸åœ¨æ‚‰å°¼å’Œå¢¨å°”æœ¬éƒ½æœ‰åˆ†å…¬å¸ï¼Œæˆ‘ä»¬åœ¨æ‚‰å°¼çš„åŠå…¬å®¤åˆ†äº«äº†æ•°æ®ï¼Œåœ¨å¢¨å°”æœ¬çš„åŠå…¬å®¤æƒ³è¦è·å–è¿™äº›æ•°æ®ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°±éœ€è¦è”ç³»æœåŠ¡æä¾›å•†æ¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿œè·ç¦»æ•°æ®çš„äº¤äº’ã€‚</p><p><img src="https://img.hi-linux.com/staticfile/8e390b2a79dc6100405bc23f2522182d-2021-03-15-aPfKtc.gif" alt="æ‚‰å°¼åŠå…¬å®¤åˆ†äº«æ•°æ®åˆ°å¢¨å°”æœ¬åŠå…¬å®¤"></p><h3><span id="5æ€»ç»“">5.æ€»ç»“</span></h3><ol><li><strong>sohoç½‘ç»œï¼š</strong> é€šå¸¸é€‚åˆå®¶åº­æˆ–å°å‹åŠå…¬å®¤</li><li><strong>å±€åŸŸç½‘LANï¼š</strong> é€‚åˆå¤šä¸ªæ¥¼å±‚çš„ç½‘ç»œæ¶æ„</li><li><strong>åŸåŸŸç½‘MANï¼š</strong> é€‚åˆ10~100kmèŒƒå›´å†…çš„ç½‘ç»œæ¶æ„</li><li><strong>å¹¿åŸŸç½‘WANï¼š</strong> é€‚åˆ100kmä»¥ä¸Šï¼Œé€šå¸¸æ˜¯è·¨è¶Šå›½å®¶ä¸åœ°åŒºçš„å¤§å‹ç½‘ç»œæ¶æ„</li></ol><h3><span id="6å°æµ‹è¯•">6.å°æµ‹è¯•</span></h3><ol><li>ä½ åœ¨ä¸€å®¶è´¢åŠ¡éƒ¨é—¨ã€å·¥ç¨‹éƒ¨é—¨ã€ç®¡ç†éƒ¨é—¨å„æœ‰ä¸€ä¸ª <strong>å±€åŸŸç½‘LAN</strong> çš„å…¬å¸å·¥ä½œï¼Œä¸‰ä¸ªéƒ¨é—¨çš„å±€åŸŸç½‘éƒ½è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªç½‘ç»œä»ç„¶æ˜¯ <strong>å±€åŸŸç½‘LAN</strong> å—ï¼Ÿ</li><li>é™¤äº†æ€»å…¬å¸ï¼Œè¯¥å…¬å¸è¿˜æœ‰å…­ä¸ªåˆ†å…¬å¸ï¼Œé‚£ä¹ˆè¿™å®¶å…¬å¸çš„ç½‘ç»œè¿æ¥ç±»å‹å±äºå“ªç§ç½‘ç»œï¼Ÿ</li></ol><h3><span id="ç»“è¯­">ç»“è¯­</span></h3><p>å¦‚æœä½ è§‰å¾—æ–‡ç« å¾ˆæ£’ï¼Œå¯ä»¥è½¬å‘ï¼Œè¯„è®ºè¯¥æ–‡ç« ï¼›å¦‚æœæ–‡ç« æœ‰é—®é¢˜ï¼Œè¯·ç•™è¨€æˆ–ç§ä¿¡å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šåœ¨ç¬¬ä¸€æ—¶é—´å¯¹å†…å®¹è¿›è¡Œè°ƒæ•´ï¼Œè¿™å°†ä¼šå¸®åŠ©æ¯ä¸€ä½æƒ³è¦å­¦ä¹ ç½‘ç»œåŸºç¡€çš„å°ä¼™ä¼´ï¼Œæ„Ÿè°¢ï¼æŠ±æ‹³ï¼</p><h4><span id="åŸä½œè€…">åŸä½œè€…ï¼š</span></h4><ul><li>åŸæ–‡ä½œè€…ï¼šNetwork Direction</li><li>é“¾æ¥åœ°å€ï¼š<a href="https://www.youtube.com/watch?v=v8aYhOxZuNg&amp;list=PLDQaRcbiSnqF5U8ffMgZzS7fq1rHUI3Q8&amp;index=16&amp;t=28s" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹</a></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ å°‘æ•°æ´¾ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://sspai.com/post/64634" target="_blank" rel="noopener">https://sspai.com/post/64634</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;å¼•è¨€&lt;/h2&gt;
&lt;p&gt;æ¬¢è¿æ¥åˆ°ç½‘ç»œä¸–ç•Œï¼Œã€Šå°ç™½ä¹Ÿèƒ½çœ‹æ‡‚çš„ç½‘ç»œåŸºç¡€ã€‹ç³»åˆ—æ–‡ç« ä¼šä»é›¶å¼€å§‹å¸®åŠ©ä½ æ„å»ºç½‘ç»œçš„åŸºç¡€çŸ¥è¯†ã€‚å¦‚æœä½ å®Œå…¨æ²¡æœ‰æ¥è§¦è¿‡ç½‘ç»œç›¸å…³çš„å†…å®¹ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸€æ ·çš„ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æˆ‘ä»¬è‚¯å®šé‡åˆ°äº†ç›¸åŒçš„é—®é¢˜ï¼å†™ä¸‹è¿™äº›æ–‡ç« ä¸€æ–¹é¢è¦è®°å½•è‡ªå·±çš„å­¦ä¹ å†ç¨‹ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¸Œæœ›å¸®åˆ°åŒæ ·æƒ³è¦å­¦ä¹ ç½‘ç»œåŸºç¡€çš„å°ä¼™ä¼´ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä¸ç´ ææ˜¯æˆ‘ä»ã€Youtubeå¹³å°ã€‘çš„ã€&lt;a href=&quot;https://www.youtube.com/channel/UCtuXekfqj-paqsxtqVNCC2A&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Network Direction&lt;/a&gt;ã€‘å‘å¸ƒçš„ç³»åˆ—è§†é¢‘å­¦ä¹ å’Œæœé›†è¿‡æ¥çš„ï¼Œç¿»è¯‘ä¸æ˜“ï¼Œéƒ¨åˆ†å†…å®¹å¯èƒ½æ— æ³•åšåˆ°å°½å–„å°½ç¾ï¼Œç”šè‡³å¯èƒ½ä¼šæœ‰éƒ¨åˆ†ç‘•ç–µï¼Œæˆ‘ä¼šå°½åŠ›è®©æ–‡ç« å†…å®¹é€šä¿—æ˜“æ‡‚ï¼Œè¦†ç›–å…¨é¢ã€‚è‹¥å„ä½å°ä¼™ä¼´å‘ç°ä»»ä½•é—®é¢˜ï¼Œå¸Œæœ›èƒ½å¤Ÿç•™è¨€æˆ–ç§ä¿¡å‘Šè¯‰æˆ‘ï¼Œåœ¨ä¸‹ä¸èƒœæ„Ÿæ¿€ï¼å½“ç„¶ï¼Œæˆ‘ä¹Ÿä¼šåœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œæ›´æ­£ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¾€åçš„æ¯ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘éƒ½ä¼šæŠŠçœ‹åˆ°æ–‡ç« çš„å°ä¼™ä¼´å½“æˆæ˜¯å®Œå…¨æ²¡æœ‰ç½‘ç»œç»éªŒçš„å°ç™½ï¼Œæˆ‘çš„ç›®æ ‡æ˜¯å’Œé›¶åŸºç¡€å°ç™½ä¸€èµ·å»ºç«‹åšå®çš„ç½‘ç»œåŸºç¡€ï¼Œç½‘ç»œå¤§ç¥è¯·ç•¥è¿‡æ­¤ç³»åˆ—æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å¼€å§‹ç½‘ç»œä¹‹æ—…å§ï¼&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç½‘ç»œ" scheme="https://www.hi-linux.com/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="ç½‘ç»œ" scheme="https://www.hi-linux.com/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä¼˜é›…çš„ç»™ Docker é…ç½®ç½‘ç»œä»£ç†</title>
    <link href="https://www.hi-linux.com/posts/32693.html"/>
    <id>https://www.hi-linux.com/posts/32693.html</id>
    <published>2021-03-15T01:00:00.000Z</published>
    <updated>2021-03-15T01:28:03.518Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>æœ‰æ—¶å› ä¸ºç½‘ç»œåŸå› ï¼Œæ¯”å¦‚å…¬å¸ NATï¼Œæˆ–å…¶å®ƒå•¥çš„ï¼Œéœ€è¦ä½¿ç”¨ä»£ç†ã€‚ <code>Docker</code> çš„ä»£ç†é…ç½®ï¼Œç•¥æ˜¾å¤æ‚ï¼Œå› ä¸ºæœ‰ä¸‰ç§åœºæ™¯ã€‚ ä½†åŸºæœ¬åŸç†éƒ½æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨ <code>Linux</code> çš„ <code>http_proxy</code> ç­‰ç¯å¢ƒå˜é‡ã€‚</p><h2><span id="dockerd-ä»£ç†">Dockerd ä»£ç†</span></h2><p>åœ¨æ‰§è¡Œ<code>docker pull</code>æ—¶ï¼Œæ˜¯ç”±å®ˆæŠ¤è¿›ç¨‹<code>dockerd</code>æ¥æ‰§è¡Œã€‚ å› æ­¤ï¼Œä»£ç†éœ€è¦é…åœ¨<code>dockerd</code>çš„ç¯å¢ƒä¸­ã€‚ è€Œè¿™ä¸ªç¯å¢ƒï¼Œåˆ™æ˜¯å—<code>systemd</code>æ‰€ç®¡æ§ï¼Œå› æ­¤å®é™…æ˜¯<code>systemd</code>çš„é…ç½®ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/systemd/system/docker.service.d</span><br><span class="line">sudo touch /etc/systemd/system/docker.service.d/proxy.conf</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª<code>proxy.conf</code>æ–‡ä»¶ï¼ˆå¯ä»¥æ˜¯ä»»æ„<code>*.conf</code>çš„å½¢å¼ï¼‰ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Environment</span>=<span class="string">"HTTP_PROXY=http://proxy.example.com:8080/"</span></span><br><span class="line"><span class="attr">Environment</span>=<span class="string">"HTTPS_PROXY=http://proxy.example.com:8080/"</span></span><br><span class="line"><span class="attr">Environment</span>=<span class="string">"NO_PROXY=localhost,127.0.0.1,.example.com"</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>proxy.example.com:8080</code> è¦æ¢æˆå¯ç”¨çš„å…å¯†ä»£ç†ã€‚ é€šå¸¸ä½¿ç”¨ <code>cntlm</code> åœ¨æœ¬æœºè‡ªå»ºå…å¯†ä»£ç†ï¼Œå»å¯¹æ¥å…¬å¸çš„ä»£ç†ã€‚ å¯å‚è€ƒã€Š<a href="https://note.qidong.name/content/2018/11/cntlm-proxy/" target="_blank" rel="noopener">Linuxä¸‹å®‰è£…é…ç½®Cntlmä»£ç†</a>ã€‹ã€‚</p><a id="more"></a><h2><span id="container-ä»£ç†">Container ä»£ç†</span></h2><p>åœ¨å®¹å™¨è¿è¡Œé˜¶æ®µï¼Œå¦‚æœéœ€è¦ä»£ç†ä¸Šç½‘ï¼Œåˆ™éœ€è¦é…ç½® <code>~/.docker/config.json</code>ã€‚ ä»¥ä¸‹é…ç½®ï¼Œåªåœ¨Docker 17.07åŠä»¥ä¸Šç‰ˆæœ¬ç”Ÿæ•ˆã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">"proxies"</span>:</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="attr">"default"</span>:</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="attr">"httpProxy"</span>: <span class="string">"http://proxy.example.com:8080"</span>,</span><br><span class="line">     <span class="attr">"httpsProxy"</span>: <span class="string">"http://proxy.example.com:8080"</span>,</span><br><span class="line">     <span class="attr">"noProxy"</span>: <span class="string">"localhost,127.0.0.1,.example.com"</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯ç”¨æˆ·çº§çš„é…ç½®ï¼Œé™¤äº† <code>proxies</code>ï¼Œ<code>docker login</code> ç­‰ç›¸å…³ä¿¡æ¯ä¹Ÿä¼šåœ¨å…¶ä¸­ã€‚ è€Œä¸”è¿˜å¯ä»¥é…ç½®ä¿¡æ¯å±•ç¤ºçš„æ ¼å¼ã€æ’ä»¶å‚æ•°ç­‰ã€‚</p><p>æ­¤å¤–ï¼Œå®¹å™¨çš„ç½‘ç»œä»£ç†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨å…¶è¿è¡Œæ—¶é€šè¿‡ <code>-e</code> æ³¨å…¥ <code>http_proxy</code> ç­‰ç¯å¢ƒå˜é‡ã€‚ è¿™ä¸¤ç§æ–¹æ³•åˆ†åˆ«é€‚åˆä¸åŒåœºæ™¯ã€‚ <code>config.json</code> éå¸¸æ–¹ä¾¿ï¼Œé»˜è®¤åœ¨æ‰€æœ‰é…ç½®ä¿®æ”¹åå¯åŠ¨çš„å®¹å™¨ç”Ÿæ•ˆï¼Œé€‚åˆä¸ªäººå¼€å‘ç¯å¢ƒã€‚ åœ¨CI/CDçš„è‡ªåŠ¨æ„å»ºç¯å¢ƒã€æˆ–è€…å®é™…ä¸Šçº¿è¿è¡Œçš„ç¯å¢ƒä¸­ï¼Œè¿™ç§æ–¹æ³•å°±ä¸å¤ªåˆé€‚ï¼Œç”¨ <code>-e</code> æ³¨å…¥è¿™ç§æ˜¾å¼é…ç½®ä¼šæ›´å¥½ï¼Œå‡è½»å¯¹æ„å»ºã€éƒ¨ç½²ç¯å¢ƒçš„ä¾èµ–ã€‚ å½“ç„¶ï¼Œåœ¨è¿™äº›ç¯å¢ƒä¸­ï¼Œæœ€å¥½ç”¨è‰¯å¥½çš„è®¾è®¡é¿å…é…ç½®ä»£ç†ä¸Šç½‘ã€‚</p><h2><span id="docker-build-ä»£ç†">Docker Build ä»£ç†</span></h2><p>è™½ç„¶ <code>docker build</code> çš„æœ¬è´¨ï¼Œä¹Ÿæ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œä½†æ˜¯ç¯å¢ƒä¼šç•¥æœ‰ä¸åŒï¼Œç”¨æˆ·çº§é…ç½®æ— æ•ˆã€‚ åœ¨æ„å»ºæ—¶ï¼Œéœ€è¦æ³¨å…¥ <code>http_proxy</code> ç­‰å‚æ•°ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build . \</span><br><span class="line">    --build-arg <span class="string">"HTTP_PROXY=http://proxy.example.com:8080/"</span> \</span><br><span class="line">    --build-arg <span class="string">"HTTPS_PROXY=http://proxy.example.com:8080/"</span> \</span><br><span class="line">    --build-arg <span class="string">"NO_PROXY=localhost,127.0.0.1,.example.com"</span> \</span><br><span class="line">    -t your/image:tag</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šæ— è®ºæ˜¯ <code>docker run</code> è¿˜æ˜¯ <code>docker build</code>ï¼Œé»˜è®¤æ˜¯ç½‘ç»œéš”ç»çš„ã€‚ å¦‚æœä»£ç†ä½¿ç”¨çš„æ˜¯ <code>localhost:3128</code> è¿™ç±»ï¼Œåˆ™ä¼šæ— æ•ˆã€‚ è¿™ç±»ä»…é™æœ¬åœ°çš„ä»£ç†ï¼Œå¿…é¡»åŠ ä¸Š <code>--network host</code> æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ è€Œä¸€èˆ¬åˆ™éœ€è¦é…ç½®ä»£ç†çš„å¤–éƒ¨IPï¼Œè€Œä¸”ä»£ç†æœ¬èº«è¦å¼€å¯ Gateway æ¨¡å¼ã€‚</p><h2><span id="é‡å¯ç”Ÿæ•ˆ">é‡å¯ç”Ÿæ•ˆ</span></h2><p>ä»£ç†é…ç½®å®Œæˆåï¼Œ<code>reboot</code> é‡å¯å½“ç„¶å¯ä»¥ç”Ÿæ•ˆï¼Œä½†ä¸é‡å¯ä¹Ÿè¡Œã€‚</p><p><code>docker build</code> ä»£ç†æ˜¯åœ¨æ‰§è¡Œå‰è®¾ç½®çš„ï¼Œæ‰€ä»¥ä¿®æ”¹åï¼Œä¸‹æ¬¡æ‰§è¡Œç«‹å³ç”Ÿæ•ˆã€‚ Container ä»£ç†çš„ä¿®æ”¹ä¹Ÿæ˜¯ç«‹å³ç”Ÿæ•ˆçš„ï¼Œä½†æ˜¯åªé’ˆå¯¹ä»¥åå¯åŠ¨çš„ Containerï¼Œå¯¹å·²ç»å¯åŠ¨çš„ Container æ— æ•ˆã€‚</p><p><code>dockerd</code> ä»£ç†çš„ä¿®æ”¹æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒå®é™…ä¸Šæ˜¯æ”¹ <code>systemd</code> çš„é…ç½®ï¼Œå› æ­¤éœ€è¦é‡è½½ <code>systemd</code> å¹¶é‡å¯ <code>dockerd</code> æ‰èƒ½ç”Ÿæ•ˆã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2><span id="å‚è€ƒ">å‚è€ƒ</span></h2><ul><li><a href="https://docs.docker.com/config/daemon/systemd/" target="_blank" rel="noopener">Control Docker with systemd | Docker Documentation</a></li><li><a href="https://docs.docker.com/network/proxy/" target="_blank" rel="noopener">Configure Docker to use a proxy server | Docker Documentation</a></li><li><a href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank" rel="noopener">Use the Docker command line | Docker Documentation</a></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ é›¶å£¹è»’Â·ç¬”è®° ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A6tMEC2k" target="_blank" rel="noopener">http://t.cn/A6tMEC2k</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ‰æ—¶å› ä¸ºç½‘ç»œåŸå› ï¼Œæ¯”å¦‚å…¬å¸ NATï¼Œæˆ–å…¶å®ƒå•¥çš„ï¼Œéœ€è¦ä½¿ç”¨ä»£ç†ã€‚ &lt;code&gt;Docker&lt;/code&gt; çš„ä»£ç†é…ç½®ï¼Œç•¥æ˜¾å¤æ‚ï¼Œå› ä¸ºæœ‰ä¸‰ç§åœºæ™¯ã€‚ ä½†åŸºæœ¬åŸç†éƒ½æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨ &lt;code&gt;Linux&lt;/code&gt; çš„ &lt;code&gt;http_proxy&lt;/code&gt; ç­‰ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Dockerd-ä»£ç†&quot;&gt;Dockerd ä»£ç†&lt;/h2&gt;
&lt;p&gt;åœ¨æ‰§è¡Œ&lt;code&gt;docker pull&lt;/code&gt;æ—¶ï¼Œæ˜¯ç”±å®ˆæŠ¤è¿›ç¨‹&lt;code&gt;dockerd&lt;/code&gt;æ¥æ‰§è¡Œã€‚ å› æ­¤ï¼Œä»£ç†éœ€è¦é…åœ¨&lt;code&gt;dockerd&lt;/code&gt;çš„ç¯å¢ƒä¸­ã€‚ è€Œè¿™ä¸ªç¯å¢ƒï¼Œåˆ™æ˜¯å—&lt;code&gt;systemd&lt;/code&gt;æ‰€ç®¡æ§ï¼Œå› æ­¤å®é™…æ˜¯&lt;code&gt;systemd&lt;/code&gt;çš„é…ç½®ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo mkdir -p /etc/systemd/system/docker.service.d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo touch /etc/systemd/system/docker.service.d/proxy.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨è¿™ä¸ª&lt;code&gt;proxy.conf&lt;/code&gt;æ–‡ä»¶ï¼ˆå¯ä»¥æ˜¯ä»»æ„&lt;code&gt;*.conf&lt;/code&gt;çš„å½¢å¼ï¼‰ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[Service]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;HTTP_PROXY=http://proxy.example.com:8080/&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;HTTPS_PROXY=http://proxy.example.com:8080/&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;NO_PROXY=localhost,127.0.0.1,.example.com&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ&lt;code&gt;proxy.example.com:8080&lt;/code&gt; è¦æ¢æˆå¯ç”¨çš„å…å¯†ä»£ç†ã€‚ é€šå¸¸ä½¿ç”¨ &lt;code&gt;cntlm&lt;/code&gt; åœ¨æœ¬æœºè‡ªå»ºå…å¯†ä»£ç†ï¼Œå»å¯¹æ¥å…¬å¸çš„ä»£ç†ã€‚ å¯å‚è€ƒã€Š&lt;a href=&quot;https://note.qidong.name/content/2018/11/cntlm-proxy/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Linuxä¸‹å®‰è£…é…ç½®Cntlmä»£ç†&lt;/a&gt;ã€‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://www.hi-linux.com/categories/docker/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Docker" scheme="https://www.hi-linux.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>6 ä¸ªè¶…å®ç”¨çš„ Sudo å‘½ä»¤ä½¿ç”¨æŠ€å·§</title>
    <link href="https://www.hi-linux.com/posts/31636.html"/>
    <id>https://www.hi-linux.com/posts/31636.html</id>
    <published>2021-03-12T01:00:00.000Z</published>
    <updated>2021-03-12T01:16:18.933Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p><strong>Sudo æˆæƒéœ€è°¨æ…ï¼Œå¦åˆ™äº²äººä¸¤è¡Œæ³ªï¼</strong></p></blockquote><p><code>sudo</code> è¡¨ç¤º <code>â€œsuperuser doâ€</code>ï¼Œå®ƒå…è®¸å·²éªŒè¯çš„ç”¨æˆ·ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½æ¥è¿è¡Œå‘½ä»¤ã€‚å…¶ä»–ç”¨æˆ·å¯ä»¥æ˜¯æ™®é€šç”¨æˆ·æˆ–è€…è¶…çº§ç”¨æˆ·ã€‚ç„¶è€Œï¼Œå¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬ç”¨å®ƒæ¥ææƒè¿è¡Œå‘½ä»¤ï¼Œä»¥æ›¿ä»£ç›´æ¥ä½¿ç”¨ <code>root</code> ç”¨æˆ·çš„æ“ä½œã€‚<code>sudo</code> å‘½ä»¤ä¸å®‰å…¨ç­–ç•¥é…åˆä½¿ç”¨ï¼Œå®‰å…¨ç­–ç•¥å¯ä»¥é€šè¿‡æ–‡ä»¶ <code>/etc/sudoers</code> æ¥é…ç½®ã€‚å…¶å®‰å…¨ç­–ç•¥å…·æœ‰é«˜åº¦å¯æ‹“å±•æ€§ï¼Œæ”¯æŒæ’ä»¶æ‰©å±•ã€‚é»˜è®¤æƒ…å†µä¸‹ <code>/etc/sudoers</code> æ˜¯ä¸èƒ½è¢«ä»»ä½•äººç›´æ¥ç¼–è¾‘çš„ï¼Œå› ä¸ºå®ƒçš„æƒé™æ˜¯ <code>440</code>ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥å¯¹å…¶èµ‹äºˆå†™æƒé™åå†ç¼–è¾‘ï¼Œä½†æ¨èä½¿ç”¨ <code>visudo</code> å‘½ä»¤ç¼–è¾‘è¯¥æ–‡ä»¶ã€‚</p><h2><span id="1-å·¥ä½œæ¨¡å¼ç†è§£">1. å·¥ä½œæ¨¡å¼ç†è§£</span></h2><blockquote><p><strong>ç®€è¿°å…¶ä½¿ç”¨å·¥ä½œæµç¨‹å’Œé…ç½®æ–‡ä»¶é…ç½®ï¼</strong></p></blockquote><ul><li><strong>[1] ç†è§£ sudo å‘½ä»¤çš„å·¥ä½œæµç¨‹</strong><ul><li><code>sudo</code> ä¼šè¯»å–å’Œè§£æ <code>/etc/sudoers</code> æ–‡ä»¶ï¼ŒæŸ¥æ‰¾è°ƒç”¨å‘½ä»¤çš„ç”¨æˆ·åŠå…¶æƒé™ã€‚</li><li>ç„¶åæç¤ºè°ƒç”¨è¯¥å‘½ä»¤çš„ç”¨æˆ·è¾“å…¥å¯†ç ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ <code>NOPASSWD</code> æ ‡å¿—æ¥è·³è¿‡å¯†ç éªŒè¯ã€‚</li><li>ä¹‹åï¼Œ<code>sudo</code> åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè°ƒç”¨ <code>setuid()</code> æ¥åˆ‡æ¢åˆ°ç›®æ ‡ç”¨æˆ·ã€‚</li><li>æœ€å¥½ï¼Œå®ƒä¼šåœ¨ä¸Šè¿°å­è¿›ç¨‹ä¸­æ‰§è¡Œå‚æ•°ç»™å®šçš„ <code>shell</code> æˆ–å‘½ä»¤ã€‚</li></ul></li><li><strong>[2] ç†è§£ sudo å‘½ä»¤æˆæƒé…ç½®</strong><ul><li><strong>USER/GROUP HOST=(USER[:GROUP]) [NOPASSWD:] COMMANDS</strong></li><li><code>USER/GROUP</code>: è¡¨ç¤ºéœ€è¦è¢«æˆæƒçš„ç”¨æˆ·æˆ–è€…ç»„ï¼›å¦‚æœæ˜¯ç»„åˆ™éœ€è¦ä»¥ % å¼€å¤´</li><li><code>HOST</code>: è¡¨ç¤ºå…è®¸ä»å“ªäº›ä¸»æœºç™»å½•çš„ç”¨æˆ·è¿è¡Œ sudo å‘½ä»¤ï¼›ALL è¡¨ç¤ºå…è®¸ä»ä»»ä½•ç»ˆç«¯ã€æœºå™¨è®¿é—®</li><li><code>(USER[:GROUP])</code>: è¡¨ç¤ºä½¿ç”¨ sudo å¯åˆ‡æ¢çš„ç”¨æˆ·æˆ–è€…ç»„ï¼Œç»„å¯ä»¥ä¸æŒ‡å®šï¼›ALL è¡¨ç¤ºå¯ä»¥åˆ‡æ¢åˆ°ç³»ç»Ÿçš„æ‰€æœ‰ç”¨æˆ·</li><li><code>NOPASSWD</code>: å¦‚æœæŒ‡å®šï¼Œåˆ™è¯¥ç”¨æˆ·æˆ–ç»„ä½¿ç”¨ sudo æ—¶ä¸å¿…è¾“å…¥å¯†ç </li><li><code>COMMANDS</code>: è¡¨ç¤ºè¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼›ALL è¡¨ç¤ºå…è®¸æ‰§è¡Œæ‰€æœ‰å‘½ä»¤</li></ul></li></ul><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸ sudo ç»„æ‰§è¡Œæ‰€æœ‰å‘½ä»¤</span></span><br><span class="line">%sudo ALL=(ALL:ALL) ALL</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸ç”¨æˆ·æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œä¸”æ— éœ€è¾“å…¥å¯†ç </span></span><br><span class="line">escape ALL =(ALL) NOPASSWD: ALL</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…å…è®¸ç”¨æˆ·æ‰§è¡Œ echo, ls å‘½ä»¤</span></span><br><span class="line">escape ALL =(ALL) NOPASSWD: /bin/<span class="built_in">echo</span> /bin/ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œæœ¬æœºçš„ç”¨æˆ·æ‰§è¡Œå…³æœºå‘½ä»¤</span></span><br><span class="line">escape localhost=/sbin/shutdown -h now</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸ users ç”¨æˆ·ç»„ä¸­çš„ç”¨æˆ·åƒ root ç”¨æˆ·ä¸€æ ·ä½¿ç”¨ mountã€unmountã€chrom å‘½ä»¤</span></span><br><span class="line">%users ALL=/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom</span><br></pre></td></tr></table></figure><ul><li><strong>[3] é…ç½® Defaults é€‰é¡¹</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šç”¨æˆ·å°è¯•è¾“å…¥å¯†ç çš„æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º3</span></span><br><span class="line">Defaults passwd_tries=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¯†ç è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º 5 åˆ†é’Ÿ</span></span><br><span class="line">Defaults passwd_timeout=2</span><br><span class="line"></span><br><span class="line">é»˜è®¤ sudo è¯¢é—®ç”¨æˆ·è‡ªå·±çš„å¯†ç ï¼Œæ·»åŠ  targetpw æˆ– rootpw é…ç½®å¯ä»¥è®© sudo è¯¢é—® root å¯†ç </span><br><span class="line">Defaults targetpw</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šè‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">Defaults logfile=<span class="string">"/var/log/sudo.log"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¦åœ¨è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•ä¸»æœºåå’Œå››ä½æ•°å¹´ä»½ï¼Œå¯ä»¥åŠ ä¸Š log_host å’Œ log_year å‚æ•°</span></span><br><span class="line">Defaults log_host, log_year, logfile=<span class="string">"/var/log/sudo.log"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿æŒå½“å‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">Defaults env_keep += <span class="string">"LANG LC_ADDRESS LC_CTYPE COLORS DISPLAY HOSTNAME EDITOR"</span></span><br><span class="line">Defaults env_keep += <span class="string">"ftp_proxy http_proxy https_proxy no_proxy"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰ç½®ä¸€ä¸ªå®‰å…¨çš„ PATH ç¯å¢ƒå˜é‡</span></span><br><span class="line">Defaults secure_path=<span class="string">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br></pre></td></tr></table></figure><h2><span id="2-ä½¿ç”¨æŠ€å·§æ€»ç»“">2. ä½¿ç”¨æŠ€å·§æ€»ç»“</span></h2><blockquote><p><strong>ä¸»è¦ä»‹ç»ä½¿ç”¨ sudo ç›¸å…³å‘½ä»¤çš„ä½¿ç”¨æŠ€å·§å’Œé—®é¢˜å¤„ç†æ–¹å¼ï¼</strong></p></blockquote><ul><li><strong>[1] å¦‚ä½•å°† visudo ç¼–è¾‘å™¨ä» nano æ›´æ”¹ä¸º vimï¼Ÿ</strong></li></ul><p>å½“æˆ‘ä½¿ç”¨ <code>visudo</code> å‘½ä»¤çš„æ—¶å€™ï¼Œå®ƒæ€»æ˜¯ç”¨ <code>nano</code> ç¼–è¾‘å™¨æ‰“å¼€å®ƒï¼Œå¯¹åº”å¹³æ—¶ä¹ æƒ¯ä½¿ç”¨ <code>vi</code> æˆ–è€… <code>vim</code> çš„ç”¨æˆ·æ¥è¯´ï¼Œæ˜¾å¾—æœ‰äº›åˆ«æ‰­ï¼Œä»¥åŠæ“ä½œä¸å¤Ÿè‡ªå¦‚ã€‚æ‰€ä»¥ï¼Œå¦‚ä½•æ›´å¥½çš„å°† <code>visudo</code> ç¼–è¾‘å™¨ä» <code>nano</code> æ›´æ”¹ä¸º <code>vim</code> å°±å˜å¾—éå¸¸é‡è¦äº†ã€‚</p><p>æœ€ä½³çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯è°ƒç”¨å‘½ä»¤ï¼Œæ°¸ä¹…çš„å°†ç»ˆç«¯çš„ç¼–è¾‘å™¨æ›´æ¢æˆä¸º <code>vim</code> ç¼–è¾‘å™¨ï¼Œä¸€åŠ³æ°¸é€¸ã€‚æˆ‘ä»¬åªéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¾“å…¥è‡ªå·±éœ€è¦çš„ç¼–è¾‘å™¨åºå·å¹¶æŒ‰ä¸‹å›è½¦é”®å³å¯ã€‚ä¸‹æ¬¡æ‰§è¡Œ <code>visudo</code> å‘½ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šä½¿ç”¨ <code>vim</code> ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å› ä¸º/etc/sudoersæ™®é€šç”¨æˆ·æ— æ³•æ‰“å¼€å’Œä½¿ç”¨</span></span><br><span class="line">$ sudo update-alternatives --config editor</span><br><span class="line">There are 4 choices <span class="keyword">for</span> the alternative editor (providing /usr/bin/editor).</span><br><span class="line">  Selection    Path                Priority   Status</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">* 0            /bin/nano            40        auto mode</span><br><span class="line">  1            /bin/ed             -100       manual mode</span><br><span class="line">  2            /bin/nano            40        manual mode</span><br><span class="line">  3            /usr/bin/vim.basic   30        manual mode</span><br><span class="line">  4            /usr/bin/vim.tiny    10        manual mode</span><br><span class="line"></span><br><span class="line">Press enter to keep the current choice[*], or <span class="built_in">type</span> selection number: 3</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡çš„è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡ä¿®æ”¹å½“å‰ç»ˆç«¯çš„é»˜è®¤ç¼–è¾‘å™¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨.zshrcæˆ–.profileæ–‡ä»¶ä¸­</span></span><br><span class="line">$ <span class="built_in">export</span> EDITOR=vim;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸Œæœ›æ‰§è¡Œå¯¹visudoç”Ÿæ•ˆ</span></span><br><span class="line">$ sudo EDITOR=vim visudo</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä¿®æ”¹/etc/sudoersæ–‡ä»¶çš„é»˜è®¤ç¼–è¾‘å™¨</span></span><br><span class="line">Defaults editor=/usr/bin/vim</span><br></pre></td></tr></table></figure><ul><li><strong>[2] Vim å¦‚ä½•å¼ºåˆ¶ä¿å­˜åªè¯»æ–‡ä»¶ï¼Ÿ</strong></li></ul><p>åœ¨ä½¿ç”¨ <code>vim</code> çš„æ—¶å€™ï¼Œå½“ä»¥æ™®é€šç”¨æˆ·æ‰“å¼€ä¸€ä¸ªåªæœ‰ <code>root</code> ç”¨æˆ·æ‰æœ‰æƒé™æ“ä½œçš„æ–‡ä»¶æ—¶ï¼Œåœ¨ç¼–è¾‘å®Œæˆä¹‹åä¿å­˜æ—¶å‘ç°ï¼Œè¿™ä¸ªæ–‡ä»¶æ²¡æœ‰æƒé™ä¿®æ”¹ã€‚å¥½ä¸å®¹æ˜“æŠŠæ–‡ä»¶ç¼–è¾‘å®Œäº†ï¼Œå´æ— æ³•ä¿å­˜ï¼Œå°±åªèƒ½æ”¾å¼ƒï¼Œç„¶åé€€å‡ºï¼Œå†ä»¥ <code>root</code> æƒé™æ‰“å¼€ï¼Œé‡æ–°ç¼–è¾‘ï¼Œæ˜¯åœ¨ç—›è‹¦ï¼é‚£æœ‰æ²¡æœ‰å¥½çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå’³å’³å’³ï¼Œè‚¯å®šæ˜¯æœ‰çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Vimå‘½ä»¤æ¨¡å¼ä¸‹æ‰§è¡Œå³å¯å¼ºåˆ¶ä¿å­˜</span></span><br><span class="line"><span class="comment"># w: è¡¨ç¤ºä¿å­˜æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># !: è¡¨ç¤ºæ‰§è¡Œå¤–éƒ¨å‘½ä»¤</span></span><br><span class="line"><span class="comment"># tee: è¡¨ç¤ºæŠŠæ•°æ®é‡å®šå‘åˆ°ç»™å®šæ–‡ä»¶å’Œå±å¹•ä¸Š</span></span><br><span class="line"><span class="comment"># %: åœ¨æ‰§è¡Œå¤–éƒ¨å‘½ä»¤æ—¶ï¼Œ%ä¼šæ‰©å±•æˆå½“å‰æ–‡ä»¶å</span></span><br><span class="line">:w !sudo tee %</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹å¼éå¸¸å®Œç¾çš„è§£å†³äº†ä¸èƒ½ä¿å­˜åªè¯»æ–‡ä»¶çš„é—®é¢˜ï¼Œä½†æ¯•ç«Ÿå‘½ä»¤è¿˜æ˜¯æœ‰äº›é•¿ï¼Œä¸ºäº†é¿å…æ¯æ¬¡è¾“å…¥ä¸€é•¿ä¸²çš„å‘½ä»¤ï¼Œå¯ä»¥å°†å®ƒæ˜ å°„ä¸ºä¸€ä¸ªç®€å•çš„å‘½ä»¤åŠ åˆ° <code>.vimrc</code> ä¸­ã€‚è¿™æ ·ï¼Œç®€å•çš„è¿è¡Œ <code>:w!!</code> å³å¯ï¼Œå‘½ä»¤ååŠéƒ¨åˆ† <code>&gt; /dev/null</code> ä½œç”¨ä¸ºæ˜¾å¼çš„ä¸¢æ‰æ ‡å‡†è¾“å‡ºçš„å†…å®¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">" Allow saving of files as sudo when I forgot to start vim using sudo.</span></span><br><span class="line"><span class="string">cmap w!! w !sudo tee &gt; /dev/null %</span></span><br></pre></td></tr></table></figure><ul><li><strong>[3] å¦‚ä½•æ›´åŠ å®‰å…¨åœ°ç¼–è¾‘æ–‡ä»¶ï¼Ÿ</strong></li></ul><p><code>Sudoedit</code> æ˜¯ä¸€ä¸ªå†…ç½®å‘½ä»¤ï¼Œå…è®¸ç”¨æˆ·å®‰å…¨åœ°ç¼–è¾‘æ–‡ä»¶ã€‚æ ¹æ® <code>sudo</code> æ‰‹å†Œé¡µï¼Œ<code>sudoedit</code> ç­‰æ•ˆäºä½¿ç”¨ <code>-e</code> å‘½ä»¤è¡Œé€‰é¡¹æ‰§è¡Œ <code>sudo</code>ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆå‘¢ï¼Œå®ƒä¼šé¦–å…ˆåˆ›å»ºä½ è¦ç¼–è¾‘çš„æ–‡ä»¶çš„ä¸´æ—¶å‰¯æœ¬ã€‚ç„¶åï¼Œå‘½ä»¤å°†æœç´¢ <code>SUDO_EDITOR</code>ï¼Œ<code>VISUAL</code> å’Œ <code>EDITOR</code> ç¯å¢ƒå˜é‡ï¼ˆæŒ‰æ­¤é¡ºåºï¼‰ï¼Œä»¥ç¡®å®šåº”è°ƒç”¨å“ªä¸ªç¼–è¾‘å™¨æ¥æ‰“å¼€åˆšåˆšåˆ›å»ºçš„ä¸´æ—¶å‰¯æœ¬ã€‚ ç”¨æˆ·å®Œæˆä¿®æ”¹å·¥ä½œåï¼Œæ›´æ”¹å°†å¤åˆ¶å›åŸå§‹æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sudoå‘½ä»¤æ‰‹å†Œé¡µ</span></span><br><span class="line">-e, --edit</span><br><span class="line">Edit one or more files instead of running a <span class="built_in">command</span>. In lieu of a path name,</span><br><span class="line">the string <span class="string">"sudoedit"</span> is used when consulting the security policy. If the user</span><br><span class="line">is authorized by the policy, the followingsteps are taken:</span><br><span class="line"></span><br><span class="line"> 1. Temporary copies are made of the files to be edited with</span><br><span class="line"> the owner <span class="built_in">set</span> to the invoking user.</span><br><span class="line"></span><br><span class="line"> 2. The editor specified by the policy is run to edit the</span><br><span class="line"> temporary files. The sudoers policy uses the</span><br><span class="line"> SUDO_EDITOR, VISUAL and EDITOR environment variables (<span class="keyword">in</span></span><br><span class="line"> that order). If none of SUDO_EDITOR, VISUAL or EDITOR</span><br><span class="line"> are <span class="built_in">set</span>, the first program listed <span class="keyword">in</span> the editor</span><br><span class="line"> sudoers(5) option is used.</span><br><span class="line"></span><br><span class="line"> 3. If they have been modified, the temporary files are</span><br><span class="line"> copied back to their original location and the temporary</span><br><span class="line"> versions are removed.</span><br><span class="line"></span><br><span class="line">If the specified file does not exist, it will be created. Note that unlike most</span><br><span class="line">commands run by sudo, the editor is run with the invoking user is environment</span><br><span class="line">unmodified. If, <span class="keyword">for</span> some reason, sudo is unable to update a file with its edited</span><br><span class="line">version, the user will receive a warning and the edited copy will remain <span class="keyword">in</span> a</span><br><span class="line">temporary file.</span><br></pre></td></tr></table></figure><ul><li><strong>[4] å¦‚ä½•è®© sudo ä¼šè¯æ—¶é—´éšå¿ƒæ‰€æ¬²ï¼Ÿ</strong></li></ul><p>å…¶ä¸­ <code>sudo</code> å‘½ä»¤æ˜¯æƒé™å§”æ´¾çš„å‘½ä»¤ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯éå¸¸å¸¸ç”¨çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>sudo</code> å‘½ä»¤ä¼šè¯æ—¶é—´æ˜¯åœ¨ <code>15</code> åˆ†é’Ÿã€‚è¦è®¾ç½® <code>sudo</code> å¯†ç è¶…æ—¶çš„å€¼ï¼Œéœ€è¦ä½¿ç”¨ <code>passwd_timeout</code> å‚æ•°è¿›è¡Œè®¾ç½®ã€‚</p><p>å¯ä»¥ä»¥åˆ†é’Ÿè®¾ç½®ä¸ºä½ æ‰€éœ€çš„ä»»ä½•æ—¶é—´ï¼Œå®ƒä¼šåœ¨è¶…æ—¶ä¹‹å‰ä¸€ç›´ç­‰å¾…ã€‚ å¦‚æœè¦ä¸ºæ¯ä¸ªæ‰§è¡Œçš„ <code>sudo</code> å‘½ä»¤å¼¹å‡ºå¯†ç æç¤ºï¼Œä½ ä¹Ÿå¯ä»¥å°†æ—¶é—´è®¾ç½®ä¸º <code>0</code>ï¼Œæˆ–è€…é€šè¿‡è®¾ç½®å€¼ <code>-1</code> æ°¸ä¹…ç¦ç”¨å¯†ç æç¤ºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®timeoutæ—¶é—´</span></span><br><span class="line"><span class="comment"># æ„å‘³ç€sudoå¯†ç æç¤ºå°†ä¼šåœ¨ç”¨æˆ·ä½¿ç”¨20åˆ†é’Ÿåè¿‡æœŸ</span></span><br><span class="line">Defaults        env_reset,timestamp_timeout=20</span><br></pre></td></tr></table></figure><ul><li><strong>[5] å¦‚ä½•æ›´åŠ å®‰å…¨çš„æˆæƒæœåŠ¡å™¨æƒé™ï¼Ÿ</strong></li></ul><p>å¦‚ä½•æˆ‘ä»¬ç®¡ç†çš„æœåŠ¡å™¨ï¼Œå¼€å‘æˆ–è€…å…¶ä»–äººå‘˜éœ€è¦ç™»å½•è¯¥æœåŠ¡å™¨ï¼Œè¿›è¡Œç¯å¢ƒè°ƒè¯•æˆ–è€…é—®é¢˜å¤ç°ç­‰æƒ…å†µã€‚è¿™æ—¶ï¼Œå°±éœ€è¦æˆ‘ä»¬ç»™å¯¹åº”çš„ç”¨æˆ·å¼€é€šç™»å½•çš„è®¿é—®æƒé™ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥ç¼–è¾‘ <code>/etc/sudoers</code> æ–‡ä»¶çš„è¯ï¼Œä¹‹åå½“å¯¹æ–¹ä½¿ç”¨å®Œæˆä¹‹åæˆ‘å°±è¿˜éœ€è¦æ‰‹åŠ¨è¿›è¡Œæ¸…ç†ã€‚å¦‚æœæˆ‘ä»¬å¿˜è®°çš„è¯ï¼Œè¯¥å¼€å‘æˆ–è€…å…¶ä»–äººå‘˜å°†ä¸€ç›´å¯ä»¥ç™»å½•è¯¥æœåŠ¡å™¨ï¼Œä¼šæœ‰ä¸€å®šç¨‹åº¦çš„å®‰å…¨é—®é¢˜ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œå¯¹åº”ä¸´æ—¶æˆæƒçš„è¯ï¼Œ<code>/etc/sudoers</code> æ–‡ä»¶ä¸­æ²¡æœ‰å¯¹åº”çš„é…ç½®ï¼Œå¯ä»¥å¯¹æŸä¸ªç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„è¿›è¡ŒæŒ‡å®šèŒƒå›´çš„æ—¶é—´æˆæƒã€‚å½“ç”¨æˆ·åˆ°è¾¾æŒ‡å®šæ—¶é—´ç‚¹ä¹‹åï¼Œå°†æ‹’ç»è¯¥ç”¨æˆ·å†æ¬¡è¿›è¡Œç™»å½•äº†ã€‚å¯¹åº”æ­¤ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>crontab</code> å®šæ—¶ä»»åŠ¡ä¸ <code>/etc/sudoers.d</code> ç›®å½•çš„æœºåˆ¶å¯ä»¥å®Œç¾çš„è§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p><p>æˆ‘ä»¬é€šè¿‡å®šæ—¶ä»»åŠ¡çš„å®šæ—¶æ‰§è¡Œç›®å½•ï¼Œæ¥å®šæ—¶åˆ·æ‰ <code>/etc/sudoers.d/</code> ç›®å½•ä¸‹çš„ç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„çš„æˆæƒé…ç½®æ–‡ä»¶ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦å®šæ—¶æ¯æ—¥åˆ·æ‰ä»Šæ—¥ä¸´æ—¶æˆæƒçš„ç”¨æˆ·æˆ–è€…ç”¨æˆ·ï¼Œå¯ä»¥åœ¨ <code>/etc/cron.daily</code> ç›®å½•ä¸‹é¢åˆ›å»ºç”¨äºåˆ é™¤ <code>/etc/sudoers.d/</code> ç›®å½•çš„ <code>rm -rf</code> å‘½ä»¤ï¼Œä¹‹ååœ¨å›ºå®šçš„æ—¶é—´ä¼šè‡ªåŠ¨åˆ é™¤ã€‚å¯¹åº”æˆæƒç”¨æˆ·ï¼Œæˆ‘ä»¬ä½¿ç”¨åœ¨ <code>/etc/sudoers.d/</code> ç›®å½•ä¸‹åˆ›å»ºå•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹ <code>/etc/sudoers</code> æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Crontabæœ‰å¤šç§å®šæ—¶æœºåˆ¶</span></span><br><span class="line"><span class="comment"># ä¸‹è¿°åˆ†åˆ«è¡¨ç¤ºæ¯å¤©ã€æ¯æ—¶ã€æ¯æœˆã€æ¯å‘¨å®šæ—¶æ‰§è¡Œ</span></span><br><span class="line">$ ls -dl /etc/cron.* | grep -v cron.d$</span><br><span class="line">drwxr-xr-x 2 root root 4096 May 15 06:18 /etc/cron.daily</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 14  2019 /etc/cron.hourly</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 14  2019 /etc/cron.monthly</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jun 18 09:57 /etc/cron.weekly</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå•ç‹¬çš„æˆæƒé…ç½®æ–‡ä»¶</span></span><br><span class="line">$ ls -lh /etc/sudoers.d/</span><br><span class="line">-r--r----- 1 root root 666 Oct  6  2017 lisi</span><br><span class="line">-r--r----- 1 root root 958 Jan 18  2018 zhangsan</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æˆæƒé…ç½®æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">$ cat /etc/sudoers.d/zhangsan</span><br><span class="line">ALL ALL = (root) NOPASSWD: zhangsan</span><br></pre></td></tr></table></figure><ul><li><strong>[6] å¦‚ä½•è§£å†³ sudo å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡ï¼Ÿ</strong></li></ul><p>æˆ‘ä»¬æ—¥å¸¸åœ¨ä½¿ç”¨ <code>sudo</code> å‘½ä»¤çš„æ—¶å€™ï¼Œå¸¸å¸¸ä¼šé‡åˆ°ï¼Œå½“åˆ‡æ¢ç”¨æˆ·ä¹‹åï¼Œå‘ç°ä¹‹å‰è®¾ç½®çš„ç¯å¢ƒå˜é‡æ€ä¹ˆä¸è§äº†å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬æ‰§è¡Œ <code>sudo</code> å‘½ä»¤ä¹‹åä¼šåˆ‡æ¢ç”¨æˆ·ï¼Œå¦‚æœä¿ç•™ç¯å¢ƒå˜é‡ä¼šæœ‰ä¸€å®šçš„å®‰å…¨é—®é¢˜ï¼Œç³»ç»Ÿä¼šé»˜è®¤é‡ç½®ç¯å¢ƒå˜é‡ä¸ºå®‰å…¨çš„ç¯å¢ƒå˜é‡ã€‚å…ˆå‰è®¾ç½®çš„å˜é‡éƒ½ä¼šå¤±æ•ˆï¼Œåªæœ‰å°‘æ•°é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ç¯å¢ƒå˜é‡èƒ½å¤Ÿä¿å­˜ä¸‹æ¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ <code>sudo</code> é…ç½®æ–‡ä»¶ <code>/etc/sudoers</code> æ¥æ‰¾æ‰¾ä½œç”¨åŸå› ã€‚æˆ‘ä»¬æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å…¥(æœ‰å¯èƒ½å’Œæˆ‘è¿™é‡Œçš„ä¸ä¸€æ ·)ã€‚å…¶ä¸­ <code>env_reset</code> è¡¨ç¤ºé»˜è®¤ä¼šé‡ç½®ç¯å¢ƒå˜é‡ï¼Œå› æ­¤æˆ‘ä»¬è‡ªå®šä¹‰çš„å˜é‡ä¼šåœ¨ <code>sudo</code> å‘½ä»¤æ‰§è¡Œä¹‹åå¤±æ•ˆï¼Œä¹Ÿå°±ä¸ä¼šæ­£ç¡®è·å–å˜é‡å€¼äº†ã€‚è€Œ <code>env_keep</code> åˆ™è¡¨ç¤ºç”¨äºä¿ç•™éƒ¨åˆ†ç¯å¢ƒå˜é‡ä¸è¢«é‡ç½®ï¼Œéœ€è¦ä¿ç•™çš„å˜é‡å°±å†™å…¥åŒå¼•å·ä¹‹ä¸­ï¼Œå¯è‡ªè¡Œè¿½åŠ éœ€è¦ä¿ç•™çš„å˜é‡ã€‚æœ€åå°±æ˜¯ <code>secure_path</code> å˜é‡ï¼Œå…¶ä½œç”¨å°±æ˜¯åŒ…å«çš„è·¯å¾„å°†è¢«å½“åš <code>sudo</code> ç¯å¢ƒçš„ <code>PATH</code> å˜é‡æ¥ä½¿ç”¨ã€‚å¦‚æœåœ¨ <code>sudo</code> ç¯å¢ƒæ— æ³•æ‰¾åˆ°æŸäº›å‘½ä»¤ï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›å‘½ä»¤çš„è·¯å¾„åŠ å…¥è¯¥é…ç½®é¡¹ä¹‹ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sed <span class="string">'/^#/d;/^$/d'</span> /etc/sudoers</span><br><span class="line">Defaults    env_reset</span><br><span class="line">Defaults    env_keep =  <span class="string">"COLORS IDSPLAY HOSTNAME HISTSIZE LS_COLORS"</span></span><br><span class="line">Defaults    env_keep += <span class="string">"MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS"</span></span><br><span class="line">Defaults    secure_path=<span class="string">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“åŸå› ä¹‹åï¼Œå°±å¯ä»¥é’ˆå¯¹ä¸Šè¿°æƒ…å†µä½œå‡ºä¸ç”¨çš„å¤„ç†æ–¹å¼ï¼Œæ¥è§£å†³ <code>sudo</code> å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡çš„é—®é¢˜ã€‚</p><p>ç¬¬ä¸€ç§è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>-E</code> å‚æ•°ã€‚åŠ ä¸Š <code>-E</code> é€‰é¡¹åï¼Œç”¨æˆ·å¯ä»¥åœ¨ <code>sudo</code> æ‰§è¡Œæ—¶ä¿ç•™å½“å‰ç”¨æˆ·å·²å­˜åœ¨çš„ç¯å¢ƒå˜é‡ï¼Œä¸ä¼šè¢« <code>sudo</code> é‡ç½®ã€‚å¦å¤–ï¼Œå¦‚æœç”¨æˆ·å¯¹äºæŒ‡å®šçš„ç¯å¢ƒå˜é‡æ²¡æœ‰æƒé™ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å†…éƒ¨æµ‹è¯•æœºå™¨ä¸­ï¼Œå®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sudo -E</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯ä¿®æ”¹ <code>sudo</code> é…ç½®æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ <code>/etc/sudoers</code> æ–‡ä»¶çš„ <code>env_keep</code> å’Œ <code>secure_path</code> é…ç½®é¡¹ï¼Œæ¥æŒ‡å®š <code>sudo</code> ç¯å¢ƒä¸­éœ€è¦ä¿ç•™çš„ç¯å¢ƒå˜é‡å’Œè·¯å¾„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠé…ç½®æ–‡ä»¶çš„å˜é‡ <code>!env_reset</code> ç»™å»æ‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰é™åˆ¶äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/sudoers</span><br><span class="line">Defaults !env_reset</span><br></pre></td></tr></table></figure><h2><span id="3-å‚è€ƒé“¾æ¥åœ°å€">3. å‚è€ƒé“¾æ¥åœ°å€</span></h2><ul><li><a href="http://ghoulich.xninja.org/2017/05/09/how-to-find-env-variables-when-exec-sudo-commands/" target="_blank" rel="noopener">å¦‚ä½•è§£å†³ sudo å‘½ä»¤æ‰¾ä¸åˆ°ç¯å¢ƒå˜é‡çš„é—®é¢˜</a></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Escape çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y4r6d5fu%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/y4r6d5fuï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Sudo æˆæƒéœ€è°¨æ…ï¼Œå¦åˆ™äº²äººä¸¤è¡Œæ³ªï¼&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;sudo&lt;/code&gt; è¡¨ç¤º &lt;code&gt;â€œsuperuser doâ€&lt;/code&gt;ï¼Œå®ƒå…è®¸å·²éªŒè¯çš„ç”¨æˆ·ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½æ¥è¿è¡Œå‘½ä»¤ã€‚å…¶ä»–ç”¨æˆ·å¯ä»¥æ˜¯æ™®é€šç”¨æˆ·æˆ–è€…è¶…çº§ç”¨æˆ·ã€‚ç„¶è€Œï¼Œå¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬ç”¨å®ƒæ¥ææƒè¿è¡Œå‘½ä»¤ï¼Œä»¥æ›¿ä»£ç›´æ¥ä½¿ç”¨ &lt;code&gt;root&lt;/code&gt; ç”¨æˆ·çš„æ“ä½œã€‚&lt;code&gt;sudo&lt;/code&gt; å‘½ä»¤ä¸å®‰å…¨ç­–ç•¥é…åˆä½¿ç”¨ï¼Œå®‰å…¨ç­–ç•¥å¯ä»¥é€šè¿‡æ–‡ä»¶ &lt;code&gt;/etc/sudoers&lt;/code&gt; æ¥é…ç½®ã€‚å…¶å®‰å…¨ç­–ç•¥å…·æœ‰é«˜åº¦å¯æ‹“å±•æ€§ï¼Œæ”¯æŒæ’ä»¶æ‰©å±•ã€‚é»˜è®¤æƒ…å†µä¸‹ &lt;code&gt;/etc/sudoers&lt;/code&gt; æ˜¯ä¸èƒ½è¢«ä»»ä½•äººç›´æ¥ç¼–è¾‘çš„ï¼Œå› ä¸ºå®ƒçš„æƒé™æ˜¯ &lt;code&gt;440&lt;/code&gt;ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥å¯¹å…¶èµ‹äºˆå†™æƒé™åå†ç¼–è¾‘ï¼Œä½†æ¨èä½¿ç”¨ &lt;code&gt;visudo&lt;/code&gt; å‘½ä»¤ç¼–è¾‘è¯¥æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1-å·¥ä½œæ¨¡å¼ç†è§£&quot;&gt;1. å·¥ä½œæ¨¡å¼ç†è§£&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç®€è¿°å…¶ä½¿ç”¨å·¥ä½œæµç¨‹å’Œé…ç½®æ–‡ä»¶é…ç½®ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;[1] ç†è§£ sudo å‘½ä»¤çš„å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sudo&lt;/code&gt; ä¼šè¯»å–å’Œè§£æ &lt;code&gt;/etc/sudoers&lt;/code&gt; æ–‡ä»¶ï¼ŒæŸ¥æ‰¾è°ƒç”¨å‘½ä»¤çš„ç”¨æˆ·åŠå…¶æƒé™ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åæç¤ºè°ƒç”¨è¯¥å‘½ä»¤çš„ç”¨æˆ·è¾“å…¥å¯†ç ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ &lt;code&gt;NOPASSWD&lt;/code&gt; æ ‡å¿—æ¥è·³è¿‡å¯†ç éªŒè¯ã€‚&lt;/li&gt;
&lt;li&gt;ä¹‹åï¼Œ&lt;code&gt;sudo&lt;/code&gt; åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè°ƒç”¨ &lt;code&gt;setuid()&lt;/code&gt; æ¥åˆ‡æ¢åˆ°ç›®æ ‡ç”¨æˆ·ã€‚&lt;/li&gt;
&lt;li&gt;æœ€å¥½ï¼Œå®ƒä¼šåœ¨ä¸Šè¿°å­è¿›ç¨‹ä¸­æ‰§è¡Œå‚æ•°ç»™å®šçš„ &lt;code&gt;shell&lt;/code&gt; æˆ–å‘½ä»¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[2] ç†è§£ sudo å‘½ä»¤æˆæƒé…ç½®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;USER/GROUP HOST=(USER[:GROUP]) [NOPASSWD:] COMMANDS&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;USER/GROUP&lt;/code&gt;: è¡¨ç¤ºéœ€è¦è¢«æˆæƒçš„ç”¨æˆ·æˆ–è€…ç»„ï¼›å¦‚æœæ˜¯ç»„åˆ™éœ€è¦ä»¥ % å¼€å¤´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HOST&lt;/code&gt;: è¡¨ç¤ºå…è®¸ä»å“ªäº›ä¸»æœºç™»å½•çš„ç”¨æˆ·è¿è¡Œ sudo å‘½ä»¤ï¼›ALL è¡¨ç¤ºå…è®¸ä»ä»»ä½•ç»ˆç«¯ã€æœºå™¨è®¿é—®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;(USER[:GROUP])&lt;/code&gt;: è¡¨ç¤ºä½¿ç”¨ sudo å¯åˆ‡æ¢çš„ç”¨æˆ·æˆ–è€…ç»„ï¼Œç»„å¯ä»¥ä¸æŒ‡å®šï¼›ALL è¡¨ç¤ºå¯ä»¥åˆ‡æ¢åˆ°ç³»ç»Ÿçš„æ‰€æœ‰ç”¨æˆ·&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NOPASSWD&lt;/code&gt;: å¦‚æœæŒ‡å®šï¼Œåˆ™è¯¥ç”¨æˆ·æˆ–ç»„ä½¿ç”¨ sudo æ—¶ä¸å¿…è¾“å…¥å¯†ç &lt;/li&gt;
&lt;li&gt;&lt;code&gt;COMMANDS&lt;/code&gt;: è¡¨ç¤ºè¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼›ALL è¡¨ç¤ºå…è®¸æ‰§è¡Œæ‰€æœ‰å‘½ä»¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Sudo" scheme="https://www.hi-linux.com/tags/Sudo/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ éƒ¨ç½²ä¸€ä¸ªæœ€å°åŒ–çš„ Kubernetes é›†ç¾¤</title>
    <link href="https://www.hi-linux.com/posts/57272.html"/>
    <id>https://www.hi-linux.com/posts/57272.html</id>
    <published>2021-03-10T01:00:00.000Z</published>
    <updated>2021-03-10T01:18:29.908Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>è™½ç„¶ç½‘ä¸Šæœ‰å¤§é‡ä»é›¶æ­å»º <code>K8S</code> çš„æ–‡ç« ï¼Œä½†å¤§éƒ½é’ˆå¯¹è€ç‰ˆæœ¬ï¼Œè‹¥ç›´æ¥ç…§æ¬å»å®‰è£…æœ€æ–°çš„ <code>1.20</code> ç‰ˆæœ¬ä¼šé‡åˆ°ä¸€å †é—®é¢˜ã€‚æ•…æ­¤å°†æˆ‘çš„å®‰è£…æ­¥éª¤è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›èƒ½ä¸ºè¯»è€…æä¾› <code>copy and paste</code> å¼çš„é›†ç¾¤æ­å»ºå¸®åŠ©ã€‚</p><h2><span id="1-éƒ¨ç½²å‡†å¤‡å·¥ä½œ">1. éƒ¨ç½²å‡†å¤‡å·¥ä½œ</span></h2><blockquote><p><strong>éƒ¨ç½²æœ€å°åŒ– K8S é›†ç¾¤ï¼šmaster + node1 + node2</strong></p></blockquote><p><code>Ubuntu</code> æ˜¯ä¸€æ¬¾åŸºäº <code>Debian Linux</code> çš„ä»¥æ¡Œé¢åº”ç”¨ä¸ºä¸»çš„æ“ä½œç³»ç»Ÿï¼Œå†…å®¹æ¶µç›–æ–‡å­—å¤„ç†ã€ç”µå­é‚®ä»¶ã€è½¯ä»¶å¼€å‘å·¥å…·å’Œ <code>Web</code> æœåŠ¡ç­‰ï¼Œå¯ä¾›ç”¨æˆ·å…è´¹ä¸‹è½½ã€ä½¿ç”¨å’Œåˆ†äº«ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">âœ vgs</span><br><span class="line">Current machine states:</span><br><span class="line">master                    running (virtualbox)</span><br><span class="line">node1                     running (virtualbox)</span><br><span class="line">node2                     running (virtualbox)</span><br></pre></td></tr></table></figure><h3><span id="11-åŸºç¡€ç¯å¢ƒä¿¡æ¯">1.1 åŸºç¡€ç¯å¢ƒä¿¡æ¯</span></h3><ul><li>è®¾ç½®ç³»ç»Ÿä¸»æœºåä»¥åŠ Host æ–‡ä»¶å„èŠ‚ç‚¹ä¹‹é—´çš„ç›¸äº’è§£æ<ul><li>ä½¿ç”¨è¿™ä¸ªçš„ <code>Vagrantfile</code> å¯åŠ¨çš„ä¸‰èŠ‚ç‚¹æœåŠ¡å·²ç»é…ç½®å¥½äº†</li><li>ä»¥ä¸‹ä½¿ç”¨ <code>master</code> èŠ‚ç‚¹è¿›è¡Œæ¼”ç¤ºæŸ¥çœ‹ï¼Œå…¶ä»–èŠ‚ç‚¹æ“ä½œå‡ä¸€è‡´</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hostnamectl</span></span><br><span class="line">vagrant@k8s-master:~$ hostnamectl</span><br><span class="line">   Static hostname: k8s-master</span><br><span class="line"></span><br><span class="line"><span class="comment"># hosts</span></span><br><span class="line">vagrant@k8s-master:~$ cat /etc/hosts</span><br><span class="line">127.0.0.1        localhost</span><br><span class="line">127.0.1.1        vagrant.vm    vagrant</span><br><span class="line">192.168.30.30    k8s-master</span><br><span class="line">192.168.30.31    k8s-node1</span><br><span class="line">192.168.30.32    k8s-node2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ping</span></span><br><span class="line">vagrant@k8s-master:~$ ping k8s-node1</span><br><span class="line">PING k8s-node1 (192.168.30.31) 56(84) bytes of data.</span><br><span class="line">64 bytes from k8s-node1 (192.168.30.31): icmp_seq=1 ttl=64 time=0.689 ms</span><br></pre></td></tr></table></figure><a id="more"></a><h3><span id="12-é˜¿é‡Œæºé…ç½®">1.2 é˜¿é‡Œæºé…ç½®</span></h3><ul><li>é…ç½® Ubuntu çš„é˜¿é‡Œæºæ¥åŠ é€Ÿå®‰è£…é€Ÿåº¦<ul><li><a href="https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.3e221b11ZqDVYZ" target="_blank" rel="noopener">é˜¿é‡Œæºé•œåƒåœ°å€</a></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½•æœåŠ¡å™¨</span></span><br><span class="line">âœ vgssh master/node1/nod2</span><br><span class="line">Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-50-generic x86_64)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é˜¿é‡Œäº‘Ubuntué•œåƒ</span></span><br><span class="line">$ sudo cp /etc/apt/sources.list&#123;,.bak&#125;</span><br><span class="line">$ sudo vim /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®kubeadmçš„é˜¿é‡Œäº‘é•œåƒæº</span></span><br><span class="line">$ sudo vim /etc/apt/sources.list</span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main</span><br><span class="line">$ sudo gpg --keyserver keyserver.ubuntu.com --recv-keys BA07F4FB</span><br><span class="line">$ sudo gpg --<span class="built_in">export</span> --armor BA07F4FB | sudo apt-key add -</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®dockerå®‰è£…</span></span><br><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">$ sudo apt-key fingerprint 0EBFCD88</span><br><span class="line">$ sudo vim /etc/apt/sources.list</span><br><span class="line">deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°ä»“åº“</span></span><br><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt dist-upgrade</span><br></pre></td></tr></table></figure><h3><span id="13-åŸºç¡€å·¥å…·å®‰è£…">1.3 åŸºç¡€å·¥å…·å®‰è£…</span></h3><ul><li>éƒ¨ç½²é˜¶æ®µçš„åŸºç¡€å·¥å…·å®‰è£…<ul><li>åŸºç¡€ç»„ä»¶ <code>docker</code></li><li>éƒ¨ç½²å·¥å…· <code>kubeadm</code></li><li>è·¯ç”±è§„åˆ™ <code>ipvsadm</code></li><li>æ—¶é—´åŒæ­¥ <code>ntp</code></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€å·¥å…·å®‰è£…</span></span><br><span class="line">$ sudo apt install -y \</span><br><span class="line">    docker-ce docker-ce-cli containerd.io \</span><br><span class="line">    kubeadm ipvsadm \</span><br><span class="line">    ntp ntpdate \</span><br><span class="line">    nginx supervisor</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½“å‰æ™®é€šç”¨æˆ·åŠ å…¥dockerç»„(éœ€é‡æ–°ç™»å½•)</span></span><br><span class="line">$ sudo usermod -a -G docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡å¯ç”¨</span></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker.service</span><br><span class="line">$ sudo systemctl start docker.service</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> kubelet.service</span><br><span class="line">$ sudo systemctl start kubelet.service</span><br></pre></td></tr></table></figure><h3><span id="14-æ“ä½œç³»ç»Ÿé…ç½®">1.4 æ“ä½œç³»ç»Ÿé…ç½®</span></h3><ul><li>æ“ä½œç³»ç»Ÿç›¸å…³é…ç½®<ul><li>å…³é—­ç¼“å­˜</li><li>é…ç½®å†…æ ¸å‚æ•°</li><li>è°ƒæ•´ç³»ç»Ÿæ—¶åŒº</li><li>å‡çº§å†…æ ¸ç‰ˆæœ¬(é»˜è®¤ä¸º<code>4.15.0</code>çš„ç‰ˆæœ¬)</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ç¼“å­˜</span></span><br><span class="line">$ sudo swapoff -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºK8Sæ¥è°ƒæ•´å†…æ ¸å‚æ•°</span></span><br><span class="line">$ sudo touch /etc/sysctl.d/kubernetes.conf</span><br><span class="line">$ sudo cat &gt; /etc/sysctl.d/kubernetes.conf &lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1 <span class="comment"># å¼€å¯ç½‘æ¡¥æ¨¡å¼(å¿…é¡»)</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1 <span class="comment"># å¼€å¯ç½‘æ¡¥æ¨¡å¼(å¿…é¡»)</span></span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1 <span class="comment"># å…³é—­IPv6åè®®(å¿…é¡»)</span></span><br><span class="line">net.ipv4.ip_forward = 1 <span class="comment"># è½¬å‘æ¨¡å¼(é»˜è®¤å¼€å¯)</span></span><br><span class="line">vm.panic_on_oom=0 <span class="comment"># å¼€å¯OOM(é»˜è®¤å¼€å¯)</span></span><br><span class="line">vm.swappiness = 0 <span class="comment"># ç¦æ­¢ä½¿ç”¨swapç©ºé—´</span></span><br><span class="line">vm.overcommit_memory=1 <span class="comment"># ä¸æ£€æŸ¥ç‰©ç†å†…å­˜æ˜¯å¦å¤Ÿç”¨</span></span><br><span class="line">fs.inotify.max_user_instances=8192</span><br><span class="line">fs.inotify.max_user_watches=1048576</span><br><span class="line">fs.file-max = 52706963 <span class="comment"># è®¾ç½®æ–‡ä»¶å¥æŸ„æ•°é‡</span></span><br><span class="line">fs.nr_open = 52706963 <span class="comment"># è®¾ç½®æ–‡ä»¶çš„æœ€å¤§æ‰“å¼€æ•°é‡</span></span><br><span class="line">net.netfilter.nf_conntrack_max = 2310720</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸å‚æ•°çš„æ–¹å¼</span></span><br><span class="line">$ sudo sysctl -a | grep xxx</span><br><span class="line"><span class="comment"># ä½¿å†…æ ¸å‚æ•°é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span></span><br><span class="line">$ sudo sysctl -p /etc/sysctl.d/kubernetes.conf</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½/ä¸Šæµ·</span></span><br><span class="line">$ sudo timedatectl <span class="built_in">set</span>-timezone Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½“å‰çš„UTCæ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é’Ÿ</span></span><br><span class="line">$ sudo timedatectl <span class="built_in">set</span>-local-rtc 0</span><br></pre></td></tr></table></figure><h3><span id="15-å¼€å¯-ipvs-æœåŠ¡">1.5 å¼€å¯ ipvs æœåŠ¡</span></h3><ul><li>å¼€å¯ ipvs æœåŠ¡<ul><li><code>kube-proxy</code> å¼€å¯ <code>ipvs</code> çš„å‰ç½®æ¡ä»¶</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è½½å…¥æŒ‡å®šçš„ä¸ªåˆ«æ¨¡å—</span></span><br><span class="line">$ modprobe br_netfilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®</span></span><br><span class="line">$ cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½é…ç½®</span></span><br><span class="line">$ chmod 755 /etc/sysconfig/modules/ipvs.modules \</span><br><span class="line">    &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules \</span><br><span class="line">    &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv</span><br></pre></td></tr></table></figure><h2><span id="2-éƒ¨ç½²-master-èŠ‚ç‚¹">2. éƒ¨ç½² Master èŠ‚ç‚¹</span></h2><blockquote><p><strong>èŠ‚ç‚¹æœ€ä½é…ç½®: <code>2C+2G</code> å†…å­˜ï¼›ä»èŠ‚ç‚¹èµ„æºå°½é‡å……è¶³</strong></p></blockquote><p><code>kubeadm</code> å·¥å…·çš„ <code>init</code> å‘½ä»¤ï¼Œå³å¯åˆå§‹åŒ–ä»¥å•èŠ‚ç‚¹éƒ¨ç½²çš„ <code>master</code>ã€‚ä¸ºäº†é¿å…ç¿»å¢™ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„è°·æ­Œæºæ¥ä»£æ›¿ã€‚åœ¨æ‰§è¡Œ <code>kubeadm</code> éƒ¨ç½²å‘½ä»¤çš„æ—¶å€™ï¼ŒæŒ‡å®šå¯¹åº”åœ°å€å³å¯ã€‚å½“ç„¶ï¼Œå¯ä»¥å°†å…¶åŠ å…¥æœ¬åœ°çš„é•œåƒåº“ä¹‹ä¸­ï¼Œæ›´æ˜“ç»´æŠ¤ã€‚</p><ul><li>æ³¨æ„äº‹é¡¹<ul><li><a href="https://www.escapelife.site/posts/registry.aliyuncs.com/google_containers" target="_blank" rel="noopener">é˜¿é‡Œäº‘è°·æ­Œæºåœ°å€</a></li><li><a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/control-plane-flags/" target="_blank" rel="noopener">ä½¿ç”¨ kubeadm å®šåˆ¶æ§åˆ¶å¹³é¢é…ç½®</a></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½•æœåŠ¡å™¨</span></span><br><span class="line">âœ vgssh master</span><br><span class="line">Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-50-generic x86_64)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²èŠ‚ç‚¹(å‘½ä»¤è¡Œ)</span></span><br><span class="line"><span class="comment"># æ³¨æ„podå’Œserviceçš„åœ°å€éœ€è¦ä¸åŒ(å¦åˆ™ä¼šæŠ¥é”™)</span></span><br><span class="line">$ sudo kubeadm init \</span><br><span class="line">    --kubernetes-version=1.20.2 \</span><br><span class="line">    --image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">    --apiserver-advertise-address=192.168.30.30 \</span><br><span class="line">    --pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">    --service-cidr=10.245.0.0/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²é•œåƒé…ç½®(é…ç½®æ–‡ä»¶)</span></span><br><span class="line">$ sudo kubeadm init --config ./kubeadm-config.yaml</span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹IPæ®µæ˜¯å¦ç”Ÿæ•ˆ(iptable)</span></span><br><span class="line">$ ip route show</span><br><span class="line">10.244.0.0/24 dev cni0 proto kernel scope link src 10.244.0.1</span><br><span class="line">10.244.1.0/24 via 10.244.1.0 dev flannel.1 onlink</span><br><span class="line">10.244.2.0/24 via 10.244.2.0 dev flannel.1 onlink</span><br><span class="line"></span><br><span class="line"><span class="comment"># # æŸ¥çœ‹IPæ®µæ˜¯å¦ç”Ÿæ•ˆ(ipvs)</span></span><br><span class="line">$ ipvsadm -L -n</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br></pre></td></tr></table></figure><ul><li>é…ç½®æ–‡ä»¶å®šä¹‰<ul><li>æ¥å£ä½¿ç”¨äº† <code>v1beta2</code> ç‰ˆæœ¬</li><li>é…ç½®ä¸»èŠ‚ç‚¹ <code>IP</code> åœ°å€ä¸º <code>192.168.30.30</code></li><li>ä¸º <code>flannel</code> åˆ†é…çš„æ˜¯ <code>10.244.0.0/16</code> ç½‘æ®µ</li><li>é€‰æ‹©çš„ <code>kubernetes</code> æ˜¯å½“å‰æœ€æ–°çš„ <code>1.20.2</code> ç‰ˆæœ¬</li><li>åŠ å…¥äº† <code>controllerManager</code> çš„æ°´å¹³æ‰©å®¹åŠŸèƒ½</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubeadm-config.yaml</span></span><br><span class="line"><span class="comment"># sudo kubeadm config print init-defaults &gt; kubeadm-config.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta2</span></span><br><span class="line"><span class="attr">imageRepository:</span> <span class="string">registry.aliyuncs.com/google_containers</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterConfiguration</span></span><br><span class="line"><span class="attr">kubernetesVersion:</span> <span class="string">v1.20.2</span></span><br><span class="line"><span class="attr">apiServer:</span></span><br><span class="line">  <span class="attr">extraArgs:</span></span><br><span class="line">    <span class="attr">advertise-address:</span> <span class="number">192.168</span><span class="number">.30</span><span class="number">.30</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="attr">podSubnet:</span> <span class="number">10.244</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line"><span class="attr">controllerManager:</span></span><br><span class="line">  <span class="attr">ExtraArgs:</span></span><br><span class="line">    <span class="attr">horizontal-pod-autoscaler-use-rest-clients:</span> <span class="string">"true"</span></span><br><span class="line">    <span class="attr">horizontal-pod-autoscaler-sync-period:</span> <span class="string">"10s"</span></span><br><span class="line">    <span class="attr">node-monitor-grace-period:</span> <span class="string">"10s"</span></span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡ŒæˆåŠŸä¹‹åä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼Œéœ€è¦å®‰è£…å¦‚ä¸‹æ­¥éª¤æ“ä½œä¸‹<ul><li><strong>ç¬¬ä¸€æ­¥</strong> åœ¨ <code>kubectl</code> é»˜è®¤æ§åˆ¶å’Œæ“ä½œé›†ç¾¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨åˆ° <code>CA</code> çš„å¯†é’¥ï¼Œä¼ è¾“è¿‡ç¨‹æ˜¯é€šè¿‡ <code>TLS</code> åè®®ä¿éšœé€šè®¯çš„å®‰å…¨æ€§ã€‚é€šè¿‡ä¸‹é¢ <code>3</code> è¡Œå‘½ä»¤æ‹·è´å¯†é’¥ä¿¡æ¯åˆ°å½“å‰ç”¨æˆ·å®¶ç›®å½•ä¸‹ï¼Œè¿™æ · <code>kubectl</code> æ‰§è¡Œæ—¶ä¼šé¦–å…ˆè®¿é—® <code>.kube</code> ç›®å½•ï¼Œä½¿ç”¨è¿™äº›æˆæƒä¿¡æ¯è®¿é—®é›†ç¾¤ã€‚</li><li><strong>ç¬¬äºŒæ­¥</strong> ä¹‹åæ·»åŠ  <code>worker</code> èŠ‚ç‚¹æ—¶ï¼Œè¦é€šè¿‡ <code>token</code> æ‰èƒ½ä¿éšœå®‰å…¨æ€§ã€‚å› æ­¤ï¼Œå…ˆæŠŠæ˜¾ç¤ºçš„è¿™è¡Œå‘½ä»¤ä¿å­˜ä¸‹æ¥ï¼Œä»¥å¤‡åç»­ä½¿ç”¨ä¼šç”¨åˆ°ã€‚</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># master setting step one</span></span><br><span class="line">To start cluster, you need to run the following as a regular user:</span><br><span class="line">  mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, <span class="keyword">if</span> you are the root user, you can run:</span><br><span class="line">  <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># master setting step two</span></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Join any number of worker nodes by running the following on each as root:</span><br><span class="line">kubeadm join 192.168.30.30:6443 \</span><br><span class="line">  --token lebbdi.p9lzoy2a16tmr6hq \</span><br><span class="line">  --discovery-token-ca-cert-hash \</span><br><span class="line">  sha256:6c79fd83825d7b2b0c3bed9e10c428acf8ffcd615a1d7b258e9b500848c20cae</span><br></pre></td></tr></table></figure><ul><li><strong>å°†å­èŠ‚ç‚¹åŠ å…¥ä¸»èŠ‚ç‚¹ä¸­</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes</span><br><span class="line">NAME         STATUS     ROLES                  AGE   VERSION</span><br><span class="line">k8s-master   NotReady   control-plane,master   62m   v1.20.2</span><br><span class="line">k8s-node1    NotReady   &lt;none&gt;                 82m   v1.20.2</span><br><span class="line">k8s-node2    NotReady   &lt;none&gt;                 82m   v1.20.2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹tokenä»¤ç‰Œ</span></span><br><span class="line">$ sudo kubeadm token list</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆtokenä»¤ç‰Œ</span></span><br><span class="line">$ sudo kubeadm token create</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿˜è®°shaç¼–ç </span></span><br><span class="line">$ openssl x509 -pubkey -<span class="keyword">in</span> /etc/kubernetes/pki/ca.crt \</span><br><span class="line">    | openssl rsa -pubin -outform der 2&gt;/dev/null \</span><br><span class="line">    | openssl dgst -sha256 -hex | sed <span class="string">'s/^.* //'</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªæ–°çš„ token ä»¤ç‰Œ(æ¯”ä¸Šé¢çš„æ–¹ä¾¿)</span></span><br><span class="line">$ kubeadm token generate</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ç”Ÿæˆ join å‘½ä»¤(æ¯”ä¸Šé¢çš„æ–¹ä¾¿)</span></span><br><span class="line">$ kubeadm token create &lt;token_generate&gt; --<span class="built_in">print</span>-join-command --ttl=0</span><br></pre></td></tr></table></figure><ul><li><p>æ‰§è¡Œå®Œæˆä¹‹åå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ä¸»èŠ‚ç‚¹ä¿¡æ¯</p><ul><li><p>é»˜è®¤ç”Ÿæˆå››ä¸ªå‘½åç©ºé—´</p><ul><li><code>default</code>ã€<code>kube-system</code>ã€<code>kube-public</code>ã€<code>kube-node-lease</code></li></ul></li><li><p>éƒ¨ç½²çš„æ ¸å¿ƒæœåŠ¡æœ‰ä»¥ä¸‹å‡ ä¸ª (kube-system)</p><ul><li><code>coredns</code>ã€<code>etcd</code></li><li><code>kube-apiserver</code>ã€<code>kube-scheduler</code></li><li><code>kube-controller-manager</code>ã€<code>kube-controller-manager</code></li></ul></li><li><p>æ­¤æ—¶ <code>master</code> å¹¶æ²¡æœ‰ <code>ready</code> çŠ¶æ€(éœ€è¦å®‰è£…ç½‘ç»œæ’ä»¶)</p><ul><li>ä¸‹ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®‰è£… <code>flannel</code> è¿™ä¸ªç½‘ç»œæ’ä»¶</li></ul></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line">$ kubectl get namespace</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   19m</span><br><span class="line">kube-node-lease   Active   19m</span><br><span class="line">kube-public       Active   19m</span><br><span class="line">kube-system       Active   19m</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¸å¿ƒæœåŠ¡</span></span><br><span class="line">$ kubectl get pod -n kube-system</span><br><span class="line">NAME                                 READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-7f89b7bc75-bh42f             1/1     Running   0          19m</span><br><span class="line">coredns-7f89b7bc75-dvzpl             1/1     Running   0          19m</span><br><span class="line">etcd-k8s-master                      1/1     Running   0          19m</span><br><span class="line">kube-apiserver-k8s-master            1/1     Running   0          19m</span><br><span class="line">kube-controller-manager-k8s-master   1/1     Running   0          19m</span><br><span class="line">kube-proxy-5rlpv                     1/1     Running   0          19m</span><br><span class="line">kube-scheduler-k8s-master            1/1     Running   0          19m</span><br></pre></td></tr></table></figure><h2><span id="3-éƒ¨ç½²-flannel-ç½‘ç»œ">3. éƒ¨ç½² flannel ç½‘ç»œ</span></h2><blockquote><p><strong>ç½‘ç»œæœåŠ¡ç”¨äºç®¡ç† K8S é›†ç¾¤ä¸­çš„æœåŠ¡ç½‘ç»œ</strong></p></blockquote><p><code>flannel</code> ç½‘ç»œéœ€è¦æŒ‡å®š <code>IP</code> åœ°å€æ®µï¼Œå³ä¸Šä¸€æ­¥ä¸­é€šè¿‡ç¼–æ’æ–‡ä»¶è®¾ç½®çš„ <code>10.244.0.0/16</code>ã€‚å…¶å®å¯ä»¥é€šè¿‡ <code>flannel</code> å®˜æ–¹å’Œ <code>HELM</code> å·¥å…·ç›´æ¥éƒ¨ç½²æœåŠ¡ï¼Œä½†æ˜¯åŸåœ°å€æ˜¯éœ€è¦æ­æ¢¯å­çš„ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å°†å…¶å†…å®¹ä¿å­˜åœ¨å¦‚ä¸‹é…ç½®æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹å¯¹åº”é•œåƒåœ°å€ã€‚</p><ul><li><a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener">éƒ¨ç½² flannel æœåŠ¡çš„å®˜æ–¹ä¸‹è½½åœ°å€</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éƒ¨ç½²flannelæœåŠ¡</span></span><br><span class="line"><span class="comment"># 1.ä¿®æ”¹é•œåƒåœ°å€(å¦‚æœä¸‹è½½ä¸äº†çš„è¯)</span></span><br><span class="line"><span class="comment"># 2.ä¿®æ”¹Networkä¸º--pod-network-cidrçš„å‚æ•°IPæ®µ</span></span><br><span class="line">$ kubectl apply -f ./kube-flannel.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">$ kubectl logs kube-flannel-ds-6xxs5 --namespace=kube-system</span><br><span class="line">$ kubectl describe pod kube-flannel-ds-6xxs5 --namespace=kube-system</span><br></pre></td></tr></table></figure><p><img src="https://img.hi-linux.com/staticfile/install-mini-k8s-01-2021-01-27-KgK5d2.png" alt></p><ul><li>å¦‚æœä½¿ç”¨å½“ä¸­å­˜åœ¨é—®é¢˜çš„ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„é—®é¢˜æ‰‹å†Œ<ul><li>å› ä¸ºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯ <code>Vagrant</code> è™šæ‹Ÿå‡ºæ¥çš„æœºå™¨è¿›è¡Œ <code>K8S</code> çš„éƒ¨ç½²ï¼Œä½†æ˜¯åœ¨è¿è¡Œå¯¹åº” <code>yaml</code> é…ç½®çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ã€‚é€šè¿‡æŸ¥çœ‹æ—¥å¿—å‘ç°æ˜¯å› ä¸ºé»˜è®¤ç»‘å®šçš„æ˜¯è™šæ‹Ÿæœºä¸Šé¢çš„ <code>eth0</code> è¿™å—ç½‘å¡ï¼Œè€Œè¿™å—ç½‘å¡æ˜¯ <code>Vagrant</code> ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬åº”è¯¥ç»‘å®šçš„æ˜¯ <code>eth1</code> æ‰å¯¹ã€‚</li><li><code>Vagrant</code> é€šå¸¸ä¸ºæ‰€æœ‰ <code>VM</code> åˆ†é…ä¸¤ä¸ªæ¥å£ï¼Œç¬¬ä¸€ä¸ªä¸ºæ‰€æœ‰ä¸»æœºåˆ†é…çš„ <code>IP</code> åœ°å€ä¸º <code>10.0.2.15</code>ï¼Œç”¨äºè·å¾— <code>NAT</code> çš„å¤–éƒ¨æµé‡ã€‚è¿™æ ·ä¼šå¯¼è‡´ <code>flannel</code> éƒ¨ç½²å­˜åœ¨é—®é¢˜ã€‚é€šè¿‡å®˜æ–¹é—®é¢˜è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>--iface=eth1</code> è¿™ä¸ªå‚æ•°é€‰æ‹©ç¬¬äºŒä¸ªç½‘å¡ã€‚</li><li>å¯¹åº”çš„å‚æ•°ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒ <a href="https://stackoverflow.com/questions/47845739/configuring-flannel-to-use-a-non-default-interface-in-kubernetes" target="_blank" rel="noopener">flannel use â€“iface=eth1</a> ä¸­çš„å›ç­”è‡ªè¡Œæ·»åŠ ï¼Œè€Œè¿™é‡Œæˆ‘ç›´æ¥ä¿®æ”¹äº†å¯åŠ¨çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨å¯åŠ¨æœåŠ¡çš„æ—¶å€™é€šè¿‡ <code>args</code> ä¿®æ”¹äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kube-system</span><br><span class="line">NAME                                 READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-7f89b7bc75-bh42f             1/1     Running   0          61m</span><br><span class="line">coredns-7f89b7bc75-dvzpl             1/1     Running   0          61m</span><br><span class="line">etcd-k8s-master                      1/1     Running   0          62m</span><br><span class="line">kube-apiserver-k8s-master            1/1     Running   0          62m</span><br><span class="line">kube-controller-manager-k8s-master   1/1     Running   0          62m</span><br><span class="line">kube-flannel-ds-zl148                1/1     Running   0          44s</span><br><span class="line">kube-flannel-ds-ll523                1/1     Running   0          44s</span><br><span class="line">kube-flannel-ds-wpmhw                1/1     Running   0          44s</span><br><span class="line">kube-proxy-5rlpv                     1/1     Running   0          61m</span><br><span class="line">kube-scheduler-k8s-master            1/1     Running   0          62m</span><br></pre></td></tr></table></figure><ul><li><strong>é…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º</strong></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">policy/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PodSecurityPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">psp.flannel.unprivileged</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">seccomp.security.alpha.kubernetes.io/allowedProfileNames:</span> <span class="string">docker/default</span></span><br><span class="line">    <span class="attr">seccomp.security.alpha.kubernetes.io/defaultProfileName:</span> <span class="string">docker/default</span></span><br><span class="line">    <span class="attr">apparmor.security.beta.kubernetes.io/allowedProfileNames:</span> <span class="string">runtime/default</span></span><br><span class="line">    <span class="attr">apparmor.security.beta.kubernetes.io/defaultProfileName:</span> <span class="string">runtime/default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">configMap</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">secret</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">emptyDir</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hostPath</span></span><br><span class="line">  <span class="attr">allowedHostPaths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">pathPrefix:</span> <span class="string">"/etc/cni/net.d"</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">pathPrefix:</span> <span class="string">"/etc/kube-flannel"</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">pathPrefix:</span> <span class="string">"/run/flannel"</span></span><br><span class="line">  <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Users and groups</span></span><br><span class="line">  <span class="attr">runAsUser:</span></span><br><span class="line">    <span class="attr">rule:</span> <span class="string">RunAsAny</span></span><br><span class="line">  <span class="attr">supplementalGroups:</span></span><br><span class="line">    <span class="attr">rule:</span> <span class="string">RunAsAny</span></span><br><span class="line">  <span class="attr">fsGroup:</span></span><br><span class="line">    <span class="attr">rule:</span> <span class="string">RunAsAny</span></span><br><span class="line">  <span class="comment"># Privilege Escalation</span></span><br><span class="line">  <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">defaultAllowPrivilegeEscalation:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Capabilities</span></span><br><span class="line">  <span class="attr">allowedCapabilities:</span> <span class="string">["NET_ADMIN",</span> <span class="string">"NET_RAW"</span><span class="string">]</span></span><br><span class="line">  <span class="attr">defaultAddCapabilities:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">requiredDropCapabilities:</span> <span class="string">[]</span></span><br><span class="line">  <span class="comment"># Host namespaces</span></span><br><span class="line">  <span class="attr">hostPID:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">hostIPC:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hostPorts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">min:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">max:</span> <span class="number">65535</span></span><br><span class="line">  <span class="comment"># SELinux</span></span><br><span class="line">  <span class="attr">seLinux:</span></span><br><span class="line">    <span class="comment"># SELinux is unused in CaaSP</span></span><br><span class="line">    <span class="attr">rule:</span> <span class="string">"RunAsAny"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> <span class="string">["extensions"]</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">["podsecuritypolicies"]</span></span><br><span class="line">    <span class="attr">verbs:</span> <span class="string">["use"]</span></span><br><span class="line">    <span class="attr">resourceNames:</span> <span class="string">["psp.flannel.unprivileged"]</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">cni-conf.json:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">&#123;</span></span><br><span class="line">      <span class="attr">"name":</span> <span class="string">"cbr0"</span><span class="string">,</span></span><br><span class="line">      <span class="attr">"cniVersion":</span> <span class="string">"0.3.1"</span><span class="string">,</span></span><br><span class="line">      <span class="attr">"plugins":</span> <span class="string">[</span></span><br><span class="line">        <span class="string">&#123;</span></span><br><span class="line">          <span class="attr">"type":</span> <span class="string">"flannel"</span><span class="string">,</span></span><br><span class="line">          <span class="attr">"delegate":</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="attr">"hairpinMode":</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line">            <span class="attr">"isDefaultGateway":</span> <span class="literal">true</span></span><br><span class="line">          <span class="string">&#125;</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line">        <span class="string">&#123;</span></span><br><span class="line">          <span class="attr">"type":</span> <span class="string">"portmap"</span><span class="string">,</span></span><br><span class="line">          <span class="attr">"capabilities":</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="attr">"portMappings":</span> <span class="literal">true</span></span><br><span class="line">          <span class="string">&#125;</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">]</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="attr">net-conf.json:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">&#123;</span></span><br><span class="line">      <span class="attr">"Network":</span> <span class="string">"10.244.0.0/16"</span><span class="string">,</span></span><br><span class="line">      <span class="attr">"Backend":</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">"Type":</span> <span class="string">"vxlan"</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel-ds</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/os</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-node-critical</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">          <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">quay.io/coreos/flannel:v0.13.1-rc1</span></span><br><span class="line">          <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">cp</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">-f</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kube-flannel</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">quay.io/coreos/flannel:v0.13.1-rc1</span></span><br><span class="line">          <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--ip-masq</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--kube-subnet-mgr</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--iface=eth1</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">"100m"</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">"50Mi"</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">"100m"</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">"50Mi"</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">capabilities:</span></span><br><span class="line">              <span class="attr">add:</span> <span class="string">["NET_ADMIN",</span> <span class="string">"NET_RAW"</span><span class="string">]</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">run</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/run/flannel</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">run</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/run/flannel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">kube-flannel-cfg</span></span><br></pre></td></tr></table></figure><ul><li>è‡³æ­¤é›†ç¾¤éƒ¨ç½²æˆåŠŸï¼å¦‚æœæœ‰å‚æ•°é”™è¯¯éœ€è¦ä¿®æ”¹ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ <code>reset</code> åé‡æ–° <code>init</code> é›†ç¾¤ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes</span><br><span class="line">NAME         STATUS   ROLES                  AGE   VERSION</span><br><span class="line">k8s-master   Ready    control-plane,master   62m   v1.20.2</span><br><span class="line">k8s-node1    Ready    control-plane,master   82m   v1.20.2</span><br><span class="line">k8s-node2    Ready    control-plane,master   82m   v1.20.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯é›†ç¾¤</span></span><br><span class="line">$ sudo kubeadm reset</span><br><span class="line">$ sudo kubeadm init</span><br></pre></td></tr></table></figure><h2><span id="4-éƒ¨ç½²-dashboard-æœåŠ¡">4. éƒ¨ç½² dashboard æœåŠ¡</span></h2><blockquote><p><strong>ä»¥ WEB é¡µé¢çš„å¯è§†åŒ– dashboard æ¥ç›‘æ§é›†ç¾¤çš„çŠ¶æ€</strong></p></blockquote><p>è¿™ä¸ªè¿˜æ˜¯ä¼šé‡åˆ°éœ€è¦æ­æ¢¯å­ä¸‹è½½å¯åŠ¨é…ç½®æ–‡ä»¶çš„é—®é¢˜ï¼Œä¸‹é¢æ˜¯å¯¹åº”çš„ä¸‹è½½åœ°å€ï¼Œå¯ä»¥ä¸‹è½½ä¹‹åä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šé¢åœ¨è¿›è¡Œéƒ¨ç½²ã€‚</p><ul><li><a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener">éƒ¨ç½² dashboard æœåŠ¡çš„å®˜æ–¹ä¸‹è½½åœ°å€</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éƒ¨ç½²flannelæœåŠ¡</span></span><br><span class="line">$ kubectl apply -f ./kube-dashboard.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">$ kubectl logs \</span><br><span class="line">    kubernetes-dashboard-c9fb67ffc-nknpj \</span><br><span class="line">    --namespace=kubernetes-dashboard</span><br><span class="line">$ kubectl describe pod \</span><br><span class="line">    kubernetes-dashboard-c9fb67ffc-nknpj \</span><br><span class="line">    --namespace=kubernetes-dashboard</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc -n kubernetes-dashboard</span><br><span class="line">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">dashboard-metrics-scraper   ClusterIP   10.245.214.11    &lt;none&gt;        8000/TCP   26s</span><br><span class="line">kubernetes-dashboard        ClusterIP   10.245.161.146   &lt;none&gt;        443/TCP    26s</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>dashboard</code> é»˜è®¤ä¸å…è®¸å¤–ç½‘è®¿é—®ï¼Œå³ä½¿é€šè¿‡ <code>kubectl proxy</code> å…è®¸å¤–ç½‘è®¿é—®ã€‚ä½† <code>dashboard</code> åˆåªå…è®¸ <code>HTTPS</code> è®¿é—®ï¼Œè¿™æ · <code>kubeadm init</code> æ—¶è‡ªç­¾åçš„ <code>CA</code> è¯ä¹¦æ˜¯ä¸è¢«æµè§ˆå™¨æ‰¿è®¤çš„ã€‚</p><p>æˆ‘é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ <code>Nginx</code> ä½œä¸ºåå‘ä»£ç†ï¼Œä½¿ç”¨ <code>Lets Encrypt</code> æä¾›çš„æœ‰æ•ˆè¯ä¹¦å¯¹å¤–æä¾›æœåŠ¡ï¼Œå†ç»ç”± <code>proxy_pass</code> æŒ‡ä»¤åå‘ä»£ç†åˆ° <code>kubectl proxy</code> ä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤æ—¶ï¼Œæœ¬åœ°å¯ç»ç”± <code>8888</code> è®¿é—®åˆ° <code>dashboard</code> æœåŠ¡ï¼Œå†é€šè¿‡ <code>Nginx</code> è®¿é—®å®ƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»£ç†(å¯ä»¥ä½¿ç”¨supervisor)</span></span><br><span class="line">$ kubectl proxy --accept-hosts=<span class="string">'^*$'</span></span><br><span class="line">$ kubectl proxy --port=8888 --accept-hosts=<span class="string">'^*$'</span></span><br><span class="line"><span class="comment"># æµ‹è¯•ä»£ç†æ˜¯å¦æ­£å¸¸(é»˜è®¤ç›‘å¬åœ¨8001ç«¯å£ä¸Š)</span></span><br><span class="line">$ curl -X GET -L http://localhost:8001</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°(å¯ä»¥ä½¿ç”¨nginx)</span></span><br><span class="line">proxy_pass http://localhost:8001;</span><br><span class="line">proxy_pass http://localhost:8888;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤–ç½‘è®¿é—®å¦‚ä¸‹URLåœ°å€</span></span><br><span class="line">https://mydomain/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/<span class="comment">#/login</span></span><br></pre></td></tr></table></figure><ul><li>é…ç½®æ–‡ä»¶æ•´ç†<ul><li><code>nginx</code></li><li><code>supervisor</code></li></ul></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k8s.conf</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">client_max_body_size</span>     <span class="number">80M</span>;</span><br><span class="line"><span class="attribute">client_body_buffer_size</span>  <span class="number">128k</span>;</span><br><span class="line"><span class="attribute">proxy_connect_timeout</span>    <span class="number">600</span>;</span><br><span class="line"><span class="attribute">proxy_read_timeout</span>       <span class="number">600</span>;</span><br><span class="line"><span class="attribute">proxy_send_timeout</span>       <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">8080</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span>  _;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span>     /etc/kubernetes/pki/ca.crt;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/kubernetes/pki/ca.key;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/k8s.access.log;</span><br><span class="line">    <span class="attribute">error_log</span>  /var/log/nginx/k8s.<span class="literal">error</span>.log  <span class="literal">error</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   Host              <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP         <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k8s.conf</span></span><br><span class="line"></span><br><span class="line">[program:k8s-master]</span><br><span class="line"><span class="built_in">command</span>=kubectl proxy --accept-hosts=<span class="string">'^*$'</span></span><br><span class="line">user=vagrant</span><br><span class="line">environment=KUBECONFIG=<span class="string">"/home/vagrant/.kube/config"</span></span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=unexpected</span><br><span class="line">stdout_logfile_maxbytes=1MB</span><br><span class="line">stdout_logfile_backups=10</span><br><span class="line">stderr_logfile_maxbytes=1MB</span><br><span class="line">stderr_logfile_backups=10</span><br><span class="line">stderr_logfile=/var/<span class="built_in">log</span>/supervisor/k8s-stderr.log</span><br><span class="line">stdout_logfile=/var/<span class="built_in">log</span>/supervisor/k8s-stdout.log</span><br></pre></td></tr></table></figure><ul><li><strong>é…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º</strong></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright 2017 The Kubernetes Authors.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the "License");</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8443</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard-certs</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard-csrf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">csrf:</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard-key-holder</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard-settings</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># Allow Dashboard to get, update and delete Dashboard exclusive secrets.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> <span class="string">[""]</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">["secrets"]</span></span><br><span class="line">    <span class="attr">resourceNames:</span></span><br><span class="line">      <span class="string">[</span></span><br><span class="line">        <span class="string">"kubernetes-dashboard-key-holder"</span><span class="string">,</span></span><br><span class="line">        <span class="string">"kubernetes-dashboard-certs"</span><span class="string">,</span></span><br><span class="line">        <span class="string">"kubernetes-dashboard-csrf"</span><span class="string">,</span></span><br><span class="line">      <span class="string">]</span></span><br><span class="line">    <span class="attr">verbs:</span> <span class="string">["get",</span> <span class="string">"update"</span><span class="string">,</span> <span class="string">"delete"</span><span class="string">]</span></span><br><span class="line">    <span class="comment"># Allow Dashboard to get and update 'kubernetes-dashboard-settings' config map.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> <span class="string">[""]</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">["configmaps"]</span></span><br><span class="line">    <span class="attr">resourceNames:</span> <span class="string">["kubernetes-dashboard-settings"]</span></span><br><span class="line">    <span class="attr">verbs:</span> <span class="string">["get",</span> <span class="string">"update"</span><span class="string">]</span></span><br><span class="line">    <span class="comment"># Allow Dashboard to get metrics.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> <span class="string">[""]</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">["services"]</span></span><br><span class="line">    <span class="attr">resourceNames:</span> <span class="string">["heapster",</span> <span class="string">"dashboard-metrics-scraper"</span><span class="string">]</span></span><br><span class="line">    <span class="attr">verbs:</span> <span class="string">["proxy"]</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> <span class="string">[""]</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">["services/proxy"]</span></span><br><span class="line">    <span class="attr">resourceNames:</span></span><br><span class="line">      <span class="string">[</span></span><br><span class="line">        <span class="string">"heapster"</span><span class="string">,</span></span><br><span class="line">        <span class="string">"http:heapster:"</span><span class="string">,</span></span><br><span class="line">        <span class="string">"https:heapster:"</span><span class="string">,</span></span><br><span class="line">        <span class="string">"dashboard-metrics-scraper"</span><span class="string">,</span></span><br><span class="line">        <span class="string">"http:dashboard-metrics-scraper"</span><span class="string">,</span></span><br><span class="line">      <span class="string">]</span></span><br><span class="line">    <span class="attr">verbs:</span> <span class="string">["get"]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># Allow Metrics Scraper to get metrics from the Metrics server</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> <span class="string">["metrics.k8s.io"]</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">["pods",</span> <span class="string">"nodes"</span><span class="string">]</span></span><br><span class="line">    <span class="attr">verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-shanghai.aliyuncs.com/jieee/dashboard:v2.0.4</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8443</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--auto-generate-certificates</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--namespace=kubernetes-dashboard</span></span><br><span class="line">            <span class="comment"># Uncomment the following line to manually specify Kubernetes API server Host</span></span><br><span class="line">            <span class="comment"># If not specified, Dashboard will attempt to auto discover the API server and connect</span></span><br><span class="line">            <span class="comment"># to it. Uncomment only if the default does not work.</span></span><br><span class="line">            <span class="comment"># - --apiserver-host=http://my-address:port</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubernetes-dashboard-certs</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/certs</span></span><br><span class="line">              <span class="comment"># Create on-disk volume to store exec logs</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">tmp-volume</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTPS</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8443</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">1001</span></span><br><span class="line">            <span class="attr">runAsGroup:</span> <span class="number">2001</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubernetes-dashboard-certs</span></span><br><span class="line">          <span class="attr">secret:</span></span><br><span class="line">            <span class="attr">secretName:</span> <span class="string">kubernetes-dashboard-certs</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-volume</span></span><br><span class="line">          <span class="attr">emptyDir:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">"kubernetes.io/os":</span> <span class="string">linux</span></span><br><span class="line">      <span class="comment"># Comment the following tolerations if Dashboard must not be deployed on master</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">          <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">dashboard-metrics-scraper</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dashboard-metrics-scraper</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8000</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">dashboard-metrics-scraper</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">dashboard-metrics-scraper</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dashboard-metrics-scraper</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">dashboard-metrics-scraper</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">dashboard-metrics-scraper</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">seccomp.security.alpha.kubernetes.io/pod:</span> <span class="string">"runtime/default"</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dashboard-metrics-scraper</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-shanghai.aliyuncs.com/jieee/metrics-scraper:v1.0.4</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8000</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">tmp-volume</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">1001</span></span><br><span class="line">            <span class="attr">runAsGroup:</span> <span class="number">2001</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">"kubernetes.io/os":</span> <span class="string">linux</span></span><br><span class="line">      <span class="comment"># Comment the following tolerations if Dashboard must not be deployed on master</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">          <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-volume</span></span><br><span class="line">          <span class="attr">emptyDir:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ç§ï¼šç™»å½• dashboard çš„æ–¹å¼(é…ç½®æ–‡ä»¶)<ul><li>é‡‡ç”¨ <code>token</code> æ–¹å¼</li><li>é‡‡ç”¨ç§˜é’¥æ–‡ä»¶æ–¹å¼</li></ul></li></ul><p><img src="https://img.hi-linux.com/staticfile/install-mini-k8s-02-2021-01-27-I5SV8j.jpg" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç®¡ç†å‘˜å¸æˆ·(dashboard)</span></span><br><span class="line">$ cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†ç”¨æˆ·ç»‘å®šå·²ç»å­˜åœ¨çš„é›†ç¾¤ç®¡ç†å‘˜è§’è‰²</span></span><br><span class="line">$ cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å¯ç”¨æˆ·äºè®¿é—®çš„tokenä»¤ç‰Œ</span></span><br><span class="line">$ kubectl -n kubernetes-dashboard describe secret \</span><br><span class="line">    $(kubectl -n kubernetes-dashboard get secret \</span><br><span class="line">    | grep admin-user | awk <span class="string">'&#123;print $1&#125;'</span>)</span><br></pre></td></tr></table></figure><ul><li>ç™»å½•ç•Œé¢å±•ç¤º<ul><li>é’ˆå¯¹ <code>Chrome</code> æµè§ˆå™¨ï¼Œåœ¨ç©ºç™½å¤„ç‚¹å‡»ç„¶åè¾“å…¥ï¼š<code>thisisunsafe</code></li><li>é’ˆå¯¹ <code>Firefox</code> æµè§ˆå™¨ï¼Œé‡åˆ°è¯ä¹¦è¿‡æœŸï¼Œæ·»åŠ ä¾‹å¤–è®¿é—®</li></ul></li></ul><p><img src="https://img.hi-linux.com/staticfile/install-mini-k8s-03-2021-01-27-Ic3CiP.jpg" alt></p><ul><li>ç¬¬äºŒç§ï¼šæˆæƒ dashboard æƒé™(ä¸é€‚ç”¨é…ç½®æ–‡ä»¶)<ul><li>å¦‚æœç™»å½•ä¹‹åæç¤ºæƒé™é—®é¢˜çš„è¯ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œ</li><li>æŠŠ <code>serviceaccount</code> ç»‘å®šåœ¨ <code>clusteradmin</code></li><li>æˆæƒ <code>serviceaccount</code> ç”¨æˆ·å…·æœ‰æ•´ä¸ªé›†ç¾¤çš„è®¿é—®ç®¡ç†æƒé™</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºserviceaccount</span></span><br><span class="line">$ kubectl create serviceaccount dashboard-admin -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠserviceaccountç»‘å®šåœ¨clusteradmin</span></span><br><span class="line"><span class="comment"># æˆæƒserviceaccountç”¨æˆ·å…·æœ‰æ•´ä¸ªé›†ç¾¤çš„è®¿é—®ç®¡ç†æƒé™</span></span><br><span class="line">$ kubectl create clusterrolebinding \</span><br><span class="line">    dashboard-cluster-admin --clusterrole=cluster-admin \</span><br><span class="line">    --serviceaccount=kube-system:dashboard-admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–serviceaccountçš„secretä¿¡æ¯ï¼Œå¯å¾—åˆ°tokenä»¤ç‰Œçš„ä¿¡æ¯</span></span><br><span class="line">$ kubectl get secret -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ä¸Šè¾¹å‘½ä»¤è·å–åˆ°dashboard-admin-token-slfcrä¿¡æ¯</span></span><br><span class="line">$ kubectl describe secret &lt;dashboard-admin-token-slfcr&gt; -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®ç™»å½•å¹¶æŠŠtokenç²˜è´´è¿›å»ç™»å½•å³å¯</span></span><br><span class="line">https://192.168.30.30:8080/</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿«æ·æŸ¥çœ‹tokençš„å‘½ä»¤</span></span><br><span class="line">$ kubectl describe secrets -n kube-system \</span><br><span class="line">    $(kubectl -n kube-system get secret | awk <span class="string">'/admin/&#123;print $1&#125;'</span>)</span><br></pre></td></tr></table></figure><h2><span id="5-å‚è€ƒé“¾æ¥">5. å‚è€ƒé“¾æ¥</span></h2><ul><li><a href="https://www.taohui.pub/2020/12/22/%E5%8D%81%E5%88%86%E9%92%9F%E6%90%AD%E5%BB%BA%E5%A5%BDk8s%E9%9B%86%E7%BE%A4/" target="_blank" rel="noopener">ååˆ†é’Ÿæ­å»ºå¥½ K8S é›†ç¾¤</a></li><li><a href="https://zhuanlan.zhihu.com/p/142945366" target="_blank" rel="noopener">åŸºäºé˜¿é‡Œäº‘ ubuntu çš„ k8s-1.8.2 ç¯å¢ƒæ­å»º</a></li><li><a href="https://zhang0peter.com/2020/01/30/k8s-install-and-use-and-fix-bug/" target="_blank" rel="noopener">ä»é›¶å¼€å§‹åœ¨ ubuntu ä¸Šå®‰è£…å’Œä½¿ç”¨ k8s é›†ç¾¤åŠæŠ¥é”™è§£å†³</a></li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Escape çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y5cp67a3%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://tinyurl.com/y5cp67a3ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è™½ç„¶ç½‘ä¸Šæœ‰å¤§é‡ä»é›¶æ­å»º &lt;code&gt;K8S&lt;/code&gt; çš„æ–‡ç« ï¼Œä½†å¤§éƒ½é’ˆå¯¹è€ç‰ˆæœ¬ï¼Œè‹¥ç›´æ¥ç…§æ¬å»å®‰è£…æœ€æ–°çš„ &lt;code&gt;1.20&lt;/code&gt; ç‰ˆæœ¬ä¼šé‡åˆ°ä¸€å †é—®é¢˜ã€‚æ•…æ­¤å°†æˆ‘çš„å®‰è£…æ­¥éª¤è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›èƒ½ä¸ºè¯»è€…æä¾› &lt;code&gt;copy and paste&lt;/code&gt; å¼çš„é›†ç¾¤æ­å»ºå¸®åŠ©ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1-éƒ¨ç½²å‡†å¤‡å·¥ä½œ&quot;&gt;1. éƒ¨ç½²å‡†å¤‡å·¥ä½œ&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½²æœ€å°åŒ– K8S é›†ç¾¤ï¼šmaster + node1 + node2&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;Ubuntu&lt;/code&gt; æ˜¯ä¸€æ¬¾åŸºäº &lt;code&gt;Debian Linux&lt;/code&gt; çš„ä»¥æ¡Œé¢åº”ç”¨ä¸ºä¸»çš„æ“ä½œç³»ç»Ÿï¼Œå†…å®¹æ¶µç›–æ–‡å­—å¤„ç†ã€ç”µå­é‚®ä»¶ã€è½¯ä»¶å¼€å‘å·¥å…·å’Œ &lt;code&gt;Web&lt;/code&gt; æœåŠ¡ç­‰ï¼Œå¯ä¾›ç”¨æˆ·å…è´¹ä¸‹è½½ã€ä½¿ç”¨å’Œåˆ†äº«ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;âœ vgs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Current machine states:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;master                    running (virtualbox)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node1                     running (virtualbox)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node2                     running (virtualbox)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;1-1-åŸºç¡€ç¯å¢ƒä¿¡æ¯&quot;&gt;1.1 åŸºç¡€ç¯å¢ƒä¿¡æ¯&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®ç³»ç»Ÿä¸»æœºåä»¥åŠ Host æ–‡ä»¶å„èŠ‚ç‚¹ä¹‹é—´çš„ç›¸äº’è§£æ
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨è¿™ä¸ªçš„ &lt;code&gt;Vagrantfile&lt;/code&gt; å¯åŠ¨çš„ä¸‰èŠ‚ç‚¹æœåŠ¡å·²ç»é…ç½®å¥½äº†&lt;/li&gt;
&lt;li&gt;ä»¥ä¸‹ä½¿ç”¨ &lt;code&gt;master&lt;/code&gt; èŠ‚ç‚¹è¿›è¡Œæ¼”ç¤ºæŸ¥çœ‹ï¼Œå…¶ä»–èŠ‚ç‚¹æ“ä½œå‡ä¸€è‡´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# hostnamectl&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vagrant@k8s-master:~$ hostnamectl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Static hostname: k8s-master&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# hosts&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vagrant@k8s-master:~$ cat /etc/hosts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127.0.0.1        localhost&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127.0.1.1        vagrant.vm    vagrant&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192.168.30.30    k8s-master&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192.168.30.31    k8s-node1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192.168.30.32    k8s-node2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ping&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vagrant@k8s-master:~$ ping k8s-node1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PING k8s-node1 (192.168.30.31) 56(84) bytes of data.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64 bytes from k8s-node1 (192.168.30.31): icmp_seq=1 ttl=64 time=0.689 ms&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/categories/kubernetes/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Kubernetes" scheme="https://www.hi-linux.com/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>å†è§ FTP/SFTPï¼Œæ˜¯æ—¶å€™æ‹¥æŠ±ä¸‹ä¸€ä»£æ–‡ä»¶ä¼ è¾“åˆ©å™¨ Croc äº†ï¼</title>
    <link href="https://www.hi-linux.com/posts/37218.html"/>
    <id>https://www.hi-linux.com/posts/37218.html</id>
    <published>2021-03-08T01:00:00.000Z</published>
    <updated>2021-03-08T01:30:13.616Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><p>ä¸¤å°ç”µè„‘ä¹‹é—´è¯¥å¦‚ä½•ä¼ é€æ¡£æ¡ˆï¼Œå…¶å®æ–¹æ³•æœ‰è¶…å¤šç§çš„ï¼Œåƒæ˜¯ FTP æˆ–é€è¿‡ SSH æ–¹å¼æ¥ä¼ é€æ¡£æ¡ˆï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•æ­¥éª¤éƒ½æœ‰ç‚¹å¤æ‚ï¼Œ<code>FTP</code> éœ€è¦æ­å»º <code>FTP</code> æœåŠ¡ï¼Œ<code>SSH</code> è¦å­¦ä¹  <code>SCP</code> æŒ‡ä»¤ï¼Œé‚£æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼ä»å•ä¸€ç”µè„‘ç‚¹å¯¹ç‚¹ä¼ é€æ¡£æ¡ˆåˆ°å¦ä¸€å°å‘¢ï¼Ÿ</p><p>ä¼ é€è¿‡ç¨‹éœ€è¦å¿«é€Ÿåˆè¦å®‰å…¨ï¼Œæœ¬æ–‡å°†ä»‹ç»ä¸€å¥—ç”¨ <a href="https://golang.org/" target="_blank" rel="noopener">Go è¯­è¨€</a>å†™çš„å·¥å…·å« <a href="https://github.com/schollz/croc" target="_blank" rel="noopener">Croc</a>ï¼Œè¯¦ç»†çš„ä»‹ç»å¯ä»¥å‚è€ƒçœ‹çœ‹ <a href="https://schollz.com/blog/croc6/" target="_blank" rel="noopener">ä½œè€…çš„ Blog ä»‹ç»</a>ï¼Œæ­¤å·¥å…·æœ‰ä»¥ä¸‹åŠŸèƒ½åŠä¼˜åŠ¿ã€‚</p><a id="more"></a><h2><span id="å·¥å…·ç‰¹ç‚¹åŠä¼˜åŠ¿">å·¥å…·ç‰¹ç‚¹åŠä¼˜åŠ¿</span></h2><ol><li>ç”¨ Relay æ–¹å¼è®©ä»»æ„ä¸¤å°ç”µè„‘ä¼ é€æ¡£æ¡ˆ</li><li>ç‚¹å¯¹ç‚¹åŠ å¯† (ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Password-authenticated_key_agreement" target="_blank" rel="noopener">PAKE</a>)</li><li>è·¨å¹³å°ä¼ é€æ–‡ä»¶ (<code>Windows</code>, <code>Linux</code>, <code>Mac</code>)</li><li>ä¸€æ¬¡å¯ä»¥ä¼ é€å¤šä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªç›®å½•</li><li>æ”¯æŒæ–­ç‚¹ç»­ä¼ </li><li>ä¸éœ€è¦è‡ªè¡Œæ­å»ºæœåŠ¡å™¨æˆ–ä½¿ç”¨ port-forwarding ç›¸å…³æŠ€æœ¯</li><li>ä¼˜å…ˆä½¿ç”¨<code> IPv6</code>ï¼Œè€Œ <code>IPv4</code> å½“ä½œå¤‡ç”¨</li><li>å¯ä»¥ä½¿ç”¨ <code>Socks5 proxy</code></li></ol><p>Croc é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/schollz/croc" target="_blank" rel="noopener">https://github.com/schollz/croc</a></p><h2><span id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼</span></h2><p>ä½¿ç”¨æ–¹å¼å¦‚åŒåº•ä¸‹è¿™å¼ å›¾æ‰€è¡¨ç¤º</p><p><img src="https://img.hi-linux.com/staticfile/VHlioiLpLfqBnh5PnGjYhU6l7dZ2V3PURxz5RfulFL74xYYr4kL5EgkOa-OfLQyIALLgmRIcKlLHnbIENFe0cyv82XQW5ia0HgeNwm4u2ijNsjSQQjkrY4JJjloB_pHTOT-EtxzxOlw=w1920-h1080-2021-02-22-lN7gPS.png" alt></p><p>ä¼ é€ç«¯åªéœ€è¦æ‰§è¡Œ <code>croc send file.txt</code> å³å¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ croc send ~/Downloads/data.csv</span><br><span class="line">Sending <span class="string">'data.csv'</span> (632.9 kB)</span><br><span class="line">Code is: cabinet-rodeo-mayday</span><br><span class="line">On the other computer run</span><br><span class="line"></span><br><span class="line">croc cabinet-rodeo-mayday</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å¯ä»¥çœ‹åˆ°ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ª <code>secret code</code>ï¼Œæ¥ç€åœ¨å¦å¤–ä¸€å°ç”µè„‘æ‰§è¡Œåº•ä¸‹æŒ‡ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ croc cabinet-rodeo-mayday</span><br><span class="line">Accept <span class="string">'data.csv'</span> (632.9 kB)? (y/n) y</span><br><span class="line"></span><br><span class="line">Receiving (&lt;-111.243.108.9:51032)</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªè®¢ <code>secret code</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">croc send --code appleboy ~/Downloads/data.csv</span><br></pre></td></tr></table></figure><p>ç”±äºæ­¤å·¥å…·æ˜¯é€šè¿‡ relay server æ–¹å¼æ¥è¿›è¡Œä¼ é€ï¼Œæ‰€ä»¥æŒ‡ä»¤ä¼šé¢„è®¾è¿åˆ°å®˜æ–¹æ‰€æ­å»ºçš„æœåŠ¡å™¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DEFAULT_RELAY is the default relay used (can be set using --relay)</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    DEFAULT_RELAY      = <span class="string">"croc.schollz.com"</span></span><br><span class="line">    DEFAULT_RELAY6     = <span class="string">"croc6.schollz.com"</span></span><br><span class="line">    DEFAULT_PORT       = <span class="string">"9009"</span></span><br><span class="line">    DEFAULT_PASSPHRASE = <span class="string">"pass123"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å‡è®¾ä½ æƒ³è¦è‡ªå·±éƒ¨ç½²ä¸€ä¸ª <code>Relay Server</code> å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œè¯¥å·¥å…·ä¹Ÿè®©ä½¿ç”¨è€…å¯ä»¥å¾ˆå¿«æ¶è®¾ä¸€å°è‡ªå·±çš„ <code>Relay Server</code>ï¼Œåªéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ croc relay</span><br><span class="line">[info]  2021/02/16 11:38:59 starting croc relay version v8.6.7-05640cd</span><br><span class="line">[info]  2021/02/16 11:38:59 starting TCP server on 9010</span><br><span class="line">[info]  2021/02/16 11:38:59 starting TCP server on 9012</span><br><span class="line">[info]  2021/02/16 11:38:59 starting TCP server on 9009</span><br><span class="line">[info]  2021/02/16 11:38:59 starting TCP server on 9013</span><br><span class="line">[info]  2021/02/16 11:38:59 starting TCP server on 9011</span><br></pre></td></tr></table></figure><p>å¯ä»¥æŒ‡å®šå•ä¸€ Port:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ croc relay --ports 3001</span><br><span class="line">[info]  2021/02/16 11:39:22 starting croc relay version v8.6.7-05640cd</span><br><span class="line">[info]  2021/02/16 11:39:22 starting TCP server on 3001</span><br></pre></td></tr></table></figure><p>æ¥ç€åœ¨ä¼ é€æ¡£æ¡ˆæ—¶ä¹Ÿè¦è·Ÿç€æ¢æ‰ <code>Relay Server</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ croc --relay 127.0.0.1:3001 send ~/Downloads/data.csv</span><br><span class="line">Sending <span class="string">'data.csv'</span> (632.9 kB)</span><br><span class="line">Code is: saddle-origin-horizon</span><br><span class="line">On the other computer run</span><br><span class="line"></span><br><span class="line">croc --relay 127.0.0.1:3001 saddle-origin-horizon</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åªéœ€è¦åŠ ä¸Š <code>--relay 127.0.0.1:3001</code> å°±å¯ä»¥å®Œæˆäº†ï¼Œæ‰€ä»¥éƒ¨ç½² <code>Relay Server</code> æ˜¯å¾ˆç®€å•çš„ï¼Œå³ä½¿å®˜æ–¹æœåŠ¡æŒ‚äº†ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä»»æ„ä¸€å°ç”µè„‘è£…ä¸Š <code>Relay Server</code> äº†ã€‚</p><h2><span id="å¿ƒå¾—">å¿ƒå¾—</span></h2><p><code>Croc</code> å·¥å…·å¼ºè°ƒçš„å°±æ˜¯: ç®€å• + å®‰å…¨ + å¿«é€Ÿï¼Œä¸‰å¤§ä¼˜åŠ¿ï¼Œè®©å¤§å®¶å¯ä»¥æ›´å®¹æ˜“ç‚¹å¯¹ç‚¹ä¼ é€æ–‡ä»¶ï¼ŒåŠ ä¸Š CLI å·¥å…·åœ¨ä»»ä½•å¹³å°éƒ½å¯ä»¥ä¸‹è½½ (<code>Windows</code>,<code> Mac</code>, åŠ <code>Linux</code>)ï¼Œåªéœ€è¦ä¸€ä¸ªæŒ‡ä»¤å°±å¯ä»¥è£…å¥½æ­¤å·¥å…·ï¼Œè·Ÿå…¶ä»–ç”¨æˆ·å¿«é€Ÿè¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ å°æ¶é­” ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A6tM8OkD" target="_blank" rel="noopener">http://t.cn/A6tM8OkD</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸¤å°ç”µè„‘ä¹‹é—´è¯¥å¦‚ä½•ä¼ é€æ¡£æ¡ˆï¼Œå…¶å®æ–¹æ³•æœ‰è¶…å¤šç§çš„ï¼Œåƒæ˜¯ FTP æˆ–é€è¿‡ SSH æ–¹å¼æ¥ä¼ é€æ¡£æ¡ˆï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•æ­¥éª¤éƒ½æœ‰ç‚¹å¤æ‚ï¼Œ&lt;code&gt;FTP&lt;/code&gt; éœ€è¦æ­å»º &lt;code&gt;FTP&lt;/code&gt; æœåŠ¡ï¼Œ&lt;code&gt;SSH&lt;/code&gt; è¦å­¦ä¹  &lt;code&gt;SCP&lt;/code&gt; æŒ‡ä»¤ï¼Œé‚£æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼ä»å•ä¸€ç”µè„‘ç‚¹å¯¹ç‚¹ä¼ é€æ¡£æ¡ˆåˆ°å¦ä¸€å°å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¼ é€è¿‡ç¨‹éœ€è¦å¿«é€Ÿåˆè¦å®‰å…¨ï¼Œæœ¬æ–‡å°†ä»‹ç»ä¸€å¥—ç”¨ &lt;a href=&quot;https://golang.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Go è¯­è¨€&lt;/a&gt;å†™çš„å·¥å…·å« &lt;a href=&quot;https://github.com/schollz/croc&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Croc&lt;/a&gt;ï¼Œè¯¦ç»†çš„ä»‹ç»å¯ä»¥å‚è€ƒçœ‹çœ‹ &lt;a href=&quot;https://schollz.com/blog/croc6/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä½œè€…çš„ Blog ä»‹ç»&lt;/a&gt;ï¼Œæ­¤å·¥å…·æœ‰ä»¥ä¸‹åŠŸèƒ½åŠä¼˜åŠ¿ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Croc" scheme="https://www.hi-linux.com/tags/Croc/"/>
    
  </entry>
  
  <entry>
    <title>æ¨èä¸€æ¬¾å…¨èƒ½çš„è·¨å¹³å°æ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…· Pandoc</title>
    <link href="https://www.hi-linux.com/posts/14914.html"/>
    <id>https://www.hi-linux.com/posts/14914.html</id>
    <published>2021-03-05T01:00:00.000Z</published>
    <updated>2021-03-05T08:14:36.868Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p><strong>å¦‚æœæ‚¨éœ€è¦å°†æ–‡ä»¶ä»ä¸€ç§æ ‡è®°æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ‡è®°æ ¼å¼ï¼Œé‚£ä¹ˆ<a href="https://pandoc.org/" target="_blank" rel="noopener"><code>pandoc</code></a>å°±æ˜¯æ‚¨çš„ç‘å£«å†›åˆ€ã€‚</strong></p></blockquote><p><strong>OpenSource: æ€»ç»“çš„å¿«æ·é”®ä½¿ç”¨æ–‡æ¡£</strong></p><p><img src="https://img.hi-linux.com/staticfile/pandoc-tools-3-20210128100807687-2021-01-28-oTubZV.png" alt="Pandocæ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…·"></p><h2><span id="1-æ ¼å¼è½¬æ¢">1. æ ¼å¼è½¬æ¢</span></h2><blockquote><p><strong>å…·ä½“çš„å„ç§æ ¼å¼ä¹‹é—´çš„è½¬æ¢ï¼Œè¯·çœ‹æ–‡æœ«çš„å›¾è°±</strong></p></blockquote><p><img src="https://img.hi-linux.com/staticfile/pandoc-tools-1-2021-01-28-2nt2NR.jpg" alt="Pandocæ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…·"></p><h2><span id="2-å®‰è£…æ–¹å¼">2. å®‰è£…æ–¹å¼</span></h2><blockquote><p><strong>å‡ ä¹æ”¯æŒå„ç§æ“ä½œç³»ç»Ÿå’Œå¹³å°ï¼Œä½¿ç”¨æ— å¿§</strong></p></blockquote><ul><li><strong>MacOS</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># brew</span></span><br><span class="line">brew install pandoc-citeproc</span><br><span class="line">brew install librsvg python homebrew/cask/basictex</span><br></pre></td></tr></table></figure><ul><li><strong>Linux</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt</span></span><br><span class="line">apt install pandoc</span><br><span class="line">apt install pandoc-citeproc</span><br><span class="line"></span><br><span class="line"><span class="comment"># download dpkg</span></span><br><span class="line">https://packages.ubuntu.com/pandoc</span><br></pre></td></tr></table></figure><ul><li><strong>Windows</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download exe</span></span><br><span class="line">https://github.com/jgm/pandoc/releases/latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># using chocolatey</span></span><br><span class="line">choco install pandoc</span><br><span class="line">choco install rsvg-convert python miktex</span><br></pre></td></tr></table></figure><a id="more"></a><h2><span id="3-ä½¿ç”¨æ–¹å¼">3. ä½¿ç”¨æ–¹å¼</span></h2><blockquote><p><strong>è½¬æ¢åŸæ¥ï¼Œå¦‚æ­¤ç®€å• =&gt; <a href="https://www.pandoc.org/demos.html" target="_blank" rel="noopener">å®˜ç½‘ä½¿ç”¨å‚è€ƒåœ°å€</a></strong></p></blockquote><ul><li><strong>xxx =&gt; docx</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># txt to docx</span></span><br><span class="line">$ pandoc -s MANUAL.txt -o example29.docx</span><br><span class="line"></span><br><span class="line"><span class="comment"># LaTeX math to docx</span></span><br><span class="line">$ pandoc -s math.tex -o example30.docx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Markdown to docx</span></span><br><span class="line">$ pandoc -s m.md -o m.docx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Docx with a reference docx:</span></span><br><span class="line">$ pandoc --reference-doc twocolumns.docx -o UsersGuide.docx MANUAL.txt</span><br></pre></td></tr></table></figure><ul><li><strong>md =&gt; xxx</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># markdownè½¬æ¢ä¸ºhtml</span></span><br><span class="line">$ pandoc README.md -o README.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># markdownè½¬æ¢ä¸ºword</span></span><br><span class="line">$ pandoc README.md -o README.docx</span><br><span class="line"></span><br><span class="line"><span class="comment"># markdownè½¬æ¢ä¸ºpdfï¼ˆlatexä¹‹å‰æ˜¯åŒçŸ­æ¨ªçº¿ï¼‰</span></span><br><span class="line">$ pandoc README.md -o README.pdf --latex-engine=xelatex</span><br></pre></td></tr></table></figure><ul><li><strong>others</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EPUB to plain text</span></span><br><span class="line">$ pandoc MANUAL.epub -t plain -o example36.text</span><br></pre></td></tr></table></figure><ul><li><strong>æ³¨æ„äº‹é¡¹</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡-Vå‚æ•°æŒ‡å®šä¸­æ–‡å­—ä½“</span></span><br><span class="line">-V mainfont=<span class="string">"SimSun"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³ä¸­æ–‡ä¹±ç </span></span><br><span class="line">$ pandoc -V mainfont=<span class="string">"SimSun"</span> --reference-doc twocolumns.docx -o UsersGuide.docx MANUAL.txt</span><br></pre></td></tr></table></figure><p><img src="https://img.hi-linux.com/staticfile/pandoc-tools-2-20210128100913963-2021-01-28-t6meEe.jpg" alt="Pandocæ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…·"></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Escape çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="http://t.cn/A65f0DtI%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">http://t.cn/A65f0DtIï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæ‚¨éœ€è¦å°†æ–‡ä»¶ä»ä¸€ç§æ ‡è®°æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ‡è®°æ ¼å¼ï¼Œé‚£ä¹ˆ&lt;a href=&quot;https://pandoc.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;pandoc&lt;/code&gt;&lt;/a&gt;å°±æ˜¯æ‚¨çš„ç‘å£«å†›åˆ€ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;OpenSource: æ€»ç»“çš„å¿«æ·é”®ä½¿ç”¨æ–‡æ¡£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img.hi-linux.com/staticfile/pandoc-tools-3-20210128100807687-2021-01-28-oTubZV.png&quot; alt=&quot;Pandocæ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…·&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-æ ¼å¼è½¬æ¢&quot;&gt;1. æ ¼å¼è½¬æ¢&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…·ä½“çš„å„ç§æ ¼å¼ä¹‹é—´çš„è½¬æ¢ï¼Œè¯·çœ‹æ–‡æœ«çš„å›¾è°±&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img.hi-linux.com/staticfile/pandoc-tools-1-2021-01-28-2nt2NR.jpg&quot; alt=&quot;Pandocæ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…·&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-å®‰è£…æ–¹å¼&quot;&gt;2. å®‰è£…æ–¹å¼&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å‡ ä¹æ”¯æŒå„ç§æ“ä½œç³»ç»Ÿå’Œå¹³å°ï¼Œä½¿ç”¨æ— å¿§&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MacOS&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# brew&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;brew install pandoc-citeproc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;brew install librsvg python homebrew/cask/basictex&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Linux&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# apt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;apt install pandoc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;apt install pandoc-citeproc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# download dpkg&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;https://packages.ubuntu.com/pandoc&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Windows&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# download exe&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;https://github.com/jgm/pandoc/releases/latest&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# using chocolatey&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;choco install pandoc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;choco install rsvg-convert python miktex&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/categories/Linux/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="Pandoc" scheme="https://www.hi-linux.com/tags/Pandoc/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ AutoSSH å·¥å…·å®ç°è‡ªåŠ¨åŒ–è·¨ç½‘ç»œè®¿é—®</title>
    <link href="https://www.hi-linux.com/posts/33293.html"/>
    <id>https://www.hi-linux.com/posts/33293.html</id>
    <published>2021-03-02T01:00:00.000Z</published>
    <updated>2021-03-02T03:07:04.750Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><blockquote><p><strong>AutoSSH æ˜¯ä¸€ç§ç”¨ä»¥å¯¹ SSH ç™»å½•è¿›è¡Œå®‰å…¨åœ°è‡ªåŠ¨åŒ–çš„è½¯ä»¶ã€‚ï¼</strong></p></blockquote><p>æ¯”å¦‚æˆ‘ä»¬åœ¨ <code>host2</code> æœºå™¨ä¸Šé¢éƒ¨ç½²äº†å¾ˆå¤šæœåŠ¡ï¼Œä½†æ˜¯ç”±äºæŸç§åŸå› å¯¼è‡´æˆ‘ä»¬æ— æ³•ç›´æ¥ <code>ssh</code> è®¿é—®è¯¥æœåŠ¡å™¨å·²ç»å…¶ä¸ŠæœåŠ¡çš„å¯¹åº”ç«¯å£ï¼Œä½†æ˜¯ <code>host3</code> æœåŠ¡å™¨ï¼Œæ—¢èƒ½å¤Ÿè®¿é—® <code>host2</code> æœåŠ¡å™¨ï¼Œåˆå¯ä»¥è®¿é—®æˆ‘ä»¬çš„ host1 æœåŠ¡å™¨ã€‚è¿™æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® <code>ssh</code> æ¥è¿›è¡ŒæœåŠ¡çš„è®¿é—®ã€‚ä½†æ˜¯è¿˜æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šä½ éœ€è¦ä¿æŒç»ˆç«¯å¼€å¯é˜²æ­¢ <code>SSH</code> è¿›ç¨‹è¢«å…³é—­ï¼›ç”±äºç½‘ç»œæ•…éšœ/æ³¢åŠ¨å¯¼è‡´ <code>SSH</code> ç»ˆæ–­æ—¶æ— æ³•è‡ªåŠ¨é‡è¿ã€‚</p><p>å‰è€…å¯ä»¥ä½¿ç”¨ <code>tmux</code> ç­‰ç¬¬ä¸‰æ–¹å·¥å…·æ¥è§£å†³ï¼Œåè€…éœ€è¦ <code>supervisor</code> ç­‰ç¬¬ä¸‰æ–¹ç›‘æ§å·¥å…·ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæ›´å¸¸ç”¨çš„é€‰æ‹©æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ä½¿ç”¨ <code>autossh</code> å·¥å…·ã€‚</p><ul><li><a href="http://www.freeoa.net/osuport/netmanage/autossh-useage-refer_2831.html" target="_blank" rel="noopener">autossh ä½¿ç”¨å‚è€ƒ</a></li><li><a href="https://www.escapelife.site/posts/e2e78d82.html" target="_blank" rel="noopener">SSH æœåŠ¡åŸç†å’Œä½¿ç”¨æŠ€å·§</a></li></ul><h2><span id="1-å·¥å…·ä»‹ç»">1. å·¥å…·ä»‹ç»</span></h2><blockquote><p><strong>è¯¥å·¥å…·çš„èµ·åˆçµæ„Ÿå’Œæœºåˆ¶æ¥è‡ªäº rstunnel!</strong></p></blockquote><p><code>autossh</code> å·¥å…·æ˜¯ä¸€ä¸ªç”¨æ¥å¯åŠ¨ <code>ssh</code> æœåŠ¡å¹¶è¿›è¡Œç›‘æ§çš„å‘½ä»¤è¡Œåº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨ç¨‹åºé—®é¢˜æˆ–è€…æ˜¯ç½‘ç»œé—®é¢˜çš„æ—¶å€™ï¼Œé‡å¯ <code>ssh</code> æœåŠ¡ã€‚</p><ul><li>åœ¨ <code>autossh 1.2</code> çš„æ—¶å€™ï¼Œå…¶æ–¹æ³•å·²ç»æ”¹å˜äº†ï¼š<code>autossh</code> ä½¿ç”¨ <code>ssh</code> æ¥æ„é€ ä¸€ä¸ª <code>ssh</code> é‡å®šå‘å¾ªç¯(æœ¬åœ°åˆ°è¿œç¨‹å’Œè¿œç¨‹åˆ°æœ¬åœ°)ï¼Œç„¶åå‘é€æµ‹è¯•æ•°æ®å¹¶è·å¾—è¿”å›ç»“æœã€‚</li><li>åœ¨ <code>autossh 1.3</code> å¢åŠ äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼šå¯æŒ‡å®šè¿œç¨‹ <code>echo</code> æœåŠ¡çš„ç«¯å£ç”¨äºè¿”å›æµ‹è¯•æ•°æ®å‘é€ç»“æœã€‚è¿™ä¸ªé¿å…æ¡æ‰‹é˜¶æ®µä»¥åŠæ‰€æœ‰è¿œç¨‹æœºå™¨ç«¯å£çš„å†²çªé—®é¢˜ï¼Œè€Œè€çš„ <code>loop-of-forwardings</code> æ–¹æ³•ä¾ç„¶å¯ç”¨ã€‚</li></ul><p>å†…ç½‘ä¸»æœºä¸»åŠ¨è¿æ¥åˆ°å¤–ç½‘ä¸»æœºï¼Œåˆè¢«ç§°ä½œ<strong>åå‘è¿æ¥</strong>(<code>Reverse Connection</code>)ï¼Œè¿™æ · <code>NAT</code> è·¯ç”±/é˜²ç«å¢™å°±ä¼šåœ¨å†…ç½‘ä¸»æœºå’Œå¤–ç½‘ä¸»æœºä¹‹é—´å»ºç«‹æ˜ å°„å³å¯ç›¸äº’é€šä¿¡äº†ã€‚ä½†è¿™ç§æ˜ å°„æ˜¯è·¯ç”±ç½‘å…³è‡ªåŠ¨ç»´æŒçš„ï¼Œä¸ä¼šæŒç»­ä¸‹å»ï¼Œå¦‚æœè¿æ¥æ–­å¼€æˆ–è€…ç½‘ç»œä¸ç¨³å®šéƒ½ä¼šå¯¼è‡´é€šä¿¡å¤±è´¥ï¼Œè¿™æ—¶å†…ç½‘ä¸»æœºéœ€è¦è‡ªåŠ¨é‡è¿æœºåˆ¶äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æ–¹å¼</span></span><br><span class="line">$ yum install autossh</span><br><span class="line">$ apt install autossh</span><br></pre></td></tr></table></figure><a id="more"></a><h2><span id="2-ä½¿ç”¨æ–¹å¼">2. ä½¿ç”¨æ–¹å¼</span></h2><blockquote><p><strong>autossh ä½¿ç”¨äº†ç³»ç»ŸåŸç”Ÿçš„ SSH ç«¯å£æ˜ å°„åŠŸèƒ½ï¼Œæ€§èƒ½å¼€é”€éå¸¸å°ã€‚</strong></p></blockquote><ul><li><strong>å‘½ä»¤ä½¿ç”¨æ–¹å¼</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># autossh usage</span></span><br><span class="line">autossh [-V] [-M port[:echo_port]] [-f] [SSH_OPTIONS]</span><br></pre></td></tr></table></figure><ul><li><strong>å‘½ä»¤ä½¿ç”¨å‚æ•°</strong></li></ul><table><thead><tr><th style="text-align:left">ç¼–å·</th><th style="text-align:left">å‚æ•°</th><th style="text-align:left">å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><code>-M</code></td><td style="text-align:left">ç”¨äºæœ‰é—®é¢˜æ—¶å°±ä¼šè‡ªåŠ¨é‡è¿ï¼›æœåŠ¡å™¨ echo æœºåˆ¶ä½¿ç”¨çš„ç«¯å£</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><code>-D</code></td><td style="text-align:left">æœ¬åœ°æœºå™¨åŠ¨æ€çš„åº”ç”¨ç¨‹åºç«¯å£è½¬å‘</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><code>-R</code></td><td style="text-align:left">å°†è¿œç¨‹ä¸»æœº(æœåŠ¡å™¨)çš„æŸä¸ªç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯æŒ‡å®šæœºå™¨çš„æŒ‡å®šç«¯å£</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><code>-L</code></td><td style="text-align:left">å°†æœ¬åœ°æœº(å®¢æˆ·æœº)çš„æŸä¸ªç«¯å£è½¬å‘åˆ°è¿œç«¯æŒ‡å®šæœºå™¨çš„æŒ‡å®šç«¯å£</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><code>-f</code></td><td style="text-align:left">åå°è¿è¡Œ</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><code>-T</code></td><td style="text-align:left">ä¸å ç”¨ shell</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><code>-n</code></td><td style="text-align:left">é…åˆ -f å‚æ•°ä½¿ç”¨</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><code>-N</code></td><td style="text-align:left">ä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><code>-q</code></td><td style="text-align:left">å®‰é™æ¨¡å¼è¿è¡Œï¼›å¿½ç•¥æç¤ºå’Œé”™è¯¯</td></tr></tbody></table><ul><li><strong>å‘½ä»¤ä½¿ç”¨æ¼”ç¤º</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬åœ°ç«¯å£ç»‘å®š(åœ¨host1æœåŠ¡å™¨ä¸Šé¢è¿è¡Œ)</span></span><br><span class="line"><span class="comment"># å°†æ‰€æœ‰å‘é€åˆ°æœ¬æœºçš„8527ç«¯å£çš„æ‰€æœ‰æ•°æ®è½¬å‘åˆ°è¿œç¨‹ä¸»æœºçš„8000ç«¯å£</span></span><br><span class="line">$ ssh -vv -N -D localhost:8527 root@host2 -p 8000</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»è¦æ˜¯ä¸ºäº†æ›´æ–°å®‰å…¨çš„è¿è¡ŒsshæœåŠ¡</span></span><br><span class="line">$ autossh -M 5678 -vv -N -D localhost:8527 root@host2 -p 8000</span><br></pre></td></tr></table></figure><h2><span id="3-ç¤ºä¾‹æ¼”ç¤º">3. ç¤ºä¾‹æ¼”ç¤º</span></h2><blockquote><p><strong>SSH ä»…æ”¯æŒ TCP ç«¯å£æ˜ å°„!</strong></p></blockquote><p>å¦‚æœéœ€è¦æ˜ å°„çš„ç«¯å£ä¸å¤šï¼Œåªæœ‰å‡ ä¸ªçš„è¯ï¼Œ<code>autossh</code> ç¡®å®æ˜¯æœ€ä½³é€‰æ‹©ã€‚ä½†æ˜¯å¦‚æœéœ€è¦æ˜ å°„å¤§é‡ç«¯å£ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨ç±»ä¼¼ <code>Ngrok</code> çš„ç«¯å£æ˜ å°„å·¥å…·ï¼Œæ¯•ç«Ÿè¿™ç±»å·¥å…·æ‹¥æœ‰æ¯”è¾ƒå®Œå–„çš„ç®¡ç†åŠŸèƒ½ã€‚</p><ul><li><strong>[1] æœ¬åœ°ç«¯å£ç»‘å®šå’Œè½¬å‘ (-L) =&gt; åœ¨ host1 ä¸Šé¢è®¾ç½®</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†åœ¨host1ä¸»æœºä¸Šå¼€å¯ä¸€ä¸ªæœ¬åœ°ä¾¦å¬çš„5900ç«¯å£</span></span><br><span class="line"><span class="comment"># è¿™æ ·ä¹‹åï¼Œè®¿é—®æœ¬åœ°5900ç«¯å£çš„æµé‡å°†è½¬å‘è‡³host2çš„8000ç«¯å£</span></span><br><span class="line"><span class="comment"># å…¶ä¸­-Må‚æ•°è´Ÿè´£é€šè¿‡5678ç«¯å£ç›‘è§†è¿æ¥çŠ¶æ€ï¼Œè¿æ¥æœ‰é—®é¢˜æ—¶å°±ä¼šè‡ªåŠ¨é‡è¿</span></span><br><span class="line">$ autossh -M 5678 -fCN -L 5900:localhost:8000 root@host3</span><br><span class="line">$ autossh -M 5678 -fCN -L 5900:root@host2:8000 root@host3</span><br></pre></td></tr></table></figure><p><img src="https://img.hi-linux.com/staticfile/ssh-authenticity-and-use-1-2021-01-25-YnJPBd.png" alt></p><ul><li><strong>[2] è¿œç¨‹ç«¯å£è½¬å‘åŠŸèƒ½ (-R) =&gt; åœ¨ host3 ä¸Šé¢è®¾ç½®</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†åœ¨host1ä¸»æœºä¸Šå¼€å¯ä¸€ä¸ªæœ¬åœ°ä¾¦å¬çš„5900ç«¯å£</span></span><br><span class="line"><span class="comment"># è¿™æ ·ä¹‹åï¼Œè®¿é—®æœ¬åœ°5900ç«¯å£çš„æµé‡å°†è½¬å‘è‡³host2çš„8080ç«¯å£</span></span><br><span class="line"><span class="comment"># å…¶ä¸­-Må‚æ•°è´Ÿè´£é€šè¿‡5678ç«¯å£ç›‘è§†è¿æ¥çŠ¶æ€ï¼Œè¿æ¥æœ‰é—®é¢˜æ—¶å°±ä¼šè‡ªåŠ¨é‡è¿</span></span><br><span class="line">$ autossh -M 5678 -fCN -R 5900:localhost:8000 root@host1</span><br><span class="line">$ autossh -M 5678 -fCN -R 5900:root@host2:8000 root@host1</span><br></pre></td></tr></table></figure><p><img src="https://img.hi-linux.com/staticfile/ssh-authenticity-and-use-2-2021-01-25-nuyTIh.png" alt></p><ul><li><strong>[3] åŠ¨æ€ç«¯å£è½¬å‘åŠŸèƒ½ (-D) =&gt; åœ¨ host1 ä¸Šé¢è®¾ç½®</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ¨æ€ç«¯å£è½¬å‘åŠŸèƒ½</span></span><br><span class="line">$ autossh -M 5678 -vv -D 1080 root@host2</span><br></pre></td></tr></table></figure><h2><span id="4-å¼€æœºè‡ªå¯åŠ¨">4. å¼€æœºè‡ªå¯åŠ¨</span></h2><blockquote><p><strong>ç³»ç»Ÿå¼€æœºï¼ŒæœåŠ¡è‡ªå¯åŠ¨ï¼</strong></p></blockquote><p>åœ¨ <code>Ubuntu</code> æˆ– <code>CentOS</code> ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>systemd</code> æ¥ç®¡ç† <code>autossh</code> çš„å¼€æœºå¯åŠ¨é—®é¢˜ã€‚é…ç½®å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªå¦‚ä¸‹æœåŠ¡å¯åŠ¨é…ç½®æ–‡ä»¶ï¼Œå³å¯ã€‚æ—§ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨ <code>init.d</code> æ¥ç®¡ç†æ–¹å¼ï¼Œåªéœ€è¦æ·»åŠ å¯¹åº”å‘½ä»¤åˆ° <code>rc.local</code> æ–‡ä»¶ï¼Œå³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶åœ°å€</span></span><br><span class="line"><span class="comment"># /etc/systemd/system/remote-autossh.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=AutoSSH service <span class="keyword">for</span> remote tunnel</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/usr/bin/autossh -M 5678 -fCNR 18081:host2:8080 root@host1</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS</span></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶åœ°å€</span></span><br><span class="line"><span class="comment"># /etc/rc.d/rc.local</span></span><br><span class="line">$ /usr/bin/autossh -M 5678 -fCNR 18081:host2:8080 root@host1</span><br></pre></td></tr></table></figure><h2><span id="5-ç¼–å†™å¯åœè„šæœ¬">5. ç¼–å†™å¯åœè„šæœ¬</span></h2><blockquote><p><strong>å¯ä»¥éšæ—¶éšåœ°çš„å¯åŠ¨ã€åœæ­¢æˆ‘ä»¬åˆ°æœåŠ¡ç«¯å£æ˜ å°„ï¼</strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">PASS=<span class="string">"escapelife"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">doexit</span></span>()&#123;</span><br><span class="line">    expect -c <span class="string">"</span></span><br><span class="line"><span class="string">    set timeout -1</span></span><br><span class="line"><span class="string">    spawn <span class="variable">$1</span> -t ps aux |grep escape |grep sshd |awk '&#123;print <span class="variable">$2</span>&#125;' |xargs kill -9</span></span><br><span class="line"><span class="string">    expect &#123;</span></span><br><span class="line"><span class="string">        \"*?assword:*\" &#123;</span></span><br><span class="line"><span class="string">            send \"<span class="variable">$PASS</span>\r\"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    expect eof</span></span><br><span class="line"><span class="string">    "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">dossh</span></span>()&#123;</span><br><span class="line">    nohup expect -c <span class="string">"</span></span><br><span class="line"><span class="string">    set timeout -1</span></span><br><span class="line"><span class="string">    spawn <span class="variable">$1</span></span></span><br><span class="line"><span class="string">    expect &#123;</span></span><br><span class="line"><span class="string">        \"*?assword:*\" &#123;</span></span><br><span class="line"><span class="string">            send \"<span class="variable">$PASS</span>\r\";</span></span><br><span class="line"><span class="string">            exp_continue</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    "</span> &amp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆå…³æ‰æ¯å°æœåŠ¡å™¨çš„sshdè¿æ¥</span></span><br><span class="line">doexit <span class="string">"ssh -o -p 6622 escape@aliyun"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨sshç«¯å£æ˜ å°„</span></span><br><span class="line">dossh <span class="string">"autossh -o -M 5678 -N -L 5900:127.0.0.1:8000 escape@aliyun -p 6622"</span></span><br></pre></td></tr></table></figure><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Escape çš„åšå®¢ ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/yxnrxgoa" target="_blank" rel="noopener">https://tinyurl.com/yxnrxgoa</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;AutoSSH æ˜¯ä¸€ç§ç”¨ä»¥å¯¹ SSH ç™»å½•è¿›è¡Œå®‰å…¨åœ°è‡ªåŠ¨åŒ–çš„è½¯ä»¶ã€‚ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬åœ¨ &lt;code&gt;host2&lt;/code&gt; æœºå™¨ä¸Šé¢éƒ¨ç½²äº†å¾ˆå¤šæœåŠ¡ï¼Œä½†æ˜¯ç”±äºæŸç§åŸå› å¯¼è‡´æˆ‘ä»¬æ— æ³•ç›´æ¥ &lt;code&gt;ssh&lt;/code&gt; è®¿é—®è¯¥æœåŠ¡å™¨å·²ç»å…¶ä¸ŠæœåŠ¡çš„å¯¹åº”ç«¯å£ï¼Œä½†æ˜¯ &lt;code&gt;host3&lt;/code&gt; æœåŠ¡å™¨ï¼Œæ—¢èƒ½å¤Ÿè®¿é—® &lt;code&gt;host2&lt;/code&gt; æœåŠ¡å™¨ï¼Œåˆå¯ä»¥è®¿é—®æˆ‘ä»¬çš„ host1 æœåŠ¡å™¨ã€‚è¿™æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® &lt;code&gt;ssh&lt;/code&gt; æ¥è¿›è¡ŒæœåŠ¡çš„è®¿é—®ã€‚ä½†æ˜¯è¿˜æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šä½ éœ€è¦ä¿æŒç»ˆç«¯å¼€å¯é˜²æ­¢ &lt;code&gt;SSH&lt;/code&gt; è¿›ç¨‹è¢«å…³é—­ï¼›ç”±äºç½‘ç»œæ•…éšœ/æ³¢åŠ¨å¯¼è‡´ &lt;code&gt;SSH&lt;/code&gt; ç»ˆæ–­æ—¶æ— æ³•è‡ªåŠ¨é‡è¿ã€‚&lt;/p&gt;
&lt;p&gt;å‰è€…å¯ä»¥ä½¿ç”¨ &lt;code&gt;tmux&lt;/code&gt; ç­‰ç¬¬ä¸‰æ–¹å·¥å…·æ¥è§£å†³ï¼Œåè€…éœ€è¦ &lt;code&gt;supervisor&lt;/code&gt; ç­‰ç¬¬ä¸‰æ–¹ç›‘æ§å·¥å…·ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæ›´å¸¸ç”¨çš„é€‰æ‹©æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ä½¿ç”¨ &lt;code&gt;autossh&lt;/code&gt; å·¥å…·ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.freeoa.net/osuport/netmanage/autossh-useage-refer_2831.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;autossh ä½¿ç”¨å‚è€ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.escapelife.site/posts/e2e78d82.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SSH æœåŠ¡åŸç†å’Œä½¿ç”¨æŠ€å·§&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;1-å·¥å…·ä»‹ç»&quot;&gt;1. å·¥å…·ä»‹ç»&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;è¯¥å·¥å…·çš„èµ·åˆçµæ„Ÿå’Œæœºåˆ¶æ¥è‡ªäº rstunnel!&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;autossh&lt;/code&gt; å·¥å…·æ˜¯ä¸€ä¸ªç”¨æ¥å¯åŠ¨ &lt;code&gt;ssh&lt;/code&gt; æœåŠ¡å¹¶è¿›è¡Œç›‘æ§çš„å‘½ä»¤è¡Œåº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨ç¨‹åºé—®é¢˜æˆ–è€…æ˜¯ç½‘ç»œé—®é¢˜çš„æ—¶å€™ï¼Œé‡å¯ &lt;code&gt;ssh&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ &lt;code&gt;autossh 1.2&lt;/code&gt; çš„æ—¶å€™ï¼Œå…¶æ–¹æ³•å·²ç»æ”¹å˜äº†ï¼š&lt;code&gt;autossh&lt;/code&gt; ä½¿ç”¨ &lt;code&gt;ssh&lt;/code&gt; æ¥æ„é€ ä¸€ä¸ª &lt;code&gt;ssh&lt;/code&gt; é‡å®šå‘å¾ªç¯(æœ¬åœ°åˆ°è¿œç¨‹å’Œè¿œç¨‹åˆ°æœ¬åœ°)ï¼Œç„¶åå‘é€æµ‹è¯•æ•°æ®å¹¶è·å¾—è¿”å›ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;autossh 1.3&lt;/code&gt; å¢åŠ äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼šå¯æŒ‡å®šè¿œç¨‹ &lt;code&gt;echo&lt;/code&gt; æœåŠ¡çš„ç«¯å£ç”¨äºè¿”å›æµ‹è¯•æ•°æ®å‘é€ç»“æœã€‚è¿™ä¸ªé¿å…æ¡æ‰‹é˜¶æ®µä»¥åŠæ‰€æœ‰è¿œç¨‹æœºå™¨ç«¯å£çš„å†²çªé—®é¢˜ï¼Œè€Œè€çš„ &lt;code&gt;loop-of-forwardings&lt;/code&gt; æ–¹æ³•ä¾ç„¶å¯ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å†…ç½‘ä¸»æœºä¸»åŠ¨è¿æ¥åˆ°å¤–ç½‘ä¸»æœºï¼Œåˆè¢«ç§°ä½œ&lt;strong&gt;åå‘è¿æ¥&lt;/strong&gt;(&lt;code&gt;Reverse Connection&lt;/code&gt;)ï¼Œè¿™æ · &lt;code&gt;NAT&lt;/code&gt; è·¯ç”±/é˜²ç«å¢™å°±ä¼šåœ¨å†…ç½‘ä¸»æœºå’Œå¤–ç½‘ä¸»æœºä¹‹é—´å»ºç«‹æ˜ å°„å³å¯ç›¸äº’é€šä¿¡äº†ã€‚ä½†è¿™ç§æ˜ å°„æ˜¯è·¯ç”±ç½‘å…³è‡ªåŠ¨ç»´æŒçš„ï¼Œä¸ä¼šæŒç»­ä¸‹å»ï¼Œå¦‚æœè¿æ¥æ–­å¼€æˆ–è€…ç½‘ç»œä¸ç¨³å®šéƒ½ä¼šå¯¼è‡´é€šä¿¡å¤±è´¥ï¼Œè¿™æ—¶å†…ç½‘ä¸»æœºéœ€è¦è‡ªåŠ¨é‡è¿æœºåˆ¶äº†ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å®‰è£…æ–¹å¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ yum install autossh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ apt install autossh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="SSH" scheme="https://www.hi-linux.com/categories/SSH/"/>
    
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="SSH" scheme="https://www.hi-linux.com/tags/SSH/"/>
    
      <category term="AutoSSH" scheme="https://www.hi-linux.com/tags/AutoSSH/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨ etcdhosts æ’ä»¶å¿«é€Ÿæ­å»ºåˆ†å¸ƒå¼ CoreDNS é›†ç¾¤</title>
    <link href="https://www.hi-linux.com/posts/3252.html"/>
    <id>https://www.hi-linux.com/posts/3252.html</id>
    <published>2021-03-01T01:00:00.000Z</published>
    <updated>2021-03-01T03:15:04.834Z</updated>
    
    <content type="html"><![CDATA[<div id="vip-container"><h2><span id="etcdhosts-æ’ä»¶ç®€ä»‹">etcdhosts æ’ä»¶ç®€ä»‹</span></h2><p>etcdhosts é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°† hosts æ–‡ä»¶å­˜å‚¨åœ¨ Etcd ä¸­ï¼Œç„¶åå¤šä¸ª CoreDNS å…±äº«ä¸€ä»½ hosts æ–‡ä»¶ï¼›å¾—ç›Šäº Etcd æä¾›çš„ watch åŠŸèƒ½ï¼Œå½“ Etcd ä¸­çš„ hosts æ–‡ä»¶æ›´æ–°æ—¶ï¼Œæ¯å° CoreDNS æœåŠ¡å™¨éƒ½ä¼šæ¥åˆ°æ¨é€ï¼ŒåŒæ—¶å®Œæˆçƒ­é‡è½½ï¼›etcdhosts åŸºæœ¬æ¶æ„å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">|                                                                             |</span><br><span class="line">|   +-----------+                                                             |</span><br><span class="line">|   |           |                                                             |</span><br><span class="line">|   |  CoreDNS  +---------------------+                                       |</span><br><span class="line">|   |           |                     |                                       |</span><br><span class="line">|   +-----------+                     |                +------------------+   |</span><br><span class="line">|                                     |                |                  |   |</span><br><span class="line">|                            +--------v---------+      |                  |   |</span><br><span class="line">|   +-----------+            |                  |      |                  |   |</span><br><span class="line">|   |           |            |                  |      | dnsctl or        |   |</span><br><span class="line">|   |  CoreDNS  +------------&gt;   Etcd Cluster   &lt;------+ other etcd tool  |   |</span><br><span class="line">|   |           |            |                  |      |                  |   |</span><br><span class="line">|   +-----------+            |                  |      |                  |   |</span><br><span class="line">|                            +---------^--------+      |                  |   |</span><br><span class="line">|                                      |               |                  |   |</span><br><span class="line">|   +-----------+                      |               +------------------+   |</span><br><span class="line">|   |           |                      |                                      |</span><br><span class="line">|   |  CoreDNS  +----------------------+                                      |</span><br><span class="line">|   |           |                                                             |</span><br><span class="line">|   +-----------+                                                             |</span><br><span class="line">|                                                                             |</span><br><span class="line">|                                                                             |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><h2><span id="ç¼–è¯‘-coredns">ç¼–è¯‘ CoreDNS</span></h2><blockquote><p>etcdhosts <a href="https://github.com/ytpay/etcdhosts/releases" target="_blank" rel="noopener">release</a> é¡µå·²ç»æä¾›éƒ¨åˆ†ç‰ˆæœ¬çš„é¢„ç¼–è¯‘æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ä½¿ç”¨ã€‚</p></blockquote><p><a href="https://github.com/ytpay/etcdhosts" target="_blank" rel="noopener">etcdhosts</a> ä½œä¸ºä¸€ä¸ª CoreDNS æ‰©å±•æ’ä»¶é‡‡ç”¨ç›´æ¥å¶åˆçš„æ–¹å¼ç¼–å†™(æœªé‡‡ç”¨ gRPC æ˜¯å› ä¸ºè€ƒè™‘æ€§èƒ½å½±å“)ï¼Œè¿™æ„å‘³ç€éœ€è¦é‡æ–°ç¼–è¯‘ CoreDNS æ¥é›†æˆæ’ä»¶ï¼Œä»¥ä¸‹ä¸º CoreDNS ç¼–è¯‘è¿‡ç¨‹(ä½¿ç”¨ docker):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># clone source code</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;ytpay&#x2F;etcdhosts.git</span><br><span class="line"># build</span><br><span class="line">cd etcdhosts &amp;&amp; .&#x2F;build v1.8.0</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å®Œæˆåå°†åœ¨ <code>build</code> ç›®å½•ä¸‹ç”Ÿæˆå„ä¸ªå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶å‹ç¼©åŒ…ã€‚</p><a id="more"></a><h2><span id="æ­å»º-etcd-é›†ç¾¤">æ­å»º Etcd é›†ç¾¤</span></h2><p>Etcd é›†ç¾¤æ­å»ºå°†ç›´æ¥é‡‡ç”¨ deb å®‰è£…åŒ…ï¼Œå…·ä½“ç»†èŠ‚è¿™é‡Œä¸å†é˜è¿°ï¼Œæœ¬æ¬¡æ­å»ºç³»ç»Ÿä¸º Ubuntu 20ï¼Œä»¥ä¸‹ä¸ºæ­å»ºæ­¥éª¤ã€‚</p><h3><span id="21-å®‰è£…è½¯ä»¶åŒ…">2.1ã€å®‰è£…è½¯ä»¶åŒ…</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ä¸‹è½½ cfssl å®‰è£…åŒ…ï¼Œç”¨äºç­¾ç½²è¯ä¹¦</span><br><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;mritd&#x2F;etcd-deb&#x2F;releases&#x2F;download&#x2F;v3.4.13&#x2F;cfssl_1.4.1_amd64.deb</span><br><span class="line"># ä¸‹è½½ etcd å®‰è£…åŒ…</span><br><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;mritd&#x2F;etcd-deb&#x2F;releases&#x2F;download&#x2F;v3.4.13&#x2F;etcd_3.4.13_amd64.deb</span><br><span class="line"># æ‰§è¡Œå®‰è£…</span><br><span class="line">dpkg -i cfssl_1.4.1_amd64.deb etcd_3.4.13_amd64.deb</span><br></pre></td></tr></table></figure><h3><span id="22-åˆ›å»ºè¯ä¹¦">2.2ã€åˆ›å»ºè¯ä¹¦</span></h3><p>åˆ›å»ºè¯ä¹¦éœ€è¦å…ˆä¿®æ”¹è¯ä¹¦é…ç½®æ–‡ä»¶(<code>etcd-csr.json</code>)ç„¶åå€ŸåŠ© cfssl å·¥å…·æ¥åˆ›å»ºè¯ä¹¦</p><p><strong><code>/etc/etcd/cfssl/etcd-csr.json</code></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;key&quot;: &#123;</span><br><span class="line">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">        &quot;size&quot;: 2048</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;names&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;O&quot;: &quot;etcd&quot;,</span><br><span class="line">            &quot;OU&quot;: &quot;etcd Security&quot;,</span><br><span class="line">            &quot;L&quot;: &quot;Beijing&quot;,</span><br><span class="line">            &quot;ST&quot;: &quot;Beijing&quot;,</span><br><span class="line">            &quot;C&quot;: &quot;CN&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;CN&quot;: &quot;etcd&quot;,</span><br><span class="line">    &quot;hosts&quot;: [</span><br><span class="line">        &quot;127.0.0.1&quot;,</span><br><span class="line">        &quot;localhost&quot;,</span><br><span class="line">        &quot;*.etcd.node&quot;,</span><br><span class="line">        &quot;*.kubernetes.node&quot;,</span><br><span class="line">+       &quot;172.16.11.71&quot;,</span><br><span class="line">+       &quot;172.16.11.72&quot;,</span><br><span class="line">+       &quot;172.16.11.73&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è„šæœ¬åˆ›å»ºè¯ä¹¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;etc&#x2F;etcd&#x2F;cfssl</span><br><span class="line">.&#x2F;create.sh</span><br><span class="line">cp *.pem &#x2F;etc&#x2F;etcd&#x2F;ssl</span><br></pre></td></tr></table></figure><p><strong>è¯ä¹¦åˆ›å»ºå®Œæˆåéœ€è¦åˆ†å‘åˆ°å…¶ä»–ä¸¤å°æœºå™¨ä¸Šï¼Œä¿è¯ä¸‰å°èŠ‚ç‚¹çš„ <code>/etc/etcd/ssl</code> ç›®å½•è¯ä¹¦ç›¸åŒã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å¤åˆ¶è¯ä¹¦</span><br><span class="line">scp &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;*.pem root@NODE2:&#x2F;etc&#x2F;etcd&#x2F;ssl</span><br><span class="line">scp &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;*.pem root@NODE3:&#x2F;etc&#x2F;etcd&#x2F;ssl</span><br><span class="line"># ä¿®å¤æƒé™(ä¸‰å°éƒ½è¦ä¿®å¤)</span><br><span class="line">chown -R etcd:etcd &#x2F;etc&#x2F;etcd&#x2F;</span><br></pre></td></tr></table></figure><h3><span id="23-è°ƒæ•´é›†ç¾¤é…ç½®">2.3ã€è°ƒæ•´é›†ç¾¤é…ç½®</span></h3><p>è¯ä¹¦ç­¾ç½²å®Œæˆåï¼Œç®€å•çš„è°ƒæ•´æ¯å°æœºå™¨ä¸Šçš„é›†ç¾¤èŠ‚ç‚¹é…ç½®å³å¯</p><p><strong><code>/etc/etcd/etcd.conf</code></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># [member]</span><br><span class="line">+ # èŠ‚ç‚¹å·è‡ªè¡Œä¿®æ”¹ï¼Œæ¨èæ ¼å¼: etcd+èŠ‚ç‚¹IPï¼Œä¾‹å¦‚ etcd21</span><br><span class="line">+ ETCD_NAME&#x3D;etcd1</span><br><span class="line">ETCD_DATA_DIR&#x3D;&quot;&#x2F;var&#x2F;lib&#x2F;etcd&#x2F;data&quot;</span><br><span class="line">ETCD_WAL_DIR&#x3D;&quot;&#x2F;var&#x2F;lib&#x2F;etcd&#x2F;wal&quot;</span><br><span class="line">ETCD_SNAPSHOT_COUNT&#x3D;&quot;100&quot;</span><br><span class="line">+ # ä¿®æ”¹ä¸ºå½“å‰æœºå™¨ IP</span><br><span class="line">+ ETCD_LISTEN_PEER_URLS&#x3D;&quot;https:&#x2F;&#x2F;172.16.11.71:2380&quot;</span><br><span class="line">+ # ä¿®æ”¹ä¸ºå½“å‰æœºå™¨ IP</span><br><span class="line">+ ETCD_LISTEN_CLIENT_URLS&#x3D;&quot;https:&#x2F;&#x2F;172.16.11.71:2379,http:&#x2F;&#x2F;127.0.0.1:2379&quot;</span><br><span class="line">ETCD_QUOTA_BACKEND_BYTES&#x3D;&quot;8589934592&quot;</span><br><span class="line">ETCD_MAX_REQUEST_BYTES&#x3D;&quot;10485760&quot;</span><br><span class="line"></span><br><span class="line"># [cluster]</span><br><span class="line">+ # ä¿®æ”¹ä¸ºå½“å‰æœºå™¨ IP</span><br><span class="line">+ ETCD_INITIAL_ADVERTISE_PEER_URLS&#x3D;&quot;https:&#x2F;&#x2F;172.16.11.71:2380&quot;</span><br><span class="line"># if you use different ETCD_NAME (e.g. test), set ETCD_INITIAL_CLUSTER value for this name, i.e. &quot;test&#x3D;http:&#x2F;&#x2F;...&quot;</span><br><span class="line">+ # ä¸‰å°æœºå™¨éƒ½è¦æŒ‰ç…§æ ¼å¼å†™å¥½</span><br><span class="line">+ ETCD_INITIAL_CLUSTER&#x3D;&quot;etcd1&#x3D;https:&#x2F;&#x2F;172.16.11.71:2380,etcd2&#x3D;https:&#x2F;&#x2F;172.16.11.72:2380,etcd3&#x3D;https:&#x2F;&#x2F;172.16.11.73:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE&#x3D;&quot;new&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN&#x3D;&quot;etcd-cluster&quot;</span><br><span class="line">+ # ä¿®æ”¹ä¸ºå½“å‰æœºå™¨ IP</span><br><span class="line">+ ETCD_ADVERTISE_CLIENT_URLS&#x3D;&quot;https:&#x2F;&#x2F;172.16.11.71:2379&quot;</span><br><span class="line"></span><br><span class="line">ETCD_AUTO_COMPACTION_MODE&#x3D;&quot;revision&quot;</span><br><span class="line">ETCD_AUTO_COMPACTION_RETENTION&#x3D;&quot;16&quot;</span><br><span class="line">ETCD_QUOTA_BACKEND_BYTES&#x3D;&quot;5368709120&quot;</span><br><span class="line"></span><br><span class="line"># [security]</span><br><span class="line">ETCD_CERT_FILE&#x3D;&quot;&#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd.pem&quot;</span><br><span class="line">ETCD_KEY_FILE&#x3D;&quot;&#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd-key.pem&quot;</span><br><span class="line">ETCD_TRUSTED_CA_FILE&#x3D;&quot;&#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd-root-ca.pem&quot;</span><br><span class="line">ETCD_CLIENT_CERT_AUTH&#x3D;&quot;true&quot;</span><br><span class="line">ETCD_AUTO_TLS&#x3D;&quot;true&quot;</span><br><span class="line">ETCD_PEER_CERT_FILE&#x3D;&quot;&#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd.pem&quot;</span><br><span class="line">ETCD_PEER_KEY_FILE&#x3D;&quot;&#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd-key.pem&quot;</span><br><span class="line">ETCD_PEER_CLIENT_CERT_AUTH&#x3D;&quot;true&quot;</span><br><span class="line">ETCD_PEER_TRUSTED_CA_FILE&#x3D;&quot;&#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd-root-ca.pem&quot;</span><br><span class="line">ETCD_PEER_AUTO_TLS&#x3D;&quot;true&quot;</span><br></pre></td></tr></table></figure><p>æœ€åæ¯å°æœºå™¨æ‰§è¡Œ <code>systemctl start etcd</code> å¯åŠ¨å³å¯ï¼ŒéªŒè¯é›†ç¾¤æ˜¯å¦å¥åº·å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">etcdctl endpoint health --cert &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd.pem --key &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd-key.pem --cacert &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd-root-ca.pem --endpoints https:&#x2F;&#x2F;172.16.11.71:2379,https:&#x2F;&#x2F;172.16.11.72:2379,https:&#x2F;&#x2F;172.16.11.73:2379</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;172.16.11.71:2379 is healthy: successfully committed proposal: took &#x3D; 33.07493ms</span><br><span class="line">https:&#x2F;&#x2F;172.16.11.72:2379 is healthy: successfully committed proposal: took &#x3D; 32.132266ms</span><br><span class="line">https:&#x2F;&#x2F;172.16.11.73:2379 is healthy: successfully committed proposal: took &#x3D; 40.745291ms</span><br></pre></td></tr></table></figure><h2><span id="æ­å»º-coredns-é›†ç¾¤">æ­å»º CoreDNS é›†ç¾¤</span></h2><h3><span id="31-coredns-å®‰è£…">3.1ã€CoreDNS å®‰è£…</span></h3><p>ç³»ç»Ÿçº§ CoreDNS å®‰è£…æ¨èç›´æ¥ä½¿ç”¨ systemd ç®¡ç†ï¼Œå®˜æ–¹ç›®å‰æä¾›äº† systemd ç›¸å…³é…ç½®æ–‡ä»¶: <a href="https://github.com/coredns/deployment/tree/master/systemd" target="_blank" rel="noopener">https://github.com/coredns/deployment/tree/master/systemd</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">tar -zxvf coredns_1.8.0_linux_amd64.tgz</span><br><span class="line">mv coredns &#x2F;usr&#x2F;bin&#x2F;coredns</span><br><span class="line"></span><br><span class="line"># å®‰è£… systemd é…ç½®</span><br><span class="line">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;coredns&#x2F;deployment&#x2F;master&#x2F;systemd&#x2F;coredns-sysusers.conf -O &#x2F;usr&#x2F;lib&#x2F;sysusers.d&#x2F;coredns-sysusers.conf</span><br><span class="line">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;coredns&#x2F;deployment&#x2F;master&#x2F;systemd&#x2F;coredns-tmpfiles.conf -O &#x2F;usr&#x2F;lib&#x2F;tmpfiles.d&#x2F;coredns-tmpfiles.conf</span><br><span class="line">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;coredns&#x2F;deployment&#x2F;master&#x2F;systemd&#x2F;coredns.service -O &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;coredns.service</span><br><span class="line"></span><br><span class="line"># reload</span><br><span class="line">systemctl daemon-reload</span><br><span class="line"># åˆå§‹åŒ–ç”¨æˆ·</span><br><span class="line">systemd-sysusers</span><br><span class="line"># åˆå§‹åŒ–ä¸´æ—¶ç›®å½•</span><br><span class="line">systemd-tmpfiles --create</span><br><span class="line"># åˆ›å»ºé…ç½®ç›®å½•</span><br><span class="line">mkdir -p &#x2F;etc&#x2F;coredns&#x2F;ssl</span><br></pre></td></tr></table></figure><h3><span id="32-etcdhosts-é…ç½®">3.2ã€etcdhosts é…ç½®</span></h3><p>etcdhosts çš„é…ç½®ç±»ä¼¼å®˜æ–¹çš„ etcd æ’ä»¶ï¼Œå…¶é…ç½®æ ¼å¼å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">etcdhosts [ZONES...] &#123;</span><br><span class="line">    [INLINE]</span><br><span class="line">    ttl SECONDS</span><br><span class="line">    no_reverse</span><br><span class="line">    fallthrough [ZONES...]</span><br><span class="line">    key ETCD_KEY</span><br><span class="line">    endpoint ETCD_ENDPOINT...</span><br><span class="line">    credentials ETCD_USERNAME ETCD_PASSWORD</span><br><span class="line">    tls ETCD_CERT ETCD_KEY ETCD_CACERT</span><br><span class="line">    timeout ETCD_TIMEOUT</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å¯å¯åŠ¨çš„æ ·ä¾‹é…ç½®:</p><p><strong><code>/etc/coredns/Corefile</code></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">. &#123;</span><br><span class="line">    # ç»‘å®šæ¥å£åœ°å€</span><br><span class="line">    bind 172.16.11.71</span><br><span class="line"></span><br><span class="line">    # cache</span><br><span class="line">    cache 30 . &#123;</span><br><span class="line">        success 4096</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # etcdhosts é…ç½®</span><br><span class="line">    etcdhosts . &#123;</span><br><span class="line">        fallthrough .</span><br><span class="line">        key &#x2F;etcdhosts</span><br><span class="line">        timeout 5s</span><br><span class="line">        tls &#x2F;etc&#x2F;coredns&#x2F;ssl&#x2F;etcd.pem &#x2F;etc&#x2F;coredns&#x2F;ssl&#x2F;etcd-key.pem &#x2F;etc&#x2F;coredns&#x2F;ssl&#x2F;etcd-root-ca.pem</span><br><span class="line">        endpoint https:&#x2F;&#x2F;172.16.11.71:2379 https:&#x2F;&#x2F;172.16.11.72:2379 https:&#x2F;&#x2F;172.16.11.73:2379</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # ä¸Šæ¸¸ DNS é…ç½®</span><br><span class="line">    forward . 114.114.114.114:53 &#123;</span><br><span class="line">        max_fails 2</span><br><span class="line">        expire 20s</span><br><span class="line">        policy random</span><br><span class="line">        health_check 0.2s</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # æ—¥å¿—é…ç½®</span><br><span class="line">    errors</span><br><span class="line">    log . &quot;&#123;remote&#125;:&#123;port&#125; - &#123;&gt;id&#125; \&quot;&#123;type&#125; &#123;class&#125; &#123;name&#125; &#123;proto&#125; &#123;size&#125; &#123;&gt;do&#125; &#123;&gt;bufsize&#125;\&quot; &#123;rcode&#125; &#123;&gt;rflags&#125; &#123;rsize&#125; &#123;duration&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº etcdhosts æ’ä»¶éœ€è¦è¿æ¥ etcd é›†ç¾¤ï¼Œæ‰€ä»¥éœ€è¦å°†è¯ä¹¦å¤åˆ¶åˆ° <code>Corefile</code> æŒ‡å®šçš„ä½ç½®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å®é™…ç”Ÿäº§ç¯å¢ƒ coredns ä¸ etcd ä¸€èˆ¬ä¸åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œè¯·è‡ªè¡Œ scp</span><br><span class="line">cp &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;*.pem &#x2F;etc&#x2F;coredns&#x2F;ssl</span><br><span class="line"># ä¿®å¤æƒé™</span><br><span class="line">chown -R coredns:coredns &#x2F;etc&#x2F;coredns</span><br></pre></td></tr></table></figure><p><strong>æœ€åç›´æ¥å¯åŠ¨å³å¯(é¦–æ¬¡å¯åŠ¨ä¼šå‡ºç° <code>[ERROR] plugin/etcdhosts: invalid etcd response: 0</code> é”™è¯¯ï¼Œå±äºæ­£å¸¸æƒ…å†µ):</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># å¯åŠ¨</span><br><span class="line">systemctl start coredns</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•</span><br><span class="line">dig @172.16.11.71 baidu.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; @172.16.11.71 baidu.com</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35323</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">; COOKIE: 8e3137531ed0b57a (echoed)</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;baidu.com.                     IN      A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">baidu.com.              30      IN      A       220.181.38.148</span><br><span class="line">baidu.com.              30      IN      A       39.156.69.79</span><br><span class="line"></span><br><span class="line">;; Query time: 8 msec</span><br><span class="line">;; SERVER: 172.16.11.71#53(172.16.11.71)</span><br><span class="line">;; WHEN: Mon Nov 16 20:18:25 CST 2020</span><br><span class="line">;; MSG SIZE  rcvd: 100</span><br></pre></td></tr></table></figure><p><strong>æœ€ååœ¨å¤šå°æœºå™¨ä¸Šé€šè¿‡åŒæ ·çš„é…ç½®å¯åŠ¨ CoreDNS å³å¯ï¼Œæ­¤æ—¶æ‰€æœ‰ CoreDNS æœåŠ¡å™¨é€šè¿‡ Etcd æä¾›ä¸€è‡´æ€§çš„è®°å½•è§£æã€‚</strong></p><h2><span id="è®°å½•è°ƒæ•´">è®°å½•è°ƒæ•´</span></h2><p>æ‰€æœ‰ CoreDNS å¯åŠ¨æˆåŠŸåï¼Œé»˜è®¤ etcdhosts æ’ä»¶å°†ä¼šè¯»å– Etcd ä¸­çš„ <code>/etcdhosts</code> key ä½œä¸º hosts æ–‡ä»¶è½½å…¥ï¼›**è½½å…¥æˆåŠŸåå°†ä¼šåœ¨å†…å­˜çº§è¿›è¡Œ Cacheï¼Œå¤šæ¬¡æŸ¥è¯¢ä¸ä¼šé€ æˆç–¯ç‹‚çš„ Etcd è¯·æ±‚ï¼Œåªæœ‰å½“è§¦å‘ reload æ—¶(åŒ…æ‹¬ Etcd æ›´æ–°)æ‰ä¼šé‡æ–°æŸ¥è¯¢ Etcdã€‚**æ‰€ä»¥æ­¤æ—¶åªéœ€è¦å‘ Etcd çš„ <code>/etcdhosts</code> key å†™å…¥ä¸€ä¸ª hosts æ–‡ä»¶å³å¯ï¼›å†™å…¥ Etcd å¯ä»¥ä½¿ç”¨ etcdctl ä»¥åŠå…¶ä»–çš„å¼€æºå·¥å…·ï¼Œç”šè‡³è‡ªå·±å¼€å‘éƒ½å¯ä»¥ï¼Œ**è®°å½•æ›´æ”¹åªéœ€è¦è·Ÿ Etcd æ‰“äº¤é“ï¼Œä¸éœ€è¦ç†ä¼š CoreDNSï¼›**ç”±äºæœ¬äººå®åœ¨æ˜¯æ¯”è¾ƒèœï¼Œå‰ç«¯é¡µé¢å†™ä¸å‡ºæ¥ï¼Œæ‰€ä»¥å¼„äº†ä¸€ä¸ªå‘½ä»¤è¡Œç‰ˆæœ¬çš„å·¥å…·: <a href="https://github.com/ytpay/dnsctl" target="_blank" rel="noopener">dnsctl</a></p><p>dnsctl åªæœ‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œ**é»˜è®¤æƒ…å†µä¸‹ dnsctl è¯»å– <code>$HOME/.dnsctl.yaml</code> é…ç½®æ–‡ä»¶æ¥æ²Ÿé€š Etcdï¼Œ**é…ç½®æ–‡ä»¶æ ¼å¼å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># etcd ä¸­ etcdhosts æ’ä»¶çš„ key</span><br><span class="line">dnskey: &#x2F;etcdhosts</span><br><span class="line"># etcd é›†ç¾¤é…ç½®</span><br><span class="line">etcd:</span><br><span class="line">  cert: &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd.pem</span><br><span class="line">  key: &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd-key.pem</span><br><span class="line">  ca: &#x2F;etc&#x2F;etcd&#x2F;ssl&#x2F;etcd-root-ca.pem</span><br><span class="line">  endpoints:</span><br><span class="line">    - https:&#x2F;&#x2F;172.16.11.71:2379</span><br><span class="line">    - https:&#x2F;&#x2F;172.16.11.72:2379</span><br><span class="line">    - https:&#x2F;&#x2F;172.16.11.73:2379</span><br></pre></td></tr></table></figure><p>dnsctl æä¾›å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dnsctl for etcdhosts plugin</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  dnsctl [flags]</span><br><span class="line">  dnsctl [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  config      show example config</span><br><span class="line">  dump        dump hosts</span><br><span class="line">  edit        edit hosts</span><br><span class="line">  help        Help about any command</span><br><span class="line">  upload      upload hosts from file</span><br><span class="line">  version     show hosts version</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">      --config string   config file (default is $HOME&#x2F;.dnsctl.yaml)</span><br><span class="line">  -h, --help            help for dnsctl</span><br><span class="line">  -v, --version         version for dnsctl</span><br><span class="line"></span><br><span class="line">Use &quot;dnsctl [command] --help&quot; for more information about a command.</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>edit</code> å‘½ä»¤å°†ä¼šæ‰“å¼€ç³»ç»Ÿé»˜è®¤ç¼–è¾‘å™¨(ä¾‹å¦‚ vim)ï¼Œç„¶åç¼–è¾‘å®Œä¿å­˜åä¼šè‡ªåŠ¨ä¸Šä¼ åˆ° Etcd ä¸­ï¼Œæ­¤å CoreDNS çš„ etcdhosts æ’ä»¶å°†ä¼šç«‹å³é‡è½½ï¼›<strong><code>dump</code> å‘½ä»¤ç”¨äºå°† Etcd ä¸­çš„ hosts æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ç”¨äºå¤‡ä»½ï¼Œ<code>upload</code> å‘½ä»¤å¯ä»¥å°†å·²æœ‰çš„ hosts æ–‡ä»¶ä¸Šä¼ åˆ° Etcd ç”¨äºæ¢å¤ã€‚</strong></p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ Bleem ã€ï¼ŒåŸæ–‡ï¼š<a href="https://tinyurl.com/y5sgwryn" target="_blank" rel="noopener">https://tinyurl.com/y5sgwryn</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if (!isMobile) {    var btw = new BTWPlugin();    btw.init({        "id": "vip-container",        "blogId": "10135-1588830050631-449",        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",        "keyword": "VIP"    });}</script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;etcdhosts-æ’ä»¶ç®€ä»‹&quot;&gt;etcdhosts æ’ä»¶ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;etcdhosts é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°† hosts æ–‡ä»¶å­˜å‚¨åœ¨ Etcd ä¸­ï¼Œç„¶åå¤šä¸ª CoreDNS å…±äº«ä¸€ä»½ hosts æ–‡ä»¶ï¼›å¾—ç›Šäº Etcd æä¾›çš„ watch åŠŸèƒ½ï¼Œå½“ Etcd ä¸­çš„ hosts æ–‡ä»¶æ›´æ–°æ—¶ï¼Œæ¯å° CoreDNS æœåŠ¡å™¨éƒ½ä¼šæ¥åˆ°æ¨é€ï¼ŒåŒæ—¶å®Œæˆçƒ­é‡è½½ï¼›etcdhosts åŸºæœ¬æ¶æ„å¦‚ä¸‹:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+-----------------------------------------------------------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                                                                             |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   +-----------+                                                             |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |           |                                                             |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |  CoreDNS  +---------------------+                                       |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |           |                     |                                       |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   +-----------+                     |                +------------------+   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                                     |                |                  |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                            +--------v---------+      |                  |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   +-----------+            |                  |      |                  |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |           |            |                  |      | dnsctl or        |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |  CoreDNS  +------------&amp;gt;   Etcd Cluster   &amp;lt;------+ other etcd tool  |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |           |            |                  |      |                  |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   +-----------+            |                  |      |                  |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                            +---------^--------+      |                  |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                                      |               |                  |   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   +-----------+                      |               +------------------+   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |           |                      |                                      |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |  CoreDNS  +----------------------+                                      |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   |           |                                                             |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   +-----------+                                                             |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                                                                             |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                                                                             |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-----------------------------------------------------------------------------+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;ç¼–è¯‘-CoreDNS&quot;&gt;ç¼–è¯‘ CoreDNS&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;etcdhosts &lt;a href=&quot;https://github.com/ytpay/etcdhosts/releases&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;release&lt;/a&gt; é¡µå·²ç»æä¾›éƒ¨åˆ†ç‰ˆæœ¬çš„é¢„ç¼–è¯‘æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ytpay/etcdhosts&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;etcdhosts&lt;/a&gt; ä½œä¸ºä¸€ä¸ª CoreDNS æ‰©å±•æ’ä»¶é‡‡ç”¨ç›´æ¥å¶åˆçš„æ–¹å¼ç¼–å†™(æœªé‡‡ç”¨ gRPC æ˜¯å› ä¸ºè€ƒè™‘æ€§èƒ½å½±å“)ï¼Œè¿™æ„å‘³ç€éœ€è¦é‡æ–°ç¼–è¯‘ CoreDNS æ¥é›†æˆæ’ä»¶ï¼Œä»¥ä¸‹ä¸º CoreDNS ç¼–è¯‘è¿‡ç¨‹(ä½¿ç”¨ docker):&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# clone source code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git clone https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;ytpay&amp;#x2F;etcdhosts.git&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd etcdhosts &amp;amp;&amp;amp; .&amp;#x2F;build v1.8.0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¼–è¯‘å®Œæˆåå°†åœ¨ &lt;code&gt;build&lt;/code&gt; ç›®å½•ä¸‹ç”Ÿæˆå„ä¸ªå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶å‹ç¼©åŒ…ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="CoreDNS" scheme="https://www.hi-linux.com/categories/CoreDNS/"/>
    
    
      <category term="æŠ€å·§" scheme="https://www.hi-linux.com/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="Linux" scheme="https://www.hi-linux.com/tags/Linux/"/>
    
      <category term="CoreDNS" scheme="https://www.hi-linux.com/tags/CoreDNS/"/>
    
  </entry>
  
</feed>
