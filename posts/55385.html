<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="Linux,è¿ç»´,Nginx,Zabbix,Centos,Ansible,MySQL,Python,Docker,ELK,Haproxy,Git,Nodejs,å®‰å…¨,æŠ€æœ¯">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          å¦‚ä½•ä½¿ç”¨ Skopeo åšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ - å¥‡å¦™çš„ Linux ä¸–ç•Œ
        
    </title>

    <link rel="canonical" href="https://www.hi-linux.com/posts/55385.html">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
<link rel="stylesheet" href="/css/beantech.min.css">

    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/toc.css">


    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="å¥‡å¦™çš„ Linux ä¸–ç•Œ" type="application/atom+xml">
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/header_img/building.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
                            
                              <a class="tag" href="/tags/#Docker" title="Docker">Docker</a>
                            
                              <a class="tag" href="/tags/#Skopeo" title="Skopeo">Skopeo</a>
                            
                        </div>
                        <h1>å¦‚ä½•ä½¿ç”¨ Skopeo åšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by Mike on
                            2022-06-01
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">å¥‡å¦™çš„ Linux ä¸–ç•Œ</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <div id="vip-container"><h2><span id="1-åŸºç¡€ä»‹ç»">1. åŸºç¡€ä»‹ç»</span></h2>
<p>æè¿°: ä½œä¸ºå…¬å¸å†…éƒ¨ PaaS toB äº§å“çš„æ‰“åŒ…å‘å¸ƒäººå‘˜ï¼Œå®¹å™¨é•œåƒå¯¹æˆ‘ä»¬æ‰“å·¥äººè€Œè¨€å°±åƒæ˜¯å·¥åœ°ä¸Šçš„ç –å¤´ ğŸ§±ï¼Œè€Œæˆ‘çš„ä¸€éƒ¨åˆ†å·¥ä½œå°±æ˜¯å°†è¿™äº›ç –å¤´åœ¨å„ä¸ªä»“åº“ä¹‹é—´æ¬æ¥æ¬å»ï¼Œæœ€ç»ˆå°†è¿™äº›ç –å¤´æ‰“åŒ…æ”¾åœ¨äº§å“çš„å®‰è£…åŒ…ä¸­ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„ PaaS äº§å“å®‰è£…åŒ…ã€‚</p>
<ul>
<li>Q: åœ¨ PaaS (å¹³å°å³æœåŠ¡)ä¸­çš„å¤§å®¶å¸¸è¯´çš„ ToB ä¸ ToC åˆ°åº•æ˜¯ä»€ä¹ˆ?</li>
</ul>
<blockquote>
<p>ToC é¢å‘æ™®é€šç”¨æˆ·æœåŠ¡, ä¸»è¦æ˜¯è®©ç”¨æˆ·ä½“éªŒæ„Ÿå¥½ï¼Œè§£å†³ç”¨æˆ·ä½¿ç”¨æ–¹é¢çš„é—®é¢˜è®°å½•ï¼Œå¹¶è¿”å›ç»™å‰åç«¯å¼€å‘ã€‚<br>
ToB æ˜¯é¢å‘ä¼ä¸šç”¨æˆ·æœåŠ¡, äº§å“å¯ç”¨ã€å…¶ä¸­æœ€å…³é”®æ˜¯è®©Bossä½¿ç”¨Happly!</p>
</blockquote>
<ul>
<li>Q: å‡å¦‚æœ‰å¦‚ä¸‹åœºæ™¯ï¼Œæˆ‘ä»¬ä» dockerhub å…¬å…±ä»“åº“ä¸­ä¸‹è½½ä¸€ä¸ª GB ä»¥ä¸Šçš„é•œåƒï¼Œåˆ°æœ¬åœ°çš„ç§æœ‰ä»“åº“ä¸­ï¼Œæˆ‘æƒ³é€šå¸¸ä½ ä¼šè¿™æ ·åšå…ˆ <code>docker pull</code> åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨ <code>docker tag</code> æ›´æ”¹ä¸ºç§æœ‰ä»“åº“åœ°å€åŠ ä¸Šé•œåƒåç§°ç‰ˆæœ¬ï¼Œæœ€åå†ä½¿ç”¨<code>docker push</code> ä¸Šä¼ é•œåƒåˆ°ç§æœ‰ä»“åº“ä¸­ï¼Œä»¥ä¾›å…¶å®ƒå†…ç½‘æœºå™¨æ‹‰å–å¹¶ä½¿ç”¨ã€‚è™½ç„¶è¯¥æ–¹æ³•æ˜¯å¯è¡Œï¼Œä½†æ˜¯å¦‚æœæœ‰å¤šä¸ªå¤§äº GB ä»¥ä¸Šçš„é•œåƒéœ€è¦ä¸Šä¼ åˆ°ç§æœ‰ä»“åº“ï¼Œæ¯æ¬¡éƒ½è¦å…ˆè§£å‹ layer åˆ°æœ¬åœ°ï¼Œç„¶åå†å‹ç¼© layer ä¸Šä¼ åˆ°ç§æœ‰ä»“åº“ä¸­ï¼Œä½ èƒ½æƒ³è±¡æ­¤è¿‡ç¨‹èŠ±è´¹çš„æ—¶é—´æœ‰å¤šä¹…å—? å¯¹äºæˆ‘ä»¬è¿ç»´å·¥ç¨‹å¸ˆæ¥è¯´æ—¶é—´å°±æ˜¯é‡‘é’±ï¼Œæ‰€ä»¥éœ€æƒ³å°½ä¸€åˆ‡æ–¹æ³•æ¥èŠ‚çº¦æ—¶é—´æˆæœ¬ï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å¯ä»¥ç›´æ¥å°† registry ä¸Šçš„ blob å¤åˆ¶åˆ°å¦ä¸€ä¸ª registryï¼Œä¸­é—´è¿‡ç¨‹ä¸æ¶‰åŠå¯¹é•œåƒ layer çš„è§£å‹ç¼©ï¼Œè¿™å²‚ä¸ç¾å“‰ã€‚</li>
</ul>
<blockquote>
<p>è§£å†³æ–¹æ¡ˆå½“ç„¶æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨dockerè¿›è¡Œimagesé•œåƒæ‹‰å–ä¸Šä¼ ï¼Œæˆ‘ä»¬å®Œæˆå¯ä»¥ä½¿ç”¨skopeå·¥å…·æ¥å®Œå…¨æ›¿ä»£ docker-cli æ¥æ¬è¿é•œåƒï¼Œskopeoæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œå¯å¯¹å®¹å™¨æ˜ åƒå’Œæ˜ åƒå­˜å‚¨åº“æ‰§è¡Œå„ç§æ“ä½œã€‚</p>
</blockquote>
<a id="more"></a>
<p><strong>ä»€ä¹ˆæ˜¯ Skopeo ?</strong></p>
<p>skopeo ä½¿ç”¨ API V2 Registryï¼Œä¾‹å¦‚ Docker Registryã€Atomic Registryã€ç§æœ‰Registryã€æœ¬åœ°ç›®å½•å’Œæœ¬åœ° OCI é•œåƒç›®å½•ã€‚skopeo ä¸éœ€è¦è¿è¡Œå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒå¯ä»¥æ‰§è¡Œçš„æ“ä½œåŒ…æ‹¬ï¼š</p>
<ul>
<li>é€šè¿‡å„ç§å­˜å‚¨æœºåˆ¶å¤åˆ¶é•œåƒï¼Œä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦ç‰¹æƒçš„æƒ…å†µä¸‹å°†é•œåƒä»ä¸€ä¸ª Registry å¤åˆ¶åˆ°å¦ä¸€ä¸ª Registry</li>
<li>æ£€æµ‹è¿œç¨‹é•œåƒå¹¶æŸ¥çœ‹å…¶å±æ€§ï¼ŒåŒ…æ‹¬å…¶å›¾å±‚ï¼Œæ— éœ€å°†é•œåƒæ‹‰åˆ°æœ¬åœ°</li>
<li>ä»é•œåƒåº“ä¸­åˆ é™¤é•œåƒ</li>
<li>å½“å­˜å‚¨åº“éœ€è¦æ—¶ï¼Œskopeo å¯ä»¥ä¼ é€’é€‚å½“çš„å‡­æ®å’Œè¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯</li>
</ul>
<p><strong>é•œåƒå­˜å‚¨ç‰¹ç‚¹</strong></p>
<p>æ ¹æ® Robin å¤§ä½¬åœ¨ ã€Šé•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æã€‹æ–‡ç« é‡Œå¾—å‡ºçš„ç»“è®ºï¼š</p>
<ul>
<li>
<p>é€šè¿‡ Registry API è·å¾—çš„ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚</p>
</li>
<li>
<p>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</p>
</li>
<li>
<p>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ blob ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒ</p>
</li>
</ul>
<p><strong>é¡¹ç›®ä¿¡æ¯</strong></p>
<ul>
<li>Github å®˜æ–¹åœ°å€: <a href="https://github.com/containers/skopeo" target="_blank" rel="noopener">https://github.com/containers/skopeo</a></li>
<li>Gitee mirror: <a href="https://gitee.com/mirrors/skopeo" target="_blank" rel="noopener">https://gitee.com/mirrors/skopeo</a></li>
</ul>
<h2><span id="2-å®‰è£…ç¼–è¯‘">2. å®‰è£…ç¼–è¯‘</span></h2>
<p>æè¿°: Skopeo å®˜æ–¹å®‰è£…&amp;ç¼–è¯‘æ–¹å¼å‚è€ƒæ–‡æ¡£: <a href="https://github.com/containers/skopeo/blob/main/install.md" target="_blank" rel="noopener">https://github.com/containers/skopeo/blob/main/install.md</a></p>
<p>æœ¬èŠ‚å®‰è£…å®è·µç¯å¢ƒå°†åœ¨ Ubuntu 20.04 LTS ä»¥åŠ docker 20.10.12 ä¸­è¿›è¡Œå®è·µæºç ç¼–è¯‘ä»¥åŠ apt ä»“åº“æºä¸‹è½½å®‰è£…å®è·µã€‚</p>
<h3><span id="21-æºç ç¼–è¯‘é™æ€">2.1 æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰</span></h3>
<p>æè¿°: è¦æ„å»º skopeo äºŒè¿›åˆ¶æ–‡ä»¶æ‚¨è‡³å°‘éœ€è¦ Go 1.12 ç‰ˆæœ¬ä»¥ä¸Š, å…¶æ¬¡æ„å»º skopeo æœ‰ä¸¤ç§æ–¹æ³•ï¼Œå³<code>åœ¨å®¹å™¨ä¸­</code>æˆ–è€…åœ¨æœ¬åœ°ç¯å¢ƒä¸­æ„å»º(å®‰è£…ç¯å¢ƒè¾ƒä¸ºå¤æ‚), æ­¤å¤„ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºå°†é‡‡ç”¨å®¹å™¨æ–¹å¼è¿›è¡Œç¼–è¯‘æ„å»ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 1.æ‹‰å–skopeoæºç åˆ°æœ¬åœ°</span><br><span class="line">$ git clone --depth&#x3D;1 https:&#x2F;&#x2F;github.com&#x2F;containers&#x2F;skopeo.git  # https:&#x2F;&#x2F;github.com&#x2F;containers&#x2F;skopeo.git</span><br><span class="line">$ cd skopeo</span><br><span class="line">$ sed -i &#39;s#proxy.golang.org#https:&#x2F;&#x2F;goproxy.cn#g&#39; skopeo&#x2F;Makefile</span><br><span class="line"></span><br><span class="line"># 2.ä¸‹è½½é•œåƒæ„å»ºä¾èµ–</span><br><span class="line">$ sudo apt-get install go-md2man  # æ„å»ºæ‰‹å†Œä¾èµ–äº go-md2manã€‚</span><br><span class="line">$ whereis go-md2man  # è·å¾—æœ¬æœºä¸­go-md2manè·¯å¾„ã€‚</span><br><span class="line"></span><br><span class="line"># 3.æ„å»ºé™æ€äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">$ BUILD_IMAGE&#x3D;&quot;golang:latest&quot;</span><br><span class="line">$ docker run --name skopeo-build -v $PWD:&#x2F;src -v &#x2F;usr&#x2F;bin&#x2F;go-md2man:&#x2F;go&#x2F;bin&#x2F;go-md2man -w &#x2F;src -e CGO_ENABLED&#x3D;0 -e GOPROXY&#x3D;https:&#x2F;&#x2F;goproxy.cn,direct $&#123;BUILD_IMAGE&#125; \</span><br><span class="line">sh -c &#39;make BUILDTAGS&#x3D;containers_image_openpgp GO_DYN_FLAGS&#x3D;&#39;</span><br><span class="line">  # CGO_CFLAGS&#x3D;&quot;&quot; CGO_LDFLAGS&#x3D;&quot;&quot; GO111MODULE&#x3D;on go build -mod&#x3D;vendor  -ldflags &#39;-X main.gitCommit&#x3D;df4d82b960572c19e9333381a203c0ac475766d7 &#39; -gcflags &quot;&quot; -tags  &quot;containers_image_openpgp&quot; -o bin&#x2F;skopeo .&#x2F;cmd&#x2F;skopeo</span><br><span class="line"></span><br><span class="line"># 4.è¿è¡Œç¼–è¯‘ç”Ÿæˆçš„skopeoå¯æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">$ cd .&#x2F;bin # &#x2F;opt&#x2F;software&#x2F;skopeo&#x2F;bin</span><br><span class="line">$ .&#x2F;skopeo --help</span><br><span class="line">  # Various operations with container images and container image registries</span><br><span class="line">  # .......</span><br><span class="line">  # Use &quot;skopeo [command] --help&quot; for more information about a command.</span><br></pre></td></tr></table></figure>
<p><strong>æ„å»ºå…³é”®å‚æ•°è§£æ:</strong></p>
<ul>
<li>CGO_ENABLED=0 : è®¾ç½®è¯¥ç¯å¢ƒå˜é‡, ç¦ç”¨ CGO ä¼šå¯¼è‡´ Go åœ¨å¯èƒ½çš„æƒ…å†µä¸‹æ›´å–œæ¬¢é™æ€è¿æ¥åº“ï¼Œè€Œä¸æ˜¯åŠ¨æ€é“¾æ¥åˆ°ç³»ç»Ÿåº“ (è§£å†³å¯ä»¥åœ¨Ubuntuæˆ–è€…å…¶å®ƒlinuxå‘è¡Œç‰ˆä¸­æ‰§è¡Œç¼–è¯‘åäºŒè¿›åˆ¶æ–‡ä»¶)ã€‚</li>
<li>GOPROXY=https://goproxy.cn,direct : Golong ä¾èµ–ä¸‹è½½é•œåƒç«™,åŠ å¿«go getä¾èµ–æ‹‰æ‹‰å–ã€‚</li>
<li>BUILDTAGS=containers_image_openpgp : è®¾ç½®è¯¥makeå‚æ•°æ¶ˆé™¤äº†å¯¹libgpgme åŠå…¶é…å¥—åº“çš„ä¾èµ–, Skopeo çš„ä¸€äº›ç‰¹æ€§ä¾èµ–äºé Go åº“ï¼Œä¾‹å¦‚ libgpgme å’Œ libdevmapperã€‚</li>
<li>GO_DYN_FLAGS= : æ¸…ç©ºè¯¥makeå‚æ•° (å¦åˆ™ä¼šå¼ºåˆ¶åˆ›å»ºåŠ¨æ€å¯æ‰§è¡Œæ–‡ä»¶)</li>
</ul>
<h3><span id="22-åˆ†å‘åŒ…å®‰è£…">2.2 åˆ†å‘åŒ…å®‰è£…</span></h3>
<p>æè¿°: skopeo å¯èƒ½å·²ç»æ‰“åŒ…åœ¨æ‚¨çš„å‘è¡Œç‰ˆä¸­ï¼Œæ­¤å¤„ä»¥ ubuntu 20.04 ä¸ºä¾‹è¿›è¡Œå®‰è£…ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 1.åªæ”¯æŒ Ubuntu 20.10 and newer å‘è¡Œç‰ˆ </span><br><span class="line">$ sudo apt-get -y update</span><br><span class="line">$ sudo apt-get -y install skopeo</span><br><span class="line"></span><br><span class="line"># 2.ä½† Kubic é¡¹ç›®ä¸º Ubuntu 20.04 æä¾›äº†è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼åœ¨æˆ‘ä»¬åŠå…¶ä¸Šè¿›è¡Œå®‰è£…ã€‚</span><br><span class="line">$ . &#x2F;etc&#x2F;os-release</span><br><span class="line">$ echo &quot;deb https:&#x2F;&#x2F;download.opensuse.org&#x2F;repositories&#x2F;devel:&#x2F;kubic:&#x2F;libcontainers:&#x2F;stable&#x2F;xUbuntu_$&#123;VERSION_ID&#125;&#x2F; &#x2F;&quot; | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;devel:kubic:libcontainers:stable.list</span><br><span class="line">$ curl -L https:&#x2F;&#x2F;download.opensuse.org&#x2F;repositories&#x2F;devel:&#x2F;kubic:&#x2F;libcontainers:&#x2F;stable&#x2F;xUbuntu_$&#123;VERSION_ID&#125;&#x2F;Release.key | sudo apt-key add -</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get -y upgrade</span><br><span class="line">$ sudo apt-get -y install skopeo</span><br></pre></td></tr></table></figure>
<h3><span id="23-å®¹å™¨å®‰è£…è¿è¡Œ">2.3 å®¹å™¨å®‰è£…è¿è¡Œ</span></h3>
<p>Skopeo å®¹å™¨é•œåƒå¯åœ¨ <a href="http://quay.io/skopeo/stable:latest" target="_blank" rel="noopener">quay.io/skopeo/stable:latest</a> è·å¾—, ä¾‹å¦‚æˆ‘ä»¬é‡‡ç”¨podmanå‘½ä»¤è¿›è¡Œå¦‚ä¸‹æ“ä½œ:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman run docker:&#x2F;&#x2F;quay.io&#x2F;skopeo&#x2F;stable:latest copy --help</span><br></pre></td></tr></table></figure>
<h2><span id="3-å¿«é€Ÿä¸Šæ‰‹">3. å¿«é€Ÿä¸Šæ‰‹</span></h2>
<h3><span id="31-å‘½ä»¤æµ…æ">3.1 å‘½ä»¤æµ…æ</span></h3>
<p>æè¿°: skopen æ˜¯æ“ä½œå„ç§å®¹å™¨æ˜ åƒå’Œå®¹å™¨æ˜ åƒä»“åº“çš„å·¥å…·ï¼Œå…¶ä½¿ç”¨æ–¹æ³•åŠå…¶å¯ç”¨å‘½ä»¤å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;skopeo --help    # å­å‘½ä»¤å¯é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤ skopeo [command] --help å‘½ä»¤</span><br><span class="line">Usage:</span><br><span class="line">  skopeo [flags]</span><br><span class="line">  skopeo [command]</span><br><span class="line">Available Commands: </span><br><span class="line">  copy          # å¤åˆ¶ä¸€ä¸ªé•œåƒä» A åˆ° Bï¼Œè¿™é‡Œçš„ A å’Œ B å¯ä»¥ä¸ºæœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒï¼›</span><br><span class="line">  delete        # åˆ é™¤ä¸€ä¸ªé•œåƒ tagï¼Œå¯ä»¥æ˜¯æœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒï¼›</span><br><span class="line">  help          # å¸®åŠ©æŸ¥çœ‹</span><br><span class="line">  inspect       # æŸ¥çœ‹ä¸€ä¸ªé•œåƒçš„ manifest æˆ–è€… image config è¯¦ç»†ä¿¡æ¯ï¼›</span><br><span class="line">  list-tags     # åˆ—å‡ºå­˜å‚¨åº“åç§°æŒ‡å®šçš„é•œåƒçš„tag</span><br><span class="line">  login           # ç™»é™†æŸä¸ªé•œåƒä»“åº“,ç±»ä¼¼äº docker login å‘½ä»¤</span><br><span class="line">  logout          # é€€å‡ºæŸä¸ªå·²è®¤è¯çš„é•œåƒä»“åº“, ç±»ä¼¼äº docker logout å‘½ä»¤</span><br><span class="line">  manifest-digest # è®¡ç®—æ–‡ä»¶çš„æ¸…å•æ‘˜è¦æ˜¯ä¸€ä¸ªsha256sum å€¼</span><br><span class="line">  standalone-sign   # ä½¿ç”¨æœ¬åœ°æ–‡ä»¶åˆ›å»ºç­¾å</span><br><span class="line">  standalone-verify # éªŒè¯æœ¬åœ°æ–‡ä»¶çš„ç­¾å</span><br><span class="line">  sync              # å°†ä¸€ä¸ªæˆ–å¤šä¸ªå›¾åƒä»ä¸€ä¸ªä½ç½®åŒæ­¥åˆ°å¦ä¸€ä¸ªä½ç½® (è¯¥åŠŸèƒ½éå¸¸Nice)</span><br><span class="line">Flags:</span><br><span class="line">    --command-timeout duration   # å‘½ä»¤è¶…æ—¶æ—¶é—´(å•ä½ç§’)</span><br><span class="line">    --debug                      # å¯ç”¨debugæ¨¡å¼</span><br><span class="line">    --insecure-policy            # åœ¨ä¸è¿›è¡Œä»»ä½•ç­–ç•¥æ£€æŸ¥çš„æƒ…å†µä¸‹è¿è¡Œè¯¥å·¥å…·ï¼ˆå¦‚æœæ²¡æœ‰é…ç½® policy çš„è¯éœ€è¦åŠ ä¸Šè¯¥å‚æ•°ï¼‰</span><br><span class="line">    --override-arch ARCH         # å¤„ç†é•œåƒæ—¶è¦†ç›–å®¢æˆ·ç«¯ CPU ä½“ç³»æ¶æ„ï¼Œå¦‚åœ¨ amd64 çš„æœºå™¨ä¸Šç”¨ skopeo å¤„ç† arm64 çš„é•œåƒ</span><br><span class="line">    --override-os OS             # å¤„ç†é•œåƒæ—¶è¦†ç›–å®¢æˆ·ç«¯ OS</span><br><span class="line">    --override-variant VARIANT   # å¤„ç†é•œåƒæ—¶ä½¿ç”¨VARIANTè€Œä¸æ˜¯è¿è¡Œæ¶æ„å˜é‡</span><br><span class="line">    --policy string              # ä¿¡ä»»ç­–ç•¥æ–‡ä»¶çš„è·¯å¾„ (ä¸ºé•œåƒé…ç½®å®‰å…¨ç­–ç•¥æƒ…å†µä¸‹ä½¿ç”¨)</span><br><span class="line">    --registries.d DIR           # åœ¨ç›®å½•ä¸­ä½¿ç”¨Registryé…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œç”¨äºå®¹å™¨ç­¾åå­˜å‚¨ï¼‰</span><br><span class="line">    --tmpdir string              # ç”¨äºå­˜å‚¨ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•</span><br><span class="line">-h, --help                       help for skopeo </span><br><span class="line">-v, --version                    Version for Skopeo</span><br></pre></td></tr></table></figure>
<h3><span id="32-skopeo-åˆä½“éªŒ">3.2 Skopeo åˆä½“éªŒ</span></h3>
<p>æè¿°: åœ¨ä½¿ç”¨ä½“éªŒskopeoä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€å“ˆ Skopeo å¯ä»¥åœ¨é‚£äº›å›¾åƒå’Œå­˜å‚¨åº“ç±»å‹ä¸Šæ‰§è¡Œé•œåƒæ“ä½œ(å®˜ç½‘æ–‡æ¡£èµ°ä¸€æ³¢)ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Repository types</th>
<th>Describe</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>containers-storage:docker-reference</code></td>
<td>é€‚ç”¨äºåç«¯æ˜¯ Podman, CRI-O, Buildah çš„æƒ…å†µ</td>
<td><code>containers-storage:</code></td>
</tr>
<tr>
<td style="text-align:center"><code>dir:path</code></td>
<td>é€‚ç”¨äºå°†manifest, layer tarballs å’Œ signatures å­˜å‚¨ä¸ºå•ç‹¬æ–‡ä»¶çš„ç°æœ‰æœ¬åœ°ç›®å½•è·¯å¾„çš„æƒ…å†µ</td>
<td><code>dir:/tmp/alpine:latest</code></td>
</tr>
<tr>
<td style="text-align:center"><code>docker://docker-reference</code></td>
<td>é€‚ç”¨äºRegistryä¸­å®ç°&quot;Docker Registry HTTP API V2&quot;çš„é•œåƒçš„æƒ…å†µ</td>
<td><code>docker://harbor.weiyigeek.top/myblog:v2.8</code></td>
</tr>
<tr>
<td style="text-align:center"><code>docker-archive:path[:docker-reference]</code></td>
<td>é€‚ç”¨äºé‡‡ç”¨<code>docker save</code>å‘½ä»¤å¯¼å‡ºé•œåƒä»¥taræ ¼å¼å­˜å‚¨çš„æ–‡ä»¶çš„æƒ…å†µ</td>
<td><code>docker-archive:alpine.tar</code></td>
</tr>
<tr>
<td style="text-align:center"><code>docker-daemon:docker-reference</code></td>
<td>é€‚ç”¨äºå­˜å‚¨åœ¨ docker å®ˆæŠ¤è¿›ç¨‹å†…éƒ¨å­˜å‚¨ä¸­çš„å›¾åƒçš„æƒ…å†µ</td>
<td><code>docker-daemon:alpine:latest</code></td>
</tr>
<tr>
<td style="text-align:center"><code>oci:path:tag</code></td>
<td>é€‚ç”¨äºç¬¦åˆ&quot;Open Container Image Layout Specification&quot;çš„ç›®å½•ä¸­çš„å›¾åƒæ ‡è®°</td>
<td><code>oci:alpine:latest</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ¸©é¦¨æç¤º: åŒä¸€ä¸ªé•œåƒå­˜åœ¨çš„æ–¹å¼æœ‰å¯èƒ½ä¸åŒï¼Œä¸åŒç±»å‹æ–¹å¼å­˜å‚¨å¯¹é•œåƒçš„ layer å¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·,ã€‚</p>
</blockquote>
<p><strong>æµ‹è¯•ç¯å¢ƒè¯´æ˜</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Docker å®˜æ–¹ hub ä»“åº“ -&gt; docker.io             # å®˜ç½‘åœ°å€: https:&#x2F;&#x2F;hub.docker.com&#x2F;</span><br><span class="line">ç§æœ‰ Harbor ä»“åº“     -&gt; harbor.weiyigeek.top</span><br><span class="line">ä¸´æ—¶åˆ›å»ºçš„æœ¬åœ°ä»“åº“    -&gt; 192.168.12.111:5000   # ä¸€æ¢­å­è§£å†³: docker run -d -p 5000:5000 --name registry -v &#x2F;opt&#x2F;data&#x2F;registry:&#x2F;var&#x2F;lib&#x2F;registry registry:2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¯´æ˜: ä¸Šè¿°ä»“åº“éƒ½æ˜¯åœ¨Registryä¸­æ”¯æŒDocker Registry HTTP API V2ç‰ˆæœ¬çš„ã€‚</p>
</blockquote>
<h4><span id="321-skopeo-loginloout-è¿œç¨‹ä»“åº“-auth">3.2.1 Skopeo login/loout - è¿œç¨‹ä»“åº“ Auth</span></h4>
<p>æè¿°: åœ¨ä½¿ç”¨ skopeo å‰å¦‚æœ src æˆ– dest é•œåƒæ˜¯åœ¨ registry ä»“åº“ä¸­çš„å¹¶ä¸”é…ç½®äº†é public çš„é•œåƒéœ€è¦ç›¸åº”çš„ auth è®¤è¯, æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker login</code> æˆ–è€… <code>skopeo login</code> çš„æ–¹å¼ç™»å½•åˆ° registry ä»“åº“ï¼Œç„¶åé»˜è®¤ä¼šåœ¨<code>~/.docker</code>ç›®å½•ä¸‹ç”Ÿæˆ registry ç™»å½•é…ç½®æ–‡ä»¶ config.json ,è¯¥æ–‡ä»¶é‡Œä¿å­˜äº†ç™»å½•éœ€è¦çš„éªŒè¯ä¿¡æ¯ï¼Œskopeo æ‹¿åˆ°è¯¥éªŒè¯ä¿¡æ¯æ‰æœ‰æƒé™å¾€ registry push é•œåƒã€‚</p>
<ul>
<li><strong>ç™»é™†è®¤è¯</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># (1) skopeo login ç™»é™†ç¤ºä¾‹ (ä¸¤ç§æ–¹å¼)</span><br><span class="line">$ skopeo login -u WeiyiGeek -p testpassword harbor.weiyigeek.top</span><br><span class="line">  # Login Succeeded!</span><br><span class="line"></span><br><span class="line"># (2) docker login ç™»é™†ç¤ºä¾‹</span><br><span class="line">$ docker login -u WeiyiGeek docker.io</span><br><span class="line">$ docker login -u WeiyiGeek harbor.weiyigeek.top</span><br><span class="line">$ docker login -u anonymous -p anonymous 192.168.12.111:5000  # å®é™…ä¸Šä¸´æ—¶ä»“åº“æ²¡æœ‰é…ç½®è®¤è¯, è´¦å·å¯†ç éšæ„å³å¯ã€‚</span><br><span class="line">  # WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">  # WARNING! Your password will be stored unencrypted in &#x2F;root&#x2F;.docker&#x2F;config.json.</span><br><span class="line">  # Configure a credential helper to remove this warning. See</span><br><span class="line">  # https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;reference&#x2F;commandline&#x2F;login&#x2F;#credentials-store</span><br><span class="line">  # Login Succeeded</span><br><span class="line"></span><br><span class="line"># (3) docker login ç”Ÿæˆçš„ registry ç™»å½•é…ç½®æ–‡ä»¶ï¼ˆbase64ç¼–ç å®‰å…¨æ€§ä¸å¤šè¯´ï¼‰</span><br><span class="line">$ cat ~&#x2F;.docker&#x2F;config.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;auths&quot;: &#123;</span><br><span class="line">    &quot;192.168.12.111:5000&quot;: &#123;</span><br><span class="line">        &quot;auth&quot;: &quot;YW5v*******Q&#x3D;&#x3D;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">    &quot;harbor.weiyigeek.top&quot;: &#123;</span><br><span class="line">        &quot;auth&quot;: &quot;YWR*******LkA&#x3D;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">    &quot;https:&#x2F;&#x2F;index.docker.io&#x2F;v1&#x2F;&quot;: &#123;</span><br><span class="line">        &quot;auth&quot;: &quot;d2Vp**************kyZA&#x3D;&#x3D;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ³¨é”€è®¤è¯</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo logout myregistrydomain.com:5000</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ¸©é¦¨æç¤º: å¦‚æœä¼ä¸šè‡ªå»ºharborä»“åº“(ä¸€èˆ¬éƒ½ä¼šè®¾ç½®è‡ªç­¾è¯ä¹¦)æˆ–è€…å…¶å®ƒç§æœ‰ä»“åº“é…ç½®è¯ä¹¦,ä¸ºäº†é˜²æ­¢å‡ºé”™å»ºè®®è¿›è¡Œä»¥ä¸‹æ“ä½œ(æ­£å¼ç¯å¢ƒè¯·æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®)ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># (1) åœ¨ &#x2F;etc&#x2F;docker&#x2F;daemon.json ä¸­é…ç½® insecure-registries å­—æ®µ,è¡¨ç¤ºå…è®¸ä¸å®‰å…¨çš„ä»“åº“ã€‚</span><br><span class="line">&quot;insecure-registries&quot;: [&quot;harbor.weiyigeek.top&quot;,&quot;192.168.12.111:5000&quot;]</span><br><span class="line"> </span><br><span class="line"># (2) ä»å®˜æ–¹æ–‡æ¡£å¯çŸ¥å®¢æˆ·ç«¯è¦ä½¿ç”¨tlsä¸Harboré€šä¿¡ä½¿ç”¨çš„è¿˜æ˜¯&#96;è‡ªç­¾è¯ä¹¦&#96;ï¼Œé‚£ä¹ˆå¿…é¡»å»ºç«‹ä¸€ä¸ªç›®å½•ï¼š&#96;&#x2F;etc&#x2F;docker&#x2F;certs.d&#96;</span><br><span class="line"># å¦‚æœé…ç½®å¯èƒ½ä¼šå‡ºç° x509: certificate signed by unknown authority é”™è¯¯æç¤ºã€‚</span><br><span class="line">$ mkdir -vp &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;harbor.weiyigeek.top</span><br><span class="line">$ cp -a &#x2F;deployapp&#x2F;harbor&#x2F;harbor.pem  &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;harbor.weiyigeek.top&#x2F;harbor.crt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ¸©é¦¨æç¤º: ä¸ºäº†é˜²æ­¢åç»­æ‰§è¡Œ skopeo å‘½ä»¤æ“ä½œé•œåƒæ—¶å‡ºé”™, å»ºè®®å¿½ç•¥ policy ç­–ç•¥å’Œè¯ä¹¦æ ¡éªŒå‚æ•°å¦‚ä¸‹:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--insecure-policy \</span><br><span class="line">--src-tls-verify&#x3D;false \ </span><br><span class="line">--dest-tls-verify&#x3D;false \</span><br></pre></td></tr></table></figure>
<h4><span id="322-skopeo-inspect-æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ">3.2.2 Skopeo inspect - æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ</span></h4>
<p>æè¿°: skopeo èƒ½å¤Ÿæ£€æŸ¥å®¹å™¨ Registry ä¸Šçš„å­˜å‚¨åº“å¹¶è·å–å›¾åƒå±‚ã€‚æ£€æŸ¥å‘½ä»¤è·å–å­˜å‚¨åº“çš„æ¸…å•ï¼Œå®ƒèƒ½å¤Ÿå‘æ‚¨æ˜¾ç¤ºæœ‰å…³æ•´ä¸ªå­˜å‚¨åº“æˆ–æ ‡ç­¾çš„ç±»ä¼¼ <code>docker inspect</code> çš„ json è¾“å‡ºã€‚ä¸ docker inspect ç›¸æ¯”,æ­¤å·¥å…·å¯å¸®åŠ©æ‚¨åœ¨æ‹‰å–å­˜å‚¨åº“æˆ–æ ‡ç­¾ä¹‹å‰æ”¶é›†æœ‰ç”¨çš„ä¿¡æ¯(ä½¿ç”¨ç£ç›˜ç©ºé—´), æ£€æŸ¥å‘½ä»¤å¯ä»¥å‘æ‚¨æ˜¾ç¤ºç»™å®šå­˜å‚¨åº“å¯ç”¨çš„æ ‡ç­¾ã€æ˜ åƒå…·æœ‰çš„æ ‡ç­¾ã€æ˜ åƒçš„åˆ›å»ºæ—¥æœŸå’Œæ“ä½œç³»ç»Ÿç­‰ã€‚</p>
<p>æ”¯æŒä¼ è¾“çš„ç±»å‹ : <code>containers-storage, dir, docker, docker-archive, docker-daemon, oci, oci-archive, ostree, tarball</code></p>
<ul>
<li>æ­¥éª¤ 01. æ˜¾ç¤º busybox:latest é•œåƒçš„å±æ€§ç›¸å…³ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo inspect docker:&#x2F;&#x2F;docker.io&#x2F;busybox:latest</span><br><span class="line">&#123;</span><br><span class="line">  &quot;Name&quot;: &quot;docker.io&#x2F;library&#x2F;busybox&quot;,</span><br><span class="line">  &quot;Digest&quot;: &quot;sha256:5acba83a746c7608ed544dc1533b87c737a0b0fb730301639a0179f9344b1678&quot;,</span><br><span class="line">  &quot;RepoTags&quot;: [</span><br><span class="line">      &quot;1&quot;,</span><br><span class="line">      &quot;1-glibc&quot;,</span><br><span class="line">      &quot;1-musl&quot;,</span><br><span class="line">      &quot;1-ubuntu&quot;,</span><br><span class="line">      &quot;1-uclibc&quot;,</span><br><span class="line">      &quot;1.21-ubuntu&quot;,</span><br><span class="line">      &quot;1.21.0-ubuntu&quot;,</span><br><span class="line">        .......          # é•œåƒå†å²tags</span><br><span class="line">      &quot;unstable-uclibc&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;Created&quot;: &quot;2021-12-30T19:19:41.006954958Z&quot;,</span><br><span class="line">  &quot;DockerVersion&quot;: &quot;20.10.7&quot;,</span><br><span class="line">  &quot;Labels&quot;: null,</span><br><span class="line">  &quot;Architecture&quot;: &quot;amd64&quot;,</span><br><span class="line">  &quot;Os&quot;: &quot;linux&quot;,</span><br><span class="line">  &quot;Layers&quot;: [</span><br><span class="line">      &quot;sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;Env&quot;: [</span><br><span class="line">      &quot;PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤ 02. æ˜¾ç¤º busybox:latest é•œåƒçš„å®¹å™¨é…ç½®ç›¸å…³ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo inspect --config docker:&#x2F;&#x2F;docker.io&#x2F;busybox:latest  | jq</span><br><span class="line">&#123;</span><br><span class="line">  &quot;created&quot;: &quot;2021-12-30T19:19:41.006954958Z&quot;,</span><br><span class="line">  &quot;architecture&quot;: &quot;amd64&quot;,</span><br><span class="line">  &quot;os&quot;: &quot;linux&quot;,</span><br><span class="line">  &quot;config&quot;: &#123;</span><br><span class="line">    &quot;Env&quot;: [</span><br><span class="line">      &quot;PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;Cmd&quot;: [</span><br><span class="line">      &quot;sh&quot;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;rootfs&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;layers&quot;,</span><br><span class="line">    &quot;diff_ids&quot;: [</span><br><span class="line">      &quot;sha256:01fd6df81c8ec7dd24bbbd72342671f41813f992999a3471b9d9cbc44ad88374&quot;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;history&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;created&quot;: &quot;2021-12-30T19:19:40.833034683Z&quot;,</span><br><span class="line">      &quot;created_by&quot;: &quot;&#x2F;bin&#x2F;sh -c #(nop) ADD file:6db446a57cbd2b7f4cfde1f280177b458390ed5a6d1b54c6169522bc2c4d838e in &#x2F; &quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;created&quot;: &quot;2021-12-30T19:19:41.006954958Z&quot;,</span><br><span class="line">      &quot;created_by&quot;: &quot;&#x2F;bin&#x2F;sh -c #(nop)  CMD [\&quot;sh\&quot;]&quot;,</span><br><span class="line">      &quot;empty_layer&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤ 03. æ˜¾ç¤ºæœªç»éªŒè¯çš„å›¾åƒ Digestï¼ˆæ‘˜è¦ï¼‰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo inspect --format &quot;Name: &#123;&#123;.Name&#125;&#125; Digest: &#123;&#123;.Digest&#125;&#125;&quot; docker:&#x2F;&#x2F;docker.io&#x2F;busybox:latest</span><br></pre></td></tr></table></figure>
<h4><span id="323-skopeo-copy-ä»“åº“é•œåƒæ‹·è´">3.2.3 Skopeo copy - ä»“åº“é•œåƒæ‹·è´</span></h4>
<p>æè¿°: skopeo å¯ä»¥åœ¨å„ç§å­˜å‚¨æœºåˆ¶ä¹‹é—´å¤åˆ¶å®¹å™¨é•œåƒï¼Œæ”¯æŒåŒ…æ‹¬å®¹å™¨ä»“åº“(<code>The Quay, Docker Hub, OpenShift, GCR, ï¼ŒArtifactory ...</code>)ä»¥åŠå®¹å™¨å­˜å‚¨åç«¯ (<code>Podman, CRI-O, Docker</code>) ç­‰ã€æœ¬åœ°ç›®å½•ã€æœ¬åœ° OCI-layout ç›®å½•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ­¤å¤„æˆ‘ä» hub ä»“åº“å¤åˆ¶ <code>busybox:latest</code> é•œåƒåˆ°ç§æœ‰ harbor ä»“åº“ä¸­,åœ¨ä»ç§æœ‰ harbor ä»“åº“ä¸­æ‹·è´åˆ°æœ¬åœ°æŒ‡å®šç›®å½•ä¸­ã€‚</p>
<ul>
<li>æ­¥éª¤ 01. ä» regsitry A åˆ° registry B å¤åˆ¶ busybox:latest é•œåƒã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo copy --insecure-policy --src-tls-verify&#x3D;false --dest-tls-verify&#x3D;false --dest-authfile &#x2F;root&#x2F;.docker&#x2F;config.json docker:&#x2F;&#x2F;docker.io&#x2F;busybox:latest docker:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;devops&#x2F;busybox:latest</span><br><span class="line">  # Getting image source signatures</span><br><span class="line">  # Copying blob 5cc84ad355aa done</span><br><span class="line">  # Copying config beae173cca done</span><br><span class="line">  # Writing manifest to image destination</span><br><span class="line">  # Storing signatures</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tips: ç”±ä¸Šè¿°æ—¥å¿—å¯ä»¥çœ‹åˆ° skopeo æ˜¯ç›´æ¥ä» registry ä¸­ copy é•œåƒ layer çš„ blob æ–‡ä»¶ï¼Œä¼ è¾“æ˜¯é•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„åŸå§‹æ ¼å¼ã€‚</p>
</blockquote>
<ul>
<li>æ­¥éª¤ 02. ä» registry B å¤åˆ¶ busybox:latest é•œåƒåˆ°æœ¬åœ° busybox:latest ç›®å½•ä¸­ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo copy --insecure-policy --src-tls-verify&#x3D;false docker:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;devops&#x2F;busybox:latest dir:busybox:latest</span><br><span class="line"># Getting image source signatures</span><br><span class="line"># Copying blob 5cc84ad355aa done</span><br><span class="line"># Copying config beae173cca done</span><br><span class="line"># Writing manifest to image destination</span><br><span class="line"># Storing signatures</span><br><span class="line"></span><br><span class="line">$ ls &amp;&amp; tree busybox\:latest&#x2F;</span><br><span class="line">busybox:latest&#x2F;</span><br><span class="line">â”œâ”€â”€ 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa   # blob å—æ–‡ä»¶ -&gt; vnd.docker.image.rootfs.diff.tar.gzip</span><br><span class="line">â”œâ”€â”€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a   # é•œåƒé…ç½®ä¿¡æ¯æ–‡ä»¶ -&gt; vnd.docker.container.image.v1+json </span><br><span class="line">â”œâ”€â”€ manifest.json</span><br><span class="line">â””â”€â”€ version</span><br><span class="line">0 directories, 4 files</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹é•œåƒçš„ manifest æ–‡ä»¶</span><br><span class="line">$ cat busybox\:latest&#x2F;manifest.json</span><br><span class="line">&#123;</span><br><span class="line">   &quot;schemaVersion&quot;: 2,</span><br><span class="line">   &quot;mediaType&quot;: &quot;application&#x2F;vnd.docker.distribution.manifest.v2+json&quot;,</span><br><span class="line">   &quot;config&quot;: &#123;</span><br><span class="line">      &quot;mediaType&quot;: &quot;application&#x2F;vnd.docker.container.image.v1+json&quot;,</span><br><span class="line">      &quot;size&quot;: 1456,</span><br><span class="line">      &quot;digest&quot;: &quot;sha256:beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;layers&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;mediaType&quot;: &quot;application&#x2F;vnd.docker.image.rootfs.diff.tar.gzip&quot;,</span><br><span class="line">         &quot;size&quot;: 772788,</span><br><span class="line">         &quot;digest&quot;: &quot;sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa&quot;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># æ ¹æ® manifest æ–‡ä»¶æŸ¥çœ‹é•œåƒçš„ image config æ–‡ä»¶ (å­˜æ”¾é•œåƒBuildæŒ‡ä»¤ä¸é•œåƒç›¸å…³é…ç½®ä¿¡æ¯)</span><br><span class="line">$ jq &#39;.&#39; busybox\:latest&#x2F;beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a</span><br><span class="line">&#123;</span><br><span class="line">  &quot;architecture&quot;: &quot;amd64&quot;,</span><br><span class="line">  &quot;config&quot;: &#123;</span><br><span class="line">    &quot;Hostname&quot;: &quot;&quot;,</span><br><span class="line">    &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">    &quot;User&quot;: &quot;&quot;,</span><br><span class="line">    &quot;AttachStdin&quot;: false,</span><br><span class="line">    &quot;AttachStdout&quot;: false,</span><br><span class="line">    &quot;AttachStderr&quot;: false,</span><br><span class="line">    &quot;Tty&quot;: false,</span><br><span class="line">    &quot;OpenStdin&quot;: false,</span><br><span class="line">    &quot;StdinOnce&quot;: false,</span><br><span class="line">    &quot;Env&quot;: [</span><br><span class="line">      &quot;PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;Cmd&quot;: [</span><br><span class="line">      &quot;sh&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;Image&quot;: &quot;sha256:da658412c37aa24e561eb7e16c61bc82a9711340d8fb5cf1a8f39d8e96d7f723&quot;,</span><br><span class="line">    &quot;Volumes&quot;: null,</span><br><span class="line">    &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">    &quot;Entrypoint&quot;: null,</span><br><span class="line">    &quot;OnBuild&quot;: null,</span><br><span class="line">    &quot;Labels&quot;: null</span><br><span class="line">  &#125;,</span><br><span class="line">........</span><br><span class="line">  &quot;history&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;created&quot;: &quot;2021-12-30T19:19:40.833034683Z&quot;,</span><br><span class="line">      &quot;created_by&quot;: &quot;&#x2F;bin&#x2F;sh -c #(nop) ADD file:6db446a57cbd2b7f4cfde1f280177b458390ed5a6d1b54c6169522bc2c4d838e in &#x2F; &quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;created&quot;: &quot;2021-12-30T19:19:41.006954958Z&quot;,</span><br><span class="line">      &quot;created_by&quot;: &quot;&#x2F;bin&#x2F;sh -c #(nop)  CMD [\&quot;sh\&quot;]&quot;,</span><br><span class="line">      &quot;empty_layer&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;os&quot;: &quot;linux&quot;,</span><br><span class="line">  &quot;rootfs&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;layers&quot;,</span><br><span class="line">    &quot;diff_ids&quot;: [</span><br><span class="line">      &quot;sha256:01fd6df81c8ec7dd24bbbd72342671f41813f992999a3471b9d9cbc44ad88374&quot;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤ 03. å°† busybox:latest é•œåƒä» registry B å¤åˆ¶åˆ°æœ¬åœ°ç›®å½•ï¼Œå¹¶ä»¥ OCI æ ¼å¼ä¿å­˜</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo copy --insecure-policy --src-tls-verify&#x3D;false docker:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;devops&#x2F;busybox:latest oci:busybox-latest</span><br><span class="line">  # Getting image source signatures</span><br><span class="line">  # Copying blob 5cc84ad355aa done</span><br><span class="line">  # Copying config 48edd9298a done</span><br><span class="line">  # Writing manifest to image destination</span><br><span class="line">  # Storing signatures</span><br><span class="line"></span><br><span class="line">$ tree -h busybox-latest&#x2F;</span><br><span class="line">  # busybox-latest&#x2F;</span><br><span class="line">  # â”œâ”€â”€ [4.0K]  blobs</span><br><span class="line">  # â”‚   â””â”€â”€ [4.0K]  sha256</span><br><span class="line">  # â”‚       â”œâ”€â”€ [ 347]  1612e16ff3f6b0d09eefdc4e9d5c5c0624f63032743e016585b095b958778016</span><br><span class="line">  # â”‚       â”œâ”€â”€ [ 575]  48edd9298a25de2c97cd574a5523026f87576c6b7202330a2b60ce7d304ec307</span><br><span class="line">  # â”‚       â””â”€â”€ [755K]  5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa  # Blob å— -</span><br><span class="line">  # â”œâ”€â”€ [ 186]  index.json</span><br><span class="line">  # â””â”€â”€ [  31]  oci-layout</span><br><span class="line">  # 2 directories, 5 files</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤ 04. å°† <code>alpine:3.13.1</code> é•œåƒä» docker æœ¬åœ°å­˜å‚¨ï¼ˆ /var/lib/docker/imageï¼‰ push åˆ° registry Bä¸­(å®é™…ä¸Šæ›¿ä»£ docker push åŠŸèƒ½)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨  &#x2F;var&#x2F;lib&#x2F;docker&#x2F; ç›®å½•ä¸­æ­¤å¤„ä¸»è¦å…³å¿ƒ image (ä¸»è¦å­˜æ”¾é•œåƒä¸­layerå±‚çš„å…ƒæ•°æ®) å’Œ overlay2 (å„å±‚çš„å…·ä½“ä¿¡æ¯)</span><br><span class="line">$ docker images alpine:3.13.1</span><br><span class="line">  # REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">  # alpine       3.13.1    e50c909a8df2   11 months ago   5.61MB</span><br><span class="line"></span><br><span class="line">$ skopeo copy --insecure-policy --dest-tls-verify&#x3D;false --dest-authfile &#x2F;root&#x2F;.docker&#x2F;config.json docker-daemon:alpine:3.13.1 docker:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;devops&#x2F;alpine:3.13.1</span><br><span class="line">  # Getting image source signatures</span><br><span class="line">  # Copying blob 1119ff37d4a9 done</span><br><span class="line">  # Copying config e50c909a8d done</span><br><span class="line">  # Writing manifest to image destination</span><br><span class="line">  # Storing signatures</span><br></pre></td></tr></table></figure>
<p><img src="https://img.hi-linux.com/staticfile/640-20220520095506113-2022-05-20-jxlRy3.png" alt></p>
<h4><span id="324-skopeo-sync-é•œåƒåŒæ­¥å‘½ä»¤">3.2.4 Skopeo sync - é•œåƒåŒæ­¥å‘½ä»¤</span></h4>
<p>æè¿°: Skopeo syncå¯ä»¥åœ¨å®¹å™¨ä»“åº“å’Œæœ¬åœ°ç›®å½•ä¹‹é—´åŒæ­¥é•œåƒï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºé˜¿é‡Œäº‘çš„ image-syncer (<a href="https://github.com/AliyunContainerService/image-syncer" target="_blank" rel="noopener">https://github.com/AliyunContainerService/image-syncer</a>) å·¥å…·, å®é™…ä¸Šå…¶æ¯” image-syncer æ›´å¼ºå¤§ã€çµæ´»æ€§æ›´å¼ºä¸€äº›ï¼ŒåºŸè¯ä¸å¤šè¯´å®è·µä¸ºç‹ã€‚</p>
<p>skopeo sync é•œåƒåŒæ­¥æ–‡ä»¶ç¤ºä¾‹:</p>
<ul>
<li>æ­¥éª¤ 01. å°†ä»“åº“ä¸­æ‰€æœ‰ busybox é•œåƒç‰ˆæœ¬åŒæ­¥åˆ°æœ¬åœ°ç›®å½•ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo sync --insecure-policy --src-tls-verify&#x3D;false --src docker --dest dir harbor.weiyigeek.top&#x2F;devops&#x2F;busybox &#x2F;tmp</span><br><span class="line">  # INFO[0000] Tag presence check                            imagename&#x3D;harbor.weiyigeek.top&#x2F;devops&#x2F;busybox tagged&#x3D;false</span><br><span class="line">  # INFO[0000] Getting tags                                  image&#x3D;harbor.weiyigeek.top&#x2F;devops&#x2F;busybox</span><br><span class="line">  # INFO[0000] Copying image ref 1&#x2F;1                         from&#x3D;&quot;docker:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;devops&#x2F;busybox:latest&quot; to&#x3D;&quot;dir:&#x2F;tmp&#x2F;busybox:latest&quot;</span><br><span class="line">  # Getting image source signatures</span><br><span class="line">  # Copying blob 5cc84ad355aa done</span><br><span class="line">  # Copying config beae173cca done</span><br><span class="line">  # Writing manifest to image destination</span><br><span class="line">  # Storing signatures</span><br><span class="line">  # INFO[0000] Synced 1 images from 1 sources</span><br><span class="line"></span><br><span class="line">$ tree -h &#x2F;tmp&#x2F;busybox:latest</span><br><span class="line">&#x2F;tmp&#x2F;busybox:latest</span><br><span class="line">â”œâ”€â”€ [755K]  5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa</span><br><span class="line">â”œâ”€â”€ [1.4K]  beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a</span><br><span class="line">â”œâ”€â”€ [ 527]  manifest.json</span><br><span class="line">â””â”€â”€ [  33]  version</span><br><span class="line">0 directories, 4 files</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤ 02. ä»æœ¬åœ°ç›®å½• <code>/tmp/</code> åŒæ­¥åˆ° docker çš„ hub å®¹å™¨ä»“åº“ä¸­ï¼Œæ­¤å¤–æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨çœ‹åˆ° <code>weiyigeek</code> ç”¨æˆ·ä¸‹çš„ <code>busybox</code> é•œåƒ (<a href="https://hub.docker.com/u/weiyigeek" target="_blank" rel="noopener">https://hub.docker.com/u/weiyigeek</a>)ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo sync --insecure-policy --dest-tls-verify&#x3D;false --src dir --dest docker &#x2F;tmp weiyigeek</span><br><span class="line">  # INFO[0000] Copying image ref 1&#x2F;1                         from&#x3D;&quot;dir:&#x2F;tmp&#x2F;busybox:latest&quot; to&#x3D;&quot;docker:&#x2F;&#x2F;weiyigeek&#x2F;busybox:latest&quot;</span><br><span class="line">  # Getting image source signatures</span><br><span class="line">  # Copying blob 5cc84ad355aa skipped: already exists</span><br><span class="line">  # Copying config beae173cca done</span><br><span class="line">  # Writing manifest to image destination</span><br><span class="line">  # Storing signatures</span><br><span class="line">  # INFO[0021] Synced 1 images from 1 sources</span><br></pre></td></tr></table></figure>
<p><img src="https://img.hi-linux.com/staticfile/640-20220520095506152-2022-05-20-wOfOkf.png" alt></p>
<ul>
<li>æ­¥éª¤ 03. ä» hub å®¹å™¨ä»“åº“ä¸­åŒæ­¥ alpine-jenkins-jnlp:v2.285 é•œåƒåˆ°æœ¬åœ°ä¸´æ—¶å®¹å™¨ä»“åº“ä¸­ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo sync --insecure-policy --src-tls-verify&#x3D;false --dest-tls-verify&#x3D;false --src docker --dest docker weiyigeek&#x2F;alpine-jenkins-jnlp:v2.285 192.168.12.111:5000&#x2F;</span><br><span class="line">  # INFO[0000] Tag presence check imagename&#x3D;&quot;weiyigeek&#x2F;alpine-jenkins-jnlp:v2.285&quot; tagged&#x3D;true</span><br><span class="line">  # INFO[0000] Copying image ref 1&#x2F;1 from&#x3D;&quot;docker:&#x2F;&#x2F;weiyigeek&#x2F;alpine-jenkins-jnlp:v2.285&quot; to&#x3D;&quot;docker:&#x2F;&#x2F;192.168.12.111:5000&#x2F;alpine-jenkins-jnlp:v2.285&quot;</span><br><span class="line">  # Getting image source signatures</span><br><span class="line">  # Copying blob 68517a8c32d3 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;-------------------------------] 45.0MiB &#x2F; 255.7MiB</span><br><span class="line">  # Copying blob 4c0d98bf9879 done</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤ 04. ä»¥é…ç½®æ–‡ä»¶æ–¹å¼è¿›è¡ŒåŒæ­¥, é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªéœ€è¦åŒæ­¥çš„èµ„æºæ¸…å•ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># YAML æ–‡ä»¶å†…å®¹ï¼ˆç”¨äº **--src yaml** çš„æºï¼‰</span><br><span class="line">$ cat &lt;&lt;&#39;EOF&#39; &gt; skopeo-sync.yml</span><br><span class="line">registry.example.com:</span><br><span class="line">  images:</span><br><span class="line">    busybox: []</span><br><span class="line">    redis:</span><br><span class="line">      - &quot;1.0&quot;</span><br><span class="line">      - &quot;2.0&quot;</span><br><span class="line">      - &quot;sha256:111111&quot;</span><br><span class="line">  images-by-tag-regex:</span><br><span class="line">      nginx: ^1\.13\.[12]-alpine-perl$</span><br><span class="line">  credentials:</span><br><span class="line">      username: john</span><br><span class="line">      password: this is a secret</span><br><span class="line">  tls-verify: true</span><br><span class="line">  cert-dir: &#x2F;home&#x2F;john&#x2F;certs</span><br><span class="line">quay.io:</span><br><span class="line">  tls-verify: false</span><br><span class="line">  images:</span><br><span class="line">    coreos&#x2F;etcd:</span><br><span class="line">      - latest</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># ä»¥yamlæ–‡ä»¶æ–¹å¼è¿›è¡ŒåŒæ­¥é•œåƒåˆ° my-registry.local.lan&#x2F;repo&#x2F; ä»“åº“ä¸­</span><br><span class="line">$ skopeo sync --src yaml --dest docker skopeo-sync.yml my-registry.local.lan&#x2F;repo&#x2F;</span><br></pre></td></tr></table></figure>
<p>skopeo-sync.yml æ–‡ä»¶ä¸­é•œåƒåŒ¹é…å¤åˆ¶é•œåƒè¯´æ˜:</p>
<ul>
<li><a href="http://registry.example.com/busybox" target="_blank" rel="noopener">registry.example.com/busybox</a> : æ‰€æœ‰ç‰ˆæœ¬çš„é•œåƒ.</li>
<li><a href="http://registry.example.com/redis" target="_blank" rel="noopener">registry.example.com/redis</a> : æ ‡è®°ä¸ºâ€œ1.0â€å’Œâ€œ2.0â€çš„å›¾åƒä»¥åŠå¸¦æœ‰æ‘˜è¦çš„å›¾åƒ&quot;sha256:0000000000000000000000000000000011111111111111111111111111111111&quot;.</li>
<li><a href="http://registry.example.com/nginx" target="_blank" rel="noopener">registry.example.com/nginx</a> : å›¾ç‰‡æ ‡è®°ä¸ºâ€œ1.13.1-alpine-perlâ€å’Œâ€œ1.13.2-alpine-perlâ€.</li>
<li><a href="http://quay.io/coreos/etcd" target="_blank" rel="noopener">quay.io/coreos/etcd</a> : æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„é•œåƒã€‚</li>
</ul>
<h4><span id="325-skopeo-list-tags-ä»“åº“ä¸­é•œåƒ-tag-æŸ¥çœ‹">3.2.5 Skopeo list-tags - ä»“åº“ä¸­é•œåƒ Tag æŸ¥çœ‹</span></h4>
<p>æè¿°: åˆ©ç”¨è¯¥å‘½ä»¤æˆ‘ä»¬å¯ä»¥åˆ—å‡º registry ä¸Šçš„æŸä¸ªé•œåƒçš„æ‰€æœ‰ tag ï¼Œå®ƒæ˜¯ä½¿ç”¨æ ‡å‡†çš„ registry API æ¥è·å–é•œåƒ tagã€‚</p>
<p>ç®€å•ç¤ºä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo list-tags docker:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;devops&#x2F;busybox:latest</span><br></pre></td></tr></table></figure>
<h4><span id="326-skopeo-delete-åˆ é™¤ä»“åº“ä¸­é•œåƒ-tag">3.2.6 Skopeo delete - åˆ é™¤ä»“åº“ä¸­é•œåƒ Tag</span></h4>
<p>æè¿°: ä½¿ç”¨è¯¥å‘½ä»¤æˆ‘ä»¬å¯ä»¥åˆ é™¤é•œåƒ Tag,æ³¨æ„æ­¤å¤„ä»…ä»…åªæ˜¯é€šè¿‡ registry API æ¥åˆ é™¤é•œåƒçš„ tagï¼ˆå³åˆ é™¤äº† tag å¯¹ manifests æ–‡ä»¶çš„å¼•ç”¨ï¼‰å¹¶éçœŸæ­£å°†é•œåƒåˆ é™¤æ‰ï¼Œå¦‚æœæƒ³è¦åˆ é™¤é•œåƒçš„ layer è¿˜æ˜¯éœ€è¦é€šè¿‡ registry GC çš„æ–¹å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># æ–¹å¼1. åˆ©ç”¨ skopeo delete</span><br><span class="line">$ skopeo delete docker:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;devops&#x2F;busybox:latest --debug</span><br><span class="line">  # DEBU[0000] Loading registries configuration &quot;&#x2F;etc&#x2F;containers&#x2F;registries.conf&quot;</span><br><span class="line">  # DEBU[0000] Found credentials for harbor.weiyigeek.top in credential helper containers-auth.json in file &#x2F;home&#x2F;weiyigeek&#x2F;.docker&#x2F;config.json</span><br><span class="line">  # DEBU[0000] Using registries.d directory &#x2F;etc&#x2F;containers&#x2F;registries.d for sigstore configuration</span><br><span class="line">  # DEBU[0000]  No signature storage configuration found for harbor.weiyigeek.top&#x2F;devops&#x2F;busybox:latest, using built-in default file:&#x2F;&#x2F;&#x2F;home&#x2F;weiyigeek&#x2F;.local&#x2F;share&#x2F;containers&#x2F;sigstore</span><br><span class="line">  # DEBU[0000] Looking for TLS certificates and private keys in &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;harbor.weiyigeek.top</span><br><span class="line">  # DEBU[0000]  crt: &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;harbor.weiyigeek.top&#x2F;harbor.crt</span><br><span class="line">  # DEBU[0000] GET https:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;v2&#x2F;</span><br><span class="line">  # DEBU[0000] Ping https:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;v2&#x2F; status 401</span><br><span class="line">  # DEBU[0000] GET https:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;service&#x2F;token?account&#x3D;WeiyiGeek&amp;scope&#x3D;repository%3Adevops%2Fbusybox%3A%2A&amp;service&#x3D;harbor-registry</span><br><span class="line">  # DEBU[0000] GET https:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;v2&#x2F;devops&#x2F;busybox&#x2F;manifests&#x2F;latest</span><br><span class="line">  # DEBU[0000] DELETE https:&#x2F;&#x2F;harbor.weiyigeek.top&#x2F;v2&#x2F;devops&#x2F;busybox&#x2F;manifests&#x2F;sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee</span><br><span class="line">  # DEBU[0000] Deleting &#x2F;home&#x2F;weiyigeek&#x2F;.local&#x2F;share&#x2F;containers&#x2F;sigstore&#x2F;devops&#x2F;busybox@sha256&#x3D;62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee&#x2F;signature-1</span><br><span class="line"></span><br><span class="line"># æ–¹å¼2.åˆ©ç”¨ curl å‘½ä»¤è¿›è¡Œ registery è¿›è¡Œåˆ é™¤ Tagã€‚</span><br><span class="line">$ curl --header &quot;Accept: application&#x2F;vnd.docker.distribution.manifest.v2+json&quot; -I -X GET http:&#x2F;&#x2F;192.168.12.111:5000&#x2F;v2&#x2F;busybox&#x2F;manifests&#x2F;latest</span><br><span class="line">  # HTTP&#x2F;1.1 200 OK</span><br><span class="line">  # Content-Length: 527</span><br><span class="line">  # Content-Type: application&#x2F;vnd.docker.distribution.manifest.v2+json</span><br><span class="line">  # Docker-Content-Digest: sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee</span><br><span class="line">  # Docker-Distribution-Api-Version: registry&#x2F;2.0</span><br><span class="line">  # Etag: &quot;sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee&quot;</span><br><span class="line">  # X-Content-Type-Options: nosniff</span><br><span class="line">  # Date: Thu, 20 Jan 2022 13:18:28 GMT</span><br><span class="line"></span><br><span class="line"># ä¸€æŠŠæ¢­ç»‡æå®š</span><br><span class="line">$ Docker-Content-Digest&#x3D;$(curl -s --header &quot;Accept: application&#x2F;vnd.docker.distribution.manifest.v2+json&quot; -I -X GET http:&#x2F;&#x2F;192.168.12.111:5000&#x2F;v2&#x2F;busybox&#x2F;manifests&#x2F;latest | grep &quot;Docker-Content-Digest&quot; | cut -d &#39; &#39; -f 2)</span><br><span class="line">$ curl -I -X DELETE http:&#x2F;&#x2F;192.168.12.111:5000&#x2F;v2&#x2F;busybox&#x2F;manifests&#x2F;$&#123;Docker-Content-Digest&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="4-é•œåƒåŒæ­¥æœ€ä½³å®è·µ">4. é•œåƒåŒæ­¥æœ€ä½³å®è·µ</span></h2>
<p>æœ¬èŠ‚ï¼Œä¸»è¦å‚è€ƒæˆ‘å‰åŒäº‹æœ¨å­.å…¶åšå®¢åœ°å€(<a href="https://blog.k8s.li" target="_blank" rel="noopener">https://blog.k8s.li</a>)ã€‚</p>
<h3><span id="41-æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥">4.1 æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥</span></h3>
<p>å‡å¦‚,ç»™ä½ ä¸€ä¸ªé•œåƒåˆ—è¡¨ images-list.txt, å…¶æ ¼å¼å¦‚ä¸‹, æˆ‘ä»¬å¯ä»¥ç›´æ¥é‡‡ç”¨ shell è„šæœ¬è°ƒç”¨ skopeo è¿›è¡Œæ‰§è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># images-list.txt</span><br><span class="line">cat &lt;&lt;&#39;EOF&#39; &gt; images-list.txt</span><br><span class="line">kubesphere&#x2F;kube-apiserver:v1.20.6</span><br><span class="line">kubesphere&#x2F;kube-scheduler:v1.20.6</span><br><span class="line">kubesphere&#x2F;kube-proxy:v1.20.6</span><br><span class="line">kubesphere&#x2F;kube-controller-manager:v1.20.6</span><br><span class="line">kubesphere&#x2F;kube-apiserver:v1.19.8</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>åŒæ­¥çš„ shell è„šæœ¬ <a href="http://skopeo-copy.sh" target="_blank" rel="noopener">skopeo-copy.sh</a></strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">GREEN_COL&#x3D;&quot;\\033[32;1m&quot;</span><br><span class="line">RED_COL&#x3D;&quot;\\033[1;31m&quot;</span><br><span class="line">NORMAL_COL&#x3D;&quot;\\033[0;39m&quot;</span><br><span class="line"></span><br><span class="line">SOURCE_REGISTRY&#x3D;$1</span><br><span class="line">TARGET_REGISTRY&#x3D;$2</span><br><span class="line"></span><br><span class="line"># shell å˜é‡èµ‹å€¼ï¼Œå½“æ²¡æœ‰ä»å‘½ä»¤è¡Œä¸­ä¼ é€’å€¼ç»™SOURCE_REGISTRYå’ŒTARGET_REGISTRYå˜é‡æ—¶ï¼Œä¾¿é‡‡ç”¨ä¸‹è¿°å€¼è¿›è¡Œè¦†ç›–ã€‚</span><br><span class="line">: $&#123;IMAGES_LIST_FILE:&#x3D;&quot;images-list.txt&quot;&#125;</span><br><span class="line">: $&#123;TARGET_REGISTRY:&#x3D;&quot;hub.k8s.li&quot;&#125;</span><br><span class="line">: $&#123;SOURCE_REGISTRY:&#x3D;&quot;docker.io&quot;&#125;</span><br><span class="line"></span><br><span class="line">BLOBS_PATH&#x3D;&quot;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&quot;</span><br><span class="line">REPO_PATH&#x3D;&quot;docker&#x2F;registry&#x2F;v2&#x2F;repositories&quot;</span><br><span class="line"></span><br><span class="line">set -eo pipefail</span><br><span class="line"></span><br><span class="line">CURRENT_NUM&#x3D;0</span><br><span class="line">ALL_IMAGES&#x3D;&quot;$(sed -n &#39;&#x2F;#&#x2F;d;s&#x2F;:&#x2F;:&#x2F;p&#39; $&#123;IMAGES_LIST_FILE&#125; | sort -u)&quot;</span><br><span class="line">TOTAL_NUMS&#x3D;$(echo &quot;$&#123;ALL_IMAGES&#125;&quot; | wc -l)</span><br><span class="line"></span><br><span class="line"># shopeo æ‹·è´å‡½æ•°ï¼Œæ³¨æ„å…¶ä¼ é€’çš„å‚æ•°ï¼Œæ­¤å¤„å€¼å¾—å­¦ä¹ è®°å½•ã€‚</span><br><span class="line">skopeo_copy() &#123;</span><br><span class="line"> if skopeo copy --insecure-policy --src-tls-verify&#x3D;false --dest-tls-verify&#x3D;false \</span><br><span class="line"> --override-arch amd64 --override-os linux -q docker:&#x2F;&#x2F;$1 docker:&#x2F;&#x2F;$2; then</span><br><span class="line">  echo -e &quot;$GREEN_COL Progress: $&#123;CURRENT_NUM&#125;&#x2F;$&#123;TOTAL_NUMS&#125; sync $1 to $2 successful $NORMAL_COL&quot;</span><br><span class="line"> else</span><br><span class="line">  echo -e &quot;$RED_COL Progress: $&#123;CURRENT_NUM&#125;&#x2F;$&#123;TOTAL_NUMS&#125; sync $1 to $2 failed $NORMAL_COL&quot;</span><br><span class="line">  exit 2</span><br><span class="line"> fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># è°ƒç”¨æ‹·è´å‡½æ•°å¹¶è®°å½•å½“å‰æ‰§è¡Œåºå·ã€‚</span><br><span class="line">for image in $&#123;ALL_IMAGES&#125;; do</span><br><span class="line"> let CURRENT_NUM&#x3D;$&#123;CURRENT_NUM&#125;+1</span><br><span class="line"> skopeo_copy $&#123;SOURCE_REGISTRY&#125;&#x2F;$&#123;image&#125; $&#123;TARGET_REGISTRY&#125;&#x2F;$&#123;image&#125;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ‰§è¡Œå‘½ä»¤å’Œç»“æœ:</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bash sync.sh docker.io localhost:5000</span><br><span class="line">Progress: 1&#x2F;143 sync docker.io&#x2F;alpine:3.14 to localhost:5000&#x2F;alpine:3.14 successful</span><br><span class="line">Progress: 2&#x2F;143 sync docker.io&#x2F;busybox:1.31.1 to localhost:5000&#x2F;busybox:1.31.1 successful</span><br><span class="line">....</span><br><span class="line">Progress: 142&#x2F;143 sync docker.io&#x2F;weaveworks&#x2F;scope:1.13.0 to localhost:5000&#x2F;weaveworks&#x2F;scope:1.13.0 successful</span><br><span class="line">Progress: 143&#x2F;143 sync docker.io&#x2F;wordpress:4.8-apache to localhost:5000&#x2F;wordpress:4.8-apache successful</span><br></pre></td></tr></table></figure>
<h3><span id="42-ä½¿ç”¨-registry-å­˜å‚¨ç‰¹æ€§åŒæ­¥">4.2 ä½¿ç”¨ registry å­˜å‚¨ç‰¹æ€§åŒæ­¥</span></h3>
<p>æè¿°: å°†é•œåƒä» registry ä¸­åŒæ­¥åˆ°æœ¬åœ°ç›®å½•ï¼Œä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§ï¼Œå°†æœ¬åœ°ç›®å½•ä¸­çš„é•œåƒè½¬æ¢æˆ registry å­˜å‚¨çš„æ ¼å¼, è¿™æ ·çš„å¥½å¤„å°±æ˜¯å¯ä»¥å»é™¤ä¸€äº› skopeo dir ä¸­é‡å¤çš„ layersï¼Œå‡å°‘é•œåƒçš„æ€»å¤§å°ã€‚</p>
<ul>
<li><a href="http://convert-images.sh" target="_blank" rel="noopener">convert-images.sh</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">set -eo pipefail</span><br><span class="line"></span><br><span class="line">GREEN_COL&#x3D;&quot;\\033[32;1m&quot;</span><br><span class="line">RED_COL&#x3D;&quot;\\033[1;31m&quot;</span><br><span class="line">NORMAL_COL&#x3D;&quot;\\033[0;39m&quot;</span><br><span class="line"></span><br><span class="line"># å‘½ä»¤è¡Œå‚æ•°</span><br><span class="line">SOURCE_REGISTRY&#x3D;$1</span><br><span class="line">TARGET_REGISTRY&#x3D;$2</span><br><span class="line">IMAGES_DIR&#x3D;$2</span><br><span class="line"></span><br><span class="line">: $&#123;IMAGES_DIR:&#x3D;&quot;images&quot;&#125;</span><br><span class="line">: $&#123;IMAGES_LIST_FILE:&#x3D;&quot;images-list.txt&quot;&#125;</span><br><span class="line">: $&#123;SOURCE_REGISTRY:&#x3D;&quot;docker.io&quot;&#125;</span><br><span class="line">: $&#123;TARGET_REGISTRY:&#x3D;&quot;hub.k8s.li&quot;&#125;</span><br><span class="line"></span><br><span class="line"># hub.k8s.li ä»“åº“æœåŠ¡å™¨ä¸­çš„ç›®å½•</span><br><span class="line">BLOBS_PATH&#x3D;&quot;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&quot;</span><br><span class="line">REPO_PATH&#x3D;&quot;docker&#x2F;registry&#x2F;v2&#x2F;repositories&quot;</span><br><span class="line"></span><br><span class="line"># è®°å½•å½“å‰æ•°å’Œæ€»é•œåƒæ•°</span><br><span class="line">CURRENT_NUM&#x3D;0</span><br><span class="line">ALL_IMAGES&#x3D;&quot;$(sed -n &#39;&#x2F;#&#x2F;d;s&#x2F;:&#x2F;:&#x2F;p&#39; $&#123;IMAGES_LIST_FILE&#125; | sort -u)&quot;</span><br><span class="line">TOTAL_NUMS&#x3D;$(echo &quot;$&#123;ALL_IMAGES&#125;&quot; | wc -l)</span><br><span class="line"></span><br><span class="line"># ä»è¿œç¨‹ä»“åº“åŒæ­¥æŒ‡å®šé•œåƒåˆ°æœ¬åœ°ç›®å½•ä¸­ã€‚</span><br><span class="line">skopeo_sync() &#123;</span><br><span class="line"> if skopeo sync --insecure-policy --src-tls-verify&#x3D;false --dest-tls-verify&#x3D;false \</span><br><span class="line"> --override-arch amd64 --override-os linux --src docker --dest dir $1 $2 &gt; &#x2F;dev&#x2F;null; then</span><br><span class="line">  echo -e &quot;$GREEN_COL Progress: $&#123;CURRENT_NUM&#125;&#x2F;$&#123;TOTAL_NUMS&#125; sync $1 to $2 successful $NORMAL_COL&quot;</span><br><span class="line"> else</span><br><span class="line">  echo -e &quot;$RED_COL Progress: $&#123;CURRENT_NUM&#125;&#x2F;$&#123;TOTAL_NUMS&#125; sync $1 to $2 failed $NORMAL_COL&quot;</span><br><span class="line">  exit 2</span><br><span class="line"> fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">convert_images() &#123;</span><br><span class="line"> rm -rf $&#123;IMAGES_DIR&#125;; mkdir -p $&#123;IMAGES_DIR&#125;</span><br><span class="line"> for image in $&#123;ALL_IMAGES&#125;; do</span><br><span class="line">  let CURRENT_NUM&#x3D;$&#123;CURRENT_NUM&#125;+1</span><br><span class="line">  </span><br><span class="line">  # å– images-list.txt æ–‡æœ¬ä¸­çš„æ¯ä¸€è¡Œï¼Œå¹¶åˆ†éš”å­˜å‚¨ã€‚</span><br><span class="line">  image_name&#x3D;$&#123;image%%:*&#125;</span><br><span class="line">  image_tag&#x3D;$&#123;image##*:&#125;</span><br><span class="line">  image_repo&#x3D;$&#123;image%%&#x2F;*&#125;</span><br><span class="line"></span><br><span class="line">  # å‡½æ•°è°ƒç”¨ ä»ä»“åº“åŒæ­¥é•œåƒåˆ°æœ¬åœ°imagesç›®å½•</span><br><span class="line">  skopeo_sync $&#123;SOURCE_REGISTRY&#125;&#x2F;$&#123;image&#125; $&#123;IMAGES_DIR&#125;&#x2F;$&#123;image_repo&#125;</span><br><span class="line"></span><br><span class="line">  # åœ¨æœ¬åœ°imagesç›®å½•ä¸­ï¼Œå–å¾—get image manifest sha256sum ä¿¡æ¯</span><br><span class="line">  manifest&#x3D;&quot;$&#123;IMAGES_DIR&#125;&#x2F;$&#123;image&#125;&#x2F;manifest.json&quot;</span><br><span class="line">  manifest_sha256&#x3D;$(sha256sum $&#123;manifest&#125; | awk &#39;&#123;print $1&#125;&#39;)      # 62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee</span><br><span class="line">  mkdir -p $&#123;BLOBS_PATH&#125;&#x2F;$&#123;manifest_sha256:0:2&#125;&#x2F;$&#123;manifest_sha256&#125; # docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&#x2F;62&#x2F;62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee</span><br><span class="line">  ln -f $&#123;manifest&#125; $&#123;BLOBS_PATH&#125;&#x2F;$&#123;manifest_sha256:0:2&#125;&#x2F;$&#123;manifest_sha256&#125;&#x2F;data  #  è¯¥ data æ–‡ä»¶å®é™…ä¸Šæ˜¯é•œåƒçš„ manifest.json æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">  # make image repositories dir</span><br><span class="line">  mkdir -p $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;&#123;_uploads,_layers,_manifests&#125;</span><br><span class="line">  mkdir -p $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;revisions&#x2F;sha256&#x2F;$&#123;manifest_sha256&#125;</span><br><span class="line">  mkdir -p $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;&#123;current,index&#x2F;sha256&#125;</span><br><span class="line">  mkdir -p $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;index&#x2F;sha256&#x2F;$&#123;manifest_sha256&#125;</span><br><span class="line"></span><br><span class="line">  # create image tag manifest link file</span><br><span class="line">  echo -n &quot;sha256:$&#123;manifest_sha256&#125;&quot; &gt; $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;revisions&#x2F;sha256&#x2F;$&#123;manifest_sha256&#125;&#x2F;link  # sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732deer</span><br><span class="line">  echo -n &quot;sha256:$&#123;manifest_sha256&#125;&quot; &gt; $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;current&#x2F;link</span><br><span class="line">  echo -n &quot;sha256:$&#123;manifest_sha256&#125;&quot; &gt; $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;index&#x2F;sha256&#x2F;$&#123;manifest_sha256&#125;&#x2F;link</span><br><span class="line"></span><br><span class="line">  # link image layers file to registry blobs dir</span><br><span class="line">  for layer in $(sed &#39;&#x2F;v1Compatibility&#x2F;d&#39; $&#123;manifest&#125; | grep -Eo &quot;\b[a-f0-9]&#123;64&#125;\b&quot;); do  # åŒ¹é… manifest.json ä¸­&quot;digest&quot;ä¸¤ä¸ªä¸å¸¦sha256çš„å€¼</span><br><span class="line">    mkdir -p $&#123;BLOBS_PATH&#125;&#x2F;$&#123;layer:0:2&#125;&#x2F;$&#123;layer&#125;                 # 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa ã€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a</span><br><span class="line">    mkdir -p $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;_layers&#x2F;sha256&#x2F;$&#123;layer&#125;  # 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa ã€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a</span><br><span class="line">    echo -n &quot;sha256:$&#123;layer&#125;&quot; &gt; $&#123;REPO_PATH&#125;&#x2F;$&#123;image_name&#125;&#x2F;_layers&#x2F;sha256&#x2F;$&#123;layer&#125;&#x2F;link  # sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa</span><br><span class="line">    ln -f $&#123;IMAGES_DIR&#125;&#x2F;$&#123;image&#125;&#x2F;$&#123;layer&#125; $&#123;BLOBS_PATH&#125;&#x2F;$&#123;layer:0:2&#125;&#x2F;$&#123;layer&#125;&#x2F;data     # å¤åˆ¶imagesç›®å½•ä¸­ &quot;application&#x2F;vnd.docker.container.image.v1+json&quot; å®¹å™¨é…ç½® config ä¸ å¤šä¸ª &quot;application&#x2F;vnd.docker.image.rootfs.diff.tar.gzip&quot; layer </span><br><span class="line">  done</span><br><span class="line"> done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">convert_images</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="http://install.sh" target="_blank" rel="noopener">install.sh</a> : ä½¿ç”¨è¿™ä¸ªè„šæœ¬å°† registry å­˜å‚¨ä¸­çš„é•œåƒè½¬æ¢æˆ skopeo dir çš„æ–¹å¼ï¼Œç„¶åå†å°†é•œåƒåŒæ­¥åˆ° registry ä¸­ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">REGISTRY_DOMAIN&#x3D;&quot;harbor.k8s.li&quot;</span><br><span class="line">REGISTRY_PATH&#x3D;&quot;&#x2F;var&#x2F;lib&#x2F;registry&quot;</span><br><span class="line"></span><br><span class="line"># åˆ‡æ¢åˆ° registry å­˜å‚¨ä¸»ç›®å½•ä¸‹</span><br><span class="line">cd $&#123;REGISTRY_PATH&#125;</span><br><span class="line">gen_skopeo_dir() &#123;</span><br><span class="line">   # å®šä¹‰ registry å­˜å‚¨çš„ blob ç›®å½• å’Œ repositories ç›®å½•ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨</span><br><span class="line">    BLOB_DIR&#x3D;&quot;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&quot;</span><br><span class="line">    REPO_DIR&#x3D;&quot;docker&#x2F;registry&#x2F;v2&#x2F;repositories&quot;</span><br><span class="line">    # å®šä¹‰ç”Ÿæˆ skopeo ç›®å½•</span><br><span class="line">    SKOPEO_DIR&#x3D;&quot;docker&#x2F;skopeo&quot;</span><br><span class="line">    # é€šè¿‡ find å‡º current æ–‡ä»¶å¤¹å¯ä»¥å¾—åˆ°æ‰€æœ‰å¸¦ tag çš„é•œåƒï¼Œå› ä¸ºä¸€ä¸ª tag å¯¹åº”ä¸€ä¸ª current ç›®å½•</span><br><span class="line">    for image in $(find $&#123;REPO_DIR&#125; -type d -name &quot;current&quot;); do</span><br><span class="line">        # æ ¹æ®é•œåƒçš„ tag æå–é•œåƒçš„åå­—</span><br><span class="line">        name&#x3D;$(echo $&#123;image&#125; | awk -F &#39;&#x2F;&#39; &#39;&#123;print $5&quot;&#x2F;&quot;$6&quot;:&quot;$9&#125;&#39;)</span><br><span class="line">        link&#x3D;$(cat $&#123;image&#125;&#x2F;link | sed &#39;s&#x2F;sha256:&#x2F;&#x2F;&#39;)</span><br><span class="line">        mfs&#x3D;&quot;$&#123;BLOB_DIR&#125;&#x2F;$&#123;link:0:2&#125;&#x2F;$&#123;link&#125;&#x2F;data&quot;</span><br><span class="line">        # åˆ›å»ºé•œåƒçš„ç¡¬é“¾æ¥éœ€è¦çš„ç›®å½•</span><br><span class="line">        mkdir -p &quot;$&#123;SKOPEO_DIR&#125;&#x2F;$&#123;name&#125;&quot;</span><br><span class="line">        # ç¡¬é“¾æ¥é•œåƒçš„ manifests æ–‡ä»¶åˆ°ç›®å½•çš„ manifest æ–‡ä»¶</span><br><span class="line">        ln $&#123;mfs&#125; $&#123;SKOPEO_DIR&#125;&#x2F;$&#123;name&#125;&#x2F;manifest.json</span><br><span class="line">        # ä½¿ç”¨æ­£åˆ™åŒ¹é…å‡ºæ‰€æœ‰çš„ sha256 å€¼ï¼Œç„¶åæ’åºå»é‡</span><br><span class="line">        layers&#x3D;$(grep -Eo &quot;\b[a-f0-9]&#123;64&#125;\b&quot; $&#123;mfs&#125; | sort -n | uniq)</span><br><span class="line">        for layer in $&#123;layers&#125;; do</span><br><span class="line">          # ç¡¬é“¾æ¥ registry å­˜å‚¨ç›®å½•é‡Œçš„é•œåƒ layer å’Œ images config åˆ°é•œåƒçš„ dir ç›®å½•</span><br><span class="line">            ln $&#123;BLOB_DIR&#125;&#x2F;$&#123;layer:0:2&#125;&#x2F;$&#123;layer&#125;&#x2F;data $&#123;SKOPEO_DIR&#125;&#x2F;$&#123;name&#125;&#x2F;$&#123;layer&#125;</span><br><span class="line">        done</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line">sync_image() &#123;</span><br><span class="line">    # ä½¿ç”¨ skopeo sync å°† dir æ ¼å¼çš„é•œåƒåŒæ­¥åˆ° harbor</span><br><span class="line">    for project in $(ls $&#123;SKOPEO_DIR&#125;); do</span><br><span class="line">        skopeo sync --insecure-policy --src-tls-verify&#x3D;false --dest-tls-verify&#x3D;false \</span><br><span class="line">        --src dir --dest docker $&#123;SKOPEO_DIR&#125;&#x2F;$&#123;project&#125; $&#123;REGISTRY_DOMAIN&#125;&#x2F;$&#123;project&#125;</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line">gen_skopeo_dir</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ¸©é¦¨æç¤º: æ­¤ç§æ–¹å¼æ˜¯æœ‰äº›å¤æ‚å¯¹äºå¤§é•œåƒçš„å¤åˆ¶æ˜¯æ¨èçš„, è€Œå¯¹äºä¸€äº›å°é•œåƒä¸”æ˜¾å¾—å¤šä½™ã€‚</p>
</blockquote>
<h3><span id="43-ä»-registry-å­˜å‚¨ä¸­-select-å‡ºé•œåƒè¿›è¡ŒåŒæ­¥">4.3 ä» registry å­˜å‚¨ä¸­ select å‡ºé•œåƒè¿›è¡ŒåŒæ­¥</span></h3>
<p>æè¿°: å…ˆå°†é•œåƒåŒæ­¥åˆ°ä¸€ä¸ª registry ä¸­ï¼Œå†å°†é•œåƒä» registry å­˜å‚¨ä¸­æå‡ºæ¥ï¼Œè¯¥ registry å¯ä»¥å½“ä½œä¸€ä¸ªé•œåƒå­˜å‚¨çš„æ± å­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Linux ä¸­ç¡¬é“¾æ¥çš„ç‰¹æ€§å°†é•œåƒ&quot;å¤åˆ¶&quot;ä¸€ä»½å‡ºæ¥ï¼Œç„¶åå†æ‰“ä¸€ä¸ª tar åŒ…, è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æ¯æ¬¡æ‰“åŒ…é•œåƒçš„æ—¶å€™éƒ½èƒ½å¤ç”¨å†å²çš„é•œåƒæ•°æ®ï¼Œè€Œä¸”æ€§èƒ½æå¿«ã€‚</p>
<ul>
<li>æ­¥éª¤ 01. å…ˆå°†é•œåƒåŒæ­¥åˆ°ä¸€ä¸ªå›ºå®šçš„ registry ä¸­ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bash skopeo-copy.sh docker.io localhost:5000</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤ 02. ä½¿ç”¨è¯¥è„šæœ¬å°†é•œåƒä» registry å­˜å‚¨ä¸­æå‡ºæ¥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">set -eo pipefail</span><br><span class="line"># å‘½ä»¤è¡Œå˜é‡</span><br><span class="line">IMAGES_LIST&#x3D;&quot;$1&quot;</span><br><span class="line">REGISTRY_PATH&#x3D;&quot;$2&quot;</span><br><span class="line">OUTPUT_DIR&#x3D;&quot;$3&quot;</span><br><span class="line"></span><br><span class="line"># Registry ä»“åº“æ•°æ®ç›®å½•</span><br><span class="line">BLOB_DIR&#x3D;&quot;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F;sha256&quot;</span><br><span class="line">REPO_DIR&#x3D;&quot;docker&#x2F;registry&#x2F;v2&#x2F;repositories&quot;</span><br><span class="line"></span><br><span class="line"># åˆ¤æ–­è¾“å‡ºç›®å½•æ˜¯å¦å­˜åœ¨å¦‚ä¸å­˜åœ¨åˆ™ç§»é™¤ã€‚</span><br><span class="line">if [ -d $&#123;OUTPUT_DIR&#125; ];then</span><br><span class="line">  rm -rf $&#123;OUTPUT_DIR&#125;;</span><br><span class="line">fi</span><br><span class="line">mkdir -p $&#123;OUTPUT_DIR&#125;</span><br><span class="line"></span><br><span class="line">for image in $(find $&#123;IMAGES_LIST&#125; -type f -name &quot;*.list&quot; | xargs grep -Ev &#39;^#|^&#x2F;&#39; | grep &#39;:&#39;); do</span><br><span class="line">  # é•œåƒåç§°å’ŒTag</span><br><span class="line">  image_name&#x3D;$&#123;image%%:*&#125;</span><br><span class="line">  image_tag&#x3D;$&#123;image##*:&#125;</span><br><span class="line"></span><br><span class="line">  # link è·¯å¾„è·å–</span><br><span class="line">  tag_link&#x3D;$&#123;REGISTRY_PATH&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;current&#x2F;link</span><br><span class="line">  manifest_sha256&#x3D;$(sed &#39;s&#x2F;sha256:&#x2F;&#x2F;&#39; $&#123;tag_link&#125;)</span><br><span class="line">  manifest&#x3D;$&#123;REGISTRY_PATH&#125;&#x2F;$&#123;BLOB_DIR&#125;&#x2F;$&#123;manifest_sha256:0:2&#125;&#x2F;$&#123;manifest_sha256&#125;&#x2F;data</span><br><span class="line">  mkdir -p $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;BLOB_DIR&#125;&#x2F;$&#123;manifest_sha256:0:2&#125;&#x2F;$&#123;manifest_sha256&#125;</span><br><span class="line"></span><br><span class="line">  # å¼ºåˆ¶ç¡¬é“¾æ¥åˆ°æŒ‡å®šç›®å½•</span><br><span class="line">  ln -f $&#123;manifest&#125; $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;BLOB_DIR&#125;&#x2F;$&#123;manifest_sha256:0:2&#125;&#x2F;$&#123;manifest_sha256&#125;&#x2F;data</span><br><span class="line"></span><br><span class="line">  # make image repositories dir</span><br><span class="line">  mkdir -p $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;&#123;_uploads,_layers,_manifests&#125;</span><br><span class="line">  mkdir -p $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;revisions&#x2F;sha256&#x2F;$&#123;manifest_sha256&#125;</span><br><span class="line">  mkdir -p $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;&#123;current,index&#x2F;sha256&#125;</span><br><span class="line">  mkdir -p $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;index&#x2F;sha256&#x2F;$&#123;manifest_sha256&#125;</span><br><span class="line"></span><br><span class="line">  # create image tag manifest link file  </span><br><span class="line">  echo -n &quot;sha256:$&#123;manifest_sha256&#125;&quot; &gt; $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;current&#x2F;link</span><br><span class="line">  echo -n &quot;sha256:$&#123;manifest_sha256&#125;&quot; &gt; $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;revisions&#x2F;sha256&#x2F;$&#123;manifest_sha256&#125;&#x2F;link</span><br><span class="line">  echo -n &quot;sha256:$&#123;manifest_sha256&#125;&quot; &gt; $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_manifests&#x2F;tags&#x2F;$&#123;image_tag&#125;&#x2F;index&#x2F;sha256&#x2F;$&#123;manifest_sha256&#125;&#x2F;link</span><br><span class="line"></span><br><span class="line">  # å¼ºåˆ¶åˆ›å»º &#x2F;docker&#x2F;registry&#x2F;v2&#x2F;blobs&#x2F; å„ layer data æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­</span><br><span class="line">  for layer in $(sed &#39;&#x2F;v1Compatibility&#x2F;d&#39; $&#123;manifest&#125; | grep -Eo &#39;\b[a-f0-9]&#123;64&#125;\b&#39; | sort -u); do</span><br><span class="line">      mkdir -p $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;BLOB_DIR&#125;&#x2F;$&#123;layer:0:2&#125;&#x2F;$&#123;layer&#125;</span><br><span class="line">      mkdir -p $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_layers&#x2F;sha256&#x2F;$&#123;layer&#125;</span><br><span class="line">      ln -f $&#123;BLOB_DIR&#125;&#x2F;$&#123;layer:0:2&#125;&#x2F;$&#123;layer&#125;&#x2F;data $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;BLOB_DIR&#125;&#x2F;$&#123;layer:0:2&#125;&#x2F;$&#123;layer&#125;&#x2F;data</span><br><span class="line">      echo -n &quot;sha256:$&#123;layer&#125;&quot; &gt; $&#123;OUTPUT_DIR&#125;&#x2F;$&#123;REPO_DIR&#125;&#x2F;$&#123;image_name&#125;&#x2F;_layers&#x2F;sha256&#x2F;$&#123;layer&#125;&#x2F;link</span><br><span class="line">  done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤å®Œæ¯•ï¼</p>
<blockquote>
<p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œ WeiyiGeek ã€ï¼ŒåŸæ–‡ï¼š<a href="https://url.hi-linux.com/xCmXo/" target="_blank" rel="noopener">https://url.hi-linux.com/xCmXo/</a> ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>ã€‚</p>
</blockquote>
</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "10135-1588830050631-449",
			        "name": "ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€",
			        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",
			        "keyword": "VIP"
			    });
			}
			</script>
		
                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/posts/28253.html" data-toggle="tooltip" data-placement="top" title="å¦‚ä½•ä½¿ç”¨ Kubectl ä¼˜é›…çš„æ»šåŠ¨æ›´æ–°åº”ç”¨">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/posts/907.html" data-toggle="tooltip" data-placement="top" title="è½»é‡çº§ Kubernetes é›†ç¾¤å‘è¡Œç‰ˆ K3s å®Œå…¨è¿›é˜¶æŒ‡å—">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- å¤šè¯´ Share end-->

                <!-- å¤šè¯´è¯„è®ºæ¡† start -->
                
                <!-- å¤šè¯´è¯„è®ºæ¡† end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                
                    <!-- disqus è¯„è®ºæ¡† start -->
                    <div class="comment">
                        <div id="lv-container" data-id="city" data-uid="MTAyMC8yNzg2My80NDQw"></div>
                    </div>
                    <!-- disqus è¯„è®ºæ¡† end -->
                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">1. åŸºç¡€ä»‹ç»</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">2. å®‰è£…ç¼–è¯‘</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">2.1 æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">2.2 åˆ†å‘åŒ…å®‰è£…</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">2.3 å®¹å™¨å®‰è£…è¿è¡Œ</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">3. å¿«é€Ÿä¸Šæ‰‹</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">3.1 å‘½ä»¤æµ…æ</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">3.2 Skopeo åˆä½“éªŒ</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.2.1.</span> <span class="toc-nav-text">3.2.1 Skopeo login&#x2F;loout - è¿œç¨‹ä»“åº“ Auth</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.2.2.</span> <span class="toc-nav-text">3.2.2 Skopeo inspect - æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.2.3.</span> <span class="toc-nav-text">3.2.3 Skopeo copy - ä»“åº“é•œåƒæ‹·è´</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.2.4.</span> <span class="toc-nav-text">3.2.4 Skopeo sync - é•œåƒåŒæ­¥å‘½ä»¤</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.2.5.</span> <span class="toc-nav-text">3.2.5 Skopeo list-tags - ä»“åº“ä¸­é•œåƒ Tag æŸ¥çœ‹</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.2.6.</span> <span class="toc-nav-text">3.2.6 Skopeo delete - åˆ é™¤ä»“åº“ä¸­é•œåƒ Tag</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">4. é•œåƒåŒæ­¥æœ€ä½³å®è·µ</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">4.1 æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">4.2 ä½¿ç”¨ registry å­˜å‚¨ç‰¹æ€§åŒæ­¥</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">4.3.</span> <span class="toc-nav-text">4.3 ä» registry å­˜å‚¨ä¸­ select å‡ºé•œåƒè¿›è¡ŒåŒæ­¥</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
                        
                          <a class="tag" href="/tags/#Docker" title="Docker">Docker</a>
                        
                          <a class="tag" href="/tags/#Skopeo" title="Skopeo">Skopeo</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://www.mike.org.cn/" target="_blank">ç®€å•.ç”Ÿæ´»</a></li>
                    
                        <li><a href="http://shang.qq.com/wpa/qunwpa?idkey=ea4c43493c2269428ac6ef6141de4b6d78e5ab2d41380ca4099b833b62884ee9" target="_blank">æŠ€æœ¯äº¤æµç¾¤</a></li>
                    
                        <li><a href="" target="_blank"></a></li>
                    
                        <li><a href="" target="_blank"></a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






    <!-- æ¥å¿…åŠ›Cityç‰ˆå…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
    <script type="text/javascript">
       (function(d, s) {
           var j, e = d.getElementsByTagName(s)[0];
    
           if (typeof LivereTower === 'function') { return; }
    
           j = d.createElement(s);
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;
    
           e.parentNode.insertBefore(j, e);
       })(document, 'script');
    </script>
    <noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
    <!-- æ¥å¿…åŠ›Cityç‰ˆ å…¬å…±JSä»£ç  end -->



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'â„¬'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                    <li>
                        <a href="/atom.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/80imike">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">çŸ¥</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/2093524665">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Mike 2025 | Hosted by <a href="https://pages.coding.me" target="_blank" rel="noopener" style="font-weight: bold">Coding Pages</a>
                    <br>
                    Theme by <a href="http://beantech.org" target="_blank" rel="noopener">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com" target="_blank" rel="noopener">èƒ¡ä¼Ÿç…Œ</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://www.hi-linux.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->



<script defer src="https://umami.hi-linux.com/script.js"
    data-website-id="db99ccfc-f114-4595-8f3b-9dd1fbd3bf19"></script>


	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://www.hi-linux.com/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

<script>(function(w,d, s, id) {w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = 'https://cdn.webpushr.com/app.min.js';fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BF9JK7xV9kjWTdMx2lr6RWaPfXV7wNuZaVAJ1bfIGoBNJavqLEBVFMKLubITnCA4bh2fI9iH9tMF95nXnPt7xxY');</script></body>

</html>
