<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="Linux,运维,Nginx,Zabbix,Centos,Ansible,MySQL,Python,Docker,ELK,Haproxy,Git,Nodejs,安全,技术">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          使用 Kubeadm 快速部署 Kubernetes - 运维之美
        
    </title>

    <link rel="canonical" href="https://www.hi-linux.com/posts/64604/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('https://www.hi-linux.com/img/header_img/article.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
                            
                              <a class="tag" href="/tags/#Docker" title="Docker">Docker</a>
                            
                        </div>
                        <h1>使用 Kubeadm 快速部署 Kubernetes</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by Mike on
                            2017-03-23
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">运维之美</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h3 id="kubernetes是什么">Kubernetes是什么？</h3>
<p>Kubernetes是Google开源的基于Docker的容器集群管理系统，是谷歌内部大规模集群管理系统Borg的开源版本。Kubernetes基于Borg集群软件模型，其诱人之处在于该模型经过了Google庞大数据中心的校验。</p>
<p>Kubernetes(K8s)是一个真正的平台，提供运行环境，使得复杂要求的应用在上面构建。它通过yaml语言写的配置文件，很简单快速的就能自动通过Docker镜像部署好应用环境，支持应用横向扩展，并且可以组织、编排、管理和迁移这些容器化的应用。</p>
<p>本文主要介绍在Ubuntu 16.04上使用kubeadm搭建一个集群环境。</p>
<a id="more"></a>
<p><strong>Kubernetes架构</strong></p>
<p><img src="https://www.hi-linux.com/img/linux/k8s_01.jpg" alt=""></p>
<p><strong>Kubernetes地位</strong></p>
<p><img src="https://www.hi-linux.com/img/linux/k8s_02.png" alt=""></p>
<p>K8s的地位如上图所示，优点是有很好的可移植性和可扩展性。关于K8s，这两个重要的性质表现在：</p>
<ul>
<li>可移植性：K8s可以搭建在阿里云、Amazon、Microsoft Azure、Google Cloud上，也可以搭建在任何的公有云和私有云上。</li>
</ul>
<ul>
<li>可扩展性：K8s在GitHub上托管，截至2017年3月1日有来自全球的1100名贡献者，为它提供了Dashboard、网络构件等扩展工具。</li>
</ul>
<p><strong>Kubernetes的核心组件</strong></p>
<p>Kubernetes将集群中的机器分为一个Master节点和一组Node节点。从kubernetes 1.4开始，各个核心组件也是以容器形式运行在Master的node上。</p>
<p>其中Master节点上运行<code>kube-apiserver</code>,<code>kube-controller-manager</code>,<code>kube-scheduler</code>，这些容器负责整个集群的资源管理、Pod调度、安全控制、弹性伸缩和系统监控。Node节点是集群中的工作节点，运行真正的服务。</p>
<p>Pod是Node节点上的基本单元。Node节点上运行着kubelet进程，还有kube-proxy容器，它们负责Pod的创建、启动、监控、重启、销毁，同时实现负载均衡器。真正需要运行的服务被包装到对应的Pod中，成为Pod中运行的一个容器。</p>
<blockquote>
<p>Kubernetes官网: <a href="https://kubernetes.io/" target="_blank" rel="noopener">https://kubernetes.io/</a><br>
Kubernetes中文社区: <a href="https://www.kubernetes.org.cn/" target="_blank" rel="noopener">https://www.kubernetes.org.cn/</a></p>
</blockquote>
<h3 id="前期环境准备与约束">前期环境准备与约束</h3>
<p>准备了两台Ubuntu 16.04虚拟机，各项参数如下：</p>
<table>
<thead>
<tr>
<th>节点机器名</th>
<th>IP地址</th>
<th>CPU</th>
<th>内存</th>
</tr>
</thead>
<tbody>
<tr>
<td>dev-master-01</td>
<td>10.211.55.11</td>
<td>2核</td>
<td>2GB</td>
</tr>
<tr>
<td>dev-node-01</td>
<td>10.211.55.12</td>
<td>2核</td>
<td>1GB</td>
</tr>
</tbody>
</table>
<p>Kubernetes官网上提到每台机器至少要有1GB内存，不然集群运行之后，留给运行在容器内的应用的内存就很少了。同时要保证所有机器之前的网络是互相连通的。</p>
<h3 id="部署kubernetes-master">部署Kubernetes Master</h3>
<p>安装内容包括:</p>
<ul>
<li>docker：容器运行的软件。</li>
<li>kubelet：kubelet是Kubernets最重要的组件，它要运行在集群上所有的机器，用来执行类似于开启pods和容器。</li>
<li>kubectl：在集群运行时，控制容器的部件。只需要将其运行在主节点上，但是它将对所有节点都有效。</li>
<li>Kubeadm：集群的引导程序。</li>
</ul>
<h4 id="安装kubernetes相关软件包">安装Kubernetes相关软件包</h4>
<p>由于墙的原因无法直接访问到Google的软件仓库(<a href="http://packages.cloud.google.com" target="_blank" rel="noopener">packages.cloud.google.com</a>)和容器仓库(<a href="http://gcr.io" target="_blank" rel="noopener">gcr.io</a>)，解决方法有两种：一是直接配置的Hosts文件，二是使用三方源或转存的容器仓库。这里使用修改Hosts文件的方法。</p>
<p>把下面几行内容加入到hosts文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim  /etc/hosts</span><br><span class="line"></span><br><span class="line">61.91.161.217 gcr.io</span><br><span class="line">61.91.161.217 www.gcr.io</span><br><span class="line">61.91.161.217 packages.cloud.google.com</span><br></pre></td></tr></table></figure>
<p>最新可用的Google hosts文件可在这里获取：<a href="https://github.com/racaljk/hosts" target="_blank" rel="noopener">https://github.com/racaljk/hosts</a></p>
<ul>
<li>安装kubernetes相关软件包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">$ cat &lt;&lt;EOF &gt; /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb http://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">$ apt-get update</span><br><span class="line">$ apt-get install -y kubelet kubeadm kubectl kubernetes-cni</span><br></pre></td></tr></table></figure>
<ul>
<li>安装Docker</li>
</ul>
<p>直接通过安装脚本一键安装Docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br></pre></td></tr></table></figure>
<ul>
<li>清除可能与kubernetes冲突的设置</li>
</ul>
<p>关闭 SELinux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt install -y selinux-utils</span><br><span class="line">$ setenforce 0</span><br></pre></td></tr></table></figure>
<p>清除iptables</p>
<p>避免自定义iptables影响kubernetes服务工作，建议自定义需求通过kubernetes实现。如果满足不了，安装好kubernetes后，再配置自定义iptables。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -t filter -F</span><br><span class="line">$ iptables -t nat -F</span><br><span class="line">$ iptables -t mangle -F</span><br></pre></td></tr></table></figure>
<ul>
<li>准备镜像</li>
</ul>
<p>下载docker镜像</p>
<p>由于墙的原因，从Google下载相关镜像速度很慢。为了更加顺利的搭建集群，建议优先下载好相应镜像。</p>
<p>Kubernetes-1.5.2所需要的镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull gcr.io/google_containers/kube-apiserver-amd64:v1.5.4</span><br><span class="line">$ docker pull gcr.io/google_containers/kube-controller-manager-amd64:v1.5.4</span><br><span class="line">$ docker pull gcr.io/google_containers/kube-scheduler-amd64:v1.5.4              </span><br><span class="line">$ docker pull gcr.io/google_containers/kube-proxy-amd64:v1.5.4              </span><br><span class="line">$ docker pull gcr.io/google_containers/kube-apiserver-amd64:v1.5.2              </span><br><span class="line">$ docker pull gcr.io/google_containers/kube-scheduler-amd64:v1.5.2              </span><br><span class="line">$ docker pull gcr.io/google_containers/kube-controller-manager-amd64:v1.5.2</span><br><span class="line">$ docker pull gcr.io/google_containers/etcd-amd64:3.0.14-kubeadm      </span><br><span class="line">$ docker pull gcr.io/google_containers/kubedns-amd64:1.9                 </span><br><span class="line">$ docker pull gcr.io/google_containers/dnsmasq-metrics-amd64:1.0                 </span><br><span class="line">$ docker pull gcr.io/google_containers/kube-dnsmasq-amd64:1.4                 </span><br><span class="line">$ docker pull gcr.io/google_containers/kube-discovery-amd64:1.0                 </span><br><span class="line">$ docker pull gcr.io/google_containers/exechealthz-amd64:1.2                 </span><br><span class="line">$ docker pull gcr.io/google_containers/pause-amd6:3.0                 </span><br><span class="line">$ docker pull gcr.io/google_containers/kubernetes-dashboard-amd64:v1.6.0</span><br><span class="line">$ docker pull quay.io/coreos/flannel:v0.7.0-amd64</span><br></pre></td></tr></table></figure>
<h4 id="部署kubernetes-master">部署Kubernetes master</h4>
<p>理论上通过kubeadm使用init和join命令即可建立一个集群，这init就是在master节点对集群进行初始化。和k8s 1.4之前的部署方式不同的是kubeadm安装的k8s核心组件都是以容器的形式运行于master node上的。</p>
<p><strong>初始化master</strong></p>
<p>使用kubeadm init初始化kubernetes master。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm init --use-kubernetes-version=v1.5.2 --pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure>
<p>说明：kubeadm init并没有为你选择一个默认的Pod network进行安装。这里使用flannel作为Pod network。那么在执行init时，我们必须给init命令带上<code>--pod-network-cidr=10.244.0.0/16</code>。</p>
<p>如果有多网卡的，请根据实际情况配置<code>--api-advertise-addresses=&lt;ip-address&gt;</code>，单网卡情况可以省略。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm init --use-kubernetes-version=v1.5.2 --pod-network-cidr=10.244.0.0/16 --api-advertise-addresses=10.211.55.11</span><br></pre></td></tr></table></figure>
<p>实测中发现kubeadm暂时还不支持docker 17.03.0-ce版本，会报以下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm init --pod-network-cidr=10.244.0.0/16</span><br><span class="line">[kubeadm] WARNING: kubeadm is in alpha, please do not use it for production clusters.</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] The system verification failed. Printing the output from the verification:</span><br><span class="line">OS: Linux</span><br><span class="line">KERNEL_VERSION: 4.4.0-62-generic</span><br><span class="line">CONFIG_NAMESPACES: enabled</span><br><span class="line">CONFIG_NET_NS: enabled</span><br><span class="line">CONFIG_PID_NS: enabled</span><br><span class="line">CONFIG_IPC_NS: enabled</span><br><span class="line">CONFIG_UTS_NS: enabled</span><br><span class="line">CONFIG_CGROUPS: enabled</span><br><span class="line">CONFIG_CGROUP_CPUACCT: enabled</span><br><span class="line">CONFIG_CGROUP_DEVICE: enabled</span><br><span class="line">CONFIG_CGROUP_FREEZER: enabled</span><br><span class="line">CONFIG_CGROUP_SCHED: enabled</span><br><span class="line">CONFIG_CPUSETS: enabled</span><br><span class="line">CONFIG_MEMCG: enabled</span><br><span class="line">CONFIG_INET: enabled</span><br><span class="line">CONFIG_EXT4_FS: enabled</span><br><span class="line">CONFIG_PROC_FS: enabled</span><br><span class="line">CONFIG_NETFILTER_XT_TARGET_REDIRECT: enabled (as module)</span><br><span class="line">CONFIG_NETFILTER_XT_MATCH_COMMENT: enabled (as module)</span><br><span class="line">CONFIG_OVERLAY_FS: enabled (as module)</span><br><span class="line">CONFIG_AUFS_FS: enabled (as module)</span><br><span class="line">CONFIG_BLK_DEV_DM: enabled</span><br><span class="line">CGROUPS_CPU: enabled</span><br><span class="line">CGROUPS_CPUACCT: enabled</span><br><span class="line">CGROUPS_CPUSET: enabled</span><br><span class="line">CGROUPS_DEVICES: enabled</span><br><span class="line">CGROUPS_FREEZER: enabled</span><br><span class="line">CGROUPS_MEMORY: enabled</span><br><span class="line">DOCKER_VERSION: 17.03.0-ce</span><br><span class="line">[preflight] Some fatal errors occurred:</span><br><span class="line">	unsupported docker version: 17.03.0-ce</span><br><span class="line">[preflight] If you know what you are doing, you can skip pre-flight checks with `--skip-preflight-checks`</span><br></pre></td></tr></table></figure>
<p>根据提示加上<code>--skip-preflight-checks</code>参数后，继续初始化master。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm init --pod-network-cidr=10.244.0.0/16 --skip-preflight-checks</span><br><span class="line">[kubeadm] WARNING: kubeadm is in alpha, please do not use it for production clusters.</span><br><span class="line">[preflight] Skipping pre-flight checks</span><br><span class="line">[preflight] Starting the kubelet service</span><br><span class="line">[init] Using Kubernetes version: v1.5.4</span><br><span class="line">[tokens] Generated token: &quot;e4f68e.6cc8c11c93148cd7&quot;</span><br><span class="line">[certificates] Generated Certificate Authority key and certificate.</span><br><span class="line">[certificates] Generated API Server key and certificate</span><br><span class="line">[certificates] Generated Service Account signing keys</span><br><span class="line">[certificates] Created keys and certificates in &quot;/etc/kubernetes/pki&quot;</span><br><span class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/admin.conf&quot;</span><br><span class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/kubelet.conf&quot;</span><br><span class="line">[apiclient] Created API client, waiting for the control plane to become ready</span><br><span class="line">[apiclient] All control plane components are healthy after 62.298779 seconds</span><br><span class="line">[apiclient] Waiting for at least one node to register and become ready</span><br><span class="line">[apiclient] First node is ready after 0.508216 seconds</span><br><span class="line">[apiclient] Creating a test deployment</span><br><span class="line">[apiclient] Test deployment succeeded</span><br><span class="line">[token-discovery] Created the kube-discovery deployment, waiting for it to become ready</span><br><span class="line">[token-discovery] kube-discovery is ready after 23.003368 seconds</span><br><span class="line">[addons] Created essential addon: kube-proxy</span><br><span class="line">[addons] Created essential addon: kube-dns</span><br><span class="line"></span><br><span class="line">Your Kubernetes master has initialized successfully!</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">    http://kubernetes.io/docs/admin/addons/</span><br><span class="line"></span><br><span class="line">You can now join any number of machines by running the following on each node:</span><br><span class="line"></span><br><span class="line">kubeadm join --token=e4f68e.6cc8c11c93148cd7 10.211.55.11</span><br></pre></td></tr></table></figure>
<p>初始化成功后，检查Kubernetes的核心组件均正常启动。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ps axu|grep kube</span><br><span class="line">root      2641 10.6  3.8 442928 79672 ?        Ssl  11:39  11:25 /usr/bin/kubelet --kubeconfig=/etc/kubernetes/kubelet.conf --require-kubeconfig=true --pod-manifest-path=/etc/kubernetes/manifests --allow-privileged=true --network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin --cluster-dns=10.96.0.10 --cluster-domain=cluster.local</span><br><span class="line">root      2917  0.1  1.3  41268 28316 ?        Ssl  11:40   0:09 kube-scheduler --address=127.0.0.1 --leader-elect --master=127.0.0.1:8080</span><br><span class="line">root      2961  1.2  7.4 187696 151428 ?       Ssl  11:40   1:18 kube-apiserver --insecure-bind-address=127.0.0.1 --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota --service-cluster-ip-range=10.96.0.0/12 --service-account-key-file=/etc/kubernetes/pki/apiserver-key.pem --client-ca-file=/etc/kubernetes/pki/ca.pem --tls-cert-file=/etc/kubernetes/pki/apiserver.pem --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem --token-auth-file=/etc/kubernetes/pki/tokens.csv --secure-port=6443 --allow-privileged --advertise-address=10.211.55.11 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --anonymous-auth=false --etcd-servers=http://127.0.0.1:2379</span><br><span class="line">root      3810  1.5  3.0  87448 62936 ?        Ssl  11:56   1:22 kube-controller-manager --address=127.0.0.1 --leader-elect --master=127.0.0.1:8080 --cluster-name=kubernetes --root-ca-file=/etc/kubernetes/pki/ca.pem --service-account-private-key-file=/etc/kubernetes/pki/apiserver-key.pem --cluster-signing-cert-file=/etc/kubernetes/pki/ca.pem --cluster-signing-key-file=/etc/kubernetes/pki/ca-key.pem --insecure-experimental-approve-all-kubelet-csrs-for-group=system:kubelet-bootstrap --allocate-node-cidrs=true --cluster-cidr=10.244.0.0/16</span><br><span class="line">root      4018  0.0  0.2   8136  5412 ?        Ssl  11:56   0:00 /usr/local/bin/kube-discovery</span><br><span class="line">root      5397  0.1  1.3  37788 28504 ?        Ssl  11:56   0:06 kube-proxy --kubeconfig=/run/kubeconfig</span><br><span class="line">root     14658  0.0  0.0  14224   880 pts/0    S+   13:26   0:00 grep --color=auto kube</span><br></pre></td></tr></table></figure>
<p>以容器方式启动的各个组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                                                           COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">fe8cb027820d        gcr.io/google_containers/kube-proxy-amd64:v1.5.4                &quot;kube-proxy --kube...&quot;   About an hour ago   Up About an hour                        k8s_kube-proxy.f7c0b53a_kube-proxy-hz20c_kube-system_61d0bb98-0dea-11e7-bc5c-001c4297532a_f9cc7706</span><br><span class="line">9cd5828d28a3        gcr.io/google_containers/pause-amd64:3.0                        &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_POD.d8dbe16c_kube-proxy-hz20c_kube-system_61d0bb98-0dea-11e7-bc5c-001c4297532a_28af414a</span><br><span class="line">60b8f173f012        gcr.io/google_containers/kube-discovery-amd64:1.0               &quot;/usr/local/bin/ku...&quot;   About an hour ago   Up About an hour                        k8s_kube-discovery.3779cb59_kube-discovery-1769846148-kqb1x_kube-system_5419f72e-0dea-11e7-bc5c-001c4297532a_463dc1ad</span><br><span class="line">19d3bf10369d        gcr.io/google_containers/pause-amd64:3.0                        &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_POD.d8dbe16c_kube-discovery-1769846148-kqb1x_kube-system_5419f72e-0dea-11e7-bc5c-001c4297532a_2c04d6c8</span><br><span class="line">8d65a04af9bd        gcr.io/google_containers/pause-amd64:3.0                        &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_dummy.f0681c27_dummy-2088944543-ctnqh_kube-system_53801181-0dea-11e7-bc5c-001c4297532a_6058f6f7</span><br><span class="line">e4680cf8734d        gcr.io/google_containers/pause-amd64:3.0                        &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_POD.d8dbe16c_dummy-2088944543-ctnqh_kube-system_53801181-0dea-11e7-bc5c-001c4297532a_95e00970</span><br><span class="line">6d0ef0103edc        gcr.io/google_containers/kube-controller-manager-amd64:v1.5.4   &quot;kube-controller-m...&quot;   About an hour ago   Up About an hour                        k8s_kube-controller-manager.9a35b2e8_kube-controller-manager-dev-master-01_kube-system_04aa781520126ecd226bff8cb5e8f11a_0eef3909</span><br><span class="line">f592f0cd853d        gcr.io/google_containers/kube-apiserver-amd64:v1.5.4            &quot;kube-apiserver --...&quot;   About an hour ago   Up About an hour                        k8s_kube-apiserver.3d6f374_kube-apiserver-dev-master-01_kube-system_c7b047fbcc13d76494cea24a2ad9a1ba_f1d0d4a1</span><br><span class="line">08ced03e0141        gcr.io/google_containers/kube-scheduler-amd64:v1.5.4            &quot;kube-scheduler --...&quot;   About an hour ago   Up About an hour                        k8s_kube-scheduler.1a2dd753_kube-scheduler-dev-master-01_kube-system_1af062e8f950e8085a65134d9d314b76_537f210b</span><br><span class="line">f5f1eb371488        gcr.io/google_containers/etcd-amd64:3.0.14-kubeadm              &quot;etcd --listen-cli...&quot;   About an hour ago   Up About an hour                        k8s_etcd.c323986f_etcd-dev-master-01_kube-system_3a26566bb004c61cd05382212e3f978f_3ffb0064</span><br><span class="line">c43f82a7ef1c        gcr.io/google_containers/pause-amd64:3.0                        &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_POD.d8dbe16c_kube-controller-manager-dev-master-01_kube-system_04aa781520126ecd226bff8cb5e8f11a_166b1b6a</span><br><span class="line">e8aeabbf4beb        gcr.io/google_containers/pause-amd64:3.0                        &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_POD.d8dbe16c_kube-apiserver-dev-master-01_kube-system_c7b047fbcc13d76494cea24a2ad9a1ba_993bfda3</span><br><span class="line">6a7cbc9f0739        gcr.io/google_containers/pause-amd64:3.0                        &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_POD.d8dbe16c_etcd-dev-master-01_kube-system_3a26566bb004c61cd05382212e3f978f_6f7d0263</span><br><span class="line">1c2348c77a9b        gcr.io/google_containers/pause-amd64:3.0                        &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_POD.d8dbe16c_kube-scheduler-dev-master-01_kube-system_1af062e8f950e8085a65134d9d314b76_e6907a26</span><br></pre></td></tr></table></figure>
<p>不过这些核心组件并不是跑在pod network中的，而是采用了host network。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod  --all-namespaces -o wide</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                                    READY     STATUS              RESTARTS   AGE       IP             NODE</span><br><span class="line">kube-system   dummy-2088944543-ctnqh                  1/1       Running             0          1h        10.211.55.11   dev-master-01</span><br><span class="line">kube-system   etcd-dev-master-01                      1/1       Running             1          2h        10.211.55.11   dev-master-01</span><br><span class="line">kube-system   kube-apiserver-dev-master-01            1/1       Running             0          2h        10.211.55.11   dev-master-01</span><br><span class="line">kube-system   kube-controller-manager-dev-master-01   1/1       Running             0          2h        10.211.55.11   dev-master-01</span><br><span class="line">kube-system   kube-discovery-1769846148-kqb1x         1/1       Running             0          1h        10.211.55.11   dev-master-01</span><br><span class="line">kube-system   kube-dns-2924299975-8r4st               0/4       ContainerCreating   0          1h        &lt;none&gt;         dev-master-01</span><br><span class="line">kube-system   kube-proxy-hz20c                        1/1       Running             0          1h        10.211.55.11   dev-master-01</span><br><span class="line">kube-system   kube-scheduler-dev-master-01            1/1       Running             0          2h        10.211.55.11   dev-master-01</span><br></pre></td></tr></table></figure>
<p><strong>安装flannel pod网络</strong></p>
<p>Kubernetes一共提供五种网络组件，可以根据自己的需要选择。要使用Flannel网络，因此我们需要执行如下安装命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f  https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"></span><br><span class="line">serviceaccount &quot;flannel&quot; created</span><br><span class="line">configmap &quot;kube-flannel-cfg&quot; created</span><br><span class="line">daemonset &quot;kube-flannel-ds&quot; created</span><br></pre></td></tr></table></figure>
<p>根据网络状况，安装过程需要一定的时间，最后要确保所有的Pod都处于Running状态。</p>
<p>稍等片刻，我们再来看master node上的cluster信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ps aux|grep kube|grep flannel</span><br><span class="line">root       718  0.0  1.5 252216 32176 ?        Ssl  15:25   0:00 /opt/bin/flanneld --ip-masq --kube-subnet-mgr</span><br><span class="line">root       758  0.0  0.0   8096  1880 ?        Ss   15:25   0:00 /bin/sh -c set -e -x; cp -f /etc/kube-flannel/cni-conf.json /etc/cni/net.d/10-flannel.conf; while true; do sleep 3600; done</span><br></pre></td></tr></table></figure>
<p>检查各节点组件运行状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods --all-namespaces</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                                    READY     STATUS              RESTARTS   AGE</span><br><span class="line">default       kube-flannel-ds-m556b                   2/2       Running             3          2h</span><br><span class="line">kube-system   dummy-2088944543-ctnqh                  1/1       Running             1          3h</span><br><span class="line">kube-system   etcd-dev-master-01                      1/1       Running             2          4h</span><br><span class="line">kube-system   kube-apiserver-dev-master-01            1/1       Running             1          4h</span><br><span class="line">kube-system   kube-controller-manager-dev-master-01   1/1       Running             1          4h</span><br><span class="line">kube-system   kube-discovery-1769846148-cpf2m         1/1       Running             0          8m</span><br><span class="line">kube-system   kube-dns-2924299975-8r4st               4/4       Running             0          3h</span><br><span class="line">kube-system   kube-proxy-hz20c                        1/1       Running             1          3h</span><br><span class="line">kube-system   kube-scheduler-dev-master-01            1/1       Running             1          4h</span><br></pre></td></tr></table></figure>
<p>如果你非常想要知道它的状态及详细原因，对应你自己的NameSpace和Name把下面这条命令改一下，就可以看到详细信息了。常见的状态有RunContainerError,CrashLoopBackOff,ContainerCreating。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe -n default  po kube-flannel-ds-m556b</span><br><span class="line">$ kubectl describe -n kube-system po kube-dns-2924299975-8r4st</span><br></pre></td></tr></table></figure>
<p><strong>验证是否部署成功</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes</span><br><span class="line">NAME            STATUS         AGE</span><br><span class="line">dev-master-01   Ready,master   5h</span><br></pre></td></tr></table></figure>
<p>或者访问http://localhost:8080出现这个也表示ok了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:8080</span><br><span class="line">&#123;</span><br><span class="line">  &quot;paths&quot;: [</span><br><span class="line">    &quot;/api&quot;,</span><br><span class="line">    &quot;/api/v1&quot;,</span><br><span class="line">    &quot;/apis&quot;,</span><br><span class="line">    &quot;/apis/apps&quot;,</span><br><span class="line">    &quot;/apis/apps/v1beta1&quot;,</span><br><span class="line">    &quot;/apis/authentication.k8s.io&quot;,</span><br><span class="line">    &quot;/apis/authentication.k8s.io/v1beta1&quot;,</span><br><span class="line">    &quot;/apis/authorization.k8s.io&quot;,</span><br><span class="line">    &quot;/apis/authorization.k8s.io/v1beta1&quot;,</span><br><span class="line">    &quot;/apis/autoscaling&quot;,</span><br><span class="line">    &quot;/apis/autoscaling/v1&quot;,</span><br><span class="line">    &quot;/apis/batch&quot;,</span><br><span class="line">    &quot;/apis/batch/v1&quot;,</span><br><span class="line">    &quot;/apis/batch/v2alpha1&quot;,</span><br><span class="line">    &quot;/apis/certificates.k8s.io&quot;,</span><br><span class="line">    &quot;/apis/certificates.k8s.io/v1alpha1&quot;,</span><br><span class="line">    &quot;/apis/extensions&quot;,</span><br><span class="line">    &quot;/apis/extensions/v1beta1&quot;,</span><br><span class="line">    &quot;/apis/policy&quot;,</span><br><span class="line">    &quot;/apis/policy/v1beta1&quot;,</span><br><span class="line">    &quot;/apis/rbac.authorization.k8s.io&quot;,</span><br><span class="line">    &quot;/apis/rbac.authorization.k8s.io/v1alpha1&quot;,</span><br><span class="line">    &quot;/apis/storage.k8s.io&quot;,</span><br><span class="line">    &quot;/apis/storage.k8s.io/v1beta1&quot;,</span><br><span class="line">    &quot;/healthz&quot;,</span><br><span class="line">    &quot;/healthz/poststarthook/bootstrap-controller&quot;,</span><br><span class="line">    &quot;/healthz/poststarthook/extensions/third-party-resources&quot;,</span><br><span class="line">    &quot;/healthz/poststarthook/rbac/bootstrap-roles&quot;,</span><br><span class="line">    &quot;/logs&quot;,</span><br><span class="line">    &quot;/metrics&quot;,</span><br><span class="line">    &quot;/swaggerapi/&quot;,</span><br><span class="line">    &quot;/ui/&quot;,</span><br><span class="line">    &quot;/version&quot;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>
<h3 id="部署kubernetes-node">部署Kubernetes node</h3>
<p>根据Master上初始化成功后会打印的token，把minion node加入cluster。（注意：这里要保证master node的9898端口在防火墙是打开的）</p>
<p>在minion node上执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm join --token=e4f68e.6cc8c11c93148cd7 10.211.55.11 --skip-preflight-checks</span><br><span class="line"></span><br><span class="line">[kubeadm] WARNING: kubeadm is in alpha, please do not use it for production clusters.</span><br><span class="line">[preflight] Skipping pre-flight checks</span><br><span class="line">[tokens] Validating provided token</span><br><span class="line">[discovery] Created cluster info discovery client, requesting info from &quot;http://10.211.55.11:9898/cluster-info/v1/?token-id=e4f68e&quot;</span><br><span class="line">[discovery] Cluster info object received, verifying signature using given token</span><br><span class="line">[discovery] Cluster info signature and contents are valid, will use API endpoints [https://10.211.55.11:6443]</span><br><span class="line">[bootstrap] Trying to connect to endpoint https://10.211.55.11:6443</span><br><span class="line">[bootstrap] Detected server version: v1.5.4</span><br><span class="line">[bootstrap] Successfully established connection with endpoint &quot;https://10.211.55.11:6443&quot;</span><br><span class="line">[csr] Created API client to obtain unique certificate for this node, generating keys and certificate signing request</span><br><span class="line">[csr] Received signed certificate from the API server:</span><br><span class="line">Issuer: CN=kubernetes | Subject: CN=system:node:dev-node-01 | CA: false</span><br><span class="line">Not before: 2017-03-21 09:19:00 +0000 UTC Not After: 2018-03-21 09:19:00 +0000 UTC</span><br><span class="line">[csr] Generating kubelet configuration</span><br><span class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/kubelet.conf&quot;</span><br><span class="line"></span><br><span class="line">Node join complete:</span><br><span class="line">* Certificate signing request sent to master and response</span><br><span class="line">  received.</span><br><span class="line">* Kubelet informed of new secure connection details.</span><br><span class="line"></span><br><span class="line">Run &apos;kubectl get nodes&apos; on the master to see this machine join.</span><br></pre></td></tr></table></figure>
<p><strong>验证是否加入成功</strong></p>
<p>加入节点后，可以在master上验证下相关信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes</span><br><span class="line"></span><br><span class="line">NAME            STATUS         AGE</span><br><span class="line">dev-master-01   Ready,master   5h</span><br><span class="line">dev-node-01     Ready          1m</span><br></pre></td></tr></table></figure>
<p>上述这样以来基础环境就搭好了。不过只不过是万里长征第一步，折腾才刚刚开始而已。颤抖吧，少年！</p>
<h3 id="一些小技巧">一些小技巧</h3>
<ul>
<li>由于使用kubeadm安装的kubernetes核心组件都是以docker容器的形式运行，如果安装过程出现问题，需要先执行下面的命令清理之前的执行残留后，才能重新开始。</li>
</ul>
<p>kubeadm会自动检查当前环境是否有上次命令执行的“残留”。如果有，必须清理后再行执行init。我们可以通过”kubeadm reset”来清理环境，以备重来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo kubeadm reset</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[reset] Stopping the kubelet service</span><br><span class="line">[reset] Unmounting mounted directories in &quot;/var/lib/kubelet&quot;</span><br><span class="line">[reset] Removing kubernetes-managed containers</span><br><span class="line">[reset] Deleting contents of stateful directories: [/var/lib/kubelet /etc/cni/net.d /var/lib/etcd]</span><br><span class="line">[reset] Deleting contents of config directories: [/etc/kubernetes/manifests /etc/kubernetes/pki]</span><br><span class="line">[reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/kubelet.conf]</span><br></pre></td></tr></table></figure>
<ul>
<li>如果容器部署过程中失败，你非常想要知道它的状态及详细原因。可使用如下指令：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe -n default  po kube-flannel-ds-m556b</span><br><span class="line">$ kubectl describe -n kube-system po kube-dns-2924299975-8r4st</span><br></pre></td></tr></table></figure>
<h3 id="参考文档">参考文档</h3>
<p><a href="http://www.google.com" target="_blank" rel="noopener">http://www.google.com</a><br>
<a href="http://t.cn/RIBS5ji" target="_blank" rel="noopener">http://t.cn/RIBS5ji</a><br>
<a href="http://www.jianshu.com/p/a05a2f778324" target="_blank" rel="noopener">http://www.jianshu.com/p/a05a2f778324</a><br>
<a href="http://www.jianshu.com/p/602c5bdbbd4d" target="_blank" rel="noopener">http://www.jianshu.com/p/602c5bdbbd4d</a><br>
<a href="http://blog.frognew.com/2017/01/install-kubernetes-with-kubeadm.html" target="_blank" rel="noopener">http://blog.frognew.com/2017/01/install-kubernetes-with-kubeadm.html</a><br>
<a href="https://jicki.me/2016/12/13/kubernetes-1.5.0/" target="_blank" rel="noopener">https://jicki.me/2016/12/13/kubernetes-1.5.0/</a></p>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/posts/14615/" data-toggle="tooltip" data-placement="top" title="使用 Nginx 实现 UDP 反向代理">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/posts/28902/" data-toggle="tooltip" data-placement="top" title="Docker 容器状态命令行工具 Ctop">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                
                    <!-- disqus 评论框 start -->
                    <div class="comment">
                        <div id="lv-container" data-id="city" data-uid="MTAyMC8yNzg2My80NDQw"></div>
                    </div>
                    <!-- disqus 评论框 end -->
                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#kubernetes是什么"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Kubernetes是什么？</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#前期环境准备与约束"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">前期环境准备与约束</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#部署kubernetes-master"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">部署Kubernetes Master</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#安装kubernetes相关软件包"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">安装Kubernetes相关软件包</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#部署kubernetes-master"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">部署Kubernetes master</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#部署kubernetes-node"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">部署Kubernetes node</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#一些小技巧"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">一些小技巧</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参考文档"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">参考文档</span></a></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
                        
                          <a class="tag" href="/tags/#Docker" title="Docker">Docker</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://www.mike.org.cn/" target="_blank">简单.生活</a></li>
                    
                        <li><a href="http://shang.qq.com/wpa/qunwpa?idkey=ea4c43493c2269428ac6ef6141de4b6d78e5ab2d41380ca4099b833b62884ee9" target="_blank">技术交流群</a></li>
                    
                        <li><a href="" target="_blank"></a></li>
                    
                        <li><a href="" target="_blank"></a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






    <!-- 来必力City版公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
       (function(d, s) {
           var j, e = d.getElementsByTagName(s)[0];
    
           if (typeof LivereTower === 'function') { return; }
    
           j = d.createElement(s);
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;
    
           e.parentNode.insertBefore(j, e);
       })(document, 'script');
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    <!-- 来必力City版 公共JS代码 end -->



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                    <li>
                        <a href="/atom.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/80imike">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/2093524665">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Mike 2018 | Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com">胡伟煌</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://www.hi-linux.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://www.hi-linux.com/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
