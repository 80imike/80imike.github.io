<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="Linux,运维,Nginx,Zabbix,Centos,Ansible,MySQL,Python,Docker,ELK,Haproxy,Git,Nodejs,安全,技术">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          一文读懂开源日志管理方案 ELK 和 EFK 的区别 - 奇妙的 Linux 世界
        
    </title>

    <link rel="canonical" href="https://www.hi-linux.com/posts/50197.html">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
<link rel="stylesheet" href="/css/beantech.min.css">

    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/toc.css">


    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="奇妙的 Linux 世界" type="application/atom+xml">
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/header_img/building.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
                            
                              <a class="tag" href="/tags/#Kubernetes" title="Kubernetes">Kubernetes</a>
                            
                              <a class="tag" href="/tags/#Elasticsearch" title="Elasticsearch">Elasticsearch</a>
                            
                        </div>
                        <h1>一文读懂开源日志管理方案 ELK 和 EFK 的区别</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by Mike on
                            2020-12-31
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">奇妙的 Linux 世界</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <div id="vip-container"><h2><span id="前言">前言</span></h2>
<p>主流的 ELK (Elasticsearch, <code>Logstash</code>, Kibana) 目前已经转变为 EFK (Elasticsearch, <code>Filebeat</code> or <code>Fluentd</code>, Kibana) 比较重，对于容器云的日志方案业内也普遍推荐采用 Fluentd，我们一起来看下从 ELK 到 EFK 发生了哪些变化，与此同时我也推荐大家了解下 Grafana Loki</p>
<h2><span id="elk-和-efk-概述">ELK 和 EFK 概述</span></h2>
<p>随着现在各种软件系统的复杂度越来越高，特别是部署到云上之后，再想登录各个节点上查看各个模块的 log，基本是不可行了。因为不仅效率低下，而且有时由于安全性，不可能让工程师直接访问各个物理节点。而且现在大规模的软件系统基本都采用集群的部署方式，意味着对每个 service，会启动多个完全一样的 POD 对外提供服务，每个 container 都会产生自己的 log，仅从产生的 log 来看，你根本不知道是哪个 POD 产生的，这样对查看分布式的日志更加困难。</p>
<p>所以在云时代，需要一个收集并分析 log 的解决方案。首先需要将分布在各个角落的 log 收集到一个集中的地方，方便查看。收集了之后，还可以进行各种统计分析，甚至用流行的大数据或 maching learning 的方法进行分析。当然，对于传统的软件部署方式，也需要这样的 log 的解决方案，不过本文主要从云的角度来介绍。</p>
<p>ELK 就是这样的解决方案，而且基本就是事实上的标准。ELK 是三个开源项目的首字母缩写，如下：</p>
<blockquote>
<p>E: Elasticsearch</p>
<p>L: Logstash</p>
<p>K: Kibana</p>
</blockquote>
<a id="more"></a>
<p>Logstash 的主要作用是收集分布在各处的 log 并进行处理；Elasticsearch 则是一个集中存储 log 的地方，更重要的是它是一个全文检索以及分析的引擎，它能让用户以近乎实时的方式来查看、分析海量的数据。Kibana 则是为 Elasticsearch 开发的前端 GUI，让用户可以很方便的以图形化的接口查询 Elasticsearch 中存储的数据，同时也提供了各种分析的模块，比如构建 dashboard 的功能。</p>
<p>我个人认为将 ELK 中的 L 理解成 Logging Agent 更合适。Elasticsearch 和 Kibana 基本就是存储、检索和分析 log 的标准方案，而 Logstash 则并不是唯一的收集 log 的方案，Fluentd 和 Filebeats 也能用于收集 log。所以现在网上有 ELK，EFK 之类的缩写。</p>
<p>一般采用的架构如下图所示。通常一个小型的 cluster 有三个节点，在这三个节点上可能会运行几十个甚至上百个容器。而我们只需要在每个节点上启动一个 logging agent 的实例（在 kubernetes 中就是 DaemonSet 的概念）即可。</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201103151412.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201103151412-20201227171752168-2020-12-27-adWSyk.png" alt="img"></a></p>
<h2><span id="filebeats-logstash-fluentd-三者的区别和联系">Filebeats、Logstash、Fluentd 三者的区别和联系</span></h2>
<p>这里有必要对 Filebeats、Logstash 和 Fluentd 三者之间的联系和区别做一个简要的说明。Filebeats 是一个轻量级的收集本地 log 数据的方案，官方对 Filebeats 的说明如下。可以看出 Filebeats 功能比较单一，它仅仅只能收集本地的 log，但并不能对收集到的 Log 做什么处理，所以通常 Filebeats 通常需要将收集到的 log 发送到 Logstash 做进一步的处理。</p>
<p>Filebeat is a log data shipper for local files. Installed as an agent on your servers, Filebeat monitors the log directories or specific log files, tails the files, and forwards them either to Elasticsearch or Logstash for indexing</p>
<p>Logstash 和 Fluentd 都具有收集并处理 log 的能力，网上有很多关于二者的对比，提供一个写得比较好的文章链接如下。功能上二者旗鼓相当，但 Logstash 消耗更多的 memory，对此 Logstash 的解决方案是使用 Filebeats 从各个叶子节点上收集 log，当然 Fluentd 也有对应的 Fluent Bit。</p>
<p><a href="https://logz.io/blog/fluentd-Logstash/" target="_blank" rel="noopener">https://logz.io/blog/fluentd-Logstash/</a></p>
<p>另外一个重要的区别是 Fluentd 抽象性做得更好，对用户屏蔽了底层细节的繁琐。作者的原话如下：</p>
<p>Fluentd’s approach is more declarative whereas Logstash’s method is procedural. For programmers trained in procedural programming, Logstash’s configuration can be easier to get started. On the other hand, Fluentd’s tag-based routing allows complex routing to be expressed cleanly.</p>
<p>虽然作者说是要中立的对二者（Logstash 和 Fluentd）进行对比，但实际上偏向性很明显了：）。本文也主要基于 Fluentd 进行介绍，不过总体思路都是相通的。</p>
<p>额外说一点，Filebeats、Logstash、Elasticsearch 和 Kibana 是属于同一家公司的开源项目，官方文档如下：</p>
<p><a href="https://www.elastic.co/guide/index.html" target="_blank" rel="noopener">https://www.elastic.co/guide/index.html</a></p>
<p>Fluentd 则是另一家公司的开源项目，官方文档如下：</p>
<p><a href="https://docs.fluentd.org/" target="_blank" rel="noopener">https://docs.fluentd.org</a></p>
<h2><span id="关于-elk">关于 ELK</span></h2>
<h3><span id="elk-简介">ELK 简介</span></h3>
<p>ELK 是 Elastic 公司提供的一套完整的日志收集以及展示的解决方案，是三个产品的首字母缩写，分别是 Elasticsearch、Logstash 和 Kibana。</p>
<p><img src="https://img.hi-linux.com/staticfile/yNzE7m-2020-12-27-R7llen.jpg" alt="yNzE7m-2020-12-27-R7llen"></p>
<ul>
<li>Elasticsearch 是实时全文搜索和分析引擎，提供搜集、分析、存储数据三大功能</li>
<li>Logstash 是一个用来搜集、分析、过滤日志的工具</li>
<li>Kibana 是一个基于 Web 的图形界面，用于搜索、分析和可视化存储在 Elasticsearch 指标中的日志数据</li>
</ul>
<h3><span id="elk-日志处理流程">ELK 日志处理流程</span></h3>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102143528.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102143528-20201227171753070-2020-12-27-g8BWUq.png" alt="img"></a></p>
<p>上图展示了在 Docker 环境下，一个典型的 ELK 方案下的日志收集处理流程：</p>
<ul>
<li>Logstash 从各个 Docker 容器中提取日志信息</li>
<li>Logstash 将日志转发到 Elasticsearch 进行索引和保存</li>
<li>Kibana 负责分析和可视化日志信息</li>
</ul>
<p>由于 Logstash 在数据收集上并不出色，而且作为 Agent，其性能并不达标。基于此，Elastic 发布了 beats 系列轻量级采集组件。</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102143611.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102143611-20201227171753780-2020-12-27-oIzFLy.png" alt="img"></a></p>
<p>这里我们要实践的 Beat 组件是 Filebeat，Filebeat 是构建于 beats 之上的，应用于日志收集场景的实现，用来替代 Logstash Forwarder 的下一代 Logstash 收集器，是为了更快速稳定轻量低耗地进行收集工作，它可以很方便地与 Logstash 还有直接与 Elasticsearch 进行对接。</p>
<p>本次实验直接使用 Filebeat 作为 Agent，它会收集我们在第一篇《Docker logs &amp; logging driver》中介绍的 json-file 的 log 文件中的记录变动，并直接将日志发给 Elasticsearch 进行索引和保存，其处理流程变为下图，你也可以认为它可以称作 EFK。</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102143641.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102143641-20201227171755527-2020-12-27-H0tuM8.png" alt="img"></a></p>
<h2><span id="elk-套件的安装">ELK 套件的安装</span></h2>
<p>本次实验我们采用 Docker 方式部署一个最小规模的 ELK 运行环境，当然，实际环境中我们或许需要考虑高可用和负载均衡。</p>
<p>首先拉取一下 sebp/elk 这个集成镜像，这里选择的 tag 版本是 latest：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull sebp&#x2F;elk:latest</span><br></pre></td></tr></table></figure>
<p>注：由于其包含了整个 ELK 方案，所以需要耐心等待一会。</p>
<p>通过以下命令使用 sebp/elk 这个集成镜像启动运行 ELK：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --name elk \</span><br><span class="line">    -p 5601:5601 \</span><br><span class="line">    -p 9200:9200 \</span><br><span class="line">    -p 5044:5044 \</span><br><span class="line">    sebp&#x2F;elk:latest</span><br></pre></td></tr></table></figure>
<p>运行完成之后就可以先访问一下 <code>http://192.168.4.31:5601</code> 看看 Kibana 的效果：</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102143944.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102143944-20201227171757659-2020-12-27-FSjdYL.png" alt="img"></a></p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102144305.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102144305-20201227171759040-2020-12-27-jbdgcS.png" alt="img"></a></p>
<p>当然，目前没有任何可以显示的 ES 的索引和数据，再访问一下 <code>http://192.168.4.31:9200</code> 看看 Elasticsearch 的 API 接口是否可用：</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102144319.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102144319-20201227171800893-2020-12-27-8CsFqr.png" alt="img"></a></p>
<blockquote>
<p>注意：</p>
</blockquote>
<p>如果启动过程中发现一些错误，导致 ELK 容器无法启动，可以参考 <a href="https://www.cnblogs.com/zhi-leaf/p/8484337.html" target="_blank" rel="noopener">《ElasticSearch 启动常见错误》</a> 一文。如果你的主机内存低于 4G，建议增加配置设置 ES 内存使用大小，以免启动不了。例如下面增加的配置，限制 ES 内存使用最大为 1G：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --name elk \</span><br><span class="line">    -p 5601:5601 \</span><br><span class="line">    -p 9200:9200 \</span><br><span class="line">    -p 5044:5044 \</span><br><span class="line">    -e ES_MIN_MEM&#x3D;512m \</span><br><span class="line">    -e ES_MAX_MEM&#x3D;1024m \</span><br><span class="line">    sebp&#x2F;elk:latest</span><br></pre></td></tr></table></figure>
<p>若启动容器的时候提示 <code>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</code> 请参考</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 编辑 sysctl.con</span><br><span class="line">vi &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"># 添加下面配置</span><br><span class="line">vm.max_map_count&#x3D;655360</span><br><span class="line"># 然后执行命令</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<h2><span id="filebeat-配置">Filebeat 配置</span></h2>
<h3><span id="安装-filebeat">安装 Filebeat</span></h3>
<p><a href="https://www.elastic.co/downloads/beats/filebeat" target="_blank" rel="noopener">Download Filebeat</a></p>
<p>这里我们通过 rpm 的方式下载 Filebeat，注意这里下载和我们 ELK 对应的版本（ELK 是 7.6.1，这里也是下载 7.6.1，避免出现错误）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;beats&#x2F;filebeat&#x2F;filebeat-7.6.1-x86_64.rpm</span><br><span class="line">rpm -ivh filebeat-7.6.1-x86_64.rpm</span><br></pre></td></tr></table></figure>
<h3><span id="配置-filebeat">配置 Filebeat</span></h3>
<p>这里我们需要告诉 Filebeat 要监控哪些日志文件 及 将日志发送到哪里去，因此我们需要修改一下 Filebeat 的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano &#x2F;etc&#x2F;filebeat&#x2F;filebeat.yml</span><br></pre></td></tr></table></figure>
<p>要修改的内容为：</p>
<p>（1）监控哪些日志？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">filebeat.inputs:</span><br><span class="line"></span><br><span class="line"># Each - is an input. Most options can be set at the input level, so</span><br><span class="line"># you can use different inputs for various configurations.</span><br><span class="line"># Below are the input specific configurations.</span><br><span class="line"></span><br><span class="line">- type: log</span><br><span class="line"></span><br><span class="line">  # Change to true to enable this input configuration.</span><br><span class="line">  enabled: true</span><br><span class="line"></span><br><span class="line">  # Paths that should be crawled and fetched. Glob based paths.</span><br><span class="line">  paths:</span><br><span class="line">    - &#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;*&#x2F;*.log</span><br></pre></td></tr></table></figure>
<p>这里指定 paths：<code>/var/lib/docker/containers/*/*.log</code>，另外需要注意的是将 <code>enabled</code> 设为 <code>true</code>。</p>
<p>（2）将日志发到哪里？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#-------------------------- Elasticsearch output ------------------------------</span><br><span class="line">output.elasticsearch:</span><br><span class="line">  # Array of hosts to connect to.</span><br><span class="line">  hosts: [&quot;192.168.4.31:9200&quot;]</span><br><span class="line"></span><br><span class="line">  # Optional protocol and basic auth credentials.</span><br><span class="line">  #protocol: &quot;https&quot;</span><br><span class="line">  #username: &quot;elastic&quot;</span><br><span class="line">  #password: &quot;changeme&quot;</span><br></pre></td></tr></table></figure>
<p>这里指定直接发送到 Elasticsearch，配置一下 ES 的接口地址即可。</p>
<blockquote>
<p>注意：如果要发到 Logstash，请使用后面这段配置，将其取消注释进行相关配置即可：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#----------------------------- Logstash output --------------------------------</span><br><span class="line">#output.Logstash:</span><br><span class="line">  # The Logstash hosts</span><br><span class="line">  #hosts: [&quot;localhost:9200&quot;]</span><br><span class="line"></span><br><span class="line">  # Optional SSL. By default is off.</span><br><span class="line">  # List of root certificates for HTTPS server verifications</span><br><span class="line">  #ssl.certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;]</span><br><span class="line"></span><br><span class="line">  # Certificate for SSL client authentication</span><br><span class="line">  #ssl.certificate: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class="line"></span><br><span class="line">  # Client Certificate Key</span><br><span class="line">  #ssl.key: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br></pre></td></tr></table></figure>
<h3><span id="启动-filebeat">启动 Filebeat</span></h3>
<p>由于 Filebeat 在安装时已经注册为 systemd 的服务，所以只需要直接启动即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start filebeat</span><br></pre></td></tr></table></figure>
<p>设置开机启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable filebeat</span><br></pre></td></tr></table></figure>
<p>检查 Filebeat 启动状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status filebeat</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上述操作总结为脚本为：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;beats&#x2F;filebeat&#x2F;filebeat-7.6.1-x86_64.rpm</span><br><span class="line">rpm -ivh filebeat-7.6.1-x86_64.rpm</span><br><span class="line">echo &quot;please input elk host_ip&quot;</span><br><span class="line">read host_ip</span><br><span class="line"></span><br><span class="line">sed -i &quot;s&#x2F;  enabled: false&#x2F;  enabled: true&#x2F;g&quot; &#x2F;etc&#x2F;filebeat&#x2F;filebeat.yml</span><br><span class="line">sed -i &quot;s&#x2F;\&#x2F;var\&#x2F;log\&#x2F;\*.log&#x2F;\&#x2F;var\&#x2F;lib\&#x2F;docker\&#x2F;containers\&#x2F;\*\&#x2F;\*.log&#x2F;g&quot; &#x2F;etc&#x2F;filebeat&#x2F;filebeat.yml</span><br><span class="line">sed -i &quot;s&#x2F;localhost:9200&#x2F;$&#123;host_ip&#125;:9200&#x2F;g&quot; &#x2F;etc&#x2F;filebeat&#x2F;filebeat.yml</span><br><span class="line"></span><br><span class="line">systemctl start filebeat</span><br><span class="line">systemctl enable filebeat</span><br><span class="line">systemctl status filebeat</span><br></pre></td></tr></table></figure>
<h2><span id="kibana-配置">Kibana 配置</span></h2>
<p>接下来我们就要告诉 Kibana，要查询和分析 Elasticsearch 中的哪些日志，因此需要配置一个 Index Pattern。从 Filebeat 中我们知道 Index 是 filebeat-timestamp 这种格式，因此这里我们定义 Index Pattern 为 <code>filebeat-*</code></p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102153056.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102153056-20201227171801874-2020-12-27-A9dfZY.png" alt="img"></a></p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102153110.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102153110-20201227171803343-2020-12-27-dgHCab.png" alt="img"></a></p>
<p>点击 Next Step，这里我们选择 Time Filter field name 为 @timestamp：</p>
<p><img src="https://img.hi-linux.com/staticfile/7oRfXU-2020-12-27-vCn40M.jpg" alt="7oRfXU-2020-12-27-vCn40M"></p>
<p>单击 Create index pattern 按钮，即可完成配置。</p>
<p>这时我们单击 Kibana 左侧的 Discover 菜单，即可看到容器的日志信息啦：</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102153138.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102153138-20201227171805109-2020-12-27-8XwjPe.png" alt="img"></a></p>
<p>仔细看看细节，我们关注一下 message 字段：</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102153155.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102153155-20201227171805571-2020-12-27-CapfYV.png" alt="img"></a></p>
<p>可以看到，我们重点要关注的是 message，因此我们也可以筛选一下只看这个字段的信息：</p>
<p><img src="https://img.hi-linux.com/staticfile/fu2Q1N-2020-12-27-F6JxmO.jpg" alt="fu2Q1N-2020-12-27-F6JxmO"></p>
<p><img src="https://img.hi-linux.com/staticfile/MufL8A-2020-12-27-21oHVH.jpg" alt="MufL8A-2020-12-27-21oHVH"></p>
<p>这里只是朴素的展示了导入 ELK 的日志信息，实际上 ELK 还有很多很丰富的玩法，例如分析聚合、炫酷 Dashboard 等等。笔者在这里也是初步使用，就介绍到这里啦。</p>
<h2><span id="fluentd-引入">Fluentd 引入</span></h2>
<h3><span id="关于-fluentd">关于 Fluentd</span></h3>
<p>前面我们采用的是 Filebeat 收集 Docker 的日志信息，基于 Docker 默认的 json-file 这个 logging driver，这里我们改用 Fluentd 这个开源项目来替换 json-file 收集容器的日志。</p>
<p>Fluentd 是一个开源的数据收集器，专为处理数据流设计，使用 JSON 作为数据格式。它采用了插件式的架构，具有高可扩展性高可用性，同时还实现了高可靠的信息转发。Fluentd 也是云原生基金会 (CNCF) 的成员项目之一，遵循 Apache 2 License 协议，其 GitHub 地址为：<a href="https://github.com/fluent/fluentd/%E3%80%82Fluentd" target="_blank" rel="noopener">https://github.com/fluent/fluentd/。Fluentd</a> 与 Logstash 相比，比占用内存更少、社区更活跃，两者的对比可以参考这篇文章<a href="https://logz.io/blog/fluentd-Logstash/" target="_blank" rel="noopener">《Fluentd vs Logstash》</a>。</p>
<p>因此，整个日志收集与处理流程变为下图，我们用 Filebeat 将 Fluentd 收集到的日志转发给 Elasticsearch。</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102153447.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102153447-20201227171808047-2020-12-27-LU6D7k.png" alt="img"></a></p>
<p>当然，我们也可以使用 Fluentd 的插件（<code>fluent-plugin-elasticsearch</code>）直接将日志发送给 Elasticsearch，可以根据自己的需要替换掉 Filebeat，从而形成 Fluentd =&gt; Elasticsearch =&gt; Kibana 的架构，也称作 EFK。</p>
<h3><span id="运行-fluentd">运行 Fluentd</span></h3>
<p>这里我们通过容器来运行一个 Fluentd 采集器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --name fluentd \</span><br><span class="line">    -p 24224:24224 \</span><br><span class="line">    -p 24224:24224&#x2F;udp \</span><br><span class="line">    -v &#x2F;etc&#x2F;fluentd&#x2F;log:&#x2F;fluentd&#x2F;log \</span><br><span class="line">    fluent&#x2F;fluentd:latest</span><br></pre></td></tr></table></figure>
<p>默认 Fluentd 会使用 24224 端口，其日志会收集在我们映射的路径下。</p>
<p>此外，我们还需要修改 Filebeat 的配置文件，将 / etc/fluentd/log 加入监控目录下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Filebeat inputs &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">filebeat.inputs:</span><br><span class="line"></span><br><span class="line"># Each - is an input. Most options can be set at the input level, so</span><br><span class="line"># you can use different inputs for various configurations.</span><br><span class="line"># Below are the input specific configurations.</span><br><span class="line"></span><br><span class="line">- type: log</span><br><span class="line"></span><br><span class="line">  # Change to true to enable this input configuration.</span><br><span class="line">  enabled: true</span><br><span class="line"></span><br><span class="line">  # Paths that should be crawled and fetched. Glob based paths.</span><br><span class="line">  paths:</span><br><span class="line">    - &#x2F;etc&#x2F;fluentd&#x2F;log&#x2F;*.log</span><br></pre></td></tr></table></figure>
<p>添加监控配置之后，需要重新 restart 一下 filebeat：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart filebeat</span><br></pre></td></tr></table></figure>
<h3><span id="运行测试容器">运行测试容器</span></h3>
<p>为了验证效果，这里我们 Run 两个容器，并分别制定其 log-dirver 为 fluentd：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --log-driver&#x3D;fluentd \</span><br><span class="line">    --log-opt fluentd-address&#x3D;localhost:24224 \</span><br><span class="line">    --log-opt tag&#x3D;&quot;test-docker-A&quot; \</span><br><span class="line">    busybox sh -c &#39;while true; do echo &quot;This is a log message from container A&quot;; sleep 10; done;&#39;</span><br><span class="line"></span><br><span class="line">docker run -d \</span><br><span class="line">    --log-driver&#x3D;fluentd \</span><br><span class="line">    --log-opt fluentd-address&#x3D;localhost:24224 \</span><br><span class="line">    --log-opt tag&#x3D;&quot;test-docker-B&quot; \</span><br><span class="line">    busybox sh -c &#39;while true; do echo &quot;This is a log message from container B&quot;; sleep 10; done;&#39;</span><br></pre></td></tr></table></figure>
<p>这里通过指定容器的 log-driver，以及为每个容器设立了 tag，方便我们后面验证查看日志。</p>
<h3><span id="验证-efk-效果">验证 EFK 效果</span></h3>
<p>这时再次进入 Kibana 中查看日志信息，便可以通过刚刚设置的 tag 信息筛选到刚刚添加的容器的日志信息了：</p>
<p><a href="https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20201102153744.png" target="_blank" rel="noopener"><img src="https://img.hi-linux.com/staticfile/20201102153744-20201227171809122-2020-12-27-2mV6oe.png" alt="img"></a></p>
<h2><span id="模拟日志生成压力测试工具">模拟日志生成压力测试工具</span></h2>
<ol>
<li>
<p><a href="https://github.com/elastic/rally" target="_blank" rel="noopener">https://github.com/elastic/rally</a></p>
</li>
<li>
<p><a href="https://pypi.org/project/log-generator/" target="_blank" rel="noopener">https://pypi.org/project/log-generator/</a></p>
</li>
<li>
<p><a href="https://github.com/mingrammer/flog" target="_blank" rel="noopener">https://github.com/mingrammer/flog</a></p>
</li>
</ol>
<h2><span id="小结">小结</span></h2>
<p>本文从 ELK 的基本组成入手，介绍了 ELK 的基本处理流程，以及从 0 开始搭建了一个 ELK 环境，演示了基于 Filebeat 收集容器日志信息的案例。然后，通过引入 Fluentd 这个开源数据收集器，演示了如何基于 EFK 的日志收集案例。当然，ELK/EFK 有很多的知识点，笔者也还只是初步使用，希望未来能够分享更多的实践总结。</p>
<h2><span id="参考文章">参考文章</span></h2>
<ol>
<li>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener">Elasticsearch Reference</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/edisonchou/p/docker_logs_study_summary_part2.html" target="_blank" rel="noopener">开源日志管理方案 ELK/EFK</a></p>
</li>
<li>
<p><a href="https://ld246.com/article/1588145447021" target="_blank" rel="noopener">开源日志管理方案 ELK/EFK</a></p>
</li>
<li>
<p><a href="http://www.uml.org.cn/bigdata/202002193.asp?artid=22965" target="_blank" rel="noopener">ELK 构建云时代的 logging 解决方案</a></p>
</li>
<li>
<p><a href="https://www.qikqiak.com/post/install-efk-stack-on-k8s/" target="_blank" rel="noopener">在 Kubernetes 上搭建 EFK 日志收集系统</a></p>
</li>
<li>
<p><a href="https://qhh.me/2019/09/05/Kubernetes-%E5%9F%BA%E4%BA%8E-EFK-%E6%8A%80%E6%9C%AF%E6%A0%88%E7%9A%84%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%AE%9E%E8%B7%B5/" target="_blank" rel="noopener">Kubernetes 基于 EFK 技术栈的日志收集实践</a></p>
</li>
</ol>
<blockquote>
<p>本文转载自：「HelloDog」，原文：<a href="https://wsgzao.github.io/post/efk/%EF%BC%8C%E7%89%88%E6%9D%83%E5%BD%92%E5%8E%9F%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E6%AC%A2%E8%BF%8E%E6%8A%95%E7%A8%BF%EF%BC%8C%E6%8A%95%E7%A8%BF%E9%82%AE%E7%AE%B1:" target="_blank" rel="noopener">https://wsgzao.github.io/post/efk/，版权归原作者所有。欢迎投稿，投稿邮箱:</a> <a href="mailto:editor@hi-linux.com">editor@hi-linux.com</a>。</p>
</blockquote>
</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "10135-1588830050631-449",
			        "name": "「奇妙的 Linux 世界」",
			        "qrcode": "https://www.hi-linux.com/img/wechat/mp_qrcode_12.jpg",
			        "keyword": "VIP"
			    });
			}
			</script>
		
                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/posts/37112.html" data-toggle="tooltip" data-placement="top" title="终端共享神器 Tmate 简明教程">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/posts/39524.html" data-toggle="tooltip" data-placement="top" title="Kubernetes Dashboard 2.10 尝鲜记">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                
                    <!-- disqus 评论框 start -->
                    <div class="comment">
                        <div id="lv-container" data-id="city" data-uid="MTAyMC8yNzg2My80NDQw"></div>
                    </div>
                    <!-- disqus 评论框 end -->
                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">前言</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">ELK 和 EFK 概述</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">Filebeats、Logstash、Fluentd 三者的区别和联系</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">关于 ELK</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">ELK 简介</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">ELK 日志处理流程</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">ELK 套件的安装</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">Filebeat 配置</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">安装 Filebeat</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">配置 Filebeat</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">6.3.</span> <span class="toc-nav-text">启动 Filebeat</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">Kibana 配置</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">Fluentd 引入</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">8.1.</span> <span class="toc-nav-text">关于 Fluentd</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">8.2.</span> <span class="toc-nav-text">运行 Fluentd</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">8.3.</span> <span class="toc-nav-text">运行测试容器</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">8.4.</span> <span class="toc-nav-text">验证 EFK 效果</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">9.</span> <span class="toc-nav-text">模拟日志生成压力测试工具</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">10.</span> <span class="toc-nav-text">小结</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#vip-container"><span class="toc-nav-number">11.</span> <span class="toc-nav-text">参考文章</span></a></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
                        
                          <a class="tag" href="/tags/#Kubernetes" title="Kubernetes">Kubernetes</a>
                        
                          <a class="tag" href="/tags/#Elasticsearch" title="Elasticsearch">Elasticsearch</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://www.mike.org.cn/" target="_blank">简单.生活</a></li>
                    
                        <li><a href="http://shang.qq.com/wpa/qunwpa?idkey=ea4c43493c2269428ac6ef6141de4b6d78e5ab2d41380ca4099b833b62884ee9" target="_blank">技术交流群</a></li>
                    
                        <li><a href="" target="_blank"></a></li>
                    
                        <li><a href="" target="_blank"></a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






    <!-- 来必力City版公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
       (function(d, s) {
           var j, e = d.getElementsByTagName(s)[0];
    
           if (typeof LivereTower === 'function') { return; }
    
           j = d.createElement(s);
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;
    
           e.parentNode.insertBefore(j, e);
       })(document, 'script');
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    <!-- 来必力City版 公共JS代码 end -->



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                    <li>
                        <a href="/atom.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/80imike">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/2093524665">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Mike 2022 | Hosted by <a href="https://pages.coding.me" target="_blank" rel="noopener" style="font-weight: bold">Coding Pages</a>
                    <br>
                    Theme by <a href="http://beantech.org" target="_blank" rel="noopener">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com" target="_blank" rel="noopener">胡伟煌</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://www.hi-linux.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->



<script async defer data-website-id="0d8da2a4-a24e-4240-9304-00a6e347ddfe"
    src="https://umami.hi-linux.com/umami.js"></script>



	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://www.hi-linux.com/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

<script>(function(w,d, s, id) {w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = 'https://cdn.webpushr.com/app.min.js';fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BF9JK7xV9kjWTdMx2lr6RWaPfXV7wNuZaVAJ1bfIGoBNJavqLEBVFMKLubITnCA4bh2fI9iH9tMF95nXnPt7xxY');</script></body>

</html>
