<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="RhTUr9TCCVuxvnQF2xhQZbwtArG6b5x_-AO42Zl9EIE" />










  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.lug.ustc.edu.cn/css?family=华文中宋:300,300italic,400,400italic,700,700italic|Source Serif Pro:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="技巧,Vagrant," />





  <link rel="alternate" href="/atom.xml" title="Hi Linux" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Vagrantfile，官方解释是这样的：The primary function of the Vagrantfile is to describe the type of machine required for a project, and how to configure and provision these machines。简单来说就是配置这个虚拟主机网络连接方式，端口转发，同步文件">
<meta property="og:type" content="article">
<meta property="og:title" content="Vagrantfile配置技巧">
<meta property="og:url" content="http://www.hi-linux.com/posts/24777.html">
<meta property="og:site_name" content="Hi Linux">
<meta property="og:description" content="Vagrantfile，官方解释是这样的：The primary function of the Vagrantfile is to describe the type of machine required for a project, and how to configure and provision these machines。简单来说就是配置这个虚拟主机网络连接方式，端口转发，同步文件">
<meta property="og:updated_time" content="2017-01-22T10:13:02.042Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vagrantfile配置技巧">
<meta name="twitter:description" content="Vagrantfile，官方解释是这样的：The primary function of the Vagrantfile is to describe the type of machine required for a project, and how to configure and provision these machines。简单来说就是配置这个虚拟主机网络连接方式，端口转发，同步文件">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.hi-linux.com/posts/24777.html"/>





  <title> Vagrantfile配置技巧 | Hi Linux </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?3b0564d55846bf6e7a5bbe21deda0c69";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hi Linux</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">种一棵树最好的时间是十年前，其次是现在。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.hi-linux.com/posts/24777.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mike">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://0.gravatar.com/avatar/5c1d99604129bc6d96333e7daf784bfc?s=160">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hi Linux">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hi Linux" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Vagrantfile配置技巧
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-15T09:51:54+08:00">
                2016-03-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Vagrant/" itemprop="url" rel="index">
                    <span itemprop="name">Vagrant</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/posts/24777.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="posts/24777.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/posts/24777.html" class="leancloud_visitors" data-flag-title="Vagrantfile配置技巧">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Vagrantfile，官方解释是这样的：The primary function of the Vagrantfile is to describe the type of machine required for a project, and how to configure and provision these machines。简单来说就是配置这个虚拟主机网络连接方式，端口转发，同步文件夹，以及怎么和puppet，chef结合的一个配置文件。执行完$ vagrant init后,在工作目录中,你会发现此文件。</p>
<h3 id="一、NOTE：配置版本说明："><a href="#一、NOTE：配置版本说明：" class="headerlink" title="一、NOTE：配置版本说明："></a>一、NOTE：配置版本说明：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  <span class="comment"># ...</span></div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p>当前支持的两个版本:”1”和”2”. “1”：描述是Vagrant 1.0.x的配置（如看到Vagrant::Config.run do |config| 此也为Vagrant 1.0.x 的配置）；”2”：描述的是1.1+ leading up to 2.0.x的配置。vagrant 1.1+ 的Vagrantfiles能够与vagrant 1.0.x的Vagrantfiles保持向后兼容，也大幅引入新的功能和配置选项。</p>
</blockquote>
<h3 id="二、Vagrant基本设定"><a href="#二、Vagrant基本设定" class="headerlink" title="二、Vagrant基本设定"></a>二、Vagrant基本设定<a id="more"></a></h3><h4 id="设定VM的名称及记忆体"><a href="#设定VM的名称及记忆体" class="headerlink" title="设定VM的名称及记忆体"></a>设定VM的名称及记忆体</h4><p>用你最喜欢的编辑器打开vagrantfile，vagrantfile是个有着详细解释的设定档，在这个档案中所有的设定都被Vagrant::Config.run的Block包起来，在一开始只会有box的设定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">config.vm.box = <span class="string">"ubuntu-12-10"</span></div></pre></td></tr></table></figure>
<p>这告诉了Vagrant要去使用哪个Box作为环境，也就是你一开始输入varant init Box名称时所指定的Box，如果没有输入Box名称的话就会是预设的base，Virtual Box本身提供了VBoxManage这个command line tool让你可以设定你的VM，用modifyvm这个指令让你可以设定VM的名称及记忆体大小等等，这里说的名称指的是在Virtual Box中显示的名称，我们也可以在vagrantfile中进行设定，在你的vagrantfile中加入这行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">config.vm.customize  [ <span class="string">"modifyvm"</span> ,  :id ,  <span class="string">"--name"</span> ,  <span class="string">"Mike"</span> ,  <span class="string">"--memory"</span> ,  <span class="string">"512"</span> ]</div></pre></td></tr></table></figure>
<p>这行设定档意思就是呼叫VBoxManage的modifyvm的指令，设定VM的名称为Mike，而设定VM的记忆体大小为512MB，你可以照这这种作法为你的VM设定好不同的设定。</p>
<h4 id="设定Hostname"><a href="#设定Hostname" class="headerlink" title="设定Hostname"></a>设定Hostname</h4><p>设定hostname非常简单，设定中加入下面这行就好</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">config.vm.host_name = <span class="string">"Mike-App"</span></div></pre></td></tr></table></figure>
<p>设定hostname非常重要，有很多服务都仰赖着hostname来做为辨识，例如Puppet或是Chef，一般一些监控服务像是New Relic之类的也都是以hostname来做为辨识。</p>
<h3 id="三、配置网络（本文将提供2种版本的常用配置，其中版本2的配置经过实践验证）"><a href="#三、配置网络（本文将提供2种版本的常用配置，其中版本2的配置经过实践验证）" class="headerlink" title="三、配置网络（本文将提供2种版本的常用配置，其中版本2的配置经过实践验证）"></a>三、配置网络（本文将提供2种版本的常用配置，其中版本2的配置经过实践验证）</h3><h4 id="端口转发：-假设虚拟机的80端口提供web服务，此处将通过访问物理机的8080端口转发到虚拟机的80端口，来实现web的访。开启host-only可直接访问虚拟机端口。"><a href="#端口转发：-假设虚拟机的80端口提供web服务，此处将通过访问物理机的8080端口转发到虚拟机的80端口，来实现web的访。开启host-only可直接访问虚拟机端口。" class="headerlink" title="端口转发：(假设虚拟机的80端口提供web服务，此处将通过访问物理机的8080端口转发到虚拟机的80端口，来实现web的访。开启host_only可直接访问虚拟机端口。)"></a>端口转发：(假设虚拟机的80端口提供web服务，此处将通过访问物理机的8080端口转发到虚拟机的80端口，来实现web的访。开启host_only可直接访问虚拟机端口。)</h4><p>版本”2”：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.network :forwarded_port, guest: 80, host: 8080</div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p>guest:80 表示虚拟机中的80端口，host:8080表示映射到宿主机的8080端口。</p>
</blockquote>
<p>版本”1”:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Vagrant::Config.run <span class="keyword">do</span> |config|</div><div class="line">  <span class="comment"># Forward guest port 80 to host port 8080</span></div><div class="line">  config.vm.forward_port 80, 8080</div><div class="line">end</div></pre></td></tr></table></figure>
<h4 id="桥接网络-公共网络，局域网DHCP服务器自动分配IP）"><a href="#桥接网络-公共网络，局域网DHCP服务器自动分配IP）" class="headerlink" title="桥接网络(公共网络，局域网DHCP服务器自动分配IP）"></a>桥接网络(公共网络，局域网DHCP服务器自动分配IP）</h4><p>如果需要将虚拟机作为当前局域网中的一台计算机，由局域网进行DHCP，那么在Vagrantfile中配置：</p>
<p>版本”2”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.network :public_network</div><div class="line">end</div></pre></td></tr></table></figure>
<p>版本”1”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Vagrant::Config.run <span class="keyword">do</span> |config|</div><div class="line">  config.vm.network :bridged</div><div class="line">end</div><div class="line">  $ VBoxManage list bridgedifs | grep ^Name    <span class="comment">#可通过此命令查看本机的网卡</span></div><div class="line">    Name:            eth0</div><div class="line"></div><div class="line">指定网卡，配置可写为如下：</div><div class="line"></div><div class="line">Vagrant::Config.run <span class="keyword">do</span> |config|</div><div class="line">  config.vm.network :bridged, :bridge =&gt; <span class="string">"eth0"</span></div><div class="line">end</div></pre></td></tr></table></figure>
<h4 id="私有网络：允许多个虚拟机通过主机通过网络互相通信，vagrant允许用户分配一个静态IP，然后使用私有网络设置。"><a href="#私有网络：允许多个虚拟机通过主机通过网络互相通信，vagrant允许用户分配一个静态IP，然后使用私有网络设置。" class="headerlink" title="私有网络：允许多个虚拟机通过主机通过网络互相通信，vagrant允许用户分配一个静态IP，然后使用私有网络设置。"></a>私有网络：允许多个虚拟机通过主机通过网络互相通信，vagrant允许用户分配一个静态IP，然后使用私有网络设置。</h4><p>Vagrant默认是使用端口映射方式将虚拟机的端口映射本地从而实现类似<a href="http://localhost:80" target="_blank" rel="external">http://localhost:80</a>这种访问方式，这种方式比较麻烦。如果需要自己自由的访问虚拟机，但是别人不需要访问虚拟机，可以使用private_network，比起端口映射新开和修改端口的时候都得编辑相比较而言，host-only模式显得方便多了。</p>
<p>打开Vagrantfile，将下面这行的注释去掉(移除#)并保存：</p>
<p>版本”2”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.network :private_network, ip: <span class="string">"192.168.50.4"</span></div><div class="line">end</div></pre></td></tr></table></figure>
<p>版本”1”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Vagrant::Config.run <span class="keyword">do</span> |config|</div><div class="line">  config.vm.network :hostonly, <span class="string">"192.168.50.4"</span></div><div class="line">end</div></pre></td></tr></table></figure>
<p>重启虚拟机，这样我们就能用 192.168.50.4访问这台机器了，你可以把IP 改成其他地址，只要不产生冲突就行。多台虚拟机的话需要互相访问的话，设置在相同网段即可。</p>
<h3 id="四、同步文件夹"><a href="#四、同步文件夹" class="headerlink" title="四、同步文件夹"></a>四、同步文件夹</h3><p>默认的，vagrant将共享你的工作目录(即Vagrantfile所在的目录)到虚拟机中的/vagrant,所以一般不需配置即可，如你需要可配置：</p>
<p>版本”1”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">config.vm.share_folder <span class="string">"v-data"</span>, <span class="string">"/data"</span>, <span class="string">"data"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>把这一行的注释去掉，如上所说，第一个是个标志，第二个是你虚拟机里挂载的目录，第三个就是物理机的目录了，位置相对于Vagrantfile。这个目录是777的，可以随意修改删除，所有操作在虚拟机和本机都是同步的。</p>
</blockquote>
<p>版本”2”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  <span class="comment"># other config here</span></div><div class="line">  config.vm.synced_folder <span class="string">"src/"</span>, <span class="string">"/srv/website"</span></div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p>第一个参数”src/“是你的宿主机目录，可以用相对目录(位置相对于Vagrantfile)，这里也可以使用绝对路径，比如：”d:/www/“。第二个参数”/srv/website”是客户机的挂载的绝对目录。</p>
</blockquote>
<h3 id="五、vagrant和shell-实现在虚拟机启动的时候自运行需要的shell命令或脚本"><a href="#五、vagrant和shell-实现在虚拟机启动的时候自运行需要的shell命令或脚本" class="headerlink" title="五、vagrant和shell(实现在虚拟机启动的时候自运行需要的shell命令或脚本)"></a>五、vagrant和shell(实现在虚拟机启动的时候自运行需要的shell命令或脚本)</h3><h4 id="版本”2”"><a href="#版本”2”" class="headerlink" title="版本”2”"></a>版本”2”</h4><ul>
<li>内嵌脚本：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :shell,</div><div class="line">    :inline =&gt; <span class="string">"echo Hello, World"</span></div><div class="line">end</div><div class="line"></div><div class="line"><span class="comment">#复杂点的调用如下：</span></div><div class="line"><span class="variable">$script</span> = &lt;&lt;SCRIPT</div><div class="line"><span class="built_in">echo</span> I am provisioning...</div><div class="line">date &gt; /etc/vagrant_provisioned_at</div><div class="line">SCRIPT</div><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :shell, :inline =&gt; <span class="variable">$script</span></div><div class="line">end</div></pre></td></tr></table></figure>
<ul>
<li>外部脚本:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :shell, :path =&gt; <span class="string">"script.sh"</span>      <span class="comment">#脚本的路径相对于项目根，也可使用绝对路径</span></div><div class="line">end</div><div class="line"></div><div class="line"><span class="comment">#脚本可传递参数：</span></div><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :shell <span class="keyword">do</span> |s|</div><div class="line">    s.inline = <span class="string">"echo <span class="variable">$1</span>"</span></div><div class="line">    s.args   = <span class="string">"'hello, world!'"</span></div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<h4 id="版本”1”"><a href="#版本”1”" class="headerlink" title="版本”1”:"></a>版本”1”:</h4><ul>
<li>内部脚本：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> Vagrant::Config.run <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :shell, :inline =&gt; <span class="string">"echo abc &gt; /tmp/test"</span></div><div class="line">end</div></pre></td></tr></table></figure>
<ul>
<li>外部脚本：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Vagrant::Config.run <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :shell, :path =&gt; <span class="string">"test.sh"</span></div><div class="line">end</div></pre></td></tr></table></figure>
<ul>
<li>脚本可传递参数：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Vagrant::Config.run <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :shell <span class="keyword">do</span> |shell|</div><div class="line">    shell.inline = <span class="string">"echo <span class="variable">$1</span> &gt; /tmp/test"</span></div><div class="line">    shell.args = <span class="string">"'this is test'"</span></div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>虽然不是必须，但是如果有需要在启动时运行一些脚本(环境的安装或者有些服务的启动需要在完成目录映射之后进行)，可以编辑脚本，类似如下(摘自Vagrant Document)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/env bash</span></div><div class="line">	</div><div class="line">apt-get update</div><div class="line">apt-get install -y apache2</div><div class="line">rm -rf /var/www</div><div class="line">ln -fs /vagrant /var/www</div></pre></td></tr></table></figure>
<p>保存在和Vagrantfile相同目录，文件名自取(如boot.sh），然后在Vagrantfile中添加：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">config.vm.provision :shell, :path =&gt; <span class="string">"boot.sh"</span></div></pre></td></tr></table></figure>
<p>当初次使用基本的设置都完成则之后，则可以使用 vagrant up启动虚拟机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Bringing machine <span class="string">'default'</span> up with <span class="string">'virtualbox'</span> provider...</div><div class="line">[default] Setting the name of the VM...</div><div class="line">[default] Clearing any previously <span class="built_in">set</span> forwarded ports...</div><div class="line">[default] Creating shared folders metadata...</div><div class="line">[default] Clearing any previously <span class="built_in">set</span> network interfaces...</div><div class="line">[default] Preparing network interfaces based on configuration...</div><div class="line">[default] You are trying to forward to privileged ports (ports &lt; = 1024). Most operating systems restrict this to only privileged process (typicallyprocesses running as an administrative user). This is a warning <span class="keyword">in</span> <span class="keyword">case</span></div><div class="line">the port forwarding doesn<span class="string">'t work. If any problems occur, please try a port higher than 1024.</span></div><div class="line">[default] Forwarding ports...</div><div class="line">[default] -- 22 =&gt; &lt;strong&gt;2222&lt;/strong&gt; (adapter 1)</div><div class="line">[default] -- 80 =&gt; 8080 (adapter 1)</div><div class="line">[default] Booting VM...</div><div class="line">[default] Waiting for VM to boot. This can take a few minutes.</div><div class="line">[default] VM booted and ready for use!</div><div class="line">[default] The guest additions on this VM do not match the installed version of VirtualBox! In most cases this is fine, but in rare cases it can cause things such as shared folders to not work properly. If you see shared folder errors, please update the guest additions within the virtual machine and reload your VM.</div><div class="line">	</div><div class="line">Guest Additions Version: 4.1.18</div><div class="line">VirtualBox Version: 4.2</div><div class="line">[default] Mounting shared folders...</div><div class="line">[default] -- /var/www</div><div class="line">[default] -- /vagrant</div><div class="line">[default] Running provisioner: shell...</div></pre></td></tr></table></figure>
<h3 id="六、vagrant和puppet"><a href="#六、vagrant和puppet" class="headerlink" title="六、vagrant和puppet"></a>六、vagrant和puppet</h3><p>puppet相关介绍:<a href="http://xuclv.blog.51cto.com/blog/5503169/1154261" target="_blank" rel="external">http://xuclv.blog.51cto.com/blog/5503169/1154261</a></p>
<ul>
<li>vagrant调用puppet单独使用</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :puppet <span class="keyword">do</span> |puppet|</div><div class="line">    puppet.manifests_path = <span class="string">"my_manifests"</span><span class="comment">#路径相对于项目根，如无配置此项，默认为manifests</span></div><div class="line">    puppet.manifest_file = <span class="string">"default.pp"</span>      <span class="comment">#如无配置此项，默认为default.pp</span></div><div class="line">    puppet.module_path = <span class="string">"modules"</span>        <span class="comment">#路径相对于根</span></div><div class="line">    puppet.options = <span class="string">"--verbose --debug"</span></div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">默认配置的目录结构：</div><div class="line"> $ tree</div><div class="line">  .</div><div class="line">  |-- Vagrantfile</div><div class="line">  |-- manifests</div><div class="line">  |   |-- default.pp</div></pre></td></tr></table></figure>
<ul>
<li>vagrant让puppet作为代理，连接Puppet master</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span>|config|</div><div class="line">config.vm.provision :puppet_server <span class="keyword">do</span>|puppet|</div><div class="line">puppet.puppet_server = <span class="string">"puppet.example.com"</span><span class="comment">#master域名</span></div><div class="line">puppet.puppet_node = <span class="string">"node.example.com"</span><span class="comment">#传递给puppet服务器节点的名称。默认为”puppet“</span></div><div class="line">puppet.options = <span class="string">"--verbose --debug"</span><span class="comment">#选项</span></div><div class="line">end</div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p>NOTE：<br>版本1配置差别不大，不再详述，区别：<code>Vagrant.configure(&quot;2&quot;) do |config|</code>改为<code>Vagrant::Config.run do |config|</code><br>以上Vagrantfile配置完毕后，可<code>$vagrant reload</code>重启虚拟机以来实现配置生效</p>
</blockquote>
<ul>
<li>官方实例：</li>
</ul>
<p>1.进入工作目录<br>2.修改Vagrantfile<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$vim</span> Vagrantfile    </div><div class="line"><span class="comment">#启用或添加如下行：</span></div><div class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</div><div class="line">  config.vm.provision :puppet    <span class="comment">#这里没有配置pp文件等的路径，全部采用默认</span></div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>3.创建puppet的主目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$mkdir</span> manifests</div></pre></td></tr></table></figure></p>
<p>4.配置pp文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$ vim manifests/default.pp</div><div class="line"><span class="comment"># Basic Puppet Apache manifest</span></div><div class="line">class apache &#123;</div><div class="line">  <span class="built_in">exec</span> &#123; <span class="string">'apt-get update'</span>:</div><div class="line">    <span class="built_in">command</span> =&gt; <span class="string">'/usr/bin/apt-get update'</span></div><div class="line">  &#125;</div><div class="line">  package &#123; <span class="string">"apache2"</span>:</div><div class="line">    ensure =&gt; present,</div><div class="line">  &#125;</div><div class="line">  service &#123; <span class="string">"apache2"</span>:</div><div class="line">    ensure =&gt; running,</div><div class="line">    require =&gt; Package[<span class="string">"apache2"</span>],</div><div class="line">  &#125;</div><div class="line">  file &#123; <span class="string">'/var/www'</span>:</div><div class="line">    ensure =&gt; link,</div><div class="line">    target =&gt; <span class="string">"/vagrant"</span>,</div><div class="line">    notify =&gt; Service[<span class="string">'apache2'</span>],</div><div class="line">    force  =&gt; <span class="literal">true</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">include apache</div></pre></td></tr></table></figure></p>
<p>5.重启虚拟机<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#重启后可看到虚拟机中已经安装好了apache</span></div><div class="line">$ vagrant reload</div></pre></td></tr></table></figure></p>
<h3 id="七、多虚拟机配置"><a href="#七、多虚拟机配置" class="headerlink" title="七、多虚拟机配置"></a>七、多虚拟机配置</h3><ul>
<li>配置语法</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">VAGRANTFILE_API_VERSION = <span class="string">"2"</span>    <span class="comment">#定义版本</span></div><div class="line">Vagrant.configure(VAGRANTFILE_API_VERSION) <span class="keyword">do</span> |config|  <span class="comment">#使用内部2版本</span></div><div class="line">  config.vm.define :debian1 <span class="keyword">do</span> |debian1|   <span class="comment">#定义第一台虚拟机，||里面就类似一个变量设置参数时使用 </span></div><div class="line">     debian1.vm.box = <span class="string">"debian1"</span>             <span class="comment">#设置box名为debian1</span></div><div class="line">     debian1.vm.host_name = <span class="string">"debian1"</span>      <span class="comment">#设置hostname为debian1</span></div><div class="line">     debian1.vm.network :private_network, ip: <span class="string">"192.168.1.11"</span> <span class="comment">#设置网络为内部网络 ip为192.168.1.11</span></div><div class="line">  end</div><div class="line">  config.vm.define :debian2 <span class="keyword">do</span> |debian2|</div><div class="line">     debian2.vm.box = <span class="string">"debian2"</span></div><div class="line">     debian2.vm.host_name = <span class="string">"debian2"</span></div><div class="line">     debian2.vm.network :private_network, ip: <span class="string">"192.168.1.12"</span></div><div class="line">  end</div><div class="line">  config.vm.define :debian3 <span class="keyword">do</span> |debian3|</div><div class="line">     debian3.vm.box = <span class="string">"debian3"</span></div><div class="line">     debian3.vm.host_name = <span class="string">"debian3"</span></div><div class="line">     debian3.vm.network :private_network, ip: <span class="string">"192.168.1.13"</span></div><div class="line">  end</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p>这里定义一个debian1、debian2、debian3三个虚拟机，并设置主机名、私有网络和IP地址。<br>注意：配置前关闭虚拟机，配置完后打开虚拟机。注意define用法，原单台机器的设定必须先清除或是注解掉。</p>
</blockquote>
<ul>
<li>实例</li>
</ul>
<p>让我们开始打造多机器环境</p>
<p>现在我们要建立多个VM，并且让他们互相沟通，一台Application、一台DB。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">config.vm.define:app <span class="keyword">do</span> |app_config| </div><div class="line">    app_config.vm.customize  [ <span class="string">"modifyvm"</span> ,  :id ,  <span class="string">"--name"</span> ,  <span class="string">"app"</span> ,  <span class="string">"--memory"</span> ,  <span class="string">"512"</span> ] </div><div class="line">    app_config.vm.box  =  <span class="string">"ubuntu-12-10"</span> </div><div class="line">    app_config.vm.host_name  =  <span class="string">"app"</span> </div><div class="line">    app_config.vm.network  :hostonly ,  <span class="string">"33.33.13.10"</span> </div><div class="line">end </div><div class="line">config.vm.define:db <span class="keyword">do</span> |db_config| </div><div class="line">  db_config.vm.customize  [ <span class="string">"modifyvm"</span> ,  :id ,  <span class="string">"--name"</span> ,  <span class="string">"db"</span> ,  <span class="string">"--memory"</span> ,  <span class="string">"512"</span> ] </div><div class="line">  db_config.vm.box  =  <span class="string">"ubuntu-12-10"</span> </div><div class="line">  db_config.vm.host_name  =  <span class="string">"db"</span> </div><div class="line">  db_config.vm.network  :hostonly ,  <span class="string">"33.33.13.11"</span> </div><div class="line">end</div></pre></td></tr></table></figure>
<p>这边的设定了app以及db两个VM的，并且给予不同的hostname和IP，设定好了以后再使用vagrant up将机器跑起来：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$vagrant</span>  up </div><div class="line">[ app ]  Importing  base  box  <span class="string">'ubuntu-12-10'</span> . . . </div><div class="line">[ app ]  Matching  MAC  address  <span class="keyword">for</span>  NAT  networking . . . </div><div class="line">[ app ]  Clearing  any  previously  <span class="built_in">set</span>  forwarded  ports . . . </div><div class="line">[ app ]  Forwarding  ports . . . </div><div class="line">[ app ]  --  22  =&gt;  2222  ( adapter  1 ) </div><div class="line">[ app ]  --  80  =&gt;  8080  ( adapter  1 ) </div><div class="line">[ app ]  Creating  shared  folders  metadata . . . </div><div class="line">[ app ]  Clearing  any  previously  <span class="built_in">set</span>  network  interfaces . . . </div><div class="line">[ app ]  Preparing  network  interfaces  based  on  configuration . . . </div><div class="line">[ app ]  Running  any  VM  customizations . . . </div><div class="line">[ app ]  Booting  VM . . . </div><div class="line">[ app ]  Waiting  <span class="keyword">for</span>  VM  to  boot .  This  can  take  a  few  minutes . </div><div class="line">[ app ]  VM  booted  and  ready  <span class="keyword">for</span>  use! </div><div class="line">[ app ]  Configuring  and  enabling  network  interfaces . . . </div><div class="line">[ app ]  Setting  host  name . . . </div><div class="line">[ app ]  Mounting  shared  folders . . . </div><div class="line">[ app ]  --  v - root :  /vagrant </div><div class="line">[db] Importing base box <span class="string">'ubuntu-12-10'</span>... </div><div class="line">[db] Matching MAC address <span class="keyword">for</span> NAT networking... </div><div class="line">[db] Clearing any previously <span class="built_in">set</span> forwarded ports... </div><div class="line">[db] Fixed port collision <span class="keyword">for</span> 22 =&gt; 2222. Now on port 2200. </div><div class="line">[db] Fixed port collision <span class="keyword">for</span> 22 =&gt; 2222. Now on port 2201. </div><div class="line">[db] Forwarding ports... </div><div class="line">[db] -- 22 =&gt; 2201 (adapter 1) </div><div class="line">[db] Creating shared folders metadata... </div><div class="line">[db] Clearing any previously <span class="built_in">set</span> network interfaces... </div><div class="line">[db] Preparing network interfaces based on configuration... </div><div class="line">[db] Running any VM customizations... </div><div class="line">[db] Booting VM... </div><div class="line">[db] Waiting <span class="keyword">for</span> VM to boot . This can take a few minutes. </div><div class="line">[db] VM booted and ready <span class="keyword">for</span> use! </div><div class="line">[db] Configuring and enabling network interfaces... </div><div class="line">[db] Setting host name... </div><div class="line">[db] Mounting shared folders... </div><div class="line">[db] -- v-root: / vagrant</div></pre></td></tr></table></figure>
<p>看到上面的信息完后，你就可以跟刚刚一样使用ssh连到VM里，多虚拟机环境下须加上你所指定的角色告诉你要连线的机器是哪一台：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$vagrant</span> ssh app </div><div class="line">vagrant@app :~ $ </div><div class="line"></div><div class="line"><span class="variable">$vagrant</span> ssh db </div><div class="line">vagrant@db :~ $</div></pre></td></tr></table></figure>
<p>验证VM之间的访问，让我们使用ssh登入db的机器，然后在db的机器上使用ssh来连线到app的机器(预设密码就是vagrant)：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$vagrant</span> ssh db </div><div class="line">vagrant @db :~ $  ssh  33 . 33 . 13 . 10 </div><div class="line">The  authenticity  of  host  <span class="string">'33.33.13.10 (33.33.13.10)'</span>  can <span class="string">'t be established. </span></div><div class="line">ECDSA key fingerprint is a7:71:36:4c: 01:4a:38:a2:fc:fa:ea:d7:67:63:3c:40. </div><div class="line">Are you sure you want to continue connecting (yes/no)? yes </div><div class="line">Warning: Permanently added ' 33 . 33 . 13 . 10 <span class="string">' (ECDSA) to the list of known hosts. </span></div><div class="line">vagrant@33.33.13.10' s  password : </div><div class="line">vagrant @app :~ $</div></pre></td></tr></table></figure></p>
<h3 id="八、其它技巧"><a href="#八、其它技巧" class="headerlink" title="八、其它技巧"></a>八、其它技巧</h3><p>使用 Apache/Nginx 时会出现诸如图片修改后但页面刷新仍然是旧文件的情况，是由于静态文件缓存造成的。需要对虚拟机里的 Apache/Nginx 配置文件进行修改：</p>
<ul>
<li>Apache 配置添加:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EnableSendfile off</div></pre></td></tr></table></figure>
<ul>
<li>Nginx 配置添加:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sendfile off;</div></pre></td></tr></table></figure>
      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/img/donate/wechatqcode.jpg" alt="Mike wechat" style="width: 200px; max-width: 100%;"/>
    <div>更多精彩内容，请关注微信公众号Hi-Linux，第一时间推送给您!</div>
</div>


      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/技巧/" rel="tag"># 技巧</a>
          
            <a href="/tags/Vagrant/" rel="tag"># Vagrant</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/50141.html" rel="next" title="Web性能压力测试工具之Siege详解">
                <i class="fa fa-chevron-left"></i> Web性能压力测试工具之Siege详解
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/27459.html" rel="prev" title="Debian/Ubuntu下iptables管理脚本">
                Debian/Ubuntu下iptables管理脚本 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="posts/24777.html"
     data-title="Vagrantfile配置技巧"
     data-content=""
     data-url="http://www.hi-linux.com/posts/24777.html">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="posts/24777.html"
           data-title="Vagrantfile配置技巧" data-url="http://www.hi-linux.com/posts/24777.html">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://0.gravatar.com/avatar/5c1d99604129bc6d96333e7daf784bfc?s=160"
               alt="Mike" />
          <p class="site-author-name" itemprop="name">Mike</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">110</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">57</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">72</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/80imike" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://twitter.com/easylife206" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2093524665/" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://zhihu.com/people/80imike" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  zhihu
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://shang.qq.com/wpa/qunwpa?idkey=ea4c43493c2269428ac6ef6141de4b6d78e5ab2d41380ca4099b833b62884ee9" target="_blank" title="QQGroup">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  QQGroup
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.mike.org.cn/" title="简单.生活" target="_blank">简单.生活</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、NOTE：配置版本说明："><span class="nav-number">1.</span> <span class="nav-text">一、NOTE：配置版本说明：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、Vagrant基本设定"><span class="nav-number">2.</span> <span class="nav-text">二、Vagrant基本设定</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#设定VM的名称及记忆体"><span class="nav-number">2.1.</span> <span class="nav-text">设定VM的名称及记忆体</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设定Hostname"><span class="nav-number">2.2.</span> <span class="nav-text">设定Hostname</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、配置网络（本文将提供2种版本的常用配置，其中版本2的配置经过实践验证）"><span class="nav-number">3.</span> <span class="nav-text">三、配置网络（本文将提供2种版本的常用配置，其中版本2的配置经过实践验证）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#端口转发：-假设虚拟机的80端口提供web服务，此处将通过访问物理机的8080端口转发到虚拟机的80端口，来实现web的访。开启host-only可直接访问虚拟机端口。"><span class="nav-number">3.1.</span> <span class="nav-text">端口转发：(假设虚拟机的80端口提供web服务，此处将通过访问物理机的8080端口转发到虚拟机的80端口，来实现web的访。开启host_only可直接访问虚拟机端口。)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#桥接网络-公共网络，局域网DHCP服务器自动分配IP）"><span class="nav-number">3.2.</span> <span class="nav-text">桥接网络(公共网络，局域网DHCP服务器自动分配IP）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#私有网络：允许多个虚拟机通过主机通过网络互相通信，vagrant允许用户分配一个静态IP，然后使用私有网络设置。"><span class="nav-number">3.3.</span> <span class="nav-text">私有网络：允许多个虚拟机通过主机通过网络互相通信，vagrant允许用户分配一个静态IP，然后使用私有网络设置。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、同步文件夹"><span class="nav-number">4.</span> <span class="nav-text">四、同步文件夹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、vagrant和shell-实现在虚拟机启动的时候自运行需要的shell命令或脚本"><span class="nav-number">5.</span> <span class="nav-text">五、vagrant和shell(实现在虚拟机启动的时候自运行需要的shell命令或脚本)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#版本”2”"><span class="nav-number">5.1.</span> <span class="nav-text">版本”2”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#版本”1”"><span class="nav-number">5.2.</span> <span class="nav-text">版本”1”:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实例"><span class="nav-number">5.3.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#六、vagrant和puppet"><span class="nav-number">6.</span> <span class="nav-text">六、vagrant和puppet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#七、多虚拟机配置"><span class="nav-number">7.</span> <span class="nav-text">七、多虚拟机配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#八、其它技巧"><span class="nav-number">8.</span> <span class="nav-text">八、其它技巧</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2010 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mike</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"imike"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("EeCjSUdsGRpRB9IrXppQ5KrB-gzGzoHsz", "JzmNE4oVCYAxJ1Whfn49rCkK");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
